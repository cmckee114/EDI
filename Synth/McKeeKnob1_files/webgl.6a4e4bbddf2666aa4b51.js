(self.webpackChunkNewton=self.webpackChunkNewton||[]).push([[327],{911748:function(e,t,i){e.exports=function(e){"use strict";var t=1e-6,i={};!function(){if("undefined"!=typeof Float32Array){var e=new Float32Array(1),t=new Int32Array(e.buffer);i.invsqrt=function(i){var r=.5*i;e[0]=i;var n=1.5;t[0]=1597463007-(t[0]>>1);var o=e[0];return o*(n-r*o*o)}}else i.invsqrt=function(e){return 1/Math.sqrt(e)}}();var r=null;function n(e){return r=e}function o(){return r="undefined"!=typeof Float32Array?Float32Array:Array}o();var s={create:function(e){var t=new r(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t},createFrom:function(e,t,i){var n=new r(3);return n[0]=e,n[1]=t,n[2]=i,n},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},equal:function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t},add:function(e,t,i){return i&&e!==i?(i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},subtract:function(e,t,i){return i&&e!==i?(i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},multiply:function(e,t,i){return i&&e!==i?(i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i):(e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e)},negate:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},scale:function(e,t,i){return i&&e!==i?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i):(e[0]*=t,e[1]*=t,e[2]*=t,e)},normalize:function(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=Math.sqrt(i*i+r*r+n*n);return o?1===o?(t[0]=i,t[1]=r,t[2]=n,t):(o=1/o,t[0]=i*o,t[1]=r*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)},cross:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=t[0],a=t[1],c=t[2];return i[0]=n*c-o*a,i[1]=o*s-r*c,i[2]=r*a-n*s,i},length:function(e){var t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)},squaredLength:function(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},direction:function(e,t,i){i||(i=e);var r=e[0]-t[0],n=e[1]-t[1],o=e[2]-t[2],s=Math.sqrt(r*r+n*n+o*o);return s?(s=1/s,i[0]=r*s,i[1]=n*s,i[2]=o*s,i):(i[0]=0,i[1]=0,i[2]=0,i)},lerp:function(e,t,i,r){return r||(r=e),r[0]=e[0]+i*(t[0]-e[0]),r[1]=e[1]+i*(t[1]-e[1]),r[2]=e[2]+i*(t[2]-e[2]),r},dist:function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}},a=null,c=new r(4);s.unproject=function(e,t,i,r,n){n||(n=e),a||(a=f.create());var o=a,s=c;return s[0]=2*(e[0]-r[0])/r[2]-1,s[1]=2*(e[1]-r[1])/r[3]-1,s[2]=2*e[2]-1,s[3]=1,f.multiply(i,t,o),f.inverse(o)?(f.multiplyVec4(o,s),0===s[3]?null:(n[0]=s[0]/s[3],n[1]=s[1]/s[3],n[2]=s[2]/s[3],n)):null};var l=s.createFrom(1,0,0),u=s.createFrom(0,1,0),h=s.createFrom(0,0,1),d=s.create();s.rotationTo=function(e,t,i){i||(i=m.create());var r=s.dot(e,t),n=d;if(r>=1)m.set(y,i);else if(r<-.999999)s.cross(l,e,n),s.length(n)<1e-6&&s.cross(u,e,n),s.length(n)<1e-6&&s.cross(h,e,n),s.normalize(n),m.fromAngleAxis(Math.PI,n,i);else{var o=Math.sqrt(2*(1+r)),a=1/o;s.cross(e,t,n),i[0]=n[0]*a,i[1]=n[1]*a,i[2]=n[2]*a,i[3]=.5*o,m.normalize(i)}return i[3]>1?i[3]=1:i[3]<-1&&(i[3]=-1),i},s.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},s.distanceSquared=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n},s.setXYZ=function(e,t,i,r){return r[0]=e,r[1]=t,r[2]=i,r},s.linComb=function(e,t,i,r,n){return n||(n=e),n[0]=e[0]*t+i[0]*r,n[1]=e[1]*t+i[1]*r,n[2]=e[2]*t+i[2]*r,n},s.getAPerpendicularVector=function(e){var t=e[0],i=e[1];return Math.abs(t)<btTs.graphics.math.Tolerances.ZERO_LENGTH&&Math.abs(i)<btTs.graphics.math.Tolerances.ZERO_LENGTH?s.createFrom(1,0,0):s.createFrom(-i,t,0)};var p,g={create:function(e){var t=new r(9);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]):t[0]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=0,t},createFrom:function(e,t,i,n,o,s,a,c,l){var u=new r(9);return u[0]=e,u[1]=t,u[2]=i,u[3]=n,u[4]=o,u[5]=s,u[6]=a,u[7]=c,u[8]=l,u},determinant:function(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8];return t*(l*o-s*c)+i*(-l*n+s*a)+r*(c*n-o*a)},inverse:function(e,t){var i,r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=h*a-c*u,p=-h*s+c*l,f=u*s-a*l,m=r*d+n*p+o*f;return m?(i=1/m,t||(t=g.create()),t[0]=d*i,t[1]=(-h*n+o*u)*i,t[2]=(c*n-o*a)*i,t[3]=p*i,t[4]=(h*r-o*l)*i,t[5]=(-c*r+o*s)*i,t[6]=f*i,t[7]=(-u*r+n*l)*i,t[8]=(a*r-n*s)*i,t):null},multiply:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=t[0],p=t[1],g=t[2],f=t[3],m=t[4],y=t[5],v=t[6],E=t[7],I=t[8];return i[0]=d*r+p*s+g*l,i[1]=d*n+p*a+g*u,i[2]=d*o+p*c+g*h,i[3]=f*r+m*s+y*l,i[4]=f*n+m*a+y*u,i[5]=f*o+m*c+y*h,i[6]=v*r+E*s+I*l,i[7]=v*n+E*a+I*u,i[8]=v*o+E*c+I*h,i},multiplyVec2:function(e,t,i){i||(i=t);var r=t[0],n=t[1];return i[0]=r*e[0]+n*e[3]+e[6],i[1]=r*e[1]+n*e[4]+e[7],i},multiplyVec3:function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2];return i[0]=r*e[0]+n*e[3]+o*e[6],i[1]=r*e[1]+n*e[4]+o*e[7],i[2]=r*e[2]+n*e[5]+o*e[8],i},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},equal:function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t&&Math.abs(e[3]-i[3])<t&&Math.abs(e[4]-i[4])<t&&Math.abs(e[5]-i[5])<t&&Math.abs(e[6]-i[6])<t&&Math.abs(e[7]-i[7])<t&&Math.abs(e[8]-i[8])<t},identity:function(e){return e||(e=g.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(!t||e===t){var i=e[1],r=e[2],n=e[5];return e[1]=e[3],e[2]=e[6],e[3]=i,e[5]=e[7],e[6]=r,e[7]=n,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},toMat4:function(e,t){return t||(t=f.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"}},f={create:function(e){var t=new r(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},createFrom:function(e,t,i,n,o,s,a,c,l,u,h,d,p,g,f,m){var y=new r(16);return y[0]=e,y[1]=t,y[2]=i,y[3]=n,y[4]=o,y[5]=s,y[6]=a,y[7]=c,y[8]=l,y[9]=u,y[10]=h,y[11]=d,y[12]=p,y[13]=g,y[14]=f,y[15]=m,y},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},equal:function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t&&Math.abs(e[3]-i[3])<t&&Math.abs(e[4]-i[4])<t&&Math.abs(e[5]-i[5])<t&&Math.abs(e[6]-i[6])<t&&Math.abs(e[7]-i[7])<t&&Math.abs(e[8]-i[8])<t&&Math.abs(e[9]-i[9])<t&&Math.abs(e[10]-i[10])<t&&Math.abs(e[11]-i[11])<t&&Math.abs(e[12]-i[12])<t&&Math.abs(e[13]-i[13])<t&&Math.abs(e[14]-i[14])<t&&Math.abs(e[15]-i[15])<t},identity:function(e){return e||(e=f.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(!t||e===t){var i=e[1],r=e[2],n=e[3],o=e[6],s=e[7],a=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=i,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=o,e[11]=e[14],e[12]=n,e[13]=s,e[14]=a,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},determinant:function(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11],p=e[12],g=e[13],f=e[14],m=e[15];return p*u*a*n-l*g*a*n-p*s*h*n+o*g*h*n+l*s*f*n-o*u*f*n-p*u*r*c+l*g*r*c+p*i*h*c-t*g*h*c-l*i*f*c+t*u*f*c+p*s*r*d-o*g*r*d-p*i*a*d+t*g*a*d+o*i*f*d-t*s*f*d-l*s*r*m+o*u*r*m+l*i*a*m-t*u*a*m-o*i*h*m+t*s*h*m},inverse:function(e,t){t||(t=e);var i,r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=e[9],p=e[10],g=e[11],f=e[12],m=e[13],y=e[14],v=e[15],E=r*c-n*a,I=r*l-o*a,T=r*u-s*a,S=n*l-o*c,P=n*u-s*c,_=o*u-s*l,M=h*m-d*f,D=h*y-p*f,C=h*v-g*f,O=d*y-p*m,A=d*v-g*m,R=p*v-g*y,N=E*R-I*A+T*O+S*C-P*D+_*M;return N?(i=1/N,t[0]=(c*R-l*A+u*O)*i,t[1]=(-n*R+o*A-s*O)*i,t[2]=(m*_-y*P+v*S)*i,t[3]=(-d*_+p*P-g*S)*i,t[4]=(-a*R+l*C-u*D)*i,t[5]=(r*R-o*C+s*D)*i,t[6]=(-f*_+y*T-v*I)*i,t[7]=(h*_-p*T+g*I)*i,t[8]=(a*A-c*C+u*M)*i,t[9]=(-r*A+n*C-s*M)*i,t[10]=(f*P-m*T+v*E)*i,t[11]=(-h*P+d*T-g*E)*i,t[12]=(-a*O+c*D-l*M)*i,t[13]=(r*O-n*D+o*M)*i,t[14]=(-f*S+m*I-y*E)*i,t[15]=(h*S-d*I+p*E)*i,t):null},toRotationMat:function(e,t){return t||(t=f.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},toMat3:function(e,t){return t||(t=g.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},toInverseMat3:function(e,t){var i,r=e[0],n=e[1],o=e[2],s=e[4],a=e[5],c=e[6],l=e[8],u=e[9],h=e[10],d=h*a-c*u,p=-h*s+c*l,f=u*s-a*l,m=r*d+n*p+o*f;return m?(i=1/m,t||(t=g.create()),t[0]=d*i,t[1]=(-h*n+o*u)*i,t[2]=(c*n-o*a)*i,t[3]=p*i,t[4]=(h*r-o*l)*i,t[5]=(-c*r+o*s)*i,t[6]=f*i,t[7]=(-u*r+n*l)*i,t[8]=(a*r-n*s)*i,t):null},multiply:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=e[9],p=e[10],g=e[11],f=e[12],m=e[13],y=e[14],v=e[15],E=t[0],I=t[1],T=t[2],S=t[3];return i[0]=E*r+I*a+T*h+S*f,i[1]=E*n+I*c+T*d+S*m,i[2]=E*o+I*l+T*p+S*y,i[3]=E*s+I*u+T*g+S*v,E=t[4],I=t[5],T=t[6],S=t[7],i[4]=E*r+I*a+T*h+S*f,i[5]=E*n+I*c+T*d+S*m,i[6]=E*o+I*l+T*p+S*y,i[7]=E*s+I*u+T*g+S*v,E=t[8],I=t[9],T=t[10],S=t[11],i[8]=E*r+I*a+T*h+S*f,i[9]=E*n+I*c+T*d+S*m,i[10]=E*o+I*l+T*p+S*y,i[11]=E*s+I*u+T*g+S*v,E=t[12],I=t[13],T=t[14],S=t[15],i[12]=E*r+I*a+T*h+S*f,i[13]=E*n+I*c+T*d+S*m,i[14]=E*o+I*l+T*p+S*y,i[15]=E*s+I*u+T*g+S*v,i},multiplyVec3:function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12],i[1]=e[1]*r+e[5]*n+e[9]*o+e[13],i[2]=e[2]*r+e[6]*n+e[10]*o+e[14],i},multiplyVec4:function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2],s=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i},translate:function(e,t,i){var r,n,o,s,a,c,l,u,h,d,p,g,f=t[0],m=t[1],y=t[2];return i&&e!==i?(r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=e[9],p=e[10],g=e[11],i[0]=r,i[1]=n,i[2]=o,i[3]=s,i[4]=a,i[5]=c,i[6]=l,i[7]=u,i[8]=h,i[9]=d,i[10]=p,i[11]=g,i[12]=r*f+a*m+h*y+e[12],i[13]=n*f+c*m+d*y+e[13],i[14]=o*f+l*m+p*y+e[14],i[15]=s*f+u*m+g*y+e[15],i):(e[12]=e[0]*f+e[4]*m+e[8]*y+e[12],e[13]=e[1]*f+e[5]*m+e[9]*y+e[13],e[14]=e[2]*f+e[6]*m+e[10]*y+e[14],e[15]=e[3]*f+e[7]*m+e[11]*y+e[15],e)},scale:function(e,t,i){var r=t[0],n=t[1],o=t[2];return i&&e!==i?(i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i):(e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=n,e[5]*=n,e[6]*=n,e[7]*=n,e[8]*=o,e[9]*=o,e[10]*=o,e[11]*=o,e)},rotate:function(e,t,i,r){var n,o,s,a,c,l,u,h,d,p,g,f,m,y,v,E,I,T,S,P,_,M,D,C,O=i[0],A=i[1],R=i[2],N=Math.sqrt(O*O+A*A+R*R);return N?(1!==N&&(O*=N=1/N,A*=N,R*=N),n=Math.sin(t),s=1-(o=Math.cos(t)),a=e[0],c=e[1],l=e[2],u=e[3],h=e[4],d=e[5],p=e[6],g=e[7],f=e[8],m=e[9],y=e[10],v=e[11],E=O*O*s+o,I=A*O*s+R*n,T=R*O*s-A*n,S=O*A*s-R*n,P=A*A*s+o,_=R*A*s+O*n,M=O*R*s+A*n,D=A*R*s-O*n,C=R*R*s+o,r?e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=a*E+h*I+f*T,r[1]=c*E+d*I+m*T,r[2]=l*E+p*I+y*T,r[3]=u*E+g*I+v*T,r[4]=a*S+h*P+f*_,r[5]=c*S+d*P+m*_,r[6]=l*S+p*P+y*_,r[7]=u*S+g*P+v*_,r[8]=a*M+h*D+f*C,r[9]=c*M+d*D+m*C,r[10]=l*M+p*D+y*C,r[11]=u*M+g*D+v*C,r):null},rotateX:function(e,t,i){var r=Math.sin(t),n=Math.cos(t),o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11];return i?e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[4]=o*n+l*r,i[5]=s*n+u*r,i[6]=a*n+h*r,i[7]=c*n+d*r,i[8]=o*-r+l*n,i[9]=s*-r+u*n,i[10]=a*-r+h*n,i[11]=c*-r+d*n,i},rotateY:function(e,t,i){var r=Math.sin(t),n=Math.cos(t),o=e[0],s=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],d=e[11];return i?e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=o*n+l*-r,i[1]=s*n+u*-r,i[2]=a*n+h*-r,i[3]=c*n+d*-r,i[8]=o*r+l*n,i[9]=s*r+u*n,i[10]=a*r+h*n,i[11]=c*r+d*n,i},rotateZ:function(e,t,i){var r=Math.sin(t),n=Math.cos(t),o=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],d=e[7];return i?e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=o*n+l*r,i[1]=s*n+u*r,i[2]=a*n+h*r,i[3]=c*n+d*r,i[4]=o*-r+l*n,i[5]=s*-r+u*n,i[6]=a*-r+h*n,i[7]=c*-r+d*n,i},frustum:function(e,t,i,r,n,o,s){s||(s=f.create());var a=t-e,c=r-i,l=o-n;return s[0]=2*n/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/c,s[6]=0,s[7]=0,s[8]=(t+e)/a,s[9]=(r+i)/c,s[10]=-(o+n)/l,s[11]=-1,s[12]=0,s[13]=0,s[14]=-o*n*2/l,s[15]=0,s},perspective:function(e,t,i,r,n){var o=i*Math.tan(e*Math.PI/360),s=o*t;return f.frustum(-s,s,-o,o,i,r,n)},ortho:function(e,t,i,r,n,o,s){s||(s=f.create());var a=t-e,c=r-i,l=o-n;return s[0]=2/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/c,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/l,s[11]=0,s[12]=-(e+t)/a,s[13]=-(r+i)/c,s[14]=-(o+n)/l,s[15]=1,s},lookAt:function(e,t,i,r){r||(r=f.create());var n,o,s,a,c,l,u,h,d,p,g=e[0],m=e[1],y=e[2],v=i[0],E=i[1],I=i[2],T=t[0],S=t[1],P=t[2];return g===T&&m===S&&y===P?f.identity(r):(u=g-T,h=m-S,d=y-P,n=E*(d*=p=1/Math.sqrt(u*u+h*h+d*d))-I*(h*=p),o=I*(u*=p)-v*d,s=v*h-E*u,(p=Math.sqrt(n*n+o*o+s*s))?(n*=p=1/p,o*=p,s*=p):(n=0,o=0,s=0),a=h*s-d*o,c=d*n-u*s,l=u*o-h*n,(p=Math.sqrt(a*a+c*c+l*l))?(a*=p=1/p,c*=p,l*=p):(a=0,c=0,l=0),r[0]=n,r[1]=a,r[2]=u,r[3]=0,r[4]=o,r[5]=c,r[6]=h,r[7]=0,r[8]=s,r[9]=l,r[10]=d,r[11]=0,r[12]=-(n*g+o*m+s*y),r[13]=-(a*g+c*m+l*y),r[14]=-(u*g+h*m+d*y),r[15]=1,r)},fromRotationTranslation:function(e,t,i){i||(i=f.create());var r=e[0],n=e[1],o=e[2],s=e[3],a=r+r,c=n+n,l=o+o,u=r*a,h=r*c,d=r*l,p=n*c,g=n*l,m=o*l,y=s*a,v=s*c,E=s*l;return i[0]=1-(p+m),i[1]=h+E,i[2]=d-v,i[3]=0,i[4]=h-E,i[5]=1-(u+m),i[6]=g+y,i[7]=0,i[8]=d+v,i[9]=g-y,i[10]=1-(u+p),i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"}},m={create:function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},createFrom:function(e,t,i,n){var o=new r(4);return o[0]=e,o[1]=t,o[2]=i,o[3]=n,o},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},equal:function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t&&Math.abs(e[3]-i[3])<t},identity:function(e){return e||(e=m.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}},y=m.identity();m.calculateW=function(e,t){var i=e[0],r=e[1],n=e[2];return t&&e!==t?(t[0]=i,t[1]=r,t[2]=n,t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t):(e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e)},m.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},m.inverse=function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*i+r*r+n*n+o*o,a=s?1/s:0;return t&&e!==t?(t[0]=-e[0]*a,t[1]=-e[1]*a,t[2]=-e[2]*a,t[3]=e[3]*a,t):(e[0]*=-a,e[1]*=-a,e[2]*=-a,e[3]*=a,e)},m.conjugate=function(e,t){return t&&e!==t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},m.length=function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)},m.normalize=function(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=e[3],s=Math.sqrt(i*i+r*r+n*n+o*o);return 0===s?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(s=1/s,t[0]=i*s,t[1]=r*s,t[2]=n*s,t[3]=o*s,t)},m.add=function(e,t,i){return i&&e!==i?(i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e)},m.multiply=function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=t[0],c=t[1],l=t[2],u=t[3];return i[0]=r*u+s*a+n*l-o*c,i[1]=n*u+s*c+o*a-r*l,i[2]=o*u+s*l+r*c-n*a,i[3]=s*u-r*a-n*c-o*l,i},m.multiplyVec3=function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2],s=e[0],a=e[1],c=e[2],l=e[3],u=l*r+a*o-c*n,h=l*n+c*r-s*o,d=l*o+s*n-a*r,p=-s*r-a*n-c*o;return i[0]=u*l+p*-s+h*-c-d*-a,i[1]=h*l+p*-a+d*-s-u*-c,i[2]=d*l+p*-c+u*-a-h*-s,i},m.scale=function(e,t,i){return i&&e!==i?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i):(e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e)},m.toMat3=function(e,t){t||(t=g.create());var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,c=n+n,l=i*s,u=i*a,h=i*c,d=r*a,p=r*c,f=n*c,m=o*s,y=o*a,v=o*c;return t[0]=1-(d+f),t[1]=u+v,t[2]=h-y,t[3]=u-v,t[4]=1-(l+f),t[5]=p+m,t[6]=h+y,t[7]=p-m,t[8]=1-(l+d),t},m.toMat4=function(e,t){t||(t=f.create());var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,c=n+n,l=i*s,u=i*a,h=i*c,d=r*a,p=r*c,g=n*c,m=o*s,y=o*a,v=o*c;return t[0]=1-(d+g),t[1]=u+v,t[2]=h-y,t[3]=0,t[4]=u-v,t[5]=1-(l+g),t[6]=p+m,t[7]=0,t[8]=h+y,t[9]=p-m,t[10]=1-(l+d),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},m.slerp=function(e,t,i,r){r||(r=e);var n,o,s,a,c=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];return Math.abs(c)>=1?(r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),r):(n=Math.acos(c),o=Math.sqrt(1-c*c),Math.abs(o)<.001?(r[0]=.5*e[0]+.5*t[0],r[1]=.5*e[1]+.5*t[1],r[2]=.5*e[2]+.5*t[2],r[3]=.5*e[3]+.5*t[3],r):(s=Math.sin((1-i)*n)/o,a=Math.sin(i*n)/o,r[0]=e[0]*s+t[0]*a,r[1]=e[1]*s+t[1]*a,r[2]=e[2]*s+t[2]*a,r[3]=e[3]*s+t[3]*a,r))},m.fromRotationMatrix=function(e,t){t||(t=m.create());var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[7]-e[5])*i,t[1]=(e[2]-e[6])*i,t[2]=(e[3]-e[1])*i;else{var n=m.fromRotationMatrix.s_iNext=m.fromRotationMatrix.s_iNext||[1,2,0],o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var s=n[o],a=n[s];i=Math.sqrt(e[3*o+o]-e[3*s+s]-e[3*a+a]+1),t[o]=.5*i,i=.5/i,t[3]=(e[3*a+s]-e[3*s+a])*i,t[s]=(e[3*s+o]+e[3*o+s])*i,t[a]=(e[3*a+o]+e[3*o+a])*i}return t},g.toQuat4=m.fromRotationMatrix,p=g.create(),m.fromAxes=function(e,t,i,r){return p[0]=t[0],p[3]=t[1],p[6]=t[2],p[1]=i[0],p[4]=i[1],p[7]=i[2],p[2]=e[0],p[5]=e[1],p[8]=e[2],m.fromRotationMatrix(p,r)},m.identity=function(e){return e||(e=m.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},m.fromAngleAxis=function(e,t,i){i||(i=m.create());var r=.5*e,n=Math.sin(r);return i[3]=Math.cos(r),i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i},m.toAngleAxis=function(e,t){t||(t=e);var r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){t[3]=2*Math.acos(e[3]);var n=i.invsqrt(r);t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}else t[3]=0,t[0]=1,t[1]=0,t[2]=0;return t},m.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var v={create:function(e){var t=new r(2);return e?(t[0]=e[0],t[1]=e[1]):(t[0]=0,t[1]=0),t},createFrom:function(e,t){var i=new r(2);return i[0]=e,i[1]=t,i},add:function(e,t,i){return i||(i=t),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i},subtract:function(e,t,i){return i||(i=t),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i},multiply:function(e,t,i){return i||(i=t),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i},divide:function(e,t,i){return i||(i=t),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i},scale:function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i},dist:function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)},set:function(e,t){return t[0]=e[0],t[1]=e[1],t},equal:function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t},negate:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t},normalize:function(e,t){t||(t=e);var i=e[0]*e[0]+e[1]*e[1];return i>0?(i=Math.sqrt(i),t[0]=e[0]/i,t[1]=e[1]/i):t[0]=t[1]=0,t},cross:function(e,t,i){var r=e[0]*t[1]-e[1]*t[0];return i?(i[0]=i[1]=0,i[2]=r,i):r},length:function(e){var t=e[0],i=e[1];return Math.sqrt(t*t+i*i)},squaredLength:function(e){var t=e[0],i=e[1];return t*t+i*i},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},direction:function(e,t,i){i||(i=e);var r=e[0]-t[0],n=e[1]-t[1],o=r*r+n*n;return o?(o=1/Math.sqrt(o),i[0]=r*o,i[1]=n*o,i):(i[0]=0,i[1]=0,i[2]=0,i)},lerp:function(e,t,i,r){return r||(r=e),r[0]=e[0]+i*(t[0]-e[0]),r[1]=e[1]+i*(t[1]-e[1]),r},str:function(e){return"["+e[0]+", "+e[1]+"]"},distanceSquared:function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}},E={create:function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},createFrom:function(e,t,i,n){var o=new r(4);return o[0]=e,o[1]=t,o[2]=i,o[3]=n,o},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},equal:function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t&&Math.abs(e[3]-i[3])<t},identity:function(e){return e||(e=E.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},transpose:function(e,t){if(!t||e===t){var i=e[1];return e[1]=e[2],e[2]=i,e}return t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},inverse:function(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=e[3],s=i*o-n*r;return s?(s=1/s,t[0]=o*s,t[1]=-r*s,t[2]=-n*s,t[3]=i*s,t):null},multiply:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3];return i[0]=r*t[0]+n*t[2],i[1]=r*t[1]+n*t[3],i[2]=o*t[0]+s*t[2],i[3]=o*t[1]+s*t[3],i},rotate:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(t),c=Math.cos(t);return i[0]=r*c+n*a,i[1]=r*-a+n*c,i[2]=o*c+s*a,i[3]=o*-a+s*c,i},multiplyVec2:function(e,t,i){i||(i=t);var r=t[0],n=t[1];return i[0]=r*e[0]+n*e[1],i[1]=r*e[2]+n*e[3],i},scale:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=t[0],c=t[1];return i[0]=r*a,i[1]=n*c,i[2]=o*a,i[3]=s*c,i},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}},I={create:function(e){var t=new r(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t},createFrom:function(e,t,i,n){var o=new r(4);return o[0]=e,o[1]=t,o[2]=i,o[3]=n,o},add:function(e,t,i){return i||(i=t),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i},subtract:function(e,t,i){return i||(i=t),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i},multiply:function(e,t,i){return i||(i=t),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i},divide:function(e,t,i){return i||(i=t),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i},scale:function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},equal:function(e,i){return e===i||Math.abs(e[0]-i[0])<t&&Math.abs(e[1]-i[1])<t&&Math.abs(e[2]-i[2])<t&&Math.abs(e[3]-i[3])<t},negate:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},length:function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)},squaredLength:function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n},lerp:function(e,t,i,r){return r||(r=e),r[0]=e[0]+i*(t[0]-e[0]),r[1]=e[1]+i*(t[1]-e[1]),r[2]=e[2]+i*(t[2]-e[2]),r[3]=e[3]+i*(t[3]-e[3]),r},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},distanceSquared:function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return i*i+r*r+n*n+o*o},setXYZW:function(e,t,i,r,n){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}};return e&&(e.glMatrixArrayType=r,e.MatrixArray=r,e.setMatrixArrayType=n,e.determineMatrixArrayType=o,e.glMath=i,e.vec2=v,e.vec3=s,e.vec4=I,e.mat2=E,e.mat3=g,e.mat4=f,e.quat4=m),{glMatrixArrayType:r,MatrixArray:r,setMatrixArrayType:n,determineMatrixArrayType:o,glMath:i,vec2:v,vec3:s,vec4:I,mat2:E,mat3:g,mat4:f,quat4:m}}(i.g)},222550:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CullFace=void 0,function(e){e[e.BACK=0]="BACK",e[e.FRONT=1]="FRONT",e[e.NONE=-1]="NONE",e[e.UNSPECIFIED=-2]="UNSPECIFIED"}(t.CullFace||(t.CullFace={}))},184314:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsWebAssemblyUtils=void 0;var r=i(423902),n=i(342211),o=i(227441),s=function(e){function t(){return e.call(this,"/js/GraphicsWebAssemblyUtils.js","createGraphicsUtilsModule")||this}return(0,r.__extends)(t,e),Object.defineProperty(t,"module",{get:function(){return t.singleton||(t.singleton=new t),t.singleton},enumerable:!1,configurable:!0}),t.prototype.replaySampleMeshRefinementRoutine=function(e,t){var i=new n.Timer("GraphicsWebAssemblyUtils.replaySampleMeshRefinementRoutine"),r=this.copyFloat32ArrayToWasmHeap(e.points),s=this.copyInt32ArrayToWasmHeap(e.intIndices),a=this.copyTypedUint8ArrayToWasmHeap(t.history),c=this.module.replaySampleMeshRefinementRoutine(r,e.points.length,s,e.intIndices.length,a,t.recordCount),l=new o.BTSampleMesh;return l.points=this.copyFloat32ArrayFromWasmHeap(c.getPointsLocation(),c.getPointsSize()),l.intIndices=this.copyInt32ArrayFromWasmHeap(c.getIndicesLocation(),c.getIndicesSize()),this.free(r),this.free(s),this.free(a),c.delete(),i.report(),l},t}(i(596322).WebAssemblyModule);t.GraphicsWebAssemblyUtils=s},334538:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},884894:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},13014:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},571334:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Text2D=void 0;var r=i(423902),n=i(911748),o=i(311611),s=i(699716),a=function(e){function t(t,i,r){var n=e.call(this,t,o.HUD_SCENEGRAPH_ID)||this;return n.text=i,n.texture=null,n.material=(0,o.createTextureMaterial)(),n.nodeProperties=new o.NodeProperties({isPickable:!0,primitiveType:o.PrimitiveType.TRIANGLES,material:n.material}),n.updateWithOptions(r),n}return(0,r.__extends)(t,e),t.prototype.remove=function(){e.prototype.remove.call(this),this.texture.destroy(),this.material.destroy()},t.prototype.updateWithOptions=function(e){this.texture=(0,o.createTextureFromText)(this.viewer,this.text,e),this.material.ambientTexture=this.texture;var i=this.texture.createTexturedQuad();this.bounds=i.getBounds(),this.updateMeshIncrement("text",t.SELECTION_ID,i,this.nodeProperties),this.updatePosition()},t.prototype.positionRelativeTo=function(e,t,i){this.anchorPoint=n.vec3.create(e),this.textAttachmentSpotX=t,this.textAttachmentSpotY=i,this.updatePosition()},t.prototype.updatePosition=function(){if(this.anchorPoint){var e=o.BoundingSpot.LOW,t=this.bounds.getLocationInBox(this.textAttachmentSpotX,this.textAttachmentSpotY,e);this.setTransform(n.mat4.translate(n.mat4.identity(),n.vec3.subtract(this.anchorPoint,t,t)))}},t.prototype.getTextCenterInCanvas=function(){var e=this.bounds.createTransformedCopy(this.transform).center(),t=this.viewer.getCamera(),i=(0,s.getDevicePixelRatio)();return[e[0]/i,(t.getCanvasHeight()-e[1])/i]},t.SELECTION_ID="text",t}(o.UIElement);t.Text2D=a},177196:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionSetController=t.ActionIds=void 0;var r=i(423902),n=i(663748),o=i(194598),s=i(311611),a=i(163113);t.ActionIds={ASSEMBLY:"Assembly",PART_STUDIO:"Part Studio",SKETCH:"Sketch",UNSUPPORTED:"Default"};var c=function(e){function i(t){var i=e.call(this)||this;return i.commands={},i.spaceBallConnection=t,i}return(0,r.__extends)(i,e),i.prototype.startListeningToEvents=function(){this.listenTo((0,s.getActiveViewerEventDispatcher)(),s.SPACEMOUSE_ACTION_SET_CHANGED,this.setActiveCommandSet),this.listenTo((0,s.getActiveViewerEventDispatcher)(),s.SPACEMOUSE_COMMAND,this.executeCommand),this.listenTo((0,s.getActiveViewerEventDispatcher)(),s.SPACEMOUSE_COMMANDS_RECEIVED,this.commandSetReceived)},i.prototype.stopListeningToEvents=function(){this.stopListening()},i.prototype.setActiveCommandSet=function(e){this.spaceBallConnection.update3dcontroller({commands:{activeSet:e}})},i.prototype.commandSetReceived=function(e){for(var i=new _3Dconnexion.ActionTree,r=new _3Dconnexion.ImageCache,n=this,o=0;o<e.length;o++)for(var s=e[o],c=s.tabType,l=i.push(new _3Dconnexion.ActionSet(c,"")).push(new _3Dconnexion.Category("Action_Id_"+c,"Commands")),u=0;u<s.commands.length;u++){var h=s.commands[u],d=h.command,p="/images/"+h.icon+".svg";(h.command.indexOf("mate")>-1||h.command.indexOf("Mate")>-1)&&"mateConnector"!==h.command&&(p="/images/mate/"+h.icon+".svg",d=h.command+"_"+h.commandDetails),"load"===h.command&&(d=h.command+"_"+h.commandDetails),l.push(new _3Dconnexion.Action(d,i18n(h.toolName),"")),this.commands[d]=h,r.push(_3Dconnexion.ImageItem.fromURL(p,d))}i.push(new _3Dconnexion.ActionSet(t.ActionIds.UNSUPPORTED,"")),r.onload=function(){n.spaceBallConnection.update3dcontroller({images:r.images})};var g=t.ActionIds.UNSUPPORTED;(0,a.isInAssemblyElement)()?g=t.ActionIds.ASSEMBLY:(0,a.isInPartStudioElement)()&&(g=t.ActionIds.PART_STUDIO),this.spaceBallConnection.update3dcontroller({commands:{activeSet:g,tree:i}})},i.prototype.executeCommand=function(e){this.commands[e]&&o.btInjector.SpaceballService.executeCommand(this.commands[e])},i}(n.BackboneEventsBaseClass);t.ActionSetController=c},198861:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;var r=i(423902),n=function(){function e(){this.activeMateConnectorMap=new Map}return e.prototype.addMateConnector=function(e){e&&e.length>0&&this.activeMateConnectorMap.set(e,null)},e.prototype.removeMateConnector=function(e){if(e&&e.length>0&&this.activeMateConnectorMap.has(e)){var t=this.activeMateConnectorMap.get(e);this.activeMateConnectorMap.delete(e),t&&!t.isHidden&&t.muteIfActive()}},e.prototype.removeAllMateConnectors=function(){var e,t;try{for(var i=(0,r.__values)(this.activeMateConnectorMap.keys()),n=i.next();!n.done;n=i.next()){var o=n.value;this.removeMateConnector(o)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.resetMateConnectors=function(e){var t,i;this.removeAllMateConnectors();try{for(var n=(0,r.__values)(e),o=n.next();!o.done;o=n.next()){var s=o.value;this.addMateConnector(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}},e.prototype.isMateConnectorActive=function(e,t){var i=this.activeMateConnectorMap.has(e);return i&&!this.activeMateConnectorMap.get(e)&&this.activeMateConnectorMap.set(e,t),i},e.prototype.destroy=function(){this.removeAllMateConnectors()},e}();t.Manager=n},888590:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAngularToolPreview=t.AngularToolPreview=void 0;var r=i(423902),n=i(911748),o=i(736202),s=i(311611),a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.axisDirection=null,r.axisRoot=null,r.angle=0,r}return(0,r.__extends)(t,e),t.prototype.setAngle=function(e){this.update(null,e)},t.prototype.update=function(e,t,i,r){return!(e&&!(0,o.isEqual)(e,this.sourceIds))&&(t&&(this.angle=t),i&&(this.axisRoot=i),r&&(this.axisDirection=r),this.updateMeshes())},t.prototype.updateMeshes=function(){for(var e,t,i,r,o,a=n.quat4.fromAngleAxis(this.angle,this.axisDirection,n.quat4.create()),c=0;c<this.sourceIds.length;++c){for(e=this.sourcePrimitives[c],t=this.duplicatePrimitive(e),i=this.sourceIds[c],r=0;r<e.points.length;r+=3){var l=n.vec3.createFrom(e.points[r],e.points[r+1],e.points[r+2]);for(n.vec3.subtract(l,this.axisRoot),n.quat4.multiplyVec3(a,l),n.vec3.add(l,this.axisRoot),o=0;o<3;++o)t.points[r+o]=l[o]}t.isTriangles()?this.updateMeshIncrement(i,s.NO_SELECTION_ID,t,s.TOOL_FACE_PROPERTIES):this.updateMeshIncrement(i,s.NO_SELECTION_ID,t,s.TOOL_EDGE_PROPERTIES)}return!0},t}(s.ToolDisplay);t.AngularToolPreview=a,t.createAngularToolPreview=function(e,t,i,r,n,o){var s=new a(o,e);return s.axisRoot=r,s.axisDirection=n,s.angle=i,s.initialize(t)?s:null}},470318:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationController=void 0;var r=i(423902),n=i(311517),o=i(311611),s=i(173567),a=function(){function e(e){var t=this;this.viewer=e,this.cameraAnimationCallback=null,this.animationLoopInProgress=!1,this.animationSequenceCounter=0,this.animationSequenceStartTime=0,this.animationSequenceFrameCount=0,this.frameCallback=function(e){return t.onRequestDrawFulfilled(e)},this.ongoingAnimations=new Set,this.incrementAnimationSequence()}return e.prototype.onRequestDrawFulfilled=function(e){var t,i,a=!1;this.cameraAnimationCallback&&(this.cameraAnimationCallback(e)===s.AnimationCallbackStatus.COMPLETE?this.cameraAnimationCallback=null:a=!0);try{for(var c=(0,r.__values)(this.ongoingAnimations.values()),l=c.next();!l.done;l=c.next()){var u=l.value;u(e)===s.AnimationCallbackStatus.COMPLETE?this.ongoingAnimations.delete(u):a=!0}}catch(e){t={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(t)throw t.error}}if(a)this.viewer.setSystemIsAnimating(),this.viewer.requestDraw(this.frameCallback),++this.animationSequenceFrameCount;else if(this.animationLoopInProgress=!1,this.incrementAnimationSequence(),this.viewer.setSuppressMouseMovePick(!1),this.viewer.getInputHandler().isMouseInCanvas()&&this.viewer.doPreHighlightPick(),this.animationSequenceFrameCount>0){var h=(this.animationSequenceFrameCount/((0,o.getTimeElapsed)(this.animationSequenceStartTime)/1e3)).toFixed(1);n.log.trace("Animation completed with average framerate of "+h+" fps")}this.viewer.draw(a?e:void 0)},e.prototype.startCameraAnimation=function(e){this.haltCameraAnimation(),this.cameraAnimationCallback=e,this.startAnimationRenderLoop()},e.prototype.isCameraAnimating=function(){return!!this.cameraAnimationCallback},e.prototype.haltCameraAnimation=function(){this.cameraAnimationCallback=null},e.prototype.startAnimation=function(e){this.ongoingAnimations.add(e),this.startAnimationRenderLoop()},e.prototype.incrementAnimationSequence=function(){this.viewer.$el.attr("animation-sequence",++this.animationSequenceCounter)},e.prototype.startAnimationRenderLoop=function(){this.animationLoopInProgress||(this.viewer.setSuppressMouseMovePick(!0),this.viewer.setSystemIsAnimating(),this.viewer.requestDraw(this.frameCallback),this.animationLoopInProgress=!0,this.animationSequenceStartTime=(0,o.getTimeInMilliseconds)(),this.animationSequenceFrameCount=0)},e}();t.AnimationController=a},17037:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyIsolateManager=void 0;var r=i(423902),n=i(129346),o=i(784167),s=i(311611),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.setUpListeners=function(){e.prototype.setUpListeners.call(this),this.listenTo((0,o.getCommandDispatcher)(),n.commands.EXIT_ISOLATE,this.clearEffectExit),this.listenTo((0,o.getCommandDispatcher)(),n.commands.ISOLATE_COMPONENTS,this.affectComponents)},t.prototype.clearIsolateNoAnimation=function(){this.clearEffectNoAnimation()},t.prototype.hasIsolatedInstances=function(){return this.hasAffectedInstances()},t.prototype.areSelectionsAlreadyIsolated=function(e){return this.areSelectionsAlreadyAffected(e)},t.prototype.areSelectionsInListAlreadyIsolated=function(e){return this.areSelectionsInListAlreadyAffected(e)},t.prototype.isInIsolateMode=function(){return this.isInEffectMode()},t.prototype.addIdsToIsolate=function(e,t){this.addIdsToAffect(e,t)},t.prototype.removeFromIsolate=function(e){this.removeFromEffect(e)},t.prototype.isolateOccurrences=function(e,t){this.affectOccurrences(e,t)},t.prototype.getIsolatedOccurrences=function(){return this.getAffectedOccurrences()},t.prototype.setIsolatedOccurrenceIds=function(e){this.setAffectedOccurrenceIds(e)},t.prototype.clearEffect=function(){this.setSeedComponentsNull(),this.setMateIsolates(this.affectedOccurrences,!1),this.setInitialAffectedOccurrences([])},t.prototype.shouldAddPreexistingOccurrences=function(){return!1},t.prototype.shouldClearOccurrenceIds=function(){return this.hasAffectedInstances()},t.prototype.resetMateIsolates=function(e){this.setMateIsolates(this.affectedOccurrences,!1),this.setMateIsolates(e,!0)},t.prototype.showDialog=function(){this.dialog?this.dialog.onAssemblyOrPartStudioDataProcessed():this.dialog=s.IsolatedManagersUtils.createIsolateDialog(this)},t.prototype.updateOccurrenceDataManager=function(){s.IsolatedManagersUtils.updateOccurrenceDataManager(this.affectedOccurrenceIds,this.viewer.getOccurrenceDataManager())},t}(s.AssemblyIsolateManagerBase);t.AssemblyIsolateManager=a},967854:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyIsolateManagerBase=void 0;var r=i(423902),n=i(129346),o=i(784167),s=i(501242),a=i(163113),c=i(712197),l=i(601759),u=i(311611),h=function(e){return e.getPathAsString()},d=function(e,t,i,r){var n={};function o(e){var t=e.trimToTopLevel();return n[t.getPathAsString()]=t,!1}for(var s in Array.isArray(e)?e.forEach(o):e&&e.each(o),n)for(var a=n[s],c=t.getOccurrencesStartingWithPath(a),l=0;l<c.length;++l){var u=c[l].getPathAsString();i.hasOwnProperty(u)||(i[u]=c[l],r[u]=c[l])}},p=function(e){function t(t){var i=e.call(this,t)||this;return i.initialAffectedOccurrences=[],i.affectedOccurrences=[],i.connectivityMap=null,i.setSeedComponentsNull(),i}return(0,r.__extends)(t,e),t.prototype.setUpListeners=function(){this.stopListening(),this.listenTo(this.viewer.getEventDispatcher(),u.ASSEMBLY_DATA_PROCESSED,this.onAssemblyDataProcessed)},t.prototype.setSeedComponentsNull=function(){this.nodeModelOrSelection=null,this.includeSelections=!1,this.initialSelectionList=null},t.prototype.onAssemblyDataProcessed=function(){this.connectivityMap=null,this.hasAffectedInstances()&&(0,a.isInAssemblyElement)()&&this.reAffectComponents(u.IsolateFlag.ASSEMBLY_DATA_UPDATE,!1)},t.prototype.setMateIsolates=function(e,t){var i=this.getModelViewManager().getDisplayedAssembly();i&&e.forEach((function(e){for(var r=i.getMateConnectorGraphicsForOccurrence(e,true),n=0;n<r.length;n++)r[n].getOccurrenceData().setIsolated(t);var o=i.getMateIndicatorsForOccurrence(e,true);for(n=0;n<o.length;n++)o[n].setIsolated(t)}))},t.prototype.affectComponents=function(e,t,i,r,n){this.viewer===r&&(i&&0!==i.length?this.reaffectSelections(i,u.IsolateFlag.INITIAL,n):(this.nodeModelOrSelection=e,this.includeSelections=t,this.reAffectComponents(u.IsolateFlag.INITIAL,n)))},t.prototype.reaffectSelections=function(e,t,i){var n=[];e.forEach((function(e){n=n.concat(e.getOccurrencesFromSelection())})),n=(0,l.unionWithoutDuplicateValues)(n,h);var o=!this.getIsOperationInProgress()&&t!==u.IsolateFlag.ASSEMBLY_DATA_UPDATE&&!s.DocumentController.getOpenDocumentController().getActiveElementController().getViewAlignmentController().isSectionViewDialogVisible();o&&(0,c.clearSelection)(),this.shouldAddPreexistingOccurrences()&&n.length>0&&(n=(0,l.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(n),!1),(0,r.__read)(this.initialAffectedOccurrences),!1),h)),this.affectOccurrences(n,t,i),o&&(0,c.clearPreSelection)()},t.prototype.reAffectComponents=function(e,t){if(this.nodeModelOrSelection||this.includeSelections){var i=this.getSelectionFromNodeModelOrSelection(this.nodeModelOrSelection),r=[];if(i&&r.push(i),this.includeSelections)e!==u.IsolateFlag.ASSEMBLY_DATA_UPDATE&&(this.initialSelectionList=(0,c.getSelectionList)().clone()),this.initialSelectionList.forEach((function(e){r.push(e)}));this.reaffectSelections(r,e,t)}},t.prototype.affectOccurrences=function(e,t,i){if(0===e.length)return(0,o.getCommandDispatcher)().trigger(n.commands.EXIT_ISOLATE,this.viewer),void(0,o.getCommandDispatcher)().trigger(n.commands.EXIT_MAKE_TRANSPARENT,this.viewer);var r=t!==u.IsolateFlag.EXPAND,s=!0;this.hasAffectedInstances()&&(s=!1),this.shouldClearOccurrenceIds()&&this.setAffectedOccurrenceIds([]),this.resetMateIsolates(e),r?this.setInitialAffectedOccurrences(e):this.setAffectedOccurrences(e),this.makeTransparent(s,i),r&&this.showDialog()},t.prototype.areSelectionsAlreadyAffected=function(e){var t=this.getSelectionFromNodeModelOrSelection(e),i=[];return(0,c.getSelectionList)().forEach((function(e){i.push(e)})),t&&i.push(t),this.areSelectionsInListAlreadyAffected(i)},t.prototype.areSelectionsInListAlreadyAffected=function(e){if((0,a.isInAssemblyElement)()){var t=[];e.forEach((function(e){t=t.concat(e.getOccurrencesFromSelection())}));var i=(0,l.unionWithoutDuplicateValues)(t,h);return(0,l.hasEquivalentValues)(i,this.initialAffectedOccurrences,(function(e){return e.toString()}))}return!1},t.prototype.setInitialAffectedOccurrences=function(e){this.initialAffectedOccurrences=e,this.centersOfInitialAffectedInstances=null,this.setAffectedOccurrences(e)},t.prototype.setAffectedOccurrences=function(e){this.affectedOccurrences=e,this.setAffectedOccurrenceIdsFromOccurrences(e)},t.prototype.setAffectedOccurrenceIdsFromOccurrences=function(e){var t=this,i=0===e.length?[]:e.map((function(e){return t.viewer.getIdForOccurrence(e)}));this.setAffectedOccurrenceIds(i)},t.prototype.expandEffectByProximity=function(e){var t=this.getAffectedOccurrencesForExpandEffectByProximity(e);t&&this.affectOccurrences(t,u.IsolateFlag.EXPAND,!1)},t.prototype.updateCentersOfInitialAffectedInstances=function(){if(!this.centersOfInitialAffectedInstances){var e=this.getModelViewManager(),t=this.initialAffectedOccurrences.map((function(t){var i=e.getOccurrenceBounds(t);return i?i.center():null}),this);this.centersOfInitialAffectedInstances=t.filter(l.isDefined,this)}},t.prototype.expandEffectByConnectivity=function(e){var t=this.getAffectedOccurrencesForExpandEffectByConnectivity(e);this.affectOccurrences(t,u.IsolateFlag.EXPAND,!1)},t.prototype.getAffectedOccurrencesForExpandEffectByConnectivity=function(e){if(-1===e)return this.initialAffectedOccurrences;var t=this.getModelViewManager(),i={},r={};if(d(this.initialAffectedOccurrences,t,i,r),Object.keys(r).length===this.initialAffectedOccurrences.length&&(e+=1),e>=1){var n=t.getDisplayedAssembly();if(n){this.connectivityMap||(this.connectivityMap=n.getMateIndicatorConnectivityMap());for(var o=1;o<=e;o++){var s=r;for(var a in r={},s){var c=s[a],l=this.connectivityMap.get(c.getPathAsString());d(l,t,i,r)}}}}return Object.values(i)},t.prototype.initialAffectedOccurrencesHaveConnectedOccurrences=function(){return this.getAffectedOccurrencesForExpandEffectByConnectivity(0).length>this.initialAffectedOccurrences.length},t.prototype.getAffectedOccurrencesForExpandEffectByProximity=function(e){if(0===e)return this.initialAffectedOccurrences;var t=this.getModelViewManager().getDisplayedAssembly();if(t){var i=Object.values(t.occurrences).map((function(e){return e.occurrenceData.occurrence}));this.updateCentersOfInitialAffectedInstances();var n=e*e,o=i.filter((function(e){return this.isWithinDistanceOfAnInitialAffectedOccurrence(n,e)}),this);return(0,l.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(o),!1),(0,r.__read)(this.initialAffectedOccurrences),!1),h)}return null},t.prototype.getIsOperationInProgress=function(){var e=a.DocumentModel.getOpenDocumentActiveElement();return!!s.DocumentController.getActiveFeatureController()||e&&e.get("isOperationInProgress")},t.prototype.getAffectedOccurrences=function(){return this.affectedOccurrences},t}(u.IsolatedManagerBase);t.AssemblyIsolateManagerBase=p},201823:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyMakeTransparentManager=void 0;var r=i(423902),n=i(438849),o=i(129346),s=i(784167),a=i(311611),c=function(e){function t(t,i,r,n,o,s){var a=e.call(this,t)||this;return a.isolatedOccurrencesManager=i,a.affectComponents(r,o,n,s),a}return(0,r.__extends)(t,e),t.prototype.getTransparentOccurrences=function(){return this.getAffectedOccurrences()},t.prototype.areSelectionsAlreadyTransparent=function(e){return this.areSelectionsAlreadyAffected(e)},t.prototype.areSelectionsInListAlreadyTransparent=function(e){return this.areSelectionsInListAlreadyAffected(e)},t.prototype.hasTransparentInstances=function(){return this.hasAffectedInstances()},t.prototype.clearTransparentNoAnimation=function(){this.clearEffectNoAnimation()},t.prototype.setUpListeners=function(){e.prototype.setUpListeners.call(this),this.listenTo((0,s.getCommandDispatcher)(),o.commands.MAKE_TRANSPARENT_COMPONENTS,this.affectComponents),this.listenTo((0,s.getCommandDispatcher)(),o.commands.EXIT_MAKE_TRANSPARENT,this.clearEffectExit)},t.prototype.showDialog=function(){if(this.dialog)this.dialog.onAssemblyOrPartStudioDataProcessed();else{var e={isolateManager:this};this.dialog=new n.MakeTransparentDialog(e)}},t.prototype.clearEffect=function(){this.viewer.getOccurrenceDataManager().clearIsolation(),this.isolatedOccurrencesManager.removeMakeTransparentManager()},t.prototype.updateOccurrenceDataManager=function(){var e=this;0===this.affectedOccurrenceIds.length?this.viewer.getOccurrenceDataManager().isolateAll():this.affectedOccurrenceIds.forEach((function(t){t!==a.INVALID_OCCURRENCE_ID&&e.viewer.getOccurrenceDataManager().setOccurrenceIsolated(t,!1)}))},t.prototype.shouldAddPreexistingOccurrences=function(){return!0},t.prototype.shouldClearOccurrenceIds=function(){return!0},t.prototype.resetMateIsolates=function(e){this.setMateIsolates(this.affectedOccurrences,!0),this.setMateIsolates(e,!1)},t}(a.AssemblyIsolateManagerBase);t.AssemblyMakeTransparentManager=c},105089:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Axes=t.AxisLabel=t.AXES_ID=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(311611),a=n.default.getManager(),c=new s.NodeProperties({isShowThrough:!0,isPickable:!1,primitiveType:s.PrimitiveType.LINES}),l=[1,0,0],u=[0,1,0],h=[0,0,1],d=new s.NodeProperties({isPickable:!1,primitiveType:s.PrimitiveType.TRIANGLES,material:null}),p=(0,s.toRadians)(a.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_START_ANGLE")),g=(0,s.toRadians)(a.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_END_ANGLE"));t.AXES_ID="axes3D";var f="axis_label",m=function(e){function t(t,i,r,n,o){var a=e.call(this,o,s.HUD_SCENEGRAPH_ID)||this;return a.label=t,a.direction=i,a.color=r,a.axisLength=n,a.transformedDirection=null,a.labelTexture=null,a.position=null,a.lastSetOpacity=-1,a.nodeProperties=new s.NodeProperties(d),a.nodeProperties.material=(0,s.createTextureMaterial)(),a.nodeProperties.updateId(),a.ensureTexture(),a.show(),a}return(0,r.__extends)(t,e),t.prototype.onDevicePixelRatioChanged=function(e){this.labelTexture=null,this.ensureTexture(),this.updateIncrements()},t.prototype.remove=function(){this.labelTexture&&(this.labelTexture.destroy(),this.labelTexture=null),this.nodeProperties.material&&(this.nodeProperties.material.destroy(),this.nodeProperties.material=null),e.prototype.remove.call(this)},t.prototype.updateIncrements=function(){var e=a.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX"),t=this.labelTexture.filledWidthPx,i=(0,s.createQuad)([-t/2,-e/2,0],[t/2,-e/2,0],[-t/2,e/2,0],void 0,[this.labelTexture.leftCoordinate,this.labelTexture.bottomCoordinate],[this.labelTexture.rightCoordinate,this.labelTexture.topCoordinate]);this.updateMeshIncrement(f,s.NO_SELECTION_ID,i,this.nodeProperties)},t.prototype.ensureTexture=function(){this.viewer.getGlContext()&&(this.labelTexture||(this.labelTexture=(0,s.createTextureFromText)(this.viewer,this.label,{color:this.color,font:a.getString("VIEW_CUBE_TEXT_FONT"),size:a.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX")}),this.nodeProperties.material.ambientTexture=this.labelTexture,this.updateIncrements()))},t.prototype.updateTransform=function(e){if(this.position&&this.transformedDirection){var t=Math.acos(Math.abs(o.vec3.dot(e.getForward(),this.transformedDirection))),i=(0,s.smoothstep)(g,p,t);this.setOpacity(i),this.setTransform(o.mat4.translate(o.mat4.identity(),this.position))}},t.prototype.setOpacity=function(e){if(e!==this.lastSetOpacity){var t=new Uint8Array([255,255,255,255*e]);this.updateIncrementAttribute(f,s.Attributes.COLOR,t),this.lastSetOpacity=e}},t}(s.UIElement);t.AxisLabel=m;var y=function(e){function i(i,r){var n=e.call(this,i)||this;n.coordinateSystemTransform=null,n.axisLabels={},n.setId(t.AXES_ID),n.highlightId=s.NO_SELECTION_ID,r=r||{},n.axesName=r.hasOwnProperty("axesName")?r.axesName:null,n.hasXAxis=!r.hasOwnProperty("hasXAxis")||r.hasXAxis,n.hasYAxis=!r.hasOwnProperty("hasYAxis")||r.hasYAxis,n.hasZAxis=!r.hasOwnProperty("hasZAxis")||r.hasZAxis,n.XAxisColor=r.hasOwnProperty("XAxisColor")?r.XAxisColor:a.getColor("X_AXIS_COLOR"),n.YAxisColor=r.hasOwnProperty("YAxisColor")?r.YAxisColor:a.getColor("Y_AXIS_COLOR"),n.ZAxisColor=r.hasOwnProperty("ZAxisColor")?r.ZAxisColor:a.getColor("Z_AXIS_COLOR");var o=a.getNumber("AXIS_LINE_WIDTH_PX");n.XAxisWidth=r.hasOwnProperty("XAxisWidth")?r.XAxisWidth:o,n.YAxisWidth=r.hasOwnProperty("YAxisWidth")?r.YAxisWidth:o,n.ZAxisWidth=r.hasOwnProperty("ZAxisWidth")?r.ZAxisWidth:o;var c=a.getNumber("AXIS_LINE_LENGTH_PX");return n.XAxisStartEndPixel=r.hasOwnProperty("XAxisStartEndPixel")?r.XAxisStartEndPixel:[0,c],n.YAxisStartEndPixel=r.hasOwnProperty("YAxisStartEndPixel")?r.YAxisStartEndPixel:[0,c],n.ZAxisStartEndPixel=r.hasOwnProperty("ZAxisStartEndPixel")?r.ZAxisStartEndPixel:[0,c],n.hasXAxis&&(n.axisLabels.X=new m("X",l,a.getColor("X_AXIS_COLOR"),n.XAxisStartEndPixel[1],n.viewer)),n.hasYAxis&&(n.axisLabels.Y=new m("Y",u,a.getColor("Y_AXIS_COLOR"),n.YAxisStartEndPixel[1],n.viewer)),n.hasZAxis&&(n.axisLabels.Z=new m("Z",h,a.getColor("Z_AXIS_COLOR"),n.ZAxisStartEndPixel[1],n.viewer)),n.ensureTexture(),n.listenTo(n.viewer.getEventDispatcher(),s.VIEW_WILL_DRAW,n.onViewWillDraw),n}return(0,r.__extends)(i,e),i.prototype.onViewWillDraw=function(e,t){if(this.updateGraphics(e),this.coordinateSystemTransform)for(var i in this.axisLabels){var r=this.axisLabels[i],n=r.axisLength+a.getNumber("AXIS_LABEL_OFFSET_PX"),s=o.vec3.scale(this.axisLabels[i].direction,n,o.vec3.create()),c=o.mat4.multiplyVec4(this.transform,o.vec4.createFrom(s[0],s[1],s[2],1),o.vec4.create()),l=e.projectWorldPointToViewport(c);r.position=l;var u=o.vec4.createFrom(r.direction[0],r.direction[1],r.direction[2],0);o.mat4.multiplyVec4(this.transform,u,o.vec4.create());r.transformedDirection||(r.transformedDirection=o.vec4.create()),o.vec3.set(r.direction,r.transformedDirection),r.transformedDirection[3]=0,o.mat4.multiplyVec4(this.transform,r.transformedDirection),o.vec3.normalize(r.transformedDirection),r.updateTransform(e)}},i.prototype.addAxis=function(e,t,i,r,n){var a=o.vec3.scale(t,n[0],o.vec3.create()),l=o.vec3.scale(t,n[1],o.vec3.create()),u=(0,s.createLine)(a,l);(0,s.addSizeToIncrement)(r,u),(0,s.addColorToIncrement)(i,u),this.updateMeshIncrement(e,s.NO_SELECTION_ID,u,c)},i.prototype.updateGraphics=function(e){if(null!==this.coordinateSystemTransform){!this.hasMeshIncrements()&&this.coordinateSystemTransform&&(this.hasXAxis&&this.addAxis("X_AXIS",l,this.XAxisColor,this.XAxisWidth,this.XAxisStartEndPixel),this.hasYAxis&&this.addAxis("Y_AXIS",u,this.YAxisColor,this.YAxisWidth,this.YAxisStartEndPixel),this.hasZAxis&&this.addAxis("Z_AXIS",h,this.ZAxisColor,this.ZAxisWidth,this.ZAxisStartEndPixel));var t=o.vec3.createFrom(this.coordinateSystemTransform[12],this.coordinateSystemTransform[13],this.coordinateSystemTransform[14]),i=e.getPixelSizeAtWorldPoint(t),r=o.vec3.createFrom(i,i,i),n=o.mat4.scale(this.coordinateSystemTransform,r,o.mat4.create());this.setTransform(n)}},i.prototype.updateDefinition=function(e){this.coordinateSystemTransform=e},i.prototype.hide=function(){this.hasXAxis&&this.axisLabels.X.hide(),this.hasYAxis&&this.axisLabels.Y.hide(),this.hasZAxis&&this.axisLabels.Z.hide(),e.prototype.hide.call(this)},i.prototype.show=function(){this.hasXAxis&&this.axisLabels.X.show(),this.hasYAxis&&this.axisLabels.Y.show(),this.hasZAxis&&this.axisLabels.Z.show(),e.prototype.show.call(this)},i.prototype.ensureTexture=function(){for(var e in this.axisLabels)this.axisLabels[e].ensureTexture()},i.prototype.remove=function(){for(var t in this.axisLabels)this.axisLabels[t].remove();e.prototype.remove.call(this)},i}(s.UIElement);t.Axes=y},881183:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.BoxSelector=t.setBoxSelectionEnabled=t.SELECTION_ID=void 0;var n=i(423902),o=i(73055),s=i(311611),a=i(194598),c=i(402197),l=i(712197),u=i(182010);t.SELECTION_ID="box";var h=o.default.getManager(),d=!0;t.setBoxSelectionEnabled=function(e){d=e};var p=new s.NodeProperties({isPickable:!1,primitiveType:s.PrimitiveType.LINES}),g=new s.NodeProperties({isPickable:!1,primitiveType:s.PrimitiveType.TRIANGLES,primitivesHaveTransparency:!0,material:s.UNLIT_COLOR_FROM_ATTRIBUTE}),f=function(e){function i(i){var r=e.call(this,i,s.HUD_SCENEGRAPH_ID)||this;return r.mouseDown=[0,0],r.lastMouse=[0,0],r.canceled=!1,r.zoomCursorOnStack=!1,r.zoomTriggeredByMenu=!1,r.zoomModifier=!1,r.dragging=!1,r.listeningToKeyDispatcher=!1,r.listeningToOutsideClick=!1,r.mouseOnCanvas=!0,r.messageBubble=a.btInjector.MessageBubbleService.createMessageBubble(),r.listenTo(r,s.UiEvents.DRAG_START+t.SELECTION_ID,r.onDragStart),r.listenTo(r,s.UiEvents.DRAG+t.SELECTION_ID,r.onDrag),r.listenTo(r,s.UiEvents.DRAG_STOP+t.SELECTION_ID,r.onDragStop),r.listenTo((0,s.getZoomToWindowState)(),"change:zoomModeEnabled",r.onZoomModeChange),r}return(0,n.__extends)(i,e),i.prototype.getPositionFromEvent=function(e){return[e.mouseX,e.camera.getViewportHeight()-e.mouseY]},i.prototype.performContainmentSelection=function(){return this.lastMouse[0]>this.mouseDown[0]},i.prototype.left=function(){return Math.min(this.lastMouse[0],this.mouseDown[0])},i.prototype.right=function(){return Math.max(this.lastMouse[0],this.mouseDown[0])},i.prototype.bottom=function(){return Math.min(this.lastMouse[1],this.mouseDown[1])},i.prototype.top=function(){return Math.max(this.lastMouse[1],this.mouseDown[1])},i.prototype.onDragStart=function(e,t,i){this.viewer.getSuppressModelSelection()?this.canceled=!0:(this.lastMouse=this.mouseDown=this.getPositionFromEvent(t),this.updateGraphics(),i.requestDrag=!0,this.canceled=!1,this.dragging=!0,this.listenToKeyDispatcher(),(0,s.requestDraw)())},i.prototype.onDrag=function(e,t){this.canceled||(this.lastMouse=this.getPositionFromEvent(t),this.updateGraphics(),(0,s.requestDraw)())},i.prototype.onDragStop=function(e,t){if(!this.canceled){this.dragging=!1;var i=this.right()-this.left(),r=this.top()-this.bottom(),n=t.camera.getViewportHeight()-this.top();if(this.zoomIsEnabled())(0,s.setZoomModeEnabled)(!1),this.viewer.animateZoomToRectangle(this.left(),n,i,r),this.removeMeshIncrements(),this.stopListeningToKeyDispatcher(),this.tearDownOutsideClickListeners();else{var o=this.viewer.performBoxSelection(this.left(),n,i,r,this.performContainmentSelection()),a=this;o?o.then((function(){a.removeMeshIncrements(),a.stopListeningToKeyDispatcher()})):(a.removeMeshIncrements(),this.stopListeningToKeyDispatcher())}}},i.prototype.onKeyDown=function(e){e.which===c.Keys.CANCEL&&this.cancelSelection()},i.prototype.outsideClickHandler=function(e){!this.mouseOnCanvas&&e&&e.target&&(0,s.setZoomModeEnabled)(!1)},i.prototype.setupOutsideClickListeners=function(){this.listeningToOutsideClick||(this.mouseOnCanvas=!0,r(document).on("click.boxSelector",this.outsideClickHandler.bind(this)),this.listenTo(this.viewer.getEventDispatcher(),s.CANVAS_MOUSEENTER,this.onMouseEnter),this.listenTo(this.viewer.getEventDispatcher(),s.CANVAS_MOUSELEAVE,this.onMouseLeave),this.listeningToOutsideClick=!0)},i.prototype.onMouseEnter=function(e){this.mouseOnCanvas=!0},i.prototype.onMouseLeave=function(e){this.mouseOnCanvas=!1},i.prototype.tearDownOutsideClickListeners=function(){this.listeningToOutsideClick&&(r(document).off("click.boxSelector"),this.listeningToOutsideClick=!1)},i.prototype.listenToKeyDispatcher=function(){this.listeningToKeyDispatcher||(this.listenTo((0,u.getDispatcher)(),u.Events.KEYDOWN,this.onKeyDown),this.listeningToKeyDispatcher=!0)},i.prototype.stopListeningToKeyDispatcher=function(){this.listeningToKeyDispatcher&&(this.stopListening((0,u.getDispatcher)()),this.listeningToKeyDispatcher=!1)},i.prototype.pushZoomCursor=function(){this.zoomCursorOnStack||(this.viewer.pushCursor(s.Cursor.ZOOM_IN),this.zoomCursorOnStack=!0)},i.prototype.popZoomCursor=function(){this.zoomCursorOnStack&&(this.viewer.removeTopOccurrenceOfCursor(s.Cursor.ZOOM_IN),this.zoomCursorOnStack=!1)},i.prototype.cancelSelection=function(){this.viewer.performingBoxSelection()?this.viewer.stopBoxSelection():(this.resetZoomState(),this.canceled=!0,this.removeMeshIncrements(),this.stopListeningToKeyDispatcher(),this.tearDownOutsideClickListeners()),this.dragging=!1},i.prototype.getVertex=function(e,t){return[e,t,0]},i.prototype.getBoxLineColor=function(){return this.zoomIsEnabled()?h.getColor("BOX_ZOOM_COLOR"):this.performContainmentSelection()?h.getColor("BOX_SELECT_COLOR"):h.getColor("CROSS_SELECT_COLOR")},i.prototype.getBoxStipple=function(){return this.zoomIsEnabled()?h.getStipple("BOX_ZOOM_LINE_STIPPLE"):this.performContainmentSelection()?h.getStipple("BOX_SELECT_LINE_STIPPLE"):h.getStipple("CROSS_SELECT_LINE_STIPPLE")},i.prototype.updateGraphics=function(){var e,t=(0,s.createLines)([this.getVertex(this.mouseDown[0],this.mouseDown[1]),this.getVertex(this.lastMouse[0],this.mouseDown[1]),this.getVertex(this.lastMouse[0],this.mouseDown[1]),this.getVertex(this.lastMouse[0],this.lastMouse[1]),this.getVertex(this.lastMouse[0],this.lastMouse[1]),this.getVertex(this.mouseDown[0],this.lastMouse[1]),this.getVertex(this.mouseDown[0],this.lastMouse[1]),this.getVertex(this.mouseDown[0],this.mouseDown[1])]);this.left()!==this.right()&&this.bottom()!==this.top()&&(e=(0,s.createQuad)(this.getVertex(this.left(),this.bottom()),this.getVertex(this.right(),this.bottom()),this.getVertex(this.left(),this.top())));var i=this.getBoxLineColor(),r=this.getBoxStipple();if((0,s.addColorToIncrement)(i,t),(0,s.addStyleToIncrement)(r,t),(0,s.addSizeToIncrement)(h.getNumber("BOX_SELECT_LINE_WIDTH"),t),this.updateMeshIncrement("lines",s.NO_SELECTION_ID,t,p),e){var n=i.slice(0);n[3]=h.getNumber("BOX_SELECT_INFILL_OPACITY"),(0,s.addColorToIncrement)(n,e),this.updateMeshIncrement("interior",s.NO_SELECTION_ID,e,g)}else this.removeMeshIncrement("interior")},i.prototype.triggerDragStart=function(t,i){var r=!!(0,l.getSelectionFocus)()&&(0,l.getSelectionFocus)().getIsAQueryList()&&1===(0,l.getMaximumNumberOfSelections)();return!!(this.zoomIsEnabled()||d&&!r)&&e.prototype.triggerDragStart.call(this,t,i)},i.prototype.zoomIsEnabled=function(){return(0,s.getZoomModeEnabled)()},i.prototype.startZoom=function(){this.pushZoomCursor()},i.prototype.stopZoom=function(){this.popZoomCursor()},i.prototype.resetZoomState=function(){(0,s.setZoomModeEnabled)(!1)},i.prototype.showZoomMessage=function(){this.messageBubble.showMessage(i18n("Drag to create zoom bounding box"))},i.prototype.dismissZoomMessage=function(){this.messageBubble.dismissMessage()},i.prototype.onZoomModeChange=function(){this.zoomIsEnabled()?(this.startZoom(),this.listenToKeyDispatcher(),this.setupOutsideClickListeners(),this.dragging?this.updateGraphics():this.showZoomMessage()):(this.dragging&&this.updateGraphics(),this.stopListeningToKeyDispatcher(),this.stopZoom(),this.tearDownOutsideClickListeners(),this.dismissZoomMessage())},i}(s.UIElement);t.BoxSelector=f},825039:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHudLayerDepthRange=t.OrthographicCamera=t.PerspectiveCamera=t.Camera=void 0;var r=i(423902),n=i(911748),o=i(311517),s=i(673290),a=i(311611),c=function(){function e(){this.viewport=[0,0,4,4],this.tileViewport=null,this.viewportDiagonal=0,this.canvasHeight=0,this.canvasWidth=0,this.sceneBounds=null,this.PROJECT_VEC_4=n.vec4.create(),this.TEMP_VEC4_0=n.vec4.create(),this.TEMP_VEC4_1=n.vec4.create(),this.TEMP_VEC4_2=n.vec4.create(),this.TEMP_VEC3_0=n.vec3.create(),this.TEMP_VEC3_1=n.vec3.create(),this.updateViewportDiagonal(),this.viewMatrix=n.mat4.create(),this.viewMatrixInverse=n.mat4.create(),this.projectionMatrix=n.mat4.create(),this.projectionMatrixInverse=n.mat4.create(),this.viewFrustum=new a.ViewFrustum(this.viewMatrix,this.projectionMatrix)}return e.prototype.integrityCheck=function(e){this.checkProperty("viewport",e),this.checkProperty("viewportDiagonal",e),this.checkProperty("canvasHeight",e),this.checkProperty("canvasWidth",e),this.checkProperty("viewMatrix",e),this.checkProperty("viewMatrixInverse",e),this.checkProperty("projectionMatrix",e),this.checkProperty("projectionMatrixInverse",e),this.checkProperty("eye",e),this.checkProperty("up",e),this.checkProperty("direction",e),this.checkProperty("near",e),this.checkProperty("far",e)},e.prototype.checkProperty=function(e,t){var i=this[e];(0,a.isFinite)(i)||o.log.warn(e+" was found to be non-finite in "+t+": "+i)},e.prototype.getViewFrustum=function(){return this.viewFrustum},e.prototype.toString=function(){return JSON.stringify(this,null,2)},e.prototype.isPerspective=function(){return!1},e.prototype.isOrthographic=function(){return!1},e.prototype.setViewportFromCanvasElement=function(e){var t=+e.attr("width"),i=+e.attr("height");this.setViewport([0,0,t,i]),this.setCanvasDimensions(t,i)},e.prototype.setCanvasDimensions=function(e,t){this.canvasWidth=e,this.canvasHeight=t},e.prototype.updateViewportDiagonal=function(){this.viewportDiagonal=n.vec2.length([this.viewport[2],this.viewport[3]])},e.prototype.setViewport=function(e){this.viewport=e.slice(0),this.updateViewportDiagonal(),this.updateMatrices()},e.prototype.getViewport=function(e){return this.tileViewport&&!e?[0,0,this.tileViewport[2],this.tileViewport[3]]:this.viewport},e.prototype.getTileViewport=function(){return this.tileViewport},e.prototype.getViewportDiagonal=function(){return this.viewportDiagonal},e.prototype.getEye=function(){return this.eye},e.prototype.getFrame=function(){for(var e=n.mat4.identity(n.mat4.create()),t=this.getRight(),i=0;i<3;i++)e[i]=t[i],e[i+4]=this.up[i],e[i+8]=-this.direction[i],e[i+12]=this.eye[i],e[4*i+3]=0;return e},e.prototype.setFrame=function(e){e&&16===e.length?(this.eye=[e[12],e[13],e[14]],this.direction=n.vec3.normalize([-e[8],-e[9],-e[10]]),this.up=n.vec3.normalize([e[4],e[5],e[6]]),this.updateMatrices(),this.integrityCheck("setFrame")):o.log.error("An attempt was made to update the camera with an invalid frame")},e.prototype.getDirection=function(){return this.direction},e.prototype.getFieldOfView=function(){return 0},e.prototype.setFieldOfView=function(e){},e.prototype.focalPoint=function(){return this.sceneBounds?this.sceneBounds.center():[0,0,0]},e.prototype.distanceToCenter=function(){var e=this.focalPoint();return Math.abs(n.vec3.dot(this.direction,n.vec3.subtract(e,this.eye,n.vec3.create())))},e.prototype.setSceneBounds=function(e){e.isInitialized()&&!e.isInfinite()&&(this.sceneBounds=e,this.ensureCameraIsOutsideSceneBounds(),this.updateNearFar())},e.prototype.getSceneBounds=function(){return this.sceneBounds},e.prototype.getViewMatrix=function(){return n.mat4.create(this.viewMatrix)},e.prototype.getViewMatrixInverse=function(){return n.mat4.create(this.viewMatrixInverse)},e.prototype.setTileViewport=function(e){this.tileViewport=e},e.prototype.getProjectionMatrix=function(){return this.tileViewport?n.mat4.multiply((0,a.createTileViewportMatrix)(this.tileViewport,this.viewport),this.projectionMatrix,n.mat4.create()):n.mat4.create(this.projectionMatrix)},e.prototype.getMatrices=function(e,t){for(var i=0;i<16;++i)e[i]=this.viewMatrix[i],t[i]=this.projectionMatrix[i]},e.prototype.getProjectionMatrixInverse=function(){return n.mat4.create(this.projectionMatrixInverse)},e.prototype.updateMatrixInverses=function(){var e=n.mat4.inverse(this.viewMatrix,this.viewMatrixInverse);(e=n.mat4.inverse(this.projectionMatrix,this.projectionMatrixInverse)&&e)||o.log.warn("Error updating camera matrix inverses")},e.prototype.updateNearFar=function(e){if(!e&&this.sceneBounds&&(e=this.sceneBounds.getCorners()),e&&e.length){var t,i=-1/0,r=1/0,s=n.vec3.create();for(t=0;t<e.length;t++){var a=n.vec3.dot(n.vec3.subtract(e[t],this.eye,s),this.direction);i=Math.max(i,a),r=Math.min(r,a)}if(i>=r){var c=1;this.sceneBounds&&(c=this.sceneBounds.diameter());this.near=Math.max(.01*c,r-.1*c),this.far=Math.max(c,i+.1*c)}else o.log.warn("Trying to initialize the camera with a bounds that has no extension in the view direction"),this.near=.001,this.far=2;this.updateMatrices()}},e.prototype.zoom=function(e){},e.prototype.getNearDepth=function(){return this.near},e.prototype.getFarDepth=function(){return this.far},e.prototype.rotateAbout=function(e,t,i){i||(i=this.eye);var r=n.mat4.identity(n.mat4.create());n.mat4.rotate(r,e,t),n.mat4.multiplyVec3(r,this.direction),n.mat4.multiplyVec3(r,this.up);var o=n.vec3.subtract(this.eye,i,n.vec3.create());n.mat4.multiplyVec3(r,o),n.vec3.add(i,o,this.eye),this.updateMatrices(),this.integrityCheck("rotateAbout")},e.prototype.pan=function(e){n.vec3.subtract(this.eye,e),this.updateMatrices(),this.integrityCheck("pan")},e.prototype.ensureCameraIsOutsideSceneBounds=function(){},e.prototype.getRight=function(){return n.vec3.normalize(n.vec3.cross(this.direction,this.up,n.vec3.create()))},e.prototype.getUp=function(){return this.up},e.prototype.getForward=function(){return this.direction},e.prototype.projectWorldPointToViewport=function(e){return e=n.vec4.createFrom(e[0],e[1],e[2],1),this.projectViewPoint(n.mat4.multiplyVec4(this.viewMatrix,e,n.vec4.create()))},e.prototype.projectWorldPointToCanvas=function(e){return this.viewportToCanvas(this.projectWorldPointToViewport(e))},e.prototype.viewportToCanvas=function(e){var t=n.vec3.create();t[0]=e[0]+this.getViewportLeft();var i=this.canvasHeight-(this.getViewportBottom()+this.getViewportHeight());return t[1]=i+(this.getViewportHeight()-e[1]),t[2]=e[2],t},e.prototype.viewNormalPlaneAtPoint=function(e){var t=this.getForward(),i=n.vec3.dot(t,e);return[t[0],t[1],t[2],-i]},e.prototype.projectViewPoint=function(e,t){t=t||n.vec3.create();var i=this.tileViewport?this.getProjectionMatrix():this.projectionMatrix,r=n.mat4.multiplyVec4(i,e,this.PROJECT_VEC_4);r[3]=1/r[3],r[0]*=r[3],r[1]*=r[3],r[2]*=r[3];var o=this.tileViewport?this.tileViewport:this.viewport,s=o[2],a=o[3];return t[0]=0+s*(r[0]+1)/2,t[1]=0+a*(r[1]+1)/2,t[2]=(r[2]+1)/2,t},e.prototype.viewPointToWorld=function(e){return e=n.vec4.createFrom(e[0],e[1],e[2],1),n.mat4.multiplyVec4(this.viewMatrixInverse,e,n.vec4.create())},e.prototype.getUnitSizeAtWorldPoint=function(e){var t=this.TEMP_VEC4_0;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1;var i=this.projectViewPoint(n.mat4.multiplyVec4(this.viewMatrix,t,this.TEMP_VEC4_1),this.TEMP_VEC3_0);t[0]+=this.up[0],t[1]+=this.up[1],t[2]+=this.up[2];var r=this.projectViewPoint(n.mat4.multiplyVec4(this.viewMatrix,t,this.TEMP_VEC4_2),this.TEMP_VEC3_1);return Math.abs(r[1]-i[1])},e.prototype.projectWorldDirectionToCanvas=function(e,t){var i=this.projectWorldPointToCanvas(e),r=n.vec3.add(e,t,this.TEMP_VEC3_0),o=this.projectWorldPointToCanvas(r);return n.vec2.subtract(o,i,n.vec2.create())},e.prototype.getPixelSizeAtWorldPoint=function(e){return 1/this.getUnitSizeAtWorldPoint(e)},e.prototype.isCanvasPointInView=function(e){return e[0]>=0&&e[0]<this.getViewportWidth()&&e[1]>=0&&e[1]<this.getViewportHeight()},e.prototype.getRay=function(e,t){t=this.canvasHeight-t;var i=n.vec3.unproject([e+.5,t+.5,0],this.viewMatrix,this.projectionMatrix,this.viewport),r=n.vec3.unproject([e+.5,t+.5,1],this.viewMatrix,this.projectionMatrix,this.viewport);return new a.Ray(i,n.vec3.subtract(r,i,n.vec3.create()))},e.prototype.canvasToWorld=function(e){var t=[e[0],this.canvasHeight-e[1],e[2]];return n.vec3.unproject(t,this.viewMatrix,this.projectionMatrix,this.viewport,n.vec3.create())},e.prototype.getCanvasWidth=function(){return this.canvasWidth},e.prototype.getCanvasHeight=function(){return this.canvasHeight},e.prototype.getViewportWidth=function(){return this.viewport[2]},e.prototype.getViewportHeight=function(){return this.viewport[3]},e.prototype.getViewportLeft=function(){return this.viewport[0]},e.prototype.getViewportBottom=function(){return this.viewport[1]},e.prototype.getClosestNormalView=function(e,t){if(!e)return null;var i,r,o=n.vec3.createFrom(e[0],e[1],e[2]),c=n.vec3.createFrom(e[4],e[5],e[6]),l=this.getFrame(),u=n.vec3.createFrom(l[0],l[1],l[2]),h=n.vec3.createFrom(l[4],l[5],l[6]),d=n.vec3.createFrom(l[12],l[13],l[14]),p=n.vec3.dot(u,o),g=n.vec3.dot(u,c);if(Math.abs(p)>Math.abs(g)-s.Tolerances.ZERO_LENGTH){i=n.vec3.scale(o,p<0?-1:1,n.vec3.create());var f=n.vec3.dot(h,c);r=n.vec3.scale(c,f<0?-1:1,n.vec3.create())}else{i=n.vec3.scale(c,g<0?-1:1,n.vec3.create());var m=n.vec3.dot(h,o);r=n.vec3.scale(o,m<0?-1:1,n.vec3.create())}for(var y=n.vec3.cross(i,r,n.vec3.create()),v=d,E=n.mat4.identity(),I=0;I<3;++I)E[0+I]=i[I],E[4+I]=r[I],E[8+I]=y[I],E[12+I]=v[I];if(t&&t.flipNormalIfIdentical&&(0,a.areMatricesEqual)(l,E))for(I=0;I<3;++I)E[0+I]=-i[I],E[8+I]=-y[I],E[12+I]=-v[I];return E},e.prototype.getCameraRotatedToView=function(e,t){var i=this.clone();i.setFrame(this.getClosestNormalView(e,{flipNormalIfIdentical:!0}));var r=this.projectWorldPointToCanvas(t),o=i.canvasToWorld(r);return i.pan(n.vec3.subtract(o,t)),i},e.prototype.getCameraRotatedToViewAndTranslated=function(e,t,i){var r=this.clone();r.setFrame(this.getClosestNormalView(e,{flipNormalIfIdentical:!0}));var o=this.projectWorldPointToCanvas(t),s=[i[0],i[1],o[2]],a=r.canvasToWorld(s);return r.pan(n.vec3.subtract(a,t)),r},e.prototype.canBoundsFitInViewport=function(e,t){if(!e||!e.isFinite())return!1;for(var i=new a.BoundingBox2D,r=e.getCorners(),n=0;n<r.length;++n)i.addPoint(this.projectWorldPointToViewport(r[n]));var o=i.getDimensions();return o[0]<t[2]&&o[1]<t[3]},e.prototype.doBoundsFitInViewport=function(e,t,i){if(!e||!e.isFinite()||0===i)return!1;t=t||this.viewport;for(var r=i||1,n=new a.BoundingBox2D,o=e.getCorners(),s=0;s<o.length;++s)n.addPoint(this.projectWorldPointToViewport(o[s]));var c=[t[2]*(r-1)/2,t[3]*(r-1)/2];return n.min[0]>-c[0]&&n.min[1]>-c[1]&&n.max[0]<t[2]+c[0]&&n.max[1]<t[3]+c[1]},e.prototype.canvasToModelPoint=function(e){var t=this.projectWorldPointToCanvas(n.vec3.createFrom(0,0,0));return this.canvasToWorld(n.vec3.createFrom(e[0],e[1],t[2]))},e.prototype.getUnitSizeAtWorldPointFast=function(e){return this.getUnitSizeAtWorldPoint(e)},e}();t.Camera=c;var l=function(e){function t(i){var r=e.call(this)||this;return r.MIN_SCALE=.05,r.MAX_SCALE=50,r.angle=45,r.eye=[0,0,0],r.near=1,r.far=2,r.direction=[0,0,1],r.up=[0,1,0],Object.assign(r,t.defaults(),i||{}),r.updateMatrices(),r}return(0,r.__extends)(t,e),t.defaults=function(){return{eye:[0,0,0],direction:[0,0,1],up:[0,1,0],angle:45,near:1,far:2}},t.prototype.integrityCheck=function(t){e.prototype.integrityCheck.call(this,t),this.checkProperty("angle",t)},t.prototype.equals=function(e){return e instanceof t&&(e=e,this.angle===e.angle&&(0,a.areMatricesEqual)(this.eye,e.eye)&&(0,a.areMatricesEqual)(this.direction,e.direction)&&(0,a.areMatricesEqual)(this.up,e.up))},t.prototype.isPerspective=function(){return!0},t.prototype.getFieldOfView=function(){return this.angle},t.prototype.setFieldOfView=function(e){this.angle=e,this.updateMatrices()},t.prototype.updateMatrices=function(){var e=n.vec3.add(this.direction,this.eye,n.vec3.create());n.mat4.lookAt(this.eye,e,this.up,this.viewMatrix),n.mat4.perspective(this.angle,this.viewport[2]/this.viewport[3],this.near,this.far,this.projectionMatrix),this.updateMatrixInverses(),this.viewFrustum.updateClippingPlanes(this.viewMatrix,this.projectionMatrix)},t.prototype.getDirectionToWorldPoint=function(e){return n.vec3.normalize(n.vec3.subtract(e,this.eye,n.vec3.create()))},t.prototype.getFrustum=function(){var e=Math.tan((0,a.toRadians)(.5*this.angle))*this.near,t=e*this.canvasWidth/this.canvasHeight;return[-t,t,-e,e,this.near,this.far]},t.prototype.copyTo=function(e){var t;for(t=0;t<3;++t)e.eye[t]=this.eye[t],e.direction[t]=this.direction[t],e.up[t]=this.up[t];for(e.angle=this.angle,e.near=this.near,e.far=this.far,e.sceneBounds=this.sceneBounds,e.setViewport(this.viewport),e.canvasWidth=this.canvasWidth,e.canvasHeight=this.canvasHeight,t=0;t<16;++t)e.viewMatrix[t]=this.viewMatrix[t],e.viewMatrixInverse[t]=this.viewMatrixInverse[t],e.projectionMatrix[t]=this.projectionMatrix[t]},t.prototype.copyFrom=function(e){e.isPerspective()?e.copyTo(this):e.getPerspectiveCamera().copyTo(this)},t.prototype.clone=function(){var e=new t;return this.copyTo(e),e},t.prototype.getPerspectiveCamera=function(){return this.clone()},t.prototype.getOrthographicCamera=function(){var e,t=new u;for(e=0;e<3;++e)t.eye[e]=this.eye[e],t.direction[e]=this.direction[e],t.up[e]=this.up[e];t.setViewport(this.viewport),t.sceneBounds=this.sceneBounds,t.canvasWidth=this.canvasWidth,t.canvasHeight=this.canvasHeight,t.updateNearFar(),t.correctAspectRatio(),t.updateMatrices();var i=this.getSceneBounds().center(),r=this.getUnitSizeAtWorldPoint(i),n=t.getUnitSizeAtWorldPoint(i);return t.zoom(n/r),t},t.prototype.getFrame=function(){var e,t=n.mat4.identity(n.mat4.create()),i=n.vec3.cross(this.direction,this.up,n.vec3.create()),r=this.up,o=this.direction;for(e=0;e<3;e++)t[e]=i[e],t[e+4]=r[e],t[e+8]=-o[e],t[e+12]=this.eye[e],t[4*e+3]=0;return t},t.prototype.getMinDistance=function(){return this.sceneBounds?this.sceneBounds.diameter()*this.MIN_SCALE:this.MIN_SCALE},t.prototype.getMaxDistance=function(){return this.sceneBounds?this.sceneBounds.diameter()*this.MAX_SCALE:this.MAX_SCALE},t.prototype.dollyAlong=function(e,t){if(this.sceneBounds){var i=this.getMinDistance(),r=this.getMaxDistance(),o=this.distanceToCenter(),s=n.vec3.dot(this.direction,t),a=s*e;o<i?a=Math.min(a,0):o-a<i?a=Math.max(i-o,0):o-a>r&&(a=Math.min(o-r,0)),n.vec3.add(this.eye,n.vec3.scale(t,a/s,n.vec3.create())),this.updateMatrices(),this.integrityCheck("dollyAlong")}},t.prototype.dolly=function(e){this.dollyAlong(e,this.direction)},t.prototype.zoom=function(e){var t=this.distanceToCenter();this.dolly(t-t*e)},t.prototype.getZoomToFitEyeAndPlanes=function(e,t,i){var r,o=n.vec3.cross(this.direction,this.up,n.vec3.create()),s=n.mat3.createFrom(o[0],o[1],o[2],this.up[0],this.up[1],this.up[2],-this.direction[0],-this.direction[1],-this.direction[2]),c=n.mat3.transpose(s,n.mat3.create()),l=[0,0,0],u=0;if(e((function(e){n.vec3.add(l,e),u++})),u<=0)return null;n.vec3.scale(l,1/u);var h=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0],p=n.vec3.create(),g=n.vec3.create();e((function(e){for(n.vec3.subtract(e,l,p),n.mat3.multiplyVec3(c,p,g),r=0;r<3;r++)h[r]=Math.min(h[r],g[r]),d[r]=Math.max(d[r],g[r])}));var f=n.vec3.scale(n.vec3.add(d,h,n.vec3.create()),.5);n.vec3.subtract(d,f);var m=2*d[0]/(2*d[1]),y=t[2]/t[3];if(y<m&&(d[1]*=m/y),i)for(r=0;r<3;r++)d[r]*=i;var v=d[1]/Math.tan((0,a.toRadians)(.5*this.angle)),E=n.mat3.multiplyVec3(s,f,n.vec3.create()),I=n.vec3.add(l,E,n.vec3.create());return n.vec3.add(I,n.vec3.scale(this.direction,-(v+d[2]),n.vec3.create())),{eye:I,near:v,far:v+2*d[2]}},t.prototype.zoomToFit=function(e,t,i){var r;if(e instanceof Array)r=function(t){for(var i=0;i<e.length;i++)t(e[i])};else{if(!(e instanceof Function))return;r=e}var o=this.getZoomToFitEyeAndPlanes(r,this.viewport,t);if(o){if(this.eye=o.eye,this.near=o.near,this.far=o.far,i){var s=Math.tan((0,a.toRadians)(.5*this.angle))*this.near*2/i[3],c=(.5*this.viewport[2]-(i[0]+.5*i[2]))*s,l=(.5*this.viewport[3]-(i[1]+.5*i[3]))*s,u=n.vec3.cross(this.direction,this.up,n.vec3.create());n.vec3.add(this.eye,n.vec3.scale(u,c,n.vec3.create())),n.vec3.add(this.eye,n.vec3.scale(this.up,l,n.vec3.create()));var h=this.near*(this.viewport[2]/i[2]-1),d=this.near*(this.viewport[3]/i[3]-1),p=Math.max(h,d);n.vec3.subtract(this.eye,n.vec3.scale(this.direction,p,n.vec3.create())),this.near+=p,this.far+=p}this.updateMatrices(),this.integrityCheck("zoomToFit")}},t}(c);t.PerspectiveCamera=l;var u=function(e){function t(i){var r=e.call(this)||this;return r.DEFAULT_EXTENT_RATIO=.1,r.cachedWorldToPixelSize=-1,r.left=-1,r.right=1,r.top=1,r.bottom=-1,r.near=-1,r.far=1,r.eye=[0,0,0],r.direction=[0,0,-1],r.up=[0,1,0],Object.assign(r,t.defaults(),i||{}),r.updateMatrices(),r}return(0,r.__extends)(t,e),t.defaults=function(){return{eye:[0,0,0],direction:[0,0,-1],up:[0,1,0],left:-1,right:1,top:1,bottom:-1,near:-1,far:1}},t.prototype.integrityCheck=function(t){e.prototype.integrityCheck.call(this,t),this.checkProperty("left",t),this.checkProperty("right",t),this.checkProperty("top",t),this.checkProperty("bottom",t)},t.prototype.equals=function(e){return e instanceof t&&(e=e,Math.abs(this.left-e.left)<s.Tolerances.ZERO_LENGTH&&Math.abs(this.right-e.right)<s.Tolerances.ZERO_LENGTH&&Math.abs(this.top-e.top)<s.Tolerances.ZERO_LENGTH&&Math.abs(this.bottom-e.bottom)<s.Tolerances.ZERO_LENGTH&&(0,a.areMatricesEqual)(this.eye,e.eye)&&(0,a.areMatricesEqual)(this.direction,e.direction)&&(0,a.areMatricesEqual)(this.up,e.up))},t.prototype.isOrthographic=function(){return!0},t.prototype.getUnitSizeAtWorldPointFast=function(t){return this.cachedWorldToPixelSize<0&&(this.cachedWorldToPixelSize=e.prototype.getUnitSizeAtWorldPoint.call(this,t)),this.cachedWorldToPixelSize},t.prototype.updateMatrices=function(){var e=n.vec3.add(this.direction,this.eye,n.vec3.create());n.mat4.lookAt(this.eye,e,this.up,this.viewMatrix),n.mat4.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far,this.projectionMatrix),this.updateMatrixInverses(),this.viewFrustum.updateClippingPlanes(this.viewMatrix,this.projectionMatrix),this.cachedWorldToPixelSize=-1},t.prototype.copyTo=function(e){var t;for(t=0;t<3;++t)e.eye[t]=this.eye[t],e.direction[t]=this.direction[t],e.up[t]=this.up[t];for(e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.sceneBounds=this.sceneBounds,e.setViewport(this.viewport),e.canvasWidth=this.canvasWidth,e.canvasHeight=this.canvasHeight,t=0;t<16;++t)e.viewMatrix[t]=this.viewMatrix[t],e.viewMatrixInverse[t]=this.viewMatrixInverse[t],e.projectionMatrix[t]=this.projectionMatrix[t]},t.prototype.copyFrom=function(e){e.isOrthographic()?e.copyTo(this):e.getOrthographicCamera().copyTo(this)},t.prototype.clone=function(){var e=new t;return this.copyTo(e),e},t.prototype.getOrthographicCamera=function(){return this.clone()},t.prototype.getPerspectiveCamera=function(){var e,t=new l;for(e=0;e<3;++e)t.eye[e]=this.eye[e],t.direction[e]=this.direction[e],t.up[e]=this.up[e];t.setViewport(this.viewport),t.sceneBounds=this.sceneBounds,t.canvasWidth=this.canvasWidth,t.canvasHeight=this.canvasHeight,t.updateNearFar();var i=this.getSceneBounds().center(),r=this.getUnitSizeAtWorldPoint(i),n=t.getUnitSizeAtWorldPoint(i),o=t.distanceToCenter(),s=n/r*o;return t.dolly(o-s),t.updateNearFar(),t},t.prototype.getDirectionToWorldPoint=function(e){return this.direction},t.prototype.setViewport=function(e){this.viewport=e.slice(0),this.updateViewportDiagonal(),this.correctAspectRatio(),this.updateMatrices()},t.prototype.correctAspectRatio=function(){var e,t,i=this.right-this.left,r=this.top-this.bottom,n=this.getViewportWidth(),o=this.getViewportHeight();0!==n&&0!==o&&(n<o?t=(e=i<r?1:r/i)*i*o/(r*n):e=(t=i<r?i/r:1)*r*n/(i*o),this.left*=e,this.right*=e,this.top*=t,this.bottom*=t)},t.prototype.zoom=function(e){var t=this.right-this.left,i=this.top-this.bottom;this.left=-t*e*.5,this.right=t*e*.5,this.top=i*e*.5,this.bottom=-i*e*.5,this.updateMatrices()},t.prototype.getExtents=function(){return[this.left,this.bottom,-this.far,this.right,this.top,-this.near]},t.prototype.setExtents=function(e){this.left=e[0],this.right=e[3],this.bottom=e[1],this.top=e[4],this.updateMatrices()},t.prototype.zoomPoint=function(e,t,i,r){var o=n.vec3.subtract(e,this.eye,n.vec3.create()),s=this.getRight(),a=n.vec3.dot(o,s),c=n.vec3.dot(o,this.up);n.vec3.add(this.eye,n.vec3.scale(s,-a*(i-1),n.vec3.create()),this.eye),n.vec3.add(this.eye,n.vec3.scale(this.up,-c*(i-1),n.vec3.create()),this.eye);var l=this.right-this.left,u=this.top-this.bottom;this.left=-l*i*.5,this.right=l*i*.5,this.top=u*i*.5,this.bottom=-u*i*.5,this.updateMatrices(),this.integrityCheck("zoomPoint")},t.prototype.ensureCameraIsOutsideSceneBounds=function(){if(this.sceneBounds){var e=n.vec3.dot(this.direction,this.sceneBounds.center())-n.vec3.dot(this.direction,this.eye);n.vec3.add(this.eye,n.vec3.scale(this.direction,-(.6*this.sceneBounds.diameter()-e),n.vec3.create()),this.eye),this.integrityCheck("ensureCameraIsOutsideSceneBounds")}},t.prototype.zoomToFit=function(e,t,i){var r;if(e instanceof Array)r=function(t){for(var i=0;i<e.length;i++)t(e[i])};else{if(!(e instanceof Function))return;r=e}t=t||1;var o=this.getRight(),s=this.getUp(),a=[1/0,1/0],c=[-1/0,-1/0],l=[0,0];if(r((function(e){l[0]=n.vec3.dot(o,e),l[1]=n.vec3.dot(s,e);for(var t=0;t<2;++t)l[t]<a[t]&&(a[t]=l[t]),l[t]>c[t]&&(c[t]=l[t])})),!(c[0]<a[0]||c[1]<a[1])){var u=c[0]-a[0],h=c[1]-a[1];if(0!==u||0!==h){0===u?u=h*this.DEFAULT_EXTENT_RATIO:0===h&&(h=u*this.DEFAULT_EXTENT_RATIO),this.eye=n.vec3.add(n.vec3.scale(o,.5*(a[0]+c[0]),n.vec3.create()),n.vec3.scale(s,.5*(a[1]+c[1]),n.vec3.create())),this.ensureCameraIsOutsideSceneBounds(),this.right=.5*u*t,this.top=.5*h*t;var d=this.viewport[2]/this.viewport[3];i&&(d=i[2]/i[3]);var p=this.right/this.top/d;if(p>1?this.top*=p:this.right/=p,i){var g=2*this.right/i[2],f=(.5*this.viewport[2]-(i[0]+.5*i[2]))*g,m=(.5*this.viewport[3]-(i[1]+.5*i[3]))*g;n.vec3.add(this.eye,n.vec3.scale(o,f,n.vec3.create())),n.vec3.add(this.eye,n.vec3.scale(s,m,n.vec3.create())),this.right*=this.viewport[2]/i[2],this.top*=this.viewport[3]/i[3]}this.left=-this.right,this.bottom=-this.top,this.updateMatrices(),this.integrityCheck("zoomToFit")}}},t}(c);t.OrthographicCamera=u,t.getHudLayerDepthRange=function(e){var t=Math.min(e[2],e[3]);return[-.5*t,.5*t]}},603880:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recordWebClientCapabilities=void 0;var r=i(311611),n=i(311517);t.recordWebClientCapabilities=function(e){var t,i={angleInstancedArrays:"ANGLE_instanced_arrays",extTextureFilterAnisotropic:"EXT_texture_filter_anisotropic",oesElementIndexUint:"OES_element_index_uint",oesStandardDerivatives:"OES_standard_derivatives",oesTextureFloat:"OES_texture_float",oesTextureFloatLinear:"OES_texture_float_linear",oesTextureHalfFloat:"OES_texture_half_float",oesTextureHalfFloatLinear:"OES_texture_half_float_linear",oesVertexArrayObject:"OES_vertex_array_object",compressedTextureS3tc:"WEBGL_compressed_texture_s3tc",depthTexture:"WEBGL_depth_texture",drawBuffers:"WEBGL_draw_buffers"},o={};if(e){var s=(0,r.getRendererInfo)(e);for(t in o=s?{vendor:s.glVendor,renderer:s.glRenderer}:{vendor:"unavailable",renderer:"unavailable"},i){var a=i[t];o[t]=!!e.getExtension(a)}}else for(t in n.log.warn("No gl context was available when attempting to get renderer information"),o={vendor:"unsupported",renderer:"unsupported"},i)o[t]=!1;if(o.has3dMouse=(0,r.hasSpaceballConnected)(),o.screenWidth=window.screen.width,o.screenHeight=window.screen.height,o.devicePixelRatio=window.devicePixelRatio?window.devicePixelRatio:-1,window.localStorage)try{window.localStorage.setItem("webClientCapabilities",JSON.stringify(o))}catch(e){n.log.warn("Error writing client capabilities to local storage: "+e)}}},867185:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConstructionPlaneDisplay=t.OutlineMeshId=t.PlaneMeshId=t.doesNodeContainPlaneEntities=t.PlaneProperties=t.ResizeManipulatorIds=t.compareOutlineNodeProperties=t.outlineNodeProperties=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(556329),a=i(712197),c=i(673290),l=i(227441),u=i(911748),h=o.default.getManager();t.outlineNodeProperties=new n.NodeProperties({isPickable:!0,isTwoSided:!0,isStencilWritten:!1,primitivesHaveTransparency:!0,primitiveType:n.PrimitiveType.LINES,material:n.UNLIT_COLOR_FROM_ATTRIBUTE,includedInBlend:!0}),t.compareOutlineNodeProperties=new n.NodeProperties({isPickable:!0,isTwoSided:!0,isTintedByCompare:!0,primitiveType:n.PrimitiveType.LINES,includedInBlend:!0});var d,p=u.vec3.create(),g=u.vec3.create(),f=u.vec3.create();!function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(d=t.ResizeManipulatorIds||(t.ResizeManipulatorIds={})),t.PlaneProperties=new n.NodeProperties({isPickable:!0,primitiveType:n.PrimitiveType.TRIANGLES,primitivesHaveTransparency:!0,material:n.UNLIT_COLOR_FROM_ATTRIBUTE,isTwoSided:!0,includedInBlend:!0,isTintedByCompare:!0,zOffset:o.default.getManager().getNumber("CPLANE_Z_OFFSET")}),t.doesNodeContainPlaneEntities=function(e){var i=e.getProperties().id;return i===t.PlaneProperties.id||i===t.compareOutlineNodeProperties.id||i===t.outlineNodeProperties.id},t.PlaneMeshId="quadFace",t.OutlineMeshId="outline";var m=function(e){function i(t,i,r,o,s){var a=e.call(this,s,r)||this;return a.textColor=t,a.entityId=i,a.planeId=o,a.name="",a.center=[0,0,0],a.centerOffset=[0,0,0],a.xAxis=[1,0,0],a.yAxis=[0,1,0],a.lastSetAppearance=void 0,a.node=null,a.width=0,a.height=0,a.initialWidth=0,a.initialHeight=0,a.increments={},a.lastTextScale=-1,a.textTexture=null,a.resizeManipulators={},a.usage=r===n.PREVIEW_SCENEGRAPH_ID?n.bt_graphics_Usage.PREVIEW:n.bt_graphics_Usage.BASE,a.textMaterial=(0,n.createTextureMaterial)(),a.textNodeProperties=new n.NodeProperties({isPickable:!1,isTwoSided:!0,primitiveType:n.PrimitiveType.TRIANGLES,material:a.textMaterial,includedInBlend:!0}),a.occurrenceData.setCanIsolateChange(!0),a.occurrenceData.setIsolated(!1),a}return(0,r.__extends)(i,e),i.prototype.getDebugId=function(){return"ConstructionPlaneDisplay"},i.prototype.onDevicePixelRatioChanged=function(e){this.destroyText()},i.prototype.remove=function(){this.destroyText(),this.textMaterial&&(this.textMaterial.destroy(),this.textMaterial=null),this.removeResizeManipulators(),e.prototype.remove.call(this)},i.prototype.destroyText=function(){this.textTexture&&(this.textTexture.destroy(),this.textTexture=null)},i.prototype.setName=function(e){e=(0,s.truncate)(e,32),this.name!==e&&(this.destroyText(),(0,n.requestDraw)()),this.name=e},i.prototype.updateAppearance=function(e){if(e&&e instanceof l.BTFeaturePlaneAppearance){if(this.lastSetAppearance&&this.lastSetAppearance.equals(e))return;this.lastSetAppearance=e.clone(),this.width=e.width,this.height=e.height;var t=u.vec3.normalize(u.vec3.cross(this.xAxis,this.yAxis,u.vec3.create()),u.vec3.create());this.centerOffset=u.vec3.subtract((0,n.planeToWorld)([e.xOffset,e.yOffset],this.center,t,u.vec3.normalize(this.xAxis,u.vec3.create())),this.center,u.vec3.create())}else{if(null===this.lastSetAppearance)return;this.lastSetAppearance=null,this.width=this.initialWidth,this.height=this.initialHeight,this.centerOffset=[0,0,0]}this.updateDefinition(this.name,this.center,this.xAxis,this.yAxis,!0,!0),(0,n.requestDraw)()},i.prototype.updateDefinition=function(e,t,i,r,o,s){this.name===e&&u.vec3.equal(t,this.center)&&u.vec3.equal(i,this.xAxis)&&u.vec3.equal(r,this.yAxis)||(this.destroyText(),(0,n.requestDraw)()),(0!==this.initialWidth||0!==this.initialHeight||u.vec3.equal(i,this.xAxis)||u.vec3.equal(r,this.yAxis))&&s||(this.initialWidth=2*u.vec3.length(i),this.initialHeight=2*u.vec3.length(r)),this.width>0&&this.height>0&&(i=u.vec3.scale(u.vec3.normalize(i,u.vec3.create()),this.width/2,u.vec3.create()),r=u.vec3.scale(u.vec3.normalize(r,u.vec3.create()),this.height/2,u.vec3.create())),this.setName(e),this.center=t,this.xAxis=i,this.yAxis=r,(0,n.isUsageBase)()?o&&this.updateResizeManipulators(!1):this.removeResizeManipulators(),this.updatePlaneGraphics(),this.isHidden&&this.hideIncrements()},i.prototype.updateResizeManipulators=function(e){var t=this,i=function(i,r,o){var s=u.vec3.add(t.center,t.centerOffset,u.vec3.create()),a=u.vec3.normalize(u.vec3.cross(t.xAxis,t.yAxis,u.vec3.create())),c=u.vec3.scale(t.xAxis,r,u.vec3.create()),l=u.vec3.scale(t.yAxis,o,u.vec3.create()),h=u.vec3.add(u.vec3.add(s,c,u.vec3.create()),l,u.vec3.create());t.resizeManipulators[i]?t.resizeManipulators[i].updateDefinition(h,a,c,l):e&&(t.resizeManipulators[i]=new n.ResizeManipulator(i,h,a,t,c,l,t.viewer))};i(d.TOP_LEFT,-1,1),i(d.TOP_RIGHT,1,1),i(d.BOTTOM_LEFT,-1,-1),i(d.BOTTOM_RIGHT,1,-1)},i.prototype.removeResizeManipulators=function(){for(var e in this.resizeManipulators){var t=this.resizeManipulators[e];t&&(t.cleanup(),t.remove()),this.resizeManipulators[e]=null}},i.prototype.updateText=function(e){var t=this.getTextTexture(),i=u.vec3.add(this.center,this.centerOffset,u.vec3.create()),r=u.vec3.add(i,u.vec3.scale(this.xAxis,-1,u.vec3.create()),u.vec3.create());u.vec3.add(r,this.yAxis);var o=e.getPixelSizeAtWorldPoint(this.transformPoint(r)),s=o*t.filledWidthPx,a=o*t.filledHeightPx,l=Math.min(u.vec3.length(this.xAxis)/s,u.vec3.length(this.yAxis)/a);if(l<0&&(l=0),l<1&&(s*=l,a*=l),!(Math.abs(this.lastTextScale-l)<=c.Tolerances.ZERO_LENGTH)){this.lastTextScale=l;var h=u.vec3.normalize(this.xAxis,u.vec3.create()),d=u.vec3.normalize(this.yAxis,u.vec3.create()),p=u.vec3.add(r,u.vec3.scale(d,-a,u.vec3.create()),u.vec3.create()),g=u.vec3.add(p,u.vec3.scale(h,s,u.vec3.create()),u.vec3.create()),f=u.vec3.add(p,u.vec3.scale(d,a,u.vec3.create()),u.vec3.create());this.updateMeshIncrement("quad",n.NO_SELECTION_ID,(0,n.createQuad)(p,g,f,void 0,[t.leftCoordinate,t.bottomCoordinate],[t.rightCoordinate,t.topCoordinate]),this.textNodeProperties),this.textMaterial.ambientTexture=t}},i.prototype.updatePlaneGraphics=function(){var e=u.vec3.add(this.center,this.centerOffset,u.vec3.create()),i=o.default.getManager(),r=i.getColor("CONSTRUCTION_PLANE_OUTLINE_COLOR"),s=i.getNumber("CONSTRUCTION_PLANE_OUTLINE_WIDTH"),a=(0,n.createQuadOutline)(e,this.xAxis,this.yAxis,r,s),c=(0,n.isUsageCompare)()?t.compareOutlineNodeProperties:t.outlineNodeProperties;this.updateMeshIncrement(t.OutlineMeshId,t.OutlineMeshId,a,c),this.increments[t.OutlineMeshId]=a;var l,h=u.vec3.add(u.vec3.add(e,u.vec3.scale(this.xAxis,-1,u.vec3.create()),u.vec3.create()),this.yAxis,u.vec3.create()),d=u.vec3.add(u.vec3.add(e,u.vec3.scale(this.xAxis,-1,u.vec3.create()),u.vec3.create()),u.vec3.scale(this.yAxis,-1,u.vec3.create()),u.vec3.create()),p=u.vec3.add(u.vec3.add(e,this.xAxis,u.vec3.create()),u.vec3.scale(this.yAxis,-1,u.vec3.create()),u.vec3.create()),g=(0,n.createQuad)(d,p,h);if((0,n.isUsageCompare)()){var f=u.vec3.cross(this.xAxis,this.yAxis,u.vec3.create()),m=(0,n.getBitForPlaneEquation)(this.center,f);(0,n.addPackedIntegerToIncrement)(m,g)}else{(l=i.getColor("CONSTRUCTION_PLANE_AMBIENT_COLOR").slice(0))[3]=i.getNumber("CONSTRUCTION_PLANE_OPACITY"),(0,n.addColorToIncrement)(l,g)}this.increments[t.PlaneMeshId]=g,this.updateMeshIncrement(t.PlaneMeshId,t.PlaneMeshId,g,t.PlaneProperties),this.invalidateTextGraphics()},i.prototype.getIncrement=function(e){return e&&this.increments[e]?this.increments[e].clone():this.increments[t.PlaneMeshId]?this.increments[t.PlaneMeshId].clone():null},i.prototype.getBounds=function(){for(var e=new n.BoundingBox,t=u.vec3.add(this.center,this.centerOffset,p),i=-1;i<=1;i+=2)for(var r=-1;r<=1;r+=2){var o=u.vec3.add(u.vec3.add(u.vec3.scale(this.xAxis,i,g),u.vec3.scale(this.yAxis,r,f)),t);e.addPoint(o)}return e},i.prototype.invalidateTextGraphics=function(){this.lastTextScale=-1},i.prototype.getTextTexture=function(){return this.textTexture||(this.textTexture=(0,n.createTextureFromText)(this.viewer,this.name,{color:this.textColor,font:h.getString("PLANE_TEXT_FONT"),size:h.getNumber("PLANE_TEXT_HEIGHT_PX"),paddingWithinBorder:h.getNumber("PLANE_TEXT_BACKGROUND_PADDING")}),this.invalidateTextGraphics()),this.textTexture},i.prototype.onViewWillDraw=function(e,t){this.isHidden||this.name&&this.updateText(e)},i.prototype.canPickThrough=function(){return!0},i.prototype.getModelSelection=function(e){var i=e.uiElement.getUsage(),r=(0,a.createSelectionFromDeterministicId)(this.entityId,null,i);return r&&(r.sourcePick=e.sourcePick,r.secondarySelectionData={isFromPlaneEdge:e.selectionId===t.OutlineMeshId}),r},i.prototype.getPickPriority=function(e){return e.selectionId===t.OutlineMeshId?n.PickPriority.CONSTRUCTION_PLANE_EDGE:n.PickPriority.CONSTRUCTION_PLANE},i.prototype.getUsage=function(){return this.usage},i.prototype.addHighlight=function(e){this.addHighlightToIncrement(t.OutlineMeshId,e),this.addHighlightToIncrement(t.PlaneMeshId,e),e.type!==n.HighlightType.ENTITY&&e.type!==n.HighlightType.FEATURE||!(0,n.isUsageBase)()||this.isHidden||this.updateResizeManipulators(!0),(0,n.requestDraw)()},i.prototype.removeHighlight=function(e){return this.removeHighlightFromIncrement(t.OutlineMeshId,e),this.removeHighlightFromIncrement(t.PlaneMeshId,e),e.type!==n.HighlightType.ENTITY&&e.type!==n.HighlightType.FEATURE||this.removeResizeManipulators(),(0,n.requestDraw)(),!0},i.prototype.cloneForPreview=function(e){var t=(0,n.isUsageCompare)()?"DEFAULT_PLANE_COMPARE_TEXT_COLOR":"DEFAULT_PLANE_TEXT_COLOR",r=new i(h.getColor(t),this.entityId,n.PREVIEW_SCENEGRAPH_ID,e,this.viewer);return r.width=this.width,r.height=this.height,r.centerOffset=this.centerOffset,r.setName(this.name),r.updatePlaneGraphics(),r},i.prototype.isInteractionEnabled=function(){return!1},i.prototype.getCenter=function(){return[this.center[0],this.center[1],this.center[2]]},i.prototype.getXAxis=function(){return[this.xAxis[0],this.xAxis[1],this.xAxis[2]]},i.prototype.getYAxis=function(){return[this.yAxis[0],this.yAxis[1],this.yAxis[2]]},i.prototype.getName=function(){return this.name},i}(n.UIElement);t.ConstructionPlaneDisplay=m},729499:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.CursorAppendage=void 0;var n=i(423902),o=i(663748),s=i(52383),a=i(699716),c=i(311611),l=function(e){function t(t,i){var r=e.call(this)||this;r.viewer=t,r.mouseMoveTextCallback=i;var n=r.viewer.getEventDispatcher();return r.listenTo(n,c.CANVAS_MOUSEMOVE,r.onMouseMove),r.listenTo(n,c.CANVAS_MOUSELEAVE,r.onMouseLeave),r}return(0,n.__extends)(t,e),t.prototype.destroy=function(){this.removeContainer(),this.stopListening()},t.prototype.onMouseMove=function(e){var t=this.viewer.getCanvasCoordinateFromEvent(e),i=this.mouseMoveTextCallback(t[0],t[1]);if(i){var r=(0,a.getDevicePixelRatio)(),n=[t[0]/r,t[1]/r],o=this.getContainer();o.text(i),o.css({position:"absolute",left:n[0]+25+"px",top:n[1]+"px","pointer-events":"none"})}else this.removeContainer()},t.prototype.onMouseLeave=function(e){this.removeContainer()},t.prototype.getContainer=function(){var e=r("#"+t.CONTAINER_ID);return 0===e.length&&(e=r("<div></div>").appendTo((0,s.getDialogDragContainerElement)())).attr("id",t.CONTAINER_ID),e},t.prototype.removeContainer=function(){r("#"+t.CONTAINER_ID).remove()},t.CONTAINER_ID="cursor-appendage",t}(o.BackboneEventsBaseClass);t.CursorAppendage=l},829582:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.collectGraphicsDataForHeapDump=t.TrackedGraphicsComponents=t.checkError=t.getGpuMemoryUsage=t.timeRendering=t.lastFrameTimeRendering=t.snapshotScenegraph=t.debugToPostOnLoad=t.isSceneDebuggerWindowLoaded=t.sceneDebuggerWindow=t.visualizePicks=t.visualizeDebugBox=t.visualizeDebugPoint=t.visualizeVisiblePicks=t.WEBGL_ERROR_LOG_TAG=void 0;var n=i(423902),o=i(514194),s=i(311611),a=i(73055),c=i(311517),l=i(194598),u=i(911748);t.WEBGL_ERROR_LOG_TAG="WebGL Error: ";!function(){function e(){}e.messageForIE7=function(){return r.browser.webkit||r.browser.safari||r.browser.mozilla||window.location.replace("../browsersupport.html"),!1}}();t.visualizeVisiblePicks=function(e){var t=e.getCamera(),i=e.retrieveVisiblePicks(0,0,t.getViewportWidth(),t.getViewportHeight());y(e,i)};var h=new s.NodeProperties({primitiveType:s.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,isPickable:!1}),d=new s.NodeProperties({primitiveType:s.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,isPickable:!1}),p=new Map;function g(e){var t=p.get(e);return t||(t=new s.UIElement(e),p.set(e,t)),t}var f=0;function m(e,t,i,r,n,o){var c=g(e),l=a.default.getManager(),u=(0,s.createPoint)(i,"p"+f++);(0,s.addColorToIncrement)(r||l.getColor("DEBUG_POINT_DEFAULT_COLOR"),u),(0,s.addSizeToIncrement)(n||l.getNumber("DEBUG_POINT_DEFAULT_SIZE"),u),(0,s.addStyleToIncrement)(o||l.getPointFont("DEBUG_POINT_DEFAULT_POINT_FONT"),u),c.updateMeshIncrement(t,s.NO_SELECTION_ID,u,h),e.requestDraw()}function y(e,t){var i=a.default.getManager(),r=g(e),n=e.getCamera();r.removeMeshIncrements();for(var o=function(t,i,r,o,s){var a=n.canvasToWorld([i[0],i[1],.5]);m(e,t,a,r,o,s)},s=0;s<t.length;++s){var c=t[s],l=[1,1,1],h=c.getEntityMetaData();h&&h.isVertex()?l=i.getColor("DEBUG_PICK_VERTEX_COLOR"):h&&h.isEdge()?l=i.getColor("DEBUG_PICK_EDGE_COLOR"):h&&h.isFace()&&(l=i.getColor("DEBUG_PICK_FACE_COLOR"));for(var d=u.vec3.add(l,[.2,.2,.2],u.vec3.create()),p=0;p<c.locationSamples.length;++p)o(s+"."+p,c.locationSamples[p],d,i.getNumber("DEBUG_PICK_SAMPLE_SIZE"));o(s+".average",u.vec2.scale(c.locationSum,1/c.locationCount,u.vec2.create()),u.vec3.scale(l,.6,u.vec3.create()),i.getNumber("DEBUG_PICK_AVERAGE_SIZE"),i.getPointFont("DEBUG_PICK_POINT_AVERAGE_FONT")),o(s+".location",c.location,l,i.getNumber("DEBUG_PICK_SIZE"),i.getPointFont("DEBUG_PICK_POINT_FONT"))}e.requestDraw()}t.visualizeDebugPoint=m,t.visualizeDebugBox=function(e,t,i,r){var n=g(e),o=a.default.getManager(),c=(0,s.createWireBox)(i.getMin(),i.getMax());(0,s.addColorToIncrement)(r||o.getColor("DEBUG_BOUNDINGBOX_DEFAULT_COLOR"),c),n.updateMeshIncrement(t,s.NO_SELECTION_ID,c,d),e.requestDraw()},t.visualizePicks=y,t.sceneDebuggerWindow=null,t.isSceneDebuggerWindowLoaded=!1,t.debugToPostOnLoad=null;var v=null;t.snapshotScenegraph=function(e){if(t.sceneDebuggerWindow&&t.sceneDebuggerWindow.closed&&(t.sceneDebuggerWindow=null,t.isSceneDebuggerWindowLoaded=!1),!t.sceneDebuggerWindow){t.sceneDebuggerWindow=window.open("/debugwindows/scenedebug.html");var i=0,r=setInterval((function(){t.sceneDebuggerWindow.document&&"complete"===t.sceneDebuggerWindow.document.readyState&&(t.isSceneDebuggerWindowLoaded=!0,v&&(v(),v=null)),(t.isSceneDebuggerWindowLoaded||i++>200)&&clearInterval(r)}),200)}var n=(0,s.getViewerForDebugOrTestPurposes)(e&&e.useSheetMetalViewer),o=n.getSceneGraphs().getMainSceneGraph().makeSceneDebugObject(),a=n.getSceneGraphs().getPreviewSceneGraph().makeSceneDebugObject(),c=n.getSceneGraphs().getHudSceneGraph().makeSceneDebugObject(),l=n.getOccurrenceDataManager().makeSceneDebugObject(),u=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),h=function(){t.sceneDebuggerWindow.postMessage([l,o,a,c],u)};t.isSceneDebuggerWindowLoaded?h():v=h},t.lastFrameTimeRendering=0,t.timeRendering=function(e){e=e||{},t.lastFrameTimeRendering=0;var i=0,r=0,n=e.numFrames?e.numFrames:720,a=null,u=(0,s.getViewerForDebugOrTestPurposes)(e.flat);u.draw(),u.setSuppressMouseMovePick(!0),u.completeTasks(),e.forceLowDetail&&u.detailManager.forceLowestDetailSettings();var h=new o.Model,d=0,p=[],g=[],f=u.getGlContext(),m=[];if(e.timeShadersPrograms){var y=f.getProgramFlags().length;g=[],m=[],p=[];for(var v=0;v<y;v++)if(v in f.programNames){for(var E=new Array(y),I=0;I<y;I++)E[I]=I===v;g.push(E),m.push(v)}var T=new Array(y),S=void 0;for(S=0;S<y;S++)T[S]=!1;for(g.push(T),T=new Array(y),S=0;S<y;S++)T[S]=!0;g.push(T),console.dir(g),d=0,f.setProgramFlags(g[0])}var P={performFrameTiming:!1},_=function(){var o=window.performance.now();if(a&&(i+=(o-a)/1e3,++r),a=o,r<n){var s=u.getPrimaryViewController();s.rotateAbout(.0698131701,[0,1,0],s.camera.focalPoint()),u.setUserIsAdjustingCamera(),u.forceRequestDraw(P)}else if(e.timeShadersPrograms&&d<g.length)p[d]=i/r*1e3,++d<g.length&&f.setProgramFlags(g[d]),i=0,r=0,a=null;else{h.stopListening();var y=(r/i).toFixed(2);i=i.toFixed(2),t.lastFrameTimeRendering=1e3*i/r;var v="Rendered "+r+" frames in "+i+" seconds at "+y+" fps "+t.lastFrameTimeRendering.toFixed(2)+" ms frametime";if(l.btInjector.MessageBubbleService.showMessage(v),c.log.debug(v),u.setSuppressMouseMovePick(!1),e.timeShadersPrograms){for(var E=0;E<p.length-2;E++)m[E]in f.programNames&&c.log.debug("program "+E+" "+f.programNames[m[E]]+" "+p[E]+" ms");c.log.debug("no programs  "+p[p.length-2]+" ms"),c.log.debug("all programs "+p[p.length-1]+" ms")}e.browserProfile&&console.profile&&console.profileEnd()}};h.listenTo(u.getEventDispatcher(),s.VIEW_DID_DRAW,_),e.browserProfile&&console.profile&&console.profile(e.browserProfileName||"timeRendering"),_()},t.getGpuMemoryUsage=function(){var e=(0,s.getActiveViewer)();return e?(e.completeTasks(),e.getMemoryGauge().getUsageDetails()):null},t.checkError=function(e){var t=e.getError();if(t!==e.NO_ERROR){var i="Unknown: 0x"+t.toString(16);switch(t){case e.INVALID_ENUM:i="GL_INVALID_ENUM";break;case e.INVALID_VALUE:i="GL_INVALID_VALUE";break;case e.INVALID_OPERATION:i="GL_INVALID_OPERATION";break;case e.INVALID_FRAMEBUFFER_OPERATION:i="GL_INVALID_FRAMEBUFFER_OPERATION";break;case e.OUT_OF_MEMORY:i="GL_OUT_OF_MEMORY"}return c.log.warn("GL error: "+i),!0}return!1};var E=function(){function e(){this.meshIncrements=[],this.silhouetteIncrements=[],this.entityData=[],this.incrementDetails=[]}return e.prototype.removeCrossReferences=function(){var e,t,i,r;try{for(var o=(0,n.__values)(this.entityData),s=o.next();!s.done;s=o.next()){var a=s.value;a.setMeshIncrement(null),a.setBodyMetaData(null)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}try{for(var c=(0,n.__values)(this.incrementDetails),l=c.next();!l.done;l=c.next()){l.value.increment=null}}catch(e){i={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}},e}();t.TrackedGraphicsComponents=E,t.collectGraphicsDataForHeapDump=function(){var e=new E;(0,s.getActiveViewer)().getModelViewManagers().getManager().collectComponentsForHeapDump(e),e.removeCrossReferences(),window.trackedGraphicsComponents=e;for(var t=0,i=0;i<e.meshIncrements.length;++i)t+=e.meshIncrements[i].getTriangleCount();c.log.info("Graphics triangle count: "+t+"\nGraphics body entity count: "+e.entityData.length)}},480155:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DetailManager=t.Settings=t.setupDatabase=t.database=t.getSettingsKey=t.ViewerUsage=t.log=t.logToInfo=void 0;var r,n=i(165542),o=i(736202),s=i(320078),a=i(761922),c=i(311517),l=i(601759),u=i(73055),h=i(311611),d=i(194598),p=i(264822),g=i(227441),f=i(280738);function m(e){t.logToInfo?c.log.info&&c.log.info(e):c.log.trace&&c.log.trace(e)}function y(e,t,i,r){return e+"."+t+"."+i+"."+r}function v(){if((0,s.supportsIndexedDb)(window))try{var e=new a.default("GraphicsDetailSettings");e.version(1).stores({settings:"[viewerUsage+workspaceOrVersionId+elementId+modelUsage], enableSSAOFilter, enableEdgeSilhouettes, enableSSAO, enableBackfaceSilhouettes, enableLowestLodSwitching, enableSectionPlaneEdgeDetection"}),e.version(2).stores({settings:"[viewerUsage+workspaceOrVersionId+elementId+modelUsage], enableSSAOFilter, enableEdgeSilhouettes, enableSSAO, enableBackfaceSilhouettes, enableLowestLodSwitching, enableSectionPlaneEdgeDetection, lowLevelBodyProportion"}).upgrade((function(e){e.settings.toCollection().modify((function(e){e.lowLevelBodyProportion=0}))})),e.version(3).stores({settings:"[viewerUsage+workspaceOrVersionId+elementId+modelUsage], enableSSAOFilter, enableEdgeSilhouettes, enableSSAO, enableBackfaceSilhouettes, enableSectionPlaneEdgeDetection, lowLevelBodyProportion"}).upgrade((function(e){e.settings.toCollection().modify((function(e){delete e.enableLowestLodSwitching}))})),e.open().then((function(){m("Opened graphics detail database")})).catch((function(t){e=null,c.log.warn("Failed to open graphics detail database: "+t)})),t.database=e}catch(e){t.database=null,c.log.warn("Exception while creating settings database: "+e)}}t.logToInfo=!1,t.log=m,function(e){e.NORMAL="NORMAL",e.FLATTENED="FLATTENED"}(r=t.ViewerUsage||(t.ViewerUsage={})),t.getSettingsKey=y,t.database=null,t.setupDatabase=v,v();var E=u.default.getManager().getNumber("MAX_LOW_LEVEL_BODY_PROPORTION"),I=u.default.getManager().getNumber("LOW_LEVEL_BODY_PROPORTION_STEP"),T=function(){function e(e,t,i,n){this.CLONING_PROPERTIES_TO_SKIP={viewerUsage:!0,workspaceOrVersionId:!0,elementId:!0,modelUsage:!0,enableSSAOFilter:!0},this.enableSSAOFilter=!1,this.enableEdgeSilhouettes=!0,this.enableSSAO=!0,this.enableBackfaceSilhouettes=!0,this.lowLevelBodyProportion=0,this.enableSectionPlaneEdgeDetection=!0,this.viewerUsage=e||r.NORMAL,this.workspaceOrVersionId=t||"",this.elementId=i||"",this.modelUsage=n||g.GBTDisplayDataUsage.BASE}return e.prototype.getKeyPath=function(){return[this.viewerUsage,this.workspaceOrVersionId,this.elementId,this.modelUsage]},e.prototype.getKeyString=function(){return y(this.viewerUsage,this.workspaceOrVersionId,this.elementId,this.modelUsage)},e.prototype.persistSettings=function(){t.database?(m("Saving detail settings for "+this.getKeyString()),t.database.settings.put(this).catch((function(e){m("Save failed: "+e)}))):m("Database not available for persisting settings "+this.getKeyString())},e.prototype.updateFromDatabase=function(e){var i=this,r=n.defer();return t.database?t.database.settings.get(this.getKeyPath()).then((function(t){t?(m("Got saved details settings for "+i.getKeyString()+": "+JSON.stringify(t)),(0,l.overwriteMatchingProperties)(i,t)):(e?(m("No saved details settings for "+i.getKeyString()+" - initializing from "+e.getKeyString()),(0,l.overwriteMatchingProperties)(i,e,i.CLONING_PROPERTIES_TO_SKIP)):m("No saved details settings for "+i.getKeyString()+" - creating new settings"),i.persistSettings())})).catch((function(e){c.log.info("Failed to retrieve graphics detail settings: "+e)})).finally((function(){r.resolve()})):(m("Settings database not available for updating settings"),r.resolve()),r.promise},e.prototype.decreaseDetail=function(){var e=!1;return this.enableEdgeSilhouettes||this.enableSectionPlaneEdgeDetection?(this.enableEdgeSilhouettes=!1,this.enableSectionPlaneEdgeDetection=!1,e=!0,m("Decreasing graphics detail: dropped edge-based silhouettes and section plane edges")):this.enableSSAO?(this.enableSSAO=!1,e=!0,m("Decreasing graphics detail: dropped ambient occlusion")):this.enableBackfaceSilhouettes?(this.enableBackfaceSilhouettes=!1,e=!0,m("Decreasing graphics detail: dropped image-based silhouettes")):this.lowLevelBodyProportion<E&&(this.lowLevelBodyProportion=Math.min(this.lowLevelBodyProportion+I,E),m("Decreasing graphics detail: Increased lowest LOD proportion to: "+this.lowLevelBodyProportion),e=!0),e&&this.persistSettings(),e},e.prototype.increaseDetail=function(e,t){var i=!1;this.lowLevelBodyProportion>0?(this.lowLevelBodyProportion=Math.max(0,this.lowLevelBodyProportion-I),m("Increasing graphics detail: decreased lowest LOD proportion to: "+this.lowLevelBodyProportion),i=!0):!this.enableBackfaceSilhouettes&&t?(this.enableBackfaceSilhouettes=!0,i=!0,m("Increasing graphics detail: adding image-based silhouettes")):!this.enableSSAO&&e?(this.enableSSAO=!0,i=!0,m("Increasing graphics detail: enabled ambient occlusion")):!this.enableEdgeSilhouettes&&t?(this.enableEdgeSilhouettes=!0,i=!0,m("Increasing graphics detail: enabled edge based silhouette edges")):this.enableSectionPlaneEdgeDetection||(this.enableSectionPlaneEdgeDetection=!0,i=!0,m("Increasing graphics detail: enabled section plane edges")),i&&this.persistSettings()},e}();t.Settings=T;var S=function(){function e(e,t){this.viewer=e,this.frameTimer=t,this.REDUCTION_THRESHOLD_MS=1e3/u.default.getManager().getNumber("DETAIL_REDUCTION_THRESHOLD_FPS"),this.ENHANCEMENT_THRESHOLD_MS=1e3/u.default.getManager().getNumber("DETAIL_ENHANCEMENT_THRESHOLD_FPS"),this.FULL_DETAIL_OCCURRENCE_REDUCTION_THRESHOLD=u.default.getManager().getNumber("FULL_DETAIL_OCCURRENCE_REDUCTION_THRESHOLD"),this.RENDER_PERFORMANCE_WARNING_TIMEOUT_SECONDS=u.default.getManager().getNumber("RENDER_PERFORMANCE_WARNING_TIMEOUT_SECONDS"),this.RENDER_PERFORMANCE_CLEAR_WARNING_TIMEOUT_SECONDS=u.default.getManager().getNumber("RENDER_PERFORMANCE_CLEAR_WARNING_TIMEOUT_SECONDS"),this.detailSettings={},this.activeInteractiveKey="",this.lastInteractiveTimingActedOn=-1,this.overrideSettings=null,this.disableInterativeUpdates=!1,this.renderingPerformanceMessageEnabled=!0,this.renderingPerformanceMessageTimeout=null,this.clearRenderingPerformanceMessageTimeout=null,this.clientVersion=null,this.viewerUsage=e.getIsForFlattenedDisplay()?r.FLATTENED:r.NORMAL,this.detailSettings[f.FrameType.FULL]=new T(this.viewerUsage),this.detailSettings[f.FrameType.FULL].enableSSAOFilter=!0}return e.prototype.onSettingStateChange=function(){var e=d.btInjector.StateParameterService.workspaceId()||d.btInjector.StateParameterService.versionId()||"",t=d.btInjector.StateParameterService.elementId()||"",i=(0,h.getLatestDisplayDataUsage)(),r=y(this.viewerUsage,e,t,i);r!==this.activeInteractiveKey&&(m("Switching to detail settings for "+r),this.activeInteractiveKey=r,this.lastInteractiveTimingActedOn=-1)},e.prototype.ensureInteractiveSettingsExist=function(){var e=this;if(this.detailSettings[this.activeInteractiveKey]){var t=n.defer();return t.resolve(),t.promise}var i=d.btInjector.StateParameterService.workspaceId()||d.btInjector.StateParameterService.versionId()||"",r=d.btInjector.StateParameterService.elementId()||"",o=(0,h.getLatestDisplayDataUsage)();m("Initializing detail settings for "+this.activeInteractiveKey);var s=y(this.viewerUsage,i,r,g.GBTDisplayDataUsage.BASE),a=this.detailSettings[s]||this.detailSettings[f.FrameType.FULL],c=new T(this.viewerUsage,i,r,o);return this.detailSettings[this.activeInteractiveKey]=c,c.updateFromDatabase(a).then((function(){c.enableSSAO&&!e.isInteractiveSsaoEnabled()&&(m("Ambient occlusion disabled for interactive frames due to performance issues"),c.enableSSAO=!1),!c.enableBackfaceSilhouettes&&!c.enableEdgeSilhouettes||e.areInteractiveSilhouettesEnabled()||(m("Silhouette Edges disabled for interactive frames due to performance issues"),c.enableBackfaceSilhouettes=!1,c.enableEdgeSilhouettes=!1)}))},e.prototype.forceLowestDetailSettings=function(e){this.ensureInteractiveSettingsExist();var t=this.detailSettings[this.activeInteractiveKey];t.enableSSAOFilter=!1,t.enableEdgeSilhouettes=!1,t.enableSSAO=!1,t.enableBackfaceSilhouettes=!1,t.enableSectionPlaneEdgeDetection=!1,t.lowLevelBodyProportion=E,e&&t.persistSettings()},e.prototype.increaseDetail=function(){this.disableInterativeUpdates=!0,this.detailSettings[this.activeInteractiveKey].increaseDetail(this.isInteractiveSsaoEnabled(),this.areInteractiveSilhouettesEnabled())},e.prototype.decreaseDetail=function(){this.disableInterativeUpdates=!0,this.detailSettings[this.activeInteractiveKey].decreaseDetail()},e.prototype.getDetailSettings=function(){if(this.overrideSettings)return this.overrideSettings;var e=f.FrameType.FULL;return this.frameTimer.userIsInteracting()?(this.updateInteractiveSettings(),e=this.activeInteractiveKey):this.frameTimer.userIsManipulating()&&(e=this.activeInteractiveKey),this.detailSettings[e]?this.detailSettings[e]:(c.log.warn("Could not find detail settings for key: "+e),this.detailSettings[f.FrameType.FULL])},e.prototype.getInteractiveSettings=function(){return this.ensureInteractiveSettingsExist(),this.detailSettings[this.activeInteractiveKey]},e.prototype.updateInteractiveSettings=function(){if(!this.disableInterativeUpdates){this.ensureInteractiveSettingsExist();var e=this.frameTimer.getDrawLoopDetails(f.FrameType.INTERACTIVE),t=this.frameTimer.getTimingDetails(f.FrameType.INTERACTIVE);if(this.lastInteractiveTimingActedOn<0)this.lastInteractiveTimingActedOn=t.timingCount;else{var i=t.timingCount-this.lastInteractiveTimingActedOn;if(e.averageTime>this.REDUCTION_THRESHOLD_MS)this.detailSettings[this.activeInteractiveKey].decreaseDetail(),e.reset();else if(i>=2)if(t.averageTime>this.REDUCTION_THRESHOLD_MS){var r=this.detailSettings[this.activeInteractiveKey].decreaseDetail();this.lastInteractiveTimingActedOn=t.timingCount,r&&!(0,h.isRunningIntelGpu)(this.viewer.getGlContext())||this.startRenderingPerformanceMessageTimeout()}else t.averageTime<this.ENHANCEMENT_THRESHOLD_MS?(this.detailSettings[this.activeInteractiveKey].increaseDetail(this.isInteractiveSsaoEnabled(),this.areInteractiveSilhouettesEnabled()),this.lastInteractiveTimingActedOn=t.timingCount,this.startClearRenderingPerformanceMessageTimeout()):this.startClearRenderingPerformanceMessageTimeout()}}},e.prototype.isInteractiveFramerateBelowThreshold=function(){var e=this.frameTimer.getDrawLoopDetails(f.FrameType.INTERACTIVE),t=this.frameTimer.getTimingDetails(f.FrameType.INTERACTIVE);return e.timingCount>0&&e.averageTime>this.REDUCTION_THRESHOLD_MS||t.timingCount>0&&t.averageTime>this.REDUCTION_THRESHOLD_MS},e.prototype.isInteractiveSsaoEnabled=function(){var e=this.viewer.getRendererInfo();if(!e)return!0;var t=/AMD/gi.test(e.glRenderer)||(0,s.isBrowserFirefox)()&&/Radeon/gi.test(e.glRenderer)&&/ATI Technologies/gi.test(e.glVendor),i=/Apple GPU/gi.test(e.glRenderer);return!((0,s.isPlatformMac)()&&(t||i&&(0,s.isBrowserSafari)()))},e.prototype.areInteractiveSilhouettesEnabled=function(){return!(0,s.isBrowserSafari)()||(0,s.getSafariVersion)()<15},e.prototype.setOverrideSettings=function(e){this.overrideSettings=e},e.prototype.updateFromLoadedScene=function(){var e=this.viewer.getModelViewManagers().getManager().getModelStatistics(!1),t=e.partOccurrences+e.surfaceOccurrences+e.curveOccurrences,i=this.detailSettings[f.FrameType.FULL],r=!i.enableEdgeSilhouettes;t>=this.FULL_DETAIL_OCCURRENCE_REDUCTION_THRESHOLD?(r||m("Reducing full detail rendering settings due to large occurrence count: "+t),i.enableEdgeSilhouettes=!1,i.enableSSAO=!1,i.enableBackfaceSilhouettes=!1,i.enableSectionPlaneEdgeDetection=!1,this.viewer.getSilhouetteTask().clearPendingRequests()):(r&&m("Increasing full detail rendering settings due to smaller occurrence count: "+t),i.enableEdgeSilhouettes=!0,i.enableSSAO=!0,i.enableBackfaceSilhouettes=!0,i.enableSectionPlaneEdgeDetection=!0)},e.prototype.areFullDetailEdgeSilhouettesEnabled=function(){return this.detailSettings[f.FrameType.FULL].enableEdgeSilhouettes},e.prototype.getClientVersion=function(){if(!this.clientVersion){var e=d.btInjector.ClientVersionService.getRunningVersion(),t=e.match(new RegExp("(\\d+\\.\\d+)","i"));t&&t.length>0?this.clientVersion=t[0]:this.clientVersion=e}return this.clientVersion},e.prototype.setRenderingPerformanceMessageEnabled=function(e){this.renderingPerformanceMessageEnabled=e},e.prototype.startRenderingPerformanceMessageTimeout=function(){var e=this;if((0,o.isNumber)(this.clearRenderingPerformanceMessageTimeout)&&(window.clearTimeout(this.clearRenderingPerformanceMessageTimeout),this.clearRenderingPerformanceMessageTimeout=null),this.renderingPerformanceMessageEnabled&&!(0,o.isNumber)(this.renderingPerformanceMessageTimeout)&&!this.viewer.hasPendingBodiesToLoad()&&!this.viewer.getIsForFlattenedDisplay()){var t=""+(0,s.getBrowserMajorVersion)(),i=this.getClientVersion();window.localStorage.getItem("osRenderPerformanceMessageBrowserVersion")===t&&window.localStorage.getItem("osRenderPerformanceMessageClientVersion")===i||(m("Starting render performance message timeout"),this.renderingPerformanceMessageTimeout=window.setTimeout((function(){window.localStorage.setItem("osRenderPerformanceMessageBrowserVersion",t),window.localStorage.setItem("osRenderPerformanceMessageClientVersion",i);var r=d.btInjector.MessageBubbleService.createMessageBubble();r.showMessage(i18n("Reduced rendering performance detected."),null,i18n("Check system compatibility in a new tab")).then((function(){ga("send","event","PERFORMANCE_MESSAGE","render_performance_action_click",(0,p.getModelId)());var e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/check";window.open(e),r.dismissMessage()})),ga("send","event","PERFORMANCE_MESSAGE","render_performance_warning",(0,p.getModelId)()),e.renderingPerformanceMessageTimeout=null}),1e3*this.RENDER_PERFORMANCE_WARNING_TIMEOUT_SECONDS))}},e.prototype.startClearRenderingPerformanceMessageTimeout=function(e){var t=this;!e&&(0,h.isRunningIntelGpu)(this.viewer.getGlContext())||(0,o.isNumber)(this.clearRenderingPerformanceMessageTimeout)||!(0,o.isNumber)(this.renderingPerformanceMessageTimeout)||(m("Starting clear render performance message timeout"),this.clearRenderingPerformanceMessageTimeout=window.setTimeout((function(){(0,o.isNumber)(t.renderingPerformanceMessageTimeout)&&(window.clearTimeout(t.renderingPerformanceMessageTimeout),t.renderingPerformanceMessageTimeout=null,m("Cleared performance message timeout")),t.clearRenderingPerformanceMessageTimeout=null}),1e3*this.RENDER_PERFORMANCE_CLEAR_WARNING_TIMEOUT_SECONDS))},e}();t.DetailManager=S},639586:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDimensionForDisplayData=t.CountDimension=t.CurveLengthDimension=t.RhoDimension=t.PointDimension=t.ArcLengthDimension=t.AngularDimension=t.RadialDimension=t.PolarDimension=t.EllipseDiameterDimension=t.CenterlineDimension=t.LinearDimension=t.Arc=t.Dimension=t.setShowDimensionsMode=t.setDimensionToolActive=t.setInteractionEnabled=void 0;var r=i(423902),n=i(736202),o=i(73055),s=i(670449),a=i(911748),c=i(194598),l=i(765421),u=i(227441),h=i(507025),d=i(376931),p=i(699716),g=i(673290),f=i(311611),m="text",y="line",v=!1,E=!1,I=!1;t.setInteractionEnabled=function(e){v=e},t.setDimensionToolActive=function(e){E=e},t.setShowDimensionsMode=function(e){I=e};var T={isVisible:!0,isTwoSided:!0,priority:f.RenderOrderPriority.HIGHER,primitiveType:f.PrimitiveType.TRIANGLES},S=[Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!0},T),Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!1},T)],P="text",_="arc_length",M={isVisible:!0,isTwoSided:!0,priority:f.RenderOrderPriority.LOWER,primitiveType:f.PrimitiveType.LINES},D=[new f.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!0},M)),new f.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!1},M))],C="arrows",O={isVisible:!0,isPickable:!1,isTwoSided:!0,priority:f.RenderOrderPriority.LOWER,material:f.UNLIT_COLOR_FROM_ATTRIBUTE,primitiveType:f.PrimitiveType.TRIANGLES},A=[new f.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1},O)),new f.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1},O))],R="witness0",N="witness1",w="dimensionLine0",b=1.25*g.Tolerances.MAX_MODEL_SIZE,L=o.default.getManager(),F=function(e){function t(t,i,r){var o=e.call(this,t)||this;o.displayData=null,o.updateOnNextDraw=!0,o.lastPixelSizeWorld=0,o.lastFlips=[],o.isBad=!1,o.isDriven=!1,o.value=0,o.hovered=!1,o.isConfigured=!1,o.textTexture=null,o.textDragging=!1,o.preferences=null,o.selected=!1,o.pushedMoveCursor=!1,o.forPreview=!!i,o.lastSetProperties={textRendered:null,isBad:o.isBad,hovered:o.hovered,isDriven:o.isDriven,isConfigured:o.isConfigured},o.listenTo(o,f.UiEvents.MOUSE_ENTER+y,o.onMouseEnterLines),o.listenTo(o,f.UiEvents.MOUSE_LEAVE+y,o.onMouseLeaveLines),o.listenTo(o,f.UiEvents.CLICK+y,o.onClick),o.listenTo(o,f.UiEvents.SELECT+y,o.onSelect),o.listenTo(o,f.UiEvents.DESELECT+y,o.onDeselect),o.listenTo(o,f.UiEvents.MOUSE_ENTER+m,o.onMouseEnterText),o.listenTo(o,f.UiEvents.MOUSE_LEAVE+m,o.onMouseLeaveText),o.listenTo(o,f.UiEvents.CLICK+m,o.onClick),o.listenTo(o,f.UiEvents.SELECT+m,o.onSelect),o.listenTo(o,f.UiEvents.DESELECT+m,o.onDeselect),o.listenTo(o,f.UiEvents.DOUBLE_CLICK+y,o.onDoubleClick),o.listenTo(o,f.UiEvents.DOUBLE_CLICK+m,o.onDoubleClick),o.listenTo(o,f.UiEvents.DRAG_START+m,o.onDragStartText),o.listenTo(o,f.UiEvents.DRAG+m,o.onDragText),o.listenTo(o,f.UiEvents.DRAG_STOP+m,o.onDragStopText),o.elementId=r||"",o.textMaterial=(0,f.createTextureMaterial)(),o.dimensionMatrix=a.mat4.identity(),o.planeMatrix=a.mat4.identity(),o.computedInverse=a.mat4.identity(),o.appliedTransform=a.mat4.identity();var s=(0,n.clone)(S[0]),c=(0,n.clone)(S[1]);return i&&(s.priority=f.RenderOrderPriority.HIGHEST,c.priority=f.RenderOrderPriority.HIGHEST),o.textNodeProperties=[new f.NodeProperties(Object.assign({material:o.textMaterial},s)),new f.NodeProperties(Object.assign({material:o.textMaterial},c))],o}return(0,r.__extends)(t,e),t.prototype.isDimension=function(){return!0},t.prototype.setAppliedTransform=function(e){this.appliedTransform=e,a.mat4.inverse(this.getPlaneMatrix(),this.computedInverse)},t.prototype.getPlaneMatrix=function(){return a.mat4.multiply(this.appliedTransform,this.planeMatrix,a.mat4.create())},t.prototype.getPlaneMatrixInverse=function(){return this.computedInverse},t.prototype.onDevicePixelRatioChanged=function(e){null!==this.lastSetProperties.textRendered&&(this.textTexture=null,this.updateRawTextTexture(this.lastSetProperties.textRendered))},t.prototype.remove=function(){this.hovered&&!I&&this.viewer.popCursor(),this.destroyText(),this.textMaterial&&(this.textMaterial.destroy(),this.textMaterial=null),e.prototype.remove.call(this)},t.prototype.hasChanged=function(e){return!(this.lastSetProperties.textRendered===e&&this.lastSetProperties.isBad===this.isBad&&this.lastSetProperties.hovered===this.hovered&&this.textTexture&&this.lastSetProperties.isDriven===this.isDriven&&this.lastSetProperties.isConfigured===this.isConfigured)},t.prototype.getPickPriority=function(e){return E?f.PickPriority.REDUCED_DIMENSION_PRIORITY:f.PickPriority.DIMENSION},t.prototype.updateDimensionMatrices=function(){this.displayData&&(this.updateOnNextDraw=!0,this.dimensionMatrix=this.displayData.coordinateSystem.getGlMatrix(),this.planeMatrix=this.displayData.planeMatrix.getGlMatrix(),a.mat4.inverse(this.getPlaneMatrix(),this.computedInverse),this.value=this.displayData.value)},t.prototype.getFeatureId=function(){return this.displayData?this.displayData.featureId:""},t.prototype.getElementId=function(){return this.elementId},t.prototype.getDimensionId=function(){return this.displayData?this.displayData.id:""},t.prototype.getParameterId=function(){return this.displayData?this.displayData.parameterId:""},t.prototype.canPickThrough=function(){return!this.isInteractionEnabled()||E},t.prototype.isInteractionEnabled=function(){return!this.forPreview&&v},t.prototype.isForPreview=function(){return this.forPreview},t.prototype.destroyText=function(){this.textTexture&&(this.textTexture.destroy(),this.textTexture=null,this.updateOnNextDraw=!0)},t.prototype.onDefaultUnitsChanged=function(){this.destroyText(),this.viewer.requestDraw()},t.prototype.onViewWillDraw=function(e,t){if(!this.isHidden&&this.displayData){var i=this.getPosition(),r=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(i[0],i[1]))),n=(0,f.orientText)(e,this.getVisualRightVector(),this.getVisualUpVector(),this.transform),o=this.preferences&&this.preferences.displayLimitRangeTicks;(this.updateOnNextDraw||Math.abs(this.lastPixelSizeWorld-r)>g.Tolerances.ZERO_LENGTH||!(0,h.arraysEqual)(this.lastFlips,n)||o)&&(this.update(e,t),this.updateOnNextDraw=!1,this.lastPixelSizeWorld=r,this.lastFlips=n)}},t.prototype.getPosition=function(){return a.vec2.createFrom(0,0)},t.prototype.textIsReadOnly=function(){return!(!this.preferences||!this.preferences.textReadOnly)},t.prototype.onMouseEnterText=function(e,t){this.textIsReadOnly()||(this.hovered=!0,this.destroyText(),this.pushMoveCursor(),(0,f.requestDraw)())},t.prototype.onMouseLeaveText=function(e,t){this.textIsReadOnly()||(this.hovered=!1,this.destroyText(),this.removeMoveCursor(),(0,f.requestDraw)())},t.prototype.pushMoveCursor=function(){I||this.pushedMoveCursor||(this.viewer.pushCursor(f.Cursor.MOVE),this.pushedMoveCursor=!0)},t.prototype.removeMoveCursor=function(){this.pushedMoveCursor&&(this.viewer.removeTopOccurrenceOfCursor(f.Cursor.MOVE),this.pushedMoveCursor=!1)},t.prototype.onDoubleClick=function(e,t){if(!c.btInjector.FeatureConfigurationService.getIsInConfigureFeatureMode())if(this.isConfigured)c.btInjector.MessageBubbleService.showMessageWithAutoDismiss(i18n("Configured dimensions can be edited in the configuration table"));else if(!this.textIsReadOnly()){var i=this.getLabelCanvasCoordinates();this.viewer.getEventDispatcher().trigger(f.DIMENSION_TEXT_DOUBLE_CLICKED,{featureId:this.getFeatureId(),dimensionId:this.getDimensionId(),parameterId:this.getParameterId(),positionX:i[0],positionY:i[1],dimension:this}),(0,f.requestDraw)()}},t.prototype.onDragStartText=function(e,t,i){I||(this.textDragging=!0,this.destroyText(),i.requestDrag=!0)},t.prototype.onDragText=function(e,t){},t.prototype.onMouseEnterLines=function(e,t){this.textIsReadOnly()||(this.hovered=!0,this.destroyText(),I||this.viewer.pushCursor(f.Cursor.DEFAULT),(0,f.requestDraw)())},t.prototype.onMouseLeaveLines=function(e,t){this.textIsReadOnly()||(this.hovered=!1,this.destroyText(),I||this.viewer.removeTopOccurrenceOfCursor(f.Cursor.DEFAULT),(0,f.requestDraw)())},t.prototype.onClick=function(e,t,i){I||(i.requestSelectedStatus=!0);var r=this.getLabelCanvasCoordinates();this.viewer.getEventDispatcher().trigger(f.DIMENSION_TEXT_SINGLE_CLICKED,{featureId:this.getFeatureId(),dimensionId:this.getDimensionId(),parameterId:this.getParameterId(),positionX:r[0],positionY:r[1],dimension:this})},t.prototype.onSelect=function(e,t){this.selected=!0,this.destroyText(),(0,f.requestDraw)()},t.prototype.onDeselect=function(e,t){this.selected=!1,this.destroyText(),(0,f.requestDraw)()},t.prototype.onDragStopText=function(e,t){var i=s.BTMessageConnection.getConnection(s.MainConnectionName);if(i&&!I&&""!==this.getElementId()){var r=this.getLabelPositionInPlane(),n=new u.BTUiSketchPositionDimensionCall;n.entityId=this.getDimensionId(),n.elementId=this.getElementId(),n.labelX=r[0],n.labelY=r[1],n.parameterName=this.getParameterId(),n.editDescription=n.constructEditMessage("Drag","annotation"),i.send(n),this.textDragging=!1,this.destroyText()}},t.prototype.addPointToBounds=function(e,t){for(var i=0;i<3;++i)if(e[i]>b||e[i]<-b)return;t.addPoint(e)},t.prototype.isDrivenDimension=function(){return this.isDriven},t.prototype.setIsDriven=function(e){this.isDriven=e,this.viewer.requestDraw()},t.prototype.canBeDrivenDimension=function(){return!0},t.prototype.isConfiguredDimension=function(){return this.isConfigured},t.prototype.setIsConfigured=function(e){this.isConfigured=e,this.viewer.requestDraw()},t.prototype.isOverDefined=function(){return this.isBad},t.prototype.getLabelPositionInPlane=function(){return[0,0]},t.prototype.getPlaneOrigin=function(){return a.mat4.multiplyVec3(this.getPlaneMatrix(),[0,0,0],a.vec3.create())},t.prototype.getVisualUpVector=function(){var e=this.getPlaneOrigin();return a.vec3.normalize(a.vec3.subtract(a.mat4.multiplyVec3(this.getPlaneMatrix(),[0,1,0],a.vec3.create()),e,a.vec3.create()))},t.prototype.getVisualRightVector=function(){var e=this.getPlaneOrigin();return a.vec3.normalize(a.vec3.subtract(a.mat4.multiplyVec3(this.getPlaneMatrix(),[1,0,0],a.vec3.create()),e,a.vec3.create()))},t.prototype.getModelPoint=function(e,t){var i=a.mat3.multiplyVec2(this.dimensionMatrix,[e,t],a.vec2.create());return a.mat4.multiplyVec3(this.getPlaneMatrix(),[i[0],i[1],0],a.vec3.create())},t.prototype.getUiSelectionForText=function(){return new f.UISelection(this,m,"")},t.prototype.planeToDimensionCoordinates=function(e,t){var i=[this.dimensionMatrix[0],this.dimensionMatrix[1],this.dimensionMatrix[3],this.dimensionMatrix[4]],r=[this.dimensionMatrix[6],this.dimensionMatrix[7]];return a.mat2.multiplyVec2(i,a.vec2.subtract([e,t],r,a.vec2.create()))},t.prototype.mouseToDimensionCoordinates=function(e,t,i){var r=i.getRay(e,t),n=(0,f.intersectRayPlaneMatrix)(r,this.getPlaneMatrix()),o=a.mat4.multiplyVec3(this.getPlaneMatrixInverse(),n,a.vec3.create());return o?this.planeToDimensionCoordinates(o[0],o[1]):null},t.prototype.getLabelCanvasCoordinates=function(){var e=this.getLabelPositionInPlane(),t=a.mat4.multiplyVec3(this.getPlaneMatrix(),[e[0],e[1],0]),i=this.viewer.getPrimaryViewController().camera.projectWorldPointToCanvas(t),r=(0,p.getDevicePixelRatio)();return i[0]/=r,i[1]/=r,i},t.prototype.update=function(e,t){},t.prototype.updateTextTexture=function(e,t,i,r){var n="",o="";if(i&&(n=i),r&&(o=r),!this.preferences||this.preferences&&this.preferences.displayLimitRangeText){var s=void 0;this.displayData.hasMinimumLimit&&(s=(0,l.convertFromBase)(this.displayData.minimumLimit,this.getDimensionUnits(t)),o=o+", "+i18n("Min")+": "+this.getRoundedDimensionValueForTextDisplay(s,t),r&&(o+=r)),this.displayData.hasMaximumLimit&&(s=(0,l.convertFromBase)(this.displayData.maximumLimit,this.getDimensionUnits(t)),o=o+", "+i18n("Max")+": "+this.getRoundedDimensionValueForTextDisplay(s,t),r&&(o+=r))}var a=n+this.getRoundedDimensionValueForTextDisplay(e,t)+o;return this.updateRawTextTexture(a)},t.prototype.updateRawTextTexture=function(e){if(!this.hasChanged(e))return this.textTexture;var t;this.destroyText(),this.lastSetProperties.textRendered=e,this.lastSetProperties.isBad=this.isBad,this.lastSetProperties.hovered=this.hovered,this.lastSetProperties.isDriven=this.isDriven,this.lastSetProperties.isConfigured=this.isConfigured,t=this.preferences&&this.preferences.colorName?L.getColor(this.preferences.colorName):this.isBad?L.getColor("OVERCONSTRAINED_LINE_POINT_COLOR"):this.isDriven?L.getColor("DIMENSION_DRIVEN_LINE_POINT_COLOR"):L.getColor("DIMENSION_TEXT_COLOR");var i=null;(this.hovered||this.selected||this.textDragging)&&(i=this.selected?L.getColor("DIMENSION_TEXT_SELECTED_BACKGROUND_COLOR"):L.getColor("DIMENSION_TEXT_HOVERED_BACKGROUND_COLOR"));var r=null;return this.isConfigured&&(r=L.getColor("DIMENSION_CONFIGURED_COLOR")),this.textTexture=(0,f.createTextureFromText)(this.viewer,e,{color:t,font:L.getString("DIMENSION_TEXT_FONT"),size:L.getNumber("DIMENSION_TEXT_HEIGHT_PIXELS"),paddingWithinBorder:L.getNumber("DIMENSION_TEXT_BACKGROUND_PADDING"),backgroundColor:i,backgroundOpacity:L.getNumber("DIMENSION_TEXT_SELECTED_BACKGROUND_OPACITY"),backgroundRadius:L.getNumber("DIMENSION_TEXT_SELECTED_BACKGROUND_BORDER_RADIUS"),borderColor:r,borderThickness:r?L.getNumber("DIMENSION_CONFIGURED_BORDER_THICKNESS"):0,dashLength:L.getNumber("DIMENSION_CONFIGURED_DASH_LENGTH"),dashGapLength:L.getNumber("DIMENSION_CONFIGURED_DASH_GAP_LENGTH")}),this.textMaterial.ambientTexture=this.textTexture,this.textTexture},t.prototype.getScreenSpaceParameters=function(e,t){var i={gap:L.getNumber("DIMENSION_WITNESS_MODEL_GAP"),extension:L.getNumber("DIMENSION_WITNESS_EXTENSION")};return this.preferences&&this.preferences.ignoreSpaceParameters?(i.gap=0,i.extension=0):t&&(i.gap*=t,i.extension*=t),i},t.prototype.getArrowColor=function(){return this.preferences&&this.preferences.colorName?L.getColor(this.preferences.colorName):this.selected?L.getColor("DIMENSION_SELECTED_LINE_ARROW_COLOR"):this.hovered?L.getColor("DIMENSION_HOVERED_LINE_ARROW_COLOR"):this.isBad?L.getColor("OVERCONSTRAINED_LINE_POINT_COLOR"):this.isDriven?L.getColor("DIMENSION_DRIVEN_LINE_POINT_COLOR"):L.getColor("DIMENSION_LINE_ARROW_COLOR")},t.prototype.getLineColor=function(){return this.getArrowColor()},t.prototype.getLineWidth=function(){return this.selected||this.hovered?L.getNumber("DIMENSION_SELECTED_LINE_WIDTH"):L.getNumber("DIMENSION_LINE_WIDTH")},t.prototype.getLineStyle=function(){return this.preferences?this.preferences.lineStyle:null},t.prototype.getTextGap=function(e,t,i,r){var n=(0,d.acos)(a.vec3.dot(e,t),g.Tolerances.ZERO_LENGTH);n>Math.PI/2&&(n=(0,d.acos)(a.vec3.dot(a.vec3.scale(e,-1,a.vec3.create()),t),g.Tolerances.ZERO_LENGTH));var o=r/2/(i/2);return Math.tan(n)>o?r/Math.sin(n):i/Math.cos(n)},t.prototype.createComponentLine=function(e,t){return(0,f.createLine)(e,t,void 0,this.getLineColor(),this.getLineWidth(),this.getLineStyle())},t.prototype.updateDimensionComponent=function(e,t,i,r){var n=this.forPreview?1:0;this.updateMeshIncrement("st."+e,t,i.clone(),r[n])},t.prototype.removeDimensionComponent=function(e){this.removeMeshIncrement("st."+e)},t.prototype.updateDimensionLineComponent=function(e,t,i){this.updateDimensionComponent(e,y,this.createComponentLine(t,i),D)},t.prototype.makeThreePointArc=function(e,t,i,r){var n=(0,f.createArcPolyline)(e.slice(),t.slice(),i.slice(),[],!0);if(n){var o=n.linePoints,s=new Array(3*o.length),a=new Array(2*(o.length-1)),c=r.getIndexOffset();a[0]=c;for(var l=1;l<o.length-1;l++)a[2*l-1]=l+c,a[2*l]=l+c;for(l=0;l<o.length;l++)for(var u=o[l],h=this.getModelPoint(u[0],u[1]),d=0;d<3;++d)s[3*l+d]=h[d];a[a.length-1]=a.length-1+c,r.concat(s,a)}},t.prototype.getTextPrefix=function(e){return this.preferences&&this.preferences.textPrefix?this.preferences.textPrefix:""},t.prototype.isOfType=function(e){return this.constructor===e},t.prototype.setPreferences=function(e){this.preferences=e},t.prototype.getDisplayData=function(){return this.displayData},t}(f.UIElement);t.Dimension=F;var B=function(){function e(){this.points=[],this.indices=[]}return e.prototype.concat=function(e,t){this.points=this.points.concat(e),this.indices=this.indices.concat(t)},e.prototype.getIndexOffset=function(){return this.points.length/3},e}();t.Arc=B;var x=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="LinearDimension",n}return(0,r.__extends)(t,e),t.prototype.updateFromDisplayData=function(e){this.displayData=e,this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()},t.prototype.getPosition=function(){return a.vec2.createFrom(this.displayData.positionX,this.displayData.positionY)},t.prototype.getRoundedDimensionValueForTextDisplay=function(e,t){return(0,d.roundTo)(e,t.getLengthUnitsDisplayPrecision())},t.prototype.getDimensionUnits=function(e){return e.getLengthUnits()},t.prototype.update=function(e,t){if(this.displayData){var i,r=[this.displayData.witnessEndPoint0X,this.displayData.witnessEndPoint0Y],n=[this.displayData.witnessEndPoint1X,this.displayData.witnessEndPoint1Y],o=this.getPosition(),s=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(o[0],o[1]))),c=this.getModelPoint(r[0],r[1]),u=this.getModelPoint(n[0],r[1]),h=this.getModelPoint(r[0],r[1]+n[0]-r[0]),d=a.vec3.normalize(a.vec3.subtract(u,c)),p=a.vec3.normalize(a.vec3.subtract(h,c));(a.vec3.dot(d,d)<g.Tolerances.ZERO_LENGTH_SQUARED||a.vec3.dot(p,p)<g.Tolerances.ZERO_LENGTH_SQUARED)&&(d=a.vec3.normalize(a.vec3.subtract(this.getModelPoint(1,0),c)),p=a.vec3.normalize(a.vec3.subtract(this.getModelPoint(0,1),c)));var v=this.getVisualRightVector(),E=this.getVisualUpVector(),I=Math.abs(this.displayData.value),T=L.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*s,S=L.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*s,_=S;S>I*L.getNumber("DIMENSION_ARROW_MAX_PROPORTION")&&(T*=i=I*L.getNumber("DIMENSION_ARROW_MAX_PROPORTION")/S,S*=i);var M=[],O=this;oe(0,0,r[0],o[1]),oe(S,.5*-T,r[0],o[1]),oe(S,.5*T,r[0],o[1]),oe(0,0,n[0],o[1]),oe(-S,.5*-T,n[0],o[1]),oe(-S,.5*T,n[0],o[1]),this.updateDimensionComponent(C,"",(0,f.createTriangles)(M,[0,1,2,3,4,5],void 0,this.getArrowColor()),A);var b=(0,l.convertFromBase)(this.displayData.value,t.getLengthUnits()),F=this.updateTextTexture(b,t,this.getTextPrefix(t)),B=s*F.filledWidthPx,x=s*F.filledHeightPx,U=this.getTextGap(d,v,B,x),G=this.getScreenSpaceParameters(t,s),H=G.extension;U>I&&(H=0);var V=r[1]+(o[1]>r[1]?G.gap:-G.gap),k=n[1]+(o[1]>n[1]?G.gap:-G.gap),W=o[1]+(o[1]>0?H:-H);this.updateDimensionLineComponent(R,this.getModelPoint(r[0],V),this.getModelPoint(r[0],W)),this.updateDimensionLineComponent(N,this.getModelPoint(n[0],k),this.getModelPoint(n[0],W));var j=this.getModelPoint(o[0],o[1]),z=r[0],X=n[0];r[0]>n[0]&&(z=n[0],X=r[0]);var q=o[0]+U/2>X+S/2,Y=o[0]-U/2<z-S/2,Z=[],K=[];if(q||Y?(this.updateDimensionLineComponent(w,this.getModelPoint(r[0],o[1]),this.getModelPoint(n[0],o[1])),a.vec3.add(j,a.vec3.scale(E,-x/2,a.vec3.create())),q?this.updateDimensionLineComponent(w,this.getModelPoint(z,o[1]),this.getModelPoint(o[0]-U/2,o[1])):Y&&this.updateDimensionLineComponent(w,this.getModelPoint(X,o[1]),this.getModelPoint(o[0]+U/2,o[1]))):(q=o[0]+U/2>X-S/2,Y=o[0]-U/2<z+S/2,q?(Z.push(this.getModelPoint(z,o[1])),Z.push(this.getModelPoint(o[0]-U/2,o[1]))):Y?(Z.push(this.getModelPoint(o[0]+U/2,o[1])),Z.push(this.getModelPoint(X,o[1]))):Z=[this.getModelPoint(z,o[1]),this.getModelPoint(o[0]-U/2,o[1]),this.getModelPoint(o[0]+U/2,o[1]),this.getModelPoint(X,o[1])],a.vec3.add(j,a.vec3.scale(E,-x/2,a.vec3.create()))),this.preferences&&this.preferences.displayLimitRangeTicks){var Q=this.displayData.value<0?-1:1;if(this.displayData.hasMinimumLimit){if(this.displayData.minimumLimit<0)se(0,0,($=Q<0?n:r)[0],$[1],Z),se(Q*this.displayData.minimumLimit,0,r[0],r[1],Z);se(Q*this.displayData.minimumLimit,-_,r[0],r[1],K),se(Q*this.displayData.minimumLimit,_,r[0],r[1],K)}if(this.displayData.hasMaximumLimit){var $;if(this.displayData.maximumLimit>0)se(0,0,($=Q<0?r:n)[0],$[1],Z),se(Q*this.displayData.maximumLimit,0,r[0],o[1],Z);se(Q*this.displayData.maximumLimit,-_,r[0],r[1],K),se(Q*this.displayData.maximumLimit,_,r[0],r[1],K)}}Z.length>0&&this.updateDimensionComponent(w,y,(0,f.createLines)(Z,void 0,this.getLineColor(),this.getLineWidth(),this.getLineStyle()),D);var J="dimensionLine0_TICK";K.length>0?this.updateDimensionComponent(J,y,(0,f.createLines)(K,void 0,this.getLineColor(),this.getLineWidth()),D):this.removeDimensionComponent(J);var ee=a.vec3.subtract(j,a.vec3.scale(v,.5*B,a.vec3.create()),a.vec3.create()),te=a.vec3.subtract(j,a.vec3.scale(v,.5*-B,a.vec3.create()),a.vec3.create()),ie=a.vec3.add(ee,a.vec3.scale(E,x,a.vec3.create()),a.vec3.create()),re=(0,f.orientText)(e,v,E,this.transform);this.updateDimensionComponent(P,m,(0,f.createQuad)(ee,te,ie,void 0,[re[0]?F.rightCoordinate:F.leftCoordinate,re[1]?F.topCoordinate:F.bottomCoordinate],[re[0]?F.leftCoordinate:F.rightCoordinate,re[1]?F.bottomCoordinate:F.topCoordinate]),this.textNodeProperties)}function ne(e,t,i,r){var n=O.getModelPoint(i,r);return a.vec3.add(n,a.vec3.add(a.vec3.scale(d,e,a.vec3.create()),a.vec3.scale(p,t,a.vec3.create())))}function oe(e,t,i,r){for(var n=ne(e,t,i,r),o=0;o<3;++o)M.push(n[o])}function se(e,t,i,r,n){var o=ne(e,t,i,r);n.push(o)}},t.prototype.onDragText=function(e,t){if(!I){var i=this.mouseToDimensionCoordinates(t.mouseX,t.mouseY,t.camera);i&&(this.displayData.positionX=i[0],this.displayData.positionY=i[1],this.updateOnNextDraw=!0,(0,f.requestDraw)())}},t.prototype.getLabelPositionInPlane=function(){return a.mat3.multiplyVec2(this.dimensionMatrix,[this.displayData.positionX,this.displayData.positionY],a.vec2.create())},t.prototype.getFitBounds=function(){var e=new f.BoundingBox;return this.addPointToBounds(this.getModelPoint(this.displayData.positionX,this.displayData.positionY),e),this.addPointToBounds(this.getModelPoint(this.displayData.witnessEndPoint0X,this.displayData.witnessEndPoint0Y),e),this.addPointToBounds(this.getModelPoint(this.displayData.witnessEndPoint1X,this.displayData.witnessEndPoint1X),e),e},t}(F);t.LinearDimension=x;var U=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.id="CenterlineDimension",n}return(0,r.__extends)(t,e),t.prototype.getTextPrefix=function(e){return""},t}(x);t.CenterlineDimension=U;var G=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="EllipseDiameterDimension",n}return(0,r.__extends)(t,e),t}(x);t.EllipseDiameterDimension=G;var H=function(e,t){return[Math.cos(e)*t,Math.sin(e)*t]},V=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n}return(0,r.__extends)(t,e),t.prototype.onDragText=function(e,t){if(!I){var i=this.mouseToDimensionCoordinates(t.mouseX,t.mouseY,t.camera);i&&(this.displayData.positionR=Math.sqrt(i[0]*i[0]+i[1]*i[1]),this.displayData.positionT=Math.atan2(i[1],i[0]),this.updateOnNextDraw=!0,(0,f.requestDraw)())}},t.prototype.getLabelPositionInPlane=function(){var e=H(this.displayData.positionT,this.displayData.positionR);return a.mat3.multiplyVec2(this.dimensionMatrix,[e[0],e[1]],a.vec2.create())},t.prototype.getModelPointFromPolar=function(e,t){var i=this.displayData.coordinateSystem.getGlMatrix(),r=this.displayData.planeMatrix.getGlMatrix(),n=[t*Math.cos(e),t*Math.sin(e)],o=a.mat3.multiplyVec2(i,n,a.vec2.create());return a.mat4.multiplyVec3(r,[o[0],o[1],0],a.vec3.create())},t}(F);t.PolarDimension=V;var k=function(e){return e-2*(0,f.floorTowardsZero)(e/(2*Math.PI))*Math.PI},W=function(e,t,i){var r=(e+t)/2,n=(0,f.closestAngle)(i,r),o=Math.abs(t-e),s=0,a=0,c=0;if(2*Math.abs(n-r)>o){c=i;var l=(0,f.closestAngle)(e,c),u=(0,f.closestAngle)(t,c);s=Math.abs(l-c)<Math.abs(u-c)?l:u,a=Math.floor(1+(L.getNumber("DIMENSION_ARC_WITNESS_SEGMENTS")-1)*Math.abs(c-s)/(2*Math.PI))}return{firstAngle:s,secondAngle:c,segments:a}},j=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="RadialDimension",n}return(0,r.__extends)(t,e),t.prototype.updateFromDisplayData=function(e){this.displayData=e,this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()},t.prototype.getPosition=function(){return a.vec2.create(H(this.displayData.positionT,this.displayData.positionR))},t.prototype.getRoundedDimensionValueForTextDisplay=function(e,t){return(0,d.roundTo)(e,t.getLengthUnitsDisplayPrecision())},t.prototype.getDimensionUnits=function(e){return e.getLengthUnits()},t.prototype.update=function(e,t){if(this.displayData){var i=this.displayData.value,r=this.getPosition(),n=H(this.displayData.positionT,1),o=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(r[0],r[1]))),s=this.getModelPoint(0,0),c=H(this.displayData.positionT+Math.PI/2,1),h=a.vec3.normalize(a.vec3.subtract(this.getModelPoint(n[0],n[1]),s)),d=a.vec3.normalize(a.vec3.subtract(this.getModelPoint(c[0],c[1]),s)),p=this.getVisualRightVector(),g=this.getVisualUpVector(),v=L.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*o,E=L.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*o;if(E>i*L.getNumber("DIMENSION_ARROW_MAX_PROPORTION")){var I=i*L.getNumber("DIMENSION_ARROW_MAX_PROPORTION")/E;v*=I,E*=I}var T=[],S=this,_=function(e,t,i,r){for(var n=S.getModelPoint(i,r),o=a.vec3.add(n,a.vec3.add(a.vec3.scale(h,e,a.vec3.create()),a.vec3.scale(d,t,a.vec3.create()))),s=0;s<3;++s)T.push(o[s])},M=(0,l.convertFromBase)(i,t.getLengthUnits()),O=i,w=this.displayData.radiusDisplay===u.GBTRadiusDisplay.DIAMETRAL,b=w&&!this.displayData.realDiameter,F="R";w&&(F="",b?M*=2:O/=2);var B,x,U,G=this.updateTextTexture(M,t,F),V=o*G.filledWidthPx,k=o*G.filledHeightPx,j=this.getTextGap(h,p,V,k);if(this.displayData.positionR-j/2>O)B=H(this.displayData.positionT,O),x=H(this.displayData.positionT,this.displayData.positionR-j/2),_(0,0,B[0],B[1]),_(E,.5*-v,B[0],B[1]),_(E,.5*v,B[0],B[1]),this.updateDimensionComponent(C,"",(0,f.createTriangles)(T,[0,1,2],void 0,this.getArrowColor()),A),this.updateDimensionLineComponent(R,this.getModelPoint(B[0],B[1]),this.getModelPoint(x[0],x[1])),U=this.getModelPoint(r[0],r[1]),a.vec3.add(U,a.vec3.scale(g,-k/2,a.vec3.create()));else{B=[0,0],w&&(B=H(Math.PI+this.displayData.positionT,O)),x=H(this.displayData.positionT,O),_(0,0,B[0],B[1]),_(E,.5*-v,B[0],B[1]),_(E,.5*v,B[0],B[1]),_(0,0,x[0],x[1]),_(-E,.5*-v,x[0],x[1]),_(-E,.5*v,x[0],x[1]),this.updateDimensionComponent(C,"",(0,f.createTriangles)(T,[0,1,2,3,4,5],void 0,this.getArrowColor()),A),U=this.getModelPoint(r[0],r[1]);var z=H(this.displayData.positionT,this.displayData.positionR-j/2),X=H(this.displayData.positionT,this.displayData.positionR+j/2),q=[],Y=this.getModelPoint(B[0],B[1]),Z=this.getModelPoint(x[0],x[1]),K=this.getModelPoint(z[0],z[1]),Q=this.getModelPoint(X[0],X[1]);(!w&&this.displayData.positionR-j/2>0||w)&&(q.push(Y),q.push(K)),this.displayData.positionR+j/2<O&&(q.push(Q),q.push(Z)),this.updateDimensionComponent(R,y,(0,f.createLines)(q,void 0,this.getLineColor(),this.getLineWidth(),this.getLineStyle()),D),a.vec3.add(U,a.vec3.scale(g,-k/2,a.vec3.create()))}if(!w){var $=W(this.displayData.witnessEndPoint0t,this.displayData.witnessEndPoint1t,this.displayData.positionT),J=(0,f.createArc)(s,this.displayData.witnessEndPoint1r,a.mat4.multiplyVec3(this.getPlaneMatrix(),[0,0,1],a.vec3.create()),p,$.firstAngle,$.secondAngle,$.segments);(0,f.addColorToIncrement)(this.getLineColor(),J),this.getLineStyle()&&(0,f.addStyleToIncrement)(this.getLineStyle(),J),this.updateDimensionComponent(N,y,J,D)}var ee=a.vec3.subtract(U,a.vec3.scale(p,.5*V,a.vec3.create()),a.vec3.create()),te=a.vec3.subtract(U,a.vec3.scale(p,.5*-V,a.vec3.create()),a.vec3.create()),ie=a.vec3.add(ee,a.vec3.scale(g,k,a.vec3.create()),a.vec3.create()),re=(0,f.orientText)(e,p,g,this.transform);this.updateDimensionComponent(P,m,(0,f.createQuad)(ee,te,ie,void 0,[re[0]?G.rightCoordinate:G.leftCoordinate,re[1]?G.topCoordinate:G.bottomCoordinate],[re[0]?G.leftCoordinate:G.rightCoordinate,re[1]?G.bottomCoordinate:G.topCoordinate]),this.textNodeProperties)}},t.prototype.getFitBounds=function(){var e=new f.BoundingBox;return this.addPointToBounds(this.getModelPointFromPolar(this.displayData.positionT,this.displayData.positionR),e),e},t}(V);t.RadialDimension=j;var z=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="AngularDimension",n}return(0,r.__extends)(t,e),t.prototype.updateFromDisplayData=function(e){this.displayData=e,this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()},t.prototype.getDisplayValue=function(e,t){return(0,l.convertFromBase)(e,t.getAngleUnits())},t.prototype.getTextSuffix=function(e){var t=e.getAngleUnits(),i=t?t.toLowerCase():"";return"degree"===i?t="":"radian"===i&&(t=" radian"),t},t.prototype.addArcLengthAnnotation=function(e,t,i,r,n,o,s,a){return 0},t.prototype.isArcLengthDimension=function(){return!1},t.prototype.getPosition=function(){return a.vec2.create(H(this.displayData.positionT,this.displayData.positionR))},t.prototype.getRoundedDimensionValueForTextDisplay=function(e,t){return this.isArcLengthDimension()?(0,d.roundTo)(e,t.getLengthUnitsDisplayPrecision()):(0,d.roundTo)(e,t.getAngleUnitsDisplayPrecision())},t.prototype.getDimensionUnits=function(e){return e.getAngleUnits()},t.prototype.update=function(e,t){var i=this;if(this.displayData){var r=this.displayData.value,n=this.getPosition(),o=k(this.displayData.witnessEndPoint0t),s=k(this.displayData.witnessEndPoint1t),c=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(n[0],n[1]))),l=this.getTextPrefix(t),u=this.getTextSuffix(t),h=this.getDisplayValue(r,t),d=this.updateTextTexture(h,t,l,u),p=c*d.filledWidthPx,g=c*d.filledHeightPx,v=L.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*c,E=L.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*c,I=s-o,T=Math.abs(I*this.displayData.positionR)*L.getNumber("DIMENSION_ARROW_MAX_PROPORTION");if(E>T){var S=T/E;v*=S,E*=S}var _=1;o>s&&(_=-1);var M=[],O=this,w=function(e,t,i,r){var n=H(i,r),o=[Math.cos(i),Math.sin(i)],s=[-o[1]*_,o[0]*_];n=a.vec2.add(n,a.vec2.add(a.vec2.scale(o,t,a.vec2.create()),a.vec2.scale(s,e,a.vec2.create())));for(var c=O.getModelPoint(n[0],n[1]),l=0;l<3;++l)M.push(c[l])},b=E/this.displayData.positionR;w(0,0,o,this.displayData.positionR),w(0,.5*-v,o+b*_,this.displayData.positionR),w(0,.5*v,o+b*_,this.displayData.positionR),w(0,0,s,this.displayData.positionR),w(0,.5*-v,s-b*_,this.displayData.positionR),w(0,.5*v,s-b*_,this.displayData.positionR),this.updateDimensionComponent(C,"",(0,f.createTriangles)(M,[0,1,2,3,4,5],void 0,this.getArrowColor()),A);var F,x,U=this.getScreenSpaceParameters(t,c),G=this.displayData.positionR+(this.displayData.witnessEndPoint0r<this.displayData.positionR?U.extension:-U.extension),V=this.displayData.positionR+(this.displayData.witnessEndPoint1r<this.displayData.positionR?U.extension:-U.extension);if(this.isArcLengthDimension())F=this.displayData.witnessEndPoint0r+(this.displayData.witnessEndPoint0r>this.displayData.positionR?-U.gap:U.gap),x=this.displayData.witnessEndPoint1r+(this.displayData.witnessEndPoint1r>this.displayData.positionR?-U.gap:U.gap);else{var j=this.displayData.witnessMaxPoint0r+U.gap,z=this.displayData.witnessMinPoint0r-U.gap,X=this.displayData.witnessMaxPoint1r+U.gap,q=this.displayData.witnessMinPoint1r-U.gap;F=this.displayData.positionR>j?j:this.displayData.positionR<z?z:G,x=this.displayData.positionR>X?X:this.displayData.positionR<q?q:V}var Y=function(e,t,r,n){i.updateDimensionLineComponent(e,i.getModelPointFromPolar(t,r),i.getModelPointFromPolar(t,n))};Y(R,o,F,G),Y(N,s,x,V);var Z=this.getModelPointFromPolar(this.displayData.positionT,this.displayData.positionR),K=this.getModelPointFromPolar(this.displayData.positionT,2*this.displayData.positionR);K=a.vec3.normalize(a.vec3.subtract(K,Z));var Q=-Math.sin(this.displayData.positionT),$=Math.cos(this.displayData.positionT),J=a.vec3.normalize(a.vec3.subtract(this.getModelPoint(n[0]+Q,n[1]+$),Z)),ee=this.getVisualRightVector(),te=this.getVisualUpVector(),ie=this.getTextGap(J,ee,p,g),re=new B,ne=this.displayData.positionR,oe=(0,f.orientText)(e,ee,te,this.transform),se=(ie+=this.addArcLengthAnnotation(oe[1],-this.displayData.coordinateSystem.m00,-this.displayData.coordinateSystem.m01,p,g,this.displayData.positionT,ne,this.displayData.clockwise))/2/this.displayData.positionR,ae=Math.abs(2*Math.asin(se));isNaN(ae)&&(ae=0);var ce=this.displayData.positionT;if(_>0)for(;ce+ae/2<0;)ce+=2*Math.PI;else for(;ce-ae/2>0;)ce-=2*Math.PI;var le=ce+ae/2,ue=ce-ae/2;if(Math.abs(se)>1||_>0&&le<o||_>0&&ue>s||_<0&&ue>o||_<0&&le<s){var he=W(k(this.displayData.witnessEndPoint0t),k(this.displayData.witnessEndPoint1t),ce);0!==he.secondAngle&&(he.secondAngle+=he.firstAngle>he.secondAngle?ae/2:-ae/2),this.makeArc(he.firstAngle,he.secondAngle,re),this.makeArc(o,s,re),a.vec3.add(Z,a.vec3.scale(te,-g/2,a.vec3.create()))}else(_>0&&ce-ae/2>o||_<0&&ce+ae/2<o)&&this.makeArc(o,ce-_*ae/2,re),(_>0&&ce+ae/2<s||_<0&&ce-ae/2>s)&&this.makeArc(ce+_*ae/2,s,re),a.vec3.add(Z,a.vec3.scale(te,-g/2,a.vec3.create()));var de=a.vec3.subtract(Z,a.vec3.scale(ee,.5*p,a.vec3.create()),a.vec3.create()),pe=a.vec3.subtract(Z,a.vec3.scale(ee,.5*-p,a.vec3.create()),a.vec3.create()),ge=a.vec3.add(de,a.vec3.scale(te,g,a.vec3.create()),a.vec3.create()),fe=new f.MeshIncrement(f.PrimitiveType.LINES,re.points,re.indices);(0,f.addColorToIncrement)(this.getLineColor(),fe),(0,f.addSizeToIncrement)(this.getLineWidth(),fe),this.getLineStyle()&&(0,f.addStyleToIncrement)(this.getLineStyle(),fe),this.updateDimensionComponent("arc",y,fe,D),this.updateDimensionComponent(P,m,(0,f.createQuad)(de,pe,ge,void 0,[oe[0]?d.rightCoordinate:d.leftCoordinate,oe[1]?d.topCoordinate:d.bottomCoordinate],[oe[0]?d.leftCoordinate:d.rightCoordinate,oe[1]?d.bottomCoordinate:d.topCoordinate]),this.textNodeProperties)}},t.prototype.getFitBounds=function(){var e=new f.BoundingBox;return this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint0t,this.displayData.witnessEndPoint0r),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint1t,this.displayData.witnessEndPoint1r),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint0t,this.displayData.positionR),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint1t,this.displayData.positionR),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.positionT,this.displayData.positionR),e),e},t.prototype.makeArc=function(e,t,i){var r=i.getIndexOffset(),n=e,o=Math.max(Math.floor(g.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE*Math.abs(t-e)/(2*Math.PI)+1),0);isNaN(o)&&(o=0);for(var s=new Array(3*(o+1)),a=(t-e)/o,c=0;c<o+1;++c){for(var l=this.getModelPointFromPolar(n,this.displayData.positionR),u=0;u<3;++u)s[3*c+u]=l[u];n+=a}var h,d=new Array(2*o);for(d[0]=r,h=1;h<o;h++)d[2*h-1]=h+r,d[2*h]=h+r;d[d.length-1]=h+r,i.concat(s,d)},t}(V);t.AngularDimension=z;var X=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="ArcLengthDimension",n}return(0,r.__extends)(t,e),t.prototype.getDisplayValue=function(e,t){return(0,l.convertFromBase)(e,t.getLengthUnits())},t.prototype.getTextSuffix=function(e){return""},t.prototype.isArcLengthDimension=function(){return!0},t.prototype.getDimensionUnits=function(e){return e.getLengthUnits()},t.prototype.addArcLengthAnnotation=function(e,t,i,r,n,o,s,c){var l=new B,u=a.vec2.createFrom(t,i),h=a.vec2.createFrom(i,-t),d=L.getNumber("DIMENSION_ARC_LENGTH_SCALE"),p=H(this.displayData.positionT,s);c&&(a.vec2.scale(u,-1),a.vec2.scale(h,-1)),e&&(a.vec2.scale(u,-1),a.vec2.scale(h,-1));var g=a.vec2.create();a.vec2.add(p,a.vec2.scale(u,d*r/2,a.vec2.create()),g),a.vec2.add(g,a.vec2.scale(h,n/2,a.vec2.create()),g);var y=a.vec2.create();a.vec2.add(p,a.vec2.scale(u,-d*r/2,a.vec2.create()),y),a.vec2.add(y,a.vec2.scale(h,n/2,a.vec2.create()),y),a.vec2.add(p,a.vec2.scale(h,n*d,a.vec2.create()),p),this.makeThreePointArc(g,p,y,l);var v=new f.MeshIncrement(f.PrimitiveType.LINES,l.points,l.indices);return(0,f.addColorToIncrement)(this.getLineColor(),v),(0,f.addSizeToIncrement)(this.getLineWidth(),v),this.updateDimensionComponent(_,m,v,D),n*(d-.5+L.getNumber("DIMENSION_TEXT_GAP"))},t}(z);t.ArcLengthDimension=X;var q=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.id="PointDimension",n}return(0,r.__extends)(t,e),t.prototype.updateFromDisplayData=function(e){this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()},t.prototype.isLengthDimension=function(){return!0},t.prototype.update=function(e,t){var i=this.getDisplayData();if(i){var r,n=this.getPosition(),o=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(n[0],n[1]))),s=i.value,c=L.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*o,l=L.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*o;l>s*L.getNumber("DIMENSION_ARROW_MAX_PROPORTION")&&this.isLengthDimension()&&(c*=r=s*L.getNumber("DIMENSION_ARROW_MAX_PROPORTION")/l,l*=r);var u=this.getModelPoint(0,0),h=a.vec3.normalize(a.vec3.subtract(this.getModelPoint(1,0),u)),d=a.vec3.normalize(a.vec3.subtract(this.getModelPoint(0,1),u)),p=this.getTextureInfoForLabel(s,t),g=o*p.filledWidthPx,v=o*p.filledHeightPx,E=v/2;this.wantArcLengthSymbol()&&(E=this.addArcLengthSymbol(n,g,v));var I,T,S=this.getModelPoint(n[0],n[1]),_=a.vec3.scale(h,.5*g,a.vec3.create()),M=a.vec3.scale(d,.5*v,a.vec3.create()),O=a.vec3.subtract(a.vec3.subtract(S,_,a.vec3.create()),M,a.vec3.create()),N=a.vec3.subtract(a.vec3.add(S,_,a.vec3.create()),M,a.vec3.create()),w=a.vec3.add(a.vec3.subtract(S,_,a.vec3.create()),M,a.vec3.create()),b=this.getModelPoint(0,0),F=a.vec3.scale(d,E,a.vec3.create()),B=[];B.push(a.vec3.subtract(S,_,a.vec3.create())),B.push(a.vec3.add(S,_,a.vec3.create())),B.push(a.vec3.subtract(S,M,a.vec3.create())),B.push(a.vec3.add(S,F,a.vec3.create())),B.forEach((function(e){var t=a.vec3.squaredLength(a.vec3.subtract(e,b,a.vec3.create()));(!I||t<I)&&(I=t,T=e)}));var x=[],U=a.vec3.normalize(a.vec3.subtract(T,b,a.vec3.create()),a.vec3.create()),G=a.mat4.multiplyVec3(this.getPlaneMatrix(),[0,0,1]),H=a.vec3.normalize(a.vec3.cross(U,G,a.vec3.create()),a.vec3.create()),V=this,k=function(e,t,i,r){for(var n=V.getModelPoint(i,r),o=a.vec3.add(n,a.vec3.add(a.vec3.scale(U,e,a.vec3.create()),a.vec3.scale(H,t,a.vec3.create()))),s=0;s<3;++s)x.push(o[s])};k(0,0,0,0),k(l,.5*-c,0,0),k(l,.5*c,0,0),this.updateDimensionComponent(C,"",(0,f.createTriangles)(x,[0,1,2],void 0,this.getArrowColor()),A),this.updateDimensionComponent(R,y,this.createComponentLine(b,T),D);var W=(0,f.orientText)(e,h,d,this.transform);this.updateDimensionComponent(P,m,(0,f.createQuad)(O,N,w,void 0,[W[0]?p.rightCoordinate:p.leftCoordinate,W[1]?p.topCoordinate:p.bottomCoordinate],[W[0]?p.leftCoordinate:p.rightCoordinate,W[1]?p.bottomCoordinate:p.topCoordinate]),this.textNodeProperties)}},t.prototype.getTextureInfoForLabel=function(e,t){var i=(0,l.convertFromBase)(e,t.getLengthUnits());return this.updateTextTexture(i,t)},t.prototype.getFitBounds=function(){var e=new f.BoundingBox;this.addPointToBounds(this.getModelPoint(0,0),e);var t=this.getPosition();return this.addPointToBounds(this.getModelPoint(t[0],t[1]),e),e},t.prototype.wantArcLengthSymbol=function(){return!1},t.prototype.getDisplayData=function(){return null},t.prototype.getPosition=function(){return null},t.prototype.setPosition=function(e){},t.prototype.addArcLengthSymbol=function(e,t,i){var r=L.getNumber("DIMENSION_ARC_LENGTH_SCALE"),n=a.vec2.createFrom(e[0]-r*t/2,e[1]+i/2),o=a.vec2.createFrom(e[0],e[1]+r*i),s=a.vec2.createFrom(e[0]+r*t/2,n[1]),c=new B;this.makeThreePointArc(n,o,s,c);var l=new f.MeshIncrement(f.PrimitiveType.LINES,c.points,c.indices);return(0,f.addColorToIncrement)(this.getLineColor(),l),(0,f.addSizeToIncrement)(this.getLineWidth(),l),this.updateDimensionComponent(_,m,l,D),i*(r+L.getNumber("DIMENSION_TEXT_GAP"))},t.prototype.onDragText=function(e,t){if(!I){var i=this.mouseToDimensionCoordinates(t.mouseX,t.mouseY,t.camera);i&&(this.setPosition(i),this.updateOnNextDraw=!0,(0,f.requestDraw)())}},t.prototype.getLabelPositionInPlane=function(){return a.mat3.multiplyVec2(this.dimensionMatrix,this.getPosition(),a.vec2.create())},t}(F);t.PointDimension=q;var Y=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="RhoDimension",n}return(0,r.__extends)(t,e),t.prototype.isLengthDimension=function(){return!1},t.prototype.updateFromDisplayData=function(t){this.displayData=t,e.prototype.updateFromDisplayData.call(this,t)},t.prototype.getDisplayData=function(){return this.displayData},t.prototype.getPosition=function(){return a.vec2.createFrom(this.displayData.positionX,this.displayData.positionY)},t.prototype.setPosition=function(e){this.displayData.positionX=e[0],this.displayData.positionY=e[1]},t.prototype.getRoundedDimensionValueForTextDisplay=function(e,t){return(0,d.roundTo)(e,t.getLengthUnitsDisplayPrecision())},t.prototype.getDimensionUnits=function(e){return""},t.prototype.getTextureInfoForLabel=function(e,t){return this.updateTextTexture(e,t,"Rho ")},t}(q);t.RhoDimension=Y;var Z=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="CurveLengthDimension",n}return(0,r.__extends)(t,e),t.prototype.wantArcLengthSymbol=function(){return!this.isForPreview()},t.prototype.isLengthDimension=function(){return!0},t.prototype.getRoundedDimensionValueForTextDisplay=function(e,t){return(0,d.roundTo)(e,t.getLengthUnitsDisplayPrecision())},t.prototype.getDimensionUnits=function(e){return e.getLengthUnits()},t.prototype.getTextureInfoForLabel=function(e,t){if(this.isForPreview())return this.updateRawTextTexture("");var i=(0,l.convertFromBase)(e,t.getLengthUnits());return this.updateTextTexture(i,t)},t.prototype.updateFromDisplayData=function(t){this.displayData=t,e.prototype.updateFromDisplayData.call(this,t)},t.prototype.getDisplayData=function(){return this.displayData},t.prototype.getPosition=function(){return a.vec2.createFrom(this.displayData.positionX,this.displayData.positionY)},t.prototype.setPosition=function(e){this.displayData.positionX=e[0],this.displayData.positionY=e[1]},t}(q);t.CurveLengthDimension=Z;var K=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.displayData=null,n.id="CountDimension",n}return(0,r.__extends)(t,e),t.prototype.getTextureInfoForLabel=function(e,t){return this.updateTextTexture(e,t,void 0,"x")},t.prototype.getRoundedDimensionValueForTextDisplay=function(e,t){return(0,d.roundTo)(e,0)},t.prototype.getDimensionUnits=function(e){return""},t.prototype.updateFromDisplayData=function(t){this.displayData=t,e.prototype.updateFromDisplayData.call(this,t)},t.prototype.getDisplayData=function(){return this.displayData},t.prototype.getPosition=function(){return a.vec2.createFrom(this.displayData.positionX,this.displayData.positionY)},t.prototype.setPosition=function(e){this.displayData.positionX=e[0],this.displayData.positionY=e[1]},t.prototype.canBeDrivenDimension=function(){return!1},t}(q);t.CountDimension=K,t.createDimensionForDisplayData=function(e,t,i,r){r||(r={forPreview:void 0,isMateValue:void 0});var n=null;return e instanceof u.BTArcLengthDimensionDisplayData?n=new X(i,!!r.forPreview,t):e instanceof u.BTCenterlineDimensionDisplayData?n=new U(i,!!r.forPreview,t):e instanceof u.BTEllipseDiameterDimensionDisplayData?n=new G(i,!!r.forPreview,t):e instanceof u.BTLinearDimensionDisplayData?n=new x(i,!!r.forPreview,t):e instanceof u.BTAngularDimensionDisplayData?n=new z(i,!!r.forPreview,t):e instanceof u.BTRadialDimensionDisplayData?n=new j(i,!!r.forPreview,t):e instanceof u.BTCurveLengthDimensionDisplayData?n=new Z(i,!!r.forPreview,t):e instanceof u.BTCountDimensionDisplayData?n=new K(i,!!r.forPreview,t):e instanceof u.BTRhoDimensionDisplayData&&(n=new Y(i,!!r.forPreview,t)),r.isMateValue&&(n.getClearModelSelectionsOnPrehilite=function(){return!1}),n}},289354:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalScreenFacingSpaceQuadGlyphComponent=t.ScreenFacingSpaceQuadGlyphComponent=t.ScreenSpaceQuadGlyphComponent=t.GlyphComponent=t.GLYPH_SELECTION_ID=void 0;var r=i(423902),n=i(911748),o=i(673290),s=i(311611);t.GLYPH_SELECTION_ID="GLYPH";var a=function(e){function t(t,i,r,n,o,s,a){var c=e.call(this,t)||this;return c.glyphResources=i,c.textureId=r,c.pixelSize=n,c.renderPriority=o,c.worldOrigin=s,c.parent=a,c}return(0,r.__extends)(t,e),t.prototype.getModelSelection=function(e){return this.parent?this.parent.getModelSelection(e):null},t.prototype.addHighlight=function(t){e.prototype.addHighlight.call(this,t),this.resetGraphics()},t.prototype.removeHighlight=function(t){return!!e.prototype.removeHighlight.call(this,t)&&(this.resetGraphics(),!0)},t.prototype.onViewWillDraw=function(e){this.isHidden||this.hasBeenRemoved||(this.updateGraphics(),this.adjustTransform(e))},t.prototype.setWorldOrigin=function(e){n.vec3.distanceSquared(this.worldOrigin,e)>o.Tolerances.ZERO_LENGTH_SQUARED&&(this.worldOrigin=e,this.resetGraphics())},Object.defineProperty(t.prototype,"highlightStateId",{get:function(){var e=this.getHighlight();return e&&e.type===s.HighlightType.PRE?s.GlyphHighlightStates.PRE_HIGHLIGHT:e?s.GlyphHighlightStates.HIGHLIGHT:s.GlyphHighlightStates.NO_HIGHLIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glyphStateId",{get:function(){return s.GlyphStates.NORMAL},enumerable:!1,configurable:!0}),t.prototype.resetGraphics=function(){this.removeMeshIncrements(),this.updateGraphics()},t.prototype.updateGraphics=function(){!this.hasMeshIncrements()&&this.glyphResources.atlasReady&&this.instantiateMeshIncrements()},t}(s.UIElement);t.GlyphComponent=a;var c=function(e){function i(t,i,r,n,o,s,a,c,l){var u=e.call(this,t,i,r,n,o,s,l)||this;return u.worldXAxis=a,u.worldYAxis=c,u}return(0,r.__extends)(i,e),i.prototype.instantiateMeshIncrements=function(){var e=this.glyphResources.getTextureCoordsOffset(this.textureId,this.glyphStateId,this.highlightStateId,0),i="glyphQuad",r=[e.lowS,e.highT],n=[e.highS,e.lowT],o=(0,s.createQuad)([-.5,0,-.5],[.5,0,-.5],[-.5,0,.5],i,r,n),a=this.glyphResources.getNodeProperties(this.highlightStateId,this.glyphStateId,this.renderPriority);this.updateMeshIncrement(i,t.GLYPH_SELECTION_ID,o,a)},i.prototype.adjustTransform=function(e){var t=e.getPixelSizeAtWorldPoint(this.worldOrigin)*this.pixelSize,i=n.vec3.scale(this.worldYAxis,t,n.vec3.create()),r=n.vec3.scale(this.worldXAxis,t,n.vec3.create()),o=n.vec3.scale(n.vec3.normalize(n.vec3.cross(i,r,n.vec3.create())),t),s=n.mat4.createFrom(r[0],r[1],r[2],0,o[0],o[1],o[2],0,i[0],i[1],i[2],0,this.worldOrigin[0],this.worldOrigin[1],this.worldOrigin[2],1);this.setTransform(s)},i}(a);t.ScreenSpaceQuadGlyphComponent=c;var l=function(e){function i(t,i,r,n,o,s,a,c){var l=e.call(this,t,i,r,n,o,s,c)||this;return l.originInGlyph=a,l}return(0,r.__extends)(i,e),i.prototype.instantiateMeshIncrements=function(){var e=this.glyphResources.getTextureCoordsOffset(this.textureId,this.glyphStateId,this.highlightStateId,0),i=[-this.originInGlyph[0],0,-this.originInGlyph[1]],r=[1-this.originInGlyph[0],0,-this.originInGlyph[1]],n=[-this.originInGlyph[0],0,1-this.originInGlyph[1]],o="quad",a=[e.lowS,e.highT],c=[e.highS,e.lowT],l=(0,s.createQuad)(i,r,n,o,a,c);this.updateMeshIncrement(o,t.GLYPH_SELECTION_ID,l,this.glyphResources.getNodeProperties(this.highlightStateId,this.glyphStateId,this.renderPriority))},i.prototype.adjustTransformToAlignUp=function(e,t){var i=e.getPixelSizeAtWorldPoint(this.worldOrigin)*this.pixelSize,r=n.vec3.scale(t,i,n.vec3.create()),o=n.vec3.scale(n.vec3.normalize(n.vec3.cross(e.getForward(),r,n.vec3.create())),i),s=n.vec3.scale(n.vec3.normalize(n.vec3.cross(r,o,n.vec3.create())),i),a=n.mat4.createFrom(o[0],o[1],o[2],0,s[0],s[1],s[2],0,r[0],r[1],r[2],0,this.worldOrigin[0],this.worldOrigin[1],this.worldOrigin[2],1);this.setTransform(a)},i.prototype.adjustTransform=function(e){this.adjustTransformToAlignUp(e,e.getUp())},i}(a);t.ScreenFacingSpaceQuadGlyphComponent=l;var u=function(e){function t(t,i,r,n,o,s,a,c,l){var u=e.call(this,t,i,r,n,o,s,c,l)||this;return u.worldDirection=a,u}return(0,r.__extends)(t,e),t.prototype.adjustTransform=function(e){this.adjustTransformToAlignUp(e,this.worldDirection)},t}(l);t.DirectionalScreenFacingSpaceQuadGlyphComponent=u},905253:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphResources=t.GlyphHighlightStates=t.GlyphStates=void 0;var r,n=i(73055),o=i(311517),s=i(556329),a=i(901893),c=i(144788),l=i(808035),u=i(735297);!function(e){e.NORMAL="NORMAL",e.ERROR="ERROR",e.SUPPRESSED="SUPPRESSED"}(r=t.GlyphStates||(t.GlyphStates={}));var h,d={NORMAL:"",ERROR:"_Error",SUPPRESSED:"_Suppressed"};!function(e){e.NO_HIGHLIGHT="NO_HIGHLIGHT",e.PRE_HIGHLIGHT="PRE_HIGHLIGHT",e.HIGHLIGHT="HIGHLIGHT"}(h=t.GlyphHighlightStates||(t.GlyphHighlightStates={}));var p={NO_HIGHLIGHT_NORMAL:8,NO_HIGHLIGHT_SUPPRESSED:7,NO_HIGHLIGHT_ERROR:6,HIGHLIGHT_NORMAL:5,HIGHLIGHT_SUPPRESSED:4,HIGHLIGHT_ERROR:3,PRE_HIGHLIGHT_NORMAL:2,PRE_HIGHLIGHT_SUPPRESSED:1,PRE_HIGHLIGHT_ERROR:0},g=function(){function e(e,t,i,r,n){this.atlasId=e,this.viewer=t,this.textures=i,this.pixelSize_=r,this.textureAtlasOptions=n,this.material=(0,c.createTextureMaterial)(),this.nodeProperties={},this.initializeTextureAtlas(),this.initializeNodeProperties()}return e.prototype.destroy=function(){this.material&&(this.material.destroy(),this.material=null)},Object.defineProperty(e.prototype,"pixelSize",{get:function(){return this.pixelSize_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atlasReady",{get:function(){return!!this.textureAtlas},enumerable:!1,configurable:!0}),e.prototype.getNodeProperties=function(e,t,i){return this.nodeProperties[this.getNodePropertyKey(e,t,i)]},e.prototype.getTextureCoordsOffset=function(e,t,i,r){return this.textureAtlas.getTextureCoordsOffset(this.getAtlasKey(e,t,i),r)},e.prototype.initializeNodeProperties=function(){for(var e in h)for(var t in r)for(var i=l.RenderOrderPriority.LOWER;i<=l.RenderOrderPriority.DEFAULT;++i){var n=this.getNodePropertyKey(e,t,i),o=this.getZOffsetKey(e,t);this.nodeProperties[n]=new l.NodeProperties({primitiveType:a.PrimitiveType.TRIANGLES,isShowThrough:!0,isDepthTested:!0,isTwoSided:!0,priority:i,primitivesHaveTransparency:!0,material:this.material,zOffset:p[o]})}},e.prototype.initializeTextureAtlas=function(){var e=this;this.viewer.getTextureAtlasFactory().getAtlas(this.atlasId,(function(){var t=[];for(var i in e.textures)for(var n in r)for(var o in h)t.push(e.createAtlasItem(i,n,o));var s=e.textureAtlasOptions?e.textureAtlasOptions:{};return s.sourcesHaveTransparency=!0,(0,u.createAtlasFromResources)(e.viewer,e.pixelSize,t,s)})).then((function(t){e.textureAtlas=t,e.material.ambientTexture=t.texture,e.viewer.requestDraw()})).catch((function(e){o.log.error(e)}))},e.prototype.getNodePropertyKey=function(e,t,i){return e+"_"+t+"_"+i},e.prototype.getZOffsetKey=function(e,t){return e+"_"+t},e.prototype.getAtlasKey=function(e,t,i){return e+s.ID_SEPARATOR+t+s.ID_SEPARATOR+i},e.prototype.getAtlasBackgroundColor=function(e,t){return n.default.getManager().getColorString("GLYPH_"+e+"_"+t+"_BACKGROUND")},e.prototype.getAtlasTextureName=function(e,t,i){return this.textures[e]+d[t]+".png"},e.prototype.createAtlasItem=function(e,t,i){var r=new u.ImageData;return r.id=this.getAtlasKey(e,t,i),r.imageName=this.getAtlasTextureName(e,t,i),r.backgroundColor=this.getAtlasBackgroundColor(t,i),r},e}();t.GlyphResources=g},384783:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLegend=t.DEFAULT_SIMULATION_COLOR_MAPPING=void 0;var r=i(423902),n=i(73055),o=i(689397),s=i(765421),a=i(227441),c=i(507025),l=i(699716),u=i(673290),h=i(311611),d=new h.NodeProperties({primitiveType:h.PrimitiveType.LINES,isPickable:!1});t.DEFAULT_SIMULATION_COLOR_MAPPING=a.GBTSimulationColorMapping.VIRIDIS;var p=function(e){function i(i){var r=e.call(this,i,h.HUD_SCENEGRAPH_ID)||this;return r.tickCount=6,r.tickValues=[],r.colorMapMaterial=(0,h.createTextureMaterial)(),r.colorMapNodeProperties=new h.NodeProperties({primitiveType:h.PrimitiveType.TRIANGLES,material:r.colorMapMaterial}),r.setActiveColorMapping(t.DEFAULT_SIMULATION_COLOR_MAPPING),r}return(0,r.__extends)(i,e),i.prototype.remove=function(){e.prototype.remove.call(this),this.colorMapMaterial.destroy(),this.clearText()},i.prototype.setActiveColorMapping=function(e){this.colorMapMaterial.ambientTexture=this.viewer.getResources().simulationGradientTextures.get(e)},i.prototype.setInputRange=function(e){this.inputRange=e,this.visualizedScalarRange||this.setVisualizedScalarRange(this.inputRange)},i.prototype.setVisualizedScalarRange=function(e){this.visualizedScalarRange=e,this.updateGraphics(this.viewer.getCamera())},i.prototype.clearRanges=function(){this.inputRange=null,this.visualizedScalarRange=null,this.updateGraphics(this.viewer.getCamera())},i.prototype.hide=function(){this.clearText(),this.lastRenderedViewport=null,e.prototype.hide.call(this)},i.prototype.onViewWillDraw=function(e){this.isHidden||(0,c.arraysEqual)(this.lastRenderedViewport,e.getViewport(!0))||this.updateGraphics(e)},i.prototype.getInputRangeInDocumentUnits=function(){if(this.inputRange){var e=(0,o.getCurrentDocumentSettingsModel)().getUnitForSimulatedField(this.visualizedFieldType);return(0,s.convertRangeToUnits)(this.inputRange,e)}return null},i.prototype.updateGraphics=function(e){if(void 0!==this.visualizedFieldType&&!this.isHidden){this.removeMeshIncrements(),this.clearText();var t=n.default.getManager(),i=t.getNumber("SIMULATION_LEGEND_RIGHT_MARGIN_PX"),r=t.getNumber("SIMULATION_LEGEND_TOP_MARGIN_PX"),o=t.getNumber("SIMULATION_LEGEND_COLOR_MAP_WIDTH_PX"),s=t.getNumber("SIMULATION_LEGEND_COLOR_MAP_HEIGHT_PX");this.lastRenderedViewport=e.getViewport(!0).slice();var a=this.lastRenderedViewport[0],c=this.lastRenderedViewport[1],l=a+this.lastRenderedViewport[2]-i,u=c+this.lastRenderedViewport[3]-r,d=l-o,p=u-s,g=(0,h.createQuad)([d,p,0],[l,p,0],[d,u,0],"colorMap",[0,1],[1,0]);this.updateMeshIncrement("colorMap","legend",g,this.colorMapNodeProperties),this.addTicks(d,p,u)}},i.prototype.clearText=function(){for(var e=0;e<this.tickValues.length;++e)this.tickValues[e].remove(),this.stopListening(this.tickValues[e]);this.tickValues=[]},i.prototype.addTicks=function(e,t,i){for(var r=this,o=n.default.getManager(),s=o.getNumber("SIMULATION_LEGEND_TICK_LENGTH_PX"),a=o.getNumber("SIMULATION_LEGEND_TICK_TEXT_GAP_PX"),c=1/(this.tickCount-1),p=e,g=p-s,f=g-a,m=(0,l.getDevicePixelRatio)(),y=i-t-1*m,v=t,E=o.getNumber("SIMULATION_LEGEND_TICK_TEXT_UNDERLINE_WIDTH_PX"),I=o.getColor("SIMULATION_LEGEND_TICK_TEXT_BACKGROUND_COLOR"),T=o.getNumber("SIMULATION_LEGEND_TICK_TEXT_BACKGROUND_BORDER_RADIUS_PX"),S=o.getNumber("SIMULATION_LEGEND_TICK_TEXT_BACKGROUND_PADDING_PX"),P={color:o.getColor("SIMULATION_LEGEND_TICK_TEXT_COLOR"),size:o.getNumber("SIMULATION_LEGEND_TICK_TEXT_HEIGHT_PX"),font:o.getString("SIMULATION_LEGEND_TICK_TEXT_FONT"),backgroundColor:I,backgroundOpacity:I[3],backgroundRadius:T,paddingWithinBorder:S},_={color:o.getColor("SIMULATION_LEGEND_TICK_CLICKABLE_TEXT_COLOR"),size:o.getNumber("SIMULATION_LEGEND_TICK_TEXT_HEIGHT_PX"),font:o.getString("SIMULATION_LEGEND_TICK_TEXT_FONT"),underlineWidth:E,backgroundColor:I,backgroundOpacity:I[3],backgroundRadius:T,paddingWithinBorder:S},M={color:P.color,size:P.size,font:P.font,fontWeight:o.getString("SIMULATION_LEGEND_TICK_TEXT_HOVER_WEIGHT"),underlineWidth:E,backgroundColor:I,backgroundOpacity:I[3],backgroundRadius:T,paddingWithinBorder:S},D=function(e){var t=c*e,i=Math.round(v+t*y)+.5*m,n=(0,h.createLine)([g,i,0],[p,i,0]);if(C.updateMeshIncrement("Tick"+e,h.NO_SELECTION_ID,n,d),(0,h.addSizeToIncrement)(o.getNumber("SIMULATION_LEGEND_TICK_WIDTH"),n),!C.visualizedScalarRange)return"continue";var s=e===C.tickCount-1||0===e,a=C.visualizedScalarRange.min+t*C.visualizedScalarRange.magnitude,l=C.formatValue(a),E=C.getInputRangeInDocumentUnits();E&&(0===e&&Math.abs(E.min-C.visualizedScalarRange.min)>u.Tolerances.ZERO_LENGTH||e===C.tickCount-1&&Math.abs(E.max-C.visualizedScalarRange.max)>u.Tolerances.ZERO_LENGTH)&&(l+="*");var I=s?_:P,T=new h.Text2D(C.viewer,l,I);if(T.positionRelativeTo([f,i+.5*m,0],h.BoundingSpot.HIGH,h.BoundingSpot.MID),s){var S=0===e?h.SIMULATION_MINIMUM_CLICKED:h.SIMULATION_MAXIMUM_CLICKED;C.listenTo(T,h.UiEvents.MOUSE_ENTER+h.Text2D.SELECTION_ID,(function(){r.viewer.pushCursor(h.Cursor.POINTER),T.updateWithOptions(M)})),C.listenTo(T,h.UiEvents.MOUSE_LEAVE+h.Text2D.SELECTION_ID,(function(){r.viewer.popCursor(),T.updateWithOptions(_)})),C.listenTo(T,h.UiEvents.CLICK+h.Text2D.SELECTION_ID,(function(e,t){r.viewer.getEventDispatcher().trigger(S,t.sourceEvent,E,T.getTextCenterInCanvas())}))}C.tickValues.push(T)},C=this,O=0;O<this.tickCount;++O)D(O)},i.prototype.formatValue=function(e){return e<u.Tolerances.ZERO_LENGTH?(0).toPrecision(3):e<.1?e.toExponential(3):e.toPrecision(3)},i}(h.UIElement);t.SimulationLegend=p},325357:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadDisplay=t.LoadTextures=void 0;var r,n=i(423902),o=i(73055),s=i(911748),a=i(311517),c=i(712197),l=i(227441),u=i(376931),h=i(673290),d=i(311611),p=[1,0,0],g=[0,1,0],f=[0,0,1],m=[0,1,0];!function(e){e.ACCELERATION_ARROW="ACCELERATION_ARROW",e.ACCELERATION_BEHIND="ACCELERATION_BEHIND",e.BEARING_ARROWS="BEARING_ARROWS",e.FORCE_ARROW="FORCE_ARROW",e.MOMENT_BASE="MOMENT_BASE",e.PRESSURE="PRESSURE",e.ROUND_BASE="ROUND_BASE"}(r||(r={})),t.LoadTextures={},t.LoadTextures[r.ACCELERATION_ARROW]="simulation/acceleration-arrow",t.LoadTextures[r.ACCELERATION_BEHIND]="simulation/acceleration-behind",t.LoadTextures[r.BEARING_ARROWS]="simulation/bearing-arrows",t.LoadTextures[r.FORCE_ARROW]="simulation/force-arrow",t.LoadTextures[r.MOMENT_BASE]="simulation/moment-base",t.LoadTextures[r.PRESSURE]="simulation/pressure",t.LoadTextures[r.ROUND_BASE]="simulation/base";var y=o.default.getManager().getNumber("SIMULATION_LOAD_LEADER_OFFSET_RATIO"),v=new d.NodeProperties({primitiveType:d.PrimitiveType.LINES,isShowThrough:!1,isDepthTested:!0,isPickable:!1}),E=v.cloneAndModify({isShowThrough:!0,isDepthTested:!1,isStencilTested:!0}),I="obliqueBaseLine",T=Math.cos((0,d.toRadians)(90-o.default.getManager().getNumber("SIMULATION_LOAD_OBLIQUE_BASE_LINE_ANGLE_THRESHOLD_DEGREES"))),S=o.default.getManager().getColor("SIMULATION_LOAD_BASE_COLOR"),P=o.default.getManager().getColor("SIMULATION_PRE_HIGHLIGHT_COLOR"),_=o.default.getManager().getColor("SIMULATION_HIGHLIGHT_COLOR"),M=v.cloneAndModify({primitiveType:d.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,isPickable:!0}),D="loadComponent",C="lineAxis",O=o.default.getManager().getColor("SIMULATION_LINE_AXIS_COLOR"),A=o.default.getManager().getStipple("SIMULATION_LINE_AXIS_STIPPLE"),R=s.vec3.create(),N=s.vec3.create(),w=s.vec3.create(),b=s.vec3.create(),L=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.loadDisplayData=i,n.hideLoads=r,n.worldAnchorPoint=null,n.worldOrigin_=null,n.worldXAxis=null,n.worldYAxis=null,n.worldZAxis=null,n.adjustedWorldOrigin=s.vec3.create(),n.leaderRay=null,n.occupiedScreenBounds=new d.BoundingBox2D,n.glyphComponents=[],n.targetId_="",n.offsetInLeaderDirection_=0,n.hideLeader=!1,n.isBeingEdited=!1,n}return(0,n.__extends)(t,e),t.prototype.setHideLoads=function(e){this.hideLoads!==e&&(this.hideLoads=e,this.updateHideState(),this.updateGraphics(this.loadDisplayData))},t.prototype.setEditState=function(e){this.isBeingEdited=e,this.updateHideState(),this.updateGraphics(this.loadDisplayData)},t.prototype.updateHideState=function(){!this.hideLoads||this.isHighlighted()||this.isBeingEdited?(this.show(),this.updateGraphics(this.loadDisplayData)):this.hide()},t.prototype.hide=function(){e.prototype.hide.call(this),this.glyphComponents.forEach((function(e){e.hide()}))},t.prototype.show=function(){e.prototype.show.call(this),this.glyphComponents.forEach((function(e){e.show()}))},t.prototype.remove=function(){this.clearComponents(),e.prototype.remove.call(this)},t.prototype.update=function(e){this.updateHideState(),this.updateGraphics(e)},t.prototype.updateGraphics=function(e){if(this.viewer.requestDraw(),this.loadDisplayData=e,this.isHidden)this.removeMeshIncrements();else{switch(this.clearComponents(),this.clearPositionalData(),e.loadType){case l.GBTLoadType.ACCELERATION:case l.GBTLoadType.BEARING_LOAD:case l.GBTLoadType.FORCE:case l.GBTLoadType.MOMENT:if(s.vec3.squaredLength(this.loadDisplayData.direction.getVec3())<h.Tolerances.ZERO_LENGTH_SQUARED)return}if(this.computePositionalData(),this.isValid){switch(e.loadType){case l.GBTLoadType.ACCELERATION:this.addBaseGlyph(r.ROUND_BASE),this.addDirectionGlyph(r.ACCELERATION_ARROW),this.addDirectionGlyph(r.ACCELERATION_BEHIND,!0);break;case l.GBTLoadType.BEARING_LOAD:this.addBaseGlyph(r.ROUND_BASE),this.addDirectionGlyph(r.BEARING_ARROWS);break;case l.GBTLoadType.FORCE:this.addBaseGlyph(r.ROUND_BASE),this.addDirectionGlyph(r.FORCE_ARROW);break;case l.GBTLoadType.MOMENT:this.addBaseGlyph(r.MOMENT_BASE);break;case l.GBTLoadType.PRESSURE:this.addPressureGlyph()}this.updateTargetId()}}},Object.defineProperty(t.prototype,"glyphSize",{get:function(){return o.default.getManager().getNumber("SIMULATION_LOAD_GLYPH_SIZE_PX")},enumerable:!1,configurable:!0}),t.prototype.updateViewDependentGraphics=function(e){if(this.isValid&&!this.isHidden){if(this.viewer.getResources().loadGlyphResources.atlasReady){for(var t=o.default.getManager(),i=e.getPixelSizeAtWorldPoint(this.worldOrigin_),r=this.glyphSize,n=0;n<this.glyphComponents.length;++n)this.glyphComponents[n].setWorldOrigin(this.adjustedWorldOrigin);var a=this.getDistanceFromOriginToGlyphEdge(!0)+t.getNumber("SIMULATION_LOAD_LEADER_GAP_PX"),c=this.leaderWorldDistance+this.offsetInLeaderDirection_-i*a;if(this.hideLeader||c<0)this.removeMeshIncrements();else{var l=(0,d.createLine)(this.worldAnchorPoint,this.leaderRay.evaluate(c));this.updateMeshIncrement("leader",d.NO_SELECTION_ID,l,v);var u=l.clone();(0,d.addColorToIncrement)(t.getColor("SIMULATION_LOAD_LEADER_HIDDEN_LINE_COLOR"),u),this.updateMeshIncrement("leader-st",d.NO_SELECTION_ID,u,E)}var h=Math.abs(s.vec3.dot(e.getDirectionToWorldPoint(this.adjustedWorldOrigin),this.worldZAxis));if(h<T&&this.usesBaseGlyph){var p=s.vec3.normalize(s.vec3.cross(e.getForward(),this.worldZAxis,R)),g=i*r*.5,f=s.vec3.subtract(this.adjustedWorldOrigin,s.vec3.scale(p,-g,N),w),m=s.vec3.subtract(this.adjustedWorldOrigin,s.vec3.scale(p,g,N),b),y=(l=(0,d.createLine)(f,m),this.getColorWithHighlight(S).slice());y[3]=1-h/T,(0,d.addColorToIncrement)(y,l),this.updateMeshIncrement(I,D,l,M)}else this.removeMeshIncrement(I);if(this.showLineAxis){g=i*r*.25,f=s.vec3.subtract(this.adjustedWorldOrigin,s.vec3.scale(this.worldZAxis,-g,N),w),m=s.vec3.subtract(this.adjustedWorldOrigin,s.vec3.scale(this.worldZAxis,g,N),b),l=(0,d.createLine)(f,m);(0,d.addColorToIncrement)(this.getColorWithHighlight(O),l),(0,d.addStyleToIncrement)(A,l),this.updateMeshIncrement(C,D,l,M)}else this.removeMeshIncrement(C)}}else this.removeMeshIncrements()},t.prototype.getModelSelection=function(e){var t=new c.Selection(l.GBTUiSelectionType.OCCURRENCE,this.loadDisplayData.occurrence);return new c.Selection(l.GBTUiSelectionType.SIMULATION_LOAD,this.loadDisplayData.nodeId,this.loadDisplayData.ownerOccurrence,{childSelections:[t]})},t.prototype.addHighlight=function(t){e.prototype.addHighlight.call(this,t),this.updateHideState();for(var i=0;i<this.glyphComponents.length;i++)this.glyphComponents[i].addHighlight(t)},t.prototype.removeHighlight=function(t){for(var i=e.prototype.removeHighlight.call(this,t),r=0;r<this.glyphComponents.length;r++)this.glyphComponents[r].removeHighlight(t);return this.updateHideState(),i},Object.defineProperty(t.prototype,"leaderDirection",{get:function(){return this.leaderRay.direction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetInLeaderDirection",{get:function(){return this.offsetInLeaderDirection_},set:function(e){this.offsetInLeaderDirection_=e;var t=this.leaderWorldDistance+this.offsetInLeaderDirection_;this.leaderRay.evaluate(t,this.adjustedWorldOrigin)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldOrigin",{get:function(){return this.worldOrigin_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetId",{get:function(){return this.targetId_},enumerable:!1,configurable:!0}),t.prototype.updateTargetId=function(){var e=this.loadDisplayData.faceLoadDeterministicIds.slice();e.sort(),this.targetId_=this.loadDisplayData.occurrence.toString()+"-"+e},t.prototype.respondToOccurrenceChanges=function(e){for(var t=0;t<e.occurrences.length;++t){var i=e.occurrences[t];if(this.loadDisplayData.occurrence.equals(i.occurrenceData.occurrence))return this.clearPositionalData(),void this.computePositionalData()}},t.prototype.getDistanceFromOriginToGlyphEdge=function(e){var t=this.glyphSize,i=e?-1:1,r=Math.max(0,this.getDirectionGlyphLength()*i*s.vec3.dot(this.worldZAxis,this.leaderRay.direction)),n=s.vec3.dot(this.worldZAxis,this.leaderRay.direction);return(this.usesBaseGlyph?Math.sqrt(1-n*n)*t*.5:.5*t)+r},t.prototype.getOccupiedScreenBounds=function(e,t){if(this.isHidden)return this.occupiedScreenBounds.reset(),this.occupiedScreenBounds;var i=this.glyphSize;if(this.usesBaseGlyph){this.occupiedScreenBounds.reset();for(var r=-.5;r<=.5;r+=1){for(var n=-.5;n<=.5;n+=1){var o=s.vec3.add(this.adjustedWorldOrigin,s.vec3.scale(this.worldXAxis,r*t*i,N),R);o=s.vec3.add(o,s.vec3.scale(this.worldYAxis,r*t*i,N),R),this.occupiedScreenBounds.addPoint(e.projectWorldPointToCanvas(o))}var a=s.vec3.add(this.adjustedWorldOrigin,s.vec3.scale(this.worldZAxis,t*this.getDirectionGlyphLength(),N),R);this.occupiedScreenBounds.addPoint(e.projectWorldPointToCanvas(a))}}else this.occupiedScreenBounds.makeCenteredBoxOnPoint(e.projectWorldPointToCanvas(this.adjustedWorldOrigin),i*t);return this.occupiedScreenBounds},t.prototype.clearComponents=function(){for(var e=0;e<this.glyphComponents.length;++e)this.glyphComponents[e].remove();this.glyphComponents=[],this.removeMeshIncrements()},Object.defineProperty(t.prototype,"assembly",{get:function(){return this.viewer.getModelViewManagers().getManager().getDisplayedAssembly()},enumerable:!1,configurable:!0}),t.prototype.clearPositionalData=function(){this.worldAnchorPoint=null,this.worldOrigin_=null,this.worldXAxis=null,this.worldYAxis=null,this.worldZAxis=null,this.leaderRay=null},Object.defineProperty(t.prototype,"isValid",{get:function(){return!!(this.worldAnchorPoint&&this.worldOrigin_&&this.worldXAxis&&this.worldYAxis&&this.worldZAxis)},enumerable:!1,configurable:!0}),t.prototype.computePositionalData=function(){var e=s.vec3.create(p),t=this.getBounds();if(t){var i=t.center(),r=this.viewer.getModelBounds();if(s.vec3.dot(e,s.vec3.subtract(i,r.center(),s.vec3.create()))<0&&s.vec3.negate(e),this.updateAnchorPoint(s.vec3.add(i,s.vec3.scale(e,t.diameter()/2,s.vec3.create()),s.vec3.create())),this.worldAnchorPoint){var n=0,o=r.getCorners();if(o){for(var a=s.vec3.dot(this.worldAnchorPoint,e),c=0;c<o.length;++c){var l=s.vec3.dot(o[c],e)-a;l>n&&(n=l)}this.worldOrigin_=s.vec3.add(this.worldAnchorPoint,s.vec3.scale(e,n+y*r.diameter(),s.vec3.create()),s.vec3.create()),this.worldZAxis=this.loadDisplayData.direction.getVec3(),s.vec3.squaredLength(this.worldZAxis)<h.Tolerances.ZERO_LENGTH_SQUARED?this.worldZAxis=s.vec3.create(g):s.vec3.normalize(this.worldZAxis),(0,u.areUnitVectorsParallel)(f,this.worldZAxis)?this.worldXAxis=s.vec3.normalize(s.vec3.cross(m,this.worldZAxis,s.vec3.create())):this.worldXAxis=s.vec3.normalize(s.vec3.cross(f,this.worldZAxis,s.vec3.create())),this.worldYAxis=s.vec3.normalize(s.vec3.cross(this.worldZAxis,this.worldXAxis,s.vec3.create()));var v=s.vec3.subtract(this.worldOrigin_,this.worldAnchorPoint,s.vec3.create());this.leaderWorldDistance=s.vec3.length(v),this.leaderRay=new d.Ray(this.worldAnchorPoint,v)}}}},t.prototype.updateAnchorPoint=function(e){var t,i;this.worldAnchorPoint=null;var r,o=this.viewer.getModelViewManagers().getManager(),c=this.loadDisplayData.occurrence;if(this.loadDisplayData.faceLoadDeterministicIds.length>0)r=this.loadDisplayData.faceLoadDeterministicIds;else{var l=o.getOccurrenceDisplayData(c);if(!l)return void a.log.debug("Failed to find occurrence display data for load");var u=o.getPartStudioDataFromOccurrence(c);if(!u)return void a.log.debug("Failed to find part studio display data for load");r=[];try{for(var h=(0,n.__values)(l.displayedPartIds),d=h.next();!d.done;d=h.next()){var p=d.value;r=r.concat(u.getEntitiesForBody(p))}}catch(e){t={error:e}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(t)throw t.error}}}if(r&&0!==r.length){var g=o.getOccurrenceTransform(c);if(g){for(var f=s.mat4.multiplyVec3(s.mat4.inverse(g,s.mat4.create()),e,s.vec3.create()),m=null,y=0;y<r.length;++y){var v=o.extractMeshIncrement(r[y],c);if(v){var E=v.getPositionNearPoint(f);(!m||E.distance<m.distance)&&(m=E)}}m?this.worldAnchorPoint=s.mat4.multiplyVec3(g,m.position):a.log.debug("Failed to find anchor point for load display")}else a.log.debug("Failed to find occurrence transform for load")}else a.log.debug("No deterministic ids to use for load anchor point")},t.prototype.getBounds=function(){if(this.loadDisplayData.faceLoadDeterministicIds.length>0){for(var e=new d.BoundingBox,t=0;t<this.loadDisplayData.faceLoadDeterministicIds.length;++t)e.addBox(this.viewer.getModelViewManagers().getManager().getEntityBounds(this.loadDisplayData.faceLoadDeterministicIds[t],this.loadDisplayData.occurrence));return e}return this.assembly.getOccurrenceBounds(this.loadDisplayData.occurrence)},t.prototype.addBaseGlyph=function(e){var t=new d.ScreenSpaceQuadGlyphComponent(this.viewer,this.viewer.getResources().loadGlyphResources,e,this.glyphSize,d.RenderOrderPriority.DEFAULT,this.worldOrigin_,this.worldXAxis,this.worldYAxis,this);this.glyphComponents.push(t)},t.prototype.addDirectionGlyph=function(e,t){var i=t?s.vec3.scale(this.worldZAxis,-1,s.vec3.create()):this.worldZAxis,r=new d.DirectionalScreenFacingSpaceQuadGlyphComponent(this.viewer,this.viewer.getResources().loadGlyphResources,e,this.glyphSize,d.RenderOrderPriority.DEFAULT,this.worldOrigin_,i,[.5,0],this);this.glyphComponents.push(r)},t.prototype.addPressureGlyph=function(){var e=new d.ScreenFacingSpaceQuadGlyphComponent(this.viewer,this.viewer.getResources().loadGlyphResources,r.PRESSURE,this.glyphSize,d.RenderOrderPriority.DEFAULT,this.worldOrigin_,[.5,.5],this);this.glyphComponents.push(e)},Object.defineProperty(t.prototype,"usesBaseGlyph",{get:function(){return this.loadDisplayData.loadType!==l.GBTLoadType.PRESSURE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showLineAxis",{get:function(){return this.loadDisplayData.loadType===l.GBTLoadType.MOMENT},enumerable:!1,configurable:!0}),t.prototype.getColorWithHighlight=function(e){var t=this.getHighlight();return t?t.type===d.HighlightType.PRE?P:_:e},t.prototype.getDirectionGlyphLength=function(){switch(this.loadDisplayData.loadType){case l.GBTLoadType.ACCELERATION:case l.GBTLoadType.BEARING_LOAD:case l.GBTLoadType.FORCE:return this.glyphSize;case l.GBTLoadType.MOMENT:return.25*this.glyphSize}return 0},t}(d.UIElement);t.SimulationLoadDisplay=L},987517:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadDisplayGroup=void 0;var r=i(73055),n=i(911748),o=i(311611),s=n.vec3.create(),a=function(){function e(){this.loadDisplays=[],this.occupiedScreenBounds=new o.BoundingBox2D}return e.prototype.addDisplay=function(e){this.loadDisplays.push(e)},e.prototype.arrangeAndUpdateForView=function(e,t){if(0!==this.loadDisplays.length&&this.loadDisplays[0].isValid){for(var i=this.loadDisplays[0].worldOrigin,o=this.loadDisplays[0].leaderDirection,a=this.loadDisplays[0].glyphSize,c=e.getPixelSizeAtWorldPoint(i),l=r.default.getManager().getNumber("SIMULATION_INTER_LOAD_GAP_PX"),u=0,h=!1,d=0;d<this.loadDisplays.length;++d){(m=this.loadDisplays[d]).isHidden||(0!==d&&(u+=c*m.getDistanceFromOriginToGlyphEdge(!0)),m.hideLeader=h,h=!0,m.offsetInLeaderDirection=u,u+=c*Math.max(m.getDistanceFromOriginToGlyphEdge(!1),l))}this.occupiedScreenBounds.reset();for(d=0;d<this.loadDisplays.length;++d)this.occupiedScreenBounds.addBox(this.loadDisplays[d].getOccupiedScreenBounds(e,c));var p=e.projectWorldDirectionToCanvas(i,n.vec3.scale(o,c*a,s));n.vec2.normalize(p);var g=t.getUnoccupiedOffsetAlongDirection(this.occupiedScreenBounds,p);if(g>0){var f=(g+=l)*c;for(d=0;d<this.loadDisplays.length;++d){var m;(m=this.loadDisplays[d]).offsetInLeaderDirection=m.offsetInLeaderDirection+f}this.occupiedScreenBounds.translate(n.vec2.scale(p,g))}t.addOccupiedRegion(this.occupiedScreenBounds);for(d=0;d<this.loadDisplays.length;++d)this.loadDisplays[d].updateViewDependentGraphics(e)}},e}();t.SimulationLoadDisplayGroup=a},109579:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadDisplayManager=void 0;var r=i(423902),n=i(194598),o=i(311611),s=function(e){function t(t){var i=e.call(this,t)||this;return i.loadDisplayData=new Map,i.loadDisplays=new Map,i.groupedLoadDisplays=new Map,i.loadDisplayOccupancyMap=new o.ScreenOccupancyMap,n.btInjector.CapabilitiesService.checkFgsSimulationCurrentlyEnabled()&&i.loadResources(),n.btInjector.SimulationService.getCanAccessSimulationsObservable().subscribe((function(e){var t,n;try{for(var o=(0,r.__values)(i.loadDisplays.values()),s=o.next();!s.done;s=o.next()){s.value.setHideLoads(!e),i.show()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}})),i}return(0,r.__extends)(t,e),t.prototype.setEditState=function(e,t){var i=this.loadDisplays.get(e);i&&i.setEditState(t)},t.prototype.reset=function(){this.clearLoadDisplays(),this.loadDisplayData.clear()},t.prototype.hide=function(){this.isHidden=!0,this.clearLoadDisplays()},t.prototype.show=function(){this.isHidden=!1,this.updateLoadDisplays(this.loadDisplayData.values(),!0)},t.prototype.processUpdates=function(e,t){var i,o,s,a;if(n.btInjector.CapabilitiesService.checkFgsSimulationCurrentlyEnabled())if(e.isCollapsible)this.hide();else{t&&this.isHidden&&this.show();try{for(var c=(0,r.__values)(e.deletedLoads),l=c.next();!l.done;l=c.next()){var u=l.value;(p=this.loadDisplays.get(u))&&(p.remove(),this.loadDisplays.delete(u)),this.loadDisplayData.delete(u)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}try{for(var h=(0,r.__values)(this.loadDisplays.values()),d=h.next();!d.done;d=h.next()){var p;(p=d.value).respondToOccurrenceChanges(e)}}catch(e){s={error:e}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(s)throw s.error}}this.updateLoadDisplays(e.loads.values(),t)}},t.prototype.getUiElementsForSelection=function(e){if(!e.isSimulationLoad())return[];var t=this.loadDisplays.get(e.getIdString());return t?[t]:[]},t.prototype.getDisplayDataForSelection=function(e){return e.isSimulationLoad()?this.loadDisplayData.get(e.getIdString()):null},t.prototype.onViewWillDraw=function(e){var t,i;this.loadDisplayOccupancyMap.clearOccupiedRegions();try{for(var n=(0,r.__values)(this.groupedLoadDisplays),o=n.next();!o.done;o=n.next()){var s=(0,r.__read)(o.value,2);s[0];s[1].arrangeAndUpdateForView(e,this.loadDisplayOccupancyMap)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}},t.prototype.updateLoadDisplays=function(e,t){var i,s,a,c;try{for(var l=(0,r.__values)(e),u=l.next();!u.done;u=l.next()){var h=u.value,d=h.nodeId;if(this.loadDisplayData.set(d,h),t){if(!(y=this.loadDisplays.get(d))){var p=!n.btInjector.SimulationService.getCanAccessSimulations();y=new o.SimulationLoadDisplay(this.viewer,h,p),this.loadDisplays.set(d,y)}y.update(h)}}}catch(e){i={error:e}}finally{try{u&&!u.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}this.setupAssemblyListeners(),this.groupedLoadDisplays.clear();try{for(var g=(0,r.__values)(this.loadDisplays),f=g.next();!f.done;f=g.next()){var m=(0,r.__read)(f.value,2),y=(d=m[0],m[1]),v=this.groupedLoadDisplays.get(y.targetId);v||(v=new o.SimulationLoadDisplayGroup,this.groupedLoadDisplays.set(y.targetId,v)),v.addDisplay(y)}}catch(e){a={error:e}}finally{try{f&&!f.done&&(c=g.return)&&c.call(g)}finally{if(a)throw a.error}}},t.prototype.setupAssemblyListeners=function(){var e,t,i,n;this.stopListening(this.assembly);var o=new Set;try{for(var s=(0,r.__values)(this.loadDisplays.keys()),a=s.next();!a.done;a=s.next()){var c=a.value,l=this.loadDisplayData.get(c).occurrence.getPathAsString();o.add(l)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}try{for(var u=(0,r.__values)(o),h=u.next();!h.done;h=u.next()){l=h.value;this.listenTo(this.assembly,"OCCURRENCE_DATA_CHANGE."+l,this.show)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}},t.prototype.clearLoadDisplays=function(){var e,t;try{for(var i=(0,r.__values)(this.loadDisplays),n=i.next();!n.done;n=i.next()){var o=(0,r.__read)(n.value,2);o[0];o[1].remove()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.loadDisplays.clear(),this.groupedLoadDisplays.clear(),this.stopListening()},t.prototype.loadResources=function(){if(!this.viewer.getResources().loadGlyphResources){this.viewer.getResources().loadGlyphResources=new o.SimulationLoadGlyphResources("LOAD_GLYPHS",this.viewer,o.LoadTextures,64,{clearColorOverride:[255,255,255,0],useMipMappingAndAnisotropicFiltering:!0})}},Object.defineProperty(t.prototype,"assembly",{get:function(){return this.viewer.getModelViewManagers().getManager().getDisplayedAssembly()},enumerable:!1,configurable:!0}),t}(o.UIElement);t.SimulationLoadDisplayManager=s},627873:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadGlyphResources=void 0;var r=i(423902),n=i(311611),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.getAtlasBackgroundColor=function(e,t){return"rgba(0, 0, 0, 0.0)"},t.prototype.getAtlasTextureName=function(e,t,i){var r="";return i!==n.GlyphHighlightStates.NO_HIGHLIGHT&&(r="_"+i),this.textures[e]+r+".png"},t.prototype.initializeNodeProperties=function(){for(var e in n.GlyphHighlightStates)for(var t in n.GlyphStates){var i=this.getNodePropertyKey(e,t,n.RenderOrderPriority.DEFAULT);this.nodeProperties[i]=new n.NodeProperties({primitiveType:n.PrimitiveType.TRIANGLES,isShowThrough:!1,isDepthTested:!1,isTwoSided:!0,priority:n.RenderOrderPriority.DEFAULT,primitivesHaveTransparency:!0,material:this.material})}},t}(n.GlyphResources);t.SimulationLoadGlyphResources=o},119003:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Assembly=t.CachedOccurrenceState=t.CONSTANTS=void 0;var r=i(423902),n=i(736202),o=i(73055),s=i(342211),a=i(911748),c=i(311517),l=i(712197),u=i(194598),h=i(451097),d=i(227441),p=i(441716),g=i(513774),f=i(601759),m=i(997862),y=i(311611);t.CONSTANTS=o.default.getManager();var v=function(){this.boundingSphere=null,this.lod=null,this.cullingState=null};t.CachedOccurrenceState=v;var E=function(e){function i(t,i,r){var n=e.call(this,r)||this;return n.elementId=t,n.elementAccessor=i,n.occurrences={},n.occurrencePrefixToLeaves={},n.mateConnectorData={},n.mateConnectorGraphics={},n.mateIndicatorData={},n.mateIndicatorGraphics={},n.occurrenceMateIndicators={},n.originDisplayData=null,n.originGraphics=null,n.isHidden_=!0,n.isForInContext=!1,n.cachedOccurrenceState={},n.fullElementIdToOccurrence=new g.TemplatedNestedMap,n.ownerToInstanceMateIndicatorIds=new Map,n.mateIndicatorOwnerInstanceIds=new Map,n.mateConnectorMateIndicatorIds=new Map,n.mateIndicatorMateConnectorIds=new Map,n.occurrenceMateConnectors=new g.TemplatedNestedMap,n.ensureRootOccurrenceDisplayData(),(0,y.ensureMateIndicatorResources)(r),n.loadDisplayManager=new y.SimulationLoadDisplayManager(r),n}return(0,r.__extends)(i,e),i.prototype.onDeletion=function(){this.reset(),this.loadDisplayManager.remove()},i.prototype.getUsedPartStudioIds=function(e){e.addAll(this.fullElementIdToOccurrence.getKeys())},i.prototype.populateClientCacheStateDisplayInformation=function(e){if(this.microversionIdAndConfiguration){var t=e.getOrCreateElementDataList(this.elementId,d.BTUiDocumentClientCacheState.DISPLAY_DATA);this.checkDuplicatedMicroversionIdAndConfiguration(t,this.microversionIdAndConfiguration)?t.push(this.microversionIdAndConfiguration):c.log.warn("Found duplicated assembly microversion id and configuration "+this.microversionIdAndConfiguration)}},i.prototype.getIdOccurrenceNodeId=function(e,t){return(0,p.createOccurrenceNodeId)(e,t)},i.prototype.getMateConnectorGraphicsForSelection=function(e){var t=[];if(e.isMateConnector()){var i=this.getMateConnectorGraphics(e.getOccurrence(),e.getIdString());i&&t.push(i)}else if(e.childSelections)for(var r=0;r<e.childSelections.length;r++){var n=e.childSelections[r];n.isMateConnector()&&(t=t.concat(this.getMateConnectorGraphicsForSelection(n)))}return t},i.prototype.getMateIndicatorGraphics=function(e,t){var i=this.mateIndicatorGraphics[e];if(!i){var r=this.mateIndicatorData[e];r&&(i=this.updateMateIndicatorGraphicsAndOccurrences(r,t))}return i},i.prototype.getMateIndicatorForSelection=function(e){var t=[];if(e.isMate()){var i=this.getIdOccurrenceNodeId(e.getOccurrence(),e.getIdString()),r=this.getMateIndicatorGraphics(i,!0);r&&t.push(r)}return t},i.prototype.getEntitiesForNonInstanceSelection=function(e){var t=[],i=function(e,i){for(var r=0;r<i.length;++r)t.push(new l.Selection(d.GBTUiSelectionType.ENTITY,i[r],e))};if(e.isMateConnector()){var r=this.getIdOccurrenceNodeId(e.getOccurrence(),e.getIdString()),n=this.mateConnectorData[r];n&&i(n.occurrence,n.entityIds)}else if(e.isSimulationLoad()){var o=this.loadDisplayManager.getDisplayDataForSelection(e);o&&i(o.occurrence,o.faceLoadDeterministicIds)}else if(e.isGeometryMate()){var s=this.getIdOccurrenceNodeId(e.getOccurrence(),e.getFeatureId()),a=(0,f.as)(d.BTGeometryMateDisplayData,this.mateIndicatorData[s]);a&&(a.firstDeterministicId&&i(a.firstOccurrence,[a.firstDeterministicId]),a.secondDeterministicId&&i(a.secondOccurrence,[a.secondDeterministicId]))}else e.isMate()?t=this.callOnChildSelections(this.getEntitiesForNonInstanceSelection,e):e.isEntity()&&t.push(e);return t},i.prototype.getMateConnectorGraphics=function(e,t,i){var r=this.getIdOccurrenceNodeId(e,t),n=this.mateConnectorData[r],o=null;if(n){if(!(o=this.mateConnectorGraphics[r])){var s=this.occurrences[n.occurrence.getPathAsString()];s&&(o=this.updateMateConnectorOccurrence(n,s,!i))}}else this.fullElementIdToOccurrence.each((function(i,r){var n=this.elementAccessor.getPartStudio(r);if(n&&(o=n.getMateConnectorGraphics(e,t)))return!0}),this);return o},i.prototype.getMateConnectorData=function(e,t){var i=this.getIdOccurrenceNodeId(e,t),r=this.mateConnectorData[i];return r||this.fullElementIdToOccurrence.each((function(i,n){var o=this.elementAccessor.getPartStudio(n);if(o&&(r=o.getMateConnectorData(e,t)))return!0}),this),r},i.prototype.getUIElementsForSelection=function(e){var i=[];if(e.isMateConnector())i=this.getMateConnectorGraphicsForSelection(e);else if(e.isSimulationLoad())i=this.loadDisplayManager.getUiElementsForSelection(e);else if(e.isMate())0===(i=this.getMateIndicatorForSelection(e)).length&&(i=this.callOnChildSelections(this.getUIElementsForSelection,e));else if(e.isMateRelation())i=this.callOnChildSelections(this.getUIElementsForSelection,e);else if(e.isFeature()&&e.getIdString()===d.BTAssemblyDefaultFeatures.ORIGIN_ID&&this.originGraphics&&i.push(this.originGraphics),e.getOccurrence()&&(e.isFromBody()||e.isOccurrence()||e.isAssemblyOrigin())){var r=h.CommandtoolbarModel.getCommandToolbarModel(),n=!!r&&r.get("inShowMatesOnSelectionMode");u.btInjector.ExplodedViewsService.inExplodedViewMode()||!n&&1!==t.CONSTANTS.getNumber("OCCURRENCE_MATE_HIGHLIGHT")||i.push.apply(i,this.getMateIndicatorsForOccurrence(e.getOccurrence()))}return i},i.prototype.getEntityIdsForSelection=function(e){var t=[],i=e.getOccurrence();if(i){var r=this.occurrences[i.getPathAsString()];if(r){var n=this.elementAccessor.getPartStudio(r.fullElementId);n&&(t=n.getEntityIdsForSelection(e))}}return t},i.prototype.getOccurrenceEntityIdsForHighlight=function(e){var t=[];if(e){var i=this.occurrences[e.getPathAsString()];if(i){var r=this.elementAccessor.getPartStudio(i.fullElementId);r&&(t=t.concat(r.getOccurrenceEntityIdsForHighlight(e)))}}return t},i.prototype.getOccurrencesForSelection=function(e){var t=[];if(e.isMateConnector())for(var i=this.getMateConnectorGraphicsForSelection(e),r=0;r<i.length;++r)t.push(i[r].getOccurrence());else if(e.isSimulationLoad()){var n=this.loadDisplayManager.getDisplayDataForSelection(e);n&&0===n.faceLoadDeterministicIds.length&&t.push(n.occurrence)}else e.isMate()||e.isMateRelation()||e.isNonGeometricItem()||e.isExplodeStep()||e.isFolder()?t=this.callOnChildSelections(this.getOccurrencesForSelection,e):e.getOccurrence()&&!e.isFeature()&&t.push(e.getOccurrence());return t},i.prototype.getDisplayDataForOccurrencePath=function(e){return this.occurrences[e]||null},i.prototype.hide=function(){if(!this.isHidden_){var e=new s.Timer("bt.graphics.assembly.Assembly.prototype.hide");for(var t in this.mateConnectorGraphics)this.mateConnectorGraphics[t].remove();for(var i in this.mateConnectorGraphics={},this.removeAllMateIndicators(),this.occurrences)this.removeOccurrenceFromPartStudio(this.occurrences[i],!1);this.removeOriginGraphics(),this.loadDisplayManager.hide(),this.isHidden_=!0,e.report()}},i.prototype.show=function(e){if(this.isHidden_){var t=new s.Timer("bt.graphics.assembly.Assembly.prototype.show");this.isHidden_=!1;var i=new s.Timer("Updating occurrences");for(var r in this.occurrences)this.addOrUpdateOccurrence(this.occurrences[r]);for(var n in i.report(),i=new s.Timer("Updating mate indicators"),this.updateOriginMateConnectorVisibility(),this.mateIndicatorData)this.updateMateIndicatorGraphicsAndOccurrences(this.mateIndicatorData[n]);i.report(),this.createOriginGraphics(),this.loadDisplayManager.show(),e||this.viewer.setSuppressNonIsolatedPicks(!0),t.report()}},Object.defineProperty(i.prototype,"isHidden",{get:function(){return this.isHidden_},enumerable:!1,configurable:!0}),i.prototype.createOriginGraphics=function(){this.removeOriginGraphics(),this.isHidden_||!this.originDisplayData||this.isForInContext||(this.originGraphics=new y.OriginElement(this.originDisplayData,this.viewer))},i.prototype.removeOriginGraphics=function(){this.originGraphics&&(this.originGraphics.remove(),this.originGraphics=null)},i.prototype.reset=function(){var e;for(e in this.occurrences)this.removeOccurrenceFromPartStudio(this.occurrences[e],!1);for(var t in this.occurrences={},this.fullElementIdToOccurrence.clear(),this.mateConnectorGraphics)this.mateConnectorGraphics[t].remove();for(var i in this.mateIndicatorGraphics)this.mateIndicatorGraphics[i].remove();this.mateConnectorGraphics={},this.mateConnectorData={},this.mateIndicatorData={},this.mateIndicatorGraphics={},this.occurrenceMateIndicators={},this.occurrenceMateConnectors.clear(),this.cullableBodies=[],this.occurrencePrefixToLeaves={},this.removeOriginGraphics(),this.originDisplayData=null,this.ownerToInstanceMateIndicatorIds.clear(),this.mateIndicatorOwnerInstanceIds.clear(),this.mateConnectorMateIndicatorIds.clear(),this.mateIndicatorMateConnectorIds.clear(),this.ensureRootOccurrenceDisplayData(),this.loadDisplayManager.reset()},i.prototype.processSingleOccurrenceDeletion=function(e,t,i){if(e){var r=e;i&&e.fullElementId.equals(i.buildFullElementId(!0))&&((r=(0,f.shallowCloneWithPrototype)(e)).fullElementId=i.buildFullElementId(!1)),this.removeOccurrenceFromPartStudio(r,!0),this.removeOccurrenceElementAssociation(e),delete this.occurrences[t]}},i.prototype.processOccurrenceDeletions=function(e,t){var i;for(i=0;i<e.deletedOccurrences.length;++i)this.removeOccurrence(e.deletedOccurrences[i]);if(!e.incremental){var r=Object.keys(this.occurrences);for(i=0;i<r.length;i++){var n=r[i],o=this.occurrences[n];this.processSingleOccurrenceDeletion(o,n,t)}}var s=function(){var r=e.occurrences[i];if(!r||!r.occurrenceData)return"continue";var n=r.occurrenceData.occurrence.toString(),o=a.occurrences[n];if(o){var s=e.getPartStudioDisplayDataForMicroversion(r.fullElementId),c=!t||e.partStudioDisplayData.length>0,l=s?s.buildFromFullElementId():r.fullElementId,u=!!s&&s.keepFromMicroversion,h=!o.fullElementId.equals(l)||u,d=o.partIds.some((function(e){return r.partIds.indexOf(e)<0}));(h||d)&&c?a.processSingleOccurrenceDeletion(o,n,t):a.removeOccurrenceElementAssociation(o)}},a=this;for(i=0;i<e.occurrences.length;++i)s()},i.prototype.updateOriginMateConnectorVisibility=function(){var e=this.occurrenceMateConnectors.get(""),t=new d.BTOccurrence;e&&e.each((function(e,i){var r=this.getMateConnectorGraphics(t,i,!0);return r&&r.updateOccurrenceVisibility(this.originDisplayData.hidden?y.Visibility.HIDDEN:y.Visibility.VISIBLE),!1}),this)},i.prototype.processDisplayData=function(e){var t=new s.Timer("Assembly.prototype.processDisplayData");if(this.elementId===e.elementId){var i,r;for(e.incremental||this.reset(),this.isForInContext=e.isForInContext,i=0;i<e.occurrences.length;++i)if(e.occurrences[i]){var n=e.occurrences[i];this.addOrUpdateOccurrence(n)}for(i=0;i<e.mateConnectors.length;++i)if(e.mateConnectors[i]){var o=e.mateConnectors[i];this.updateMateConnector(o)}for(e.originDisplayData?this.originDisplayData=e.originDisplayData:e.incremental||c.log.warn("Null originDisplayData in non-incremental BTRootAssemblyDisplayData"),this.createOriginGraphics(),this.updateOriginMateConnectorVisibility(),i=0;i<e.mates.length;++i){(l=e.mates[i])&&this.updateMateIndicator(l)}for(i=0;i<e.deletedMateIds.length;++i)r=e.deletedMateIds[i],this.removeMateWithId(r);for(i=0;i<e.deletedMateConnectorIds.length;++i)r=e.deletedMateConnectorIds[i],this.removeMateConnectorWithId(r);for(i=0;i<e.mateGroups.length;++i){var a=e.mateGroups[i];a&&this.updateMateIndicator(a)}for(i=0;i<e.deletedMateGroupIds.length;++i)r=e.deletedMateGroupIds[i],this.removeMateWithId(r);for(i=0;i<e.geometryMates.length;++i){var l;(l=e.geometryMates[i])&&this.updateMateIndicator(l)}for(i=0;i<e.deletedGeometryMateIds.length;++i)r=e.deletedGeometryMateIds[i],this.removeMateWithId(r);this.loadDisplayManager.processUpdates(e,!this.isHidden_),t.report()}else c.log.warn("Tried to update a graphics assembly with data corresponding to the wrong element id")},i.prototype.ensureRootOccurrenceDisplayData=function(){var e=new d.BTOccurrenceDisplayData;e.elementId=this.elementId;var t=new d.BTBSMatrix,i=a.mat4.identity(a.mat4.create());t.updateFromGlMatrix(i),e.occurrenceData.transform=t,e.occurrenceData.occurrence=new d.BTOccurrence,this.addOrUpdateOccurrence(e)},i.prototype.addOrUpdateOccurrence=function(e){var t=e.getOccurrenceId(),i=this.occurrences[t];if(this.addOccurrenceElementAssociation(e),!this.isHidden){var r=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(t);this.viewer.getOccurrenceDataManager().setOccurrenceTransform(r,e.occurrenceData.transform.getGlMatrix());var n=this.elementAccessor.getPartStudio(e.fullElementId);if(n){var o=!this.isForInContext;n.addOrUpdateOccurrence(r,e,o)}this.updateMateConnectorsForOccurrence(e),i&&i.isHidden===e.isHidden||this.trigger("OCCURRENCE_VISIBILITY_CHANGE."+t,e.isHidden?y.Visibility.HIDDEN:y.Visibility.VISIBLE)}this.addOccurrenceToPrefixMap(e.occurrenceData.occurrence),this.occurrences[t]=e,this.updateMateIndicators(e),this.trigger("OCCURRENCE_DATA_CHANGE."+t)},i.prototype.updateMateIndicators=function(e){var t=e.occurrenceData.occurrence.getPathAsString();this.updateOccurrenceMateIndicator(t)},i.prototype.updateUniqueMateIndicators=function(e){if(0!==e.length){var t=[];e.forEach((function(e){var i=e.occurrenceData.occurrence.getPathAsString(),r=this.occurrenceMateIndicators[i];if(r)for(var n in r)if(!t.includes(n)){t.push(n);var o=r[n].getDefinition();o&&this.updateMateIndicator(o)}}),this)}},i.prototype.updateOccurrenceTransform=function(e,t){var i=[];i.push({pathId:e,transform:t}),this.batchUpdateOccurrenceTransforms(i)},i.prototype.batchUpdateOccurrenceTransforms=function(e){if(0===e.length)return!0;var t=[],r=e.every((function(e){if(!this.occurrences)return c.log.warn("No occurrences property for this path transform pair."),!1;var i=this.occurrences[e.pathId],n=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(e.pathId);if(!i||n===y.INVALID_OCCURRENCE_ID)return c.log.warn('bad occurrence display data for pathId "'+e.pathId+'", graphics ID "'+n+'".'),r=!1,!1;if(!this.isHidden_){var o=i.occurrenceData.transform.getGlMatrix();t.push({displayData:i,transform:o}),i.occurrenceData&&i.occurrenceData.transform&&i.occurrenceData.transform.updateFromGlMatrix(e.transform),e.transform&&this.viewer.getOccurrenceDataManager().setOccurrenceTransform(n,e.transform);var s=this.elementAccessor.getPartStudio(i.fullElementId);if(s){var a=!this.isForInContext;s.addOrUpdateOccurrence(n,i,a)}}return!0}),this);if(!r)return!1;var n=t.map((function(e){return e.displayData}));return this.updateUniqueMateIndicators(n),n.forEach(i.prototype.updateMateConnectorsForOccurrence,this),t.forEach((function(e){e.displayData.occurrenceData.transform.updateFromGlMatrix(e.transform)})),!0},i.prototype.getOccurrenceDisplayData=function(e){return e&&this.occurrences[e.getPathAsString()]||null},i.prototype.addOccurrenceElementAssociation=function(e){this.fullElementIdToOccurrence.insertNested(e.fullElementId.toString(),e.getOccurrenceId(),!0)},i.prototype.removeOccurrenceElementAssociation=function(e){this.fullElementIdToOccurrence.removeNested(e.fullElementId.toString(),e.getOccurrenceId())},i.prototype.removeOccurrence=function(e){var t=e.getPathAsString(),i=this.occurrences[t];i&&(this.removeOccurrenceFromPartStudio(i,!0),this.removeMateConnectorsForOccurrence(i),delete this.occurrences[t],this.removeOccurrenceElementAssociation(i),this.removeOccurrenceFromPrefixMap(i.occurrenceData.occurrence),this.updateOccurrenceMateIndicator(t)),this.trigger("OCCURRENCE_DELETED."+t)},i.prototype.removeOccurrenceFromPartStudio=function(e,t){if(e&&!this.isHidden_){var i=this.elementAccessor.getPartStudio(e.fullElementId),r=e.getOccurrenceId(),n=this.viewer.getOccurrenceIdManager().getIdForName(r);i&&n!==y.INVALID_OCCURRENCE_ID&&i.removeOccurrence(n,t),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(n),this.viewer.getOccurrenceIdManager().removeName(r)}},i.prototype.getOccurrenceData=function(e){var t=this.occurrences[e];return t||null},i.prototype.getMateConnectorsForOccurrence=function(e){var t=[],i=this.occurrenceMateConnectors.get(e.getPathAsString());return i&&i.each((function(e,i){return t.push(e),!1}),this),t},i.prototype.getMateConnectorGraphicsForOccurrence=function(e,t){for(var i=[],r=this.getMateConnectorsForOccurrence(e),n=this,o=0;o<r.length;++o){var s=this.getMateConnectorGraphics(r[o].ownerOccurrence,r[o].nodeId,t);s&&(i=i.concat(s))}return this.fullElementIdToOccurrence.each((function(t,r){var o=n.elementAccessor.getPartStudio(r);return o&&function(t){i=i.concat(t.getAllMateConnectorGraphics(e))}(o),!1})),i},i.prototype.getMateConnectorIdsForOccurrence=function(e,t){var i=[];return Object.entries(this.mateConnectorData).forEach((function(n){var o=(0,r.__read)(n,2),s=(o[0],o[1]);!(0,p.occurrencesEqual)(e,s.ownerOccurrence)||t&&s.implicit||i.push({Id:s.nodeId,isPartStudio:!1})})),i},i.prototype.getHideableSketchOccurrences=function(){var e=[];for(var t in this.occurrences){var i=this.occurrences[t];!i.isHidden&&i.displayedSketchEntityIds&&e.push(i.occurrenceData.occurrence)}return e},i.prototype.getMateIndicatorsForOccurrence=function(e,t){var i,n,o=[],s=e.getTailNodeId(),a=e.getOccurrenceWithoutTail();!a.isRoot()&&d.BTParametricInstance.isOutputInstanceNodeId(s)&&(a=a.getOccurrenceWithoutTail());var c=this.ownerToInstanceMateIndicatorIds.get(a.getPathAsString());if(c){var l=c.get(s);if(l)try{for(var u=(0,r.__values)(new Set(l)),h=u.next();!h.done;h=u.next()){var p=h.value,g=this.getMateIndicatorGraphics(p,!t);g&&o.push(g)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}}return o},i.prototype.hasMateIndicatorForOccurrence=function(e){var t=e.getOccurrenceWithoutTail(),i=e.getTailNodeId();!t.isRoot()&&d.BTParametricInstance.isOutputInstanceNodeId(i)&&(t=t.getOccurrenceWithoutTail());var r=this.ownerToInstanceMateIndicatorIds.get(t.getPathAsString());if(r){var n=r.get(i);return!!n&&n.size>0}return!1},i.prototype.updateMateConnector=function(e){var t=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId),i=this.mateConnectorData[t];i&&((0,p.occurrencesEqual)(i.occurrence,e.occurrence)||this.removeMateConnectorWithId(t)),this.mateConnectorData[t]=e;var r=e.occurrence.getPathAsString();this.occurrenceMateConnectors.insertNested(r,e.nodeId,e);var n=this.occurrences[r];this.updateMateConnectorOccurrence(e,n),this.updateMateConnectorMateIndicator(t)},i.prototype.updateMateConnectorMateIndicator=function(e){var t,i,n=this.mateConnectorMateIndicatorIds.get(e);if(n)try{for(var o=(0,r.__values)(new Set(n).values()),s=o.next();!s.done;s=o.next()){var a=s.value,c=this.mateIndicatorData[a];c&&this.updateMateIndicator(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}},i.prototype.updateOccurrenceMateIndicator=function(e){var t=this.occurrenceMateIndicators[e];if(t)for(var i in t)if(t[i]){var r=t[i].getDefinition();this.updateMateIndicator(r)}},i.prototype.shouldMateIndicatorBeRecreated=function(e){var t=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId),i=this.mateIndicatorData[t];if(i&&e&&i.status===e.status&&i.getClassId()===e.getClassId()&&i.hidden===e.hidden&&(0,n.isEqual)(i.getMateConnectorIds(),e.getMateConnectorIds())&&(0,n.isEqual)(i.getOccurrenceIds(),e.getOccurrenceIds())){if(e instanceof d.BTMateDisplayData&&i instanceof d.BTMateDisplayData&&i.mateType!==e.mateType)return!0;var r=this.mateIndicatorGraphics[t];return!(!r||0!==r.mateIndicatorComponents.length)}return!0},i.prototype.updateMateIndicator=function(e){var t=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId);this.shouldMateIndicatorBeRecreated(e)&&this.removeMateWithId(t),this.mateIndicatorData[t]=e,this.updateMateIndicatorGraphicsAndOccurrences(e)},i.prototype.separateOccurrenceAndFeatureId=function(e){var t=new d.BTOccurrence,i=!1,r="",n=e.split(d.BTOccurrence.OCCURRENCE_PATH_SEPARATOR);if(n.length>0)do{r=r?n.pop()+d.BTOccurrence.OCCURRENCE_PATH_SEPARATOR+r:n.pop(),t.path=n,i=this.occurrences.hasOwnProperty(t.getPathAsString())}while(!i&&n.length>0);return i?{occurrence:t,featureId:r}:null},i.prototype.updateMateIndicatorGraphicsAndOccurrences=function(e,t){if(this.isHidden_||this.isForInContext)return null;var i=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId),r=!!!this.mateIndicatorGraphics[i]&&!t&&e.hidden,o=null,s=null,a=[],c=null;if(e instanceof d.BTMateDisplayData){var l=[],u=e.mateConnectorIds.length;c=e.mateConnectorIds;for(var h=0;h<u;++h){var p=this.separateOccurrenceAndFeatureId(e.mateConnectorIds[h]);if(p){var g=this.getMateConnectorData(p.occurrence,p.featureId);g&&(l.push(g),a.push(g.occurrence.getPathAsString()))}}if(s=this.mateIndicatorGraphics[i]){var f=s.getDefinitionOccurrenceIds(),m=(0,n.isEqual)(f,a);if(s.updateMateConnectorDisplayData(l),m)return s;this.removeOccurrenceMateIndicatorMapping(i,f),o=s}else r||(o=(0,y.createMateIndicator)(l,e,this.viewer))}else if(e instanceof d.BTMateGroupDisplayData){var v=[],E=e.occurrenceIds.length,I=[];for(h=0;h<E;++h){a.push(e.occurrenceIds[h]);var T=this.occurrences[e.occurrenceIds[h]];T&&(v.push(T),I.push(e.occurrenceIds[h]))}if(s=this.mateIndicatorGraphics[i]){f=s.getDefinitionOccurrenceIds(),m=(0,n.isEqual)(f,a);if(s.updateOccurenceDisplayData(v),m)return s;this.removeOccurrenceMateIndicatorMapping(i,f),o=s}else r||(o=new y.MateGroupMateIndicator(v,e,this.viewer))}else if(e instanceof d.BTGeometryMateDisplayData)if(s=this.mateIndicatorGraphics[i],a.push(e.firstOccurrence.getPathAsString()),a.push(e.secondOccurrence.getPathAsString()),s){f=s.getDefinitionOccurrenceIds(),m=(0,n.isEqual)(f,a);if(s.updateMateIndicatorDefinition(e),m)return s;this.removeOccurrenceMateIndicatorMapping(i,f),o=s}else r||(o=new y.Tangent(e,this.viewer));if(0===a.length)this.removeMateGraphicsWithId(i);else if(o){this.mateIndicatorGraphics[i]=o;var S=o.getDefinitionOccurrenceIds();for(h=0;h<S.length;++h)this.addOccurrenceMateIndicator(S[h],i,o)}this.removeMappingsForMateIndicator(i);for(h=0;h<a.length;++h){var P=e.ownerOccurrence;e.isDerivedFeature&&(P=P.getOccurrenceWithoutTail()),this.addOwnerOccurrenceMateIndicatorMapping(a[h],i,P)}if(c)for(h=0;h<c.length;++h)this.addMateConnectorMateIndicatorMapping(c[h],i);return o},i.prototype.addOwnerOccurrenceMateIndicatorMapping=function(e,t,i){var r=e.split(d.BTOccurrence.OCCURRENCE_PATH_SEPARATOR).slice(i.path.length),n="";r.length>0&&(n=r.length>1&&d.BTParametricInstance.isOutputInstanceNodeId(r[1])?r[1]:r[0]);var o=i.getPathAsString(),s=this.ownerToInstanceMateIndicatorIds.get(o);s||(s=new Map,this.ownerToInstanceMateIndicatorIds.set(o,s));var a=s.get(n);a||(a=new Set,s.set(n,a)),a.add(t);var c=this.mateIndicatorOwnerInstanceIds.get(t);c||(c=[],this.mateIndicatorOwnerInstanceIds.set(t,c)),c.push({owner:o,instance:n})},i.prototype.addMateConnectorMateIndicatorMapping=function(e,t){var i=this.mateConnectorMateIndicatorIds.get(e);i||(i=new Set,this.mateConnectorMateIndicatorIds.set(e,i)),i.add(t);var r=this.mateIndicatorMateConnectorIds.get(t);r||(r=new Set,this.mateIndicatorMateConnectorIds.set(t,r)),r.add(e)},i.prototype.removeMappingsForMateIndicator=function(e){var t=this,i=this.mateIndicatorOwnerInstanceIds.get(e);i&&i.forEach((function(i){var r=t.ownerToInstanceMateIndicatorIds.get(i.owner);if(r){var n=r.get(i.instance);n&&(n.delete(e),0===n.size&&r.delete(i.instance)),0===r.size&&t.ownerToInstanceMateIndicatorIds.delete(i.owner)}})),this.mateIndicatorOwnerInstanceIds.delete(e);var r=this.mateIndicatorMateConnectorIds.get(e);r&&r.forEach((function(i){var r=t.mateConnectorMateIndicatorIds.get(i);r&&(r.delete(e),0===r.size&&t.mateConnectorMateIndicatorIds.delete(i))})),this.mateIndicatorMateConnectorIds.delete(e)},i.prototype.updateMateConnectorsForOccurrence=function(e){for(var t=this.getMateConnectorsForOccurrence(e.occurrenceData.occurrence),i=0;i<t.length;++i)this.updateMateConnectorOccurrence(t[i],e)},i.prototype.removeMateConnectorWithId=function(e){var t=this.mateConnectorData[e];t&&(delete this.mateConnectorData[e],this.occurrenceMateConnectors.removeNested(t.occurrence.getPathAsString(),t.nodeId),this.removeMateConnectorOccurrenceFromIds(t.nodeId,t.ownerOccurrence),this.updateMateConnectorMateIndicator(e))},i.prototype.removeOccurrenceMateIndicatorMapping=function(e,t){var i=this.mateIndicatorGraphics[e];if(i){t=t||i.getDefinitionOccurrenceIds();for(var r=0;r<t.length;++r)this.removeOccurrenceMateIndicator(t[r],e)}},i.prototype.removeMateGraphicsWithId=function(e){var t=this.mateIndicatorGraphics[e];t&&(this.removeOccurrenceMateIndicatorMapping(e),t.remove(),delete this.mateIndicatorGraphics[e])},i.prototype.removeMateWithId=function(e){this.removeMateGraphicsWithId(e),this.removeMappingsForMateIndicator(e),delete this.mateIndicatorData[e]},i.prototype.removeMateConnectorsForOccurrence=function(e){for(var t=this.getMateConnectorsForOccurrence(e.occurrenceData.occurrence),i=0;i<t.length;++i)this.removeMateConnectorOccurrenceFromIds(t[i].nodeId,t[i].ownerOccurrence)},i.prototype.updateMateConnectorOccurrence=function(e,t,i){if(this.isHidden_||this.isForInContext)return null;var r=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId),n=this.mateConnectorGraphics[r];return n||i||!(t&&t.isHidden||e.hidden)?(n?n.updateDefinition(e):this.mateConnectorGraphics[r]=n=new y.MateConnector(e,y.MAIN_SCENEGRAPH_ID,this.viewer),t&&(n.setOccurrenceTransform(t.occurrenceData.transform.getGlMatrix()),n.updateOccurrenceVisibility(t.isHidden?y.Visibility.HIDDEN:y.Visibility.VISIBLE)),n):null},i.prototype.removeMateConnectorOccurrenceFromIds=function(e,t){var i=this.getIdOccurrenceNodeId(t,e),r=this.mateConnectorGraphics[i];r&&(r.remove(),delete this.mateConnectorGraphics[i])},i.prototype.removeAllMateIndicators=function(){for(var e in this.mateIndicatorGraphics)this.mateIndicatorGraphics[e].remove();this.occurrenceMateIndicators={},this.mateIndicatorGraphics={}},i.prototype.addOccurrenceMateIndicator=function(e,t,i){e in this.occurrenceMateIndicators||(this.occurrenceMateIndicators[e]={}),this.occurrenceMateIndicators[e][t]=i;var r=this.viewer.getIsolatedOccurrenceManager().getIsolatedOccurrences();if(r&&r.length>0)for(var n=0;n<r.length;n++)r[n].getPathAsString()===e&&i.getOccurrenceData().setIsolated(!0)},i.prototype.removeOccurrenceMateIndicator=function(e,t){e in this.occurrenceMateIndicators&&this.occurrenceMateIndicators[e][t]&&delete this.occurrenceMateIndicators[e][t]},i.prototype.getDisplayDataForOccurrence=function(e){return e&&this.occurrences[e.getPathAsString()]||null},i.prototype.getOccurrenceVisibility=function(e){var t=this.getDisplayDataForOccurrence(e);return!t||t.isHidden?y.Visibility.HIDDEN:y.Visibility.VISIBLE},i.prototype.addOrRemoveOccurrenceInPrefixMap=function(e,t){for(var i=e.getPathAsString(),r=0;r<e.path.length;r++){var n=e.path.slice(0,r+1).join(".");this.occurrencePrefixToLeaves[n]||(this.occurrencePrefixToLeaves[n]=new m.StringSet),t?this.occurrencePrefixToLeaves[n].add(i):this.occurrencePrefixToLeaves[n].remove(i)}},i.prototype.addOccurrenceToPrefixMap=function(e){this.addOrRemoveOccurrenceInPrefixMap(e,!0)},i.prototype.removeOccurrenceFromPrefixMap=function(e){this.addOrRemoveOccurrenceInPrefixMap(e,!1)},i.prototype.getLeafOccurrencesContainedWithinOccurrence=function(e){var t=this,i=[];if(e)if(e.isAssemblyRoot())(0,n.each)(this.occurrences,(function(e){return i.push(e.occurrenceData.occurrence)}));else{var r=this.occurrencePrefixToLeaves[e.getPathAsString()];r&&r.each((function(e){var r=t.occurrences[e];r&&r.occurrenceData&&i.push(r.occurrenceData.occurrence)}))}return i},i.prototype.getOccurrenceBounds=function(e){var t=this,i=this.getLeafOccurrencesContainedWithinOccurrence(e),r=null;return i.forEach((function(e){var i=t.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString()),n=t.getOccurrenceDisplayData(e);if(n&&i!==y.INVALID_OCCURRENCE_ID){var o=t.elementAccessor.getPartStudio(n.fullElementId);if(o){var s=o.getOccurrenceBounds(i);s&&s.isFinite()&&(r||(r=new y.BoundingBox),r.addBox(s))}}})),r},i.prototype.getBodyComponent=function(e){var t=this.getOccurrenceDisplayData(e);if(t){var i=this.elementAccessor.getPartStudio(t.fullElementId);if(i)return i.bodyComponent}return null},i.prototype.getBodyBounds=function(e,t){var i=this.getOccurrenceDisplayData(t);if(i){var r=this.elementAccessor.getPartStudio(i.fullElementId);if(r){var n=r.getBodyBounds(e,t);if(n)return n.createTransformedCopy(i.occurrenceData.transform.getGlMatrix())}}return null},i.prototype.getCachedOccurrenceState=function(e){var t=this.cachedOccurrenceState[e];return t||(this.cachedOccurrenceState[e]=t=new v),t},i.prototype.clearCachedOccurrenceState=function(){this.cachedOccurrenceState={}},i.prototype.getBoundsOutsideElementNode=function(){var e=new y.BoundingBox;if(this.originGraphics&&e.addBox(this.originGraphics.getBounds()),this.mateConnectorGraphics)for(var t in this.mateConnectorGraphics)this.mateConnectorGraphics[t].isHidden||e.addPoint(this.mateConnectorGraphics[t].worldSpacePosition);return this.fullElementIdToOccurrence.each((function(t,i){var r=this.elementAccessor.getPartStudio(i);return null!==r&&e.addBox(r.mateConnectorComponent.getVisibleMateConnectorBounds()),!1}),this),e.isInitialized()&&e.isFinite()?e:null},i.prototype.getMateIndicatorConnectivityMap=function(){var e=new g.TemplatedNestedMap;return Object.values(this.mateIndicatorData).forEach((function(t){if(function(e){return e.status!==d.GBTAssemblyFeatureDisplayStatus.SUPPRESSED}(t))for(var i=t.getOccurrences(this),r=0;r<i.length;r++)for(var n=i[r].trimToTopLevel().getPathAsString(),o=i[r].getPathAsString(),s=0;s<i.length;s++){var a=i[s],c=a.getPathAsString();n!==c&&e.insertNested(o,c,a)}}),this),e},i.prototype.getElementType=function(){return d.GBTElementType.ASSEMBLY},i.prototype.hideSimulationLoadDisplays=function(){this.loadDisplayManager.hide()},i.prototype.showSimulationLoadDisplays=function(){this.loadDisplayManager.show()},i.prototype.setEditState=function(e,t){this.loadDisplayManager.setEditState(e,t)},i.prototype.getOccurrences=function(){return this.occurrences},i.prototype.setAreOccurrencesClippedBySectionPlaneExcept=function(e,t){var i,n;for(var o in this.occurrences){var s=this.viewer.getOccurrenceIdManager().getIdForName(o),a=this.viewer.getOccurrenceDataManager().getOccurrenceData(s);a&&a.setIsClippedBySectionPlanes(e)}try{for(var c=(0,r.__values)(t),l=c.next();!l.done;l=c.next()){var u=l.value;this.setAllLeafOccurrencesClippedForOccurrence(d.BTOccurrence.getOccurrenceFromPathString(u),!e)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}},i.prototype.setAllLeafOccurrencesClippedForOccurrence=function(e,t){var i,n,o=this.getLeafOccurrencesContainedWithinOccurrence(e);if(o)try{for(var s=(0,r.__values)(o),a=s.next();!a.done;a=s.next()){var l=a.value;if(this.occurrences[l.getPathAsString()]){var u=this.viewer.getIdForOccurrence(l),h=this.viewer.getOccurrenceDataManager().getOccurrenceData(u);h&&h.setIsClippedBySectionPlanes(t)}else c.log.debug("Did not find occurrence data for leaf occurrence "+l.getPathAsString()+" in assembly "+this.elementId)}}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}},i.prototype.enterMateHideMode=function(e){var t=this,i=new Set;for(var r in e.forEach((function(e){var r=new d.BTOccurrence;r.path=e.path;var n=t.getIdOccurrenceNodeId(r,e.featureId);i.add(n)})),this.mateIndicatorGraphics){this.mateIndicatorGraphics[r].updateHiddenMode(!i.has(r))}},i.prototype.exitMateHideMode=function(){for(var e in this.mateIndicatorGraphics){this.mateIndicatorGraphics[e].updateHiddenMode(!1)}},i}(y.Element);t.Assembly=E},834233:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BodyComponent=t.isNodeForSurfaceBody=t.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT=t.MESH_EDGE_NODE_PROPERTIES=t.SIMULATED_FACE_NODE_PROPERTIES=t.applySmoothEdgesRenderingStyleChanges=t.SOLID_FACE_NODE_PROPERTIES=t.BodyComponentId=void 0;var r,n,o=i(423902),s=i(73055),a=i(911748),c=i(194598),l=i(311517),u=i(227441),h=i(853524),d=i(736202),p=i(507025),g=i(513774),f=i(997862),m=i(673290),y=i(311611);!function(e){e[e.ALL_OPAQUE=0]="ALL_OPAQUE",e[e.OPAQUE_BODY_TRANSPARENT_FACE=1]="OPAQUE_BODY_TRANSPARENT_FACE",e[e.TRANSPARENT_BODY_OPAQUE_FACE=2]="TRANSPARENT_BODY_OPAQUE_FACE",e[e.ALL_TRANSPARENT=3]="ALL_TRANSPARENT"}(r||(r={})),function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT"}(n||(n={}));var v=s.default.getManager();t.BodyComponentId="body_component.";var E=new y.Material({}),I=new y.Material({color:v.getColor("LINE_POINT_COLOR")}),T=new y.Material({color:v.getColor("MESH_FACET_EDGE_COLOR"),lineWidth:v.getNumber("MESH_FACET_EDGE_LINE_WIDTH")}),S=new y.Material({shininess:v.getNumber("MESH_SHININESS"),specularColor:v.getColor("MESH_SPECULAR"),ambientFactor:v.getNumber("MESH_AMBIENT_FACTOR"),diffuseFactor:v.getNumber("MESH_DIFFUSE_FACTOR")});t.SOLID_FACE_NODE_PROPERTIES=new y.NodeProperties({material:E,zOffset:v.getNumber("PART_FACES_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0});var P=[0,0,0,0],_=v.getStipple("DEFAULT_LINE_STIPPLE"),M=v.getColor("LINE_POINT_COLOR"),D=v.getNumber("DEFAULT_LINE_WIDTH");t.applySmoothEdgesRenderingStyleChanges=function(e){e===u.GBTSmoothEdgeStyle.PHANTOM?(_=v.getStipple("SMOOTH_EDGE_STIPPLE"),D=v.getNumber("SMOOTH_EDGE_LINE_WIDTH")):(_=v.getStipple("DEFAULT_LINE_STIPPLE"),D=v.getNumber("DEFAULT_LINE_WIDTH")),M=e===u.GBTSmoothEdgeStyle.HIDDEN?P:e===u.GBTSmoothEdgeStyle.PHANTOM?v.getColor("SMOOTH_EDGE_PHANTOM_COLOR"):v.getColor("LINE_POINT_COLOR")},t.SIMULATED_FACE_NODE_PROPERTIES=new y.NodeProperties({material:E,zOffset:v.getNumber("PART_FACES_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0,isVisible:!1});var C=t.SOLID_FACE_NODE_PROPERTIES.cloneAndModify({isTwoSided:!0}),O=new y.NodeProperties({material:E,zOffset:v.getNumber("NON_MODIFIABLE_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0,addsToSectionMask:!1,primitivesHaveTransparency:!0,isTwoSided:!0}),A=new y.NodeProperties({material:E,zOffset:v.getNumber("NON_MODIFIABLE_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,includedInBlend:!0,clippedBySectionPlanes:!0,primitivesHaveTransparency:!0}),R=new y.NodeProperties({material:S,zOffset:v.getNumber("PART_FACES_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0}),N=R.cloneAndModify({primitivesHaveTransparency:!0}),w=R.cloneAndModify({isTwoSided:!0}),b=w.cloneAndModify({primitivesHaveTransparency:!0});t.MESH_EDGE_NODE_PROPERTIES=new y.NodeProperties({material:T,zOffset:v.getNumber("PART_EDGES_Z_OFFSET"),primitiveType:y.PrimitiveType.LINES,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0,isPickable:!1}),t.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT=new y.NodeProperties({material:E,zOffset:v.getNumber("PART_FACES_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,primitivesHaveTransparency:!0,includedInBlend:!0,clippedBySectionPlanes:!0,isTwoSided:!0});var L=new y.NodeProperties({material:E,zOffset:v.getNumber("SURFACE_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,includedInBlend:!0,clippedBySectionPlanes:!0}),F=new y.NodeProperties({material:E,zOffset:v.getNumber("SURFACE_Z_OFFSET"),primitiveType:y.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,includedInBlend:!0,clippedBySectionPlanes:!0,primitivesHaveTransparency:!0}),B=new y.NodeProperties({material:I,zOffset:v.getNumber("PART_EDGES_Z_OFFSET"),primitiveType:y.PrimitiveType.LINES,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0}),x=B.cloneAndModify({zOffset:v.getNumber("SURFACE_EDGES_Z_OFFSET")}),U=B.cloneAndModify({zOffset:v.getNumber("WIRE_EDGES_Z_OFFSET"),addsToBounds:!0}),G=B.cloneAndModify({zOffset:v.getNumber("NON_MODIFIABLE_Z_OFFSET_EDGE")}),H=x.cloneAndModify({zOffset:v.getNumber("NON_MODIFIABLE_Z_OFFSET_EDGE")}),V=U.cloneAndModify({zOffset:v.getNumber("NON_MODIFIABLE_Z_OFFSET_EDGE")}),k=new y.Material({color:v.getColor("LINE_POINT_COLOR")});k.lineStipple=v.getStipple("CENTER_LINE_STIPPLE");var W=U.cloneAndModify({material:k}),j=new y.NodeProperties({material:I,zOffset:v.getNumber("PART_POINTS_Z_OFFSET"),primitiveType:y.PrimitiveType.POINTS,isVisible:!1,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0}),z=j.cloneAndModify({zOffset:v.getNumber("SURFACE_POINTS_Z_OFFSET")}),X=j.cloneAndModify({zOffset:v.getNumber("WIRE_POINTS_Z_OFFSET")}),q=new y.NodeProperties({material:I,zOffset:v.getNumber("PART_EDGES_Z_OFFSET"),primitiveType:y.PrimitiveType.SILHOUETTES,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0});t.isNodeForSurfaceBody=function(e){return e.getZOffset()===L.zOffset};var Y={};function Z(e,t){var i=Y[e];if(!i){i=new y.Style;var r=[t.color[0]/255,t.color[1]/255,t.color[2]/255,t.opacity/255];i.setAttribute(y.Attributes.COLOR,r),Y[e]=i}return i}function K(e){if(e){var t=e.getAttribute(y.Attributes.COLOR);if(t)return t[3]<1}return!1}var Q=new y.IdManager,$=!1,J=!1,ee=function(e){function i(t,i,r,n){var o=e.call(this,t,n,r)||this;return o.bodyLoadTasks=i,o.bodyMetaData={},o.lastSetBodyColor={},o.subBodyStyleOverrides=new g.TemplatedNestedMap,o.entityStyles={},o.cachedBodyTransparencyState={},o.partStudioBodyIdToOccurrenceId={},o.cullableBodies=null,o.instantiatedTriangleCount=-1,o.sheetMetalOrderIdToTransform={},o.previewClone=null,o.baseComponent=null,o.bodiesHiddenInBase=new Set,o.tessellationSettings={},o.bodiesWithUpdatedMeshReferences=new Set,o.simulatedOccurrences=new Set,o.node=t.getModelViewManager().getSharedBodyNode(),o.collectionId=Q.getId(),o.knownBodyIds=new Set,o.occurrenceAlphaModifiers=new Map,o.bodyVisibility=new g.TemplatedNestedMap,o.bodyToOccurrenceId=new g.TemplatedNestedMap,o.unavailableBodyOccurrences=new g.TemplatedNestedMap,o.silhouetteCallback=function(e,t){o.onSilhouetteCreated(e,t)},o}return(0,o.__extends)(i,e),i.prototype.getCollectionId=function(){return this.collectionId},i.prototype.getNode=function(){return this.node},i.prototype.getCorrectedBodyOccurrenceId=function(e,t){return t&&t!==y.PART_STUDIO_ELEMENT_ID||(t=this.partStudioBodyIdToOccurrenceId[e]),t},i.prototype.copyBodyDataToClone=function(e){var t;for(t in e.bodyLoadTasks=this.bodyLoadTasks,this.bodyMetaData)e.bodyMetaData[t]=this.bodyMetaData[t].clone();for(t in e.knownBodyIds=new Set(this.knownBodyIds),this.lastSetBodyColor)e.lastSetBodyColor[t]=this.lastSetBodyColor[t].slice(0);this.subBodyStyleOverrides.eachNested((function(t,i,r){e.subBodyStyleOverrides.insertNested(i,r,t.clone())})),e.tessellationSettings=(0,d.clone)(this.tessellationSettings),e.entityStyles=(0,d.clone)(this.entityStyles)},i.prototype.clone=function(e){this.bodyLoadTasks.completeTasks();var t=new i(e,this.bodyLoadTasks,this.usage,this.viewer);return this.copyBodyDataToClone(t),this.copyToClone(t),t},i.prototype.cloneForPreview=function(e){var t=new i(e,this.bodyLoadTasks,y.bt_graphics_Usage.PREVIEW,this.viewer);for(var r in this.copyToPreview(t),this.copyBodyDataToClone(t),Object.entries(this.occurrences).forEach((function(e){var i=(0,o.__read)(e,2),r=i[0],n=i[1];!n&&(t.occurrences[r]=n)})),this.bodyToOccurrenceId.eachNested((function(e,i,r){t.occurrences.hasOwnProperty(r)&&t.bodyToOccurrenceId.insertNested(i,r,e)})),this.unavailableBodyOccurrences.eachNested((function(e,i,r){t.occurrences.hasOwnProperty(r)&&t.unavailableBodyOccurrences.insertNested(i,r,e)})),this.bodyMetaData)t.refreshBodyOccurrences(r);return this.previewClone=t,t.baseComponent=this,t},i.prototype.onPreviewDestroyed=function(){this.previewClone=null},i.prototype.copyVisibility=function(e){var t=this;e.bodyVisibility.eachNested((function(e,i,r){return t.hideShowBody(r,e,+i),!1}))},i.prototype.getBodyLoadTasks=function(){return this.bodyLoadTasks},i.prototype.getTessellationSettings=function(){return this.tessellationSettings},i.prototype.damageInstantiatedTriangleCount=function(){this.instantiatedTriangleCount=-1},i.prototype.getInstantiatedTriangleCount=function(){if(this.instantiatedTriangleCount<0){this.instantiatedTriangleCount=0;var e=this.getMeshManager(),t=this.getMeshOwnerId();this.bodyToOccurrenceId.each((function(i,r){if(i&&!i.isEmpty()){var n=e.getGroupRangesForGroupTypeAndLod(r,t,y.PrimitiveType.TRIANGLE_STRIP,y.Lod.DEFAULT);n&&(this.instantiatedTriangleCount+=i.size()*n.getPrimitiveCount())}return!1}),this)}return this.instantiatedTriangleCount},i.prototype.hasDisplayedEdgesWithUnknownSmoothness=function(){var e=this,t=!1;return this.bodyToOccurrenceId.each((function(i,r){var n=e.bodyToEntity.get(r);return n&&n.each((function(i,r){var n=e.idToMetaData[r];return n&&n.isEdge()&&n.getEdgeSmoothnessStatus()===u.GBTEntityEdgeSmoothnessStatus.UNKNOWN&&(t=!0),t})),t})),t},i.prototype.getEstimatedMemoryUsage=function(){var e=0;for(var t in this.bodyMetaData){this.bodyMetaData[t].isClosedCompositeConstituent||(e+=this.bodyMetaData[t].getEstimatedMemoryUsage())}return e},i.prototype.retrieveBodyMetaData=function(e){return this.bodyMetaData[e]||null},i.prototype.getBodyDiameter=function(e){var t=this.bodyMetaData[e];return t?t.getBounds().diameter():0},i.prototype.isBodyIsolated=function(e,t){var i=this.getOccurrenceDataForBody(e,t);return!!i&&i.getIsolated()},i.prototype.isBodyVisible=function(e,t){var i=this.getOccurrenceDataForBody(e,t);return!!i&&i.getVisibility()!==y.Visibility.HIDDEN},i.prototype.getOccurrenceDataForBody=function(e,t){var i=this.bodyMetaData[t];if(i&&i.isClosedComposite&&!i.isGroupableCompositeBody){for(var r=null,n=0;n<i.constituentBodyIds.length&&!r;++n)r=this.bodyMetaData[i.constituentBodyIds[n]];i=r}return this.getBodyOccurrenceData(i.meshGroupId,e)},i.prototype.isBodyInstantiated=function(e){var t=this.bodyMetaData[e];return!!t&&this.bodyToOccurrenceId.has(t.meshGroupId)},i.prototype.getNonInstantiatedBodies=function(){var e=[];for(var t in this.bodyMetaData){this.bodyMetaData[t].isClosedCompositeConstituent||(this.isBodyInstantiated(t)||e.push(this.bodyMetaData[t]))}return e},i.prototype.getComponentId=function(){return t.BodyComponentId},i.prototype.reset=function(){this.bodyToOccurrenceId.eachNested((function(e,t,i){return this.removeBodyOccurrence(i,t),!1}),this),this.unavailableBodyOccurrences.clear(),this.bodyLoadTasks.clearAllBodiesForComponent(this),this.bodyMetaData={},this.tessellationSettings={},this.knownBodyIds.clear(),this.lastSetBodyColor={},this.partStudioBodyIdToOccurrenceId={},this.sheetMetalOrderIdToTransform={},this.entityStyles={},this.subBodyStyleOverrides.clear(),this.damageInstantiatedTriangleCount(),e.prototype.reset.call(this)},i.prototype.updateBodyDisplayData=function(e,t){var i=new f.StringSet;for(var r in e.deterministicPartIdToData){(c=e.deterministicPartIdToData[r]).isDeletion?delete this.tessellationSettings[r]:this.tessellationSettings[r]=c.tessellationSettings}this.knownBodyIds=new Set;for(var n=0;n<e.partDisplayData.length;++n){var o=e.partDisplayData[n].id;this.knownBodyIds.add(o);var s=e.deterministicPartIdToData[o];if(s){if(this.viewer.getIsForFlattenedDisplay()!==s.isForFlattenedView()){if(this.viewer.getIsForFlattenedDisplay())continue;o in this.partStudioBodyIdToOccurrenceId&&this.removeBodyOccurrence(y.PART_STUDIO_ELEMENT_ID,o)}}else if(!this.bodyMetaData.hasOwnProperty(o))continue;if(i.add(o),!t||e.deterministicPartIdToData.hasOwnProperty(o)){var a=-1;t&&(0,y.isRetrievalDebuggingEnabled)()&&this.bodyMetaData[o]&&null!==this.bodyMetaData[o].getFinestTessellationSettingOnClient()&&(a=this.bodyMetaData[o].getFinestTessellationSettingOnClient());var c=e.deterministicPartIdToData[o],u=e.partDisplayData[n];if(u||l.log.warn("Missing expected BTPartDisplayData"),this.updateBodyMetaData(e,o,u,c),t&&(0,y.isRetrievalDebuggingEnabled)()){var h=this.bodyMetaData[o],d=(h.getEstimatedMemoryUsage()-h.getEstimatedMemoryUsage([a]))/1024/1024;d>v.getNumber("SINGLE_BODY_MEMORY_CHANGE_INFO_THRESHOLD_MB")&&l.log.info("Memory change for "+o+" to go to "+h.getFinestTessellationSettingOnClient()+": "+d+"MB")}}var p=this.bodyMetaData[o];if(p.isClosedComposite)for(var g=0;g<p.constituentBodyIds.length;++g)this.knownBodyIds.add(p.constituentBodyIds[g]),i.add(p.constituentBodyIds[g])}var m=null;for(var o in this.bodyMetaData)i.contains(o)||(this.removeBodyOccurrence(y.PART_STUDIO_ELEMENT_ID,o),this.bodyMetaData[o].removeOpenCompositeBodyReferences(this.bodyMetaData),delete this.bodyMetaData[o],delete this.lastSetBodyColor[o],this.subBodyStyleOverrides.remove(o),m||(m=new f.StringSet),m.add(o));m&&this.bodyLoadTasks.clearBodiesForComponent(this,m)},i.prototype.processDeletions=function(e){var t,i;for(var r in e.deterministicPartIdToData)for(var n=e.deterministicPartIdToData[r],o=0;o<n.entityDIds.length;++o)i=n.entityDIds[o],(t=e.deterministicIdToEntity[i])&&!this.handlesEntity(t,n)&&this.removeEntity(i);for(i in e.deterministicIdToEntity)(t=e.deterministicIdToEntity[i]).isDeletion()&&(delete this.entityStyles[i],this.removeEntity(i))},i.prototype.updatePSOI=function(e){for(var t in e.detIdToPSOIIncrement)this.bodyMetaData[t]&&(this.bodyMetaData[t].partIdentity=e.detIdToPSOIIncrement[t])},i.prototype.unloadBody=function(e){var t=this.bodyMetaData[e];if(t){t.setIsTessellationLoaded(!1),t.tessellationSettings=[];var i=this.bodyToEntity.get(e);if(i&&i.each((function(e,t){return this.removeEntity(t),!1}),this),this.tessellationSettings[e]=[u.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING],this.viewer.getEventDispatcher().trigger(y.BODY_UNLOADED,this.parent.getBtFullElementId(),e),this.damageInstantiatedTriangleCount(),t.isClosedComposite)for(var r=0;r<t.constituentBodyIds.length;++r)this.unloadBody(t.constituentBodyIds[r])}},i.prototype.removeBaseIncrement=function(e){if(this.baseComponent){var t=this.baseComponent.idToMetaData[e];if(t){var i=this.baseComponent.getEntityBodyGroupId(t),r=this.baseComponent.bodyToOccurrenceId.get(i);r&&r.each((function(t,i){return this.removeBaseIncrementFromOccurrence(e,i),!1}),this)}}},i.prototype.onBaseSilhouetteAdded=function(e,t,i){var r=this.bodyToOccurrenceId.get(i);r&&r.each((function(i,r){return this.wasIncrementRemovedFromBase(e,r)&&this.hideBaseIncrement(t,r),!1}),this)},i.prototype.processAdditionsAndChanges=function(e,t,i){var r;for(r in this.updateBodyDisplayData(e,i),this.updateEntityAppearanceOverrides(e),e.deterministicPartIdToData){var n=e.deterministicPartIdToData[r],o=this.bodyMetaData[r];if(o){for(var s=o.getIsTessellationLoaded(),a=o.canEntitiesBeLoaded(),c=0;c<n.entityDIds.length;++c){var l=n.entityDIds[c],u=e.deterministicIdToEntity[l];if(!u||this.handlesEntity(u,n))if(u){var h=(0,y.getMeshIncrementForEntityData)(u,l,this.getEntityIdManager().getOrCreateIdForName(l));if(!h)continue;h.groupId=o.meshGroupId,u.setBodyMetaData(o),u.setMeshIncrement(h),this.removeOldEntityGraphics(l,u),this.addIdMappings(l,u,r),s&&this.updateEntityGraphics(l,h,u),this.tallyEntityRetention(h,!0),this.viewer.getIsForFlattenedDisplay()===n.isForFlattenedView()&&u.removeGeometry()}else a&&this.changeEntityOwner(l,r)}s||o.isClosedCompositeConstituent||!o.canEntitiesBeLoaded()||this.bodyLoadTasks.postBodyToLoad(this,r)}}this.updateBodiesWithChangedMeshReferences(),t&&this.addPartStudioOccurrences()},i.prototype.getBodyType=function(e){var t=this.bodyMetaData[e];if(t)return t.type;for(var i=this.parent.getEntitiesForBody(e),r=0;i&&r<i.length;r++){var n=this.parent.retrieveEntityMetaData(i[r]);if(n&&n instanceof u.BTPointEntity)return u.GBTBodyType.POINT}return null},i.prototype.updateCompositeConstituentCounts=function(e){for(var t=0;t<e.partDisplayData.length;t++){var i=e.partDisplayData[t].id,r=this.bodyMetaData[i];r&&r.isComposite&&r.updateConstituentTypeCounts(this)}},i.prototype.handlesEntity=function(e,t){var i=t&&this.viewer.getIsForFlattenedDisplay()&&!t.isForFlattenedView();return!e.hasTessellationError()&&e.isFromBody()&&!i},i.prototype.updateEntityAppearanceOverrides=function(e){for(var t in e.appearanceIdToAppearanceOverride)for(var i=e.appearanceIdToAppearanceOverride[t],r=t===u.BTGraphicsAppearance.RESET_APPEARANCE_ID?null:Z(t,i.appearance),n=0;n<i.entityDeterministicIds.length;++n){var o=i.entityDeterministicIds[n];if(r?this.entityStyles[o]=r:delete this.entityStyles[o],this.containsEntity(o)){var s=this.getMeshIncrementDetails(o)||this.getBaseMeshIncrementDetails(o);s&&(this.removeEntityAppearanceOverride(s),r&&this.incorporateEntityAppearanceOverride(s))}}},i.prototype.getNodePropertiesForFace=function(e,i,o){var s=o===n.TRANSPARENT;return e.isMeshBodyOld()?s?e.containsOnlySheetBodies()?b:N:e.containsOnlySheetBodies()?w:R:e.containsOnlySheetBodies()?e.isModifiableBody()?s?F:L:A:e.isModifiableBody()?s?t.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT:i!==r.ALL_OPAQUE?C:t.SOLID_FACE_NODE_PROPERTIES:O},i.prototype.getNodePropertiesForEdge=function(e){return e.getIsBendCenterLineBody()?W:e.containsOnlyWireBodies()?e.isModifiableBody()?U:V:e.containsOnlySheetBodies()?e.isModifiableBody()?x:H:e.isModifiableBody()?B:G},i.prototype.getNodePropertiesForPoint=function(e){return e.containsOnlyWireBodies()?X:e.containsOnlySheetBodies()?z:j},i.prototype.getGroupBoundsForEntity=function(e){return this.bodyMetaData[this.getEntityBodyGroupId(e)].getBounds()},i.prototype.addMeshIncrementAndSilhouettes=function(e,t){var i=y.PartStudioComponent.prototype.addMeshIncrement.call(this,e,this.getGroupBoundsForEntity(t));this.incorporateEntityAppearanceOverride(i),this.addMeshTriangleEdges(e,t),e.primitiveType===y.PrimitiveType.TRIANGLE_STRIP&&!t.isPlanar()&&this.viewer.getSilhouetteTask().postSilhouetteRequest(e,this.usage,this.silhouetteCallback),this.damageInstantiatedTriangleCount()},i.prototype.addMeshTriangleEdges=function(e,t){if(t.isFace()&&($||t.getSurfaceType()===u.GBTSurfaceType.MESH)){var r=i.getMeshEdgeId(e.id),n=(0,y.createEdgesFromTriangleStrip)(e,r);n&&(n.groupId=i.getMeshEdgeId(this.getEntityBodyGroupId(t)),this.getMeshManager().addMeshIncrement(n,this.getMeshOwnerId(),this.getGroupBoundsForEntity(t)))}},i.prototype.onSilhouetteCreated=function(e,t){var i=e.id,r=this.idToMetaData[i];r&&r.getIncrementGloballyUniqueId()===e.getGloballyUniqueId()&&t&&(t.groupId=e.groupId,this.getMeshManager().addMeshIncrement(t,this.getMeshOwnerId()),this.previewClone&&this.previewClone.onBaseSilhouetteAdded(i,t.id,e.groupId),this.viewer.requestDraw())},i.getMeshEdgeId=function(e){return-1!==e.indexOf(i.MESH_EDGE_GROUP_SUFFIX,e.length-i.MESH_EDGE_GROUP_SUFFIX.length)?e:e+i.MESH_EDGE_GROUP_SUFFIX},i.getPotentialMeshGroupIdsForBody=function(e){return[e,e+i.MESH_EDGE_GROUP_SUFFIX]},i.prototype.callBaseVisibilityMethodForIncrementAndDerivations=function(e,t,r){var n=e.call(this,t,r);e.call(this,(0,y.getSilhouettesId)(t),r);var o=i.getMeshEdgeId(t);return o!==t&&e.call(this,o,r),n},i.prototype.showMeshIncrement=function(e,t){this.callBaseVisibilityMethodForIncrementAndDerivations(y.PartStudioComponent.prototype.showMeshIncrement,e,t)},i.prototype.hideMeshIncrement=function(e,t){this.callBaseVisibilityMethodForIncrementAndDerivations(y.PartStudioComponent.prototype.hideMeshIncrement,e,t)},i.prototype.hideBaseIncrement=function(e,t){return this.callBaseVisibilityMethodForIncrementAndDerivations(y.PartStudioComponent.prototype.hideBaseIncrement,e,t)},i.prototype.showBaseIncrement=function(e,t){this.callBaseVisibilityMethodForIncrementAndDerivations(y.PartStudioComponent.prototype.showBaseIncrement,e,t)},i.prototype.refreshEntityGraphics=function(e,t){var i=this.idToMetaData[e];i&&(this.removeMeshIncrement(e),this.removeBaseIncrement(e),i=i.cloneForNewBody(t),this.idToMetaData[e]=i,this.updateEntityGraphics(e,i.getMeshIncrement(),i))},i.prototype.removeMeshIncrement=function(t){var r=y.PartStudioComponent.prototype.removeMeshIncrement.apply(this,arguments);e.prototype.removeMeshIncrement.call(this,(0,y.getSilhouettesId)(t)),r&&(this.viewer.getSilhouetteTask().removePendingRequest(r.increment,this.usage),this.removeEntityAppearanceOverride(r));var n=i.getMeshEdgeId(t);return n!==t&&y.PartStudioComponent.prototype.removeMeshIncrement.call(this,n),this.damageInstantiatedTriangleCount(),r},i.prototype.incorporateEntityAppearanceOverride=function(e){var t=!1,i=e.increment.groupId,r=this.entityStyles[e.increment.id];if(r){var o=K(r)?n.TRANSPARENT:n.OPAQUE,s=this.subBodyStyleOverrides.getNested(i,o);s||(s=new y.IncrementRanges(i+" "+(o===n.OPAQUE?"opaque":"transparent")+" entity style overrides",i),this.subBodyStyleOverrides.insertNested(i,o,s),t=!0),s.onIncrementAdded(e,r)}t&&this.bodiesWithUpdatedMeshReferences.add(i)},i.prototype.removeEntityAppearanceOverride=function(e){var t=this,i=!1,r=e.increment.groupId,n=this.subBodyStyleOverrides.get(r);n&&n.each((function(n,o){n.onIncrementRemoved(e)&&n.isEmpty()&&(n.destroy(),t.subBodyStyleOverrides.removeNested(r,o),i=!0)})),i&&this.bodiesWithUpdatedMeshReferences.add(r)},i.prototype.damageComputedBodyTransparency=function(e){delete this.cachedBodyTransparencyState[e]},i.prototype.getComputeBodyTransparency=function(e){var t=this;if(this.cachedBodyTransparencyState.hasOwnProperty(e))return this.cachedBodyTransparencyState[e];var i=this.getBodyColor(e)[3]<1,n=this.bodyMetaData[e],o=[e];n&&n.isClosedComposite&&(o=n.constituentBodyIds);for(var s=0,a=0,c=0;c<o.length;++c){var l=this.bodyToEntity.get(o[c]);l&&l.each((function(e,i){var r=t.entityStyles[i];return r&&(K(r)?++s:++a),s>0&&a>0}))}var u=r.ALL_OPAQUE;return i&&a>0?u=r.TRANSPARENT_BODY_OPAQUE_FACE:!i&&s>0?u=r.OPAQUE_BODY_TRANSPARENT_FACE:i&&(u=r.ALL_TRANSPARENT),this.cachedBodyTransparencyState[e]=u,u},i.prototype.getHideableFeatureIds=function(){return[]},i.prototype.hideShowFeature=function(e,t,i){this.featureVisibility[e]=t;var r=this.getEntitiesForFeature(e);if(r){for(var n=new f.StringSet,o=0;o<r.length;++o){var s=this.idToMetaData[r[o]],a=s?s.getBodyMetaData():void 0;a.isClosedCompositeConstituent&&(a=a.consumingClosedCompositeData),a&&!a.isModifiableBody()&&i&&n.add(a.id)}n.each((function(e){this.hideShowBody(e,t,y.PART_STUDIO_ELEMENT_ID)}),this)}},i.prototype.updateEdgeSmoothness=function(e){var t=0;for(var i in this.idToMetaData){var r=this.idToMetaData[i];if(r.isEdge()&&(r.isFromSolidBody()||r.isFromSheetBody())){e.hasOwnProperty(i)||++t;var n=r.getGeometry();e[i]?n.edgeSmoothnessStatus=u.GBTEntityEdgeSmoothnessStatus.SMOOTH:n.edgeSmoothnessStatus=u.GBTEntityEdgeSmoothnessStatus.NOT_SMOOTH}}t>0&&l.log.warn("Did not find edge smoothness data for "+t+" edges")},i.prototype.updateEntityGraphics=function(e,t,i){var r=this;t.pickId=this.getEntityIdManager().getOrCreateIdForName(e),i.getEdgeSmoothnessStatus()===u.GBTEntityEdgeSmoothnessStatus.SMOOTH&&((0,y.addStyleToIncrement)(_,t),(0,y.addColorToIncrement)(M,t),(0,y.addSizeToIncrement)(D,t)),!this.parent.getIsMissingTangencyInformationMessageShown()&&this.viewer.getSmoothEdgesRenderStyle()!==u.GBTSmoothEdgeStyle.VISIBLE&&i.isEdge()&&i.getEdgeSmoothnessStatus()===u.GBTEntityEdgeSmoothnessStatus.UNKNOWN&&(this.parent===this.parent.getModelViewManager().getDisplayedPartStudio()?this.parent.getModelViewManager().updateSmoothEdgesForDisplayedPartStudio():c.btInjector.CapabilitiesService.checkSmoothEdgesRenderOptionsForAssembliesCurrentlyEnabled()&&(this.viewer.showTangencyInformationMissingMessage(),this.parent.setIsMissingTangencyInformationMessageShown(!0),setTimeout((function(){r.viewer.setSmoothEdgesRenderStyle(u.GBTSmoothEdgeStyle.VISIBLE)}),0))),t.groupId=this.getEntityBodyGroupId(i),this.addMeshIncrementAndSilhouettes(t,i)},i.prototype.instantiateForPartStudio=function(e){y.PartStudioComponent.prototype.instantiateForPartStudio.apply(this,arguments),this.addPartStudioOccurrences()},i.prototype.removePartStudioInstantiation=function(e){this.usage===y.bt_graphics_Usage.PREVIEW&&y.PartStudioComponent.prototype.removePartStudioInstantiation.apply(this,arguments),this.removeOccurrence(y.PART_STUDIO_ELEMENT_ID,!1)},i.prototype.isBodyLoaded=function(e){var t=this.bodyMetaData[e];return!!t&&t.getIsTessellationLoaded()},i.prototype.processBodyAddition=function(e,t){var i=this.bodyMetaData[e];if(i&&i.isClosedComposite){for(var r=0;r<i.constituentBodyIds.length;++r)this.isBodyLoaded(i.constituentBodyIds[r])||this.processBodyAddition(i.constituentBodyIds[r],t);return i.setIsTessellationLoaded(!0),!0}var n=this.bodyToEntity.get(e);if(!n)return!0;if(this.isBodyLoaded(e)&&l.log.warn("The same body occurrence was loaded twice"),n.each((function(e,i){var r=this.idToMetaData[i];if(!r||!r.meshIncrement)return!1;t&&t.addVertexCost(r.meshIncrement.vertexCount()),this.updateEntityGraphics(i,r.meshIncrement,r)}),this),i&&i.setIsTessellationLoaded(!0),this.damageInstantiatedTriangleCount(),this.getBodyManager().damageUnloadedBodyBounds(),this.partStudioBodyIdToOccurrenceId.hasOwnProperty(e)){var o=this.viewer.getOccurrenceDataManager().getOccurrenceData(this.partStudioBodyIdToOccurrenceId[e]);o&&o.clearAllOccurrenceLevelHighlights()}return this.updateBodiesWithChangedMeshReferences(),!0},i.prototype.addBodyOccurrence=function(e,t,i,r){if(!this.bodyToOccurrenceId.hasNested(t,e)||i){var n=this.bodyMetaData[t];if(n){this.bodyToOccurrenceId.insertNested(t,e,!0);var o=this.getBodyOccurrenceData(t,e);if(o){var s=this.getBodyColor(t,e),a=new y.Style;n.containsOnlyWireBodies()&&a.setAttribute(y.Attributes.COLOR,s),this.addBodyOccurrenceFromMeshManager(this.getMeshManager(),e,o,t,n,s,a),this.getSharedBaseMeshManager()&&!this.bodiesHiddenInBase.has(t)&&this.addBodyOccurrenceFromMeshManager(this.getSharedBaseMeshManager(),e,o,t,n,s,a),i||this.damageInstantiatedTriangleCount()}else l.log.warn("Tried to add occurrence without occurrence data")}else r||this.unavailableBodyOccurrences.insertNested(t,e,!0)}},i.prototype.addBodyOccurrenceFromMeshManager=function(e,o,s,a,c,l,u){if(c.hasFaces()){var h=new y.Style;h.setAttribute(y.Attributes.COLOR,l);var d=c.getChordalTolerance();null!==d?h.setFloatUniform("uChordalTolerance",d):h.setFloatUniform("uChordalTolerance",m.Tolerances.MAX_MODEL_SIZE);var p=this.occurrenceAlphaModifiers.has(o)?r.ALL_TRANSPARENT:this.getComputeBodyTransparency(a);switch(p){case r.ALL_OPAQUE:this.addFaceRangesToOccurrenceNode(e,c,s,h,p,n.OPAQUE);break;case r.ALL_TRANSPARENT:this.addFaceRangesToOccurrenceNode(e,c,s,h,p,n.TRANSPARENT);break;default:this.addFaceRangesToOccurrenceNode(e,c,s,h,p,n.OPAQUE),this.addFaceRangesToOccurrenceNode(e,c,s,h,p,n.TRANSPARENT)}var g=e.getOrCreateGroupRangesForGroupTypeAndLod(a,this.getMeshOwnerId(),y.PrimitiveType.SILHOUETTES,y.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(q,s,u,g)}if(($||c.containsMesh())&&!this.simulatedOccurrences.has(s.getOccurrenceId())){var f=i.getMeshEdgeId(c.id),v=e.getOrCreateGroupRangesForGroupTypeAndLod(f,this.getMeshOwnerId(),y.PrimitiveType.LINES,y.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(t.MESH_EDGE_NODE_PROPERTIES,s,u,v)}if(c.hasEdges()){var E=e.getOrCreateGroupRangesForGroupTypeAndLod(a,this.getMeshOwnerId(),y.PrimitiveType.LINES,y.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(this.getNodePropertiesForEdge(c),s,u,E)}if(c.hasPoints()){E=e.getOrCreateGroupRangesForGroupTypeAndLod(a,this.getMeshOwnerId(),y.PrimitiveType.POINTS,y.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(this.getNodePropertiesForPoint(c),s,u,E)}},i.prototype.addFaceRangesToOccurrenceNode=function(e,i,o,s,a,c){var l,u=i.id;l=this.simulatedOccurrences.has(o.getOccurrenceId())?t.SIMULATED_FACE_NODE_PROPERTIES:this.getNodePropertiesForFace(i,a,c);var h,d=e.getOrCreateGroupRangesForGroupTypeAndLod(u,this.getMeshOwnerId(),y.PrimitiveType.TRIANGLE_STRIP,y.Lod.DEFAULT),p=null,g=this.getSubBodyStyleOverrides(u,o.getOccurrenceId(),c);a===r.ALL_OPAQUE||a===r.ALL_TRANSPARENT?h=d:a===r.OPAQUE_BODY_TRANSPARENT_FACE?c===n.OPAQUE?(h=d,p=this.subBodyStyleOverrides.getNested(u,n.TRANSPARENT)):(h=this.subBodyStyleOverrides.getNested(u,n.TRANSPARENT),g=null):a===r.TRANSPARENT_BODY_OPAQUE_FACE&&(c===n.TRANSPARENT?(h=d,p=this.subBodyStyleOverrides.getNested(u,n.OPAQUE)):(h=this.subBodyStyleOverrides.getNested(u,n.OPAQUE),g=null)),h&&this.node.addOccurrenceGeometryToNode(l,o,s,h,g,p)},i.prototype.getSubBodyStyleOverrides=function(e,t,i){if(this.occurrenceAlphaModifiers.has(t)){var r=this.subBodyStyleOverrides.getNested(e,n.OPAQUE),o=this.subBodyStyleOverrides.getNested(e,n.TRANSPARENT),s=void 0;if(r&&o){var a=new y.StyleUnionOperator;a.setOperandA(r),a.setOperand(o),s=a}else r?s=r:o&&(s=o);if(s){var c=this.occurrenceAlphaModifiers.get(t),l=new y.StyleModificationOperator((0,y.getAlphaModifierFunction)(c));return l.setOperand(s),l}return null}return this.subBodyStyleOverrides.getNested(e,i)},i.prototype.getPartStudioBodyOccurrenceName=function(e){return i.PART_STUDIO_BODY_OCCURRENCE_PREFIX+"."+this.getMeshOwnerId()+"."+e},i.prototype.removeBodyOccurrence=function(e,t,r){e=this.getCorrectedBodyOccurrenceId(t,e);for(var n=i.getPotentialMeshGroupIdsForBody(t),o=0;o<n.length;++o)this.node.removeMeshGroupFromOccurrence(n[o],e);if(!r){if(e===this.partStudioBodyIdToOccurrenceId[t]){var s=!1,a=this.baseComponent||this.previewClone;a&&(s=a.partStudioBodyIdToOccurrenceId.hasOwnProperty(t)),s||(this.viewer.getOccurrenceDataManager().destroyOccurrenceData(e),this.viewer.getOccurrenceIdManager().removeName(this.getPartStudioBodyOccurrenceName(t))),delete this.partStudioBodyIdToOccurrenceId[t]}this.bodyToOccurrenceId.removeNested(t,e),this.unavailableBodyOccurrences.removeNested(t,e),this.damageInstantiatedTriangleCount(),this.contributesToBodyManager()&&this.getBodyManager().removeOccurrence(e,t)}},i.prototype.refreshAllBodyOccurrences=function(){this.bodyToOccurrenceId.eachNested((function(e,t,i){return this.refreshBodyOccurrence(+i,t),!1}),this)},i.prototype.refreshBodyOccurrence=function(e,t){this.removeBodyOccurrence(e,t,!0),this.addBodyOccurrence(e,t,!0)},i.prototype.refreshBodyOccurrences=function(e,t){if(t){var i=this.partStudioBodyIdToOccurrenceId[e];i&&this.refreshBodyOccurrence(i,e)}else{var r=this.bodyToOccurrenceId.get(e);r&&r.each((function(t,i){return this.refreshBodyOccurrence(i,e),!1}),this)}},i.prototype.refreshOccurrence=function(e){var t=this,i=this.occurrences[e];i&&i.displayedPartIds.forEach((function(i){t.refreshBodyOccurrence(e,i)}))},i.prototype.updateBodiesWithChangedMeshReferences=function(){var e,t;try{for(var i=(0,o.__values)(this.bodiesWithUpdatedMeshReferences),r=i.next();!r.done;r=i.next()){var n=r.value;this.damageComputedBodyTransparency(n),this.refreshBodyOccurrences(n)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.bodiesWithUpdatedMeshReferences.clear()},i.prototype.getInstantiableConstituentIds=function(e){if(e.isGroupableCompositeBody)throw new Error("Cannot instantiate constituents of grouped composites");if(e.isClosedComposite)return e.constituentBodyIds;for(var t=new Set,i=0;i<e.constituentBodyIds.length;++i){var r=e.constituentBodyIds[i],n=this.bodyMetaData[r];n&&n.isClosedCompositeConstituent&&n.consumingClosedCompositeData.isGroupableCompositeBody?t.add(n.consumingClosedCompositeData.id):t.add(r)}return Array.from(t)},i.prototype.addOrUpdateOccurrence=function(t,i){var r=this;if(i){for(var n=new Set,o=0;o<i.partIds.length;++o){var s=i.partIds[o],a=this.bodyMetaData[s];if(a&&a.isNonGroupingCompositeBody)for(var c=this.getInstantiableConstituentIds(a),l=0;l<c.length;++l){var u=c[l];this.knownBodyIds.has(u)&&n.add(u)}else this.knownBodyIds.has(s)&&n.add(s)}i.displayedPartIds=n;var h=this.occurrences[t]?this.occurrences[t].displayedPartIds:new Set,d=(0,y.setSubtract)(n,h),p=(0,y.setSubtract)(h,n);if((d.size>0||this.occurrences[t])&&e.prototype.addOrUpdateOccurrence.call(this,t,i),this.updateOccurrenceParts(t,i,d,p),n.size>0&&this.contributesToBodyManager()){var g=this.getBodyManager();n.forEach((function(e){var i=r.bodyMetaData[e],o=r.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(t);i&&g.addOrUpdateOccurrence(t,o,i,n.size)}))}}},i.prototype.addPartStudioOccurrences=function(){var t=this.getBodyManager();for(var i in this.bodyMetaData){var r=this.bodyMetaData[i];if(r.isForFlattenedView()===this.viewer.getIsForFlattenedDisplay()&&!r.isNonGroupingCompositeBody&&!r.canBeGroupedWithOtherConstituents){if(!this.partStudioBodyIdToOccurrenceId[i]){var n=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.getPartStudioBodyOccurrenceName(i)),o=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(n);if(this.partStudioBodyIdToOccurrenceId[i]=n,this.addBodyOccurrence(this.partStudioBodyIdToOccurrenceId[i],i),this.contributesToBodyManager()){t.addOrUpdateOccurrence(n,o,r,1)}this.hideShowBody(i,r.partStudioVisibility,y.PART_STUDIO_ELEMENT_ID)}e.prototype.addOrUpdateOccurrence.call(this,this.partStudioBodyIdToOccurrenceId[i],null)}}this.updateFlattenedBodyLayout()},i.prototype.updateOccurrenceParts=function(e,t,i,r,n){var o=this;r.forEach((function(t){o.removeBodyOccurrence(e,t),o.damageInstantiatedTriangleCount()})),i.forEach((function(t){o.addBodyOccurrence(e,t,!1,n),o.damageInstantiatedTriangleCount()})),t.displayedPartIds.forEach((function(i){o.hideShowBody(i,t.isHidden?y.Visibility.HIDDEN:y.Visibility.VISIBLE,e)}))},i.prototype.reloadOccurrences=function(){var e,t=new Set;for(e in this.occurrences)if(e=+e,y.PART_STUDIO_ELEMENT_ID!==e){var i=this.occurrences[e];if(i){this.updateOccurrenceParts(e,i,i.displayedPartIds,t,!0)}}else l.log.warn("The part studio occurrence should not be reloaded")},i.prototype.removeOccurrence=function(t,i){var r=this,n=this.occurrences[t];if(n||t===y.PART_STUDIO_ELEMENT_ID){if(n)n.displayedPartIds.forEach((function(e){return r.removeBodyOccurrence(t,e)}));else for(var o in this.partStudioBodyIdToOccurrenceId)this.removeBodyOccurrence(this.partStudioBodyIdToOccurrenceId[o],o);e.prototype.removeOccurrence.call(this,t,i)}},i.prototype.changeEntityOwner=function(e,t){var i=this.idToMetaData[e];if(i)if(i.isFromBody()){if(i.getBodyId()!==t){this.removeMeshIncrement(e),this.removeIdMappings(e);var r=this.bodyMetaData[t];if(r){var n=i.cloneForNewBody(r);n.getMeshIncrement()?(this.addIdMappings(e,n,t),this.updateEntityGraphics(e,n.getMeshIncrement(),n)):l.log.error("Failed to find mesh increment for a body entity")}else l.log.error("Failed to find body metadata for body: "+t)}}else l.log.error("Trying to switch entity to a part that did not belong to a part in the first place");else J||(l.log.error("Metadata for entity "+e+" owner "+t+" that is trying to switch between bodies was not found"),J=!0)},i.prototype.refreshSmoothEdges=function(){for(var e in this.idToMetaData){var t=this.idToMetaData[e];t.getEdgeSmoothnessStatus()===u.GBTEntityEdgeSmoothnessStatus.SMOOTH&&this.refreshEntityGraphics(e,t.getBodyMetaData())}},i.prototype.getBodyIdsWithConstituentsInScenegraph=function(e){var t,i,r,n,s=new Set(e);try{for(var a=(0,o.__values)(e),c=a.next();!c.done;c=a.next()){var l=c.value,u=this.bodyMetaData[l];if(u&&u.isNonGroupingCompositeBody&&u.constituentBodyIds)try{for(var h=(r=void 0,(0,o.__values)(u.constituentBodyIds)),d=h.next();!d.done;d=h.next()){var p=d.value;s.add(p)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return s},i.prototype.setIsBodyClippedBySectionPlane=function(e,t,i,r){var n,s;if(i){var a=this.getBodyOccurrenceData(e,this.partStudioBodyIdToOccurrenceId[e]);a&&a.setIsClippedBySectionPlanes(t)}else{var c=this.getBodyIdsWithConstituentsInScenegraph(new Set([e])),l=r?this.getBodyIdsWithConstituentsInScenegraph(r):null;try{for(var u=(0,o.__values)(c),h=u.next();!h.done;h=u.next()){var d=h.value;l&&l.has(d)||this.setIsBodyClippedBySectionPlane(d,t,!0)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}}},i.prototype.setAreOccurrencesClippedBySectionPlaneExcept=function(e,t){var i,r;for(var n in this.bodyMetaData)this.setIsBodyClippedBySectionPlane(n,e);try{for(var s=(0,o.__values)(t),a=s.next();!a.done;a=s.next()){n=a.value;this.setIsBodyClippedBySectionPlane(n,!e)}}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}},i.prototype.updateBodyMetaData=function(e,t,i,r,n,o,s){var a,c=this,h=this.bodyMetaData[t],d=!1,p=!1,g=null;h?a=h.consumingClosedCompositeData?h.consumingClosedCompositeData.id:"":(h=new y.BodyMetaData(t),this.bodyMetaData[t]=h);var f=!1;void 0!==a&&(f=a!==(o?o.id:""));var m=h.type,v=h.meshState,E=h.isGroupableCompositeBody;if(h.setColorCycle(this.parent.getPartColorCycle()),i){h.name=i.name,h.meshState=i.meshState;var I=u.GBTBodyType.SOLID;i.isSheet?I=u.GBTBodyType.SHEET:i.isWire&&(I=u.GBTBodyType.WIRE),h.type=I,h.isModifiable!==i.isModifiable&&this.bodyVisibility.removeNested(this.partStudioBodyIdToOccurrenceId[t],t),h.isModifiable=i.isModifiable,h.setAppearanceFromDisplayData(i),h.isActiveSheetMetal=i.isActiveSheetMetal;var T=i.customProperties.properties[u.BTPartCustomProperties.TESSELLATION_SETTING_PROPERTY_ID];T&&(h.tessellationSettingOverride=+T),h.consumingClosedCompositeData&&(f=!0),h.consumingClosedCompositeData=null,g=new y.BoundingBox(i.lowBoxCorner.getVec3(),i.highBoxCorner.getVec3())}else h.setAppearanceFromDisplayData(n),h.consumingClosedCompositeData=o,r&&(h.type=r.closedConstituentPartData.bodyType,h.isActiveSheetMetal=r.closedConstituentPartData.isActiveSheetMetal,h.meshState=r.closedConstituentPartData.meshState,g=new y.BoundingBox(r.lowBoxCorner.getVec3(),r.highBoxCorner.getVec3()));if(r){var S=h.getFinestTessellationSettingOnClient();h.sheetMetalModelId=r.sheetMetalModelId,h.isFlattenedSheetMetalBody=r.isFlattenedSheetMetalBody,h.isBendCenterLineBody=r.isBendCenterLineBody,h.ownerFlattenedBodyId=r.ownerFlattenedBodyId,h.tessellationSettings=r.tessellationSettings,h.sheetMetalOrderId=r.sheetMetalOrderId,r.hasTessellationComplexityInformation&&(h.coarseTriangleCount=r.coarseTriangleCount,h.coarsePlanarFaceTriangleCount=r.coarsePlanarFaceTriangleCount),h.isAssociatedWithFlat=r.isAssociatedWithFlat,h.totalEntityCount=r.totalEntityCount,h.bestAvailableTessellationSetting=r.bestAvailableTessellationSetting,null!==S&&h.getFinestTessellationSettingOnClient()!==S&&(p=!0),h.isComposite=r.isComposite,h.isClosedComposite=r.isClosedComposite,h.updateConstituentBodyIds(r.constituentBodyDeterministicIds,this.bodyMetaData)}if(h&&h.isComposite&&h.updateDataDerivedFromConstituents(this.bodyMetaData,e.deterministicPartIdToData),g&&!g.equals(h.bounds)&&(h.bounds=g,h.resetMeshIncrement(),d=!0),h&&h.isClosedComposite){i||l.log.warn("Expected to have display data for parent composite, but none was present");for(var P=0;P<h.constituentBodyIds.length;++P){var _=h.constituentBodyIds[P],M=e.deterministicPartIdToData[_];this.updateBodyMetaData(e,_,null,M,i,h,E)}}if(f=f||"boolean"==typeof s&&s!==h.canBeGroupedWithOtherConstituents){this.baseComponent&&this.bodiesHiddenInBase.add(h.meshGroupId);var D=this.bodyToEntity.get(t);D&&(D.each((function(e,t){c.refreshEntityGraphics(t,h)})),h.setIsTessellationLoaded(h.canEntitiesBeLoaded()))}(m!==h.type||p||v!==h.meshState)&&this.refreshBodyOccurrences(t),this.updateBodyColor(t),d&&this.updateBodyManagerReferencesForBody(t);var C=this.unavailableBodyOccurrences.get(t);C&&(C.each((function(e,i){return c.addBodyOccurrence(+i,t),!1})),this.unavailableBodyOccurrences.remove(t))},i.prototype.getBodyColor=function(e,t){var i=this.bodyMetaData[e],r=i?i.getColor():(0,y.convertRGBA255ToRGBA)(h.LATEST_COLOR_CYCLE[0]);return this.occurrenceAlphaModifiers.has(t)&&(r[3]*=this.occurrenceAlphaModifiers.get(t)),r},i.prototype.getFaceColor=function(e,t){var i=this.idToMetaData[e];if(!i)return null;var r=this.entityStyles[e];if(r){var n=r.getAttribute(y.Attributes.COLOR);return this.occurrenceAlphaModifiers.has(t)&&((n=n.slice())[3]*=this.occurrenceAlphaModifiers.get(t)),n}return this.getBodyColor(i.getBodyId(),t)},i.prototype.setBodyOpacity=function(e,t,i){var r=this.bodyMetaData[e];r&&(r.appearance||(r.appearance=new u.BTGraphicsAppearance),r.appearance.color&&(r.appearance.opacity=t,this.updateBodyColor(e,i)))},i.prototype.setBodyColor=function(e,t,i){var r=this.bodyMetaData[e];if(r&&(r.appearance||(r.appearance=new u.BTGraphicsAppearance),r.appearance.color&&(r.appearance.color=t,this.updateBodyColor(e,i)),r.isComposite&&r.constituentBodyIds))for(var n=0;n<r.constituentBodyIds.length;++n)this.setBodyColor(r.constituentBodyIds[n],t,i)},i.prototype.updateBodyColor=function(e,t){var i=this.getBodyColor(e);(0,p.arraysEqual)(this.lastSetBodyColor[e],i)||(this.lastSetBodyColor[e]=i,this.damageComputedBodyTransparency(e),this.refreshBodyOccurrences(e,t))},i.prototype.getOccurrenceColor=function(e){var t,i,r=this.viewer.getOccurrenceIdManager().getIdForName(e.toString());if(r===y.INVALID_OCCURRENCE_ID)return null;var n=this.occurrences[r];if(!n)return null;try{for(var s=(0,o.__values)(n.displayedPartIds),a=s.next();!a.done;a=s.next()){var c=a.value,l=this.getBodyColor(c,r);if(l)return l.slice(0)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return null},i.prototype.setOccurrenceAlphaModifier=function(e,t){if(t<0||t>=1)l.log.warn("Only alpha modifiers in the range [0, 1) are accepted");else{var i=this.viewer.getOccurrenceIdManager().getIdForName(e.toString());i!==y.INVALID_OCCURRENCE_ID&&(this.occurrenceAlphaModifiers.set(i,t),this.refreshOccurrence(i))}},i.prototype.clearOccurrenceAlphaModifier=function(e){var t=this.viewer.getOccurrenceIdManager().getIdForName(e.toString());t!==y.INVALID_OCCURRENCE_ID&&this.occurrenceAlphaModifiers.delete(t)&&this.refreshOccurrence(t)},i.prototype.getEntityColor=function(e){var t=this.entityStyles[e];if(t){var i=t.getAttribute(y.Attributes.COLOR);if(i)return i.slice()}var r=this.idToMetaData[e];return r?this.getBodyColor(r.getBodyId()):null},i.prototype.getOccurrenceBounds=function(e){var t=this,i=new y.BoundingBox,r=this.occurrences[e];return r&&r.displayedPartIds.forEach((function(r){i.addBox(t.getBodyManager().getOccurrenceBounds(e,r))})),i},i.prototype.getEntityBodyGroupId=function(e){var t=e.getBodyId(),i=this.bodyMetaData[t];return i?i.meshGroupId:e.getBodyId()},i.prototype.setSimulatedOccurrence=function(e){this.simulatedOccurrences.add(e),this.refreshOccurrence(e)},i.prototype.clearSimulatedOccurrence=function(e){this.simulatedOccurrences.delete(e),this.refreshOccurrence(e)},i.prototype.updateEntityHighlight=function(e,t,i,r){var n=this.idToMetaData[i];if(!n)return!1;var o=this.getEntityBodyGroupId(n);if((r=this.getCorrectedBodyOccurrenceId(o,r))===y.INVALID_OCCURRENCE_ID||!r)return!1;var s=this.bodyMetaData[n.getBodyId()];if(s&&s.isForFlattenedView()&&(!(s.sheetMetalModelId===this.viewer.getModelViewManagers().getManager().getSelectedSheetmetalModelId())&&!this.isOccurrenceIdForAssembly(r)))return!1;return y.PartStudioComponent.prototype.updateEntityHighlight.call(this,e,t,i,r)},i.prototype.getBodyOccurrenceData=function(e,t){return(t=this.getCorrectedBodyOccurrenceId(e,t))!==y.INVALID_OCCURRENCE_ID&&t&&this.bodyToOccurrenceId.hasNested(e,t)?this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(t):null},i.prototype.hideShowBody=function(e,t,i){var r=this.bodyMetaData[e];if(r&&r.isClosedComposite&&!r.isGroupableCompositeBody)for(var n=0;n<r.constituentBodyIds.length;++n)this.hideShowBody(r.constituentBodyIds[n],t,i);!i&&r&&(r.partStudioVisibility=t);var o=this.getBodyOccurrenceData(e,i);o&&o.getVisibility()!==t&&(o.setVisibility(t),this.viewer.requestDraw())},i.prototype.setBodyCullingState=function(e,t,r){var n=this.getBodyOccurrenceData(r,e);if(n&&n.getMeshGroupCullingState(r)!==t){for(var o=i.getPotentialMeshGroupIdsForBody(r),s=0;s<o.length;++s)n.setCullingState(t,o[s]);this.viewer.requestDraw()}},i.prototype.isEntityHidden=function(e,t){var i=this.getBodyOccurrenceData(this.getEntityBodyGroupId(e),t);return!!i&&i.getVisibility()===y.Visibility.HIDDEN},i.prototype.getBodyDisplay=function(e){var t=this.bodyMetaData[e];return t?t.meshIncrement?t.meshIncrement:t.isSolidBody()||t.isSheetBody()?(t.meshIncrement=(0,y.createBox)(t.getBounds().getMin(),t.getBounds().getMax()),t.meshIncrement.id=e,t.meshIncrement.groupId=e,t.meshIncrement.lod=y.Lod.LOWEST,t.meshIncrement.pickId=this.getEntityIdManager().getOrCreateIdForName(e),t.meshIncrement):null:null},i.prototype.getOccurrenceIdForEntity=function(e){var t;if(this.idToMetaData[e]&&this.idToMetaData[e]instanceof u.BTBodyEntity){var i=this.idToMetaData[e];i.bodyMetaData&&(t=this.partStudioBodyIdToOccurrenceId[i.bodyMetaData.id])}return t},i.prototype.getStatistics=function(e,t){var i=this;void 0===t&&(t=!1);var r={faces:0,triangles:0,edges:0,lines:0,vertices:0,silhouettes:0,settingCounts:{},uniqueParts:0,uniqueSurfaces:0,uniqueCurves:0,uniqueOpenComposites:0,uniqueClosedComposites:0,partOccurrences:0,surfaceOccurrences:0,curveOccurrences:0,openCompositeOccurrences:0,openCompositeConstituentOccurrences:0,closedCompositeOccurrences:0,closedCompositeConstituentOccurrences:0,bodiesPendingRetrieval:0,veryFineParts:new Map,veryFineOccurrences:[]},n=this.getMeshManager(),o=this.getMeshOwnerId(),s=new Set,a=new Set,c=new Map,l=[],h=function(d,p,g){if(e){var f=i.bodyToEntity.get(d);f&&f.each((function(e,t){var n=i.idToMetaData[t];if(n)return n.isFace()?(r.faces+=1,r.triangles+=n.getMeshIncrement().getTriangleCount()):n.isLine()?(r.edges+=1,r.lines+=n.getMeshIncrement().getLineCount()):n.isVertex()&&(r.vertices+=1),!1}));var m=n.getGroupRangesForGroupTypeAndLod(d,o,y.PrimitiveType.SILHOUETTES,y.Lod.DEFAULT);m&&(r.silhouettes+=m.getPrimitiveCount())}var v=i.bodyMetaData[d],E=i.occurrences[p],I=u.GBTTessellationSettingEnum.VERY_FINE-1;if(v&&v.tessellationSettings){if(!v.isClosedCompositeConstituent)for(var T=0;T<v.tessellationSettings.length;++T){var S=v.tessellationSettings[T],P=r.settingCounts[S]||0;r.settingCounts[S]=P+1,t&&S===I&&(E?l.push(E.occurrenceData.occurrence):v&&(c.has(d)||c.set(d,v)))}if(v.isClosedComposite&&!a.has(v)&&(r.uniqueClosedComposites++,a.add(v)),g&&(v.isClosedComposite?r.closedCompositeOccurrences++:v.isSolidBody()?r.partOccurrences++:v.isSheetBody()?r.surfaceOccurrences++:v.isWireBody()&&r.curveOccurrences++),v.isClosedComposite&&g)for(T=0;T<v.constituentBodyIds.length;++T)h(v.constituentBodyIds[T],p,!1);if(v.isClosedCompositeConstituent&&g){r.closedCompositeConstituentOccurrences++;var _=E?p:v.consumingClosedCompositeData.id;s.has(_)||(h(v.consumingClosedCompositeData.id,p,!1),s.add(p))}else if(v.hasReferencingOpenCompositeBody&&E){var M=i.bodyMetaData[E.partIds[0]];M.isOpenCompositeBody&&(r.openCompositeConstituentOccurrences++,s.has(p)||(r.openCompositeOccurrences++,s.add(p)),a.has(M)||(r.uniqueOpenComposites++,a.add(M)))}}};return this.bodyToOccurrenceId.each((function(e,t){var i=this.bodyMetaData[t];return i&&(i.isComposite||i.isClosedCompositeConstituent||(i.isSolidBody()?r.uniqueParts++:i.isSheetBody()?r.uniqueSurfaces++:i.isWireBody()&&r.uniqueCurves++,i.canEntitiesBeLoaded()||r.bodiesPendingRetrieval++)),e.each((function(e,i){return h(t,i,!0),!1})),!1}),this),t&&(r.veryFineParts=c,r.veryFineOccurrences=l),r},i.prototype.getPartStudioBodyOccurrenceIds=function(){var e=[];for(var t in this.partStudioBodyIdToOccurrenceId)e.push(this.partStudioBodyIdToOccurrenceId[t]);return e},i.prototype.showPartsWithSheetmetalModelIdOnly=function(e){for(var t in this.partStudioBodyIdToOccurrenceId){if(t in this.bodyMetaData)this.bodyMetaData[t].sheetMetalModelId===e?this.hideShowBody(t,y.Visibility.VISIBLE,y.PART_STUDIO_ELEMENT_ID):this.hideShowBody(t,y.Visibility.HIDDEN,y.PART_STUDIO_ELEMENT_ID)}},i.prototype.needsDisplayData=function(e){for(var t=!1,i=0;i<e.partDisplayData.length;i++){var r=e.partDisplayData[i];t=t||r.id in this.bodyMetaData&&this.bodyMetaData[r.id].isForFlattenedView()}return t},i.prototype.isBodyActiveInView=function(e,t){var i=this.bodyMetaData[e];if(i&&i.isComposite&&!t)return!0;var r=this.getCorrectedBodyOccurrenceId(e,this.viewer.getIdForOccurrence(t)),n=this.occurrences[r];return n?n.containsPart(e)||n.displayedPartIds.has(e):!!this.bodyToOccurrenceId.hasNested(e,r)&&(!this.viewer.getIsForFlattenedDisplay()||this.isBodyVisible(r,e))},i.prototype.getTransformFromSheetMetalBodyMetaData=function(e){var t=e.sheetMetalOrderId.split(" "),i=e.sheetMetalOrder;if(0===i||i>t.length)return a.mat4.identity();var r=t.slice(0,i).join(" ");return this.sheetMetalOrderIdToTransform[r]},i.prototype.isEntityMeasurable=function(e,t){var i=this.getEntityMetaData(e);return!!i&&this.isBodyActiveInView(this.getEntityBodyGroupId(i),t)},i.prototype.updateFlattenedBodyLayout=function(){if(this.viewer.getIsForFlattenedDisplay()&&!(0,y.isMapEmpty)(this.partStudioBodyIdToOccurrenceId)){this.sheetMetalOrderIdToTransform={};var e=10*Math.max.apply(Math,Object.values(this.bodyMetaData||{}).map((function(e){return e.bounds.max[2]-e.bounds.min[2]}))),t={},i=Object.keys(this.bodyMetaData||{}),r=this;i.sort((function(e,t){var i=r.bodyMetaData[e],n=r.bodyMetaData[t];return!i.isSubsidiaryBody()&&n.isSubsidiaryBody()?-1:i.isSubsidiaryBody()&&!n.isSubsidiaryBody()?1:i.sheetMetalOrderId<n.sheetMetalOrderId?-1:i.sheetMetalOrderId>n.sheetMetalOrderId?1:0}));for(var n={},o=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio(),s=this.usage!==u.GBTDisplayDataUsage.BASE,c=s?2:1,h=0;h<c;h++)for(var d=h===c-1,p="",g=0;g<i.length;g++){var f=i[g],m=this.bodyMetaData[f],v=t[m.sheetMetalModelId];v||(v=new y.BoundingBox,t[m.sheetMetalModelId]=v);for(var E=m.sheetMetalOrderId.split(" "),I=E[0],T=1;T<E.length&&!(p<I);T++)I+=" "+E[T];m.sheetMetalOrder=T,p=I;var S=m.bounds,P=void 0,_=void 0;v.isInitialized()?(P=v.max[0]+e-S.min[0],_=v.max[1]-S.max[1]):(P=0,_=0);var M=-S.max[2],D=this.partStudioBodyIdToOccurrenceId[f];D||l.log.warn("No occurrence for flattened body "+f);var C=a.mat4.identity();a.mat4.translate(C,[P,_,M]);var O=!0;if(m.isSubsidiaryBody()){if(d){var A=n[m.getOwnerBodyId()];A&&(C=A)}}else if(s&&o){var R=o.bodyComponent.sheetMetalOrderIdToTransform[I];R&&(C=R,O=!1)}s&&O!==d||(this.viewer.getOccurrenceDataManager().setOccurrenceTransform(D,C),this.updateBodyManagerReferencesForBody(f),v.addBox(S,C),n[f]=C,this.sheetMetalOrderIdToTransform[I]=C)}}},i.prototype.hasBody=function(e){return this.bodyMetaData.hasOwnProperty(e)},i.prototype.hasBodyOccurrence=function(e,t){var i=this.getCorrectedBodyOccurrenceId(e,this.viewer.getIdForOccurrence(t));return this.bodyToOccurrenceId.hasNested(e,i)},i.prototype.contributesToBodyManager=function(){return this.isForBase()},i.prototype.updateBodyManagerReferencesForBody=function(e){var t=this.bodyMetaData[e];if(t&&this.contributesToBodyManager()){var i=this.getBodyManager(),r=this.bodyToOccurrenceId.get(e);r&&r.each((function(r,n){n=+n;var o=1,s=this.occurrences[n];return s&&(o=s.displayedPartIds.length),i.addOrUpdateOccurrence(n,this.getBodyOccurrenceData(e,n),t,o),!1}),this)}},i.prototype.setDebugFaceTriangles=function(e){if($=e)for(var t in this.idToMetaData){var i=this.idToMetaData[t],r=i.getMeshIncrement();r&&this.addMeshTriangleEdges(r,i)}this.refreshAllBodyOccurrences()},i.prototype.integrityCheck=function(){var e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio()===this.parent;for(var t in this.bodyMetaData){if(null!==this.bodyMetaData[t].getFinestTessellationSettingOnClient()){var i=this.bodyToEntity.get(t);i&&!i.isEmpty()||l.log.info("Body "+t+" is missing entity data in "+this.parent.getFullElementId())}else e&&l.log.info("Body "+t+" has no tessellation available, but it is in the active part studio: "+this.parent.getFullElementId())}},i.prototype.collectComponentsForHeapDump=function(e){for(var t in this.idToMetaData){var i=this.idToMetaData[t],r=i.getMeshIncrement();e.meshIncrements.push(r),e.entityData.push(i),i.isFace()&&!i.isPlanarFace()&&e.silhouetteIncrements.push((0,y.getSilhouetteIncrement)(r));var n=this.getMeshIncrementDetails(t);n?e.incrementDetails.push(n):console.warn("Did not find increment details for "+t)}this.reset()},i.PART_STUDIO_BODY_OCCURRENCE_PREFIX="body",i.MESH_EDGE_GROUP_SUFFIX="_meshEdges",i}(y.AssemblyEnabledPartStudioComponent);t.BodyComponent=ee},198187:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BodyLoadTasks=t.BodyLoader=t.BodyToProcess=t.getCollectionId=void 0;var r,n=i(165542),o=i(73055),s=i(556329),a=i(311611),c=i(342211),l=o.default.getManager();function u(e,t){return e+s.ID_SEPARATOR+t.getCollectionId()}!function(e){e[e.UNLOAD=0]="UNLOAD",e[e.LOAD=1]="LOAD"}(r||(r={})),t.getCollectionId=u;var h=function(){function e(e,t){this.bodyComponent=e,this.bodyId=t}return e.prototype.getCollectionId=function(){return u(this.bodyId,this.bodyComponent)},e}();t.BodyToProcess=h;var d=function(){function e(e,t){this.viewer=e,this.action=t,this.bodiesToProcess=[],this.bodiesNeedSort=!1,this.taskFinishedDeferred=null,this.iterationsSinceStart=0,this.bodiesProcessedSinceStart=0,(0,a.viewerCheck)(e),this.bodiesToProcessMap=new Map,this.initialLoadBudget=new a.Budget(l.getNumber("GRAPHICS_TASK_INITIAL_TIME_BUDGET"),l.getNumber("GRAPHICS_TASK_INITIAL_VERTEX_BUDGET"))}return e.prototype.addBodyToProcess=function(e,t){var i=new h(e,t),r=i.getCollectionId();this.bodiesToProcessMap.get(r)||(this.bodiesToProcess.push(i),this.bodiesToProcessMap.set(r,i),this.setBodiesNeedSort())},e.prototype.performInitialLoad=function(){var e=new c.Timer("BodyLoader.prototype.performInitialLoad");this.initialLoadBudget.reset(),this.process(this.initialLoadBudget),e.report()},e.prototype.indexOfBody=function(e,t){for(var i=0;i<this.bodiesToProcess.length;++i){var r=this.bodiesToProcess[i];if(r.bodyComponent===e&&r.bodyId===t)return i}return-1},e.prototype.stopBodyFromProcessing=function(e,t){if(this.bodiesToProcessMap.has(u(t,e))){var i=this.indexOfBody(e,t);i>=0&&(this.bodiesToProcessMap.delete(this.bodiesToProcess[i].getCollectionId()),this.bodiesToProcess.splice(i,1))}},e.prototype.clearBodiesForComponent=function(e,t){for(var i=[],r=0;r<this.bodiesToProcess.length;++r){var n=this.bodiesToProcess[r];n.bodyComponent===e&&t.contains(n.bodyId)&&((0,a.insertRange)([r,r+1],i),this.bodiesToProcessMap.delete(n.getCollectionId()))}(0,a.spliceRangesFromArray)(this.bodiesToProcess,i)},e.prototype.clearAllBodiesForComponent=function(e){for(var t=[],i=0;i<this.bodiesToProcess.length;++i)this.bodiesToProcess[i].bodyComponent===e&&((0,a.insertRange)([i,i+1],t),this.bodiesToProcessMap.delete(this.bodiesToProcess[i].getCollectionId()));(0,a.spliceRangesFromArray)(this.bodiesToProcess,t)},e.prototype.setBodiesNeedSort=function(){this.bodiesNeedSort=!0},e.prototype.clearAllBodies=function(){this.bodiesToProcess=[],this.bodiesToProcessMap.clear(),this.bodiesNeedSort=!1},e.prototype.hasPendingWork=function(){return this.bodiesToProcess.length>0},e.prototype.sortBodies=function(){this.bodiesNeedSort&&(this.bodiesToProcess.sort((function(e,t){var i=e.bodyComponent.isBodyInstantiated(e.bodyId);if(i!==t.bodyComponent.isBodyInstantiated(t.bodyId))return i?-1:1;var r=e.bodyComponent.getBodyDiameter(e.bodyId),n=t.bodyComponent.getBodyDiameter(t.bodyId);return r>n?-1:r<n?1:0})),this.bodiesNeedSort=!1)},e.prototype.process=function(e){this.sortBodies();for(var t=[],i=0,n=0;n<this.bodiesToProcess.length;++n){var o=this.bodiesToProcess[n],s=!1;if(this.action===r.UNLOAD?(o.bodyComponent.unloadBody(o.bodyId),++i,s=!0):o.bodyComponent.processBodyAddition(o.bodyId,e)&&(++i,s=!0),s&&((0,a.insertRange)([n,n+1],t),this.bodiesToProcessMap.delete(o.getCollectionId())),e&&e.budgetExceeded())break}(0,a.spliceRangesFromArray)(this.bodiesToProcess,t),i>0&&this.action===r.LOAD&&this.viewer.getEventDispatcher().trigger(a.BODIES_LOADED),i>0&&(this.bodiesProcessedSinceStart+=i,++this.iterationsSinceStart),this.hasPendingWork()||(this.taskFinishedDeferred&&(this.taskFinishedDeferred.resolve({bodiesProcessedSinceStart:this.bodiesProcessedSinceStart,iterationsSinceStart:this.iterationsSinceStart}),this.taskFinishedDeferred=null),this.iterationsSinceStart=0,this.bodiesProcessedSinceStart=0)},e.prototype.getTaskFinishedPromise=function(){return this.taskFinishedDeferred?this.taskFinishedDeferred.promise:this.hasPendingWork()?(this.taskFinishedDeferred=n.defer(),this.taskFinishedDeferred.promise):null},e}();t.BodyLoader=d;var p=function(){function e(e){this.loadTask=new d(e,r.LOAD),this.unloadTask=new d(e,r.UNLOAD)}return e.prototype.getLoadTask=function(){return this.loadTask},e.prototype.getUnloadTask=function(){return this.unloadTask},e.prototype.postBodyToLoad=function(e,t){this.loadTask.addBodyToProcess(e,t),this.unloadTask.stopBodyFromProcessing(e,t)},e.prototype.postBodyToUnload=function(e,t){this.unloadTask.addBodyToProcess(e,t),this.loadTask.stopBodyFromProcessing(e,t)},e.prototype.completeTasks=function(){this.loadTask.process(null),this.unloadTask.process(null)},e.prototype.stopBodyFromProcessing=function(e,t){this.loadTask.stopBodyFromProcessing(e,t),this.unloadTask.stopBodyFromProcessing(e,t)},e.prototype.clearBodiesForComponent=function(e,t){this.loadTask.clearBodiesForComponent(e,t),this.unloadTask.clearBodiesForComponent(e,t)},e.prototype.clearAllBodiesForComponent=function(e){this.loadTask.clearAllBodiesForComponent(e),this.unloadTask.clearAllBodiesForComponent(e)},e.prototype.clearAllBodies=function(){this.loadTask.clearAllBodies(),this.unloadTask.clearAllBodies()},e.prototype.hasPendingUnloads=function(){return this.unloadTask.hasPendingWork()},e}();t.BodyLoadTasks=p},956834:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.occurrenceSortFunction=t.BodyManager=t.getUnitBoxIncrement=t.unitBoxIncrement=t.BodyOccurrence=t.NonInstantiatedBody=t.LOADED_TESSELLATION_SETTING=t.byteToMbString=t.isRetrievalDebuggingEnabled=t.UNLOADED_BODY_OPACITY_FACTOR=t.RetrievalRequestSource=t.RetrievalRequestState=t.setRefinementMode=t.RefinementMode=t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID=t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID=t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID=void 0;var r=i(423902),n=i(663748),o=i(73055),s=i(342211),a=i(911748),c=i(194598),l=i(311517),u=i(712197),h=i(227441),d=i(736202),p=i(311611),g=i(992945);t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID="pbm",t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID="tbm",t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID="nbm";var f,m=function(e,t,i,r,n){this.bodyOccurrence=e,this.requestSource=t,this.occurrence=i,this.tessellationSettingRequested=r,this.viewportError=n};!function(e){e[e.DISABLED=0]="DISABLED",e[e.CONDITIONAL=1]="CONDITIONAL",e[e.ALWAYS=2]="ALWAYS"}(f=t.RefinementMode||(t.RefinementMode={}));var y,v,E=f.CONDITIONAL;function I(){return!!localStorage.getItem("osBodyRetrievalDebuggingEnabled")}function T(e){return(e/1024/1024).toFixed(0)+" MB"}t.setRefinementMode=function(e){E=e},function(e){e[e.NONE=-1]="NONE",e[e.AUTOMATIC_RETRIEVAL_REQUESTED=-2]="AUTOMATIC_RETRIEVAL_REQUESTED"}(y=t.RetrievalRequestState||(t.RetrievalRequestState={})),function(e){e[e.SELECTION=0]="SELECTION",e[e.HOVER=1]="HOVER",e[e.VIEWING=2]="VIEWING"}(v=t.RetrievalRequestSource||(t.RetrievalRequestSource={})),t.UNLOADED_BODY_OPACITY_FACTOR=o.default.getManager().getNumber("UNLOADED_BODY_OPACITY_FACTOR"),t.isRetrievalDebuggingEnabled=I,t.byteToMbString=T,t.LOADED_TESSELLATION_SETTING=[0];var S=function(){function e(e,t){this.partStudio=e,this.bodyMetaData=t,this.radius=this.getBodyMetaDataForRetrieval().getBounds().diameter()/2}return e.prototype.getBodyMetaDataForRetrieval=function(){return this.bodyMetaData.isClosedCompositeConstituent?this.bodyMetaData.consumingClosedCompositeData:this.bodyMetaData},e.prototype.getBenefitToUnload=function(){return this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage()/(this.radius*this.radius)},e.prototype.isBodyDataPresent=function(){return this.getBodyMetaDataForRetrieval().hasTessellationSettings()},e.prototype.isInstantiated=function(){return!1},e.prototype.getLastViewTime=function(){return 0},e.prototype.getLastViewportOccupancy=function(){return 0},e.prototype.getUnloadedChordalTolerance=function(){return this.getBodyMetaDataForRetrieval().getBounds().diameter()},e.prototype.getCenter=function(){return null},e}();t.NonInstantiatedBody=S;var P=a.vec3.create(),_=a.vec4.create(),M=a.mat4.create(),D=function(){function e(e,t,i){this.occurrenceData=e,this.bodyMetaData=t,this.pickId=i,this.center=[0,0,0],this.radius=0,this.lod=null,this.displayDamaged=!0,this.incrementDetails=null,this.highlightApplied=null,this.retrievalRequestState=y.NONE,this.update(e,t)}return e.prototype.update=function(e,t){this.occurrenceData=e,this.bodyMetaData=t;var i=_;t.getBounds().center(i),i[3]=1,a.mat4.multiplyVec4(e.getTransform(),i),this.center[0]=i[0],this.center[1]=i[1],this.center[2]=i[2],this.radius=t.getBounds().diameter()/2,this.displayDamaged=!0},e.prototype.getBodyMetaData=function(){return this.bodyMetaData},e.prototype.getBodyMetaDataForRetrieval=function(){return this.bodyMetaData.isClosedCompositeConstituent?this.bodyMetaData.consumingClosedCompositeData:this.bodyMetaData},e.prototype.getOccurrenceData=function(){return this.occurrenceData},e.prototype.getOccurrenceId=function(){return this.occurrenceData.getOccurrenceId()},e.prototype.getCenter=function(){return this.center},e.prototype.getRadius=function(){return this.radius},e.prototype.getUnloadedChordalTolerance=function(){return 2*this.radius},e.prototype.getBenefitToCull=function(){return this.bodyMetaData.coarseTriangleCount/(this.radius*this.radius)},e.prototype.getBenefitToUnload=function(){return this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage()/(this.radius*this.radius)},e.prototype.getBenefitToLoad=function(){return this.isBodyDataPresent()?0:this.radius*this.radius/this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage(t.LOADED_TESSELLATION_SETTING)},e.prototype.getBenefitToRefine=function(e,t){return t/this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage([e])},e.prototype.isInstantiated=function(){return!0},e.prototype.setCullingState=function(e){if(this.numberOfBodiesInOccurrence>1)for(var t=p.BodyComponent.getPotentialMeshGroupIdsForBody(this.bodyMetaData.meshGroupId),i=0;i<t.length;++i)this.occurrenceData.setCullingState(e,t[i]);else this.occurrenceData.setCullingState(e)},e.prototype.isEntityTessellationLoaded=function(){return this.getBodyMetaDataForRetrieval().getIsTessellationLoaded()},e.prototype.canBeRefinedFurther=function(e){var t=this.getBodyMetaDataForRetrieval().getFinestTessellationSettingOnClient();return null===t||t<this.getBodyMetaDataForRetrieval().getBestAvailableTessellationSettingIndex(e)},e.prototype.setLod=function(e){this.isEntityTessellationLoaded()||(e=p.Lod.LOWEST),this.occurrenceData.setLod(e)},e.prototype.outsideFrustum=function(e){return e.viewFrustum.getSphereFrustumIntersection(this.center,this.radius)===p.IntersectionType.OUTSIDE},e.prototype.intersectsFrustum=function(e){return!!e&&e.getSphereFrustumIntersection(this.center,this.radius)!==p.IntersectionType.OUTSIDE},e.prototype.isVisible=function(){return this.occurrenceData.getVisibility()===p.Visibility.VISIBLE},e.prototype.mustShowLowestLod=function(){return!this.isEntityTessellationLoaded()&&this.isVisible()},e.prototype.lodIsUpToDate=function(){return this.mustShowLowestLod()?!this.displayDamaged&&this.lod===p.Lod.LOWEST:this.lod!==p.Lod.LOWEST},e.prototype.isBodyDataPresent=function(){return this.getBodyMetaDataForRetrieval().hasTessellationSettings()},e.prototype.resetRetrievalRequestState=function(){this.retrievalRequestState=y.NONE},e.prototype.setBodyRetrievalStarted=function(e){this.retrievalRequestState=e},e.prototype.isRetrievalRequestDataPresent=function(){if(!this.getBodyRetrievalStarted())return!1;var e=this.getBodyMetaDataForRetrieval();return e.hasTessellationSettings()&&e.getFinestTessellationSettingOnClient()>=this.retrievalRequestState},e.prototype.getBodyRetrievalStarted=function(){return this.retrievalRequestState>=0},e.prototype.requestAutomaticBodyDataRetrieval=function(){this.retrievalRequestState===y.NONE&&(this.retrievalRequestState=y.AUTOMATIC_RETRIEVAL_REQUESTED)},e.prototype.resetAutomaticBodyDataRetrieval=function(){this.retrievalRequestState===y.AUTOMATIC_RETRIEVAL_REQUESTED&&(this.retrievalRequestState=y.NONE)},e.prototype.getAutomaticBodyDataRetrievalRequested=function(){return this.retrievalRequestState===y.AUTOMATIC_RETRIEVAL_REQUESTED},e.prototype.canCullBody=function(e){return this.occurrenceData.getVisibility()===p.Visibility.VISIBLE&&!this.occurrenceData.getIsolated()&&!this.intersectsFrustum(e)},e.prototype.getDisplayId=function(){return this.occurrenceData.getOccurrenceId()+"."+this.bodyMetaData.id},e.prototype.addBounds=function(e){e.addBox(this.bodyMetaData.getBounds(),this.occurrenceData.getTransform())},e.prototype.updateViewHistory=function(e,t){this.bodyMetaData.getLastViewTime()!==e?(this.bodyMetaData.setLastViewTime(e),this.bodyMetaData.setLastViewportOccupancy(t)):this.bodyMetaData.setLastViewportOccupancy(t+this.bodyMetaData.getLastViewportOccupancy())},e.prototype.getLastViewTime=function(){return this.bodyMetaData.getLastViewTime()},e.prototype.getLastViewportOccupancy=function(){return this.bodyMetaData.getLastViewportOccupancy()},e.prototype.getDisplayIncrement=function(){var e=this.bodyMetaData.getBounds(),i=e.diagonalVector(P),r=a.mat4.scale(a.mat4.identity(M),i),n=e.center(P);r[12]+=n[0],r[13]+=n[1],r[14]+=n[2],a.mat4.multiply(this.occurrenceData.getTransform(),r,r);var o=C().createTransformed(r);o.id=this.getDisplayId(),o.pickId=this.pickId,o.lod=p.Lod.LOWEST;var s=this.bodyMetaData.getColor();return!this.occurrenceData.getIsolated()&&(0,p.getActiveViewer)().getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode()?(s=[s[0],s[1],s[2],1],o.groupId=t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID):(this.isBodyDataPresent()||(s=[s[0],s[1],s[2],s[3]*t.UNLOADED_BODY_OPACITY_FACTOR]),o.groupId=s[3]<1?t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID:t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID),(0,p.addColorToIncrement)(s,o),o},e}();function C(){return t.unitBoxIncrement||(t.unitBoxIncrement=(0,p.createBox)([-.5,-.5,-.5],[.5,.5,.5])),t.unitBoxIncrement}t.BodyOccurrence=D,t.unitBoxIncrement=null,t.getUnitBoxIncrement=C;var O=function(e){function i(i,r){var n=e.call(this)||this;n.viewer=i,n.bodyUnloadTask=r,n.MINIMAL_SCREEN_IMPACT_SIZE_PIXELS=o.default.getManager().getNumber("MINIMAL_SCREEN_IMPACT_SIZE_PIXELS"),n.DISPLAY_OCCURRENCE_NAME="BodyManager",n.DISPLAY_NON_ISOLATED_OCCURRENCE_NAME="BodyManagerNonIsolated",n.DISPLAY_BOXES_WHEN_CULLING=o.default.getManager().getNumber("DISPLAY_BOXES_WHEN_CULLING"),n.previewOccurrences=new Map,n.sortedOccurrences=null,n.occurrencesNeedSort=!0,n.unloadedBodyBounds=null,n.MAXIMUM_BODY_CULL_DIAMETER_PROPORTION=o.default.getManager().getNumber("MAXIMUM_BODY_CULL_DIAMETER_PROPORTION"),n.AUTOMATIC_BODY_RETRIEVAL_DIAMETER_PROPORTION=o.default.getManager().getNumber("AUTOMATIC_BODY_RETRIEVAL_DIAMETER_PROPORTION"),n.occurrenceRetrievalTimeout=null,n.encounteredUnloadedOccurrenceInLastFrame=!1,n.bodyRetrievalCheckTimeout=null,n.shouldUpdateBodyOccurrenceLodForIsolate=!1,n.paused=!1,n.memoryUsageOfVisibleBodies=0,n.userEnabledAggressiveRefinement=!1,n.temporaryTessellationOverrides=new Map,n.idManager=new p.NamedIdManager,n.graphicsRefinementModeSubject=new g.ReplaySubject(1),n.occurrences=new Map,n.node=new p.Node("bodyManager"),n.displayOccurrenceId=n.viewer.getOccurrenceIdManager().getOrCreateIdForName(n.DISPLAY_OCCURRENCE_NAME),n.displayOccurrenceData=n.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(n.displayOccurrenceId),n.displayOccurrenceData.setLod(p.Lod.LOWEST),n.displayOccurrenceData.setIsolated(!0),n.displayOccurrenceData.setCanIsolateChange(!1),n.displayOccurrenceIdNonIsolated=n.viewer.getOccurrenceIdManager().getOrCreateIdForName(n.DISPLAY_NON_ISOLATED_OCCURRENCE_NAME),n.displayOccurrenceDataNonIsolated=n.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(n.displayOccurrenceIdNonIsolated),n.displayOccurrenceDataNonIsolated.setLod(p.Lod.LOWEST),n.displayOccurrenceDataNonIsolated.setIsolated(!1),n.displayOccurrenceDataNonIsolated.setCanIsolateChange(!1),n.meshManager=new p.MeshManager(n.viewer,{bufferAllocationPolicy:p.BufferAllocationPolicy.MAXIMUM}),n.meshOwnerId=(0,p.getNewOwnerId)(),n.occurrencesToRetrieve=new Map,n.pendingRetrievalInformation=new Map,n.viewer.getModelViewManagers().getManager().getSharedBodyNode().addChild(n.node);var s=new p.Style,a=n.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID,n.meshOwnerId,p.PrimitiveType.TRIANGLE_STRIP,p.Lod.LOWEST);n.node.addOccurrenceGeometryToNode(p.SOLID_FACE_NODE_PROPERTIES,n.displayOccurrenceData,s,a);var l=n.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID,n.meshOwnerId,p.PrimitiveType.TRIANGLE_STRIP,p.Lod.LOWEST);n.node.addOccurrenceGeometryToNode(p.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT,n.displayOccurrenceData,s,l);var h=n.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID,n.meshOwnerId,p.PrimitiveType.TRIANGLE_STRIP,p.Lod.LOWEST);n.node.addOccurrenceGeometryToNode(p.SOLID_FACE_NODE_PROPERTIES,n.displayOccurrenceDataNonIsolated,s,h),c.btInjector.CapabilitiesService&&c.btInjector.CapabilitiesService.isMoreAggressiveCullingEnabled&&c.btInjector.CapabilitiesService.isMoreAggressiveCullingEnabled().then((function(e){n.MAXIMUM_BODY_CULL_DIAMETER_PROPORTION=e?o.default.getManager().getNumber("MORE_AGGRESSIVE_MAXIMUM_BODY_CULL_DIAMETER_PROPORTION"):o.default.getManager().getNumber("MAXIMUM_BODY_CULL_DIAMETER_PROPORTION")})),n.refinementNodeFilter=function(e){var t=n.viewer.getModelViewManagers().getManager();if(t.isNodeForModel(e)){var i=e.getParent();return!e.isMeshNode()||e.isFaces()&&(t.isNodeForBody(i)||i===n.node)}return!1};var d=(0,u.getSelectionList)();return n.listenTo(d,"add",n.onSelectionAdded),n.listenTo(d,"reset",n.onSelectionsReset),n}return(0,r.__extends)(i,e),i.prototype.destroy=function(){this.node.remove(),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(this.displayOccurrenceId),this.viewer.getOccurrenceIdManager().removeName(this.DISPLAY_OCCURRENCE_NAME),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(this.displayOccurrenceIdNonIsolated),this.viewer.getOccurrenceIdManager().removeName(this.DISPLAY_NON_ISOLATED_OCCURRENCE_NAME),this.meshManager.destroy(),this.resetOccurrenceRetrieval(),this.clearBodyRetrievalCheckTimeout(),this.stopListening()},i.prototype.setVisible=function(e){this.node.setVisible(e)},i.prototype.resetOccurrenceRetrieval=function(){(0,d.isNumber)(this.occurrenceRetrievalTimeout)&&(window.clearTimeout(this.occurrenceRetrievalTimeout),this.occurrenceRetrievalTimeout=null),this.occurrencesToRetrieve.clear()},i.prototype.clearPreviewOccurrences=function(){this.previewOccurrences.clear()},i.prototype.getGraphicsRefinementModeObservable=function(){return this.graphicsRefinementModeSubject.asObservable()},i.prototype.updateGraphicsRefinementMode=function(){this.userEnabledAggressiveRefinement?this.graphicsRefinementModeSubject.next(p.GraphicsRefinementMode.AGGRESSIVE_USER_CAUSED):this.graphicsRefinementModeSubject.next(p.GraphicsRefinementMode.NORMAL)},Object.defineProperty(i.prototype,"aggressiveRefinementEnabled",{get:function(){return this.userEnabledAggressiveRefinement},enumerable:!1,configurable:!0}),i.prototype.getUserEnabledAggressiveRefinement=function(){return this.userEnabledAggressiveRefinement},i.prototype.setUserEnabledAggressiveRefinement=function(e){this.userEnabledAggressiveRefinement!==e&&(this.userEnabledAggressiveRefinement=e,this.onAggressiveRefinementChanged())},i.prototype.onAggressiveRefinementChanged=function(){this.aggressiveRefinementEnabled?this.performUnloadedBodyAndRefinementCheck():(this.temporaryTessellationOverrides.clear(),this.viewer.getEventDispatcher().trigger(p.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES)),this.updateGraphicsRefinementMode()},i.prototype.isBodyManagerOccurrence=function(e){return!!e&&e.path[0]===this.DISPLAY_OCCURRENCE_NAME},i.prototype.pickedOccurrenceId=function(e){if(!(e.length<1)){e.length>1&&l.log.warn("Picked body manager occurrence id with multiple entries");var t=this.idManager.getNameForId(e),i=this.occurrences.get(t);if(i&&!i.isBodyDataPresent()){var r=this.shouldRetrieveHighestQualityTessellationForOccurrence(i)?i.getBodyMetaData().getBestAvailableTessellationSettingIndex(this.aggressiveRefinementEnabled):0;null==r&&(r=0,l.log.warn("Did not find best available setting for body "+i.getBodyMetaData().getId()));var n=Number.MAX_VALUE;this.considerOccurrenceForRetrieval(i,v.HOVER,r,n)}}},i.prototype.onSelectionAdded=function(e){var t,i,n=e.getOccurrence();if(n){var s=this.viewer.getOccurrenceIdManager().getIdForName(n.getPathAsString());if(s!==p.INVALID_OCCURRENCE_ID){var a=this.viewer.getModelViewManagers().getManager().getOccurrenceDisplayData(n);if(a&&a.displayedPartIds){var c=this.viewer.getCamera();try{for(var u=(0,r.__values)(a.displayedPartIds),h=u.next();!h.done;h=u.next()){var d=h.value,g=this.getBodyOccurrenceId(s,d),f=this.occurrences.get(g);if(f){var m=this.aggressiveRefinementEnabled?o.default.getManager().getNumber("SELECTED_AGGRESSIVE_ERROR_REFINEMENT_THRESHOLD"):o.default.getManager().getNumber("FINER_BODY_SCREENSPACE_ERROR_REFINEMENT_THRESHOLD"),y=c.getUnitSizeAtWorldPoint(f.getCenter()),E=this.getTessellationIndexToGoUnderThreshold(f,m,y,null,this.aggressiveRefinementEnabled);if(null!==E){I()&&l.log.info("Refining selected occurrence "+n.getPathAsString());var T=Number.MAX_VALUE;this.considerOccurrenceForRetrieval(f,v.SELECTION,E,T)}}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}}}}},i.prototype.onSelectionsReset=function(e){var t=this;e.each((function(e){t.onSelectionAdded(e)}))},i.prototype.getBtOccurrence=function(e){var t=this.viewer.getOccurrenceIdManager().getNameForId(e.getOccurrenceId());return!t||t.startsWith(p.BodyComponent.PART_STUDIO_BODY_OCCURRENCE_PREFIX)?null:h.BTOccurrence.getOccurrenceFromPathString(t)},i.prototype.considerOccurrenceForRetrieval=function(e,t,i,r){if(e&&!e.getBodyRetrievalStarted())if(this.aggressiveRefinementEnabled&&this.viewer.getModelViewManagers().getManager().displayingPartStudio()&&this.getBtOccurrence(e))I()&&l.log.debug("Did not use tessellation override for in-context occurrence");else{var n=this.getBtOccurrence(e),o=this.occurrencesToRetrieve.get(e);o?(t<o.requestSource&&(o.requestSource=t),o.tessellationSettingRequested=i,o.viewportError=r):(o=new m(e,t,n,i,r),this.occurrencesToRetrieve.set(e,o)),this.startRetrievalTimeout()}},i.prototype.startRetrievalTimeout=function(){var e=this;if(!(0,d.isNumber)(this.occurrenceRetrievalTimeout)){var t=this.aggressiveRefinementEnabled?o.default.getManager().getNumber("AGGRESSIVE_OCCURRENCE_RETRIEVAL_INTERVAL_MS"):o.default.getManager().getNumber("OCCURRENCE_RETRIEVAL_INTERVAL_MS");this.occurrenceRetrievalTimeout=window.setTimeout((function(){return e.onRetrievalTimeout()}),t)}},i.prototype.onRetrievalTimeout=function(){var e=this;if(this.occurrenceRetrievalTimeout=null,this.paused)l.log.info("Skipped body retrieval timeout due to pause");else if(this.aggressiveRefinementEnabled||!this.viewer.getFrameTimer().userIsInteracting()){var t=[];this.occurrencesToRetrieve.forEach((function(e){t.push(e)}),this);var i=this.viewer.getCamera();t.sort((function(t,r){var n=t.bodyOccurrence.outsideFrustum(i);if(n!==r.bodyOccurrence.outsideFrustum(i))return n?1:-1;if(t.requestSource<r.requestSource)return-1;if(t.requestSource>r.requestSource)return 1;if(t.bodyOccurrence.isEntityTessellationLoaded()!==r.bodyOccurrence.isEntityTessellationLoaded())return t.bodyOccurrence.isEntityTessellationLoaded()?1:-1;var o=!!e.getBtOccurrence(t.bodyOccurrence);if(o!==!!e.getBtOccurrence(r.bodyOccurrence))return o?-1:1;var s=t.bodyOccurrence.getBenefitToRefine(t.tessellationSettingRequested,t.viewportError),a=r.bodyOccurrence.getBenefitToRefine(r.tessellationSettingRequested,r.viewportError);return s>a?-1:s<a?1:0}));var r=[],n=[],s=o.default.getManager(),a=1024*s.getNumber("BODY_REFINEMENT_BATCH_SIZE_MB")*1024,c=1024*s.getNumber("PENDING_BODY_REFINEMENT_SIZE_LIMIT_MB")*1024,d=0,g=I(),f=[],m=[],y=this.viewer.getModelViewManagers().getManager(),E=this.getEstimatedMemoryUsageOfPendingRetrievals(),S=this.memoryUsageOfVisibleBodies+E;g&&l.log.info("Estimated usage of visible and pending bodies upon retrieval: "+T(S));for(var P=y.getBodyRefinementMemoryLimit(),_=0;_<t.length;++_){var M=t[_];if(M.bodyOccurrence.outsideFrustum(i)&&M.requestSource!==v.SELECTION)this.resetRetrievalStateForOccurrence(M.bodyOccurrence);else{var D=M.bodyOccurrence.getBodyMetaDataForRetrieval(),C=[M.tessellationSettingRequested],O=D.getEstimatedMemoryUsage(C),A=O-D.getEstimatedMemoryUsage(),R=this.pendingRetrievalInformation.has(D);if((0===d||d+O<a)&&(0===E||d+O+E<c)&&!R){var N=M.requestSource===v.VIEWING;if(S+A>P&&N){g&&m.push(D.getId()+"-"+M.tessellationSettingRequested);continue}if(d+=O,S+=A,this.aggressiveRefinementEnabled){if(this.temporaryTessellationOverrides.has(M.bodyOccurrence)||this.temporaryTessellationOverrides.get(M.bodyOccurrence)>=M.tessellationSettingRequested)continue;this.temporaryTessellationOverrides.set(M.bodyOccurrence,M.tessellationSettingRequested)}this.pendingRetrievalInformation.set(D,{estimatedAdditionalMemoryUsage:A});var w=new h.BTUiOccurrenceDisplayDataRequest;w.bodyDeterministicId=D.getId(),M.occurrence?w.occurrence=M.occurrence:w.occurrence=null,w.tessellationSetting=M.tessellationSettingRequested,M.bodyOccurrence.setBodyRetrievalStarted(w.tessellationSetting),I()&&(M.occurrence?(0,u.getRetrievalSelectionList)().add(new u.Selection(h.GBTUiSelectionType.OCCURRENCE,M.occurrence,M.occurrence)):(0,u.getRetrievalSelectionList)().add(new u.Selection(h.GBTUiSelectionType.BODY,M.bodyOccurrence.getBodyMetaData().getId()))),r.push(w),g&&f.push(D.getId()+"-"+M.tessellationSettingRequested)}else R||n.push(M)}}if(g){if(f.length>0){f.sort(),l.log.info("Retrieving bodies: "+f);var b=this.viewer.getModelViewManagers().getManager().getEstimatedMemoryUsageOfBodies(),L=this.getEstimatedMemoryUsageOfPendingRetrievals();l.log.info("Estimated use of body memory at time of retrieval "+T(b+L)+", pending use: "+T(L))}m.length>0&&(m.sort(),l.log.info("Skipped retrieval of bodies to avoid putting memory over limit: "+m))}if(this.occurrencesToRetrieve.clear(),r.length>0&&(this.aggressiveRefinementEnabled?this.viewer.getEventDispatcher().trigger(p.ADD_TEMPORARY_TESSELLATION_OVERRIDES,r):this.viewer.getEventDispatcher().trigger(p.RETRIEVE_OCCURRENCE_DISPLAY_DATA,r)),n.length>0){for(_=0;_<n.length;++_)this.occurrencesToRetrieve.set(n[_].bodyOccurrence,n[_]);this.startRetrievalTimeout()}}else this.startRetrievalTimeout()},i.prototype.resetRetrievalStateForOccurrence=function(e){var t,i;e.resetRetrievalRequestState();var n=e.getBodyMetaDataForRetrieval();try{for(var o=(0,r.__values)(this.occurrencesToRetrieve),s=o.next();!s.done;s=o.next()){var a=(0,r.__read)(s.value,2),c=a[0],l=a[1];c.getBodyMetaDataForRetrieval()===n&&n.getFinestTessellationSettingOnClient()>=l.tessellationSettingRequested&&this.occurrencesToRetrieve.delete(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}if(this.pendingRetrievalInformation.delete(n),I()){var d=this.getBtOccurrence(e);d?(0,u.getRetrievalSelectionList)().remove(new u.Selection(h.GBTUiSelectionType.OCCURRENCE,d,d)):(0,u.getRetrievalSelectionList)().remove(new u.Selection(h.GBTUiSelectionType.BODY,n.getId()))}},i.prototype.updateForFrame=function(e,t){var i;this.sortedOccurrences||(this.sortedOccurrences=new Array(this.occurrences.size),i=0,this.occurrences.forEach((function(e){this.sortedOccurrences[i++]=e}),this),this.occurrencesNeedSort=!0),this.occurrencesNeedSort&&(this.sortedOccurrences.sort(A),this.occurrencesNeedSort=!1),this.performAggressiveCulling(e,t)},i.prototype.performAggressiveCulling=function(e,t){var i=e.getActiveCamera(),r=e.getDetailSettings(),n=(0,p.isUsageBase)()?Math.floor(r.lowLevelBodyProportion*this.sortedOccurrences.length):0,o=!t||this.DISPLAY_BOXES_WHEN_CULLING,s=this.shouldUpdateBodyOccurrenceLodForIsolate||0!==n&&o,a=e.getViewer().getFrustumToPreventCulling();t&&(this.encounteredUnloadedOccurrenceInLastFrame=!1);for(var c=this.MAXIMUM_BODY_CULL_DIAMETER_PROPORTION*i.getViewportDiagonal(),l=this.AUTOMATIC_BODY_RETRIEVAL_DIAMETER_PROPORTION*i.getViewportDiagonal(),u=!1,h=0;h<this.sortedOccurrences.length;++h){var d=this.sortedOccurrences[h];if(d.outsideFrustum(i))d.setCullingState(p.CullingState.CULLED),d.resetAutomaticBodyDataRetrieval(),--n;else{d.lodIsUpToDate()||s||(s=!0,h=0);var g=i.getUnitSizeAtWorldPointFast(d.center)*d.radius*2;t&&(!d.isBodyDataPresent()&&g>=l?(this.encounteredUnloadedOccurrenceInLastFrame=!0,d.requestAutomaticBodyDataRetrieval()):d.resetAutomaticBodyDataRetrieval()),d.mustShowLowestLod()||h<n&&d.canCullBody(a)&&g<c?(u=!0,d.setCullingState(p.CullingState.CULLED),s&&this.setBodyOccurrenceLod(d,p.Lod.LOWEST)):(d.setCullingState(p.CullingState.VISIBLE),s&&this.setBodyOccurrenceLod(d,p.Lod.DEFAULT))}this.shouldUpdateBodyOccurrenceLodForIsolate=!1,d.isRetrievalRequestDataPresent()&&this.resetRetrievalStateForOccurrence(d)}u?(this.displayOccurrenceData.setCullingState(p.CullingState.VISIBLE),this.displayOccurrenceDataNonIsolated.setCullingState(p.CullingState.VISIBLE)):(this.displayOccurrenceData.setCullingState(p.CullingState.CULLED),this.displayOccurrenceDataNonIsolated.setCullingState(p.CullingState.CULLED))},i.prototype.setBodyOccurrenceLod=function(e,t){if(e.lod!==t||e.displayDamaged){var i=e.occurrenceData.getIsolated()||!this.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode();if(t===p.Lod.DEFAULT)e.incrementDetails&&(i?this.displayOccurrenceData.hideIncrement(e.incrementDetails,p.bt_graphics_Usage.BASE):this.displayOccurrenceDataNonIsolated.hideIncrement(e.incrementDetails,p.bt_graphics_Usage.BASE));else if(e.displayDamaged||!e.incrementDetails){e.incrementDetails&&(this.meshManager.removeMeshIncrement(e.getDisplayId(),this.meshOwnerId),e.incrementDetails=null,e.highlightApplied=null);var r=e.getDisplayIncrement();e.incrementDetails=this.meshManager.addMeshIncrement(r,this.meshOwnerId),e.displayDamaged=!1}else i?this.displayOccurrenceData.showIncrement(e.incrementDetails,p.bt_graphics_Usage.BASE):this.displayOccurrenceDataNonIsolated.showIncrement(e.incrementDetails,p.bt_graphics_Usage.BASE);e.lod=t,this.updateBodyHighlight(e)}else this.updateBodyHighlight(e)},i.prototype.updateBodyHighlight=function(e){if(e.incrementDetails)if(e.lod===p.Lod.DEFAULT)this.clearBodyHighlight(e);else{var t=e.occurrenceData.getBaseOccurrenceHighlight();t!==e.highlightApplied&&(this.clearBodyHighlight(e),t&&(this.displayOccurrenceData.updateEntityHighlight(p.Action.ADD,t,e.incrementDetails,p.bt_graphics_Usage.BASE),e.highlightApplied=t))}},i.prototype.clearBodyHighlight=function(e){e.highlightApplied&&e.incrementDetails&&(this.displayOccurrenceData.updateEntityHighlight(p.Action.REMOVE,e.highlightApplied,e.incrementDetails,p.bt_graphics_Usage.BASE),e.highlightApplied=null)},i.prototype.getBodyOccurrenceId=function(e,t){return e+"."+t},i.prototype.addOrUpdateOccurrence=function(e,t,i,r){var n=this.getBodyOccurrenceId(e,i.id),o=this.occurrences.get(n);o?o.update(t,i):(o=new D(t,i,this.idManager.getOrCreateIdForName(n)),this.occurrences.set(n,o),this.sortedOccurrences&&this.sortedOccurrences.push(o)),o.numberOfBodiesInOccurrence=r,this.occurrencesNeedSort=!0,this.damageUnloadedBodyBounds()},i.prototype.damageUnloadedBodyBounds=function(){this.unloadedBodyBounds=null},i.prototype.getUnloadedBodyBounds=function(){var e=this;return this.unloadedBodyBounds||(this.unloadedBodyBounds=new p.BoundingBox,this.occurrences.forEach((function(t){!t.isVisible()||t.isBodyDataPresent()&&t.isEntityTessellationLoaded()||t.addBounds(e.unloadedBodyBounds)}))),this.unloadedBodyBounds},i.prototype.getBodyOccurrence=function(e,t){return this.occurrences.get(this.getBodyOccurrenceId(e,t))},i.prototype.removeOccurrence=function(e,t){var i=this.getBodyOccurrenceId(e,t),r=this.occurrences.get(i);r&&(r.incrementDetails&&this.meshManager.removeMeshIncrement(r.getDisplayId(),this.meshOwnerId),this.occurrences.delete(i),this.sortedOccurrences=null,this.occurrencesNeedSort=!0,this.damageUnloadedBodyBounds(),this.idManager.removeName(i))},i.prototype.getOccurrenceBounds=function(e,t){var i=new p.BoundingBox,r=this.occurrences.get(this.getBodyOccurrenceId(e,t));return r&&r.addBounds(i),i},i.prototype.onUserIsAdjustingCamera=function(){(this.viewer.getModelViewManagers().getManager().displayingAssembly()||this.viewer.getModelViewManagers().getManager().displayingPartStudio())&&this.initiateAutomaticRetrieval()},i.prototype.getEstimatedMemoryUsageOfPendingRetrievals=function(){var e=0;return this.pendingRetrievalInformation.forEach((function(t){e+=t.estimatedAdditionalMemoryUsage})),e},i.prototype.hasRefinementCeased=function(){return this.performUnloadedBodyAndRefinementCheck(),0===this.pendingRetrievalInformation.size&&0===this.occurrencesToRetrieve.size},i.prototype.getPendingRetrievalSummary=function(){var e="Body manager retrieval summary:\n";return this.pendingRetrievalInformation.size>0&&(e+="pendingRetrievalInformation size: "+this.pendingRetrievalInformation.size+"\n",this.pendingRetrievalInformation.forEach((function(t,i){e+="  Body: "+i.getId()+", retrievalInfo: "+JSON.stringify(t)+"\n"}))),this.occurrencesToRetrieve.size>0&&(e+="occurrencesToRetrieve size: "+this.occurrencesToRetrieve.size+"\n",this.occurrencesToRetrieve.forEach((function(t,i){e+="retrievalRequest: "+JSON.stringify(t,null,"  ")+"\n"}))),e},i.prototype.clearBodyRetrievalCheckTimeout=function(){(0,d.isNumber)(this.bodyRetrievalCheckTimeout)&&(window.clearTimeout(this.bodyRetrievalCheckTimeout),this.bodyRetrievalCheckTimeout=null)},i.prototype.initiateAutomaticRetrieval=function(){var e=this;this.clearBodyRetrievalCheckTimeout();var t=this.aggressiveRefinementEnabled?o.default.getManager().getNumber("AGGRESSIVE_AUTOMATIC_BODY_RETRIEVAL_TIMEOUT_MS"):o.default.getManager().getNumber("AUTOMATIC_BODY_RETRIEVAL_TIMEOUT_MS");this.bodyRetrievalCheckTimeout=window.setTimeout((function(){return e.performUnloadedBodyAndRefinementCheck()}),t)},i.prototype.allowRefinementCheck=function(){if(E===f.ALWAYS||this.aggressiveRefinementEnabled)return!0;var e=this.viewer.getInteractiveFrameDetails(),t=I(),i=!1;return e&&e.hasTimings()&&(i=e.getAverageFramerate()<o.default.getManager().getNumber("BODY_REFINEMENT_FRAMERATE_THRESHOLD"),t&&i&&l.log.info("Skipped body refinement check because framerate is slow right now: "+e.getAverageFramerate()+" fps")),!i},i.prototype.performUnloadedBodyAndRefinementCheck=function(){var e=this,t=I();if(this.paused)l.log.info("Skipped body refinement check due to pause");else if(E!==f.DISABLED&&(this.encounteredUnloadedOccurrenceInLastFrame||this.allowRefinementCheck())){var i=new s.Timer("BodyManager.performUnloadedBodyAndRefinementCheck",{logResult:t});this.occurrencesToRetrieve.forEach((function(t,i){t.requestSource===v.VIEWING&&e.occurrencesToRetrieve.delete(i)}));var r,n=this.viewer.getCamera(),a=this.collectBodyOccurrencesInViewport(),c=this.viewer.getModelViewManagers().getManager();r=this.aggressiveRefinementEnabled?c.displayingAssembly()?o.default.getManager().getNumber("VIEWING_ASSEMBLY_AGGRESSIVE_ERROR_REFINEMENT_THRESHOLD"):o.default.getManager().getNumber("VIEWING_PART_STUDIO_AGGRESSIVE_ERROR_REFINEMENT_THRESHOLD"):o.default.getManager().getNumber("BODY_SCREENSPACE_ERROR_REFINEMENT_THRESHOLD");var u=(0,p.getTimeInMilliseconds)();this.memoryUsageOfVisibleBodies=0,this.getBodiesInFrustum().forEach((function(t){e.memoryUsageOfVisibleBodies+=t.getEstimatedMemoryUsage()}));var h=c.getBodyRefinementMemoryLimit(),d=this.getEstimatedMemoryUsageOfPendingRetrievals(),g=this.memoryUsageOfVisibleBodies+this.getEstimatedMemoryUsageOfPendingRetrievals(),m=c.getEstimatedMemoryUsageOfBodies()+this.getEstimatedMemoryUsageOfPendingRetrievals();t&&l.log.info("Memory usage of visible and pending bodies: "+T(g)+", all bodies: "+T(this.viewer.getModelViewManagers().getManager().getEstimatedMemoryUsageOfBodies()+d)+", pending use: "+T(d));var y=[],S=function(t,i){if(e.aggressiveRefinementEnabled)return!0;var r;return r=0===i?g:m,t.getEstimatedMemoryUsage([i])-t.getEstimatedMemoryUsage()+r<=h};a.forEach((function(i,o){if(o.updateViewHistory(u,i.viewportOccupancyRatio),o.canBeRefinedFurther(e.aggressiveRefinementEnabled)){var s=o.getBodyMetaData(),a=s.getChordalTolerance();null===a&&(a=o.getUnloadedChordalTolerance());var c=n.getUnitSizeAtWorldPoint(o.getCenter()),l=c*a;if(l>=r){var h=void 0,d=null;if(e.shouldRetrieveHighestQualityTessellationForOccurrence(o)?(h=s.getBestAvailableTessellationSettingIndex(e.aggressiveRefinementEnabled),S(s,h)&&(d=h)):d=e.getTessellationIndexToGoUnderThreshold(o,r,c,S,e.aggressiveRefinementEnabled),null===d||d===s.getFinestTessellationSettingOnClient())return void(t&&y.push(s.id+"-"+s.getFinestTessellationSettingOnClient()));e.considerOccurrenceForRetrieval(o,v.VIEWING,d,i.viewportOccupancyRatio*l)}}})),this.encounteredUnloadedOccurrenceInLastFrame=!1,i.report(),t&&y.length>0&&(y.sort(),l.log.info("Skipped submitting refinement requests for bodies to avoid memory over use:\n"+y))}},i.prototype.collectBodyOccurrencesInViewport=function(){for(var e=new s.Timer("BodyManager.collectBodyOccurrencesInViewport"),t=this.viewer.getCamera(),i=[],r=t.viewportToCanvas([0,t.getViewportHeight(),0]),n=this.aggressiveRefinementEnabled&&(0,p.isUsagePreview)(),a=this.viewer.pickInRect(r[0],r[1],t.getViewportWidth(),t.getViewportHeight(),{bodyPicks:i,nodeFilterOverride:this.refinementNodeFilter,sampleLimit:o.default.getManager().getNumber("OFFSCREEN_BODY_ERROR_SAMPLE_SIZE"),doNotAffectFrustumCulling:!0,forcePreviewPick:n}),c=new Map,u=0;u<i.length;++u){var h=i[u],d=h.primitiveId;if(!(d.length<1)){d.length>1&&l.log.warn("Picked body manager occurrence id with multiple entries");var g=this.idManager.getNameForId(d),f=this.occurrences.get(g);f&&this.collectBodyOccurrenceForOccurrencePick(c,f,h)}}for(u=0;u<a.length;++u)this.collectBodyOccurrenceForEntityPick(c,a[u]);return e.report(),c},i.prototype.shouldRetrieveHighestQualityTessellationForOccurrence=function(e){if(e.getBodyMetaData().getTessellationSettingOverride()!==h.GBTTessellationSettingEnum.AUTO)return!0;for(var t=this.getBtOccurrence(e);t;){var i=this.viewer.getModelViewManagers().getManager().getOccurrenceDisplayData(t);if(i&&i.occurrenceData.forceHighestQualityTessellation)return!0;t.path.length>0?t.path.splice(t.path.length-1,1):t=null}return!1},i.prototype.collectBodyOccurrenceForEntityPick=function(e,t){if(!t.isUIPick()){var i=t.getOccurrence(),r=t.getBodyId();if(r){var n,o,s=this.viewer.getModelViewManagers().getManagerForUsage(t.usage);if(i)n=this.viewer.getOccurrenceIdManager().getIdForName(i.toString()),(o=s.retrieveBodyMetaData(i,r))&&o.canBeGroupedWithOtherConstituents&&(r=o.consumingClosedCompositeData.getId());else{var a=s.getDisplayedPartStudio();if(!a)return;(o=a.retrieveBodyMetaData(r))&&o.canBeGroupedWithOtherConstituents&&(r=o.consumingClosedCompositeData.getId()),n=a.getBodyComponent().getCorrectedBodyOccurrenceId(r)}var c=this.occurrences.get(this.getBodyOccurrenceId(n,r));if(!c&&t.usage===p.bt_graphics_Usage.PREVIEW&&!(c=this.previewOccurrences.get(r))){var l=this.viewer.getOccurrenceDataManager().getOccurrenceData(n);l&&o&&(c=new D(l,o),this.previewOccurrences.set(r,c))}c&&this.collectBodyOccurrenceForOccurrencePick(e,c,t)}}},i.prototype.collectBodyOccurrenceForOccurrencePick=function(e,t,i){var r=e.get(t);r?r.viewportOccupancyRatio+=i.coverage:e.set(t,{viewportOccupancyRatio:i.coverage})},i.prototype.getBodiesInFrustum=function(){var e=new Set,t=this.viewer.getCamera();return this.occurrences.forEach((function(i){i.outsideFrustum(t)||e.add(i.getBodyMetaData())}),this),e},i.prototype.getBodiesInvolvedInSelection=function(){for(var e=new Set,t=(0,u.getAllSelectionLists)(),i=0;i<t.length;++i){t[i].forEach((function(t){var i=t.getBodyMetaData();!i&&t.getEntityMetaData()&&(i=t.getEntityMetaData().getBodyMetaData()),i&&e.add(i)}))}return e},i.prototype.refreshReducedDetailBoxes=function(){this.sortedOccurrences&&(this.sortedOccurrences.forEach((function(e){e.displayDamaged=!0})),this.shouldUpdateBodyOccurrenceLodForIsolate=!0)},i.prototype.getPartStudio=function(e){var t=this.viewer.getModelViewManagers().getManager(),i=this.getBtOccurrence(e);return i?t.getPartStudioDataFromOccurrence(i):t.getDisplayedPartStudio()},i.prototype.getTessellationIndexToGoUnderThreshold=function(e,t,i,r,n){var o=null,s=e.getBodyMetaData();if(s.isWireBody()&&!s.hasTessellationSettings())return null;if(s.isClosedComposite&&s.containsOnlyWireBodies()){var a=this.getPartStudio(e);if(a)for(var c=0;c<s.constituentBodyIds.length;++c){var l=a.retrieveBodyMetaData(s.constituentBodyIds[c]);if(l&&!l.hasTessellationSettings())return null}}for(var u=s.hasTessellationSettings()?s.getFinestTessellationSettingOnClient()+1:0,h=s.getBestAvailableTessellationSettingIndex(n);u<=h;){if(!(0===u||i*s.getChordalToleranceForSetting(u-1)>=t)||r&&!r(s,u))break;o=u,++u}return o},i.prototype.unloadBodies=function(e,t){if(!this.paused){for(var i=Array.from(this.occurrences.values()),r=this.getBodiesInFrustum(),n=this.getBodiesInvolvedInSelection(),o=t.getDisplayedPartStudio(),s=t.getPartStudios(),a=0;a<s.length;++a){if((m=s[a])!==o)for(var c=m.getBodyComponent().getNonInstantiatedBodies(),u=0;u<c.length;++u){(g=c[u]).hasTessellationSettings()&&i.push(new S(m,g))}}i.sort((function(e,t){if(e.isInstantiated()!==t.isInstantiated())return e.isInstantiated()?1:-1;var i=e.isBodyDataPresent(),o=t.isBodyDataPresent();if(!i&&!o)return 0;if(!i)return 1;if(!o)return-1;var s=e.getBodyMetaDataForRetrieval(),a=t.getBodyMetaDataForRetrieval(),c=n.has(s);if(c!==n.has(a))return c?1:-1;var l=r.has(s);if(l!==r.has(a))return l?1:-1;var u=e.getLastViewTime(),h=t.getLastViewTime();if(u!==h)return u>h?1:-1;var d=e.getLastViewportOccupancy(),p=t.getLastViewportOccupancy();if(d!==p)return d>p?1:-1;var g=e.getBenefitToUnload(),f=t.getBenefitToUnload();return g>f?-1:f>g?1:0}));for(var h=new Set,d=0,p=0;p<i.length&&d<e;++p){var g,f=i[p];if(!(g=f.getBodyMetaDataForRetrieval()).isWireBody()&&(f.isBodyDataPresent()&&!h.has(g)&&!n.has(g))){var m=void 0;(m=f instanceof D?this.getPartStudio(f):f.partStudio)&&(d+=g.getEstimatedMemoryUsage(),this.bodyUnloadTask.addBodyToProcess(m.getBodyComponent(),g.getId()),h.add(g))}}if(I()){var y=[];h.forEach((function(e){y.push(e.getId()+"-"+e.getFinestTessellationSettingOnClient())})),y.sort(),l.log.info("Unloading "+T(d)+" of bodies to satisfy request of "+T(e)+". Body ids:\n"+y)}return this.occurrences.forEach((function(e){h.has(e.getBodyMetaDataForRetrieval())&&this.resetRetrievalStateForOccurrence(e)}),this),this.bodyUnloadTask.getTaskFinishedPromise()}l.log.info("Skipped body unloading due to pause")},i}(n.BackboneEventsBaseClass);function A(e,t){var i=e.getBenefitToCull(),r=t.getBenefitToCull();return i===r?e.getOccurrenceId()===t.getOccurrenceId()?0:e.getOccurrenceId()<t.getOccurrenceId()?-1:1:i>r?-1:1}t.BodyManager=O,t.occurrenceSortFunction=A},233678:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultNameForBody=t.BodyMetaData=t.constituentTypeToString=t.ConstituentType=void 0;var r,n=i(73055),o=i(194598),s=i(311517),a=i(227441),c=i(572599),l=i(544394),u=i(853524),h=i(601759),d=i(311611),p=[a.BTTessellationSetting.ANGULAR_TOLERANCE_COARSE,a.BTTessellationSetting.ANGULAR_TOLERANCE_MEDIUM,a.BTTessellationSetting.ANGULAR_TOLERANCE_FINE,a.BTTessellationSetting.ANGULAR_TOLERANCE_VERY_FINE],g=[a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_COARSE,a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_MEDIUM,a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_FINE,a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_VERY_FINE];function f(e){var t=1/e;return a.BTTessellationSetting.ESTIMATION_COEFFICIENT_0+a.BTTessellationSetting.ESTIMATION_COEFFICIENT_1*t+a.BTTessellationSetting.ESTIMATION_COEFFICIENT_2*t*t}!function(e){e[e.PART=0]="PART",e[e.SURFACE=1]="SURFACE",e[e.MESH=2]="MESH",e[e.CURVE=3]="CURVE",e[e.POINT=4]="POINT",e[e.SKETCH=5]="SKETCH",e[e.NUMBER_OF_TYPES=6]="NUMBER_OF_TYPES"}(r=t.ConstituentType||(t.ConstituentType={})),t.constituentTypeToString=function(e,t){switch(e){case r.PART:return t?i18n("parts"):i18n("part");case r.SURFACE:return t?i18n("surfaces"):i18n("surface");case r.MESH:return t?i18n("meshes"):i18n("mesh");case r.CURVE:return t?i18n("curves"):i18n("curve");case r.POINT:return t?i18n("points"):i18n("point");case r.SKETCH:return t?i18n("sketches"):i18n("sketch");default:return""}};var m=f(a.BTTessellationSetting.ANGULAR_TOLERANCE_COARSE);var y=function(){function e(e){this.id=e,this.name="",this.meshState=a.GBTMeshState.NO_MESH,this.constituentsContainMesh=!1,this.isModifiable=!0,this.foundInPreview=!1,this.appearance=null,this.defaultColorHash="",this.meshIncrement=null,this.tessellationSettings=null,this.isFlattenedSheetMetalBody=!1,this.isBendCenterLineBody=!1,this.ownerFlattenedBodyId="",this.sheetMetalModelId="",this.isActiveSheetMetal=!1,this.sheetMetalOrderId="",this.sheetMetalOrder=0,this.isTessellationLoaded=!1,this.coarseTriangleCount=0,this.coarsePlanarFaceTriangleCount=0,this.isAssociatedWithFlat=!1,this.colorCycle=null,this.totalEntityCount=0,this.lastViewTime=0,this.lastViewportOccupancy=0,this.partStudioVisibility=d.Visibility.VISIBLE,this.isComposite=!1,this.isClosedComposite=!1,this.constituentBodyIds_=null,this.consumingClosedCompositeData=null,this.referencingOpenCompositeData_=null,this.type=a.GBTBodyType.UNKNOWN,this.bounds=new d.BoundingBox,this.bestAvailableTessellationSetting=a.GBTTessellationSettingEnum.UNKNOWN,this.tessellationSettingOverride=a.GBTTessellationSettingEnum.AUTO,this.constituentTypeCounts=new Array(r.NUMBER_OF_TYPES).fill(0)}return e.prototype.getId=function(){return this.id},e.prototype.setAppearanceFromDisplayData=function(e){e?(e.appearance&&e.appearance.color&&(this.appearance=(0,h.shallowCloneWithPrototype)(e.appearance),this.appearance.color=new Uint8Array(e.appearance.color)),this.defaultColorHash=e.defaultColorHash):s.log.warn("setAppearanceFromDisplayData called without valid display data")},e.prototype.setColorCycle=function(e){this.colorCycle=e},e.prototype.getColorCycle=function(){return this.colorCycle},e.prototype.getColor=function(){var e=n.default.getManager();if(this.containsOnlyWireBodies())return this.isModifiableBody()?e.getColor("LINE_POINT_COLOR"):e.getColor("REFERENCE_GEOMETRY_COLOR");if(this.appearance&&this.appearance.color&&3===this.appearance.color.length){var t=this.appearance.color;return[t[0]/255,t[1]/255,t[2]/255,this.appearance.opacity/255]}if(!this.isModifiableBody())return e.getColor("REFERENCE_GEOMETRY_COLOR");var i=(0,u.getPartCycleColor)(this.defaultColorHash,this.colorCycle);return this.appearance?this.appearance.color=new Uint8Array(i.slice(0,3)):s.log.warn("No appearance object associated with BodyMetaData"),(0,d.convertRGBA255ToRGBA)(i)},e.prototype.isTranslucent=function(){return null!==this.appearance&&this.appearance.opacity<255},e.prototype.clone=function(){var t=new e(this.id);return(0,h.overwriteMatchingProperties)(t,this),t.bounds=new d.BoundingBox(this.bounds.getMin(),this.bounds.getMax()),this.referencingOpenCompositeData_&&(t.referencingOpenCompositeData_=new Map(this.referencingOpenCompositeData_)),t},e.prototype.setIsTessellationLoaded=function(e){this.isTessellationLoaded=e},e.prototype.getIsTessellationLoaded=function(){return this.consumingClosedCompositeData?this.consumingClosedCompositeData.getIsTessellationLoaded():this.isTessellationLoaded},e.prototype.setLastViewTime=function(e){this.lastViewTime=e},e.prototype.getLastViewTime=function(){return this.lastViewTime},e.prototype.setLastViewportOccupancy=function(e){this.lastViewportOccupancy=e},e.prototype.getLastViewportOccupancy=function(){return this.lastViewportOccupancy},e.prototype.getType=function(){return this.type},e.prototype.isSolidBody=function(){return!this.isComposite&&this.containsOnlySolidBodies()},e.prototype.containsOnlySolidBodies=function(){return this.type===a.GBTBodyType.SOLID},e.prototype.isSheetBody=function(){return!this.isComposite&&this.containsOnlySheetBodies()},e.prototype.containsOnlySheetBodies=function(){return this.type===a.GBTBodyType.SHEET},e.prototype.isWireBody=function(){return!this.isComposite&&this.containsOnlyWireBodies()},e.prototype.containsOnlyWireBodies=function(){return this.type===a.GBTBodyType.WIRE},e.prototype.isPointBody=function(){return!this.isComposite&&this.containsOnlyPointBodies()},e.prototype.containsOnlyPointBodies=function(){return this.type===a.GBTBodyType.POINT},e.prototype.isMeshBodyOld=function(){return this.containsMesh()&&!o.btInjector.CapabilitiesService.checkMixedModelingCurrentlyEnabled()},e.prototype.containsMesh=function(){return this.constituentsContainMesh||a.BTPartData.containsMesh(this.meshState)},e.prototype.getMeshState=function(){return this.meshState},e.prototype.isModifiableBody=function(){return this.isModifiable},e.prototype.getBounds=function(){return this.bounds},e.prototype.resetMeshIncrement=function(){this.meshIncrement=null},e.prototype.getIsFlattenedSheetMetalBody=function(){return this.isFlattenedSheetMetalBody},e.prototype.getIsActiveSheetMetal=function(){return this.isActiveSheetMetal},e.prototype.getIsBendCenterLineBody=function(){return this.isBendCenterLineBody},e.prototype.isForFlattenedView=function(){return this.isFlattenedSheetMetalBody||this.isBendCenterLineBody||this.isAssociatedWithFlat},e.prototype.isSubsidiaryBody=function(){return this.isBendCenterLineBody},e.prototype.getOwnerBodyId=function(){return this.ownerFlattenedBodyId},Object.defineProperty(e.prototype,"isOpenCompositeBody",{get:function(){return this.isComposite&&!this.isClosedComposite},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"constituentBodyIds",{get:function(){return this.constituentBodyIds_},enumerable:!1,configurable:!0}),e.prototype.removeOpenCompositeBodyReferences=function(e){if(this.constituentBodyIds_)for(var t=0;t<this.constituentBodyIds_.length;++t){var i=e[this.constituentBodyIds_[t]];i&&i.removeReferencingOpenCompositeBody(this.id)}},e.prototype.updateConstituentBodyIds=function(e,t){if(this.removeOpenCompositeBodyReferences(t),this.constituentBodyIds_=e,this.constituentBodyIds_&&this.isOpenCompositeBody)for(var i=0;i<this.constituentBodyIds_.length;++i){var r=t[this.constituentBodyIds_[i]];r&&r.addReferencingOpenCompositeBody(this)}},Object.defineProperty(e.prototype,"referencingOpenCompositeData",{get:function(){return this.referencingOpenCompositeData_},enumerable:!1,configurable:!0}),e.prototype.addReferencingOpenCompositeBody=function(e){this.referencingOpenCompositeData_||(this.referencingOpenCompositeData_=new Map),this.referencingOpenCompositeData_.set(e.id,e)},e.prototype.removeReferencingOpenCompositeBody=function(e){this.referencingOpenCompositeData_&&this.referencingOpenCompositeData_.delete(e)},Object.defineProperty(e.prototype,"isCompositeConstituent",{get:function(){return this.isClosedCompositeConstituent||this.hasReferencingOpenCompositeBody},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasReferencingOpenCompositeBody",{get:function(){return!!this.referencingOpenCompositeData_&&this.referencingOpenCompositeData_.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClosedCompositeConstituent",{get:function(){return!!this.consumingClosedCompositeData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"closedCompositeParentId",{get:function(){return this.consumingClosedCompositeData?this.consumingClosedCompositeData.id:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isGroupableCompositeBody",{get:function(){return this.isClosedComposite&&this.type!==a.GBTBodyType.UNKNOWN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isNonGroupingCompositeBody",{get:function(){return!!this.isComposite&&(!this.isClosedComposite||!this.isGroupableCompositeBody)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canBeGroupedWithOtherConstituents",{get:function(){return!!this.consumingClosedCompositeData&&this.consumingClosedCompositeData.isGroupableCompositeBody},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"meshGroupId",{get:function(){return this.canBeGroupedWithOtherConstituents?this.consumingClosedCompositeData.id:this.id},enumerable:!1,configurable:!0}),e.prototype.hasFaces=function(){return this.containsOnlySolidBodies()||this.containsOnlySheetBodies()},e.prototype.hasEdges=function(){return this.hasFaces()||this.containsOnlyWireBodies()},e.prototype.hasPoints=function(){return this.hasEdges()||this.containsOnlyPointBodies()},e.prototype.hasTessellationSettings=function(){return null!==this.getFinestTessellationSettingOnClient()},e.prototype.canEntitiesBeLoaded=function(){return this.hasTessellationSettings()||this.isWireBody()},e.prototype.getFinestTessellationSettingOnClient=function(){for(var e=null,t=0;this.tessellationSettings&&t<this.tessellationSettings.length;++t)this.tessellationSettings[t]!==a.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING&&(null===e||this.tessellationSettings[t]>e)&&(e=this.tessellationSettings[t]);return e},e.prototype.getBestAvailableTessellationSettingIndex=function(e){return e?a.GBTTessellationSettingEnum.VERY_FINE-1:this.bestAvailableTessellationSetting===a.GBTTessellationSettingEnum.AUTO||this.bestAvailableTessellationSetting===a.GBTTessellationSettingEnum.UNKNOWN?null:this.bestAvailableTessellationSetting-1},e.prototype.getTessellationSettingOverride=function(){return this.tessellationSettingOverride},e.prototype.getChordalTolerance=function(){var e=this.getFinestTessellationSettingOnClient();return null===e?null:this.getChordalToleranceForSetting(e)},e.prototype.getChordalToleranceForSetting=function(e){return e<0||e>=g.length?(s.log.warn("Attempt to retrieve chordal tolerance for invalid tessellation setting"),0):this.getBounds().diameter()/2*g[e]},e.prototype.estimateTriangleCountAtSettingIndex=function(e){return function(e,t,i){var r=f(p[i]);return t/m*r+e}(this.coarsePlanarFaceTriangleCount,this.coarseTriangleCount,e)},e.prototype.getEstimatedMemoryUsage=function(e){if(!e&&this.hasTessellationSettings()&&(e=this.tessellationSettings),!e||0===e.length)return 0;for(var t=0,i=!1,r=0;r<e.length;++r)e[r]!==a.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING&&(t+=this.estimateTriangleCountAtSettingIndex(e[r])*a.BTTessellationSetting.BYTES_PER_TRIANGLE,i=!0);return t+(i?this.totalEntityCount*a.BTTessellationSetting.BYTES_PER_ENTITY:0)},e.prototype.shouldProduceLocalThumbnail=function(){var e=!this.isOpenCompositeBody;return this.isModifiable&&!this.isClosedCompositeConstituent&&!this.isForFlattenedView()&&(!e||this.hasTessellationSettings())},e.prototype.updateConstituentTypeCounts=function(e){if(this.isComposite){this.constituentTypeCounts.fill(0);for(var t=0;t<this.constituentBodyIds_.length;t++){var i=this.constituentBodyIds_[t],n=e.retrieveBodyMetaData(i);if(n&&n.isMeshBodyOld())this.constituentTypeCounts[r.MESH]++;else{var o=e.getBodyType(i);o===a.GBTBodyType.SOLID?this.constituentTypeCounts[r.PART]++:o===a.GBTBodyType.SHEET?this.constituentTypeCounts[r.SURFACE]++:o===a.GBTBodyType.WIRE?this.constituentTypeCounts[r.CURVE]++:o===a.GBTBodyType.POINT&&this.constituentTypeCounts[r.POINT]++}}}},e.prototype.updateDataDerivedFromConstituents=function(e,t){var i=this;if(this.isComposite){this.constituentsContainMesh=!1,this.type=null;for(var r=function(e){null===i.type?i.type=e:i.type!==e&&(i.type=a.GBTBodyType.UNKNOWN)},n=0;n<this.constituentBodyIds_.length;++n){var o=this.constituentBodyIds_[n],s=t[o];if(s)this.constituentsContainMesh=this.constituentsContainMesh||a.BTPartData.containsMesh(s.closedConstituentPartData.meshState),r(s.closedConstituentPartData.bodyType);else{var c=e[o];c&&(this.constituentsContainMesh=this.constituentsContainMesh||a.BTPartData.containsMesh(c.meshState),r(c.type))}}null===this.type&&(this.type=a.GBTBodyType.UNKNOWN)}},e.prototype.getConstituentsContainMesh=function(){return this.constituentsContainMesh},e.prototype.getName=function(){return this.name},e}();t.BodyMetaData=y,(0,c.setBodyMetaDataCreator)((function(e,t){var i=t.getBodyId(),r=t.getMeshIncrement();if(!i||!r)return null;var n=new y(i);return n.type=e,n.bounds=r.getBounds(),n})),t.getDefaultNameForBody=function(e){return(0,l.getDefaultNameForBodyType)(e?e.type:a.GBTBodyType.UNKNOWN)}},767605:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CenterOfMassIndicator=void 0;var r=i(423902),n=i(311611),o=i(911748),s=i(699716),a=function(e){function t(t,i){var r=e.call(this,i,n.HUD_SCENEGRAPH_ID)||this;return r.elementModel=t,r.centerOfMass=null,r}return(0,r.__extends)(t,e),t.prototype.updateCenterOfMass=function(e){this.centerOfMass=e},t.prototype.updateGraphics=function(){this.ensureMaterialIsCreated();var e=20*(0,s.getDevicePixelRatio)(),t=(0,n.createQuad)([0,0,0],[e,0,0],[0,e,0],void 0,[0,0],[1,1]);this.updateMeshIncrement("QUAD","",t,this.viewer.getResources().centerOfMassIndicatorNodeProperties)},t.prototype.ensureMaterialIsCreated=function(){if(null===this.viewer.getResources().centerOfMassIndicatorNodeProperties){var e=(0,n.getNextPowerOfTwo)(20);if(e>(0,n.getMaximumTextureSize)())throw new Error("Center of mass texture size exceeds limit");var t=new n.Texture(this.viewer,(function(t){var i=new n.TextureDefinition(t);return i.width=e,i.height=e,i.magnificationFilter=t.LINEAR,i.minificationFilter=t.LINEAR,i.useMipmaps=!1,i.imageSource="/images/center-of-mass.png",i}));t.setHasTransparency(!0),this.viewer.getResources().centerOfMassIndicatorNodeProperties=new n.NodeProperties({primitiveType:n.PrimitiveType.TRIANGLES,material:(0,n.createTextureMaterial)(t),isPickable:!1})}},t.prototype.onViewWillDraw=function(e){if(null!==this.centerOfMass&&!this.isHidden){var t=e.projectWorldPointToViewport(this.centerOfMass),i=o.mat4.identity(),r=20*(0,s.getDevicePixelRatio)()/2;i[12]=Math.floor(t[0]-r),i[13]=Math.floor(t[1]-r),this.setTransform(i),this.hasMeshIncrements()||this.updateGraphics()}},t.prototype.onDevicePixelRatioChanged=function(e){this.updateGraphics()},t}(n.UIElement);t.CenterOfMassIndicator=a},855965:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentIndicator=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(194598),a=i(311517),c=i(227441),l=i(699716),u=i(311611),h="commentindicator",d=n.default.getManager();function p(e){var t=new u.ImageData;t.id="n",t.backgroundColor=d.getString("COMMENT_INDICATOR_BACKGROUND_COLOR"),t.imageName="comment-indicator.png";var i=new u.ImageData;return i.id="h",i.backgroundColor=d.getString("COMMENT_INDICATOR_HOVER_BACKGROUND_COLOR"),i.imageName="comment-indicator.png",(0,u.createAtlasFromResources)(e,Math.max(20,20),[t,i],{sourcesHaveTransparency:!0})}function g(e){e.getResources().commentIndicatorAtlasCreationInitiated||(e.getResources().commentIndicatorAtlasCreationInitiated=!0,e.getTextureAtlasFactory().getAtlas("COMMENT_INDICATOR_ATLAS",p.bind(void 0,e)).then((function(t){e.getResources().commentIndicatorAtlas=t,e.getResources().commentIndicatorMaterial.ambientTexture=t.texture,(0,u.requestDraw)()}),(function(e){a.log.error(e)})))}var f=function(e){function t(t,i,r){var n=e.call(this,r,u.HUD_SCENEGRAPH_ID)||this;return n.entityDeterministicId=t,n.occurrence=null,n.associatedComments=[],n.worldSpacePosition=null,n.hovered=!1,n.elementBeingListenedTo=null,n.parentHidden=!1,n.allCommentsHidden=!1,n.parentSheetMetalModelId=null,i&&(n.occurrence=c.BTOccurrence.getOccurrenceFromPathString(i)),n.updateWorldPosition(),n.listenTo(n.viewer.getEventDispatcher(),u.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,n.updateWorldPosition),n.listenTo(n.viewer.getEventDispatcher(),u.BODIES_LOADED,n.updateWorldPosition),n.listenTo(n.viewer.getEventDispatcher(),u.ASSEMBLY_DATA_PROCESSED,n.updateMissingWorldPosition),n.listenTo(r.getEventDispatcher(),u.ACTIVE_SHEETMETAL_MODEL_CHANGED,n.onActiveSheetMetalModelChanged),n.listenTo(n,u.UiEvents.CLICK+h,n.onClick),n.listenTo(n,u.UiEvents.MOUSE_ENTER+h,n.onMouseEnter),n.listenTo(n,u.UiEvents.MOUSE_LEAVE+h,n.onMouseLeave),n}return(0,r.__extends)(t,e),t.prototype.addComment=function(e){this.associatedComments.indexOf(e)<0&&this.associatedComments.push(e)},t.prototype.removeComment=function(e){var t=this.associatedComments.indexOf(e);t>=0&&this.associatedComments.splice(t,1)},t.prototype.hasComments=function(){return this.associatedComments.length>0},t.prototype.onDevicePixelRatioChanged=function(e){this.updateGraphics()},t.prototype.updateGraphics=function(){if(this.viewer.getResources().commentIndicatorAtlas){var e=this.viewer.getResources().commentIndicatorAtlas.getTextureCoords(this.hovered?"h":"n");if(e){var t=(0,l.getDevicePixelRatio)(),i=(0,u.createQuad)([0,0,0],[20*t,0,0],[0,20*t,0],void 0,[e.lowS,e.highT],[e.highS,e.lowT]);this.updateMeshIncrement("QUAD",h,i,this.viewer.getResources().commentIndicatorNodeProperties)}}},t.prototype.updateWorldPosition=function(){this.worldSpacePosition=null;var e=this.viewer.getModelViewManagers().getManager(),t=null;if(this.occurrence&&!e.isEntityOnOccurrence(this.entityDeterministicId,this.occurrence)||(t=e.extractMeshIncrement(this.entityDeterministicId,this.occurrence)),t){if(this.worldSpacePosition=this.getStickingPosition(t),this.viewer.getIsForFlattenedDisplay()){var i=e.getFlattenedEntityOwnerBodyDetails(this.entityDeterministicId,this.occurrence);if(!i||!i.transform)return this.worldSpacePosition=null,void this.removeMeshIncrements();o.mat4.multiplyVec3(i.transform,this.worldSpacePosition),this.parentSheetMetalModelId=i.bodyMetaData.sheetMetalModelId,this.updateHideState()}if(this.occurrence){var r=e.getOccurrenceTransform(this.occurrence);if(!r)return this.worldSpacePosition=null,void this.removeMeshIncrements();o.mat4.multiplyVec3(r,this.worldSpacePosition)}this.updateElementListener()}else this.removeMeshIncrements()},t.prototype.updateMissingWorldPosition=function(){this.worldSpacePosition||this.updateWorldPosition()},t.prototype.stopListeningToElement=function(){this.elementBeingListenedTo&&(this.stopListening(this.elementBeingListenedTo),this.elementBeingListenedTo=null)},t.prototype.updateElementListener=function(){this.stopListeningToElement();var e=this.viewer.getModelViewManagers().getManager();if(this.occurrence){var t=e.getDisplayedAssembly();if(t){var i=this.occurrence.getPathAsString();this.onParentVisibilityChange(t.getOccurrenceVisibility(this.occurrence)),this.listenTo(t,"OCCURRENCE_VISIBILITY_CHANGE."+i,this.onParentVisibilityChange),this.listenTo(t,"OCCURRENCE_DATA_CHANGE."+i,this.updateWorldPosition),this.listenTo(t,"OCCURRENCE_DELETED."+i,this.updateWorldPosition),this.elementBeingListenedTo=t}}else{var r=e.getDisplayedPartStudio();if(r){var n=r.retrieveEntityMetaData(this.entityDeterministicId);if(n.isFromBody()){var o=n.getBodyId();this.onParentVisibilityChange(r.getBodyVisibility(o)),this.listenTo(r,"BODY_VISIBILITY_CHANGE."+o,this.onParentVisibilityChange)}else{var s=n.getFirstFeatureId();this.onParentVisibilityChange(r.getFeatureVisibility(s)),this.listenTo(r,"FEATURE_VISIBILITY_CHANGE."+s,this.onParentVisibilityChange)}this.elementBeingListenedTo=r}}},t.prototype.onParentVisibilityChange=function(e){this.parentHidden=e===u.Visibility.HIDDEN,this.updateHideState()},t.prototype.setAllCommentsHidden=function(e){this.allCommentsHidden=e,this.updateHideState()},t.prototype.updateHideState=function(){var e=!1;this.parentSheetMetalModelId&&this.parentSheetMetalModelId!==this.viewer.getModelViewManagers().getManager().getSelectedSheetmetalModelId()&&(e=!0),this.allCommentsHidden||this.parentHidden||e?this.hide():this.show()},t.prototype.getStickingPosition=function(e){return e.getPositionNearCenter()},t.prototype.onViewWillDraw=function(e){if(g(this.viewer),!this.isHidden&&this.worldSpacePosition&&this.viewer.getResources().commentIndicatorAtlas){this.viewer.getResources().commentIndicatorMaterial.ambientTexture=this.viewer.getResources().commentIndicatorAtlas.texture;var t=e.projectWorldPointToViewport(this.worldSpacePosition),i=o.mat4.identity();i[12]=Math.floor(t[0]-10),i[13]=Math.floor(t[1]-10),this.setTransform(i),this.hasMeshIncrements()||this.updateGraphics()}},t.prototype.onClick=function(e,t){t.skipCommentClearHighlight=!0,s.btInjector.CommentService.highlightComments(this.associatedComments)},t.prototype.onMouseEnter=function(){this.hovered=!0,this.removeMeshIncrements(),(0,u.requestDraw)()},t.prototype.onMouseLeave=function(){this.hovered=!1,this.removeMeshIncrements(),(0,u.requestDraw)()},t.prototype.onActiveSheetMetalModelChanged=function(e){this.parentSheetMetalModelId&&this.updateHideState()},t}(u.UIElement);t.CommentIndicator=f},116021:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InferenceDisplayWithoutHover=t.InferenceDisplay=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(574010),a=i(673290),c=i(311611),l=n.default.getManager(),u=function(e){function t(t,i,r){var n=e.call(this,i)||this;n.inferenceData=t,n.hovered=!1,n.selected=!1,n.lastScale=-1,n.lastPickScale=-1;var s=n.inferenceData.isInContextEntity?o.mat4.identity(o.mat4.create()):n.getOccurrenceTransform(n.inferenceData.occurrence,r);return n.worldSpaceTransform=o.mat4.multiply(s,n.inferenceData.coordinateSystem.getGlMatrix()),n.worldSpacePosition=[n.worldSpaceTransform[12],n.worldSpaceTransform[13],n.worldSpaceTransform[14]],n.inferenceId=c.INVALID_ID,(0,c.requestDraw)(),n}return(0,r.__extends)(t,e),t.prototype.setInferenceId=function(e){this.inferenceId=e},t.prototype.getInferenceId=function(){return this.inferenceId},t.prototype.onDevicePixelRatioChanged=function(e){this.updateGraphics()},t.prototype.setHovered=function(e){e!==this.hovered&&(this.hovered=e,this.updateGraphics())},t.prototype.getOccurrenceTransform=function(e,t){return t?t(e.getPathAsString()):this.viewer.getModelViewManagers().getManager().getOccurrenceTransform(e)},t.prototype.onViewWillDraw=function(e,t){this.updateTransform(e)},t.prototype.updateTransform=function(e){var t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(!(Math.abs(this.lastScale-t)<a.Tolerances.ZERO_LENGTH)){this.lastScale=t;var i=o.mat4.identity();i[0]=t,i[5]=t,i[10]=t,this.setTransform(o.mat4.multiply(this.worldSpaceTransform,i,o.mat4.create())),this.hasMeshIncrements()||this.updateGraphics()}},t.prototype.isAxialInference=function(e){return e===s.GBTEntityInferenceType.TOP_AXIS_POINT||e===s.GBTEntityInferenceType.MID_AXIS_POINT||e===s.GBTEntityInferenceType.BOTTOM_AXIS_POINT||e===s.GBTEntityInferenceType.LOOP_CENTER||e===s.GBTEntityInferenceType.CENTER},t.prototype.updateGraphicsNoHover=function(e){this.isAxialInference(this.inferenceData.inferenceType)?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTER_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTER_LINES].clone(),c.INFERENCE_LINE_PROPERTIES)):this.inferenceData.inferenceType===s.GBTEntityInferenceType.MID_POINT?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_MID_POINT_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_MID_POINT_LINES].clone(),c.INFERENCE_LINE_PROPERTIES)):this.inferenceData.inferenceType===s.GBTEntityInferenceType.CENTROID?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTROID_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTROID_LINES].clone(),c.INFERENCE_LINE_PROPERTIES)):this.isOriginAxisInference()?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES,e[c.IncrementId.INFERENCE_POINT_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES,e[c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES].clone(),c.INFERENCE_LINE_PROPERTIES),this.removeMeshIncrement(c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED)):(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_POINT_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_POINT_LINES].clone(),c.INFERENCE_LINE_PROPERTIES))},t.prototype.isOriginAxisInference=function(){return this.inferenceData&&(this.inferenceData.inferenceType===s.GBTEntityInferenceType.ORIGIN_X||this.inferenceData.inferenceType===s.GBTEntityInferenceType.ORIGIN_Y||this.inferenceData.inferenceType===s.GBTEntityInferenceType.ORIGIN_Z)},t.prototype.updateGraphics=function(){var e=(0,c.getStaticIncrements)();this.hovered?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.TRIANGLES_PRESELECTED].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.LINES].clone(),c.INFERENCE_LINE_PROPERTIES),this.isOriginAxisInference()&&this.updateMeshIncrement(c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED,c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED,e[c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED].clone(),c.INFERENCE_LINE_PROPERTIES)):this.updateGraphicsNoHover(e)},t.prototype.updateOccurrenceTransform=function(e){if(this.inferenceData){this.worldSpaceTransform=o.mat4.multiply(e,this.inferenceData.coordinateSystem.getGlMatrix()),this.worldSpacePosition=[this.worldSpaceTransform[12],this.worldSpaceTransform[13],this.worldSpaceTransform[14]];var t=o.mat4.identity();t[0]=this.lastScale,t[5]=this.lastScale,t[10]=this.lastScale,this.setTransform(o.mat4.multiply(this.worldSpaceTransform,t,o.mat4.create())),this.hasMeshIncrements()||this.updateGraphics(),(0,c.requestDraw)()}},t.prototype.getUpdatedPickIncrement=function(e,t){var i=null;if(this.isOriginAxisInference()){var r=t.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(Math.abs(r-this.lastPickScale)>a.Tolerances.ZERO_LENGTH){var n=o.mat4.identity();n[0]=r,n[5]=r,n[10]=r;var s=5*l.getNumber("MATE_CONNECTOR_AXIS_LINE_LENGTH_PX"),u=3*l.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_WIDTH"),h=[0,0,s*r],d=o.mat4.multiplyVec3(this.worldSpaceTransform,h,o.vec3.create());(i=(0,c.createLine)([0,0,0],d,e.toString(),void 0,u)).id=e.toString(),this.lastPickScale=r}}else 1!==this.lastPickScale&&(i=(0,c.createPoint)(this.worldSpacePosition,e.toString()),this.lastPickScale=1);return i&&(i.pickId=e),i},t}(c.UIElement);t.InferenceDisplay=u;var h=function(e){function t(t,i){return e.call(this,t,i)||this}return(0,r.__extends)(t,e),t.prototype.updateGraphics=function(){var e=(0,c.getStaticIncrements)();this.updateGraphicsNoHover(e)},t}(u);t.InferenceDisplayWithoutHover=h},469986:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DimensionComponent=void 0;var r=i(423902),n=i(311611),o=i(997862),s=i(487152),a=i(227441),c=function(){function e(e,t,i){this.usage=e,this.elementId=t,this.viewer=i,this.dimensionData={},this.dimensionDisplays={},this.visibleDimensionBounds=null,(0,n.viewerCheck)(i),this.activeSketchIds=new o.StringSet}return e.prototype.processDisplayData=function(e){if(this.usage!==n.bt_graphics_Usage.PREVIEW){this.dimensionData={};for(var t=0;t<e.dimensions.length;++t){var i=e.dimensions[t];i&&i.isAssociatedWithFlat===this.viewer.getIsForFlattenedDisplay()&&(this.dimensionData[i.getFullyQualifiedId()]=i)}}},e.prototype.reset=function(){this.remove(),this.dimensionData={},this.activeSketchIds.clear()},e.prototype.remove=function(){Object.values(this.dimensionDisplays).forEach((function(e){e.remove()})),this.dimensionDisplays={}},e.prototype.isDimensionForDisplayedSheetMetalModel=function(e,t){if(!this.viewer.getIsForFlattenedDisplay())return!0;var i=this.viewer.getModelViewManagers().getManager(),r=t||i.getSelectedSheetmetalModelId(),n=this.dimensionData[e];return!n||r===i.getDisplayedPartStudio().getSketchComponent().getSMModelIdForSketch(n.featureId)},e.prototype.showDimensionsWithSheetmetalModelIdOnly=function(e,t){for(var i in this.dimensionDisplays){var r=this.isDimensionForDisplayedSheetMetalModel(i,e),n=this.dimensionDisplays[i],o=this.dimensionData[i];r&&o&&this.activeSketchIds.contains(o.featureId)?n&&(n.show(),this.resetVisibleDimensionBounds()):n.hide()}},e.prototype.updateDisplays=function(){var e,t,i=[];for(e in this.dimensionDisplays)this.dimensionData.hasOwnProperty(e)||i.push(e);for(var o=0;o<i.length;++o)e=i[o],(t=this.dimensionDisplays[e]).remove(),delete this.dimensionDisplays[e];Object.entries(this.dimensionData).forEach((function(e){var i=(0,r.__read)(e,2),o=i[0],s=i[1];if(!(t=this.dimensionDisplays[o])){if(!(t=(0,n.createDimensionForDisplayData)(s,this.elementId,this.viewer)))return;this.dimensionDisplays[o]=t,this.activeSketchIds.contains(s.featureId)&&this.isDimensionForDisplayedSheetMetalModel(o)?(t.show(),this.resetVisibleDimensionBounds()):t.hide()}if(this.viewer.getIsForFlattenedDisplay()){var a=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio(),c=a.getSketchComponent().getOwnerFlattenedBodyIdForSketch(s.featureId);if(c){var l=a.retrieveBodyMetaData(c);if(l){var u=a.getBodyComponent().getTransformFromSheetMetalBodyMetaData(l);t.setAppliedTransform(u)}}}t.updateFromDisplayData(s)}),this),this.updateConfiguredDimensionsToLatest()},e.prototype.displaySketchAsActive=function(e,t){this.activeSketchIds.contains(e)!==t&&(Object.entries(this.dimensionDisplays).forEach((function(i){var n=(0,r.__read)(i,2),o=n[0],s=n[1];s.getFeatureId()===e&&(t&&this.isDimensionForDisplayedSheetMetalModel(o)?s.show():s.hide())}),this),t?this.activeSketchIds.add(e):this.activeSketchIds.remove(e),this.resetVisibleDimensionBounds(),this.updateConfiguredDimensionsToLatest())},e.prototype.updateConfiguredDimensionsToLatest=function(){var e=s.DocumentClientCache.getSingleton().getModelTreeState(this.elementId);e&&this.updateConfiguredDimensions(e.getModelTree())},e.prototype.getDimensionId=function(t,i,r){var n="";return r&&e.parameterIdsIncludedInDisplayData.includes(r)&&(n=r),a.BTDimensionDisplayData.createFullyQualifiedId(t,i,n)},e.prototype.updateConfiguredDimensions=function(e){for(var t=new o.StringSet,i=e.children,n=0;n<i.length;n++){var s=i[n];if(s instanceof a.BTMSketch&&this.activeSketchIds.contains(s.featureId))for(var c=0;c<s.constraints.length;c++)for(var l=s.constraints[c],u=0;u<l.parameters.length;u++)if(l.parameters[u]instanceof a.BTMParameterConfigured){var h=this.getDimensionId(s.featureId,l.entityId,l.parameters[u].parameterId);t.add(h);break}}Object.entries(this.dimensionDisplays).forEach((function(e){var i=(0,r.__read)(e,2),n=i[0],o=i[1];t.contains(n)?o.setIsConfigured(!0):o.setIsConfigured(!1)}))},e.prototype.sketchHidden=function(e){this.activeSketchIds.contains(e)&&Object.values(this.dimensionDisplays).forEach((function(t){t.getFeatureId()===e&&(t.hide(),this.resetVisibleDimensionBounds())}),this)},e.prototype.sketchShown=function(e){this.activeSketchIds.contains(e)&&Object.entries(this.dimensionDisplays).forEach((function(t){var i=(0,r.__read)(t,2),n=i[0],o=i[1];o.getFeatureId()===e&&this.isDimensionForDisplayedSheetMetalModel(n)&&(o.show(),this.resetVisibleDimensionBounds())}),this)},e.prototype.getDimensionGraphic=function(e,t,i){var r=this.getDimensionId(e,t,i);return this.dimensionDisplays[r]},e.prototype.getDimensionBoundsForFeature=function(e){if(!this.activeSketchIds.contains(e))return null;var t=new n.BoundingBox;return Object.values(this.dimensionDisplays).forEach((function(i){i.getFeatureId()===e&&t.addBox(i.getFitBounds())}),this),t},e.prototype.resetVisibleDimensionBounds=function(){this.visibleDimensionBounds=null},e.prototype.getVisibleDimensionBounds=function(){return this.activeSketchIds.isEmpty()?null:(this.visibleDimensionBounds||(this.visibleDimensionBounds=new n.BoundingBox,Object.values(this.dimensionDisplays).forEach((function(e){e.isVisibleToUser()&&this.visibleDimensionBounds.addBox(e.getFitBounds())}),this)),this.visibleDimensionBounds)},e}();t.DimensionComponent=c,c.parameterIdsIncludedInDisplayData=[a.BTMSketchConstraint.RHO_PARAMETER_NAME,a.BTMSketchConstraint.COUNT1_PARAMETER_NAME,a.BTMSketchConstraint.COUNT2_PARAMETER_NAME]},515965:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeCurvatureDisplay=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(53395),a=i(740667),c=i(687991),l=i(673290),u=i(397843),h=i(311611),d=i(416825),p=i(808035),g=n.default.getManager(),f=new h.NodeProperties({primitiveType:h.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isTwoSided:!1,isShowThrough:!1,isDepthTested:!0}),m=new h.NodeProperties({primitiveType:h.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isShowThrough:!0,isTwoSided:!0,isDepthTested:!1,isStencilTested:!0}),y=new h.NodeProperties({primitiveType:h.PrimitiveType.POINTS,isPickable:!1,isHighlightable:!1,isTwoSided:!0,isShowThrough:!0,priority:p.RenderOrderPriority.HIGHEST}),v=new h.NodeProperties({primitiveType:h.PrimitiveType.TRIANGLES,isPickable:!1,isHighlightable:!1,isTwoSided:!0,isShowThrough:!0,priority:p.RenderOrderPriority.HIGHEST}),E=g.getColor("CURVATURE_TOOTH_COLOR"),I=g.getColor("CURVATURE_U_TOOTH_COLOR"),T=g.getColor("CURVATURE_V_TOOTH_COLOR"),S=g.getStipple("CURVATURE_UV_TOOTH_STIPPLE"),P=g.getNumber("CURVATURE_TOOTH_LINE_WIDTH"),_=g.getNumber("CURVATURE_UV_TOOTH_LINE_WIDTH"),M=g.getColor("CURVATURE_U_ROOF_COLOR"),D=g.getColor("CURVATURE_V_ROOF_COLOR"),C=g.getNumber("CURVATURE_UV_ROOF_LINE_WIDTH"),O=g.getColor("CURVATURE_ROOF_COLOR"),A=g.getNumber("CURVATURE_ROOF_LINE_WIDTH"),R=g.getStipple("CURVATURE_UV_ROOF_STIPPLE"),N=Math.pow(l.Tolerances.MAX_MODEL_SIZE,2),w=g.getColor("RADIUS_OF_CURVATURE_CIRCLE_COLOR"),b=g.getNumber("INFLECTION_POINT_SIZE"),L=g.getColor("INFLECTION_POINT_COLOR"),F=g.getNumber("INFLECTION_TRIANGLE_HEIGHT_PX"),B=g.getNumber("INFLECTION_TRIANGLE_WIDTH_PX"),x=function(e){function t(t,i,r,n,o,s,a){var c=e.call(this,s)||this;return c.edgeId=t,c.curvatureData=i,c.curvatureSize=r,c.checkboxStates=n,c.entityCurvatureWrapper=a,c.curvaturePower=o,c.id="edgeCurvature."+t,c.listenTo(s.getEventDispatcher(),h.ACTIVE_SHEETMETAL_MODEL_CHANGED,c.onActiveSheetMetalModelChanged),c.update(),c}return(0,r.__extends)(t,e),t.prototype.update=function(){if(!this.isHidden){var e,t=[],i=[];if(this.curvatureData&&this.checkboxStates[u.EdgeCurvatureCheckboxNames.CURVATURE_COMBS])for(var r=this.curvatureData.curvatures.length,n=0;n<r;n++){var s=this.curvatureData.curvatures[n],c=this.curvatureData.positions[n],l=o.vec3.createFrom(c.x,c.y,c.z),d=this.curvatureData.normals[n],p=o.vec3.createFrom(d.x,d.y,d.z),g=this.curvatureSize*Math.pow(s,this.curvaturePower),y=o.vec3.add(l,o.vec3.scale(p,g,o.vec3.create()),o.vec3.create()),v=n%a.BTEdgeCurvatureData.OVERSAMPLING_SCALE!=0,w=n===r-1&&n>0&&t.length>1&&o.vec3.equal(t[0],l)&&o.vec3.equal(t[1],y);Math.max(o.vec3.squaredLength(l),o.vec3.squaredLength(y))<N?(v||w||t.push(l,y),e&&i.push(e,y),e=y):e=void 0}var b=E,L=P,F=O,B=A;this.entityCurvatureWrapper.isFaceCurvature()&&(b=this.entityCurvatureWrapper.isFaceUCurve()?I:T,L=_,F=this.entityCurvatureWrapper.isFaceUCurve()?M:D,B=C);var x=(0,h.createLines)(t,void 0,b,L);this.updateMeshIncrement("edgeCurvature.teeth",h.NO_SELECTION_ID,x,f);var U=(0,h.createLines)(t,void 0,b,L,S);this.updateMeshIncrement("edgeCurvature.stippledTeeth",h.NO_SELECTION_ID,U,m);var G=(0,h.createLines)(i,void 0,F,B);this.updateMeshIncrement("edgeCurvature.roof",h.NO_SELECTION_ID,G,f);var H=(0,h.createLines)(i,void 0,F,B,R);this.updateMeshIncrement("edgeCurvature.stippledroof",h.NO_SELECTION_ID,H,m),this.updateInflectionPointIndicators(),this.updateMinimumRadiusOfCurvatureIndicator()}},t.prototype.updateInflectionPointIndicators=function(){if(this.curvatureData&&this.curvatureData.inflectionPointPositions){var e=[],t=this.curvatureData.inflectionPointPositions.length,i=new Float32Array(15*t),r=new Float32Array(15*t),n=new Int32Array(6*t);if(this.checkboxStates[u.EdgeCurvatureCheckboxNames.INFLECTION_POINTS]){if(this.curvatureData.inflectionPointPositions.length!==this.curvatureData.tangentsAtInflectionPoints.length)return;for(var s=0;s<t;s++){var a=this.curvatureData.inflectionPointPositions[s],c=o.vec3.createFrom(a.x,a.y,a.z);e.push(c);var p=this.curvatureData.tangentsAtInflectionPoints[s],g=o.vec3.createFrom(p.x,p.y,p.z),f=this.viewer.getCamera().getPixelSizeAtWorldPoint(c),m=this.viewer.getCamera().projectWorldPointToCanvas(c),E=this.viewer.getCamera().getRay(m[0],m[1]).direction,I=o.vec3.cross(E,g,o.vec3.create());o.vec3.length(I)>l.Tolerances.ZERO_LENGTH&&o.vec3.normalize(I);for(var T=o.vec3.cross(E,I,o.vec3.create()),S=o.vec3.scale(I,f*F,o.vec3.create()),P=o.vec3.scale(I,f*-F,o.vec3.create()),_=o.vec3.scale(T,f*-B/2,o.vec3.create()),M=o.vec3.scale(T,f*B/2,o.vec3.create()),D=[o.vec3.add(c,o.vec3.add(S,M,o.vec3.create()),o.vec3.create()),o.vec3.add(c,o.vec3.add(S,_,o.vec3.create()),o.vec3.create()),c,o.vec3.add(c,o.vec3.add(P,M,o.vec3.create()),o.vec3.create()),o.vec3.add(c,o.vec3.add(P,_,o.vec3.create()),o.vec3.create())],C=[0,1,2,3,4,2],O=0;O<6;O++)5!==O&&(i.set(D[O],15*s+3*O),r.set(E,15*s+3*O)),n[6*s+O]=5*s+C[O]}}var A=new h.MeshIncrement(h.PrimitiveType.TRIANGLES,i,n);A.normals=r,(0,d.addColorToIncrement)(L,A),(0,d.addSizeToIncrement)(b,A),this.updateMeshIncrement("edgeCurvature.inflectionTriangles",h.NO_SELECTION_ID,A,v);var R=new Float32Array(3*e.length),N=new Int32Array(e.length);for(s=0;s<e.length;++s){N[s]=s;for(O=0;O<3;++O)R[3*s+O]=e[s][O]}var w=new h.MeshIncrement(h.PrimitiveType.POINTS,R,N,void 0);(0,d.addColorToIncrement)(L,w),(0,d.addSizeToIncrement)(b,w),this.updateMeshIncrement("edgeCurvature.inflectionPoint",h.NO_SELECTION_ID,w,y)}},t.prototype.updateMinimumRadiusOfCurvatureIndicator=function(){if(this.checkboxStates[u.EdgeCurvatureCheckboxNames.MINIMUM_RADIUS]&&this.curvatureData&&this.curvatureData.coordinateSystemOfCurvatureCircle){var e=this.curvatureData.coordinateSystemOfCurvatureCircle.getGlMatrix(),t=o.vec3.createFrom(e[12],e[13],e[14]),i=o.vec3.createFrom(e[8],e[9],e[10]),r=this.curvatureData.minimumRadiusOfCurvature,n=(0,h.createCircle)(t,this.curvatureData.minimumRadiusOfCurvature,i,100);(0,d.addColorToIncrement)(w,n),(0,d.addSizeToIncrement)(A,n),this.updateMeshIncrement("edgeCurvature.radius",h.NO_SELECTION_ID,n,f);var a=new c.BTRadialDimensionDisplayData;a.id="fakeDimensionId",a.featureId="fakeSketchId",a.parameterId="length",a.value=this.curvatureData.minimumRadiusOfCurvature,a.coordinateSystem.m00=1,a.coordinateSystem.m01=0,a.coordinateSystem.m10=0,a.coordinateSystem.m11=1,a.coordinateSystem.m02=0,a.coordinateSystem.m12=0,a.coordinateSystem.m22=1;var l=-Math.PI,p=this.curvatureData.minimumRadiusOfCurvature/2,g=-Math.PI,m=g;a.positionR=p,a.positionT=l,a.witnessEndPoint0r=r,a.witnessEndPoint0t=g,a.witnessEndPoint1r=r,a.witnessEndPoint1t=m,a.planeMatrix=this.curvatureData.coordinateSystemOfCurvatureCircle,a.radiusDisplay=s.GBTRadiusDisplay.RADIAL,a.isDriven=!0,this.diameterGraphics||(this.diameterGraphics=new h.RadialDimension(this.viewer,!0)),this.diameterGraphics.updateFromDisplayData(a)}else this.removeMeshIncrement("edgeCurvature.radius"),this.diameterGraphics&&(this.diameterGraphics.remove(),this.diameterGraphics=null)},t.prototype.updateSizeAndPower=function(e,t){this.curvatureSize===e&&this.curvaturePower===t||(this.curvatureSize=e,this.curvaturePower=t,this.update())},t.prototype.show=function(){e.prototype.show.call(this),this.diameterGraphics&&this.diameterGraphics.show(),this.update()},t.prototype.hide=function(){e.prototype.hide.call(this),this.diameterGraphics&&this.diameterGraphics.hide()},t.prototype.remove=function(){e.prototype.remove.call(this),this.diameterGraphics&&this.diameterGraphics.remove()},t.prototype.getFitBounds=function(){return this.getInstantiatedMeshIncrement("edgeCurvature.teeth").meshIncrement.getBounds()},t.prototype.onViewWillDraw=function(e,t){this.updateInflectionPointIndicators()},t.prototype.onActiveSheetMetalModelChanged=function(e){this.curvatureData.ownerBodySheetMetalModelId&&(this.curvatureData.ownerBodySheetMetalModelId!==e?this.hide():this.show())},t.prototype.onCheckboxStatesUpdate=function(e){this.checkboxStates=e,this.update()},t}(h.UIElement);t.EdgeCurvatureDisplay=x},414156:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgePoint=void 0;var r=i(423902),n=i(311611),o=i(712197),s=i(73055),a=i(227441),c=i(911748),l=s.default.getManager(),u=new n.NodeProperties({primitiveType:n.PrimitiveType.POINTS,isPickable:!0,isShowThrough:!0,isDepthTested:!1}),h=function(e){function t(i,r,n,o){var s=e.call(this,t.getEdgePointLocation(o,r,n),i,l.getColor("POINT_BODY_COLOR"),l.getNumber("POINT_BODY_SIZE"),o,u)||this;s.parameter=n,s.selectionId=r.selectionId;var h=t.getEdgePointLocation(o,r,n),d=r.getEntityMetaData();if(s.entityMetaData=d.clone(),s.entityMetaData.setBodyMetaData(d.getBodyMetaData()),h){var p=new a.BTEntityPoint;p.point=new Float32Array(3);for(var g=0;g<3;++g)p.point[g]=h[g];s.entityMetaData.geometries=[p]}else if(1===d.geometries.length&&d.geometries[0]instanceof a.BTEntityPoint){var f=d.geometries[0];h=c.vec3.create(f.point),s.entityMetaData.geometries=d.geometries}return s.setStyle(l.getPointFont("POINT_BODY_FONT")),h&&s.show(),s}return(0,r.__extends)(t,e),t.getEdgePointLocation=function(e,t,i){var r,n=null,o=t.getEntityMetaData();if(o&&(r=o.getMeshIncrement()),!r&&o.isFromSketch()&&(r=e.getModelViewManagers().getManager().extractMeshIncrement(t.getDeterministicId())),r){n=c.vec3.create();var s=r.getLinesLength(),a=r.getPositionAtDistanceAlongLines(s*i),l=e.getModelViewManagers().getManager().getDisplayedPartStudio();if(l){var u=void 0;u=o.isFromSketch()?l.getSketchComponent().getTransformForSketchEntity(t.getDeterministicId()):l.getBodyTransform(t.getBodyId(),e),c.mat4.multiplyVec3(u,a,n)}}return n},t.prototype.getModelSelection=function(e){return new o.Selection(a.GBTUiSelectionType.EDGE_POINT,this.selectionId,null,{sourcePick:e.sourcePick,entityMetaData:this.entityMetaData})},t.prototype.getClearModelSelectionsOnPrehilite=function(){return!1},t.prototype.addHighlight=function(e){this.addHighlightToIncrement(n.PointElement.INCREMENT_ID,e),(0,n.requestDraw)()},t.prototype.removeHighlight=function(e){return this.removeHighlightFromIncrement(n.PointElement.INCREMENT_ID,e),(0,n.requestDraw)(),!0},t}(n.PointElement);t.EdgePoint=h},330079:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Element=void 0;var r=i(423902),n=i(311611),o=i(663748),s=i(227441),a=function(e){function t(t){var i=e.call(this)||this;return i.viewer=t,i.cullableBodies=[],i.microversionIdAndConfiguration=null,(0,n.viewerCheck)(t),i}return(0,r.__extends)(t,e),t.prototype.getViewer=function(){return this.viewer},t.prototype.getMicroversionIdAndConfiguration=function(){return this.microversionIdAndConfiguration},t.prototype.getUIElementsForSelection=function(e){return[]},t.prototype.getEntityIdsForSelection=function(e){return[]},t.prototype.getOccurrenceEntityIdsForHighlight=function(e){return[]},t.prototype.getInContextImportEntityIdsForSelection=function(e){return[]},t.prototype.getOccurrencesForSelection=function(e){return[]},t.prototype.callOnChildSelections=function(e,t){var i=[];if(t.childSelections)for(var r=0;r<t.childSelections.length;r++)i=i.concat(e.call(this,t.childSelections[r]));return i},t.prototype.getBoundsOutsideElementNode=function(){return null},t.prototype.getBodyBounds=function(e,t){return null},t.prototype.getBodyComponent=function(e){return null},t.prototype.populateClientCacheStateDisplayInformation=function(e){},t.prototype.checkDuplicatedMicroversionIdAndConfiguration=function(e,t){return!e.find((function(e){return e.equals(t)}))},t.prototype.getElementType=function(){return s.GBTElementType.UNKNOWN},t}(o.BackboneEventsBaseClass);t.Element=a},147864:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ElementPreviewManager=t.ELEMENT_PREVIEW_NODE_ID=void 0;var r=i(311611),n=i(227441);t.ELEMENT_PREVIEW_NODE_ID="elementPreviewManager";var o=function(){function e(e){this.viewer=e,this.DISPLAY_OCCURRENCE_NAME="ElementPreviewManager",this.GROUP_RANGE_GROUP_ID="elementPreviewGroup",this.nodeOccurrenceNames=[],this.nodeOccurenceIds=[],this.node=new r.Node(t.ELEMENT_PREVIEW_NODE_ID),this.meshManager=new r.MeshManager(this.viewer,{bufferAllocationPolicy:r.BufferAllocationPolicy.MAXIMUM}),this.displayOccurrenceId=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.DISPLAY_OCCURRENCE_NAME),this.displayOccurrenceData=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(this.displayOccurrenceId),this.displayOccurrenceData.setLod(r.Lod.DEFAULT),this.meshOwnerId=(0,r.getNewOwnerId)(),this.finalSceneBounds=new r.BoundingBox,this.viewer.getModelViewManagers().getManager().getElementPreviewRootNode(),this.viewer.getModelViewManagers().getManager().getElementPreviewBodyNode().addChild(this.node)}return e.prototype.destroy=function(){this.node.remove();var e=this.viewer.getOccurrenceDataManager();e.destroyOccurrenceData(this.displayOccurrenceId);for(var t=0;t<this.nodeOccurenceIds.length;++t)e.destroyOccurrenceData(this.nodeOccurenceIds[t]);var i=this.viewer.getOccurrenceIdManager();i.removeName(this.DISPLAY_OCCURRENCE_NAME);for(t=0;t<this.nodeOccurrenceNames.length;++t)i.removeName(this.nodeOccurrenceNames[t]);this.meshManager.destroy(),this.finalSceneBounds.reset()},e.prototype.readFloat32Array=function(e){return e?new Float32Array(e.buffer):new Float32Array(0)},e.prototype.readUint32Array=function(e){return e?new Uint32Array(e.buffer):new Uint32Array(0)},e.prototype.readUint16Array=function(e){return e?new Uint16Array(e.buffer):new Uint16Array(0)},e.prototype.processGLDisplayData=function(e){if(e){for(var t=1,i=1,o=e.buffers,s=e.nodes,a=0;a<s.length;++a){var c=new r.Style,l=r.SOLID_FACE_NODE_PROPERTIES.cloneAndModify({isPickable:!1,isHighlightable:!1}),u=s[a],h=u.drawables;if(h&&0!==h.length){var d=h[0],p=d.attributes,g=p.point>-1?o[e.bufferAccessors[p.point].bufferIndex].data:null,f=new Array(0);p.point>-1&&(f=e.bufferAccessors[p.point].glDataType===n.BTGLBufferAccessor.UNSIGNED_SHORT?Array.from(this.readUint16Array(g)):this.readFloat32Array(g));for(var m=p.normal>-1?o[e.bufferAccessors[p.normal].bufferIndex].data:null,y=new Int8Array(m),v=new Float32Array(y.length),E=0;E<v.length;++E)v[E]=y[E]/127;var I=d.indices>-1?o[e.bufferAccessors[d.indices].bufferIndex].data:null,T=this.readUint32Array(I),S=d.appearance.color,P=[S[0]/255,S[1]/255,S[2]/255,d.appearance.opacity/255],_=(0,r.createTriangleStrip)(f,T,v,P),M=this.GROUP_RANGE_GROUP_ID+t,D=this.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(M,this.meshOwnerId,r.PrimitiveType.TRIANGLE_STRIP,r.Lod.DEFAULT);_.id="elementPreviewGraphics_"+t,_.groupId=M,_.lod=r.Lod.DEFAULT,this.meshManager.addMeshIncrement(_,this.meshOwnerId),t+=1;for(var C=0;C<u.transform.length;++C){var O=this.DISPLAY_OCCURRENCE_NAME+i;this.nodeOccurrenceNames.push(O);var A=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.DISPLAY_OCCURRENCE_NAME+i);this.nodeOccurenceIds.push(A);var R=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(A);R.setLod(r.Lod.DEFAULT),R.setTransform(u.transform[C].getGlMatrix()),this.node.addOccurrenceGeometryToNode(l,R,c,D),i+=1}}}this.viewer.getModelViewManagers().getManager().getElementPreviewBodyNode().damageBounds()}},e.prototype.processGLDisplayDataResponse=function(e){if(e&&e.hasGLDisplayData){var t=new n.BTBinaryInputStream(e.glDisplayDataBytes).readMessage();t.finalSceneBounds&&(this.finalSceneBounds.addPoint(t.finalSceneBounds.minCorner.getVec3()),this.finalSceneBounds.addPoint(t.finalSceneBounds.maxCorner.getVec3())),this.processGLDisplayData(t)}},e.prototype.getModelBounds=function(){if(this.finalSceneBounds&&this.finalSceneBounds.isInitialized()&&this.finalSceneBounds.isExtensive())return this.finalSceneBounds;var e=new r.BoundingBox,t=this.viewer.getModelViewManagers().getManager().getElementPreviewBodyNode();return t&&e.addBox(t.getBoundingBox()),e},e}();t.ElementPreviewManager=o},480214:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorComponent=void 0;var r=i(423902),n=function(e){function t(t,i){return e.call(this,t,i)||this}return(0,r.__extends)(t,e),t.prototype.getComponentId=function(){return"error_component."},t.prototype.handlesEntity=function(e,t){return e.hasTessellationError()&&!this.viewer.getIsForFlattenedDisplay()},t.prototype.expectsTessellation=function(){return!1},t.prototype.removeBaseIncrement=function(e){},t.prototype.updateEntityGraphics=function(e,t,i){},t.prototype.getHideableFeatureIds=function(){return[]},t}(i(311611).PartStudioComponent);t.ErrorComponent=n},195218:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createManipulator=t.TriadFeatureManipulator=t.PointsFeatureManipulator=t.Flip=t.AngularFeatureManipulator=t.Linear1d=t.FeatureManipulator=void 0;var r=i(423902),n=i(663748),o=i(73055),s=i(911748),a=i(311517),c=i(227441),l=i(376931),u=i(970846),h=i(925300),d=i(564219),p=i(311611),g=o.default.getManager(),f=1,m=s.vec3.createFrom(1,0,0),y=s.vec3.createFrom(0,1,0),v=s.vec3.createFrom(0,0,1),E=function(e){function t(t){var i=e.call(this)||this;return i.viewer=t,i.dragManipulator=null,i.lockedManipulator=null,i.sequenceId=0,(0,p.viewerCheck)(t),i}return(0,r.__extends)(t,e),t.prototype.remove=function(){this.stopListening(),this.removeGraphicsManipulator()},t.prototype.removeGraphicsManipulator=function(){this.dragManipulator&&(this.dragManipulator.remove(),this.dragManipulator=null),this.lockedManipulator&&(this.lockedManipulator.remove(),this.lockedManipulator=null)},t.prototype.getManipulatorId=function(){return this.manipulatorData?this.manipulatorData.manipulatorId:""},t.prototype.removeGraphicsManipulatorIfCannotBeDisplayed=function(){return!(0,p.canPointBeDisplayed)(this.manipulatorData.getDisplayLocation())&&(this.removeGraphicsManipulator(),a.log.info("Did not display feature manipulator(s), likely because it was out of bounds."),!0)},t.prototype.setManipulatorData=function(e){this.manipulatorData=e,this.removeGraphicsManipulatorIfCannotBeDisplayed()||(this.dragManipulator&&this.dragManipulator.isBeingManipulated()?this.updateLockedManipulator():this.updateDragManipulator())},t.prototype.updateDragManipulator=function(){},t.prototype.updateLockedManipulator=function(){},t.prototype.sendValue=function(e,t){this.manipulatorData&&this.trigger(u.FeatureManipulatorEvents.VALUE_CHANGED,this.manipulatorData.manipulatorId,e,this.sequenceId,!!t)},t.prototype.onManipulationStarted=function(){this.sequenceId=f++,this.trigger(u.FeatureManipulatorEvents.MANIPULATION_STARTED,this.manipulatorData.manipulatorId,this.sequenceId,this.manipulatorData.primaryParameterId)},t.prototype.onManipulationEnded=function(){this.lockedManipulator&&(this.lockedManipulator.remove(),this.lockedManipulator=null),this.trigger(u.FeatureManipulatorEvents.MANIPULATION_ENDED,this.manipulatorData.manipulatorId,this.sequenceId,this.manipulatorData.primaryParameterId)},t.prototype.sendValueWithNoDrag=function(e){this.onManipulationStarted(),this.sendValue(e,!0),this.onManipulationEnded()},t.prototype.computeCenterOfOccurrenceBounds=function(e,t){var i=0,r=s.vec3.create();return e.forEach((function(e){var n=c.BTOccurrence.getOccurrenceFromPathString(e),o=t.getOccurrenceBounds(n),a=null;o&&o.isFinite()&&(a=o.center(),s.vec3.add(a,r,r),++i)})),i<1?null:(i>1&&(r=s.vec3.scale(r,1/i)),r)},t}(n.BackboneEventsBaseClass);t.FeatureManipulator=E;var I=function(e){function t(t){var i=e.call(this,t)||this;return i.dragManipulator=null,i.lockedManipulator=null,i.manipulatorData=null,i.cachedBaseOccurrenceTransform=null,i}return(0,r.__extends)(t,e),t.prototype.isManipulatorInGlobalCoordinateSystem=function(e){return!e.useCenterOfBoundsOfSourceIds&&(null===e.baseOccurrencePath||0===e.baseOccurrencePath.length)},t.prototype.convertLocalToWorldManipulatorData=function(e){if(this.isManipulatorInGlobalCoordinateSystem(e))return e;var t=e.clone(),i=(0,p.getActiveViewer)();if(!i)return e;var r=i.getModelViewManagers().getManager();if(!r)return e;if(!c.BTOccurrence.getOccurrenceFromPathString(e.baseOccurrencePath))return e;if(0===e.sourceIds.length)return e;var n=i.getOccurrenceIdManager().getIdForName(e.baseOccurrencePath);if(n===d.INVALID_OCCURRENCE_ID)return e;var o=this.viewer.getOccurrenceDataManager().getOccurrenceTransform(n),a=new c.BTVector3d,l=s.mat4.toMat3(o,s.mat3.create()),u=s.mat3.multiplyVec3(l,e.direction.getVec3(),s.vec3.create());u=s.vec3.normalize(u,s.vec3.create()),a.updateFromArray(u),t.direction=a;var h=new c.BTVector3d,g=this.computeCenterOfOccurrenceBounds(e.sourceIds,r);return g&&(h.updateFromArray(g),t.base=h),t},t.prototype.updateManipulatorFromDefinition=function(e){if(e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData))e.updateDefinition(this.manipulatorData.base.getVec3(),this.manipulatorData.direction.getVec3(),this.manipulatorData.getValue().offset);else{var t=this.cachedBaseOccurrenceTransform?this.cachedBaseOccurrenceTransform:this.convertLocalToWorldManipulatorData(this.manipulatorData);if(this.cachedBaseOccurrenceTransform)e.updateDefinition(t.base.getVec3(),t.direction.getVec3(),this.manipulatorData.getValue().offset);else{var i=this.manipulatorData.getValue().offset<0;e.updateDefinitionForLocalManipulatorAtRest(t.base.getVec3(),t.direction.getVec3(),i)}}e.updateLimits(this.manipulatorData.minValue,this.manipulatorData.maxValue)},t.prototype.setManipulatorData=function(e){this.manipulatorData=e,this.removeGraphicsManipulatorIfCannotBeDisplayed()||(!this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)&&this.dragManipulator||this.updateDragManipulator(),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)&&this.dragManipulator&&this.dragManipulator.isBeingManipulated()&&this.updateLockedManipulator())},t.prototype.onManipulationStarted=function(){e.prototype.onManipulationStarted.call(this),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)||(this.cachedBaseOccurrenceTransform=this.convertLocalToWorldManipulatorData(this.manipulatorData))},t.prototype.onManipulationEnded=function(){e.prototype.onManipulationEnded.call(this),this.cachedBaseOccurrenceTransform&&(this.cachedBaseOccurrenceTransform=null,this.updateManipulatorFromDefinition(this.dragManipulator))},t.prototype.updateDragManipulator=function(){this.dragManipulator||(this.dragManipulator=new p.Linear(this.viewer),this.dragManipulator.setFlipDirectionWhenNegative(!0),this.listenTo(this.dragManipulator,u.ManipulatorEvents.VALUE_CHANGED,this.onManipulatorValueChanged),this.listenTo(this.dragManipulator,u.ManipulatorEvents.VALUE_EDITED,this.onManipulatorValueEdited),this.listenTo(this.dragManipulator,u.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.dragManipulator,u.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.dragManipulator,u.ManipulatorEvents.CLICKED,this.onManipulatorFlipped)),this.updateManipulatorFromDefinition(this.dragManipulator)},t.prototype.updateLockedManipulator=function(){this.lockedManipulator||(this.lockedManipulator=new p.Linear(this.viewer),this.lockedManipulator.setFlipDirectionWhenNegative(!0),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)},t.prototype.onManipulatorValueChanged=function(){if(this.dragManipulator){var e=new c.BTManipulatorValueLinear1d;e.offset=this.dragManipulator.getOffset(),this.sendValue(e)}},t.prototype.onManipulatorValueEdited=function(){if(this.dragManipulator){var e=new c.BTManipulatorValueLinear1d;e.offset=this.dragManipulator.getEditOffset(),this.sendValueWithNoDrag(e)}},t.prototype.onManipulatorFlipped=function(){if(this.dragManipulator){var e=-this.manipulatorData.getValue().offset;if(!(e<this.manipulatorData.minValue||e>this.manipulatorData.maxValue)){var t=new c.BTManipulatorValueLinear1d;t.offset=e,this.sendValueWithNoDrag(t);var i=this.manipulatorData.getValue();i.offset=-i.offset,this.updateDragManipulator(),this.viewer.doPreHighlightPick()}}},t}(E);t.Linear1d=I;var T=function(e){function t(t){var i=e.call(this,t)||this;return i.dragManipulator=null,i.lockedManipulator=null,i.manipulatorData=null,i.cachedManipulatorData=null,i}return(0,r.__extends)(t,e),t.prototype.setManipulatorData=function(e){this.manipulatorData=e,this.removeGraphicsManipulatorIfCannotBeDisplayed()||(this.updateDragManipulator(),this.dragManipulator&&this.dragManipulator.isBeingManipulated()&&this.updateLockedManipulator())},t.prototype.isManipulatorInGlobalCoordinateSystem=function(e){return!e.useCenterOfBoundsOfSourceIds&&(null===e.baseOccurrencePath||0===e.baseOccurrencePath.length)},t.prototype.convertLocalToWorldManipulatorData=function(e){if(this.isManipulatorInGlobalCoordinateSystem(e))return e;var t=(0,p.getActiveViewer)();if(!t)return e;var i=t.getModelViewManagers().getManager();if(!i)return e;if(!c.BTOccurrence.getOccurrenceFromPathString(e.baseOccurrencePath))return e;if(0===e.sourceIds.length)return e;var r=t.getOccurrenceIdManager().getIdForName(e.baseOccurrencePath);if(r===d.INVALID_OCCURRENCE_ID)return e;var n=this.viewer.getOccurrenceDataManager().getOccurrenceTransform(r),o=s.mat4.toMat3(n,s.mat3.create()),a=e.axisDirection.getVec3(),u=s.mat3.multiplyVec3(o,a,s.vec3.create());s.vec3.normalize(u);var h=e.clone();h.axisDirection.updateFromArray(u);var g=this.computeCenterOfOccurrenceBounds(e.sourceIds,i);if(!g)return e;var f=null,m=s.mat4.multiplyVec3(n,e.axisOrigin.getVec3(),s.vec3.create()),y=s.vec3.subtract(g,m,s.vec3.create()),v=(0,l.areUnitVectorsParallel)(s.vec3.normalize(y,s.vec3.create()),u);if((0,l.arePointsCoincident)(m,g)||v){f=this.getVectorNormalTo(a);s.vec3.scale(f,.01),f=s.mat3.multiplyVec3(o,f,s.vec3.create()),h.axisOrigin.updateFromArray(g),m=g}else{var E=s.vec3.dot(y,u),I=s.vec3.add(m,s.vec3.scale(u,E,s.vec3.create()));h.axisOrigin.updateFromArray(I),f=s.vec3.subtract(g,I,s.vec3.create())}if(f){var T=s.quat4.toMat4(s.quat4.fromAngleAxis(-e.getValue().angle,u),s.mat4.create());f=s.mat4.multiplyVec3(T,f);var S=s.vec3.add(f,m,s.vec3.create());h.rotationOrigin.updateFromArray(S)}return h},t.prototype.getVectorNormalTo=function(e){return(0,l.areUnitVectorsParallel)(m,e)?s.vec3.create(y):(0,l.areUnitVectorsParallel)(y,e)?s.vec3.create(v):(0,l.areUnitVectorsParallel)(v,e)?s.vec3.create(m):s.vec3.normalize(s.vec3.getAPerpendicularVector(e))},t.prototype.updateManipulatorFromDefinition=function(e){if(this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)){var t=s.vec3.subtract(this.manipulatorData.rotationOrigin.getVec3(),this.manipulatorData.axisOrigin.getVec3(),s.vec3.create()),i=s.vec3.length(t);s.vec3.normalize(t),e.setId(this.manipulatorData.manipulatorId),e.updateDefinition(this.manipulatorData.axisOrigin.getVec3(),this.manipulatorData.axisDirection.getVec3(),t,i,this.manipulatorData.getValue().angle),e.updateLimits(this.manipulatorData.minValue,this.manipulatorData.maxValue),e.setStyle(this.manipulatorData.style),e.setDisableMinimumOffset(this.manipulatorData.disableMinimumOffset)}else{var r=this.cachedManipulatorData?this.cachedManipulatorData:this.convertLocalToWorldManipulatorData(this.manipulatorData);t=s.vec3.subtract(r.rotationOrigin.getVec3(),r.axisOrigin.getVec3(),s.vec3.create()),i=s.vec3.length(t);s.vec3.normalize(t),e.setId(r.manipulatorId),e.updateDefinition(r.axisOrigin.getVec3(),r.axisDirection.getVec3(),t,i,r.getValue().angle),e.updateLimits(r.minValue,r.maxValue),e.setStyle(r.style),e.setDisableMinimumOffset(r.disableMinimumOffset)}},t.prototype.createManipulator=function(){return this.manipulatorData.style===c.GBTManipulatorStyleEnum.SIMPLE?new p.Angular(this.viewer):new p.AngularWithArrow(this.viewer)},t.prototype.updateDragManipulator=function(){this.dragManipulator||(this.dragManipulator=this.createManipulator(),this.listenTo(this.dragManipulator,u.ManipulatorEvents.VALUE_CHANGED,this.onManipulatorValueChanged),this.listenTo(this.dragManipulator,u.ManipulatorEvents.VALUE_EDITED,this.onManipulatorValueEdited),this.listenTo(this.dragManipulator,u.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.dragManipulator,u.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.dragManipulator,u.ManipulatorEvents.CLICKED,this.onManipulatorFlipped)),this.updateManipulatorFromDefinition(this.dragManipulator)},t.prototype.updateLockedManipulator=function(){this.lockedManipulator||(this.lockedManipulator=this.createManipulator(),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)},t.prototype.onManipulationStarted=function(){e.prototype.onManipulationStarted.call(this),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)||(this.cachedManipulatorData=this.convertLocalToWorldManipulatorData(this.manipulatorData))},t.prototype.onManipulationEnded=function(){e.prototype.onManipulationEnded.call(this),this.cachedManipulatorData&&(this.cachedManipulatorData=null,this.updateManipulatorFromDefinition(this.dragManipulator))},t.prototype.onManipulatorValueChanged=function(){if(this.dragManipulator){var e=new c.BTManipulatorValueAngular;e.angle=this.dragManipulator.getAngle(),this.sendValue(e)}},t.prototype.onManipulatorValueEdited=function(){if(this.dragManipulator){var e=new c.BTManipulatorValueAngular;e.angle=this.dragManipulator.getAngle(),this.sendValueWithNoDrag(e)}},t.prototype.onManipulatorFlipped=function(){if(this.dragManipulator&&!(this.manipulatorData.minValue*this.manipulatorData.maxValue>=0)){var e=new c.BTManipulatorValueAngular;e.angle=-this.manipulatorData.getValue().angle,this.sendValueWithNoDrag(e);var t=this.manipulatorData.getValue();t.angle=-t.angle,this.updateDragManipulator(),this.viewer.doPreHighlightPick()}},t}(E);t.AngularFeatureManipulator=T;var S=function(e){function t(t){var i=e.call(this,t)||this;return i.dragManipulator=null,i.lockedManipulator=null,i.manipulatorData=null,i}return(0,r.__extends)(t,e),t.prototype.updateManipulatorFromDefinition=function(e){var t=this.manipulatorData.direction.getVec3();if(this.manipulatorData.getValue().flipped){var i=this.manipulatorData.otherDirection.getVec3();s.vec3.length(i)>0?t=i:s.vec3.scale(t,-1)}e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),e.updateDefinition(this.manipulatorData.base.getVec3(),t,0)},t.prototype.updateDragManipulator=function(){this.dragManipulator||(this.dragManipulator=new p.Linear(this.viewer),this.dragManipulator.setShaftLength(g.getNumber("MANIPULATOR_FLIP_SHAFT_LENGTH_PX")),this.dragManipulator.setIsDraggable(!1),this.listenTo(this.dragManipulator,u.ManipulatorEvents.CLICKED,this.onManipulatorFlipped)),this.updateManipulatorFromDefinition(this.dragManipulator)},t.prototype.updateLockedManipulator=function(){this.lockedManipulator||(this.lockedManipulator=new p.Linear(this.viewer),this.lockedManipulator.setShaftLength(g.getNumber("MANIPULATOR_FLIP_SHAFT_LENGTH_PX")),this.dragManipulator.setIsDraggable(!1),this.lockedManipulator.setFlipDirectionWhenNegative(!0),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)},t.prototype.onManipulatorFlipped=function(){if(this.dragManipulator){var e=new c.BTManipulatorValueFlip;e.flipped=!this.manipulatorData.getValue().flipped,this.sendValueWithNoDrag(e);var t=this.manipulatorData.getValue();t.flipped=!t.flipped,this.updateDragManipulator(),this.viewer.doPreHighlightPick()}},t}(E);t.Flip=S;var P=function(e){function t(t){var i=e.call(this,t)||this;return i.manipulatorData=null,i.dragManipulator=null,i}return(0,r.__extends)(t,e),t.prototype.updateManipulatorFromDefinition=function(e){for(var t=this.manipulatorData.points,i=[],r=0;r<t.length;r++)i[r]=s.vec3.createFrom(t[r].x,t[r].y,t[r].z);e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),e.updateDefinition(i,this.manipulatorData.getValue().index)},t.prototype.updateDragManipulator=function(){this.dragManipulator||(this.dragManipulator=new p.PointSelection(this.viewer),this.listenTo(this.dragManipulator,u.ManipulatorEvents.VALUE_CHANGED,this.onManipulatorValueChanged)),this.updateManipulatorFromDefinition(this.dragManipulator)},t.prototype.onManipulatorValueChanged=function(e){var t=new c.BTManipulatorValuePoints;t.index=e,this.sendValueWithNoDrag(t)},t}(E);t.PointsFeatureManipulator=P;var _=function(e){function t(t,i){var r=e.call(this,i)||this;return r.dragManipulator=null,r.lockedManipulator=null,r.manipulatorData=null,r.dragStart=t.getValue().offset.getVec3(),r}return(0,r.__extends)(t,e),t.prototype.updateManipulatorFromDefinition=function(e){var t=this.manipulatorData.base,i=this.manipulatorData.getValue().offset,r=s.mat4.identity();r[12]=i.x+t.x,r[13]=i.y+t.y,r[14]=i.z+t.z,e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),e.updateDefinition(r)},t.prototype.updateDragManipulator=function(){if(!this.dragManipulator){this.dragManipulator=new p.Triad(this.viewer,u.TriadManipulatorType.DRAG,{displayEditView:!1}),this.dragManipulator.setDisableInactiveComponents(!0),this.listenTo(this.dragManipulator,u.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.dragManipulator,u.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.dragManipulator,h.TriadEvents.TRANSLATION_START,this.translationStart),this.listenTo(this.dragManipulator,h.TriadEvents.TRANSLATION_CHANGE,this.translationChange),this.listenTo(this.dragManipulator,h.TriadEvents.TRANSLATION_END,this.translationEnd)}this.dragStart=this.manipulatorData.getValue().offset.getVec3(),this.updateManipulatorFromDefinition(this.dragManipulator)},t.prototype.updateLockedManipulator=function(){this.lockedManipulator||(this.lockedManipulator=new p.Triad(this.viewer,u.TriadManipulatorType.DRAG),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)},t.prototype.translationStart=function(){this.dragManipulator.isDragging=!0},t.prototype.translationChange=function(e){if(this.dragManipulator){var t=new c.BTManipulatorValueTriad;t.offset=new c.BTVector3d,t.offset.x=e[0]+this.dragStart[0],t.offset.y=e[1]+this.dragStart[1],t.offset.z=e[2]+this.dragStart[2],this.sendValue(t)}},t.prototype.translationEnd=function(){this.dragManipulator.isDragging=!1},t}(E);t.TriadFeatureManipulator=_,t.createManipulator=function(e,t){return e instanceof c.BTManipulatorLinear1d?new I(t):e instanceof c.BTManipulatorAngular?new T(t):e instanceof c.BTManipulatorFlip?new S(t):e instanceof c.BTManipulatorTriad?new _(e,t):e instanceof c.BTManipulatorPoints?new P(t):null}},269881:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageComponent=void 0;var r=i(423902),n=i(911748),o=i(103726),s=i(513774),a=i(997862),c=i(311611),l=function(){function e(e,t){this.viewer=t,(0,c.viewerCheck)(t),this.imageData=new s.TemplatedNestedMap,this.imageDisplays=new s.TemplatedNestedMap,this.activeSketchIds=new a.StringSet,this.hiddenSketchIds=new a.StringSet,this.usage=e||c.bt_graphics_Usage.BASE}return e.prototype.processDisplayData=function(e){this.imageDisplays.eachNested((function(t,i,r){var n=this.imageDisplays.getNested(i,r);if(n){if(e.sketchImages.hasOwnProperty(i)&&e.sketchImages[i].hasOwnProperty(r)){var s=e.sketchImages[i][r];if((0,o.updateUriWithWorkspaceId)(s.sourceId)===n.url&&s.isOnFlat===n.isOnFlat)return}return n.remove(),this.imageDisplays.removeNested(i,r),!1}}),this),this.imageData.clear(),Object.entries(e.sketchImages).forEach((function(e){var t=(0,r.__read)(e,2),i=t[0],n=t[1];Object.entries(n).forEach((function(e){var t=(0,r.__read)(e,2),n=t[0],o=t[1];this.viewer.getIsForFlattenedDisplay()===o.isOnFlat&&this.imageData.insertNested(i,n,o)}),this)}),this)},e.prototype.reset=function(){this.remove(),this.imageData.clear()},e.prototype.remove=function(){this.imageDisplays.eachNested((function(e){return e.remove(),!1}),this),this.imageDisplays.clear()},e.prototype.showPartsWithSheetmetalModelIdOnly=function(e){var t=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();this.imageData.eachNested((function(i,r,n){var o=this.imageDisplays.getNested(r,n);if(o){if(t&&i.isOnFlat){var s=t.getSketchComponent().getSMModelIdForSketch(i.featureId);e!==s||this.hiddenSketchIds.contains(i.featureId)?o.hide():(o.updateImage(i.sourceId,i.bottomLeftCorner.getVec3(),i.bottomRightCorner.getVec3(),i.topLeftCorner.getVec3()),o.show())}return!1}}),this)},e.prototype.updateDisplays=function(){var e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();this.imageData.eachNested((function(t,i,r){var o=this.imageDisplays.getNested(i,r),s=n.mat4.identity(),a="";if(e&&t.isOnFlat&&(a=e.getSketchComponent().getOwnerFlattenedBodyIdForSketch(t.featureId))){var l=e.retrieveBodyMetaData(a);l&&(s=e.getBodyComponent().getTransformFromSheetMetalBodyMetaData(l))}if(o)o.isHidden||(o.isOnFlat=t.isOnFlat,o.flattenedBodyId=a,o.transform=s,o.updateImage(t.sourceId,t.bottomLeftCorner.getVec3(),t.bottomRightCorner.getVec3(),t.topLeftCorner.getVec3()));else{var u=new c.ImageDisplay(r,t.sourceId,t.bottomLeftCorner.getVec3(),t.bottomRightCorner.getVec3(),t.topLeftCorner.getVec3(),null,this.usage,this.viewer,t.isOnFlat,a,s);this.activeSketchIds.contains(i)?u.activate():this.hiddenSketchIds.contains(i)&&u.hide(),this.imageDisplays.insertNested(i,r,u)}return!1}),this)},e.prototype.onSketchHidden=function(e){this.hiddenSketchIds.add(e),this.imageDisplays.eachNested((function(t,i){var r=i.split(".");return e===r[0]&&t.hide(),!1}),this)},e.prototype.onSketchShown=function(e){this.hiddenSketchIds.remove(e),this.imageDisplays.eachNested((function(t,i,r){var n=i.split(".");if(e===n[0]){var o=!0;if(t.isOnFlat){o=!1;var s=this.viewer.getModelViewManagers().getManager(),a=s.getSelectedSheetmetalModelId();if(a){var c=s.getDisplayedPartStudio();if(c){var l=c.retrieveBodyMetaData(t.flattenedBodyId);l&&(o=a===l.sheetMetalModelId)}}}if(o){var u=this.imageData.getNested(i,r);u&&(t.updateImage(u.sourceId,u.bottomLeftCorner.getVec3(),u.bottomRightCorner.getVec3(),u.topLeftCorner.getVec3()),t.show())}}return!1}),this)},e.prototype.onSketchActivated=function(e){this.activeSketchIds.contains(e)||(this.imageDisplays.has(e)&&this.imageDisplays.get(e).each((function(e,t){return e.activate(),!1}),this),this.activeSketchIds.add(e))},e.prototype.onSketchDeactivated=function(e){this.activeSketchIds.contains(e)&&(this.imageDisplays.has(e)&&this.imageDisplays.get(e).each((function(e,t){return e.deactivate(),!1}),this),this.activeSketchIds.remove(e))},e.prototype.cloneForUsage=function(t){var i=new e(t,this.viewer);return this.imageData.eachNested((function(e,t,r){return i.imageData.insertNested(t,r,e),!1}),this),t===c.bt_graphics_Usage.PREVIEW&&this.imageDisplays.eachNested((function(e,t,r){return i.imageDisplays.insertNested(t,r,e.cloneForPreview()),!1}),this),i},e}();t.ImageComponent=l},82567:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateMateConnectorSelectedColor=t.getStaticIncrements=t.MateConnector=t.IncrementId=t.HIGHLIGHTED_TRIANGLE_PROPERTIES=t.TRIANGLE_PROPERTIES=t.INFERENCE_TRIANGLE_PROPERTIES=t.HIGHLIGHTED_LINE_PROPERTIES=t.INFERENCE_LINE_PROPERTIES=t.LINE_PROPERTIES=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(194598),a=i(712197),c=i(227441),l=i(441716),u=i(673290),h=i(311611),d=n.default.getManager(),p=new h.NodeProperties({primitiveType:h.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,isPickable:!1});t.LINE_PROPERTIES=p.cloneAndModify({includedInBlend:!0}),t.INFERENCE_LINE_PROPERTIES=p.cloneAndModify({priority:h.RenderOrderPriority.HIGHER}),t.HIGHLIGHTED_LINE_PROPERTIES=p.cloneAndModify({priority:h.RenderOrderPriority.HIGHEST});var g=new h.NodeProperties({primitiveType:h.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,isPickable:!1,zOffset:d.getNumber("MATE_CONNECTOR_TRIANGLE_Z_OFFSET"),primitivesHaveTransparency:!0,material:h.UNLIT_COLOR_FROM_ATTRIBUTE});t.INFERENCE_TRIANGLE_PROPERTIES=g.cloneAndModify({priority:h.RenderOrderPriority.HIGHER}),t.TRIANGLE_PROPERTIES=g.cloneAndModify({includedInBlend:!0}),t.HIGHLIGHTED_TRIANGLE_PROPERTIES=g.cloneAndModify({priority:h.RenderOrderPriority.HIGHEST});var f,m=new h.NodeProperties({primitiveType:h.PrimitiveType.TRIANGLES,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,isVisible:!1});!function(e){e.LINES="lines",e.LINES_FADED="lines_faded",e.TRIANGLES="triangles",e.COMPARE_BASE_TRIANGLES="compare_base_triangles",e.COMPARE_TARGET_TRIANGLES="compare_target_triangles",e.TRIANGLES_PRESELECTED="triangles_preselected",e.TRIANGLES_SELECTED="triangles_selected",e.TRIANGLES_FADED="triangles_faded",e.PICK_DISC="pick_disc",e.INFERENCE_POINT_TRIANGLES="inference_point_triangles",e.INFERENCE_POINT_LINES="inference_point_lines",e.INFERENCE_CENTER_TRIANGLES="inference_center_triangles",e.INFERENCE_CENTER_LINES="inference_center_lines",e.INFERENCE_CENTROID_TRIANGLES="inference_centroid_triangles",e.INFERENCE_CENTROID_LINES="inference_centroid_lines",e.INFERENCE_MID_POINT_TRIANGLES="inference_mid_point_triangles",e.INFERENCE_MID_POINT_LINES="inference_mid_point_lines",e.INFERENCE_ORIGIN_AXIS_LINES="inference_origin_axis_lines",e.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED="inference_origin_axis_lines_preselected"}(f=t.IncrementId||(t.IncrementId={}));var y=null,v=!0,E=function(e){function i(t,i,r,n){var s=e.call(this,r,i)||this;return s.definition=t,s.isBeingEdited=!1,s.lastScale=-1,s.worldSpacePosition=[0,0,0],s.activeMateConnectorScaled=!1,s.partStudioFeatureId=n||"",s.isPartStudioMateConnector=!!s.partStudioFeatureId,s.occurrenceTransform=o.mat4.identity(),s.parentOccurrenceVisibility=h.Visibility.VISIBLE,s.usage=i===h.PREVIEW_SCENEGRAPH_ID?h.bt_graphics_Usage.PREVIEW:h.bt_graphics_Usage.BASE,s.damageTransform(),s.updateHideState(),s.occurrenceData.setCanIsolateChange(!0),s.occurrenceData.setIsolated(!1),s}return(0,r.__extends)(i,e),i.prototype.cloneForPreview=function(){return new i(this.definition,h.PREVIEW_SCENEGRAPH_ID,this.viewer,this.partStudioFeatureId)},i.prototype.getUsage=function(){return this.usage},i.prototype.getWorldSpacePosition=function(){return this.worldSpacePosition},i.prototype.onDevicePixelRatioChanged=function(e){y=null,this.updateGraphics()},i.prototype.getIsPartStudioMateConnector=function(){return this.isPartStudioMateConnector},i.prototype.getId=function(){return(0,l.createOccurrenceNodeId)(this.definition.ownerOccurrence,this.definition.nodeId)},i.prototype.setOccurrenceTransform=function(e){this.occurrenceTransform=e,this.damageTransform()},i.prototype.setEditState=function(e){this.isBeingEdited=e,this.updateHideState(),this.updateGraphics()},i.prototype.getDefinition=function(){return this.definition?this.definition:null},i.prototype.updateDefinition=function(e){this.definition=e,this.updateHideState(),this.damageTransform()},i.prototype.damageTransform=function(){this.lastScale=-1,this.definition&&o.mat4.multiplyVec3(this.occurrenceTransform,this.definition.location.origin.getVec3(),this.worldSpacePosition),this.viewer.requestDraw()},i.prototype.getWorldSpaceDefinition=function(){if(!this.definition)return null;var e=new c.BTCoordinateSystem,t=this.definition.location.xAxis.getVec3(),i=this.definition.location.yAxis.getVec3(),r=this.definition.location.zAxis.getVec3(),n=this.definition.location.origin.getVec3(),s=o.mat4.toRotationMat(this.occurrenceTransform,o.mat4.create());return o.mat4.multiplyVec3(this.occurrenceTransform,n),o.mat4.multiplyVec3(s,t),o.mat4.multiplyVec3(s,i),o.mat4.multiplyVec3(s,r),e.xAxis.updateFromArray(t),e.yAxis.updateFromArray(i),e.zAxis.updateFromArray(r),e.origin.updateFromArray(n),e},i.prototype.canPickThrough=function(){return!0},i.prototype.getPickPriority=function(){return h.PickPriority.MATE_CONNECTOR},i.prototype.getModelSelection=function(e){return!this.definition||this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated()?null:new a.Selection(c.GBTUiSelectionType.MATE_CONNECTOR,this.definition.nodeId,this.definition.ownerOccurrence,{sourcePick:e.sourcePick,isPartStudioMateConnector:this.isPartStudioMateConnector,isDerivedFeature:this.definition.isDerivedFeature})},i.prototype.addHighlight=function(t){e.prototype.addHighlight.call(this,t),this.updateHideState(),this.updateGraphics()},i.prototype.removeHighlight=function(t){return!!e.prototype.removeHighlight.call(this,t)&&(this.updateHideState(),this.updateGraphics(),!0)},i.prototype.getUserVisibilitySetting=function(){return this.definition.hidden?h.Visibility.HIDDEN:h.Visibility.VISIBLE},i.prototype.updateOccurrenceVisibility=function(e){e!==this.parentOccurrenceVisibility&&(this.parentOccurrenceVisibility=e,this.updateHideState(),this.updateGraphics())},i.prototype.updateHideState=function(){this.isBeingEdited||this.isHighlighted()||this.getUserVisibilitySetting()!==h.Visibility.HIDDEN&&this.parentOccurrenceVisibility!==h.Visibility.HIDDEN?(this.hasMeshIncrements()||this.updateGraphics(!0),this.show()):this.hide()},i.prototype.setOpacity=function(e){var i=I(),r=d.getColor("MATE_CONNECTOR_COLOR");r[3]=e,(0,h.addColorToIncrement)(r,i[f.TRIANGLES_FADED]),this.updateMeshIncrement(f.TRIANGLES,h.NO_SELECTION_ID,i[f.TRIANGLES_FADED].clone(),t.TRIANGLE_PROPERTIES),this.setLineOpacity(e,t.LINE_PROPERTIES)},i.prototype.onIsolateRemoved=function(){this.updateGraphics()},i.prototype.updateIsolation=function(){var e=I();if(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated()){var t=d.getNumber("ISOLATE_CONTEXT_UI_TRANSPARENCY")*(0,h.getTransparencyTransition)()+(1-(0,h.getTransparencyTransition)());this.setOpacity(t)}else this.updateBaseIncrements(e)},i.prototype.updateBaseIncrements=function(e){var i=f.TRIANGLES,r=(0,h.isUsageCompare)(),n=!!r&&(s.btInjector.PartStudioCompareService.isPartStudioComparisonReady()&&s.btInjector.PartStudioCompareService.doesFeatureHaveADifference(this.partStudioFeatureId));r&&n&&(i=this.sceneGraphId===h.MAIN_SCENEGRAPH_ID?f.COMPARE_BASE_TRIANGLES:f.COMPARE_TARGET_TRIANGLES),this.updateMeshIncrement(f.TRIANGLES,h.NO_SELECTION_ID,e[i].clone(),t.TRIANGLE_PROPERTIES),this.setLineOpacity(1,t.LINE_PROPERTIES),this.updateMeshIncrement(f.LINES,h.NO_SELECTION_ID,e[f.LINES].clone(),t.LINE_PROPERTIES)},i.prototype.setLineOpacity=function(e,t){var i=I(),r=(0,h.setIncrementOpacity)(i[f.LINES_FADED],e);this.updateMeshIncrement(f.LINES,h.NO_SELECTION_ID,r.clone(),t)},i.prototype.adjustTransform=function(e){if(this.definition&&!this.isHidden){var t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition),i=this.getIsActiveMateConnector();if(this.activeMateConnectorScaled&&!i&&(this.activeMateConnectorScaled=!1,this.lastScale=-1),!(Math.abs(this.lastScale-t)<u.Tolerances.ZERO_LENGTH)){this.lastScale=t,i&&(t*=d.getNumber("ACTIVE_MATE_CONNECTOR_SIZE_SCALE_PERCENT"),this.activeMateConnectorScaled=!0);var r=o.mat4.identity();r[0]=t,r[5]=t,r[10]=t,this.setTransform(o.mat4.multiply(o.mat4.multiply(this.occurrenceTransform,this.definition.location.getGlMatrix(),o.mat4.create()),r)),this.hasMeshIncrements()||this.updateGraphics()}}},i.prototype.getIsActiveMateConnector=function(){var e=this.viewer.getMateConnectorManager();return!!e&&e.isMateConnectorActive(this.getId(),this)},i.prototype.onViewWillDraw=function(e){this.isHidden||this.hasBeenRemoved||(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&this.updateGraphics(),this.adjustTransform(e))},i.prototype.onHighlightColorUpdated=function(){this.isHighlighted()&&this.updateGraphics()},i.prototype.updateGraphics=function(e){if(!this.definition||this.isHidden&&!e)this.removeMeshIncrements();else{var i=I();this.updateMeshIncrement(f.PICK_DISC,"mateconnector",i[f.PICK_DISC].clone(),m);var r=this.getHighlight();r&&r.type===h.HighlightType.PRE?(this.updateMeshIncrement(f.TRIANGLES,h.NO_SELECTION_ID,i[f.TRIANGLES_PRESELECTED].clone(),t.HIGHLIGHTED_TRIANGLE_PROPERTIES),this.updateMeshIncrement(f.LINES,h.NO_SELECTION_ID,i[f.LINES].clone(),t.HIGHLIGHTED_LINE_PROPERTIES)):r?(this.updateMeshIncrement(f.TRIANGLES,h.NO_SELECTION_ID,i[f.TRIANGLES_SELECTED].clone(),t.HIGHLIGHTED_TRIANGLE_PROPERTIES),this.updateMeshIncrement(f.LINES,h.NO_SELECTION_ID,i[f.LINES].clone(),t.HIGHLIGHTED_LINE_PROPERTIES),this.muteIfActive()):(this.updateBaseIncrements(i),this.updateIsolation(),this.muteIfActive())}},i.prototype.muteIfActive=function(){if(!this.hasBeenRemoved){var e=this.getIsActiveMateConnector();if(e&&this.setOpacity(d.getNumber("ACTIVE_MATE_CONNECTOR_OPACITY")),this.activeMateConnectorScaled!==e){if(!e){this.setOpacity(1)}this.damageTransform()}}},i.setInteractionEnabled=function(e){v=e},i.prototype.isInteractionEnabled=function(){return v&&!(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated())},i.prototype.getOccurrence=function(){return this.definition?this.definition.occurrence:null},i}(h.UIElement);function I(){if(y)return y;y={};var e=[0,0,0],t=[0,0,1],i=[1,0,0],r=Math.PI/2,n=.75*d.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS"),o=.25*d.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS"),s=d.getNumber("MATE_CONNECTOR_DIAMETER_PX")/2,a=s-d.getNumber("MATE_CONNECTOR_RING_WIDTH_PX"),c=d.getColor("MATE_CONNECTOR_STROKE_COLOR"),l=d.getNumber("MATE_CONNECTOR_STROKE_WIDTH"),u=(0,h.createCircle)(e,s,t,d.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS"));(0,h.addColorToIncrement)(c,u),(0,h.addSizeToIncrement)(l,u);var p=(0,h.createArc)(e,a,t,i,r,2*Math.PI,n);(0,h.addColorToIncrement)(c,p),(0,h.addSizeToIncrement)(l,p);var g=(0,h.createLine)(e,[a,0,0],void 0,c,l),m=(0,h.createLine)(e,[0,a,0],void 0,c,l),v=d.getNumber("MATE_CONNECTOR_AXIS_LINE_GAP_PX"),E=d.getNumber("MATE_CONNECTOR_AXIS_LINE_LENGTH_PX"),I=d.getNumber("MATE_CONNECTOR_AXIS_LINE_WIDTH"),T=d.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_LENGTH_PX"),S=d.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_WIDTH"),P=(0,h.createLine)([s+v,0,0],[s+v+E,0,0],void 0,d.getColor("X_AXIS_COLOR"),I),_=(0,h.createLine)([0,s+v,0],[0,s+v+E,0],void 0,d.getColor("Y_AXIS_COLOR"),I),M=(0,h.createLine)([0,0,v],[0,0,v+T],void 0,d.getColor("Z_AXIS_COLOR"),S),D=u.concatenate(p).concatenate(g).concatenate(m).concatenate(P).concatenate(_).concatenate(M);D&&(y[f.LINES]=D,y[f.LINES_FADED]=D.clone());var C=(0,h.createRing)(e,a,s,t,i,r,2*Math.PI,n),O=(0,h.createRing)(e,0,s,t,i,0,r,o),A=C.concatenate(O);A&&(y[f.TRIANGLES]=A,(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_COLOR"),y[f.TRIANGLES]),y[f.COMPARE_BASE_TRIANGLES]=A.clone(),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_COMPARE_BASE_COLOR"),y[f.COMPARE_BASE_TRIANGLES]),y[f.COMPARE_TARGET_TRIANGLES]=A.clone(),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_COMPARE_TARGET_COLOR"),y[f.COMPARE_TARGET_TRIANGLES]),y[f.TRIANGLES_PRESELECTED]=A.clone(),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_PRE_SELECTED_COLOR"),y[f.TRIANGLES_PRESELECTED]),y[f.TRIANGLES_SELECTED]=A.clone(),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_SELECTED_COLOR"),y[f.TRIANGLES_SELECTED]),y[f.TRIANGLES_FADED]=A.clone()),y[f.PICK_DISC]=(0,h.createDisc)(e,s,t,d.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),s=d.getNumber("MATE_CONNECTOR_MINI_DIAMETER_PX")/2,l=d.getNumber("MATE_CONNECTOR_MINI_STROKE_WIDTH"),u=(0,h.createCircle)(e,s,t,d.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),u),y[f.INFERENCE_POINT_LINES]=u,y[f.INFERENCE_POINT_TRIANGLES]=(0,h.createRing)(e,0,s,t,i,0,2*Math.PI,4*o),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),y[f.INFERENCE_POINT_TRIANGLES]),u=(0,h.createCircle)(e,s,t,d.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),u),(0,h.addSizeToIncrement)(l,u),g=(0,h.createLine)([-s,0,0],[s,0,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l),m=(0,h.createLine)([0,-s,0],[0,s,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l),(D=(D=u.concatenate(g)).concatenate(m))&&(y[f.INFERENCE_CENTER_LINES]=D),y[f.INFERENCE_CENTER_TRIANGLES]=(0,h.createRing)(e,0,s,t,i,0,2*Math.PI,4*o),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),y[f.INFERENCE_CENTER_TRIANGLES]),u=(0,h.createCircle)(e,s,t,d.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),u),(0,h.addSizeToIncrement)(l,u),g=(0,h.createLine)([-s,0,0],[s,0,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l),m=(0,h.createLine)([0,-s,0],[0,s,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l),(D=u.concatenate(g).concatenate(m))&&(y[f.INFERENCE_CENTROID_LINES]=D);var R=(0,h.createRing)(e,0,s,t,i,0,.5*Math.PI,o);(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),R);var N=(0,h.createRing)(e,0,s,t,i,.5*Math.PI,Math.PI,o);(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_DARK_FILL_COLOR"),N);var w=(0,h.createRing)(e,0,s,t,i,Math.PI,1.5*Math.PI,o);(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),w);var b=(0,h.createRing)(e,0,s,t,i,1.5*Math.PI,2*Math.PI,o);(0,h.addColorToIncrement)(d.getColor("MATE_CONNECTOR_INFERENCE_DARK_FILL_COLOR"),b);var L=R.concatenate(N).concatenate(w).concatenate(b);y[f.INFERENCE_CENTROID_TRIANGLES]=L;var F=.7071*s,B=(0,h.createLine)([-F,-F,0],[F,-F,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l),x=(0,h.createLine)([-F,F,0],[F,F,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l),U=(0,h.createLine)([-F,-F,0],[-F,F,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l),G=(0,h.createLine)([F,-F,0],[F,F,0],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),l);(D=B.concatenate(x).concatenate(U).concatenate(G))&&(y[f.INFERENCE_MID_POINT_LINES]=D),y[f.INFERENCE_MID_POINT_TRIANGLES]=(0,h.createTriangleStrip)([-F,-F,0,F,-F,0,F,F,0,-F,F,0],[1,2,0,3],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"));var H=5*d.getNumber("MATE_CONNECTOR_AXIS_LINE_LENGTH_PX"),V=2*d.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_WIDTH"),k=(0,h.createLine)([0,0,0],[0,0,H],void 0,d.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),V),W=(0,h.createLine)([0,0,v],[0,0,H],void 0,d.getColor("MATE_CONNECTOR_SELECTED_COLOR"),V);return y[f.INFERENCE_ORIGIN_AXIS_LINES]=k,y[f.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED]=W,Object.values(y).forEach((function(e){(0,h.fillInDefaultAttributes)(e)})),y}t.MateConnector=E,t.getStaticIncrements=I,t.updateMateConnectorSelectedColor=function(e){var t=d.getColor("MATE_CONNECTOR_SELECTED_COLOR");if(e)for(var i=0;i<3;i++)t[i]=e[i];var r=I();r&&(0,h.addColorToIncrement)(t,r[f.TRIANGLES_SELECTED])}},345150:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MateConnectorComponent=void 0;var r=i(423902),n=i(311611),o=i(441716),s=i(227441),a=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.usage=i,n.mateConnectorGraphics={},n}return(0,r.__extends)(t,e),t.prototype.clone=function(e){var i=new t(e,this.usage,this.viewer);return this.copyToClone(i),i},t.prototype.cloneForPreview=function(e){var i=new t(e,n.bt_graphics_Usage.PREVIEW,this.viewer);for(var r in this.copyToPreview(i),this.mateConnectorGraphics){var o=this.mateConnectorGraphics[r],s=i.mateConnectorGraphics[r]={};for(var a in o)s[a]=o[a].cloneForPreview()}return i},t.prototype.getVisibleMateConnectorBounds=function(){var e=new n.BoundingBox;for(var t in this.mateConnectorGraphics){var i=this.mateConnectorGraphics[t];for(var r in i)i[r].isHidden||e.addPoint(i[r].worldSpacePosition)}return e},t.prototype.getInstantiatedMateConnectorsForOccurrence=function(e){var t=[];for(var i in this.mateConnectorGraphics){var r=this.mateConnectorGraphics[i];for(var n in r){var s=r[n],a=s.getDefinition();a&&(0,o.occurrencesEqual)(e,s.getOccurrence())&&t.push({Id:a.nodeId,isPartStudio:s.getIsPartStudioMateConnector()})}}return t},t.prototype.getComponentId=function(){return"mateconnector_component."},t.prototype.handlesEntity=function(e,t){return!e.hasTessellationError()&&e.isMateConnector()&&!this.viewer.getIsForFlattenedDisplay()},t.prototype.expectsTessellation=function(){return!1},t.prototype.reset=function(){for(var e in this.mateConnectorGraphics){var t=this.mateConnectorGraphics[e];for(var i in t)t[i].remove()}this.mateConnectorGraphics={},n.PartStudioComponent.prototype.reset.apply(this,arguments)},t.prototype.isInstantiated=function(){return!0},t.prototype.instantiateForPartStudio=function(e){this.addOrUpdateOccurrence(n.PART_STUDIO_ELEMENT_ID,null),n.PartStudioComponent.prototype.instantiateForPartStudio.apply(this,arguments)},t.prototype.removePartStudioInstantiation=function(e){n.PartStudioComponent.prototype.removePartStudioInstantiation.apply(this,arguments),this.removeOccurrence(n.PART_STUDIO_ELEMENT_ID,!1)},t.prototype.addOrUpdateOccurrence=function(t,i){var r=!1;for(var o in this.idToMetaData)r=this.updateEntityMateConnector(o,this.idToMetaData[o],t,i)||r;var s=t===n.PART_STUDIO_ELEMENT_ID;(r||s||this.occurrences.hasOwnProperty(t))&&e.prototype.addOrUpdateOccurrence.call(this,t,i)},t.prototype.getConnectorHiddenState=function(e,t){var i=this,r=e.getFirstFeatureId(),o=!1;if(t){var a=t.occurrenceData.featureData[r];a?o=a.visibility===s.GBTBSFeatureVisibility.HIDDEN:t.isPatternDescendant&&(o=!0)}else o=e.getFeatureIds().reduce((function(e,t){return e||i.featureVisibility[t]===n.Visibility.HIDDEN}),o);return o},t.prototype.occurrenceContainsBody=function(e,t){return this.viewer.getModelViewManagers().getManagerForUsage(this.usage).occurrenceContainsBody(e,t)},t.prototype.createMateConnectorDisplayData=function(e,t){if(t&&!this.occurrenceContainsBody(t,e.getMateConnectorPartId()))return null;var i=new s.BTMateConnectorDisplayData;return i.location=e.getMateConnectorCoordinateSystem(),i.partId=e.getMateConnectorPartId(),i.nodeId=e.getFirstFeatureId(),i.occurrence=t?t.occurrenceData.occurrence:null,i.ownerOccurrence=i.occurrence,i.implicit=!1,i.hidden=this.getConnectorHiddenState(e,t),i},t.prototype.updateEntityMateConnector=function(e,t,i,r,o){if(r&&!this.occurrenceContainsBody(r,t.getMateConnectorPartId()))return!1;var s=t.getFirstFeatureId(),a=this.getConnectorHiddenState(t,r),c=this.mateConnectorGraphics[e],l=c?c[i]:null;if(!o&&r&&a&&!l){return!0}c||(c={},this.mateConnectorGraphics[e]=c);var u=this.createMateConnectorDisplayData(t,r);return!!u&&(l?l.updateDefinition(u):(l=new n.MateConnector(u,(0,n.getSceneGraphIdForUsage)(this.usage),this.viewer,s),c[i]=l),r&&(l.setOccurrenceTransform(r.occurrenceData.transform.getGlMatrix()),l.updateOccurrenceVisibility(r.isHidden?n.Visibility.HIDDEN:n.Visibility.VISIBLE)),!0)},t.prototype.removeOccurrence=function(t,i){for(var r in e.prototype.removeOccurrence.call(this,t,i),this.mateConnectorGraphics){var n=this.mateConnectorGraphics[r];if(n){var o=n[t];o&&(o.remove(),delete n[t])}}},t.prototype.updateEntityGraphics=function(e,t,i){var r;for(r in this.occurrences){var n=this.occurrences[r];r=+r,this.updateEntityMateConnector(e,i,r,n)}},t.prototype.getHideableFeatureIds=function(){var e=[];return this.featureToIds.each((function(t,i){return(0,n.isFeatureIdCompound)(i)||e.push(i),!1}),this),e},t.prototype.removeEntity=function(e){var t=this.mateConnectorGraphics[e];for(var i in t)t[i].remove();delete this.mateConnectorGraphics[e],n.PartStudioComponent.prototype.removeEntity.apply(this,arguments)},t.prototype.hideShowEntity=function(e,t,i){if((i=i||n.PART_STUDIO_ELEMENT_ID)!==n.INVALID_OCCURRENCE_ID){var r=this.mateConnectorGraphics[e];for(var o in r)if(+o===i){var s=r[i];s&&(t===n.Visibility.HIDDEN?s.definition.hidden=!0:s.definition.hidden=!1,s.updateHideState())}}},t.prototype.getAllMateConnectorGraphics=function(e,t){var i=this.featureToIds.get(t),r=[];return i&&i.each((function(t,i){var n=this.getMateConnectorGraphicsFromEntityId(e,i);return n&&r.push(n),!1}),this),r},t.prototype.getMateConnectorGraphics=function(e,t){var i,r=this.featureToIds.get(t);return r&&(i=r.firstKey()),i?this.getMateConnectorGraphicsFromEntityId(e,i):null},t.prototype.getMateConnectorData=function(e,t){var i,r=this.featureToIds.get(t);if(r&&(i=r.firstKey()),i){var n=this.idToMetaData[i],o=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString()),s=this.occurrences[o];if(n&&s)return this.createMateConnectorDisplayData(n,s)}return null},t.prototype.getMateConnectorGraphicsFromEntityId=function(e,t){if(t){var i=this.mateConnectorGraphics[t];if(e){var r=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString());if(s=i?i[r]:null)return s;var n=this.idToMetaData[t],o=this.occurrences[r];if(n&&o){return this.updateEntityMateConnector(t,n,r,o,!0),(i=this.mateConnectorGraphics[t])?i[r]:null}}else for(var r in i){var s;if(!(s=i[r]).getOccurrence())return s}}return null},t.prototype.getUIElementsForSelection=function(e){var t=[];(e.isMateConnector()||e.isFeature())&&this.getAllMateConnectorGraphics(e.getOccurrence(),e.getIdString()).forEach((function(e){t.push(e)}));return t},t.prototype.getEntityIdsForSelection=function(e){return[]},t.prototype.getOccurrencesForSelection=function(e){var t=[];if(e.isMateConnector()||e.isFeature()){var i=this.getMateConnectorGraphics(e.getOccurrence(),e.getIdString());i&&t.push(i.getOccurrence())}return t},t}(n.AssemblyEnabledPartStudioComponent);t.MateConnectorComponent=a},392647:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMateIndicator=t.FixedMateIndicator=t.Tangent=t.MateGroupMateIndicator=t.Ball=t.PinSlot=t.Cylindrical=t.Slider=t.Parallel=t.PlanarMateIndicator=t.Revolute=t.Fastened=t.MateIndicator=void 0;var r=i(423902),n=i(311611),o=i(712197),s=i(784167),a=i(129346),c=i(227441),l=function(e){function t(t,i,r){var n=e.call(this,r)||this;return n.definition=t,n.mateConnectorDisplayData=i,n.mateIndicatorComponents=[],n.occurrenceData.setCanIsolateChange(!0),n.occurrenceData.setIsolated(!1),n}return(0,r.__extends)(t,e),t.prototype.onDevicePixelRatioChanged=function(e){this.updateGraphics()},t.prototype.getDefinition=function(){return this.definition?this.definition:null},t.prototype.remove=function(){for(var t=0;t<this.mateIndicatorComponents.length;t++)this.mateIndicatorComponents[t].remove();e.prototype.remove.call(this)},t.prototype.addHighlight=function(t){e.prototype.addHighlight.call(this,t);for(var i=0;i<this.mateIndicatorComponents.length;i++)this.mateIndicatorComponents[i].addHighlight(t)},t.prototype.removeHighlight=function(t){for(var i=e.prototype.removeHighlight.call(this,t),r=0;r<this.mateIndicatorComponents.length;r++)this.mateIndicatorComponents[r].removeHighlight(t);return i},t.prototype.onIsolateRemoved=function(){this.updateGraphics()},t.prototype.isInteractionEnabled=function(){return!(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated())},t.prototype.updateGraphics=function(){for(var e=0;e<this.mateIndicatorComponents.length;e++)this.mateIndicatorComponents[e].updateGraphics()},t.prototype.setIsolated=function(e){this.occurrenceData.setIsolated(e);for(var t=0;t<this.mateIndicatorComponents.length;t++)this.mateIndicatorComponents[t].getOccurrenceData().setIsolated(e)},t.prototype.getDefinitionMateConnectorIds=function(){return this.definition.getMateConnectorIds()},t.prototype.getDefinitionOccurrenceIds=function(){return this.mateIndicatorComponents.length>0?this.mateIndicatorComponents[0].getDefinitionOccurrenceIds():this.definition.getOccurrenceIds()},t.prototype.getModelSelection=function(e){return null},t.prototype.addMateIndicatorComponent=function(e){e.isValid()&&(e.updateHideState(),this.mateIndicatorComponents.push(e),this.listenTo(e,n.UiEvents.LONG_PRESS_START,this.onLongPressStart),this.listenTo(e,n.UiEvents.LONG_PRESS_END,this.onLongPressEnd))},t.prototype.onLongPressStart=function(){var e=[];this.getDefinitionOccurrenceIds().forEach((function(t){e.push(c.BTOccurrence.getOccurrenceFromPathString(t))})),this.viewer.getIsolatedOccurrenceManager().isolateOccurrences(e,n.IsolateFlag.INITIAL),(0,o.clearPreSelection)()},t.prototype.onLongPressEnd=function(){(0,s.getCommandDispatcher)().trigger(a.commands.EXIT_ISOLATE,this.viewer)},t.prototype.updateMateConnectorDisplayData=function(e){this.mateConnectorDisplayData=e;for(var t=0;t<this.mateIndicatorComponents.length;++t)this.mateIndicatorComponents[t].updateMateConnectorDisplayData(this.mateConnectorDisplayData)},t.prototype.updateHiddenMode=function(e){for(var t=0;t<this.mateIndicatorComponents.length;t++)this.mateIndicatorComponents[t].updateHiddenMode(e)&&this.mateIndicatorComponents[t].updateHideState()},t}(n.UIElement);t.MateIndicator=l;var u=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"FASTENED",i,o.viewer,c.GBTMateType.FASTENED);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t}(l);t.Fastened=u;var h=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"REVOLUTE",i,o.viewer,c.GBTMateType.REVOLUTE);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t}(l);t.Revolute=h;var d=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"PLANAR_BASE",i,o.viewer,c.GBTMateType.PLANAR);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t}(l);t.PlanarMateIndicator=d;var p=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"PARALLEL_BASE",i,o.viewer,c.GBTMateType.PARALLEL);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t}(l);t.Parallel=p;var g=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"SLIDER_BASE",i,o.viewer,c.GBTMateType.SLIDER),a=new n.Arrow(o.mateConnectorDisplayData,i,-Math.PI/2,[0,1,0],o.viewer,c.GBTMateType.SLIDER);return o.addMateIndicatorComponent(s),o.addMateIndicatorComponent(a),o}return(0,r.__extends)(t,e),t}(l);t.Slider=g;var f=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"CYLINDRICAL_BASE",i,o.viewer,c.GBTMateType.CYLINDRICAL),a=new n.Arrow(o.mateConnectorDisplayData,i,-Math.PI/2,[0,1,0],o.viewer,c.GBTMateType.CYLINDRICAL);return o.addMateIndicatorComponent(s),o.addMateIndicatorComponent(a),o}return(0,r.__extends)(t,e),t}(l);t.Cylindrical=f;var m=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"PIN_SLOT_BASE",i,o.viewer,c.GBTMateType.PIN_SLOT);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t}(l);t.PinSlot=m;var y=function(e){function t(t,i,r){var o=e.call(this,i,t,r)||this,s=new n.Base(o.mateConnectorDisplayData,"BALL",i,o.viewer,c.GBTMateType.BALL);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t}(l);t.Ball=y;var v=function(e){function t(t,i,r){var o=e.call(this,i,[],r)||this,s=new n.MateGroup(t,i,o.viewer);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t.prototype.updateOccurenceDisplayData=function(e){for(var t=0;t<this.mateIndicatorComponents.length;++t)this.mateIndicatorComponents[t].updateOccurenceDisplayData(e)},t}(l);t.MateGroupMateIndicator=v;var E=function(e){function t(t,i){var r=e.call(this,t,null,i)||this,o=new n.GeometryMate(t,"TANGENT",r.viewer);return r.addMateIndicatorComponent(o),r}return(0,r.__extends)(t,e),t.prototype.updateMateIndicatorDefinition=function(e){this.definition=e;for(var t=0;t<this.mateIndicatorComponents.length;++t)this.mateIndicatorComponents[t].updateDefinition(this.definition)},t}(l);t.Tangent=E;var I=function(e){function t(t,i,r){var o=e.call(this,null,null,r)||this,s=new n.Fixed(t,i,o.viewer);return o.addMateIndicatorComponent(s),o}return(0,r.__extends)(t,e),t}(l);t.FixedMateIndicator=I,t.createMateIndicator=function(e,t,i){var r=null;switch(t.mateType){case c.GBTMateType.FASTENED:r=new u(e,t,i);break;case c.GBTMateType.REVOLUTE:r=new h(e,t,i);break;case c.GBTMateType.SLIDER:r=new g(e,t,i);break;case c.GBTMateType.PLANAR:r=new d(e,t,i);break;case c.GBTMateType.PARALLEL:r=new p(e,t,i);break;case c.GBTMateType.CYLINDRICAL:r=new f(e,t,i);break;case c.GBTMateType.PIN_SLOT:r=new m(e,t,i);break;case c.GBTMateType.BALL:r=new y(e,t,i);break;default:r=null}return r}},667453:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fixed=t.GeometryMate=t.MateGroup=t.Arrow=t.Base=t.MateIndicatorComponent=t.ensureMateIndicatorResources=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(712197),a=i(673290),c=i(227441),l=i(337740),u=i(911748),h={FASTENED:"mateindicators/MateIndicatorAssets_Fastened",REVOLUTE:"mateindicators/MateIndicatorAssets_Revolute",SLIDER_BASE:"mateindicators/MateIndicatorAssets_Ball",PLANAR_BASE:"mateindicators/MateIndicatorAssets_PlanarCenter",CYLINDRICAL_BASE:"mateindicators/MateIndicatorAssets_Revolute",PIN_SLOT_BASE:"mateindicators/MateIndicatorAssets_PinSlot",PARALLEL_BASE:"mateindicators/MateIndicatorAssets_Parallel",BALL:"mateindicators/MateIndicatorAssets_Ball",ARROW:"mateindicators/MateIndicatorAssets_DirectionArrow",GROUP:"mateindicators/MateIndicatorAssets_Group",TANGENT:"mateindicators/MateIndicatorAssets_Tangent",FIXED:"mateindicators/MateIndicatorAssets_Fixed"},d=o.default.getManager(),p=d.getNumber("MATE_PIXEL_SIZE"),g="MateIndicatorComponent";function f(e){e.getResources().mateIndicatorGlyphResources||(e.getResources().mateIndicatorGlyphResources=new n.GlyphResources(n.MATE_INDICATOR_ATLAS,e,h,p))}t.ensureMateIndicatorResources=f;var m=function(e){function t(t,i,r,o,s){var a=e.call(this,o)||this;return a.mateConnectorDisplayData=t,a.type=i,a.definition=r,a.occurrenceTransforms=[],a.connectorCoordinateSystems=[],a.worldSpacePositions=[],a.worldSpacePosition=[0,0,0],a.lastScale=-1,a.positionComputed=!1,a.inHiddenMode=!1,f(a.viewer),a.id=i,a.featureType=l.FeatureTypeName.MATE,a.mateType=s,a.listenTo(a,n.UiEvents.LONG_PRESS_START+g,a.onLongPressStart),a.listenTo(a,n.UiEvents.LONG_PRESS_END+g,a.onLongPressEnd),a.damageTransform(),a.occurrenceData.setCanIsolateChange(!0),a.occurrenceData.setIsolated(!1),a}return(0,r.__extends)(t,e),t.prototype.updateHiddenMode=function(e){return this.inHiddenMode!==e&&(this.inHiddenMode=e,!0)},t.prototype.updateHideState=function(){this.isHighlighted()||!this.definition.hidden&&!this.inHiddenMode?(this.hasMeshIncrements()||this.updateGraphics(!0),this.positionComputed||this.computePosition(),this.show()):this.hide()},t.prototype.onLongPressStart=function(){this.trigger(n.UiEvents.LONG_PRESS_START)},t.prototype.onLongPressEnd=function(){this.trigger(n.UiEvents.LONG_PRESS_END)},t.prototype.addHighlight=function(t){e.prototype.addHighlight.call(this,t),this.updateHideState(),this.updateGraphics()},t.prototype.removeHighlight=function(t){return!!e.prototype.removeHighlight.call(this,t)&&(this.updateHideState(),this.updateGraphics(),!0)},t.prototype.onViewWillDraw=function(e){this.isHidden||this.hasBeenRemoved||(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&this.updateGraphics(),this.adjustTransform(e))},t.prototype.updateIsolation=function(){var e=1;this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated()&&(e=d.getNumber("ISOLATE_CONTEXT_UI_TRANSPARENCY")*(0,n.getTransparencyTransition)()+(1-(0,n.getTransparencyTransition)()));var t=this.getIncrement();t&&(t=(0,n.setIncrementOpacity)(t,e),this.updateMeshIncrement(this.type,g,t,this.getNodeProperties()))},t.prototype.updateGraphics=function(e){if(this.isValid())if(!this.definition||this.isHidden&&!e)this.removeMeshIncrements();else if(this.glyphResources.atlasReady){var t=this.getIncrement();t&&(this.updateMeshIncrement(this.type,g,t,this.getNodeProperties()),this.updateIsolation())}},t.prototype.getIncrement=function(){return null},Object.defineProperty(t.prototype,"glyphResources",{get:function(){return this.viewer.getResources().mateIndicatorGlyphResources},enumerable:!1,configurable:!0}),t.prototype.getNodeProperties=function(){return this.glyphResources.getNodeProperties(this.getHighlightStateId(),this.getMateStateId(),this.getRenderOrderPriority())},t.prototype.getRenderOrderPriority=function(){return n.RenderOrderPriority.LOWER},t.prototype.getMateStateId=function(){return this.definition.status===c.GBTAssemblyFeatureDisplayStatus.ERROR?"ERROR":this.definition.status===c.GBTAssemblyFeatureDisplayStatus.SUPPRESSED?"SUPPRESSED":"NORMAL"},t.prototype.getHighlightStateId=function(){var e=this.getHighlight();return e&&e.type===n.HighlightType.PRE?"PRE_HIGHLIGHT":e?"HIGHLIGHT":"NO_HIGHLIGHT"},t.prototype.getTextureId=function(){return this.type},t.prototype.isValid=function(){return!!this.worldSpacePosition},t.prototype.computePosition=function(){for(var e=0;e<this.mateConnectorDisplayData.length;e++)this.occurrenceTransforms[e]=this.viewer.getModelViewManagers().getManager().getOccurrenceTransform(this.mateConnectorDisplayData[e].occurrence),this.connectorCoordinateSystems[e]=this.mateConnectorDisplayData[e].location,this.worldSpacePositions[e]=u.mat4.multiplyVec3(this.occurrenceTransforms[e],this.connectorCoordinateSystems[e].origin.getVec3(),u.vec3.create());this.worldSpacePositions.length>0?this.worldSpacePosition=this.worldSpacePositions[0]:(this.worldSpacePosition=null,this.removeMeshIncrements()),this.positionComputed=!0},t.prototype.causePositionRecompute=function(){this.lastScale=-1,this.positionComputed=!1,this.isHidden||this.computePosition()},t.prototype.updateMateConnectorDisplayData=function(e){this.mateConnectorDisplayData=e,this.causePositionRecompute()},t.prototype.getDefinitionOccurrenceIds=function(){for(var e=[],t=0;t<this.mateConnectorDisplayData.length;t++)e.push(this.mateConnectorDisplayData[t].occurrence.getPathAsString());return e},t.prototype.getRelatedOccurrences=function(){for(var e=[],t=0;t<this.mateConnectorDisplayData.length;t++)e.push(this.mateConnectorDisplayData[t].occurrence);return e},t.prototype.getModelSelection=function(){if(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated())return null;for(var e=this.getRelatedOccurrences(),t=[],i=0;i<e.length;i++){var r=e[i],n=new s.Selection(c.GBTUiSelectionType.OCCURRENCE,r,r);t.push(n)}for(i=0;i<this.mateConnectorDisplayData.length;i++){var o=this.mateConnectorDisplayData[i],a=new s.Selection(c.GBTUiSelectionType.MATE_CONNECTOR,o.nodeId,o.ownerOccurrence,{isDerivedFeature:o.isDerivedFeature});t.push(a)}return new s.Selection(c.GBTUiSelectionType.MATE,this.definition.nodeId,this.definition.ownerOccurrence,{featureType:this.featureType,mateType:this.mateType,childSelections:t,isDerivedFeature:this.definition.isDerivedFeature})},t.prototype.adjustTransform=function(e){if(this.positionComputed||this.computePosition(),this.isValid()){var t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(!(Math.abs(this.lastScale-t)<a.Tolerances.ZERO_LENGTH&&this.hasMeshIncrements())){this.lastScale=t;var i=u.mat4.identity();i[0]=t,i[5]=t,i[10]=t,this.setTransform(u.mat4.rotateX(u.mat4.multiply(u.mat4.multiply(this.occurrenceTransforms[0],this.connectorCoordinateSystems[0].getGlMatrix(),u.mat4.create()),i),-Math.PI/2)),this.hasMeshIncrements()||this.updateGraphics()}}},t.prototype.damageTransform=function(){this.lastScale=-1,this.connectorCoordinateSystems[0]&&u.mat4.multiplyVec3(this.occurrenceTransforms[0],this.connectorCoordinateSystems[0].origin.getVec3(),this.worldSpacePosition),(0,n.requestDraw)()},t}(n.UIElement);t.MateIndicatorComponent=m;var y=function(e){function t(t,i,r,n,o){return e.call(this,t,i,r,n,o)||this}return(0,r.__extends)(t,e),t.prototype.getIncrement=function(){var e=this.glyphResources.getTextureCoordsOffset(this.getTextureId(),this.getMateStateId(),this.getHighlightStateId(),.5);return(0,n.createQuad)([-p/2,0,-p/2],[p/2,0,-p/2],[-p/2,0,p/2],void 0,[e.lowS,e.highT],[e.highS,e.lowT])},t}(m);t.Base=y;var v=function(e){function t(t,i,r,n,o,s){var a=e.call(this,t,"ARROW",i,o,s)||this;return a.rotationAngle=r,a.rotationAxis=n,a}return(0,r.__extends)(t,e),t.prototype.getIncrement=function(){var e=this.glyphResources.getTextureCoordsOffset(this.getTextureId(),this.getMateStateId(),this.getHighlightStateId(),1);return(0,n.createQuad)([0,0,-p/4],[p,0,-p/4],[0,0,p/4],void 0,[e.lowS,e.highT],[e.highS,e.lowT])},t.prototype.adjustTransform=function(e){if(this.positionComputed||this.computePosition(),this.isValid()){var t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(!(Math.abs(this.lastScale-t)<a.Tolerances.ZERO_LENGTH&&this.hasMeshIncrements())){this.lastScale=t;var i=u.mat4.identity();i[0]=t,i[5]=t,i[10]=t;var r=u.mat4.multiply(u.mat4.multiply(this.occurrenceTransforms[0],this.connectorCoordinateSystems[0].getGlMatrix(),u.mat4.create()),i),n=u.mat4.rotate(r,this.rotationAngle,this.rotationAxis);this.setTransform(n),this.hasMeshIncrements()||this.updateGraphics()}}},t.prototype.getHighlightStateId=function(){return"NO_HIGHLIGHT"},t.prototype.getRenderOrderPriority=function(){return n.RenderOrderPriority.DEFAULT},t}(m);t.Arrow=v;var E=function(e){function t(t,i,r){var n=e.call(this,[],"GROUP",i,r)||this;return n.occurrenceDisplayData=t,n.featureType=l.FeatureTypeName.MATE_GROUP,n}return(0,r.__extends)(t,e),t.prototype.getDefinitionOccurrenceIds=function(){return this.definition.getOccurrenceIds()},t.prototype.getRelatedOccurrences=function(){for(var e=[],t=0;t<this.occurrenceDisplayData.length;t++)e.push(this.occurrenceDisplayData[t].occurrenceData.occurrence);return e},t.prototype.computePosition=function(){if(this.occurrenceDisplayData){for(var e=null,t=this.viewer.getModelViewManagers().getManager(),i=0;i<this.occurrenceDisplayData.length;i++){var r=this.occurrenceDisplayData[i].occurrenceData.occurrence;this.occurrenceTransforms[i]=t.getOccurrenceTransform(r),this.connectorCoordinateSystems[i]=c.BTCoordinateSystem.createValidDefault(),this.worldSpacePositions[i]=u.mat4.multiplyVec3(this.occurrenceTransforms[i],this.connectorCoordinateSystems[i].origin.getVec3(),u.vec3.create());var o=t.getOccurrenceBounds(r);o&&o.isFinite()&&(e||(e=new n.BoundingBox),e.addBox(o))}if(this.worldSpacePositions.length>0&&e){var s=e.center();this.connectorCoordinateSystems[0].origin.updateFromArray(u.vec3.subtract(s,this.worldSpacePositions[0])),this.worldSpacePosition=s}else this.worldSpacePosition=null,this.removeMeshIncrements();this.positionComputed=!0}},t.prototype.updateOccurenceDisplayData=function(e){this.occurrenceDisplayData=e,this.causePositionRecompute()},t}(y);t.MateGroup=E;var I=function(e){function t(t,i,r){var n=e.call(this,[],i,t,r)||this;return n.featureType=l.FeatureTypeName.GEOMETRY_MATE,n}return(0,r.__extends)(t,e),t.prototype.computePosition=function(){var e=this.definition;e&&e.location?this.worldSpacePosition=e.location.origin.getVec3():(this.worldSpacePosition=null,this.removeMeshIncrements()),this.positionComputed=!0},t.prototype.updateDefinition=function(e){this.definition=e,this.causePositionRecompute()},t.prototype.getDefinitionOccurrenceIds=function(){var e=this.getRelatedOccurrences(),t=[];return e.forEach((function(e){t.push(e.getPathAsString())})),t},t.prototype.getRelatedOccurrences=function(){var e=[],t=this.definition;return t&&(t.firstOccurrence&&e.push(t.firstOccurrence),t.secondOccurrence&&e.push(t.secondOccurrence)),e},t.prototype.adjustTransform=function(e){if(this.positionComputed||this.computePosition(),this.isValid()){var t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(!(Math.abs(this.lastScale-t)<a.Tolerances.ZERO_LENGTH&&this.hasMeshIncrements())){this.lastScale=t;var i=u.mat4.identity();i[0]=t,i[5]=t,i[10]=t;var r=this.definition;this.setTransform(u.mat4.rotateX(u.mat4.multiply(r.location.getGlMatrix(),i),-Math.PI/2)),this.hasMeshIncrements()||this.updateGraphics()}}},t}(y);t.GeometryMate=I;var T=function(e){function t(t,i,r){var o=e.call(this,[],"FIXED",new c.BTAssemblyFeatureDisplayData(!0),r)||this;o.occurrenceDisplayData=[],o.connectorCoordinateSystems[0]=c.BTCoordinateSystem.createValidDefault();var s=o.viewer.retrieveCanvasLocationWorldPosition(i);if(s)o.worldSpacePosition=s,o.connectorCoordinateSystems[0].origin.updateFromArray(s);else{var a=o.viewer.getModelViewManagers().getManager().getOccurrenceBounds(t);if(a&&a.isFinite()){var l=new n.BoundingBox;l.addBox(a);var h=l.center();o.worldSpacePosition=h,o.connectorCoordinateSystems[0].origin.updateFromArray(h)}}return o.occurrenceTransforms[0]=u.mat4.identity(),o}return(0,r.__extends)(t,e),t.prototype.computePosition=function(){this.positionComputed=!0},t}(y);t.Fixed=T},132034:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OriginElement=void 0;var r,n=i(423902),o=i(311611),s=i(73055),a=i(673290),c=i(712197),l=i(227441),u=i(337740),h=i(911748),d=s.default.getManager(),p=new o.NodeProperties({zOffset:d.getNumber("ORIGIN_Z_OFFSET"),primitiveType:o.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1});!function(e){e.POINT="point"}(r||(r={}));var g=function(e){function t(t,i){var r=e.call(this,i)||this;return r.definition=t,r.lastScale=-1,r.worldSpacePosition=[0,0,0],r.id="AssemblyOriginElement",r.occurrenceTransform=h.mat4.identity(),r.updateHideState(),r}return(0,n.__extends)(t,e),t.prototype.setOccurrenceTransform=function(e){this.occurrenceTransform=e,this.damageTransform()},t.prototype.updateDefinition=function(e){this.definition=e,this.updateHideState(),this.damageTransform()},t.prototype.damageTransform=function(){if(this.lastScale=-1,this.definition){h.mat4.multiplyVec3(this.occurrenceTransform,[0,0,0],this.worldSpacePosition)}(0,o.requestDraw)()},t.prototype.getUserVisibilitySetting=function(){return this.definition.hidden?o.Visibility.HIDDEN:o.Visibility.VISIBLE},t.prototype.updateHideState=function(){this.isHighlighted()||this.getUserVisibilitySetting()!==o.Visibility.HIDDEN?(this.hasMeshIncrements()||this.updateGraphics(!0),this.show()):this.hide()},t.prototype.getBounds=function(){if(this.isVisibleToUser()){var e=new o.BoundingBox;return e.addPoint(this.worldSpacePosition),e}return null},t.prototype.onViewWillDraw=function(e){this.adjustTransform(e)},t.prototype.adjustTransform=function(e){if(this.definition&&!this.isHidden){var t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(!(Math.abs(this.lastScale-t)<a.Tolerances.ZERO_LENGTH)){this.lastScale=t;var i=h.mat4.identity();i[0]=t,i[5]=t,i[10]=t,this.setTransform(h.mat4.multiply(this.occurrenceTransform,i,h.mat4.create())),this.hasMeshIncrements()||this.updateGraphics()}}},t.prototype.updateGraphics=function(e){if(!this.definition||this.isHidden&&!e)this.removeMeshIncrements();else{var t=function(){if(f)return f;f={};var e=(0,o.createPoint)([0,0,0],"point",d.getColor("ORIGIN_COLOR"),d.getNumber("ORIGIN_SIZE"));(0,o.addStyleToIncrement)(d.getPointFont("ORIGIN_FONT"),e),e&&(f[r.POINT]=e);return Object.values(f).forEach((function(e){(0,o.fillInDefaultAttributes)(e)})),f}();this.updateMeshIncrement(r.POINT,o.NO_SELECTION_ID,t[r.POINT].clone(),p)}},t.prototype.getOccurrence=function(){return null},t.prototype.getModelSelection=function(e){if(!this.definition)return null;var t=new l.BTOccurrence,i=new c.Selection(l.GBTUiSelectionType.FEATURE,l.BTAssemblyDefaultFeatures.ORIGIN_ID,t,{sourcePick:e.sourcePick});return i.setFeatureType(u.FeatureTypeName.ASSEMBLY_ORIGIN),i},t.prototype.addHighlight=function(t){e.prototype.addHighlight.call(this,t),this.updateHideState(),this.addHighlightToIncrement(r.POINT,t)},t.prototype.removeHighlight=function(t){return this.removeHighlightFromIncrement(r.POINT,t),!!e.prototype.removeHighlight.call(this,t)&&(this.updateHideState(),!0)},t}(o.UIElement);t.OriginElement=g;var f=null},742446:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudio=void 0;var r=i(423902),n=i(342211),o=i(911748),s=i(311517),a=i(227441),c=i(736202),l=i(311611),u=i(601759),h=function(e){return e.isFace()||e.isFromSketch()&&e.isEdge()||e.isFromOrigin()||e.isSketchUserPoint()||e.isFromPointBody()||e.isFromWireBody()},d=function(e){return e.isFace()||e.isFromWireBody()&&e.isEdge()||e.isFromPointBody()},p=function(e){function t(t,i,r,n,o,s,a){var c=e.call(this,s)||this;return c.id=t,c.microversionIdAndConfiguration=i,c.modelViewManager=r,c.usage=o,c.isExternal=!1,c.isForIncontextDisplay=!1,c.hideableFeatureIds=[],c.referencedInContextAssemblyIds=[],c.visibleInContextAssembly="",c.displayedContextTransform={},c.editedInContextOccurrences=[],c.partColorCycle=null,c.isCachedPartStudioPendingUse=!1,c.isMissingTangencyInformationMessageShown=!1,c.meshOwnerId=a?a.meshOwnerId:(0,l.getNewOwnerId)(),c.sharedBaseMeshManager=r.getSharedBaseMeshManager(),c.entityIdManager=new l.NamedIdManager(l.IdSizes.ENTITY),c.bodyComponent=new l.BodyComponent(c,n,c.usage,c.viewer),c.sketchComponent=new l.SketchComponent(c,c.usage,c.viewer),c.planeComponent=new l.PlaneComponent(c,c.usage,c.viewer),c.pointBodyComponent=new l.PointBodyComponent(c,c.viewer),c.mateConnectorComponent=new l.MateConnectorComponent(c,c.usage,c.viewer),c.errorComponent=new l.ErrorComponent(c,c.viewer),c.dimensionComponent=new l.DimensionComponent(c.usage,c.id,c.viewer),c.imageComponent=new l.ImageComponent(c.usage,c.viewer),c.components=[c.bodyComponent,c.sketchComponent,c.planeComponent,c.pointBodyComponent,c.mateConnectorComponent,c.errorComponent],c}return(0,r.__extends)(t,e),t.prototype.clone=function(e){var i=new t(this.id,this.microversionIdAndConfiguration,this.modelViewManager,this.bodyComponent.getBodyLoadTasks(),this.usage,this.viewer);if(e){for(var r=0;r<i.components.length;++r)i.bodyComponent===i.components[r]?(i.bodyComponent=this.bodyComponent.clone(i),i.components[r]=i.bodyComponent):i.planeComponent===i.components[r]?(i.planeComponent=this.planeComponent.clone(i),i.components[r]=i.planeComponent):i.sketchComponent===i.components[r]?(i.sketchComponent=this.sketchComponent.clone(i),i.components[r]=i.sketchComponent):i.pointBodyComponent===i.components[r]?(i.pointBodyComponent=this.pointBodyComponent.clone(i),i.components[r]=i.pointBodyComponent):i.mateConnectorComponent===i.components[r]&&(i.mateConnectorComponent=this.mateConnectorComponent.clone(i),i.components[r]=i.mateConnectorComponent);i.imageComponent=this.imageComponent.cloneForUsage(this.usage),i.partColorCycle=this.partColorCycle,i.isCachedPartStudioPendingUse=this.isCachedPartStudioPendingUse}return i},t.prototype.cloneForPreview=function(e,i){var r=new t(this.id,null,e,this.bodyComponent.getBodyLoadTasks(),l.bt_graphics_Usage.PREVIEW,this.viewer,this);r.entityIdManager=this.entityIdManager.clone();for(var n=0;n<r.components.length;++n)r.bodyComponent===r.components[n]?(r.bodyComponent=this.bodyComponent.cloneForPreview(r),r.components[n]=r.bodyComponent):r.planeComponent===r.components[n]?i||(r.planeComponent=this.planeComponent.cloneForPreview(r),r.components[n]=r.planeComponent):r.sketchComponent===r.components[n]?(r.sketchComponent=this.sketchComponent.cloneForPreview(r),r.components[n]=r.sketchComponent):r.pointBodyComponent===r.components[n]?i||(r.pointBodyComponent=this.pointBodyComponent.cloneForPreview(r),r.components[n]=r.pointBodyComponent):r.mateConnectorComponent===r.components[n]&&(i||(r.mateConnectorComponent=this.mateConnectorComponent.cloneForPreview(r),r.components[n]=r.mateConnectorComponent));return r.imageComponent=this.imageComponent.cloneForUsage(l.bt_graphics_Usage.PREVIEW),r.partColorCycle=this.partColorCycle,r},t.prototype.onPreviewDestroyed=function(){this.bodyComponent.onPreviewDestroyed()},t.prototype.copyBodyVisibility=function(e){this.bodyComponent.copyVisibility(e.bodyComponent)},t.prototype.isBase=function(){return this.usage===l.bt_graphics_Usage.BASE},t.prototype.getElementId=function(){return this.id},t.prototype.getIsMissingTangencyInformationMessageShown=function(){return this.isMissingTangencyInformationMessageShown},t.prototype.setIsMissingTangencyInformationMessageShown=function(e){this.isMissingTangencyInformationMessageShown=e},t.prototype.getIsCachedPartStudioPendingUse=function(){return this.isCachedPartStudioPendingUse},t.prototype.getFullElementId=function(){return this.microversionIdAndConfiguration?a.BTFullElementId.getFullElementIdString(this.id,this.microversionIdAndConfiguration.getKey()):this.id},t.prototype.getBtFullElementId=function(){var e=new a.BTFullElementId;return e.elementId=this.id,this.microversionIdAndConfiguration&&(e.microversionId=this.microversionIdAndConfiguration.microversion,e.microversionIdAndConfiguration=this.microversionIdAndConfiguration),e},t.prototype.getModelViewManager=function(){return this.modelViewManager},t.prototype.getMeshManager=function(){return this.modelViewManager.getMeshManager()},t.prototype.getSharedBaseMeshManager=function(){return this.sharedBaseMeshManager||null},t.prototype.populateClientCacheStateDisplayInformation=function(e){if(this.microversionIdAndConfiguration){var t=e.getOrCreateElementDataList(this.id,a.BTUiDocumentClientCacheState.DISPLAY_DATA);this.checkDuplicatedMicroversionIdAndConfiguration(t,this.microversionIdAndConfiguration)?t.push(this.microversionIdAndConfiguration):s.log.warn("Found duplicated part studio microversion id and configuration "+this.microversionIdAndConfiguration),this.populateTessellationSetting(e)}},t.prototype.populateTessellationSetting=function(e){var t,i=e.tessellationWithConfigurationSettings[this.id];i||(e.tessellationWithConfigurationSettings[this.id]=i=[]);for(var r=0;r<i.length;r++)if((t=i[r]).microversionIdAndConfiguration.equals(this.microversionIdAndConfiguration))return t.tessellationSettings=this.bodyComponent.getTessellationSettings(),t;return(t=new a.BTMicroversionIdAndConfigurationTessellationSetting).microversionIdAndConfiguration=this.microversionIdAndConfiguration,t.tessellationSettings=this.bodyComponent.getTessellationSettings(),i.push(t),t},t.prototype.getSceneGraph=function(){return this.usage===l.bt_graphics_Usage.PREVIEW?this.viewer.getSceneGraphs().getPreviewSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()},t.prototype.getPartColorCycle=function(){return this.partColorCycle},t.prototype.reset=function(e){for(var t=0;t<this.components.length;++t)this.components[t].reset(e);this.dimensionComponent.reset(),this.imageComponent.reset(),this.entityIdManager.reset(),this.referencedInContextAssemblyIds=[],this.visibleInContextAssembly="",this.editedInContextOccurrences=[],this.sharedBaseMeshManager=null},t.prototype.retrieveEntityMetaData=function(e){for(var t=0;t<this.components.length;++t){var i=this.components[t].getEntityMetaData(e);if(i)return i}return null},t.prototype.retrieveBodyMetaData=function(e){for(var t=0;t<this.components.length;++t){var i=this.components[t].retrieveBodyMetaData(e);if(i)return i}return null},t.prototype.getEntityIdManager=function(){return this.entityIdManager},t.prototype.extractMeshIncrement=function(e){for(var t=0;t<this.components.length;++t){var i=this.components[t].extractMeshIncrement(e);if(i)return i}return null},t.prototype.getHideableMateConnectorFeatureIds=function(){return this.mateConnectorComponent.getHideableFeatureIds()},t.prototype.getHideableSketchFeatureIds=function(){return this.sketchComponent.getHideableFeatureIds()},t.prototype.getHideablePlaneFeatureIds=function(){return this.planeComponent.getHideableFeatureIds()},t.prototype.getHideableFeatureIds=function(){return this.hideableFeatureIds},t.prototype.processDisplayData=function(e,t,i,r,o){if((this.isBase()?e.buildFullElementId().toString():e.elementId)===(this.isBase()?this.getFullElementId():this.id)){if(this.updateExternalState(e,i),!e.isNoop){var a,c;e.fromDisplayCache&&(this.isCachedPartStudioPendingUse=!0),this.partColorCycle||(this.partColorCycle=e.partColorCycle),this.hideableFeatureIds=[];var h=new n.Timer("processDisplayData");if(e.incremental){var d=new n.Timer("Deleting entities");for(a=0;a<this.components.length;++a)this.components[a].processDeletions(e);d.report()}else this.reset();var p=!this.viewer.getIsForFlattenedDisplay()||!(0,u.isEmptyObjectOrArray)(e.appearanceIdToAppearanceOverride);if(!p)for(var g in e.deterministicPartIdToData)if(e.deterministicPartIdToData[g].isForFlattenedView()){p=!0;break}p||this.bodyComponent.updateBodyDisplayData(e,r);var f=new n.Timer("Updating entities");for(a=0;a<this.components.length;++a){this.viewer.getIsForFlattenedDisplay()&&!p||this.components[a].processAdditionsAndChanges(e,t,r);var m=this.components[a].getHideableFeatureIds();for(c=0;c<m.length;++c)this.hideableFeatureIds.push(m[c])}this.bodyComponent.updateCompositeConstituentCounts(e),f.report(),this.isForIncontextDisplay||this.viewer.getIsForFlattenedDisplay()||this.viewer.getEventDispatcher().trigger(l.NEW_PART_LIST,e.partDisplayData,e.buildFullElementId(),e.usage,this.bodyComponent.bodyMetaData,o),this.dimensionComponent.processDisplayData(e),this.imageComponent.processDisplayData(e),e.incremental||t||this.bodyComponent.reloadOccurrences(),t&&(this.dimensionComponent.updateDisplays(),this.imageComponent.updateDisplays()),this.processInContextData(e,t),this.viewer.getEventDispatcher().trigger(l.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,e,r),h.report()}}else s.log.warn("An attempt was made to update part studio graphics with display data that do not belong to it.")},t.prototype.processInContextData=function(e,t){if(this.isBase()){var i=void 0,r=!1;if(e.assemblyReferenceDisplayData){var n=e.assemblyReferenceDisplayData.assemblyReferences;for(i=0;i<n.length;i++)n[i].visibility===a.GBTBSFeatureVisibility.VISIBLE&&(r=!0)}if(r){if(t){this.referencedInContextAssemblyIds=[],this.visibleInContextAssembly="",this.editedInContextOccurrences=[],this.displayedContextTransform={};var o=function(){var t=e.assemblyReferenceDisplayData.assemblyReferences[i],r=t.isTransient?"":t.referenceNodeId,n=t.assemblyDisplayData;t.occurrencesToExclude.forEach((function(e){this.editedInContextOccurrences.push({assemblyElementId:n.elementId,occurrence:e,contextId:r})}),s);var o=(0,l.getPartstudioElementIdFromContextId)(n.elementId),c=n.elementId;o!==e.assemblyReferenceDisplayData.elementId&&(c=(0,l.getAssemblyInContextElementId)(n.elementId,e.assemblyReferenceDisplayData.elementId,t.referenceNodeId)),s.referencedInContextAssemblyIds.push(c),t.visibility===a.GBTBSFeatureVisibility.VISIBLE&&(s.visibleInContextAssembly=c),s.displayedContextTransform[r]=t.transform},s=this;for(i=0;i<e.assemblyReferenceDisplayData.assemblyReferences.length;i++)o()}}else t&&this.removeInContextAssemblies()}else if(this.viewer.getModelViewManagers().getManager().isDisplayingIncontextAssembly()){(0,l.getActiveViewerEventDispatcher)().trigger(l.UPDATE_INCONTEXT_ISOLATION,!0)}},t.prototype.updateExternalState=function(e,t){this.isExternal=e.isExternal,this.isForIncontextDisplay=!!t},t.prototype.getReferencedInContextAssemblyIds=function(){return this.referencedInContextAssemblyIds},t.prototype.isDisplayingIncontextAssembly=function(){return!!this.visibleInContextAssembly},t.prototype.getVisibleInContextAssemblyId=function(){return this.visibleInContextAssembly},t.prototype.removeInContextAssemblies=function(){this.viewer.getModelViewManagers().getManager().resetAllIncontextGraphicsForPartstudio(this.getElementId()),this.referencedInContextAssemblyIds=[],this.visibleInContextAssembly="",this.editedInContextOccurrences=[]},t.prototype.getEditedOccurrenceForAssembly=function(e,t){var i=(0,c.find)(this.editedInContextOccurrences,{assemblyElementId:e,contextId:t});return i?i.occurrence:null},t.prototype.removeInstantiationForEditing=function(e){this.removeInContextAssemblies();for(var t=0;t<this.components.length;++t)this.components[t].removePartStudioInstantiation(e);this.dimensionComponent.remove(),this.imageComponent.remove()},t.prototype.instantiateForEditingInNode=function(e){this.isCachedPartStudioPendingUse=!1,this.bodyComponent.instantiateForPartStudio(e),this.sketchComponent.instantiateForPartStudio(e),this.mateConnectorComponent.instantiateForPartStudio(e),this.planeComponent.instantiateForPartStudio(e),this.pointBodyComponent.instantiateForPartStudio(e),this.dimensionComponent.updateDisplays()},t.prototype.getDimensionGraphic=function(e,t){return this.dimensionComponent.getDimensionGraphic(e,t)},t.prototype.addOrUpdateOccurrence=function(e,t,i){this.isCachedPartStudioPendingUse=!1,this.sketchComponent.addOrUpdateOccurrence(e,t),this.bodyComponent.addOrUpdateOccurrence(e,t),i&&this.mateConnectorComponent.addOrUpdateOccurrence(e,t)},t.prototype.removeOccurrence=function(e,t){this.sketchComponent.removeOccurrence(e,t),this.bodyComponent.removeOccurrence(e,t),this.mateConnectorComponent.removeOccurrence(e,t)},t.prototype.getChildNodesWithId=function(e,t){for(var i=[],r=t?[t]:this.getSceneGraph().getAllNodesWithId(l.ROOT_ELEMENT_NODE_ID),n=function(t){return t.getId()===e&&i.push(t),!1},o=0;o<r.length;++o)r[o].walk(n);return i},t.prototype.hideSketch=function(e){this.sketchComponent.hideShowFeature(e,l.Visibility.HIDDEN),this.dimensionComponent.sketchHidden(e),this.imageComponent.onSketchHidden(e),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.HIDDEN)},t.prototype.showSketch=function(e){this.sketchComponent.hideShowFeature(e,l.Visibility.VISIBLE),this.dimensionComponent.sketchShown(e),this.imageComponent.onSketchShown(e),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.VISIBLE)},t.prototype.displaySketchAsActive=function(e,t){void 0===t&&(t=!0),this.sketchComponent.displaySketchAsActive(e,t),this.dimensionComponent.displaySketchAsActive(e,t),t?this.imageComponent.onSketchActivated(e):this.imageComponent.onSketchDeactivated(e)},t.prototype.displaySketchAsInactive=function(e){this.displaySketchAsActive(e,!1)},t.prototype.hasActiveSketch=function(){return this.sketchComponent.hasActiveSketch()},t.prototype.getPartNodes=function(e){return this.getChildNodesWithId(l.BodyComponentId,e)},t.prototype.setPlaneAppearance=function(e,t){this.planeComponent.updateFeatureAppearance(e,t)},t.prototype.getBoundsOutsideElementNode=function(){var e=new l.BoundingBox;return e.addBox(this.planeComponent.getVisiblePlaneBounds()),e.addBox(this.dimensionComponent.getVisibleDimensionBounds()),e.addBox(this.mateConnectorComponent.getVisibleMateConnectorBounds()),e},t.prototype.showPointBodies=function(e){this.pointBodyComponent.hideShowFeature(e,l.Visibility.VISIBLE),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.VISIBLE)},t.prototype.hidePointBodies=function(e){this.pointBodyComponent.hideShowFeature(e,l.Visibility.HIDDEN),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.HIDDEN)},t.prototype.hidePart=function(e){this.bodyComponent.hideShowBody(e,l.Visibility.HIDDEN,l.PART_STUDIO_ELEMENT_ID),this.trigger("BODY_VISIBILITY_CHANGE."+e,l.Visibility.HIDDEN)},t.prototype.showPart=function(e){this.bodyComponent.hideShowBody(e,l.Visibility.VISIBLE,l.PART_STUDIO_ELEMENT_ID),this.trigger("BODY_VISIBILITY_CHANGE."+e,l.Visibility.VISIBLE)},t.prototype.changePartColor=function(e,t,i){this.bodyComponent.setBodyColor(e,t,i)},t.prototype.changePartOpacity=function(e,t,i){this.bodyComponent.setBodyOpacity(e,t,i)},t.prototype.getPartColor=function(e){return this.bodyComponent.getBodyColor(e).slice(0)},t.prototype.getPartOpacity=function(e){return this.bodyComponent.getBodyColor(e)[3]},t.prototype.getEntityColor=function(e){return this.bodyComponent.getEntityColor(e)},t.prototype.hideConstructionPlane=function(e){this.planeComponent.hideShowFeature(e,l.Visibility.HIDDEN),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.HIDDEN)},t.prototype.showConstructionPlane=function(e){this.planeComponent.hideShowFeature(e,l.Visibility.VISIBLE),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.VISIBLE)},t.prototype.hideFeatureBodies=function(e,t){this.bodyComponent.hideShowFeature(e,l.Visibility.HIDDEN,t),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.HIDDEN)},t.prototype.showFeatureBodies=function(e,t){this.bodyComponent.hideShowFeature(e,l.Visibility.VISIBLE,t),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.VISIBLE)},t.prototype.hideMateConnector=function(e){this.mateConnectorComponent.hideShowFeature(e,l.Visibility.HIDDEN),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.HIDDEN)},t.prototype.showMateConnector=function(e){this.mateConnectorComponent.hideShowFeature(e,l.Visibility.VISIBLE),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,l.Visibility.VISIBLE)},t.prototype.getEntitiesForFeature=function(e,t){for(var i=[],r=0;r<this.components.length;++r){var n=this.components[r].getEntitiesForFeature(e,t);n&&(i=i.concat(n))}return i},t.prototype.getFilteredEntityIds=function(e){for(var t=[],i=0;i<this.components.length;++i){var r=this.components[i].getEntitiesForFilterFunction(e);r&&(t=t.concat(r))}return t},t.prototype.getEntitiesForSketchGroup=function(e,t,i){return this.sketchComponent.getEntitiesForFeature(t,(function(t){var r=0===t.getSketchGroupId().indexOf(e);return t.isSketchTextEntity()&&(r=r&&["left","right","ascent","baseline"].some((function(e){return t.getSketchEntityId().indexOf(e)>0}))),i&&(r=r&&i(t)),r}))||[]},t.prototype.getEntitiesForBody=function(e,t){for(var i=[],r=0;r<this.components.length;++r){var n=this.components[r].getEntitiesForBody(e,t);n&&(i=i.concat(n))}return i},t.prototype.retrieveSketchEntityDeterministicId=function(e,t){return this.sketchComponent.retrieveSketchEntityDeterministicId(e,t)},t.prototype.onDeletion=function(e){this.reset(e)},t.prototype.hasFeature=function(e){for(var t=0;t<this.components.length;++t)if(this.components[t].hasFeature(e))return!0;return!1},t.prototype.getFeatureVisibility=function(e){for(var t=0;t<this.components.length;++t)if(this.components[t].hasFeature(e))return this.components[t].getFeatureVisibility(e);return l.Visibility.HIDDEN},t.prototype.hasBody=function(e){for(var t=0;t<this.components.length;++t)if(this.components[t].hasBody(e))return!0;return!1},t.prototype.getBodyVisibility=function(e){return this.bodyComponent.isBodyVisible(l.PART_STUDIO_ELEMENT_ID,e)?l.Visibility.VISIBLE:l.Visibility.HIDDEN},t.prototype.getUIElementsForSelection=function(e){var t=[];return(e.isMateConnector()||e.isFeature())&&(t=this.mateConnectorComponent.getUIElementsForSelection(e)),(e.isEntity()||e.isFromConstructionGeometry()||e.isDerivedFeature())&&(t=t.concat(this.planeComponent.getUIElementsForSelection(e))),t},t.prototype.getInContextImportEntityIdsForSelection=function(e){var t=[],i=e.getInContextImports();if(i&&i.length>0)for(var r=0;r<i.length;++r){var n=this.getEntitiesForFeature(i[r],h);t=t.concat(n)}return t||[]},t.prototype.getEntityIdsForSelection=function(e){var t=[];if(e.isMateConnector())t=this.mateConnectorComponent.getEntityIdsForSelection(e);else if(e.isProperty()){if(e.childSelections)for(var i=0;i<e.childSelections.length;++i)t=t.concat(this.getEntityIdsForSelection(e.childSelections[i]))}else if(e.isEntity())t.push(e.getIdString());else if(e.isFeature())t=this.getEntitiesForFeature(e.getIdString(),h);else if(e.isSketchGroup()){var r=e.getSketchGroupFeatureId();r?t=this.getEntitiesForSketchGroup(e.getIdString(),r,h):s.log.info("Sketch group selection did not have a valid sketch id")}else{if(e.isBody())(o=this.getEntityIdsForBodySelection(e.getIdString(),e.getOccurrence(),e.getBodyMetaData()))&&o.length&&(t=t.concat(o));else if(e.isTableItem()){var n=e.getOccurrence();for(i=0;i<e.deterministicIdList.length;++i){var o,a=e.deterministicIdList[i];(o=this.getEntityIdsForBodySelection(a,n,this.retrieveBodyMetaData(a)))&&o.length?t=t.concat(o):t.push(a)}}}return t||[]},t.prototype.getEntityIdsForBodySelection=function(e,t,i){var r=[];r=i&&i.isComposite?i.constituentBodyIds:[e];for(var n=[],o=0;o<r.length;++o){var s=r[o],a=this.retrieveBodyMetaData(s);if(a&&this.bodyComponent.hasBodyOccurrence(a.meshGroupId,t))if(this.bodyComponent.isBodyLoaded(s)){var c=this.getEntitiesForBody(s,d);c&&c.length&&(n=n.concat(c))}else n.push(s);else{var l=this.sketchComponent.getEntitiesForBody(s,h);l&&(n=l)}}return n},t.prototype.getOccurrenceEntityIdsForHighlight=function(e){if(e){var t=this.viewer.getIdForOccurrence(e);return this.sketchComponent.getEntitiesForOccurrenceSelection(t)||[]}return[]},t.prototype.getOccurrencesForSelection=function(e){var t=[];if(e.isMateConnector())t=this.mateConnectorComponent.getOccurrencesForSelection(e);else if(e.isBody()){var i=this.bodyComponent.retrieveBodyMetaData(e.getBodyId());if(i&&!i.hasTessellationSettings()){var r=this.bodyComponent.getPartStudioBodyOccurrenceName(e.getBodyId());t.push(a.BTOccurrence.getOccurrenceFromPathString(r))}}return t},t.prototype.getOccurrenceBounds=function(e){for(var t=new l.BoundingBox,i=0;i<this.components.length;i++){var r=this.components[i];t.addBox(r.getOccurrenceBounds(e))}return t},t.prototype.setPlaneName=function(e,t){this.planeComponent.setPlaneName(e,t)},t.prototype.getMateConnectorGraphics=function(e,t){return this.mateConnectorComponent.getMateConnectorGraphics(e,t)},t.prototype.getMateConnectorData=function(e,t){return this.mateConnectorComponent.getMateConnectorData(e,t)},t.prototype.getAllMateConnectorGraphics=function(e){var t=this,i=[];return this.mateConnectorComponent.featureToIds.each((function(r,n){if(t.hasMateConnectorDefinition(e,n)){var o=t.getMateConnectorGraphics(e,n);o&&(i=i.concat(o))}return!1})),i},t.prototype.hasMateConnectorDefinition=function(e,t){return!!this.getMateConnectorGraphics(e,t)},t.prototype.getStatistics=function(e,t){void 0===t&&(t=!1);var i=this.bodyComponent.getStatistics(e,t),r=this.errorComponent.getEntityCount();return r>0&&(i.errorMessage=this.getFullElementId()+" has "+r+" entities with failed tessellation."),i},t.prototype.getBoundsForEntities=function(e){if(!e||0===e.length)return null;for(var t=new l.BoundingBox,i=0;i<e.length;++i){var r=this.extractMeshIncrement(e[i]);r&&t.addBox(r.getBounds())}return t},t.prototype.getFeatureBounds=function(e){var t=this.getBoundsForEntities(this.getEntitiesForFeature(e,(function(e){return!e.isFromSketch()||e.isUserSketchEntity()})));return t&&t.addBox(this.dimensionComponent.getDimensionBoundsForFeature(e)),t},t.prototype.getEntityBounds=function(e,t){var i=this.retrieveEntityMetaData(e);return i?i.isFromBody()&&!this.bodyComponent.isBodyActiveInView(this.bodyComponent.getEntityBodyGroupId(i),t)?null:this.extractMeshIncrement(e).getBounds():null},t.prototype.getBodyBounds=function(e,t){if(this.bodyComponent.isBodyActiveInView(e,t)){var i=this.retrieveBodyMetaData(e);if(i)return i.getBounds()}return null},t.prototype.getBodyComponent=function(e){return this.bodyComponent},t.prototype.getDimensionComponent=function(){return this.dimensionComponent},t.prototype.getPartStudioBodyOccurrenceIds=function(){return this.bodyComponent.getPartStudioBodyOccurrenceIds()},t.prototype.getPartStudioOccurrenceIds=function(){var e=this.bodyComponent.getPartStudioBodyOccurrenceIds(),t=[this.sketchComponent.sketchComponentElementId],i=this.planeComponent.getPartStudioPlaneOccurrenceIds();return e.concat(t,i)},t.prototype.getContextCameraData=function(e){return this.displayedContextTransform[e]?this.viewer.getCameraData(this.displayedContextTransform[e].getGlMatrix()):{camera:null,cameraExtents:null}},t.prototype.getInstantiatedTriangleCount=function(){return this.bodyComponent.getInstantiatedTriangleCount()},t.prototype.getSketchComponent=function(){return this.sketchComponent},t.prototype.getImageComponent=function(){return this.imageComponent},t.prototype.getMateConnectorComponent=function(){return this.mateConnectorComponent},t.prototype.getIsInternal=function(){return!this.isExternal&&!this.isForIncontextDisplay},t.prototype.getRetainedSize=function(){var e=0;return this.components.forEach((function(t){e+=t.getRetainedSize()}),this),e},t.prototype.getEstimatedMemoryUsageOfBodies=function(){return this.bodyComponent.getEstimatedMemoryUsage()},t.prototype.unloadBody=function(e){this.bodyComponent.unloadBody(e)},t.prototype.getPartStudioOccurrenceIdForSelection=function(e){return e.getOccurrence()?l.INVALID_OCCURRENCE_ID:e.isFromBody()?this.bodyComponent.getCorrectedBodyOccurrenceId(e.getBodyId(),l.PART_STUDIO_ELEMENT_ID):e.isFromSketch()?this.sketchComponent.sketchComponentElementId:e.isConstructionPlane()?this.planeComponent.getSelectionOccurrenceId(e):l.PART_STUDIO_ELEMENT_ID},t.prototype.getBodyTransform=function(e,t){var i=this.bodyComponent,r=i.partStudioBodyIdToOccurrenceId[e];if(!r){var n=t.getModelViewManagers().getManager().alternateEntityMapping.get(e);n&&(r=i.partStudioBodyIdToOccurrenceId[n])}return r?t.getOccurrenceDataManager().getOccurrenceTransform(r):o.mat4.identity()},t.prototype.getMeshOwnerId=function(){return this.meshOwnerId},t.prototype.updateEntityHighlight=function(e,t,i,r){for(var n=0;n<this.components.length&&!this.components[n].updateEntityHighlight(e,t,i,r);++n);},t.prototype.getElementType=function(){return a.GBTElementType.PARTSTUDIO},t.prototype.collectComponentsForHeapDump=function(e){this.bodyComponent.collectComponentsForHeapDump(e)},t.prototype.updatePSOI=function(e){this.bodyComponent.updatePSOI(e)},t}(l.Element);t.PartStudio=p},998250:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyEnabledPartStudioComponent=t.PartStudioComponent=void 0;var r=i(423902),n=i(736202),o=i(311611),s=i(513774),a=i(601759),c=function(){function e(e,t,i){this.parent=e,this.viewer=t,this.idToMetaData={},this.removedBaseIncrements=null,this.featureVisibility={},this.retainedData={},(0,o.viewerCheck)(t),this.usage=void 0===i?o.bt_graphics_Usage.BASE:i,this.featureToIds=new s.TemplatedNestedMap,this.bodyToEntity=new s.TemplatedNestedMap}return e.prototype.copyToClone=function(e){for(var t in e.featureToIds=this.featureToIds.cloneNested(),e.bodyToEntity=this.bodyToEntity.cloneNested(),this.idToMetaData){var i=this.idToMetaData[t],r=(0,a.shallowCloneWithPrototype)(i);e.idToMetaData[t]=r,r.setBodyId(i.getBodyId());var o=e.retrieveBodyMetaData(r.getBodyId());o&&r.setBodyMetaData(o);var s=i.getMeshIncrement();s&&(r.setMeshIncrement(s.clone(e.getMeshOwnerId())),e.isInstantiated()&&e.updateEntityGraphics(t,r.getMeshIncrement(),r))}for(var c in this.retainedData)c=c,e.retainedData[c]=(0,n.clone)(this.retainedData[c])},e.prototype.copyToPreview=function(e){for(var t in this.idToMetaData)e.idToMetaData[t]=this.idToMetaData[t];for(var i in e.featureToIds=this.featureToIds.cloneNested(),e.bodyToEntity=this.bodyToEntity.cloneNested(),this.featureVisibility)e.featureVisibility[i]=this.featureVisibility[i]},e.prototype.reset=function(e){if(this.removedBaseIncrements=null,this.featureToIds.clear(),this.bodyToEntity.clear(),!e)for(var t in this.idToMetaData)this.removeMeshIncrement(t);this.idToMetaData={}},e.prototype.isInstantiated=function(){return!0},e.prototype.isForBase=function(){return this.usage===o.bt_graphics_Usage.BASE},e.prototype.getEntityIdManager=function(){return this.parent.getEntityIdManager()},e.prototype.getMeshManager=function(){return this.parent.getMeshManager()},e.prototype.getSharedBaseMeshManager=function(){return this.parent.getSharedBaseMeshManager()},e.prototype.getMeshOwnerId=function(){return this.parent.getMeshOwnerId()},e.prototype.getBodyManager=function(){return this.viewer.getBodyManager()},e.prototype.tallyEntityRetention=function(e,t){if(e){var i=this.retainedData[e.primitiveType];i||(this.retainedData[e.primitiveType]=i={vertexCount:0,vertexSize:0,indexCount:0}),i.vertexCount+=e.getPreparedVertexCount(),i.indexCount+=e.getPreparedIndexCount(),0===i.vertexSize&&t&&(i.vertexSize=e.getVertexSize(this.viewer))}},e.prototype.decrementEntityRetention=function(e){if(e&&this.retainedData[e.primitiveType]){var t=this.retainedData[e.primitiveType];t.vertexCount-=e.getPreparedVertexCount(),t.indexCount-=e.getPreparedIndexCount()}},e.prototype.getRetainedSize=function(){var e=0;return(0,n.each)(this.retainedData,(function(t){e+=t.vertexCount+t.vertexSize+4*t.indexCount})),e},e.prototype.processDeletions=function(e){for(var t in e.deterministicIdToEntity){var i=e.deterministicIdToEntity[t];i&&(!i.isDeletion()&&this.handlesEntity(i)||this.removeEntity(t))}},e.prototype.processAdditionsAndChanges=function(e,t,i){for(var r in e.deterministicPartIdToData)for(var n=e.deterministicPartIdToData[r],s=0;s<n.entityDIds.length;++s){var a=n.entityDIds[s],c=e.deterministicIdToEntity[a];if(c&&!c.isDeletion()&&this.handlesEntity(c,n)){var l=(0,o.getMeshIncrementForEntityData)(c,a,this.getEntityIdManager().getOrCreateIdForName(a));!l&&this.expectsTessellation()||(this.removeOldEntityGraphics(a,c),this.addIdMappings(a,c,r,e),c.setMeshIncrement(l),this.isInstantiated()?(this.updateEntityGraphics(a,l,c),this.tallyEntityRetention(l,!0)):this.tallyEntityRetention(l,!1),this.viewer.getIsForFlattenedDisplay()===n.isForFlattenedView()&&c.removeGeometry())}}},e.prototype.hasBody=function(e){return this.bodyToEntity.has(e)},e.prototype.retrieveBodyMetaData=function(e){var t=this.bodyToEntity.get(e),i=null;return t&&t.each((function(e,t){var r=this.idToMetaData[t];return r&&(i=r.getBodyMetaData()),!!i}),this),i},e.prototype.getEntitiesForBody=function(e,t){var i=this.bodyToEntity.get(e);return i?(0,o.filterEntitiesWithData)(i,this.idToMetaData,t):null},e.prototype.getHideableFeatureIds=function(){throw"This method should be overridden by a subclass"},e.prototype.updateEntityGraphics=function(e,t,i){throw"This method should be overridden by a subclass"},e.prototype.handlesEntity=function(e,t){throw"This method should be overridden by a subclass"},e.prototype.expectsTessellation=function(){return!0},e.prototype.getEntityCount=function(){return Object.keys(this.idToMetaData).length},e.prototype.containsEntity=function(e){return this.idToMetaData.hasOwnProperty(e)},e.prototype.getEntityMetaData=function(e){var t=this.idToMetaData[e];return t||null},e.prototype.removeEntity=function(e){this.removeBaseIncrement(e);var t=this.idToMetaData[e];t&&(this.removeMeshIncrement(e),this.removeIdMappings(e),this.decrementEntityRetention(t.getMeshIncrement()),this.getEntityIdManager().removeName(e))},e.prototype.extractMeshIncrement=function(e){var t=this.idToMetaData[e];return t?t.getMeshIncrement():null},e.prototype.addMeshIncrement=function(e,t){return e.pickId=this.getEntityIdManager().getOrCreateIdForName(e.id),this.getMeshManager().addMeshIncrement(e,this.getMeshOwnerId(),t)},e.prototype.getOccurrenceData=function(e){return this.viewer.getOccurrenceDataManager().getOccurrenceData(e)},e.prototype.getMeshIncrementDetails=function(e){return this.getMeshManager().getIncrementDetails(e,this.getMeshOwnerId())},e.prototype.getBaseMeshIncrementDetails=function(e){var t=this.getSharedBaseMeshManager();return t?t.getIncrementDetails(e,this.getMeshOwnerId()):null},e.prototype.hideMeshIncrement=function(e,t){var i=this.getOccurrenceData(t),r=this.getMeshIncrementDetails(e);i&&r&&i.hideIncrement(r,this.usage),this.hideBaseIncrement(e,t)},e.prototype.showMeshIncrement=function(e,t){var i=this.getOccurrenceData(t),r=this.getMeshIncrementDetails(e);i&&r&&i.showIncrement(r,this.usage),this.showBaseIncrement(e,t)},e.prototype.removeMeshIncrement=function(e){return this.getMeshManager().removeMeshIncrement(e,this.getMeshOwnerId())},e.prototype.setMeshIncrementRemovedFromBase=function(e,t){this.removedBaseIncrements||(this.removedBaseIncrements=new s.TemplatedNestedMap),this.removedBaseIncrements.insertNested(t,e,!0)},e.prototype.wasIncrementRemovedFromBase=function(e,t){return!!this.removedBaseIncrements&&this.removedBaseIncrements.hasNested(t,e)},e.prototype.removeBaseIncrement=function(e){this.removeBaseIncrementFromOccurrence(e,o.PART_STUDIO_ELEMENT_ID)},e.prototype.removeBaseIncrementFromOccurrence=function(e,t){this.hideBaseIncrement(e,t)&&this.setMeshIncrementRemovedFromBase(e,t)},e.prototype.hideBaseIncrement=function(e,t){var i=this.getSharedBaseMeshManager();if(i){var r=this.getOccurrenceData(t);if(r){var n=i.getIncrementDetails(e,this.getMeshOwnerId());if(n)return r.hideIncrement(n,this.usage),!0}}return!1},e.prototype.showBaseIncrement=function(e,t){var i=this.getSharedBaseMeshManager();if(i&&!this.wasIncrementRemovedFromBase(e,t)){var r=this.getOccurrenceData(t),n=i.getIncrementDetails(e,this.getMeshOwnerId());r&&n&&r.showIncrement(n,this.usage)}},e.prototype.removeOldEntityGraphics=function(e,t){this.removeEntity(e)},e.prototype.addIdMappings=function(e,t,i,r){this.getEntityIdManager().getOrCreateIdForName(e),this.idToMetaData[e]=t;for(var n=t.getFeatureIds(),o=0;n&&o<n.length;++o)this.featureToIds.insertNested(n[o],e,!0);t.setBodyId(i),i&&this.bodyToEntity.insertNested(i,e,!0)},e.prototype.removeIdMappings=function(e){var t=this.idToMetaData[e];if(delete this.idToMetaData[e],t){for(var i=t.getFeatureIds(),r=0;r<i.length;++r)this.featureToIds.removeNested(i[r],e);this.bodyToEntity.removeNested(t.getBodyId(),e)}},e.prototype.hasFeature=function(e){return this.featureToIds.has(e)},e.prototype.getEntitiesForFeature=function(e,t){var i=this.featureToIds.get(e);return i?(0,o.filterEntitiesWithData)(i,this.idToMetaData,t):null},e.prototype.getEntitiesForFilterFunction=function(e){var t=[];for(var i in this.idToMetaData)e(this.idToMetaData[i])&&t.push(i);return t},e.prototype.isEntityHidden=function(e,t){for(var i=e.getFeatureIds(),r=0;r<i.length;++r)if(this.featureVisibility[i[r]]===o.Visibility.HIDDEN)return!0;return!1},e.prototype.getVisibleFeatureIds=function(){var e=[];for(var t in this.featureVisibility)this.featureVisibility[t]!==o.Visibility.HIDDEN&&this.featureToIds.has(t)&&e.push(t);return e},e.prototype.hideShowFeatureEntities=function(e,t){var i=this.getEntitiesForFeature(e);if(i){for(var r=0;r<i.length;++r){var n=this.getOccurrenceIdForEntity(i[r]);this.hideShowEntity(i[r],t,n)}(0,o.requestDraw)()}},e.prototype.hideShowFeature=function(e,t,i){this.featureVisibility[e]=t,this.hideShowFeatureEntities(e,t)},e.prototype.getFeatureVisibility=function(e){return this.featureVisibility.hasOwnProperty(e)?this.featureVisibility[e]:o.Visibility.VISIBLE},e.prototype.hideShowEntity=function(e,t,i){(i=i||o.PART_STUDIO_ELEMENT_ID)!==o.INVALID_OCCURRENCE_ID&&(t===o.Visibility.HIDDEN?this.hideMeshIncrement(e,i):this.showMeshIncrement(e,i))},e.prototype.instantiateForPartStudio=function(e){},e.prototype.instantiateEntities=function(){for(var e in this.idToMetaData){var t=this.idToMetaData[e],i=t.getMeshIncrement();!i&&this.expectsTessellation()||this.updateEntityGraphics(e,i,t)}},e.prototype.removePartStudioInstantiation=function(e){},e.prototype.getNode=function(){return null},e.prototype.getComponentId=function(){throw"This method should be overridden by a subclass"},e.prototype.getOccurrenceIdForEntity=function(e){return null},e.prototype.getOccurrenceBounds=function(e){var t=new o.BoundingBox,i=this.getNode();return i&&i.getOccurrenceBounds(e,t),t},e.prototype.updateEntityHighlight=function(e,t,i,r){if(!this.idToMetaData.hasOwnProperty(i))return!1;var n=this.getOccurrenceData(r),o=this.getMeshIncrementDetails(i)||this.getBaseMeshIncrementDetails(i);return!(!n||!o)&&(n.updateEntityHighlight(e,t,o,this.usage),!0)},e}();t.PartStudioComponent=c;var l=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.occurrences={},n}return(0,r.__extends)(t,e),t.prototype.addOrUpdateOccurrence=function(e,t){this.occurrences[e]=t},t.prototype.removeOccurrence=function(e,t){delete this.occurrences[e]},t.prototype.isOccurrenceIdForAssembly=function(e){return!!this.occurrences[e]},t}(c);t.AssemblyEnabledPartStudioComponent=l},181298:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneComponent=t.PlaneComponentId=void 0;var r=i(423902),n=i(736202),o=i(311611),s=i(73055),a=i(513774),c=i(911748),l=s.default.getManager();t.PlaneComponentId="plane_component.";var u=function(){function e(e,t,i,r){this.entityId=e,this.label="",this.center=null,this.xAxis=null,this.yAxis=null,this.update(t,i,r)}return e.prototype.update=function(e,t,i){this.center=e,this.xAxis=t,this.yAxis=i},e}(),h=function(e){function i(t,i,r){var n=e.call(this,t,r)||this;return n.constructionPlanes={},n.planeNames={},n.planeUi=new a.TemplatedNestedMap,n.usage=void 0!==i?i:o.bt_graphics_Usage.BASE,n}return(0,r.__extends)(i,e),i.prototype.clone=function(e){var t=new i(e,this.usage,this.viewer);return this.copyToClone(t),t},i.prototype.cloneForPreview=function(e){var t=new i(e,o.bt_graphics_Usage.PREVIEW,this.viewer);for(var r in this.copyToPreview(t),this.constructionPlanes)t.constructionPlanes[r]=(0,n.clone)(this.constructionPlanes[r]);return this.planeUi.eachNested((function(e,i,r){return t.planeUi.insertNested(i,r,e.cloneForPreview(i)),!1}),this),t},i.prototype.extractMeshIncrement=function(t){var i=e.prototype.extractMeshIncrement.call(this,t);if(i)return i;var r=this.planeUi.get(t),n=null;return r&&r.each((function(e){return n=e.getIncrement(),!0}),this),n},i.prototype.getVisiblePlaneBounds=function(){var e=new o.BoundingBox;return this.planeUi.eachNested((function(t){return t.isHidden||e.addBox(t.getBounds()),!1}),this),e},i.prototype.reset=function(){this.planeUi.eachNested((function(e){return e.remove(),!1}),this),this.constructionPlanes={},this.planeUi.clear(),e.prototype.reset.call(this)},i.prototype.getComponentId=function(){return t.PlaneComponentId},i.prototype.handlesEntity=function(e,t){return!e.hasTessellationError()&&e.isFromConstructionPlane()&&e.isFace()&&!this.viewer.getIsForFlattenedDisplay()},i.prototype.processAdditionsAndChanges=function(t,i){e.prototype.processAdditionsAndChanges.call(this,t,i),i&&this.instantiateDefaultPlanes(o.PART_STUDIO_OCCURRENCE_ID,null)},i.prototype.updateEntityGraphics=function(e,t,i){t.pickId=this.getEntityIdManager().getOrCreateIdForName(e),this.updatePlaneDefinition(t,i)},i.prototype.getHideableFeatureIds=function(){return this.featureToIds.getKeys()},i.prototype.removeOldEntityGraphics=function(e,t){var i=this.idToMetaData[e];i&&i.getFirstFeatureId()!==t.getFirstFeatureId()&&this.removeEntity(e)},i.prototype.removeEntity=function(t){this.idToMetaData[t]&&(this.removePlaneUiForEntity(t),delete this.constructionPlanes[t]),e.prototype.removeEntity.call(this,t)},i.prototype.removePlaneUiForEntity=function(e){var t=this.planeUi.get(e);t&&(t.each((function(e){return e.remove(),!1})),this.planeUi.remove(e))},i.prototype.getUIElementsForSelection=function(e){var t,i=[],r=e.getOccurrence()?e.getOccurrence().toString():o.PART_STUDIO_OCCURRENCE_ID;return e.isEntity()?(t=this.planeUi.getNested(e.getDeterministicId(),r))&&i.push(t):e.isFeature()&&this.iterateOverEntitiesForFeature(e.getFeatureId(),(function(e){(t=this.planeUi.getNested(e,r))&&i.push(t)})),i},i.prototype.updatePlaneDefinition=function(e,t){if(t.isFace()){var i=e.getBounds().center(),r=c.vec3.createFrom(e.points[0],e.points[1],e.points[2]),n=c.vec3.createFrom(e.points[3],e.points[4],e.points[5]),o=c.vec3.createFrom(e.points[6],e.points[7],e.points[8]),s=c.vec3.add(r,o,c.vec3.create());c.vec3.scale(s,.5),c.vec3.subtract(s,i);var a=c.vec3.add(r,n,c.vec3.create());c.vec3.scale(a,.5),c.vec3.subtract(a,i);var l=this.constructionPlanes[e.id];l?l.update(i,s,a):this.constructionPlanes[e.id]=new u(e.id,i,s,a)}},i.prototype.iterateOverEntitiesForFeature=function(e,t){var i=this.getEntitiesForFeature(e);if(i)for(var r=0;r<i.length;++r)t.call(this,i[r])},i.prototype.getFeatureIdForEntity=function(e){var t=this.idToMetaData[e];return t?t.getFirstFeatureId():""},i.prototype.hideShowFeature=function(t,i,r){e.prototype.hideShowFeature.call(this,t,i,r),this.iterateOverEntitiesForFeature(t,(function(e){var t=this.planeUi.get(e);t&&t.each((function(e){i===o.Visibility.HIDDEN?e.hide():e.show()}))}))},i.prototype.updateFeatureAppearance=function(e,t){this.iterateOverEntitiesForFeature(e,(function(e){var i=this.planeUi.get(e);i&&i.each((function(e){e.updateAppearance(t)}))}))},i.prototype.instantiateForPartStudio=function(t){e.prototype.instantiateForPartStudio.call(this,t),this.instantiateDefaultPlanes(o.PART_STUDIO_OCCURRENCE_ID,null)},i.prototype.removePartStudioInstantiation=function(t){e.prototype.removePartStudioInstantiation.call(this,t),this.removeDefaultPlanesInstantiation(o.PART_STUDIO_OCCURRENCE_ID)},i.prototype.instantiateDefaultPlanes=function(e,t){var i=[];this.planeUi.each((function(e,t){return this.constructionPlanes.hasOwnProperty(t)||i.push(t),!1}),this);for(var r=0;r<i.length;++r)this.removePlaneUiForEntity(i[r]);var n=(0,o.isUsageCompare)()?"DEFAULT_PLANE_COMPARE_TEXT_COLOR":"DEFAULT_PLANE_TEXT_COLOR";for(var s in this.constructionPlanes){var a=this.planeUi.getNested(s,e),c=this.constructionPlanes[s];a||(a=void 0!==this.usage&&this.usage===o.bt_graphics_Usage.PREVIEW?new o.ConstructionPlaneDisplay(l.getColor(n),c.entityId,o.PREVIEW_SCENEGRAPH_ID,this.getFeatureIdForEntity(s),this.viewer):new o.ConstructionPlaneDisplay(l.getColor(n),c.entityId,o.MAIN_SCENEGRAPH_ID,this.getFeatureIdForEntity(s),this.viewer),this.planeUi.insertNested(s,e,a)),a.setTransform(t),a.updateDefinition(c.label,c.center,c.xAxis,c.yAxis,!1);var u=this.idToMetaData[s];if(u){var h=u.getFirstFeatureId();this.featureVisibility[h]===o.Visibility.HIDDEN?a.hide():a.show()}}},i.prototype.getPartStudioPlaneOccurrenceIds=function(){var e=[];return this.planeUi.eachNested((function(t){return e.push(t.graphicsOccurrenceId),!1}),this),e},i.prototype.getSelectionOccurrenceId=function(e){var t=o.INVALID_OCCURRENCE_ID;return this.planeUi.eachNested((function(t,i,r){return e.getDeterministicId()===i&&t.graphicsOccurrenceId,!1}),this),t},i.prototype.removeDefaultPlanesInstantiation=function(e){var t=[];this.planeUi.eachNested((function(i,r,n){return e===n&&(t.push(r),i.remove()),!1}),this);for(var i=0;i<t.length;++i)this.planeUi.removeNested(t[i],e)},i.prototype.setPlaneName=function(e,t){this.planeNames[e]=t,this.iterateOverEntitiesForFeature(e,(function(e){var i=this.constructionPlanes[e];i&&(i.label=t);var r=this.planeUi.get(e);r&&r.each((function(e){e.setName(t)}))}))},i}(o.PartStudioComponent);t.PlaneComponent=h},417595:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointBodyComponent=void 0;var r=i(423902),n=i(311611),o=i(73055).default.getManager(),s=new n.NodeProperties({zOffset:o.getNumber("ORIGIN_Z_OFFSET"),primitiveType:n.PrimitiveType.POINTS,isPickable:!1}),a=new n.NodeProperties({primitiveType:n.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,priority:n.RenderOrderPriority.LOWER}),c=new n.BitShiftId,l=function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.hasBeenInstantiated=!1,o.styledRanges={},o.node=new n.Node(o.getComponentId(),new n.NodeProperties,r),o.instantiateRanges(),o}return(0,r.__extends)(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.node.removeOccurrence(n.PART_STUDIO_ELEMENT_ID),Object.values(this.styledRanges).forEach((function(e){e.getMeshRanges().destroy()}),this),this.styledRanges={},this.instantiateRanges()},t.prototype.getStyleId=function(e,t){return c.reset(),c.addBoolean(e),c.addBoolean(t),c.getId()},t.prototype.instantiateRanges=function(){for(var e=0;e<=1;++e)for(var t=0;t<=1;++t){var i=this.getStyleId(!!e,!!t),r=new n.IncrementRanges("PointBodyComponent."+i);this.usage===n.bt_graphics_Usage.PREVIEW&&r.setListenForDeletions(!0);var c=t?"ORIGIN":"POINT_BODY",l=new n.Style;l.setAttribute(n.Attributes.PRIMITIVE_SIZE,o.getNumber(c+"_SIZE")),l.setAttribute(n.Attributes.PRIMITIVE_STYLE,o.getPointFont(c+"_FONT")),e?l.setAttribute(n.Attributes.COLOR,o.getColor(c+"_COLOR")):l.setAttribute(n.Attributes.COLOR,o.getColor(c+"_SHOWTHROUGH_COLOR"));var u=e?a:s,h=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(n.PART_STUDIO_ELEMENT_ID),d=this.node.addOccurrenceGeometryToNode(u,h,l,r);this.styledRanges[i]=d}},t.prototype.getComponentId=function(){return"point_body_component."},t.prototype.clone=function(e){var i=new t(e,this.viewer,this.usage);return this.copyToClone(i),i},t.prototype.cloneForPreview=function(e){var i=new t(e,this.viewer,n.bt_graphics_Usage.PREVIEW);return this.copyToPreview(i),i.instantiateBaseEntities(),i},t.prototype.instantiateBaseEntities=function(){var e=this.getSharedBaseMeshManager();for(var t in this.idToMetaData){var i=this.idToMetaData[t],r=e.getIncrementDetails(t,this.getMeshOwnerId());i&&r&&this.updateEntityGraphicsFromIncrementDetails(r,t,i)}this.hasBeenInstantiated=!0},t.prototype.isInstantiated=function(){return this.hasBeenInstantiated},t.prototype.instantiateForPartStudio=function(e){this.node.getParent()!==e&&e.addChild(this.node),this.hasBeenInstantiated||(this.instantiateEntities(),this.hasBeenInstantiated=!0)},t.prototype.removePartStudioInstantiation=function(e){e.removeChild(this.node,!0)},t.prototype.handlesEntity=function(e,t){return!e.hasTessellationError()&&e.isPointEntity()&&!this.viewer.getIsForFlattenedDisplay()},t.prototype.getRanges=function(e,t){var i=this.getStyleId(t,e.isFromOrigin()),r=this.styledRanges[i];return r?r.getMeshRanges():null},t.prototype.updateEntityGraphics=function(e,t,i){if(t){var r=this.addMeshIncrement(t);this.updateEntityGraphicsFromIncrementDetails(r,e,i)}},t.prototype.updateEntityGraphicsFromIncrementDetails=function(e,t,i){if(e){var r=this.getRanges(i,!1);r&&r.onIncrementAdded(e);var o=this.getRanges(i,!0);o&&o.onIncrementAdded(e),this.isEntityHidden(i,n.PART_STUDIO_ELEMENT_ID)&&this.hideMeshIncrement(t,n.PART_STUDIO_ELEMENT_ID)}},t.prototype.removeMeshIncrement=function(e){var t=this.getMeshManager().removeMeshIncrement(e,this.getMeshOwnerId());if(!t)return null;var i=this.idToMetaData[e];if(!i)return null;var r=this.getRanges(i,!1);r&&r.onIncrementRemoved(t);var n=this.getRanges(i,!0);return n&&n.onIncrementRemoved(t),t},t.prototype.getHideableFeatureIds=function(){return this.featureToIds.getKeys()},t}(n.PartStudioComponent);t.PointBodyComponent=l},700196:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationManager=void 0;var r=i(423902),n=i(73055),o=i(342211),s=i(194598),a=i(311517),c=i(689397),l=i(765421),u=i(227441),h=i(673290),d=i(516649),p=i(623639),g=i(311611),f="uOffsetFactor",m=[0,.125,.25,.375,.5,.625,.75,.875,.92,1,1,1,1,1,.9,.5,.2,0,-.1,-.11,-.05,0,.02,.02,.01,0,-.01,0,0,0,0,0],y=[{type:u.GBTSimulationColorMapping.VIRIDIS,source:"/images/simulation-gradient-viridis.png"},{type:u.GBTSimulationColorMapping.BLUE_RED,source:"/images/simulation-gradient.png"},{type:u.GBTSimulationColorMapping.RAINBOW,source:"/images/simulation-gradient-rainbow.png"},{type:u.GBTSimulationColorMapping.PLASMA,source:"/images/simulation-gradient-plasma.png"}];function v(e){return y.findIndex((function(t){return t.type===e}))}var E=function(){function e(e){var t=this;this.modelViewManager=e,this.meshOwnerId=(0,g.getNewOwnerId)(),this.nodes=[],this.simulatedOccurrences=[],this.tessellationCache=new Map,this.isAnimating=!1,this.elementIdToResponseData=new Map,s.btInjector.SimulationService&&s.btInjector.SimulationService.getIsAnimatingObservable().subscribe((function(e){e?t.startAnimation():t.stopAnimation()})),s.btInjector.CapabilitiesService.checkFgsSimulationCurrentlyEnabled()&&(this.webAssemblyUtils=g.GraphicsWebAssemblyUtils.module)}return e.prototype.setVisualizationState=function(e){var t=new o.Timer("SimulationManager.setVisualizationState",{setTraceId:!0}),i=!this.visualizationState||!this.visualizationState.field.equals(e.field),r=this.displayedColorMap,n=r!==e.colorMapping,s=!this.visualizationState||!this.visualizationState.visualizedRange.equals(e.visualizedRange);this.visualizationState=e,i&&this.updateGraphics(),n&&this.updateColorMapping(r,this.visualizationState.colorMapping),s&&this.updateVisualizedScalarRange(),t.report()},e.prototype.getSimulationBounds=function(){if(!this.rootNode)return null;var e=this.rootNode.getBoundingBox();return this.isAnimating&&(e=e.clone()).dilate(this.maximumOffset),e},e.prototype.hasSimulationResultsForElement=function(e){return this.elementIdToResponseData.has(e)},e.prototype.updateSimulation=function(e){var t,i,n=new o.Timer("SimulationManager.updateSimulation",{setTraceId:!0});this.prepareResources();try{for(var s=(0,r.__values)(e.simulationTessellations),a=s.next();!a.done;a=s.next()){var c=a.value;this.tessellationCache.set(this.getTessellationCacheKey(c.sourceElement,c.deterministicId),c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}var l,h=!1;if(e.activeSimulationUpdates.length>0&&((l=e.activeSimulationUpdates[0].runStatus)===u.GBTUiSimulationRunStatus.JUST_STARTED||l===u.GBTUiSimulationRunStatus.INVALID_ASSEMBLY))return this.clearSimulationGraphics(),l===u.GBTUiSimulationRunStatus.JUST_STARTED&&this.elementIdToResponseData.delete(e.sourceElementId),void(this.simulationLegend&&this.simulationLegend.clearRanges());var d=e.responses[0];if(d)this.elementIdToResponseData.set(e.sourceElementId,d),h=!0;else{var p=this.modelViewManager.getDisplayedAssembly();p&&l===u.GBTUiSimulationRunStatus.TRANSMITTED&&this.elementIdToResponseData.has(p.elementId)&&(h=!0)}h&&this.updateGraphics(),n.report()},e.prototype.onRenderingModeChanged=function(){this.prepareResources(),this.viewer.getRenderingMode()!==u.GBTGraphicsRenderMode.SIMULATION_RESULTS&&this.clearSimulationGraphics(),this.simulationLegend&&(this.viewer.getRenderingMode()===u.GBTGraphicsRenderMode.SIMULATION_RESULTS?this.showLegend():this.hideLegend())},e.prototype.onAssemblyDisplayed=function(){this.updateGraphics()},e.prototype.onDocumentChange=function(){this.tessellationCache.clear(),this.elementIdToResponseData.clear()},e.prototype.updateGraphics=function(){var e=this;this.clearSimulationGraphics();var t=this.modelViewManager.getDisplayedAssembly();if(t&&!t.isHidden){var i=this.elementIdToResponseData.get(t.elementId);if(i){var r=this.viewer.getOccurrenceIdManager(),o=this.viewer.getOccurrenceDataManager(),s=i.firstResultDataSet;if(s){if(this.visualizationState&&s.isModal===this.visualizationState.field.isModal&&this.viewer.getRenderingMode()===u.GBTGraphicsRenderMode.SIMULATION_RESULTS){this.inputScalarRange=s.getMinMaxScalar(this.displayedSimulatedField),this.inputDisplacementRange=s.getMinMaxScalar(this.displayedSimulatedField.displacementFieldSpecification);for(var c=[],l=0;l<y.length;++l){var h=new g.NodeProperties({material:this.viewer.getResources().simulationGradientMaterials[l],zOffset:n.default.getManager().getNumber("PART_FACES_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLES,includedInBlend:!0,clippedBySectionPlanes:!0,isPickable:!1});c.push(h)}var d=!1;for(var f in s.occurrenceIdToOccurrenceResult){var m=s.occurrenceIdToOccurrenceResult[f],v=u.BTOccurrence.getOccurrenceFromPathString(f),E=r.getIdForName(f);if(E!==g.INVALID_OCCURRENCE_ID){var I=o.getOccurrenceData(E);I||a.log.warn("No occurrence data for "+f);var T=t.getOccurrenceDisplayData(v);if(T){var S=this.modelViewManager.getPartStudioDataFromOccurrence(v);if(S){var P=this.getMeshIncrementForOccurrence(m,T);if(!P){a.log.debug("No simulation tessellation for "+f),d=!0;break}S.getBodyComponent().setSimulatedOccurrence(E),P.id=f;var _=this.meshManager.addMeshIncrement(P,this.meshOwnerId),M=new g.IncrementRanges("Simulated "+f);M.onIncrementAdded(_);var D=S.retrieveBodyMetaData(T.partIds[0]),C=new g.Style;D&&C.setAttribute(g.Attributes.COLOR,D.getColor());for(l=0;l<c.length;++l)this.nodes[l].addOccurrenceGeometryToNode(c[l],I,C,M);if(this.debugMeshEdges){var O=(0,g.createEdgesFromTriangles)(P,P.id+".edges"),A=this.meshManager.addMeshIncrement(O,this.meshOwnerId),R=new g.IncrementRanges("Simulated "+f+" edges");R.onIncrementAdded(A);for(l=0;l<c.length;++l)this.nodes[l].addOccurrenceGeometryToNode(g.MESH_EDGE_NODE_PROPERTIES,I,C,R)}this.simulatedOccurrences.push(f)}else a.log.debug("No part studio for occurrence "+f)}else a.log.warn("No occurrence display data for "+f)}else a.log.warn("No occurrence id for "+f)}d?this.clearSimulationGraphics():(this.cursorAppendage=new g.CursorAppendage(this.viewer,(function(t,i){return e.getCursorText(t,i)})),this.simulationLegend.setInputRange(this.inputScalarRange),this.visualizedScalarRange&&this.simulationLegend.setVisualizedScalarRange(this.visualizedScalarRange),this.updateColorMapping(null,this.displayedColorMap),this.viewer.getEventDispatcher().trigger(p.SIMULATION_RESULTS_DISPLAYED,!0),this.viewer.requestDraw())}}else a.log.debug("No data set to display")}else this.simulationLegend&&this.simulationLegend.clearRanges()}},e.prototype.clearSimulationGraphics=function(){var e,t;this.resetMeshes(),this.resetScenegraphNodes();var i=this.viewer.getOccurrenceIdManager();try{for(var n=(0,r.__values)(this.simulatedOccurrences),o=n.next();!o.done;o=n.next()){var s=o.value,c=u.BTOccurrence.getOccurrenceFromPathString(s),l=i.getIdForName(s);if(l!==g.INVALID_OCCURRENCE_ID){var h=this.modelViewManager.getPartStudioDataFromOccurrence(c);h?h.getBodyComponent().clearSimulatedOccurrence(l):a.log.debug("No part studio for occurrence "+s)}else a.log.warn("No occurrence id for "+s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.simulatedOccurrences=[],this.cursorAppendage&&(this.cursorAppendage.destroy(),this.cursorAppendage=null),this.viewer.getEventDispatcher().trigger(p.SIMULATION_RESULTS_DISPLAYED,!1),this.viewer.requestDraw()},e.prototype.updateVisualizedScalarRange=function(){this.updateScalarRangeUniforms(),this.simulationLegend&&(this.simulationLegend.visualizedFieldType=this.visualizationState.field.type,this.simulationLegend.setVisualizedScalarRange(this.visualizedScalarRange)),this.viewer.requestDraw()},Object.defineProperty(e.prototype,"displayedSimulatedField",{get:function(){return this.visualizationState?this.visualizationState.field:null},enumerable:!1,configurable:!0}),e.prototype.startAnimation=function(){var e=this;if(!this.isAnimating){this.isAnimating=!0;var t=n.default.getManager().getNumber("SIMULATION_DISPLACEMENT_ANIMATION_CYCLE_PERIOD_SEC"),i=-1,r=0;this.viewer.getAnimationController().startAnimation((function(n){if(!e.isAnimating)return p.AnimationCallbackStatus.COMPLETE;if(i>0){r+=(n-i)/1e3/t;var o=e.displayedSimulatedField.isModal?e.getModalOffsetFactor(r):e.getDisplacementOffsetFactor(r),s=e.inputDisplacementRange.max>h.Tolerances.ZERO_LENGTH?o/e.inputDisplacementRange.max:0;e.setSimulationOffsetFactor(e.maximumOffset*s)}return i=n,p.AnimationCallbackStatus.ONGOING}))}},e.prototype.updateColorMapping=function(e,t){this.hideMapping(e),this.showMapping(t),this.updateVisualizedScalarRange(),this.viewer.requestDraw()},Object.defineProperty(e.prototype,"displayedColorMap",{get:function(){return this.visualizationState?this.visualizationState.colorMapping:u.GBTSimulationColorMapping.UNKNOWN},enumerable:!1,configurable:!0}),e.prototype.stopAnimation=function(){this.isAnimating&&(this.isAnimating=!1,this.setSimulationOffsetFactor(0),this.viewer.requestDraw())},e.prototype.setSimulationOffsetFactor=function(e){for(var t=this.viewer.getResources().simulationGradientMaterials,i=0;i<t.length;++i)t[i].setCustomFloatUniform(f,e)},e.prototype.updateScalarRangeUniforms=function(){if(this.inputScalarRange&&this.visualizedScalarRange){var e,t=this.inputScalarRange.max,i=this.inputScalarRange.magnitude,r=1/i;i<=h.Tolerances.ZERO_LENGTH&&(r=0,i<0&&a.log.debug("Invalid scalar input range"));var n=(e=this.displayedSimulatedField.type===u.GBTSimulatedFieldType.STRESS?(0,l.convertRangeToUnits)(this.visualizedScalarRange,u.BTSimulatedStressField.BASE_UNITS):(0,l.convertRangeToUnits)(this.visualizedScalarRange,u.BTSimulatedVectorField.BASE_UNITS)).max,o=e.magnitude,s=1/o;o<=h.Tolerances.ZERO_LENGTH&&(s=0,i<0&&a.log.warn("Invalid visualized scalar range"));for(var c=this.viewer.getResources().simulationGradientMaterials,d=0;d<c.length;++d)c[d].setCustomFloatUniform("uScalarInputMax",t),c[d].setCustomFloatUniform("uScalarInputMagnitudeInverse",r),c[d].setCustomFloatUniform("uScalarOutputMax",n),c[d].setCustomFloatUniform("uScalarOutputMagnitudeInverse",s)}},e.prototype.hideMapping=function(e){var t=v(e),i=this.nodes[t];i&&i.setVisible(!1)},e.prototype.showMapping=function(e){var t=v(e),i=this.nodes[t];i&&i.setVisible(!0),this.simulationLegend&&this.simulationLegend.setActiveColorMapping(e),this.showLegend()},e.prototype.showLegend=function(){this.simulationLegend&&this.simulationLegend.show(),this.viewer.getEventDispatcher().trigger(g.SIMULATION_LEGEND_OPENED,this.viewer.$el[0])},e.prototype.hideLegend=function(){this.simulationLegend&&this.simulationLegend.hide(),this.viewer.getEventDispatcher().trigger(g.SIMULATION_LEGEND_CLOSED)},Object.defineProperty(e.prototype,"visualizedScalarRange",{get:function(){return this.visualizationState?this.visualizationState.visualizedRange:null},enumerable:!1,configurable:!0}),e.prototype.setDebugMeshEdges=function(e){this.debugMeshEdges=e},e.prototype.resetMeshes=function(){this.meshManager&&this.meshManager.destroy(),this.meshManager=new g.MeshManager(this.viewer,{bufferAllocationPolicy:g.BufferAllocationPolicy.MAXIMUM})},e.prototype.resetScenegraphNodes=function(){if(this.rootNode){for(var e=0;e<this.nodes.length;++e)this.nodes[e].remove();this.nodes=[];for(e=0;e<y.length;++e){var t=new g.Node("SimulationManager."+e,{isPickable:!1,clippedBySectionPlanes:!0});t.setVisible(!1),this.nodes.push(t),this.rootNode.addChild(t)}}},Object.defineProperty(e.prototype,"viewer",{get:function(){return this.modelViewManager.getViewer()},enumerable:!1,configurable:!0}),e.prototype.getMeshIncrementForOccurrence=function(e,t){var i=this.tessellationCache.get(this.getTessellationCacheKey(e.sourcePartReference,e.sourcePartReference.partId));if(!i)return null;var r=e.getField(this.displayedSimulatedField);if(!r)return null;var n=e.getField(this.displayedSimulatedField.displacementFieldSpecification);if(!n)return null;var o=this.getSampleMesh(i,e),s=new g.MeshIncrement(g.PrimitiveType.TRIANGLES,o.points,o.getAnyIndices()),c=r.values,l=new Float32Array(s.vertexCount()*g.Attributes.TEXTURE.dimension),h=this.modelViewManager.getPartStudio(e.sourcePartReference);if(h){var d=h.getBodyBounds(i.deterministicId,t.occurrenceData.occurrence);d&&(s.boundingBox=d)}for(var p=[0,0],f=0;f<s.vertexCount();++f)p[1]=c[f],l.set(p,g.Attributes.TEXTURE.dimension*f);return s.textureCoordinates=l,n instanceof u.BTSimulatedVectorField?s.offsetVectors=(0,g.packedNormalsToFloatArray)(n.packedOffsetDirections,n.values):a.log.warn("Unexpected displacement field type"),s},e.prototype.prepareResources=function(){if(0===this.viewer.getResources().simulationGradientMaterials.length)for(var e=0;e<y.length;++e){var t=new g.TextureDefinition(this.viewer.getGlContext());t.imageSource=y[e].source;var i=new g.Texture(this.viewer,t);i.setHasTransparency(!1),this.viewer.getResources().simulationGradientTextures.set(y[e].type,i);var r=(0,g.createTextureMaterial)(i);r.shaderId="simulation",r.setCustomFloatUniform(f,0),r.setCustomFloatUniform("uOcclusionFactor",0),this.viewer.getResources().simulationGradientMaterials.push(r)}if(!this.rootNode){var n="Simulation",o=this.modelViewManager.getSharedBodyNode();this.rootNode=o.getChildById(n),this.rootNode||(this.rootNode=new g.Node(n),o.addChild(this.rootNode))}this.simulationLegend||(this.simulationLegend=new g.SimulationLegend(this.viewer))},e.prototype.getCursorText=function(e,t){var i=this.viewer.findSimulationScalar(this.inputScalarRange,e,t);if(0===i.length)return null;var r=(0,c.getCurrentDocumentSettingsModel)().getUnitForSimulatedField(this.displayedSimulatedField.type),n=(0,l.convertBetweenUnits)(i[0].scalar,this.inputScalarRange.units,r),o=(0,c.getCurrentDocumentSettingsModel)().getLengthUnitsDisplayPrecision(),s=1/Math.pow(10,o);return d.ValueAndUnitsFormatter.getNumberString(n,o,d.PrecisionType.Maximum,s)},e.prototype.getTessellationCacheKey=function(e,t){return e.toString()+"."+t},Object.defineProperty(e.prototype,"maximumOffset",{get:function(){return this.rootNode.getBoundingBox().diameter()*n.default.getManager().getNumber("SIMULATION_DISPLACEMENT_ANIMATION_BOUNDS_RATIO")},enumerable:!1,configurable:!0}),e.prototype.getModalOffsetFactor=function(e){var t=e*Math.PI*2;return Math.sin(t)},e.prototype.getDisplacementOffsetFactor=function(e){return(0,g.interpolateInArray)(m,e)},e.prototype.getSampleMesh=function(e,t){return t.refinementHistory.history.length>0?this.webAssemblyUtils&&this.webAssemblyUtils.isReady?this.webAssemblyUtils.replaySampleMeshRefinementRoutine(e.sampleMesh,t.refinementHistory):(a.log.debug("Received refinement history for simulation data, but sampling utils module was not available"),e.sampleMesh):e.sampleMesh},e}();t.SimulationManager=E},537224:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TemporarySketchComponent=t.SketchComponent=t.SketchComponentId=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(311517),a=i(227441),c=i(736202),l=i(513774),u=i(601759),h=i(311611),d=i(601759),p=n.default.getManager(),g=new h.BitShiftId,f=0;Object.values(a.GBTMGeomStatus).forEach((function(e){(0,c.isNumber)(e)&&(f=Math.max(e,f))}));var m=Math.ceil(Math.log(f)/Math.log(2));t.SketchComponentId="sketch_component.";var y=function(e){function t(t,i,r){var n=e.call(this,t,r,i)||this;return n.activeSketches={},n.hasBeenInstantiated=!1,n.sketchToSMModelIdMapping={},n.idToPartData={},n.sketchToSketchEntityMapping=new l.TemplatedNestedMap,n.styledRanges=new l.TemplatedNestedMap,n.node=t?t.getModelViewManager().getSharedSketchNode():null,n.sketchComponentElementId=n.viewer.getOccurrenceIdManager().getOrCreateIdForName("PART_STUDIO_SKETCHES"),n}return(0,r.__extends)(t,e),t.prototype.getNode=function(){return this.node},t.prototype.isEntityInActiveSketch=function(e){return this.activeSketches.hasOwnProperty(e.getSketchFeatureId())},t.prototype.isSketchInContext=function(e){return e!==this.sketchComponentElementId&&this.viewer.getModelViewManagers().getManager().displayingPartStudio()},t.prototype.updateMissingEntityGraphicsForSketch=function(e,t){var i=this.sketchToSketchEntityMapping.get(e);for(var r in i)if(!t.deterministicIdToEntity[r]){var n=i[r],o=this.idToMetaData[n];if(o){var s=o.getMeshIncrement();s&&(this.removeMeshIncrement(s.id),this.updateEntityGraphics(n,s,o))}}},t.prototype.processAdditionsAndChanges=function(t,i){var r={};for(var n in t.deterministicPartIdToData)for(var o=t.deterministicPartIdToData[n],s=0;s<o.entityDIds.length;++s){var a=o.entityDIds[s],c=t.deterministicIdToEntity[a];c&&!c.isDeletion()&&this.handlesEntity(c,o)&&(c.isAssociatedWithFlat=o.isAssociatedWithFlat,c.isAssociatedWithFlat&&(r[c.getFirstFeatureId()]=o.ownerFlattenedBodyId),this.idToPartData[a]=o)}for(var l in this.sketchToSMModelIdMapping)r[l]||this.updateMissingEntityGraphicsForSketch(l,t);e.prototype.processAdditionsAndChanges.call(this,t,i)},t.prototype.processDeletions=function(t){var i;for(i in t.deterministicIdToEntity){var r=t.deterministicIdToEntity[i];r&&this.handlesEntity(r)&&this.removeEntity(i)}e.prototype.processDeletions.call(this,t)},t.prototype.reset=function(){for(var t in this.idToMetaData)this.removeMeshIncrement(t);for(var i in this.occurrences)this.node.removeOccurrence(+i);this.styledRanges.eachNested((function(e){return e.getMeshRanges().destroy(),!1})),this.styledRanges.clear(),this.sketchToSketchEntityMapping.clear(),this.sketchToSMModelIdMapping={},this.idToPartData={},e.prototype.reset.call(this)},t.prototype.addIdMappings=function(t,i,r,n){e.prototype.addIdMappings.call(this,t,i,r,n);var o=i.getSketchFeatureId();this.sketchToSketchEntityMapping.insertNested(o,i.getSketchEntityId(),t);var s=n&&n.incremental,a=this.idToPartData[t],c=!!a&&!a.isAssociatedWithFlat;s&&c&&(0,h.setSketchNeedsThumbnail)(o)},t.prototype.getSMModelIdForSketch=function(e){return this.sketchToSMModelIdMapping[e]},t.prototype.removeIdMappings=function(t){var i=this.idToMetaData[t];if(i){var r=i.getSketchFeatureId();this.sketchToSketchEntityMapping.removeNested(r,i.getSketchEntityId()),delete this.idToPartData[t],delete this.sketchToSMModelIdMapping[r],e.prototype.removeIdMappings.call(this,t)}},t.prototype.getNodeProperties=function(e,t,i){if(!this.viewer.getResources().sketchFaceMaterial&&this.viewer.getGlContext()){var r=this.viewer.getGlContext(),n=new h.TextureDefinition(r);n.imageSource="/images/sketch-texture-transparent-cardboard.png",n.wrapS=r.REPEAT,n.wrapT=r.REPEAT;var o=new h.Texture(this.viewer,n);this.viewer.getResources().sketchFaceMaterial=(0,h.createTextureMaterial)(o),this.viewer.getResources().sketchFaceMaterial.shaderId="sketches"}var s=p.getNumber("DEFAULT_Z_OFFSET");e.isFace()?s=p.getNumber("SKETCH_FACES_Z_OFFSET"):e.isEdge()?s=p.getNumber("SKETCH_EDGES_Z_OFFSET"):e.isVertex()?s=p.getNumber("SKETCH_POINTS_Z_OFFSET"):e.isDegenerateEdge()&&(s=p.getNumber("DEGENERATE_Z_OFFSET"));var a=h.RenderOrderPriority.DEFAULT;return e.isSketchConstructionEntity()&&e.isEdge()&&((0,h.isUsageCompare)()?t=!1:this.isEntityInActiveSketch(e)||(a=h.RenderOrderPriority.LOWER)),t&&this.isSketchInContext(i)&&(a=h.RenderOrderPriority.LOWER),new h.NodeProperties({primitiveType:(0,h.getEntityPrimitiveType)(e),isTwoSided:e.isFace(),primitivesHaveTransparency:e.isFace(),material:e.isFace()&&t?this.viewer.getResources().sketchFaceMaterial:h.UNLIT_COLOR_FROM_ATTRIBUTE,isPickable:!(t&&e.isFace()),isShowThrough:t,isDepthTested:!t,isStencilTested:t,isHighlightable:!t||e.isSketchConstructionEntity(),zOffset:s,addsToBounds:!e.isVertex()||e.isSketchUserPoint(),priority:a,includedInBlend:!0,isTintedByCompare:!0})},t.prototype.getStyle=function(e,t,i){var r=null,n=null,o=null;if(e.isFace())r=i?p.getColor("SKETCH_FACE_SHOW_THROUGH_COLOR"):p.getColor("SKETCH_FACE_COLOR");else{var s=e.getSketchSolveStatus();r=t?e.isEdge()&&e.isFromSketchSplineHandle()?p.getColor("SPLINE_HANDLE_COLOR"):e.isPreviewEntity?p.getColor("SKETCH_PREVIEW_COLOR"):s&&s!==a.GBTMGeomStatus.UNKNOWN?s===a.GBTMGeomStatus.UNDER_DEFINED?i?p.getColor("UNDERCONSTRAINED_SHOW_THROUGH_LINE_POINT_COLOR"):p.getColor("UNDERCONSTRAINED_LINE_POINT_COLOR"):s===a.GBTMGeomStatus.FIXED||s===a.GBTMGeomStatus.WELL_DEFINED?i?p.getColor("CONSTRAINED_SHOW_THROUGH_LINE_POINT_COLOR"):p.getColor("CONSTRAINED_LINE_POINT_COLOR"):i?p.getColor("OVERCONSTRAINED_SHOW_THROUGH_LINE_POINT_COLOR"):p.getColor("OVERCONSTRAINED_LINE_POINT_COLOR"):i?p.getColor("SHOW_THROUGH_LINE_POINT_COLOR"):p.getColor("LINE_POINT_COLOR"):p.getColor("INACTIVE_SKETCH_COLOR"),e.isVertex()?(n=t?e.isFromSketchSplineHandle()?p.getNumber("ACTIVE_SKETCH_SPLINE_HANDLE_SIZE"):e.isSketchUserPoint()?p.getNumber("ACTIVE_SKETCH_USER_POINT_SIZE"):p.getNumber("ACTIVE_SKETCH_POINT_SIZE"):e.isFromSketchSplineHandle()?p.getNumber("INACTIVE_SKETCH_SPLINE_HANDLE_SIZE"):e.isSketchUserPoint()?p.getNumber("INACTIVE_SKETCH_USER_POINT_SIZE"):p.getNumber("INACTIVE_SKETCH_POINT_SIZE"),o=e.isFromSketchSplineHandle()?p.getPointFont("SKETCH_SPLINE_HANDLE_POINT_FONT"):e.isSketchUserPoint()?p.getPointFont("SKETCH_USER_POINT_FONT"):p.getPointFont("SKETCH_POINT_FONT")):e.isEdge()?(n=t?i?p.getNumber("ACTIVE_SKETCH_SHOW_THROUGH_LINE_WIDTH"):e.isFromSketchSplineHandle()?p.getNumber("SPLINE_HANDLE_LINE_WIDTH"):p.getNumber("ACTIVE_SKETCH_LINE_WIDTH"):i?p.getNumber("INACTIVE_SKETCH_SHOW_THROUGH_LINE_WIDTH"):e.isFromSketchSplineHandle()?p.getNumber("INACTIVE_SKETCH_SPLINE_HANDLE_SIZE"):p.getNumber("INACTIVE_SKETCH_LINE_WIDTH"),o=e.isSketchConstructionEntity()&&!e.isFromSketchSplineHandle()?p.getStipple("CONSTRUCTION_LINE_STIPPLE"):t?p.getStipple("DEFAULT_LINE_STIPPLE"):i?p.getStipple("DEFAULT_SHOW_THROUGH_LINE_STIPPLE"):p.getStipple("DEFAULT_LINE_STIPPLE")):e.isDegenerateEdge()&&(n=t?p.getNumber("DEGENERATE_EDGE_ACTIVE_SIZE"):p.getNumber("DEGENERATE_EDGE_INACTIVE_SIZE"),o=t?p.getPointFont("SKETCH_DEGENERATE_EDGE_FONT"):p.getPointFont("SKETCH_POINT_FONT"))}e.isFace()&&(0,h.isUsageCompare)()&&(r=(0,h.getPlaneEquationColor)(this.getEntityPlaneId(e)));var c=new h.Style;return r&&c.setAttribute(h.Attributes.COLOR,r),null!==n&&c.setAttribute(h.Attributes.PRIMITIVE_SIZE,n),o&&c.setAttribute(h.Attributes.PRIMITIVE_STYLE,o),c},t.prototype.getEntityPlaneId=function(e){if(!e.isFace())return 0;var t=e.getMeshIncrement();if(!t)return 0;var i=t.points,r=t.normals;return(0,h.getPlaneEquationId)([i[0],i[1],i[2]],[r[0],r[1],r[2]])},t.prototype.handlesEntity=function(e,t){var i=t&&this.viewer.getIsForFlattenedDisplay()&&!t.isForFlattenedView();return!e.hasTessellationError()&&e.isFromSketch()&&!i},t.prototype.getOwnerFlattenedBodyIdForSketch=function(e){var t=this.sketchToSketchEntityMapping.get(e);if(!t)return null;var i=null;return t.each((function(e,t){var r=this.idToPartData[e];if(r)return r.isAssociatedWithFlat&&(i=r.ownerFlattenedBodyId),!0}),this),i},t.prototype.getOwnerFlattenedBodyId=function(e){var t=this.idToPartData[e];return t&&t.isAssociatedWithFlat?t.ownerFlattenedBodyId:null},t.prototype.getTransformForSketchEntity=function(e){var t=this.getOwnerFlattenedBodyId(e),i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(t&&i){var r=i.retrieveBodyMetaData(t);if(r)return i.getBodyComponent().getTransformFromSheetMetalBodyMetaData(r)}return o.mat4.identity()},t.prototype.updateEntityGraphics=function(e,t,i){if(t){if(this.viewer.getIsForFlattenedDisplay()){var r=this.getOwnerFlattenedBodyId(e);if(this.parent&&r){var n=this.parent.retrieveBodyMetaData(r);if(n){this.sketchToSMModelIdMapping[i.getSketchFeatureId()]=n.sheetMetalModelId;var o=this.parent.getBodyComponent().getTransformFromSheetMetalBodyMetaData(n);o&&(t=t.createTransformed(o))}}}var s;for(s in this.addMeshIncrement(t),this.occurrences)s=+s,this.isEntityForDisplay(e,s)&&this.updateEntityOccurrenceGraphics(e,s,i)}},t.prototype.getOccurrenceIdForEntity=function(e){return this.sketchComponentElementId},t.prototype.getHideableFeatureIds=function(){return this.featureToIds.getKeys()},t.prototype.copySketchDataToClone=function(e){e.sketchToSketchEntityMapping=this.sketchToSketchEntityMapping.cloneNested(),e.idToPartData=(0,u.shallowCloneWithPrototype)(this.idToPartData),e.sketchToSMModelIdMapping=(0,u.shallowCloneWithPrototype)(this.sketchToSMModelIdMapping)},t.prototype.clone=function(e){var i=new t(e,this.usage,this.viewer);return this.copyToClone(i),this.copySketchDataToClone(i),i},t.prototype.cloneForPreview=function(e){var i=new t(e,h.bt_graphics_Usage.PREVIEW,this.viewer);for(var r in this.copyToPreview(i),this.copySketchDataToClone(i),this.activeSketches)i.activeSketches[r]=this.activeSketches[r];for(var n in i.hasBeenInstantiated=!0,this.occurrences)i.addOrUpdateOccurrence(+n,this.occurrences[n]);return i},t.prototype.removeMeshIncrement=function(e){var t,i=this.getMeshManager().removeMeshIncrement(e,this.getMeshOwnerId());if(!i)return null;for(t in this.occurrences){var r=this.occurrences[t];t=+t,r&&!r.containsPart(e)||this.removeEntityFromOccurrence(e,t,i)}return i},t.prototype.removeEntityFromOccurrence=function(e,t,i){var r=this.idToMetaData[e];if(r&&(i||(i=this.getMeshManager().getIncrementDetails(e,this.getMeshOwnerId())))){var n=this.isSketchDisplayedAsActive(r.getSketchFeatureId(),t);this.getRanges(r,t,n,!1).onIncrementRemoved(i),this.getRanges(r,t,n,!0).onIncrementRemoved(i)}},t.prototype.displaySketchAsActive=function(e,t){this.activeSketches.hasOwnProperty(e)!==t&&(this.clearSketchGraphics(e),t?this.activeSketches[e]=!0:delete this.activeSketches[e],this.instantiateSketchGraphics(e),this.hideShowFeature(e,t?h.Visibility.VISIBLE:h.Visibility.HIDDEN))},t.prototype.isSketchDisplayedAsActive=function(e,t){return t===this.sketchComponentElementId&&this.activeSketches.hasOwnProperty(e)},t.prototype.hasActiveSketch=function(){return!(0,d.isEmptyObjectOrArray)(this.activeSketches)},t.prototype.resetPrimitiveAttributes=function(e,t){this.clearSketchGraphics(e,t),this.instantiateSketchGraphics(e,t)},t.prototype.clearSketchGraphics=function(e,t){var i=this.featureToIds.get(e);if(i&&(t=t||this.sketchComponentElementId,this.occurrences.hasOwnProperty(t)))for(var r=i.getKeys(),n=0;n<r.length;n++)this.removeEntityFromOccurrence(r[n],t)},t.prototype.isEntityForDisplay=function(e,t){var i=this.idToPartData[e],r=!i||i.isAssociatedWithFlat,n=this.occurrences[t];return!n&&r===this.viewer.getIsForFlattenedDisplay()||!!n&&n.containsPart(e)},t.prototype.instantiateSketchGraphics=function(e,t){var i=this.featureToIds.get(e);if(i&&(t=t||this.sketchComponentElementId,this.occurrences.hasOwnProperty(t)))for(var r=i.getKeys(),n=0;n<r.length;n++){var o=r[n],s=this.idToMetaData[o];s&&(this.isEntityForDisplay(o,t)&&this.updateEntityOccurrenceGraphics(o,t,s))}},t.prototype.retrieveSketchEntityDeterministicId=function(e,t){var i=this.sketchToSketchEntityMapping.getNested(e,t);return i||null},t.prototype.isInstantiated=function(){return this.hasBeenInstantiated},t.prototype.instantiateForPartStudio=function(t){e.prototype.instantiateForPartStudio.call(this,t),this.addOrUpdateOccurrence(this.sketchComponentElementId,null)},t.prototype.removePartStudioInstantiation=function(t){this.usage===h.bt_graphics_Usage.PREVIEW&&e.prototype.removePartStudioInstantiation.call(this,t),this.removeOccurrence(this.sketchComponentElementId,!0)},t.prototype.addOrUpdateOccurrence=function(t,i){this.hasBeenInstantiated||(this.instantiateEntities(),this.hasBeenInstantiated=!0);var r=this.addOrUpdateOccurrenceFromMeshManager(t,i,this.getMeshManager()),n=this.getSharedBaseMeshManager();n&&this.addOrUpdateOccurrenceFromMeshManager(t,i,n);var o=t===this.sketchComponentElementId;(r||o||this.occurrences.hasOwnProperty(t))&&e.prototype.addOrUpdateOccurrence.call(this,t,i)},t.prototype.addOrUpdateOccurrenceFromMeshManager=function(e,t,i){var n=this;if(t){for(var o=null,s=0;s<t.partIds.length;++s){var a=t.partIds[s];if(this.idToMetaData.hasOwnProperty(a))o||(o=new Set),o.add(a);else{var c=this.parent.retrieveBodyMetaData(a);if(c&&c.isComposite&&c.constituentBodyIds)for(var l=0;l<c.constituentBodyIds.length;++l){var u=c.constituentBodyIds[l],d=this.bodyToEntity.get(u);d&&(o||(o=new Set),d.each((function(e,t){o.add(t)})))}}}if(!o||0===o.size)return!1;var p=this.occurrences[e]?this.occurrences[e].displayedSketchEntityIds:new Set,g=(0,h.setSubtract)(o,p);return t.displayedSketchEntityIds=o,this.updateEntitiesOccurrences(e,t,g,o,i),!0}if(!this.occurrences.hasOwnProperty(e)){var f=new Set;Object.entries(this.idToMetaData).forEach((function(t){var i=(0,r.__read)(t,2),o=i[0];i[1];n.isEntityForDisplay(o,e)&&f.add(o)})),this.updateEntitiesOccurrences(e,t,f,f,i)}return!0},t.prototype.updateEntitiesOccurrences=function(e,t,i,n,o){var a,c,l,u;if(i)try{for(var d=(0,r.__values)(i),p=d.next();!p.done;p=d.next()){var g=p.value,f=this.idToMetaData[g];f?this.updateEntityOccurrenceGraphics(g,e,f,o):s.log.warn("Could not find meta data for entity")}}catch(e){a={error:e}}finally{try{p&&!p.done&&(c=d.return)&&c.call(d)}finally{if(a)throw a.error}}if(t){var m=t.isHidden?h.Visibility.HIDDEN:h.Visibility.VISIBLE;try{for(var y=(0,r.__values)(n),v=y.next();!v.done;v=y.next()){g=v.value;this.hideShowEntity(g,m,e)}}catch(e){l={error:e}}finally{try{v&&!v.done&&(u=y.return)&&u.call(y)}finally{if(l)throw l.error}}}},t.prototype.getRanges=function(e,t,i,r){g.reset(),g.addBoolean(i),g.addBoolean(r),g.addBoolean(e.isPreviewEntity),g.addBoolean(e.isFace()),g.addBoolean(e.isEdge()),g.addBoolean(e.isVertex()),g.addBoolean(e.isDegenerateEdge()),g.addBoolean(e.isSketchConstructionEntity()),g.addBoolean(e.isSketchUserPoint()),g.addBoolean(e.isFromSketchSplineHandle()),g.addNumber(e.getSketchSolveStatus(),m);var n=g.getId();(0,h.isUsageCompare)()&&(n=g.getIdWithIdAppended(this.getEntityPlaneId(e)));var o=this.styledRanges.getNested(t,n);if(!o){var s=this.getNodeProperties(e,r,t),a=this.getStyle(e,i,r),c=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(t),l=new h.IncrementRanges("SketchComponent."+t+"."+n);this.usage===h.bt_graphics_Usage.PREVIEW&&l.setListenForDeletions(!0),o=this.node.addOccurrenceGeometryToNode(s,c,a,l),this.styledRanges.insertNested(t,n,o)}return o.getMeshRanges()},t.prototype.updateEntityOccurrenceGraphics=function(e,t,i,r){var n=this.isSketchDisplayedAsActive(i.getSketchFeatureId(),t),o=(r=r||this.getMeshManager()).getIncrementDetails(e,this.getMeshOwnerId());o&&(this.getRanges(i,t,n,!1).onIncrementAdded(o),this.getRanges(i,t,n,!0).onIncrementAdded(o),(this.isEntityHidden(i,t)||!n&&i&&i.isFromSketchSplineHandle())&&this.hideMeshIncrement(e,t))},t.prototype.isEntityHidden=function(t,i){if(i===this.sketchComponentElementId)return e.prototype.isEntityHidden.call(this,t,i);var r=this.occurrences[i];return!!r&&r.isHidden},t.prototype.removeOccurrence=function(t,i){this.occurrences.hasOwnProperty(t)&&(this.styledRanges.remove(t),this.node.removeOccurrence(t),e.prototype.removeOccurrence.call(this,t,i))},t.prototype.getEntitiesForOccurrenceSelection=function(e){var t,i,n=this.occurrences[e];if(n&&n.displayedSketchEntityIds){var o=[];try{for(var s=(0,r.__values)(n.displayedSketchEntityIds),a=s.next();!a.done;a=s.next()){var c=a.value,l=this.idToMetaData[c];l&&!l.isFromSketchSplineHandle()&&o.push(c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return o}return null},t.prototype.updateEntityHighlight=function(t,i,r,n){var o=n,s=this.idToMetaData[r];return!(s&&n===h.PART_STUDIO_ELEMENT_ID&&(o=this.sketchComponentElementId,!this.isSketchDisplayedAsActive(s.getSketchFeatureId(),o)&&s.isFromSketchSplineHandle()))&&(!(this.viewer.getIsForFlattenedDisplay()&&(!s||this.sketchToSMModelIdMapping[s.getSketchFeatureId()]!==this.viewer.getModelViewManagers().getManager().getSelectedSheetmetalModelId()))&&e.prototype.updateEntityHighlight.call(this,t,i,r,o))},t.prototype.hideShowFeature=function(e,t,i){this.featureVisibility[e]=t;var r=this.sketchToSMModelIdMapping[e],n=this.viewer.getModelViewManagers().getManager();r&&n.hasSelectedSheetmetalModelId()&&r!==n.selectedSheetmetalModelId||this.hideShowFeatureEntities(e,t)},t.prototype.hideShowFeatureEntities=function(e,t){var i=this.getEntitiesForFeature(e);if(i){for(var r=this.activeSketches.hasOwnProperty(e),n=0;n<i.length;++n){var o=this.idToMetaData[i[n]],s=t;!r&&o&&o.isFromSketchSplineHandle()&&(s=h.Visibility.HIDDEN);var a=this.getOccurrenceIdForEntity(i[n]);this.hideShowEntity(i[n],s,a)}this.viewer.requestDraw()}},t.prototype.showPartsWithSheetmetalModelIdOnly=function(e){for(var t in this.sketchToSMModelIdMapping){this.sketchToSMModelIdMapping[t]===e?this.hideShowFeatureEntities(t,this.featureVisibility[t]):this.hideShowFeatureEntities(t,h.Visibility.HIDDEN)}},t.prototype.getFeatureIdForOccurrence=function(e){var t,i,n=this.occurrences[e];if(!n||!n.displayedSketchEntityIds)return null;try{for(var o=(0,r.__values)(n.displayedSketchEntityIds),s=o.next();!s.done;s=o.next()){var a=s.value,c=this.idToMetaData[a];if(c)return c.getSketchFeatureId()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}return null},t.prototype.getEntityTypesContainedWithinSketch=function(e){var t=this,i=new Set,r=this.featureToIds.get(e);return r?(r.each((function(e,r){return i.add(t.idToMetaData[r].getEntityType()),i.has(a.GBTEntityType.VERTEX)&&i.has(a.GBTEntityType.EDGE)&&i.has(a.GBTEntityType.FACE)}),this),i.size>0&&i.add(a.GBTEntityType.BODY),i):i},t}(h.AssemblyEnabledPartStudioComponent);t.SketchComponent=y;var v=new h.IdManager,E=function(e){function t(t){var i=e.call(this,null,h.bt_graphics_Usage.BASE,t)||this;return i.idManager=new h.IdManager,i.temporarySketchId=v.getId(),i.node=new h.Node(h.TEMPORARY_SKETCH_COMPONENT_NODE_ID+i.temporarySketchId),i.meshManager=new h.MeshManager(t,{bufferAllocationPolicy:h.BufferAllocationPolicy.MEDIUM}),i.entityIdManager=new h.NamedIdManager,i.viewer.getSceneGraphs().getMainSceneGraph().getRootNode().addChild(i.node),i.viewer.getModelViewManagers().getManager().addTemporarySketchComponent(i),i.instantiateForPartStudio(i.node),i}return(0,r.__extends)(t,e),t.prototype.remove=function(){this.viewer.getModelViewManagers().getManager().removeTemporarySketchComponent(this),this.node.remove(),v.freeId(this.temporarySketchId),this.temporarySketchId=h.INVALID_ID,this.reset()},t.prototype.getUniqueId=function(){return this.temporarySketchId},t.prototype.addTemporaryEntity=function(e,t){var i=this.idManager.getId().toString(),r=new a.BTPartData;r.isAssociatedWithFlat=this.viewer.getIsForFlattenedDisplay(),this.idToPartData[i]=r,e.id=i,this.idToMetaData[i]=t,this.featureToIds.insertNested(this.temporarySketchId.toString(),i,!0),this.updateEntityGraphics(i,e,t)},t.prototype.updateTemporaryEntity=function(e,t,i){this.removeEntity(e);var r=new a.BTPartData;r.isAssociatedWithFlat=this.viewer.getIsForFlattenedDisplay(),this.idToPartData[e]=r,t.id=e,this.idToMetaData[e]=i,this.featureToIds.insertNested(this.temporarySketchId.toString(),e,!0),this.updateEntityGraphics(e,t,i)},t.prototype.reset=function(){e.prototype.reset.call(this),this.idManager.reset(),this.entityIdManager.reset()},t.prototype.isEntityInActiveSketch=function(e){return!0},t.prototype.isSketchDisplayedAsActive=function(e,t){return!0},t.prototype.getNodeProperties=function(t,i,r){var n=e.prototype.getNodeProperties.call(this,t,i,r);return n.isPickable=!1,n.includedInBlend=!1,n.updateId(),n},t.prototype.getEntityIdManager=function(){return this.entityIdManager},t.prototype.getMeshManager=function(){return this.meshManager},t.prototype.getSharedBaseMeshManager=function(){return null},t.prototype.getMeshOwnerId=function(){return"t"},t.prototype.updateEntityHighlight=function(e,t,i,r){return r===h.PART_STUDIO_ELEMENT_ID&&(r=this.sketchComponentElementId),h.PartStudioComponent.prototype.updateEntityHighlight.call(this,e,t,i,r)},t}(y);t.TemporarySketchComponent=E},315490:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SnapIndicator=void 0;var r=i(423902),n=i(73055),o=i(311611),s=new o.NodeProperties({isShowThrough:!0,isDepthTested:!1,isPickable:!1,primitiveType:o.PrimitiveType.LINES}),a=n.default.getManager(),c=function(e){function t(t){return e.call(this,t)||this}return(0,r.__extends)(t,e),t.prototype.updateLines=function(e){(0,o.addSizeToIncrement)(a.getNumber("INFERENCE_SNAP_LINE_WIDTH"),e),(0,o.addColorToIncrement)(a.getColor("INFERENCE_SNAP_LINE_COLOR"),e),this.updateMeshIncrement("lines",o.NO_SELECTION_ID,e,s)},t}(o.UIElement);t.SnapIndicator=c},628980:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SplineHandle=void 0;var r=i(423902),n=i(311611),o=i(73055),s=new n.NodeProperties({isShowThrough:!0,isDepthTested:!1,isStencilTested:!0,isPickable:!1,priority:n.RenderOrderPriority.LOWER,primitiveType:n.PrimitiveType.LINES}),a=new n.NodeProperties({isPickable:!1,primitiveType:n.PrimitiveType.LINES}),c=o.default.getManager(),l=function(e){function t(t,i,r){var n=e.call(this,t)||this;if(n.handleRoot=null,n.handleHead=null,i){var o=i.get("geometry"),s=o.interpolationPoints.length;r?(n.handleRoot=[o.interpolationPoints[0],o.interpolationPoints[1]],n.handleHead=[o.startHandleX,o.startHandleY]):(n.handleRoot=[o.interpolationPoints[s-2],o.interpolationPoints[s-1]],n.handleHead=[o.endHandleX,o.endHandleY])}return n.updateLines(),n}return(0,r.__extends)(t,e),t.prototype.updateEndpoints=function(e,t){this.handleRoot=t,this.handleHead=e,this.updateLines()},t.prototype.updateLines=function(){if(this.handleRoot&&this.handleHead){var e=this.viewer.getSketch();if(e){var t=[e.planeToWorld(this.handleRoot),e.planeToWorld(this.handleHead)],i=(0,n.createLines)(t);(0,n.addSizeToIncrement)(c.getNumber("SPLINE_HANDLE_LINE_WIDTH"),i),(0,n.addColorToIncrement)(c.getColor("SPLINE_HANDLE_COLOR"),i),this.updateMeshIncrement("lines",n.NO_SELECTION_ID,i,s),this.updateMeshIncrement("dp.lines",n.NO_SELECTION_ID,i.clone(),a)}}},t}(n.UIElement);t.SplineHandle=l},130098:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.registerDragHelper=void 0,i(733794),t.registerDragHelper=function(){var e,t;t=null,(e=r)(document).on("mouseup",(function(e){t=null})),e.widget("bti.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,(function(e){return t._mouseDown(e)})).on("click."+this.widgetName,(function(i){if(!0===e.data(i.target,t.widgetName+".preventClickEvent"))return e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1})),this.started=!1,this.buttonState={leftButton:!1,middleButton:!1,rightButton:!1}},_mouseDestroy:function(){if(this.element.off("."+this.widgetName),this._mouseMoveDelegate){e(document).off("mousemove."+this.widgetName,this._mouseMoveDelegate);for(var t=1;t<=3;++t)e(document).off("mouseup."+this.widgetName+t,this._mouseUpDelegate)}},_mouseDown:function(i){if(!t||t===this){this._mouseDownEvent=i;var r=this;return!!("string"==typeof this.options.cancel&&i.target.nodeName&&e(i.target).closest(this.options.cancel).length||!this._mouseCapture(i))||(1===i.which?this.buttonState.leftButton=!0:2===i.which?this.buttonState.middleButton=!0:3===i.which&&(this.buttonState.rightButton=!0),this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout((function(){r.mouseDelayMet=!0}),this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=!1!==this._mouseStart(i),!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate||(this._mouseMoveDelegate=function(e){return r._mouseMove(e)},e(document).on("mousemove."+this.widgetName,this._mouseMoveDelegate)),this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).on("mouseup."+this.widgetName+i.which,this._mouseUpDelegate),i.preventDefault(),t=this,!0))}},_mouseMove:function(t){return e.ui.ie&&document.documentMode<9&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(i){e(document).off("mouseup."+this.widgetName+i.which,this._mouseUpDelegate),1===i.which?this.buttonState.leftButton=!1:2===i.which?this.buttonState.middleButton=!1:3===i.which&&(this.buttonState.rightButton=!1);var r=!this.buttonState.leftButton&&!this.buttonState.middleButton&&!this.buttonState.rightButton;return r&&(t=null,e(document).off("mousemove."+this.widgetName,this._mouseMoveDelegate),this._mouseMoveDelegate=null),this._mouseStarted&&r?(i.target===this._mouseDownEvent.target&&e.data(i.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(i),this._mouseStarted=!1):this._mouseStarted&&this._mouseDrag(i),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}}),e.widget("bti.dragHelper",e.bti.mouse,{widgetEventPrefix:"dragHelper",options:{onStart:function(e){},onDrag:function(e){},onStop:function(e){}},_create:function(){this._mouseInit(),this._dragging=!1},destroy:function(){return this.element.off(".dragHelper"),this._mouseDestroy(),this},dragging:function(){return this._dragging},cancelDragging:function(t){return this.buttonState.leftButton=!1,this.buttonState.middleButton=!1,this.buttonState.rightButton=!1,e.bti.mouse.prototype._mouseUp.call(this,t)},_mouseStart:function(e,t){this._dragging=!0,this.lastX=e.pageX,this.lastY=e.pageY,this.options.onStart.call(this,e,t)},_mouseDrag:function(e){this.options.onDrag.call(this,e,e.pageX-this.lastX,e.pageY-this.lastY),this.lastX=e.pageX,this.lastY=e.pageY},_mouseStop:function(e){this._dragging=!1,this.options.onStop.call(this,e)}})}},274208:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlitFramebufferPass=t.BlitBufferedPass=t.BlitPass=void 0;var r=i(423902),n=function(e){function t(t){var i=e.call(this,t,null)||this;return i.blendPass=!0,i.shader=null,i}return(0,r.__extends)(t,e),t.prototype.usesShader=function(){return!0},t.prototype.preDraw=function(e){this.initializeShader(),e.getState().capture();var t=this.viewer.getGlContext();this.blendPass?(t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):t.disable(t.BLEND),t.disable(t.DEPTH_TEST),e.getState().callGl("depthMask",!1),e.activateShader(this.shader);var i=this;return Object.entries(this.inputs).forEach((function(e){var t=(0,r.__read)(e,2),n=t[0],o=t[1];i.shader.useTexture(n,o.getColorTexture())})),e.nodeFilter=function(e){return!0},!0},t.prototype.drawBlitNodes=function(e){this.viewer.getResources().getBlitNode().draw(e)},t.prototype.draw=function(e){this.enabled&&(e.setActivePass(this),this.preDraw(e)&&(this.justBeforeDraw(e),this.drawBlitNodes(e),this.justAfterDraw(e),this.postDraw(e)))},t.prototype.postDraw=function(e){var t=this.viewer.getGlContext();t.disable(t.BLEND),t.enable(t.DEPTH_TEST),e.getState().restore()},t}(i(311611).DrawPass);t.BlitPass=n;var o=function(e){function t(t,i,r){var n=e.call(this,t)||this;return r=r||{},n.shaderTag=r.shaderTag?r.shaderTag:"drawTexture",n.inputs.uTexture=i,n.performDrawInputs=void 0!==r.performDrawInputs,n.viewport=r.viewport,n}return(0,r.__extends)(t,e),t.prototype.drawInputs=function(e){},t.prototype.preDraw=function(t){return this.performDrawInputs&&e.prototype.drawInputs.call(this,t),this.viewport&&t.pushViewport(this.viewport),!!e.prototype.preDraw.call(this,t)||(this.viewport&&t.popViewport(),!1)},t.prototype.postDraw=function(t){this.viewport&&t.popViewport(),e.prototype.postDraw.call(this,t)},t}(n);t.BlitBufferedPass=o;var s=function(e){function t(t,i){var r=e.call(this,t)||this;return r.frameBuffer=i,r.shaderTag="drawTexture",r}return(0,r.__extends)(t,e),t.prototype.preDraw=function(e){this.initializeShader(),e.getState().capture();var t=this.viewer.getGlContext();return t.disable(t.BLEND),e.getState().callGl("depthMask",!1),e.activateShader(this.shader),this.shader.useTexture("uTexture",this.frameBuffer.getTexture()),e.nodeFilter=function(){return!0},!0},t}(n);t.BlitFramebufferPass=s},355003:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BodyCheckPass=t.BodyCheckCustomPass=void 0;var r=i(423902),n=i(163113),o=i(911748),s=i(311517),a=i(712197),c=i(227441),l=i(320078),u=i(997862),h=i(311611),d=function(e){function t(t,i){return e.call(this,t,i,null)||this}return(0,r.__extends)(t,e),t.prototype.preDraw=function(e){this.initializeShader(),e.activateShader(this.shader),this.shader.uniform1f("uSectionPlaneCount",0);var t=this;return e.nodeFilter=function(e){return t.nodeFilter(e)},!0},t}(h.SectionPlaneEndcapMaskDrawPass);t.BodyCheckCustomPass=d;var p=function(e){function t(i,r){var n=e.call(this,i,null)||this;n.reportedWarning=!1,n.reportedOnCracks=!1,n.childPasses=[],n.visualizedRays=[],n.forFullScreenVisualization=!!r,n.checkFrameId=!n.forFullScreenVisualization,n.camera=new h.OrthographicCamera,n.camera.setViewport([0,0,t.TEST_VIEWPORT_WIDTH,t.TEST_VIEWPORT_HEIGHT]),n.camera.setCanvasDimensions(t.TEST_VIEWPORT_WIDTH,t.TEST_VIEWPORT_HEIGHT),n.camera.setFrame(h.StandardViews.Isometric);var o=!(0,l.isBrowserSafari)();return n.resultBuffer=o?new Float32Array(t.TEST_VIEWPORT_HEIGHT*t.TEST_VIEWPORT_HEIGHT*4):new Uint8Array(t.TEST_VIEWPORT_HEIGHT*t.TEST_VIEWPORT_HEIGHT*4),n.childPasses.push(new d(n.viewer,n)),n.clearColor=n.forFullScreenVisualization?[0,0,0,0]:[0,0,0,1],n}return(0,r.__extends)(t,e),t.prototype.shouldCheckSectionPlaneCount=function(){return!1},t.prototype.preDraw=function(e){if(this.reportedWarning)return!1;if(!this.forFullScreenVisualization){var t=this.viewer.getModelViewManagers().getManager().getModelBounds();if(!(t&&t.isInitialized()&&t.isFinite()&&t.isExtensive()))return!1;this.camera.setSceneBounds(t),this.camera.zoomToFit(t.getCorners()),this.camera.updateNearFar(),this.viewer.pushCameraState(this.camera)}var i=h.SectionPlaneEndcapMaskPass.prototype.preDraw.apply(this,arguments);return i||this.forFullScreenVisualization||this.viewer.popCameraState(),i},t.prototype.postDraw=function(e){this.forFullScreenVisualization||(this.viewer.popCameraState(),this.checkBuffer()),h.SectionPlaneEndcapMaskPass.prototype.postDraw.apply(this,arguments)},t.prototype.checkBuffer=function(){var e=this.viewer.getGlContext();this.resultBuffer instanceof Float32Array?e.readPixels(0,0,t.TEST_VIEWPORT_WIDTH,t.TEST_VIEWPORT_HEIGHT,e.RGBA,e.FLOAT,this.resultBuffer):e.readPixels(0,0,t.TEST_VIEWPORT_WIDTH,t.TEST_VIEWPORT_HEIGHT,e.RGBA,e.UNSIGNED_BYTE,this.resultBuffer);for(var i=t.TEST_VIEWPORT_HEIGHT*t.TEST_VIEWPORT_HEIGHT,r=0,o=0,a=0;a<i;++a)this.checkPixel(o)||++r,o+=4;if(r>=4){var c=r/i*100,l="bad pixel count: "+r+", total pixel count: "+i+", percentage of bad pixels: "+c.toFixed(1)+"%, last element and microversion interval processed: "+this.viewer.getModelViewManagers().getManager().getDescriptionOfLastProcessedPartStudio();if(c>=3){var u=n.DocumentModel.getOpenDocumentModel().get("public");s.log.warn("Encountered body/bodies with significant display errors. "+l+"\nisPublic: "+u),this.findBadEntities(),this.reportedWarning=!0}else this.reportedOnCracks||(s.log.info("Encountered body/bodies with display errors.  The body may have cracks in it. "+l),this.reportedOnCracks=!0)}this.reportedWarning||window.localStorage.removeItem(this.getEntityCheckKey())},t.prototype.checkPixel=function(e){for(var t=0;t<3;++t)if(Math.abs(this.resultBuffer[e+t])>=.001)return!1;return!0},t.prototype.getEntityCheckKey=function(){var e="loggedBadEntities.",t=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();return t&&(e+=t.id),e},t.prototype.findBadEntities=function(){var e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(e&&!window.localStorage.getItem(this.getEntityCheckKey())){for(var i=e.bodyComponent,r=0,n=[],l=o.vec3.create(),d=(0,h.getTimeInMilliseconds)(),p=new u.StringSet,g=0;g<t.TEST_VIEWPORT_HEIGHT;++g)for(var f=function(e){if(!m.checkPixel(r)){var o=m.camera.getRay(e,t.TEST_VIEWPORT_HEIGHT-g),s=function(e){var t=i.bodyMetaData[e];if(!t.isSolidBody()||t.meshState===c.GBTMeshState.ALL_MESH)return"continue";var r=i.bodyToEntity.get(e);if(!r)return"continue";if(!(0,h.intersectRayBox)(o,t.getBounds(),l))return"continue";var s={};for(var a in r.each((function(e,t){var r=i.idToMetaData[t];if(r){for(var a,c,d=(a=o,c=r.getMeshIncrement(),n.length=0,c&&c.isTriangles()&&(0,h.intersectRayBox)(a,c.getBounds(),l)?(c.iteratePrimitives((function(e,t,i){if(t&&i){var r=(0,h.intersectRayTriangle)(a,e,t,i);void 0!==r&&n.push(r)}})),n):n),p=0;p<d.length;++p){var g=(0,h.numberToFixedPointString)(d[p]),f=s[g];f||(s[g]=f=new u.StringSet),f.add(t)}return!1}}),m),s){var d=s[a];d.size()>1&&p.addAll(d.getKeyArray())}};for(var a in i.bodyMetaData)s(a)}r+=4},m=this,y=0;y<t.TEST_VIEWPORT_WIDTH;++y)f(y);var v=(0,h.getTimeElapsed)(d);if(v>400&&window.localStorage.setItem(this.getEntityCheckKey(),"true"),p.size()>0){var E="Found overlapping entities ("+v.toFixed(0)+" ms):\n";p.each((function(e){var t=(0,a.createSelectionFromDeterministicId)(e),r=i.idToMetaData[e],n=null;t&&(n=(0,a.getFeatureAssociatedWithSelection)(t)),E+="  entityId: "+e+", bodyId: "+r.getBodyId()+", featureIds: ["+r.getFeatureIds()+"]",E+=n?", featureName: "+n.getName()+", featureType: "+n.getFeatureType()+"\n":" (parent feature not found)\n"}),this),s.log.warn(E)}}},t.prototype.toggleRayVisualization=function(){if(this.visualizedRays.length>0){for(var e=0;e<this.visualizedRays.length;++e)this.visualizedRays[e].remove();this.visualizedRays=[]}else for(var i=0,r=0;r<t.TEST_VIEWPORT_HEIGHT;++r)for(var n=0;n<t.TEST_VIEWPORT_WIDTH;++n){if(!this.checkPixel(i)){var o=this.camera.getRay(n,t.TEST_VIEWPORT_HEIGHT-r);this.visualizedRays.push(new h.RayVisualization(this.viewer,o))}i+=4}},t.TEST_VIEWPORT_WIDTH=100,t.TEST_VIEWPORT_HEIGHT=100,t}(h.SectionPlaneEndcapMaskPass);t.BodyCheckPass=p},536868:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeBufferedPass=t.BufferedPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this,t,null)||this;r.clearColor=[0,0,0,0],r.viewportScale=1,r.checkFrameId=!0,r.frameBuffer=null;var o=!0;i&&(r.id=i.id,o=!i.hasOwnProperty("makeFrameBuffer")||i.makeFrameBuffer,r.textureType=i.textureType,r.storageType=i.storageType,r.attachmentType=i.attachmentType),r.makeFrameBuffer=!!o;var s=r.viewer.getGlContext();return o&&s&&r.initializeFrameBuffer(s),r.listenTo(r.viewer.getEventDispatcher(),n.GL_CONTEXT_RESTORED,r.onGlContextRestored),r.listenTo(r.viewer.getEventDispatcher(),n.SESSION_ENDED,r.onSessionEnded),r}return(0,r.__extends)(t,e),t.prototype.onGlContextRestored=function(e){!this.frameBuffer&&this.makeFrameBuffer&&this.initializeFrameBuffer(e),this.resetBuffer()},t.prototype.getColorTexture=function(){return this.colorTexture},t.prototype.getWidth=function(){return this.frameBuffer.getWidth()},t.prototype.getHeight=function(){return this.frameBuffer.getHeight()},t.prototype.initializeFrameBuffer=function(e){this.frameBuffer=this.viewer.getOrCreateFrameBuffer(this.textureType?this.textureType:e.UNSIGNED_BYTE,this.id,{storageType:this.storageType?this.storageType:e.DEPTH_STENCIL,attachmentType:this.attachmentType?this.attachmentType:e.DEPTH_STENCIL_ATTACHMENT})},t.prototype.resetBuffer=function(){this.frameBuffer.resetBuffer()},t.prototype.preDraw=function(t){if(!e.prototype.preDraw.call(this,t))return!1;if(1!==this.viewportScale){var i=t.getViewport().slice(0);i[2]=Math.max(1,Math.floor(i[2]*this.viewportScale)),i[3]=Math.max(1,Math.floor(i[3]*this.viewportScale)),t.pushViewport(i)}this.frameBuffer.update(t),this.colorTexture=this.frameBuffer.getTexture();var r=this.viewer.getGlContext();return this.oldBufferBinding=r.getParameter(r.FRAMEBUFFER_BINDING),this.frameBuffer.bindBuffer(),this.clearBuffer(t),!0},t.prototype.clearBuffer=function(e){var t=this.viewer.getGlContext();t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clearStencil(0),t.stencilMask(255),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)},t.prototype.postDraw=function(e){1!==this.viewportScale&&e.popViewport();var t=this.viewer.getGlContext();t.bindFramebuffer(t.FRAMEBUFFER,this.oldBufferBinding?this.oldBufferBinding:null)},t.prototype.getFrameBuffer=function(){return this.frameBuffer},t.prototype.setFrameBuffer=function(e){this.frameBuffer=e},t}(n.DrawPass);t.BufferedPass=o,t.makeBufferedPass=function(e,t,i,r){var n=new o(e,{id:r});return n.childPasses=[t],n.viewportScale=i,n}},742364:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InferencePickPass=t.CombinedPickPass=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(911748),a=o.default.getManager(),c=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.primitivePickIds=[],r.occurrencePickIds=[],r.primitiveIdPool=[],r.currentPass=0,r.pickMask=null,r}return(0,r.__extends)(t,e),t.prototype.setEmptyHitList=function(){this.hitlist=[];for(var e=this.pickRect[2]*this.pickRect[3],t=n.INVALID_ID.slice(0),i=0;i<e;++i)this.primitivePickIds[i]=t,this.occurrencePickIds[i]=n.INVALID_OCCURRENCE_ID},t.prototype.getPickIteration=function(){return this.currentPass},t.prototype.justBeforeDraw=function(e){e.getActiveShader().uniform1f("uPickPassIteration",this.getPickIteration())},t.prototype.draw=function(t){if(this.primitiveIdPool=this.primitivePickIds,this.primitivePickIds=[],this.occurrencePickIds=[],this.enabled){t.setActivePass(this);var i,r,o=[];for(i=this.viewer.getPickPassCount()-1;i>=0;--i)this.currentPass=i,e.prototype.draw.call(this,t),o.unshift(this.hitlist);if(o.length<1)this.setEmptyHitList();else{var s=o[0].length;for(i=0;i<s;++i){var a=this.primitiveIdPool.length>0?this.primitiveIdPool.pop():[],c=0,l=-1;for(r=0;r<o.length;++r){var u=o[r][i],h=u&n.IdMasks.ENTITY;h!==n.INVALID_ID_ELEMENT&&(a[r]=h,l=r),c|=(u>>>n.IdSizes.ENTITY&n.IdMasks.OCCURRENCE_SLICE)<<r*n.IdSizes.OCCURRENCE_SLICE}a.length!==l+1&&(a.length=l+1),this.primitivePickIds.push((0,n.makeId)(a)),this.occurrencePickIds.push(c)}}}else this.setEmptyHitList()},t.prototype.gatherPicksFromPickPass=function(){for(var e,t,i,r={},o=this.getPickRect(),a=o[2],c=o[3],l=[o[0]+.5*a,o[1]+.5*c],u=this.getPickViewportWidthHeight(),h=2/Math.sqrt((a-1)*(a-1)+(c-1)*(c-1)),d=1/(u[0]*u[1]),p=0;p<this.primitivePickIds.length;++p)if(null===this.pickMask||0===this.pickMask[p]){var g=this.getPositionForPickHit(p);if(t=this.primitivePickIds[p],e=this.occurrencePickIds[p],(0,n.idIsValid)(t)&&e!==n.INVALID_OCCURRENCE_ID){(i=r[e])||(i={},r[e]=i);var f=i[t];f?f.incorporateLocation(g):(f=new n.Pick(t,e,g,this.getUsage()),i[t]=f),f.distance=Math.min(f.distance,s.vec2.length(s.vec2.subtract(g,l,s.vec2.create()))*h),f.coverage+=d}}for(e in r)for(t in i=r[e])i[t].determineBestLocation();return r},t.prototype.clearPickMask=function(){this.pickMask=null},t.prototype.updatePickMask=function(e,t,i){this.pickMask||(this.pickMask=new Uint8Array(this.primitivePickIds.length));var r,o=!1;for(r=0;r<this.primitivePickIds.length;++r)if(0===this.pickMask[r]){var s=this.primitivePickIds[r],a=this.occurrencePickIds[r];if(!(0,n.idIsValid)(s)||a===n.INVALID_OCCURRENCE_ID)this.pickMask[r]=1;else for(var c=0;c<e.length;++c){var l=e[c];if((0,n.idsEqual)(s,l.primitiveId)&&a===l.occurrenceId){l.canPickThrough(t,this.viewer,i)?o=!0:this.pickMask[r]=1;break}}}return!o},t}(n.PickPass);t.CombinedPickPass=c;var l=function(e){function t(t){var i=e.call(this,t,null)||this;i.childPasses=[],i.sceneGraph=null;for(var r=0;r<n.RenderOrderPriority.COUNT;++r)i.childPasses.push(new n.FaceEdgePointPass(i.viewer,i,{visibility:n.DrawPassVisibility.SHOWTHROUGH,usePickAlternates:!0,disableDepthTest:!0,priority:r}));return i}return(0,r.__extends)(t,e),t.prototype.getMaxHighResPickViewportSamples=function(){return a.getNumber("MAX_INFERENCE_PICKING_RECT_SAMPLES")},t.prototype.setSceneGraph=function(e){this.sceneGraph=e},t.prototype.getSceneGraph=function(){return this.sceneGraph},t.prototype.setPerformIsolationTest=function(e){},t}(c);t.InferencePickPass=l},490026:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompareBlendPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this,t)||this;return r.shaderTag="compareBlend",r.inputs.uOverBufferPass=i,r}return(0,r.__extends)(t,e),t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t),this.shader.uniform1f("uBlend",(0,n.getBlendAmount)())},t}(n.BlitPass);t.CompareBlendPass=o},298771:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hidePartNodesThatDoNotAddToBoundsFilter=t.CustomPass=void 0;var r=i(423902),n=i(73055),o=i(311611),s=i(601759),a=i(911748),c=n.default.getManager(),l=a.vec2.create(),u=a.vec3.create(),h=a.vec4.create(),d=function(e){function t(t,i,r){var n=e.call(this,t,i)||this;switch(n.stencilRefValue=null,n.extraShaderUniforms=[],n.disableColorWrites=!1,n.clipToSectionPlanes=!0,n.disableDepthTest=!1,n.performIsolationTest=!1,n.sceneGraph=null,n.shaderTag="points",n.forDepth=!1,n.shader=null,n.occlusionMapTextureUnit=0,n.applyTranslucentAlphaToAll=!1,n.nodeOccurrenceFilterFunction=null,n.primitiveType=o.Primitive.FACES,n.opacity=o.Opacity.OPAQUE,n.visibility=o.DrawPassVisibility.VISIBLE,n.stencilMode=o.StencilMode.WRITE_EDGES_AND_POINTS,n.priority=o.RenderOrderPriority.DEFAULT,n.facesShader=o.FacesShadeMode.OPAQUE,n.blendMode=o.BlendMode.OVER_WITH_SEPARATE_ALPHA,n.blendFilter=o.BlendFilter.ALL,n.depthTestMode=o.DepthTestMode.LESS,r&&(0,s.overwriteMatchingProperties)(n,r),n.primitiveType){case o.Primitive.POINTS:break;case o.Primitive.EDGES:n.shaderTag="edges";break;case o.Primitive.FACES:switch(n.facesShader){case o.FacesShadeMode.OPAQUE:n.shaderTag="faces";break;case o.FacesShadeMode.CURVATURE:n.shaderTag="curvatureVisualization";break;case o.FacesShadeMode.DRAFT:n.shaderTag="draftAnalysis";break;case o.FacesShadeMode.QUALITY_VISUALIZATION:n.shaderTag="qualityVisualization"}break;case o.Primitive.SILHOUETTES:n.shaderTag="silhouettes"}return r.shaderTagSuffix&&(n.shaderTag=n.shaderTag+r.shaderTagSuffix),n}return(0,r.__extends)(t,e),t.prototype.setExtraMeshNodeFilter=function(e){this.extraMeshNodeFilter=e},t.prototype.setSceneGraph=function(e){this.sceneGraph=e},t.prototype.setBlendFilter=function(e){this.blendFilter=e},t.prototype.getPerformIsolationTest=function(){return this.performIsolationTest},t.prototype.setPerformIsolationTest=function(e){this.performIsolationTest=e},t.prototype.getSceneGraph=function(){return this.sceneGraph?this.sceneGraph:e.prototype.getSceneGraph.call(this)},t.prototype.setEnableColorWrites=function(e){this.disableColorWrites=!e},t.prototype.setOpacity=function(e){this.opacity=e},t.prototype.setShaderUniform=function(e,t){this.extraShaderUniforms.forEach((function(i){i.name===e&&(i.value=t)}))},t.prototype.appliesTranslucentAlphaToAll=function(e){this.applyTranslucentAlphaToAll=e},t.prototype.isShowthroughPass=function(){return this.visibility===o.DrawPassVisibility.SHOWTHROUGH||!!this.parentPass&&this.parentPass.isShowthroughPass()},t.prototype.rendersPoints=function(){return this.primitiveType===o.Primitive.POINTS},t.prototype.rendersEdges=function(){return this.primitiveType===o.Primitive.EDGES||this.primitiveType===o.Primitive.SILHOUETTES},t.prototype.rendersFaces=function(){return this.primitiveType===o.Primitive.FACES},t.prototype.testIsolation=function(e){return this.performIsolationTest&&e.getHasIsolate()},t.prototype.usesShader=function(){return!0},t.prototype.setNodeOccurrenceFilterFunction=function(e){this.nodeOccurrenceFilterFunction=e},t.prototype.preDraw=function(t){if(!e.prototype.preDraw.call(this,t))return!1;var i=this.viewer.getGlContext();this.initializeShader(),t.activateShader(this.shader),this.isPickPass()||t.setMaterial();var r=this;switch(t.nodeFilter=function(e){return r.nodeFilter(e)},this.blendMode){case o.BlendMode.OVER_WITH_SEPARATE_ALPHA:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case o.BlendMode.ADD:i.blendFunc(i.ONE,i.ONE);break;default:throw"Unrecognized blend mode"}i.enable(i.BLEND),this.updateIsolationUniform(t,this.shader);var n=this.parentPass&&"depth"===this.parentPass.shaderTag,s=this.opacity===o.Opacity.TRANSPARENT&&!this.disableColorWrites,a=this.rendersPoints()||this.rendersEdges(),l=n||this.forDepth||!s&&!a;t.getState().callGl("depthMask",l),this.disableDepthTest?(i.disable(i.DEPTH_TEST),t.getState().callGl("depthMask",!1)):(i.enable(i.DEPTH_TEST),t.getState().callGl("depthMask",l),i.depthFunc(this.depthTestMode));var u=!this.isPickPass()&&!this.isHighlightPass(),h=(this.rendersEdges()||this.rendersPoints())&&u,d=this.rendersFaces()&&u;return h&&this.stencilMode===o.StencilMode.TEST_EDGES_AND_POINTS?(0,o.setupStencilForTestWithoutWrite)(i,this.getStencilRefValue(),this.getStencilRefMask()):h&&this.stencilMode===o.StencilMode.WRITE_EDGES_AND_POINTS?(0,o.setupStencilForWriteWithoutTest)(i,this.getStencilRefValue(),this.getStencilRefMask()):d&&this.stencilMode===o.StencilMode.WRITE_AND_TEST_FACES?(0,o.setupStencilForTestAndWrite)(i,this.getStencilRefValue(),this.getStencilRefMask()):i.disable(i.STENCIL_TEST),this.isPickPass()&&(t.getState().callGl("depthMask",!0),i.disable(i.BLEND)),this.disableColorWrites&&i.colorMask(!1,!1,!1,!1),this.rendersPoints()&&this.shader.uniform1f("uPointFilterWidth",c.getNumber("POINT_FILTER_WIDTH")),this.rendersEdges()&&(this.forDepth?this.shader.uniform1f("uLineFilterWidth",0):this.shader.uniform1f("uLineFilterWidth",c.getNumber("LINE_FILTER_WIDTH"))),this.nodeOccurrenceFilterFunction&&t.setNodeOccurrenceFilterFunction(this.nodeOccurrenceFilterFunction),!0},t.prototype.onShaderActivated=function(e,t){e.getDetailSettings().enableSSAO&&this.inputs.hasOwnProperty("uOcclusionMap")&&!e.getHasIsolate()?(t.useTexture("uOcclusionMap",this.inputs.uOcclusionMap.getColorTexture()),t.uniform1f("uOcclusionFactor",c.getNumber("AMBIENT_OCCLUSION_EFFECT_FACTOR"))):t.uniform1f("uOcclusionFactor",0),this.updateIsolationUniform(e,t);var i=this.viewer.getResources().getHighlightTexture();t.useTexture("uHighlightColorTexture",i),t.uniform1f("uHighlightColorTextureWidth",this.viewer.getReferenceHighlights().getHighlightTextureWidth()),(0,o.updateShaderClippingUniforms)(this.viewer,this.clipToSectionPlanes),this.rendersFaces()&&(t.uniform1f("uTintFactor",0),t.uniform3f("uTintColor",1,1,1),t.uniform1i("uApplyTranslucentAlphaToAll",this.applyTranslucentAlphaToAll?1:0))},t.prototype.updateIsolationUniform=function(e,t){this.testIsolation(e)?t.uniform1i("uOutsideIsolation",this.forIsolate()?0:1):t.uniform1i("uOutsideIsolation",0)},t.prototype.getStencilRefValue=function(){return this.stencilRefValue?this.stencilRefValue:this.rendersEdges()?o.StencilRefValue.EDGES:this.rendersFaces()?o.StencilRefValue.FACES:o.StencilRefValue.POINTS},t.prototype.getStencilRefMask=function(){return this.rendersEdges()?o.StencilRefMask.EDGES:this.rendersFaces()?o.StencilRefMask.FACES:o.StencilRefMask.POINTS},t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t),this.shader.uniform1i("uHideSelectionInterior",this.hideSelectionInterior?1:0),this.extraShaderUniforms.forEach((function(e){if(e.value)switch(e.value.length){case 4:this.shader.uniform4fv(e.name,e.value);break;case 3:this.shader.uniform3fv(e.name,e.value);break;case 2:this.shader.uniform2fv(e.name,e.value);break;default:this.shader.uniform1f(e.name,e.value)}}),this)},t.prototype.justAfterDraw=function(t){e.prototype.justAfterDraw.call(this,t),this.extraShaderUniforms.forEach((function(e){if(e.value)switch(e.value.length){case 4:this.shader.uniform4fv(e.name,h);break;case 3:this.shader.uniform3fv(e.name,u);break;case 2:this.shader.uniform2fv(e.name,l);break;default:this.shader.uniform1f(e.name,0)}}),this)},t.prototype.postDraw=function(e){var t=this.viewer.getGlContext();t.disable(t.STENCIL_TEST),t.enable(t.DEPTH_TEST),t.disable(t.BLEND),t.colorMask(!0,!0,!0,!0),this.nodeOccurrenceFilterFunction&&e.setNodeOccurrenceFilterFunction(null)},t.prototype.nodeFilter=function(e){if(!e.isMeshNode())return!1;if(this.blendFilter===o.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(this.blendFilter===o.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;if(this.extraMeshNodeFilter&&!this.extraMeshNodeFilter(e))return!1;if(this.disableDepthTest===e.getIsDepthTested())return!1;switch(this.primitiveType){case o.Primitive.POINTS:if(!e.isPoints())return!1;break;case o.Primitive.EDGES:if(!e.isEdges())return!1;break;case o.Primitive.FACES:if(!e.isFaces())return!1;break;case o.Primitive.SILHOUETTES:if(!e.isSilhouettes())return!1}switch(this.visibility){case o.DrawPassVisibility.VISIBLE:if(e.getIsShowThrough())return!1;switch(this.opacity){case o.Opacity.OPAQUE:if(e.hasTransparency())return!1;break;case o.Opacity.TRANSPARENT:if(!e.hasTransparency()&&!this.applyTranslucentAlphaToAll)return!1}break;case o.DrawPassVisibility.SHOWTHROUGH:if(!e.getIsShowThrough())return!1}var t=e.getIsStencilTested(),i=e.getIsStencilWritten();return!(this.stencilMode===o.StencilMode.TEST_EDGES_AND_POINTS&&!t)&&(!(this.stencilMode===o.StencilMode.WRITE_EDGES_AND_POINTS&&(!i||t))&&((this.stencilMode!==o.StencilMode.OFF||!t&&!i)&&(this.priority===e.getRenderOrderPriority()&&this.parentPass.nodeFilter(e))))},t.prototype.setNodeFilter=function(e){this.nodeFilter=e||t.prototype.nodeFilter},t}(o.DrawPass);t.CustomPass=d,t.hidePartNodesThatDoNotAddToBoundsFilter=function(e){var t=this.viewer.getModelViewManagers().getManager(),i=e.getParent();return!(i&&t.isNodeForBody(i)&&!e.getAddsToBounds())&&d.prototype.nodeFilter.call(this,e)}},419722:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugPickPass=void 0;var r=i(423902),n=function(e){function t(t){var i=e.call(this,t)||this;return i.shaderTag="debugPickPass",i.pickPass=null,i}return(0,r.__extends)(t,e),t.prototype.setPickPass=function(e){this.pickPass=e,this.inputs.uPickBuffer=e},t.prototype.drawInputs=function(e){},t.prototype.preDraw=function(t){if(!this.pickPass)return!1;var i=this.pickPass.getPickViewportWidthHeight(),r=10;return i[0]>50&&(r=3),i[0]>200&&(r=1),t.pushViewport([0,0,i[0]*r,i[1]*r]),e.prototype.preDraw.call(this,t)},t.prototype.postDraw=function(t){e.prototype.postDraw.call(this,t),t.popViewport()},t}(i(311611).BlitPass);t.DebugPickPass=n},592381:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeBufferedNormalDepthWithMaskPass=t.buildHudPass=t.DefaultPasses=t.DefaultPassUsage=void 0;var r,n=i(423902),o=i(311611),s=i(73055),a=i(227441);!function(e){e[e.RENDERING=0]="RENDERING",e[e.HUD=1]="HUD",e[e.ISOLATION=2]="ISOLATION",e[e.PICKING=3]="PICKING"}(r=t.DefaultPassUsage||(t.DefaultPassUsage={}));var c=function(e){function t(t,i,n,a,c){var l=e.call(this,t,i)||this;l.opaqueFaces=null,l.opaqueFacesCurvatureVisualization=null,l.draftAnalysisFaces=null,l.qualityVisualization=null,l.opaqueEdges=null,l.silhouettes=null,l.opaquePoints=null,l.nonOitTransparentFaces=null,l.transparentFaces=null,l.transparentEdges=null,l.depthFaces=null,l.depthTransparentFaces=null,l.depthEdges=null,l.showThroughStencilTested=null,l.showThroughNotStencilTested=null,l.showThroughDepthTested=null,l.sectionPlaneEndcapEdge=null,l.sectionPlaneEndcapMask=null,l.sectionPlaneEndcap=null,l.sketchImageFaces=null,l.isolatePass=null,l.contextPass=null,l.compareTransparentFaces=null,l.compareTintedEdges=null,l.compareTintedPoints=null;var u=i.isPickPass(),h=new o.CustomPass(t,i,{performIsolationTest:!c}),d=new o.CustomPass(t,i,{performIsolationTest:!c,shaderTagSuffix:"-nosection"}),p=new o.SwitchPass(t,h,d,o.isSectionPlaneModeEnabled);p.setSceneGraph(n),l.opaqueFaces=p;var g=s.default.getManager(),f=new o.CustomPass(t,i,{facesShader:o.FacesShadeMode.CURVATURE,sceneGraph:n,performIsolationTest:!c,extraShaderUniforms:[{name:"uStripeCount",value:g.getNumber("ZEBRA_STRIPE_COUNT")},{name:"uStripeRotation",value:g.getNumber("ZEBRA_STRIPE_ROTATION")},{name:"uFilterWidth",value:g.getNumber("ZEBRA_STRIPE_FILTER_WIDTH")},{name:"uRespectOrthographic",value:g.getNumber("ZEBRA_STRIPE_RESPECT_ORTHOGRAPHIC")}]});l.opaqueFacesCurvatureVisualization=f;var m=new o.DraftAnalysisDrawPass(t,i,!c,n);l.draftAnalysisFaces=m,l.qualityVisualization=new o.QualityVisualizationPass(t,i,!c,n);var y=new o.EdgeAndHiddenEdgePass(t,i,{primitiveType:o.Primitive.EDGES,performIsolationTest:!c,sceneGraph:n});if(l.opaqueEdges=y,!u){var v=new o.SilhouettePass(t,i,n,!1),E=new o.SilhouettePass(t,i,n,!0),I=new o.SwitchPass(t,v,E,o.isSectionPlaneModeEnabled);l.silhouettes=I}var T=new o.CustomPass(t,i,{primitiveType:o.Primitive.POINTS,performIsolationTest:!c});T.setSceneGraph(n),l.opaquePoints=T;var S=new o.CustomPass(t,i,{primitiveType:o.Primitive.FACES,opacity:o.Opacity.TRANSPARENT,performIsolationTest:!c}),P=new o.CustomPass(t,i,{primitiveType:o.Primitive.FACES,opacity:o.Opacity.TRANSPARENT,performIsolationTest:!c,shaderTagSuffix:o.NO_SECTION_SHADER_ID_SUFFIX}),_=new o.SwitchPass(t,S,P,o.isSectionPlaneModeEnabled);if(_.setSceneGraph(n),l.nonOitTransparentFaces=_,t.supportsOrderIndependentTranslucency()){var M=new o.TranslucentPass(t,i,n);M.setPerformIsolationTest(!c),_.performIsolationTest=!c,l.transparentFaces=new o.TransparencySwitchPass(t,M,_,o.isOrderIndependentTransparencyEnabled)}else l.transparentFaces=_;var D=new o.CustomPass(t,i,{primitiveType:o.Primitive.EDGES,opacity:o.Opacity.TRANSPARENT,stencilMode:o.StencilMode.OFF,clipToSectionPlanes:!1,performIsolationTest:!c});D.setSceneGraph(n),l.transparentEdges=D;var C=new o.CustomPass(t,i,{primitiveType:o.Primitive.FACES,disableColorWrites:!0});C.setSceneGraph(n),l.depthFaces=C,l.depthTransparentFaces=new o.TransparentFaceDepth(t,i,n,!c);var O=new o.CustomPass(t,i,{primitiveType:o.Primitive.EDGES,disableColorWrites:!0});O.setSceneGraph(n),l.depthEdges=O;for(var A=new o.DrawPass(t,i),R=0;R<o.RenderOrderPriority.COUNT;++R){var N=new o.FaceEdgePointPass(t,i,{visibility:o.DrawPassVisibility.SHOWTHROUGH,disableDepthTest:!0,stencilMode:o.StencilMode.TEST_EDGES_AND_POINTS,priority:R,sceneGraph:n,usePickAlternates:u,performIsolationTest:!c});A.addChildPass(N)}l.showThroughStencilTested=A;var w=new o.DrawPass(t,i);for(R=0;R<=o.RenderOrderPriority.HIGHEST;++R){var b=new o.FaceEdgePointPass(t,i,{disableDepthTest:!0,visibility:o.DrawPassVisibility.SHOWTHROUGH,priority:R,sceneGraph:n,usePickAlternates:u});w.addChildPass(b)}l.showThroughNotStencilTested=w;var L=new o.DrawPass(t,i);for(R=0;R<=o.RenderOrderPriority.HIGHEST;++R){var F=new o.FaceEdgePointPass(t,i,{visibility:o.DrawPassVisibility.SHOWTHROUGH,priority:R,sceneGraph:n,usePickAlternates:u});L.addChildPass(F)}l.showThroughDepthTested=L;var B=new o.SectionPlaneEndcapMaskPass(t,n),x=new o.EdgeDetectAndBlurPass(t,B);l.sectionPlaneEndcapEdge=x,l.sectionPlaneEndcapMask=B,l.sectionPlaneEndcap=new o.SectionPlaneEndcapDrawPasses(t,i,B,x);var U=new o.CustomPass(t,i,{primitiveType:o.Primitive.FACES,opacity:o.Opacity.TRANSPARENT,disableDepthTest:!0,sceneGraph:n});return l.sketchImageFaces=U,a===r.RENDERING&&(l.isolatePass=new o.GhostParentPass(t,i,!1,n),l.contextPass=new o.GhostParentPass(t,i,!0,n)),l}return(0,n.__extends)(t,e),t.prototype.setBlendFilter=function(e){this.opaqueFaces.setBlendFilter(e),this.opaqueFacesCurvatureVisualization.setBlendFilter(e),this.draftAnalysisFaces.setBlendFilter(e),this.qualityVisualization.setBlendFilter(e),this.sketchImageFaces.setBlendFilter(e),this.opaqueEdges.setBlendFilter(e),this.silhouettes.setBlendFilter(e),this.depthTransparentFaces.setBlendFilter(e),this.transparentFaces.setBlendFilter(e),this.transparentEdges.setBlendFilter(e),this.opaquePoints.setBlendFilter(e),this.isolatePass&&this.isolatePass.setBlendFilter(e),this.contextPass&&this.contextPass.setBlendFilter(e),this.showThroughStencilTested.setBlendFilter(e),this.showThroughNotStencilTested.setBlendFilter(e),this.showThroughDepthTested.setBlendFilter(e),this.depthFaces.setBlendFilter(e),this.depthEdges.setBlendFilter(e)},t.prototype.setHideSelectionInterior=function(e){this.opaqueFaces.setHideSelectionInterior(e),this.transparentFaces.setHideSelectionInterior(e),this.draftAnalysisFaces.setHideSelectionInterior(e),this.qualityVisualization.setHideSelectionInterior(e),this.isolatePass&&this.isolatePass.setHideSelectionInterior(e),this.contextPass&&this.contextPass.setHideSelectionInterior(e)},t.prototype.setRenderingMode=function(e){switch(this.isolatePass&&this.isolatePass.setRenderingMode(e),this.contextPass&&this.contextPass.setRenderingMode(e),e){case a.GBTGraphicsRenderMode.SHADED_WITH_EDGES:case a.GBTGraphicsRenderMode.SIMULATION_RESULTS:this.enableOpaqueFaces(!0,!0,o.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,o.Opacity.OPAQUE,!0));break;case a.GBTGraphicsRenderMode.SHADED_WITHOUT_EDGES:this.enableOpaqueFaces(!0,!0,o.FacesShadeMode.OPAQUE),this.enableEdges(!1,!1,!1),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,o.Opacity.OPAQUE,!0));break;case a.GBTGraphicsRenderMode.SHADED_WITH_HIDDEN_EDGES:this.enableOpaqueFaces(!0,!0,o.FacesShadeMode.OPAQUE),this.enableEdges(!0,!0,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,o.Opacity.OPAQUE,!0));break;case a.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED:this.enableOpaqueFaces(!0,!1,o.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),o.Opacity.ALL,!0));break;case a.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE:this.enableOpaqueFaces(!0,!1,o.FacesShadeMode.OPAQUE),this.enableEdges(!0,!0,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),o.Opacity.ALL,!0));break;case a.GBTGraphicsRenderMode.WIREFRAME:this.enableOpaqueFaces(!1,!1,o.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),o.Opacity.OPAQUE,!1));break;case a.GBTGraphicsRenderMode.TRANSLUCENT:this.enableOpaqueFaces(!1,!0,o.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!1),this.enableFullOpacity(!1),this.adjustTransparentFacePass(!0,null,o.Opacity.OPAQUE,!0);break;case a.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION:this.enableOpaqueFaces(!0,!0,o.FacesShadeMode.CURVATURE),this.enableEdges(this.viewer.getZebraStripeEdgesOn(),!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,o.Opacity.OPAQUE,!0));break;case a.GBTGraphicsRenderMode.DRAFT_ANALYSIS:this.enableOpaqueFaces(!0,!0,o.FacesShadeMode.DRAFT),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),o.Opacity.ALL,!0));break;case a.GBTGraphicsRenderMode.DEBUG_QUALITY_VISUALIZATION:this.enableOpaqueFaces(!0,!0,o.FacesShadeMode.QUALITY_VISUALIZATION),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),o.Opacity.ALL,!0))}},t.prototype.enableEdges=function(e,t,i){this.opaqueEdges.setDrawVisibleParts(e),this.silhouettes.setEnabled(e),this.opaqueEdges.setDrawHidden(t),this.silhouettes.setDrawHidden(t),this.silhouettes.setDrawBackFaceSilhouettes(i)},t.prototype.enableOpaqueFaces=function(e,t,i){var r;switch(i){case o.FacesShadeMode.OPAQUE:r=this.opaqueFaces;break;case o.FacesShadeMode.CURVATURE:r=this.opaqueFacesCurvatureVisualization;break;case o.FacesShadeMode.DRAFT:r=this.draftAnalysisFaces;break;case o.FacesShadeMode.QUALITY_VISUALIZATION:r=this.qualityVisualization}for(var n=this.getFacePasses(),s=0;s<n.length;++s){var a=n[s];a===r?(a.setEnabled(e),a.setEnableColorWrites(t)):a.setEnabled(!1)}},t.prototype.enableFullOpacity=function(e){var t,i;e?(t=o.Opacity.ALL,i=this.createExcludeForNonBodyFilter()):(t=o.Opacity.OPAQUE,i=null);for(var r=this.getFacePasses(),n=0;n<r.length;++n)r[n].setOpacity(t),r[n].setExtraMeshNodeFilter(i)},t.prototype.adjustTransparentFacePass=function(e,t,i,r){this.transparentFaces.setExtraMeshNodeFilter(t),(this.transparentFaces instanceof o.TransparencySwitchPass||this.transparentFaces instanceof o.TranslucentPass)&&(this.transparentFaces.appliesTranslucentAlphaToAll(e),this.transparentFaces.setDepthOpacity(i),this.transparentFaces.setDepthPassEnabled(r))},t.prototype.enableTransparentDepth=function(e){this.depthTransparentFaces.setEnabled(e),e?this.depthTransparentFaces.setNodeFilter(this.createExcludeForNonBodyFilter()):this.depthTransparentFaces.setNodeFilter(null)},t.prototype.getFacePasses=function(){return[this.opaqueFaces,this.opaqueFacesCurvatureVisualization,this.draftAnalysisFaces,this.qualityVisualization]},t.prototype.setZebraStripeCount=function(e){var t,i;this.opaqueFacesCurvatureVisualization.setShaderUniform("uStripeCount",e),null===(t=this.contextPass)||void 0===t||t.setZebraStripeCount(e),null===(i=this.isolatePass)||void 0===i||i.setZebraStripeCount(e)},t.prototype.setZebraStripeRotation=function(e){var t,i;this.opaqueFacesCurvatureVisualization.setShaderUniform("uStripeRotation",e),null===(t=this.contextPass)||void 0===t||t.setZebraStripeRotation(e),null===(i=this.isolatePass)||void 0===i||i.setZebraStripeRotation(e)},t}(o.DrawPass);t.DefaultPasses=c,t.buildHudPass=function(e,t){return new o.HudPass(e,t)},t.makeBufferedNormalDepthWithMaskPass=function(e,t,i,r){var n=(0,o.makeBufferedPass)(e,new o.NormalDepthWithMaskPass(e,t),i,r);return n.clearColor=o.normalDepthClearColor,n}},16295:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DepthRetrievalPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t){var i=e.call(this,t,null)||this;i.shaderTag="depth",i.points=[],i.includePlanes=!0,i.childPasses=[],i.previewPasses=[],i.clearColor=n.DEPTH_PASS_CLEAR_COLOR;for(var r=0;r<i.childPasses.length;++r)i.childPasses[r].destroy();i.childPasses.push(new n.CustomPass(i.viewer,i,{primitiveType:n.Primitive.FACES,performIsolationTest:!0})),i.childPasses.push(new n.CustomPass(i.viewer,i,{primitiveType:n.Primitive.FACES,opacity:n.Opacity.TRANSPARENT,performIsolationTest:!0}));var o=function(e){return e.getParent().getId()===n.SketchComponentId},s=new n.CustomPass(i.viewer,i,{primitiveType:n.Primitive.EDGES,performIsolationTest:!0,extraShaderUniforms:[{name:"uUsePrimitiveSize",value:1}]});s.setExtraMeshNodeFilter(o),i.childPasses.push(s);var a=new n.CustomPass(i.viewer,i,{primitiveType:n.Primitive.POINTS,performIsolationTest:!0,extraShaderUniforms:[{name:"uUsePrimitiveSize",value:1}]});a.setExtraMeshNodeFilter(o),i.childPasses.push(a);var c=new n.CustomPass(i.viewer,i,{performIsolationTest:!0});c.setSceneGraph(i.viewer.getSceneGraphs().getPreviewSceneGraph()),i.childPasses.push(c),i.previewPasses.push(c);var l=new n.CustomPass(i.viewer,i,{opacity:n.Opacity.TRANSPARENT,performIsolationTest:!0});return l.setSceneGraph(i.viewer.getSceneGraphs().getPreviewSceneGraph()),i.childPasses.push(l),i.previewPasses.push(l),i}return(0,r.__extends)(t,e),t.prototype.setRetrieveFromPreview=function(e){for(var t=0;t<this.previewPasses.length;++t)this.previewPasses[t].setEnabled(e)},t.prototype.nodeFilter=function(e){if(e.isMeshNode()){if(!e.getIncludedInBlend())return!1;if((0,n.doesNodeContainPlaneEntities)(e))return this.includePlanes}return!0},t.prototype.draw=function(e){throw"Use DepthRetrievalPass retrieve method instead"},t.prototype.retrieve=function(t,i){this.includePlanes=i,e.prototype.draw.call(this,t)},t.prototype.postDraw=function(t){var i=this.pickRect[2]*this.pickRect[3]*4,r=new Uint8Array(i),o=this.viewer.getGlContext();o.readPixels(0,0,this.pickRect[2],this.pickRect[3],o.RGBA,o.UNSIGNED_BYTE,r),this.points=[];for(var s=0;s<i/4;s++){var a=4*s,c=(0,n.decodeDepth)([r[a],r[a+1],r[a+2],r[a+3]],this.viewer.isHighPrecisionSupportedInFragmentShader());this.points.push([this.pickRect[0]+s%this.pickRect[2],this.pickRect[1]+(this.pickRect[3]-Math.floor(s/this.pickRect[2])),c])}n.BufferedPass.prototype.postDraw.call(this,t),e.prototype.postDraw.call(this,t)},t}(n.PickPass);t.DepthRetrievalPass=o},864960:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DepthSamplingPass=void 0;var r=i(423902),n=i(73055),o=i(311611),s=n.default.getManager(),a=function(e){function t(t){var i=e.call(this,t)||this;return i.checkFrameId=!1,i.shaderTag="depth",i.useHighlightsOnly=!1,i.childPasses=[],i.points=[],i.numSamples=0,i.includePlanes=!0,i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.FACES,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.FACES,opacity:o.Opacity.TRANSPARENT,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.EDGES,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.EDGES,performIsolationTest:!0,opacity:o.Opacity.TRANSPARENT,stencilMode:o.StencilMode.OFF,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.POINTS,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.POINTS,performIsolationTest:!0,visibility:o.DrawPassVisibility.SHOWTHROUGH,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.FACES,performIsolationTest:!0,sceneGraph:i.viewer.getSceneGraphs().getPreviewSceneGraph(),extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.FACES,performIsolationTest:!0,opacity:o.Opacity.TRANSPARENT,sceneGraph:i.viewer.getSceneGraphs().getPreviewSceneGraph(),extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),i.clearColor=o.DEPTH_PASS_CLEAR_COLOR,i}return(0,r.__extends)(t,e),t.prototype.setIncludePlanes=function(e){this.includePlanes=e},t.prototype.nodeFilter=function(e){return!!e.getIsVisible()&&(!e.isMeshNode()||!(0,o.doesNodeContainPlaneEntities)(e)||this.includePlanes)},t.prototype.needsAttribute=function(e){var t=e===o.AttributeNames.HIGHLIGHT_ID&&this.useHighlightsOnly;return this.parentPass?t||this.parentPass.needsAttribute(e):t},t.prototype.isHighlightPass=function(){return this.useHighlightsOnly},t.prototype.getActiveHighlightType=function(){return o.HighlightType.ENTITY},t.prototype.setUseHighlightsOnly=function(e){this.useHighlightsOnly=e;for(var t=e?1:0,i=0;i<this.childPasses.length;i++)this.childPasses[i].setShaderUniform("uUseHighlightsOnly",t)},t.prototype.draw=function(e){throw"Use DepthSamplingPass retrieve method instead"},t.prototype.retrieve=function(t,i){i=i||{},this.numSamples=void 0===i.numSamples?s.getNumber("DEPTH_SAMPLES_PER_VIEWPORT"):i.numSamples,this.includePlanes=void 0===i.includePlanes||i.includePlanes,this.setPerformIsolationTest(void 0===i.performIsolationTest||i.performIsolationTest),this.setUseHighlightsOnly(void 0!==i.useHighlightsOnly&&i.useHighlightsOnly),e.prototype.draw.call(this,t)},t.prototype.preDraw=function(t){var i=t.getViewport(),r=Math.min(Math.sqrt(this.numSamples/(i[2]*i[3])),1);return this.horizontalScale=Math.ceil(i[2]*r)/i[2],this.verticalScale=Math.ceil(i[3]*r)/i[3],this.fullViewport=i,this.shrunkViewport=[0,0,Math.max(Math.round(this.horizontalScale*i[2]),1),Math.max(Math.round(this.verticalScale*i[3]),1)],t.pushViewport(this.shrunkViewport),e.prototype.preDraw.call(this,t)},t.prototype.postDraw=function(t){var i=this.shrunkViewport[2]*this.shrunkViewport[3]*4,r=new Uint8Array(i),n=this.viewer.getGlContext();n.readPixels(0,0,this.shrunkViewport[2],this.shrunkViewport[3],n.RGBA,n.UNSIGNED_BYTE,r),this.points=[];for(var s=0;s<i/4;s++){var a=4*s,c=(0,o.decodeDepth)([r[a],r[a+1],r[a+2],r[a+3]],this.viewer.isHighPrecisionSupportedInFragmentShader());if(c!==o.UNKNOWN_DEPTH){var l=s%this.shrunkViewport[2]+.5,u=this.shrunkViewport[3]-Math.floor(s/this.shrunkViewport[2])-.5,h=this.fullViewport[0]+l/this.horizontalScale,d=this.fullViewport[1]+u/this.verticalScale;this.points.push([h,d,c])}}t.popViewport(),e.prototype.postDraw.call(this,t)},t}(o.BufferedPass);t.DepthSamplingPass=a},658064:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DraftAnalysisDrawPass=t.DraftAnalysisShadowTestPasses=t.DraftAnalysisShadowTestPass=void 0;var r=i(423902),n=i(311611),o=i(311517),s=i(73055),a=i(227441),c=i(911748),l=c.vec4.createFrom(0,0,2048,2048),u=c.mat4.create(),h=function(e){function t(t,i,r,o){var s=e.call(this,t,i,{primitiveType:n.Primitive.FACES,opacity:n.Opacity.ALL})||this;return s.parentPass=i,s.withDirection=r,s.setSceneGraph(o),s}return(0,r.__extends)(t,e),t.prototype.preDraw=function(t){if(this.setExtraMeshNodeFilter(this.createExcludeForNonBodyFilter()),e.prototype.preDraw.call(this,t)){t.setOverrideFaceCullingMode(n.CullFace.NONE),t.setOverridePolygonOffset(0,0);var i=this.parentPass.draftAnalysisDrawPass;return t.pushModelViewMatrix(this.withDirection?i.viewMatrixWithDirection:i.viewMatrixAgainstDirection),t.pushProjectionMatrix(this.withDirection?i.projectionMatrixWithDirection:i.projectionMatrixAgainstDirection),(0,n.updateShaderClippingUniforms)(this.viewer,!0,!0),this.viewer.getGlContext().colorMask(this.withDirection,!this.withDirection,!1,!1),!0}return!1},t.prototype.postDraw=function(t){t.popModelViewMatrix(),t.popProjectionMatrix(),(0,n.updateShaderClippingUniforms)(this.viewer,!0,!0),t.clearOverrideFaceCullingMode(),t.clearOverridePolygonOffset(),e.prototype.postDraw.call(this,t)},t}(n.CustomPass);t.DraftAnalysisShadowTestPass=h;var d=function(e){function t(t,i,r){var o=e.call(this,t,{id:"draftAnalysisShadowTest",textureType:t.getGlContext().FLOAT})||this;return o.shaderTag="draftShadow",o.checkFrameId=!1,o.clearColor=[255,255,255,255],o.draftAnalysisDrawPass=i,o.childPasses=[new h(t,o,!0,r),new n.DepthClearPass(t,o),new h(t,o,!1,r)],o}return(0,r.__extends)(t,e),t.prototype.preDraw=function(t){return t.pushViewport(l),!!e.prototype.preDraw.call(this,t)||(t.popViewport(),!1)},t.prototype.postDraw=function(t){t.popViewport(),e.prototype.postDraw.call(this,t)},t}(n.BufferedPass);t.DraftAnalysisShadowTestPasses=d;var p=function(e){function t(t,i,r,o){var s=e.call(this,t,i,{facesShader:n.FacesShadeMode.DRAFT,performIsolationTest:r})||this;return s.pullDirection=null,s.showUndercut=!0,s.idToParts={},s.doDraftAnalysis=!0,s.setSceneGraph(o),s.angle=a.BTDraftAnalysis.DEFAULT_MINIMUM_ANGLE_RADIANS,s.viewMatrixWithDirection=s.projectionMatrixWithDirection=s.viewMatrixAgainstDirection=s.projectionMatrixAgainstDirection=u,s.inputs.uDraftShadowMap=new d(t,s,o),s.usage=o===s.viewer.getSceneGraphs().getMainSceneGraph()?n.bt_graphics_Usage.BASE:n.bt_graphics_Usage.PREVIEW,s}return(0,r.__extends)(t,e),t.prototype.setPullDirection=function(e){this.pullDirection=e},t.prototype.setMinimumAngle=function(e){this.angle=e},t.prototype.setParts=function(e){e?(this.idsToParts={},e.forEach((function(e){Object.values(e.getDeterministicIds()).forEach((function(t){this.idsToParts[t]=e}),this)}),this)):o.log.error("Tried to set the draft analysis parts array to null.")},t.prototype.setShowUndercut=function(e){this.showUndercut=e},t.prototype.getIdsToParts=function(){return this.idsToParts},t.prototype.justBeforeDraw=function(t){var i;if(e.prototype.justBeforeDraw.call(this,t),this.shader.uniform1i("uDoDraftAnalysis",this.doDraftAnalysis&&this.pullDirection?1:0),this.pullDirection){var r=c.mat4.multiplyVec4(t.getActiveCamera().getViewMatrix(),c.vec4.createFrom(this.pullDirection[0],this.pullDirection[1],this.pullDirection[2],0));i=c.vec3.normalize(c.vec3.create(r))}else i=c.vec3.create();this.shader.uniform3fv("uDraftAnalysisDirection",i),this.shader.uniform1f("uMinimumDraftAngle",this.angle);var n=s.default.getManager();this.shader.uniform4fv("uSteepDraftColor",n.getColor("DRAFT_ANALYSIS_STEEP_COLOR")),this.shader.uniform4fv("uUndercutColor",n.getColor("DRAFT_ANALYSIS_UNDERCUT_COLOR")),this.shader.uniform4fv("uWithDirectionColor",n.getColor("DRAFT_ANALYSIS_WITH_DIRECTION_COLOR")),this.shader.uniform4fv("uAgainstDirectionColor",n.getColor("DRAFT_ANALYSIS_AGAINST_DIRECTION_COLOR")),this.shader.uniform1i("uShowUndercut",this.showUndercut?1:0),this.shader.uniformMatrix4fv("uPMVMatrixWith",!1,c.mat4.multiply(this.projectionMatrixWithDirection,this.viewMatrixWithDirection,c.mat4.create())),this.shader.uniformMatrix4fv("uPMVMatrixAgainst",!1,c.mat4.multiply(this.projectionMatrixAgainstDirection,this.viewMatrixAgainstDirection,c.mat4.create())),this.shader.uniform1f("uDraftShadowMapPixelWidth",1/l[2]),this.shader.uniform1f("uDraftShadowMapPixelHeight",1/l[3]),this.shader.useTexture("uDraftShadowMap",this.inputs.uDraftShadowMap.getColorTexture())},t.prototype.draw=function(t){if(this.getEnabled()){var i=this.viewer.getModelViewManagers().getManagerForUsage(this.usage).getDisplayedPartStudio();if(i){var r=0,o=function(e){return e.occurrenceData.getOccurrenceId()===r};t.setNodeOccurrenceFilterFunction(o);var s=i.getBodyComponent(),a={};this.doDraftAnalysis=!0;var h=function(i){var o=s.retrieveBodyMetaData(i);if(!o)return"continue";if(!o.isSolidBody()&&!o.isSheetBody())return"continue";if(!(r=s.partStudioBodyIdToOccurrenceId[i]))return"continue";if(a[r]=!0,d.pullDirection){var h=c.vec3.normalize(c.vec3.getAPerpendicularVector(d.pullDirection),c.vec3.create()),p=function(e){var t=new n.OrthographicCamera({direction:e,up:h});t.setViewport(c.vec4.create(l));var i=o.getBounds();return t.setSceneBounds(i),t.zoomToFit(i.getCorners(),1,c.vec4.createFrom(1,1,l[2]-2,l[3]-2)),t},g=p(c.vec3.create(d.pullDirection));d.viewMatrixWithDirection=g.getViewMatrix(),d.projectionMatrixWithDirection=g.getProjectionMatrix(),g=p(c.vec3.scale(d.pullDirection,-1,c.vec3.create())),d.viewMatrixAgainstDirection=g.getViewMatrix(),d.projectionMatrixAgainstDirection=c.mat4.scale(g.getProjectionMatrix(),[-1,1,1])}else d.viewMatrixWithDirection=d.projectionMatrixWithDirection=d.viewMatrixAgainstDirection=d.projectionMatrixAgainstDirection=u;e.prototype.drawInputs.call(d,t),e.prototype.draw.call(d,t)},d=this;for(var p in this.idsToParts)h(p);o=function(e){return!a[e.occurrenceData.getOccurrenceId()]},t.setNodeOccurrenceFilterFunction(o),this.doDraftAnalysis=!1,e.prototype.draw.call(this,t),t.setNodeOccurrenceFilterFunction(null),this.postDraw(t)}}},t.prototype.postDraw=function(e){this.viewMatrixWithDirection=this.projectionMatrixWithDirection=this.viewMatrixAgainstDirection=this.projectionMatrixAgainstDirection=u},t}(n.CustomPass);t.DraftAnalysisDrawPass=p},184270:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DraftAngleRetrievalPass=void 0;var r=i(423902),n=i(736202),o=i(311611),s=i(911748),a=function(e){function t(t){var i=e.call(this,t,null)||this;i.shaderTag="draftAngle",i.clearColor=[0,0,0,0],i.nodeOccurrenceFilterFunction=null,i.direction=null,i.points=[],i.childPasses=[],i.previewPasses=[],i.nodeFilterFunction=i.createExcludeForNonBodyFilter();for(var r=0;r<i.childPasses.length;++r)i.childPasses[r].destroy();var n=[{name:"uPullDirection",value:s.vec3.createFrom(0,0,0)}];i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.FACES,performIsolationTest:!0,extraShaderUniforms:n})),i.childPasses.push(new o.CustomPass(i.viewer,i,{primitiveType:o.Primitive.FACES,opacity:o.Opacity.TRANSPARENT,performIsolationTest:!0,extraShaderUniforms:n}));var a=new o.CustomPass(i.viewer,i,{performIsolationTest:!0,extraShaderUniforms:n});a.setSceneGraph(i.viewer.getSceneGraphs().getPreviewSceneGraph()),i.childPasses.push(a),i.previewPasses.push(a);var c=new o.CustomPass(i.viewer,i,{opacity:o.Opacity.TRANSPARENT,performIsolationTest:!0,extraShaderUniforms:n});return c.setSceneGraph(i.viewer.getSceneGraphs().getPreviewSceneGraph()),i.childPasses.push(c),i.previewPasses.push(c),i}return(0,r.__extends)(t,e),t.prototype.nodeFilter=function(e){return this.nodeFilterFunction(e)},t.prototype.setDirection=function(e){this.direction=e},t.prototype.setOccurrenceIds=function(e){var t={},i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(i){var r=i.getBodyComponent();for(var n in e){var o=r.retrieveBodyMetaData(n);if(o&&(o.isSolidBody()||o.isSheetBody())){var s=r.partStudioBodyIdToOccurrenceId[n];s&&(t[s]=!0)}}this.nodeOccurrenceFilterFunction=function(e){return t[e.occurrenceData.getOccurrenceId()]}}},t.prototype.preDraw=function(t){return!!this.direction&&e.prototype.preDraw.call(this,t)},t.prototype.justBeforeDraw=function(t){var i=this;e.prototype.justBeforeDraw.call(this,t);var r=function(e){e.setShaderUniform("uPullDirection",i.direction)};(0,n.each)(this.childPasses,r),this.previewPasses.forEach(r)},t.prototype.draw=function(e){throw"Use DraftAngleRetrievalPass retrieve method instead"},t.prototype.retrieve=function(t){t.setNodeOccurrenceFilterFunction(this.nodeOccurrenceFilterFunction),e.prototype.draw.call(this,t),t.setNodeOccurrenceFilterFunction(null)},t.prototype.postDraw=function(t){var i=this.pickRect[2]*this.pickRect[3]*4,r=new Uint8Array(i),n=this.viewer.getGlContext();n.readPixels(0,0,this.pickRect[2],this.pickRect[3],n.RGBA,n.UNSIGNED_BYTE,r),this.points=[];for(var s=0;s<i/4;s++){var a=4*s,c=(0,o.decodeAngle)([r[a],r[a+1],r[a+2],r[a+3]],this.viewer.isHighPrecisionSupportedInFragmentShader());this.points.push({canvasCoordinate:[this.pickRect[0]+s%this.pickRect[2],this.pickRect[1]+(this.pickRect[3]-Math.floor(s/this.pickRect[2]))],angle:c})}e.prototype.postDraw.call(this,t)},t}(o.PickPass);t.DraftAngleRetrievalPass=a},532981:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SwitchPass=t.DrawPass=t.DepthTestMode=t.BlendMode=t.StencilRefMask=t.StencilRefValue=t.StencilMode=t.FacesShadeMode=t.DrawPassVisibility=t.Opacity=t.OITComponent=t.BlendFilter=t.Primitive=void 0;var r=i(423902),n=i(663748),o=i(311611);!function(e){e[e.POINTS=0]="POINTS",e[e.EDGES=1]="EDGES",e[e.FACES=2]="FACES",e[e.SILHOUETTES=3]="SILHOUETTES"}(t.Primitive||(t.Primitive={})),function(e){e[e.BLEND_ONLY=0]="BLEND_ONLY",e[e.NON_BLEND_ONLY=1]="NON_BLEND_ONLY",e[e.ALL=2]="ALL"}(t.BlendFilter||(t.BlendFilter={})),function(e){e.ACCUMULATION="Accumulation",e.REVEALAGE="Revealage"}(t.OITComponent||(t.OITComponent={})),function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.ALL=2]="ALL"}(t.Opacity||(t.Opacity={})),function(e){e[e.VISIBLE=0]="VISIBLE",e[e.SHOWTHROUGH=1]="SHOWTHROUGH"}(t.DrawPassVisibility||(t.DrawPassVisibility={})),function(e){e[e.OPAQUE=0]="OPAQUE",e[e.CURVATURE=1]="CURVATURE",e[e.DRAFT=2]="DRAFT",e[e.QUALITY_VISUALIZATION=3]="QUALITY_VISUALIZATION"}(t.FacesShadeMode||(t.FacesShadeMode={})),function(e){e[e.WRITE_EDGES_AND_POINTS=0]="WRITE_EDGES_AND_POINTS",e[e.TEST_EDGES_AND_POINTS=1]="TEST_EDGES_AND_POINTS",e[e.WRITE_AND_TEST_FACES=2]="WRITE_AND_TEST_FACES",e[e.OFF=3]="OFF"}(t.StencilMode||(t.StencilMode={})),function(e){e[e.LOW_PRIORITY_EDGES=1]="LOW_PRIORITY_EDGES",e[e.EDGES=2]="EDGES",e[e.POINTS=4]="POINTS",e[e.FACES=8]="FACES"}(t.StencilRefValue||(t.StencilRefValue={})),function(e){e[e.EDGES=3]="EDGES",e[e.POINTS=4]="POINTS",e[e.FACES=8]="FACES"}(t.StencilRefMask||(t.StencilRefMask={})),function(e){e[e.OVER_WITH_SEPARATE_ALPHA=0]="OVER_WITH_SEPARATE_ALPHA",e[e.ADD=1]="ADD"}(t.BlendMode||(t.BlendMode={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(t.DepthTestMode||(t.DepthTestMode={}));var s=function(e){function t(t,i){var r=e.call(this)||this;return r.viewer=t,r.childPasses=null,r.shaderTag=null,r.inputs={},r.enabled=!0,r.checkFrameId=!1,r.hideSelectionInterior=!1,(0,o.viewerCheck)(t),r.parentPass=i,r.lastRenderedFrame=o.INVALID_FRAME_ID,r}return(0,r.__extends)(t,e),t.prototype.reloadShaders=function(){if(this.shader&&this.viewer&&(this.shader=this.viewer.getShader(this.shader.id)),this.childPasses)for(var e=0;e<this.childPasses.length;e++)this.childPasses[e].reloadShaders();Object.values(this.inputs).forEach((function(e){e.reloadShaders()}))},t.prototype.prepareShaders=function(){if(!this.shader&&this.getEnabled()&&this.viewer){if(this.usesShader()&&this.initializeShader(),this.childPasses)for(var e=0;e<this.childPasses.length;e++)this.childPasses[e].prepareShaders();Object.values(this.inputs).forEach((function(e){e.prepareShaders()}))}},t.prototype.usesShader=function(){return!1},t.prototype.initializeShader=function(){this.shader||(this.shader=this.viewer.getShader(this.getShaderId()))},t.prototype.onSessionEnded=function(){this.stopListening()},t.prototype.destroy=function(){if(this.stopListening(),this.childPasses)for(var e=0;e<this.childPasses.length;++e)this.childPasses[e].destroy(),this.childPasses[e]=null;for(var t in this.childPasses=null,this.inputs)this.inputs[t].destroy(),this.inputs[t]=null;this.inputs=null,this.parentPass=null},t.prototype.setEnabled=function(e){this.enabled=e},t.prototype.getEnabled=function(){return this.enabled},t.prototype.setCheckFrameId=function(e){this.checkFrameId=e},t.prototype.getSceneGraph=function(){return this.parentPass?this.parentPass.getSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()},t.prototype.getLastRenderedFrame=function(){return this.lastRenderedFrame},t.prototype.setInput=function(e,t){this.inputs[e]=t},t.prototype.drawInputs=function(e){if(this.getEnabled()){if(this.childPasses)for(var t=0;t<this.childPasses.length;++t)this.childPasses[t].drawInputs(e);Object.values(this.inputs).forEach((function(t){t.drawInputs(e),t.draw(e)}))}},t.prototype.preDraw=function(e){return(0,o.viewerCheck)(this.viewer),(!this.checkFrameId||e.getFrameId()!==this.lastRenderedFrame)&&(this.lastRenderedFrame=e.getFrameId(),!0)},t.prototype.justBeforeDraw=function(e){this.parentPass&&this.parentPass.justBeforeDraw(e)},t.prototype.postDraw=function(e){},t.prototype.onShaderActivated=function(e,t){},t.prototype.justAfterDraw=function(e){this.parentPass&&this.parentPass.justAfterDraw(e)},t.prototype.draw=function(e){if(this.getEnabled()){var t=this;if(this.childPasses||this.getSceneGraph().passesNodeFilter((function(e){return t.nodeFilter(e)})))if(e.setActivePass(this),e.getState().capture(),this.preDraw(e)){if(this.childPasses)for(var i=0;i<this.childPasses.length;++i)this.childPasses[i].draw(e);else this.justBeforeDraw(e),this.getSceneGraph().draw(e),this.justAfterDraw(e);this.postDraw(e),e.getState().restore()}else e.getState().restore()}},t.prototype.isPickPass=function(){return!!this.parentPass&&this.parentPass.isPickPass()},t.prototype.isHighlightPass=function(){return!!this.parentPass&&this.parentPass.isHighlightPass()},t.prototype.getActiveHighlightType=function(){return this.parentPass?this.parentPass.getActiveHighlightType():null},t.prototype.isShowthroughPass=function(){return!!this.parentPass&&this.parentPass.isShowthroughPass()},t.prototype.testIsolation=function(e){return!1},t.prototype.forIsolate=function(){return!this.parentPass||this.parentPass.forIsolate()},t.prototype.forSectionPlaneEndcapMask=function(){return!!this.parentPass&&this.parentPass.forSectionPlaneEndcapMask()},t.prototype.getShaderId=function(){var e="";return this.parentPass&&(e=this.parentPass.getShaderId()),this.shaderTag&&(e+="-"+this.shaderTag),e},t.prototype.needsAttribute=function(e){return!!this.parentPass&&this.parentPass.needsAttribute(e)},t.prototype.getPickIteration=function(){return this.parentPass?this.parentPass.getPickIteration():-1},t.prototype.nodeFilter=function(e){return!this.parentPass||this.parentPass.nodeFilter(e)},t.prototype.addChildPass=function(e){this.childPasses||(this.childPasses=[]),this.childPasses.push(e)},t.prototype.getChildPass=function(e){return this.childPasses&&e<this.childPasses.length?this.childPasses[e]:null},t.prototype.getChildPassCount=function(){return this.childPasses?this.childPasses.length:0},t.prototype.setBlendFilter=function(e){for(var t=0;this.childPasses&&t<this.childPasses.length;++t)this.childPasses[t].setBlendFilter(e)},t.prototype.getPerformIsolationTest=function(){for(var e=0;this.childPasses&&e<this.childPasses.length;++e)if(this.childPasses[e].getPerformIsolationTest())return!0;return!1},t.prototype.setPerformIsolationTest=function(e){for(var t=0;this.childPasses&&t<this.childPasses.length;++t)this.childPasses[t].setPerformIsolationTest(e)},t.prototype.setHideSelectionInterior=function(e){this.hideSelectionInterior=e},t.prototype.createExcludeForNonBodyFilter=function(){var e=this.viewer.getModelViewManagers().getManager();return function(t){return t.getParent()&&e.isNodeForBody(t.getParent())||!1}},t.prototype.createExcludeForBodyFilter=function(){var e=this.viewer.getModelViewManagers().getManager();return function(t){return t.getParent()&&!e.isNodeForBody(t.getParent())||!1}},t.prototype.needsFaceAppearances=function(){return!0},t.prototype.setNodeOccurrenceFilterFunction=function(e){if(this.childPasses)for(var t=0;t<this.childPasses.length;++t)this.childPasses[t].setNodeOccurrenceFilterFunction(e)},t}(n.BackboneEventsBaseClass);t.DrawPass=s;var a=function(e){function t(t,i,r,n){var o=e.call(this,t,null)||this;return o.pass1=i,o.pass2=r,o.predicate=n,o.childPasses=[o.pass1,o.pass2],o}return(0,r.__extends)(t,e),t.prototype.setInput=function(e,t){this.pass1.setInput(e,t),this.pass2.setInput(e,t)},t.prototype.prepareShaders=function(){this.predicate()?this.pass1.prepareShaders():this.pass2.prepareShaders()},t.prototype.drawInputs=function(e){this.predicate()?this.pass1.drawInputs(e):this.pass2.drawInputs(e)},t.prototype.preDraw=function(e){return this.predicate()?this.pass1.preDraw(e):this.pass2.preDraw(e)},t.prototype.justBeforeDraw=function(e){this.predicate()?this.pass1.justBeforeDraw(e):this.pass2.justBeforeDraw(e)},t.prototype.postDraw=function(e){this.predicate()?this.pass1.postDraw(e):this.pass2.postDraw(e)},t.prototype.justAfterDraw=function(e){this.predicate()?this.pass1.justAfterDraw(e):this.pass2.justAfterDraw(e)},t.prototype.draw=function(e){this.predicate()?this.pass1.draw(e):this.pass2.draw(e)},t.prototype.setEnabled=function(e){this.pass1.setEnabled(e),this.pass2.setEnabled(e)},t.prototype.destroy=function(){this.pass1.destroy(),this.pass2.destroy()},t.prototype.setCheckFrameId=function(e){this.pass1.setCheckFrameId(e),this.pass2.setCheckFrameId(e)},t.prototype.getSceneGraph=function(){return this.predicate()?this.pass1.getSceneGraph():this.pass2.getSceneGraph()},t.prototype.isPickPass=function(){return this.predicate()?this.pass1.isPickPass():this.pass2.isPickPass()},t.prototype.isHighlightPass=function(){return this.predicate()?this.pass1.isHighlightPass():this.pass2.isHighlightPass()},t.prototype.getActiveHighlightType=function(){return this.predicate()?this.pass1.getActiveHighlightType():this.pass2.getActiveHighlightType()},t.prototype.isShowthroughPass=function(){return this.predicate()?this.pass1.isShowthroughPass():this.pass2.isShowthroughPass()},t.prototype.forIsolate=function(){return this.predicate()?this.pass1.forIsolate():this.pass2.forIsolate()},t.prototype.getShaderId=function(){return this.predicate()?this.pass1.getShaderId():this.pass2.getShaderId()},t.prototype.needsAttribute=function(e){return this.predicate()?this.pass1.needsAttribute(e):this.pass2.needsAttribute(e)},t.prototype.getPickIteration=function(){return this.predicate()?this.pass1.getPickIteration():this.pass2.getPickIteration()},t.prototype.nodeFilter=function(e){return this.predicate()?this.pass1.nodeFilter(e):this.pass2.nodeFilter(e)},t.prototype.setNodeFilter=function(e){this.pass1.setNodeFilter(e),this.pass2.setNodeFilter(e)},t.prototype.setExtraMeshNodeFilter=function(e){this.pass1.setExtraMeshNodeFilter(e),this.pass2.setExtraMeshNodeFilter(e)},t.prototype.setBlendFilter=function(e){this.pass1.setBlendFilter(e),this.pass2.setBlendFilter(e)},t.prototype.setSceneGraph=function(e){this.pass1.setSceneGraph(e),this.pass2.setSceneGraph(e)},t.prototype.setEnableColorWrites=function(e){this.pass1.setEnableColorWrites(e),this.pass2.setEnableColorWrites(e)},t.prototype.setOpacity=function(e){this.pass1.setOpacity(e),this.pass2.setOpacity(e)},t.prototype.setDrawHidden=function(e){this.pass1.setDrawHidden(e),this.pass2.setDrawHidden(e)},t.prototype.setDrawBackFaceSilhouettes=function(e){this.pass1.setDrawBackFaceSilhouettes(e),this.pass2.setDrawBackFaceSilhouettes(e)},t.prototype.setMaskOpaqueFaces=function(e){this.pass1.setMaskOpaqueFaces(e),this.pass2.setMaskOpaqueFaces(e)},t.prototype.getLastRenderedFrame=function(){return this.predicate()?this.pass1.getLastRenderedFrame():this.pass2.getLastRenderedFrame()},t.prototype.setHideSelectionInterior=function(e){this.pass1.setHideSelectionInterior(e),this.pass2.setHideSelectionInterior(e)},t.prototype.getPerformIsolationTest=function(){return this.pass1.getPerformIsolationTest()||this.pass2.getPerformIsolationTest()},t.prototype.setPerformIsolationTest=function(e){this.pass1.setPerformIsolationTest(e),this.pass2.setPerformIsolationTest(e)},t.prototype.needsFaceAppearances=function(){return this.predicate()?this.pass1.needsFaceAppearances():this.pass2.needsFaceAppearances()},t}(s);t.SwitchPass=a},356860:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearStencilBufferBit=t.clearStencilBuffer=t.setupStencilForTestAndWrite=t.setupStencilForWriteWithoutTest=t.setupStencilForTestWithoutWrite=void 0,t.setupStencilForTestWithoutWrite=function(e,t,i){e.enable(e.STENCIL_TEST),e.stencilFunc(e.GREATER,t,i),e.stencilMask(0),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t.setupStencilForWriteWithoutTest=function(e,t,i){e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,t,255),e.stencilMask(i),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE)},t.setupStencilForTestAndWrite=function(e,t,i){e.enable(e.STENCIL_TEST),e.stencilFunc(e.GREATER,t,i),e.stencilMask(i),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE)},t.clearStencilBuffer=function(e){e.clearStencil(0),e.stencilMask(255),e.clear(e.STENCIL_BUFFER_BIT)},t.clearStencilBufferBit=function(e,t){e.clearStencil(0),e.stencilMask(t),e.clear(e.STENCIL_BUFFER_BIT)}},996828:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeAndHiddenEdgePass=void 0;var r=i(423902),n=i(736202),o=i(311611),s=i(73055),a=function(e){if(!e.isMeshNode())return!1;if(this.blendFilter===o.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(this.blendFilter===o.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;return!!e.getIsDepthTested()&&(!e.hasTransparency()&&(!(e.getIsStencilTested()||!e.getIsStencilWritten())&&(this.priority===e.getRenderOrderPriority()&&this.parentPass.nodeFilter(e))))},c=function(e){var t=this.viewer.getModelViewManagers().getManager(),i=e.getParent();return!!(e.isEdges()&&i&&t.isNodeForBody(i))&&a.call(this,e)},l=function(e){return!!e.isSilhouettes()&&a.call(this,e)},u=function(e){function t(t,i,r){var a=e.call(this,t,i)||this;a.childPasses=[];var u=s.default.getManager(),h=(0,n.clone)(r);h.extraShaderUniforms=[{name:"uColorMixToWhite",value:0}];var d=(0,n.clone)(r);return d.stencilMode=o.StencilMode.TEST_EDGES_AND_POINTS,d.stencilRefValue=o.StencilRefValue.LOW_PRIORITY_EDGES,d.visibility=o.DrawPassVisibility.SHOWTHROUGH,d.disableDepthTest=!0,d.extraShaderUniforms=[{name:"uColorMixToWhite",value:u.getNumber("HIDDEN_LINE_FADE_AMOUNT")}],a.visibleEdgePass1=new o.CustomPass(a.viewer,a,h),h.shaderTagSuffix=o.NO_SECTION_SHADER_ID_SUFFIX,a.visibleEdgePass2=new o.CustomPass(a.viewer,a,h),a.visibleEdgePass=new o.SwitchPass(a.viewer,a.visibleEdgePass1,a.visibleEdgePass2,o.isSectionPlaneModeEnabled),a.childPasses.push(a.visibleEdgePass),a.hiddenEdgePass=new o.CustomPass(a.viewer,a,d),r.primitiveType===o.Primitive.EDGES?a.hiddenEdgePass.setNodeFilter(c):a.hiddenEdgePass.setNodeFilter(l),a.hiddenEdgePass.setEnabled(!1),a.childPasses.push(a.hiddenEdgePass),a}return(0,r.__extends)(t,e),t.prototype.setDrawHidden=function(e){this.hiddenEdgePass.setEnabled(e)},t.prototype.setDrawVisibleParts=function(e){e?this.visibleEdgePass.setNodeFilter(null):this.visibleEdgePass.setNodeFilter(o.hidePartNodesThatDoNotAddToBoundsFilter)},t.prototype.setBlendFilter=function(e){this.visibleEdgePass.setBlendFilter(e),this.hiddenEdgePass.setBlendFilter(e)},t.prototype.setExtraMeshNodeFilter=function(e){this.visibleEdgePass.setExtraMeshNodeFilter(e),this.hiddenEdgePass.setExtraMeshNodeFilter(e)},Object.defineProperty(t.prototype,"nodeOccurrenceFilterFunction",{set:function(e){this.visibleEdgePass1.nodeOccurrenceFilterFunction=e,this.visibleEdgePass1.nodeOccurrenceFilterFunction=e,this.hiddenEdgePass.nodeOccurrenceFilterFunction=e},enumerable:!1,configurable:!0}),t}(o.DrawPass);t.EdgeAndHiddenEdgePass=u},606753:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FaceSingleHighlightDrawPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r,o){var s=e.call(this,t)||this;s.highlightType=i,s.disableDuringPreview=o,s.shaderTag="highlightDraw",s.interiorHighlightOpacity=.5,s.inputs.uHighlightBuffer=new n.FaceHighlightBufferPass(s.viewer,i);var a=new n.FaceHighlightMaskPass(s.viewer,i,r),c=a.opaqueFacePass.nodeFilter;return a.opaqueFacePass.setNodeFilter((function(e){this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&e.hasNonIsolatedOccurrences()&&this.viewer.getModelViewManagers().getManager().isNodeForModel(e)&&a.opaqueFacePass.setOpacity(n.Opacity.ALL);var t=c.call(a.opaqueFacePass,e);return a.opaqueFacePass.setOpacity(n.Opacity.OPAQUE),t})),a.opaqueFacePass.setNodeOccurrenceFilterFunction((function(e){return!(!s.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()||e.occurrenceData.getIsolated())||!e.parentHasTransparency()})),s.inputs.uHighlightMask=a,s.scenegraph=s.viewer.getSceneGraphs().getMainSceneGraph(),s}return(0,r.__extends)(t,e),t.prototype.setMaskOpaqueFaces=function(e){this.inputs.uHighlightMask.opaqueFacePass.setEnabled(e)},t.prototype.setSceneGraph=function(e){this.scenegraph=e,this.inputs.uHighlightBuffer.setSceneGraph(e),this.inputs.uHighlightMask.setSceneGraph(e)},t.prototype.getSceneGraph=function(){return this.scenegraph},t.prototype.getEnabled=function(){return this.enabled&&(!this.disableDuringPreview||!(0,n.isUsagePreview)())},t.prototype.setInteriorHighlightOpacity=function(e){this.interiorHighlightOpacity=e},t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t);var i=this.viewer.getReferenceHighlights().highlights[this.highlightType];this.shader.uniform4fv("uHighlightColor1",i.color1),this.shader.uniform4fv("uHighlightColorBorder",i.colorBorder),this.shader.uniform1f("uInteriorHighlightOpacity",this.interiorHighlightOpacity),this.shader.uniform1i("uHideSelectionInterior",this.hideSelectionInterior?1:0),this.shader.uniform1i("uOutlineOverlappingInteriorRegions",i.outlineOverlappingInteriorRegions?1:0)},t.prototype.postDraw=function(t){e.prototype.postDraw.call(this,t)},t}(n.BlitPass);t.FaceSingleHighlightDrawPass=o},444357:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildFacesLinesPointsPasses=void 0;var r=i(311611);t.buildFacesLinesPointsPasses=function(e,t,i){var n=[],o=!!i.hasOwnProperty("usePickAlternates")&&i.usePickAlternates;return i.primitiveType=r.Primitive.FACES,n.push(new r.CustomPass(e,t,i)),o&&n.push(new r.PickAlternates(e,t,i)),i.primitiveType=r.Primitive.EDGES,n.push(new r.CustomPass(e,t,i)),o&&n.push(new r.PickAlternates(e,t,i)),i.primitiveType=r.Primitive.POINTS,n.push(new r.CustomPass(e,t,i)),n}},648809:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinePointAllHighlightsDrawPass=t.LinePointSingleHighlightDrawPass=t.FaceAllHighlightsDrawPass=void 0;var r=i(423902),n=i(311611),o=i(73055),s=function(e){function t(t,i,r,o,s){var a=e.call(this,t,i)||this;a.childPasses=[];var c=!!s;a.scenegraph=a.viewer.getSceneGraphs().getMainSceneGraph(),o===n.bt_graphics_Usage.PREVIEW&&(a.scenegraph=a.viewer.getSceneGraphs().getPreviewSceneGraph()),a.usage=o||n.bt_graphics_Usage.BASE;for(var l=a.viewer.getReferenceHighlights().sortedHighlights,u=0;u<l.length;++u){var h=l[u].type;if(!s||s.has(h)){n.HighlightType.FILTERED_ENTITIES;var d=h===n.HighlightType.FILTERED_ENTITIES&&!c,p=new n.FaceSingleHighlightDrawPass(a.viewer,h,r,d);p.setSceneGraph(a.scenegraph),a.childPasses.push(p)}}return a}return(0,r.__extends)(t,e),t.prototype.setInteriorHighlightOpacity=function(e){for(var t=0;t<this.childPasses.length;++t)this.childPasses[t].setInteriorHighlightOpacity(e)},t.prototype.getSceneGraph=function(){return this.scenegraph},t.prototype.drawInputs=function(e){},t.prototype.draw=function(e){if(this.usage!==n.bt_graphics_Usage.BASE||e.getBaseHighlightsEnabled())for(var t=0;t<this.childPasses.length;++t)this.viewer.getHighlightManager(this.usage).highlightHasSelections(this.childPasses[t].highlightType)&&(this.childPasses[t].drawInputs(e),this.childPasses[t].draw(e))},t.prototype.setHideSelectionInterior=function(e){for(var t=0;t<this.childPasses.length;++t)this.childPasses[t].setHideSelectionInterior(!!e&&this.childPasses[t].highlightType!==n.HighlightType.PRE)},t.prototype.setMaskOpaqueFaces=function(e){for(var t=0;t<this.childPasses.length;t++)this.childPasses[t].setMaskOpaqueFaces(e)},t}(n.DrawPass);t.FaceAllHighlightsDrawPass=s;var a=function(e){function t(t,i,r,s,a,c,l){var u=e.call(this,t,r)||this;u.highlightType=i,u.useDepthTest=s,u.stippleOverride=a,u.clipAgainstSectionPlane=c,u.disableDuringPreview=l,u.shaderTag="highlightDraw",u.childPasses=[];var h=void 0;c||(h=n.NO_SECTION_SHADER_ID_SUFFIX);for(var d=o.default.getManager(),p=0;p<n.RenderOrderPriority.COUNT;++p)u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.EDGES,visibility:n.DrawPassVisibility.SHOWTHROUGH,stencilMode:n.StencilMode.TEST_EDGES_AND_POINTS,disableDepthTest:!0,priority:p,shaderTagSuffix:h})),u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.POINTS,visibility:n.DrawPassVisibility.SHOWTHROUGH,stencilMode:n.StencilMode.TEST_EDGES_AND_POINTS,disableDepthTest:!0,priority:p,shaderTagSuffix:h})),u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.EDGES,visibility:n.DrawPassVisibility.SHOWTHROUGH,disableDepthTest:!0,priority:p,shaderTagSuffix:h})),u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.POINTS,visibility:n.DrawPassVisibility.SHOWTHROUGH,disableDepthTest:!0,priority:p,shaderTagSuffix:h})),u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.EDGES,visibility:n.DrawPassVisibility.SHOWTHROUGH,priority:p,shaderTagSuffix:h})),u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.POINTS,visibility:n.DrawPassVisibility.SHOWTHROUGH,priority:p,shaderTagSuffix:h}));return u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.EDGES,shaderTagSuffix:h})),u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.EDGES,opacity:n.Opacity.TRANSPARENT,stencilMode:n.StencilMode.OFF,extraShaderUniforms:[{name:"uHighlightLineWidthMin",value:d.getNumber("HIGHLIGHT_LINE_WIDTH_TRANSPARENT_MIN")}],shaderTagSuffix:h})),u.childPasses.push(new n.CustomPass(u.viewer,u,{primitiveType:n.Primitive.POINTS,shaderTagSuffix:h})),u}return(0,r.__extends)(t,e),t.prototype.isHighlightPass=function(){return!0},t.prototype.getActiveHighlightType=function(){return this.highlightType},t.prototype.needsAttribute=function(e){var t=e===n.AttributeNames.HIGHLIGHT_ID;return this.parentPass?t||this.parentPass.needsAttribute(e):t},t.prototype.getHighlight=function(){return this.viewer.getReferenceHighlights().highlights[this.highlightType]},t.prototype.getEnabled=function(){return this.enabled&&(!this.disableDuringPreview||!(0,n.isUsagePreview)())},t.prototype.nodeFilter=function(e){return this.getHighlight().forOccurrences?e.getParent()&&!this.viewer.getModelViewManagers().getManager().isNodeForBody(e.getParent()):n.DrawPass.prototype.nodeFilter.apply(this,arguments)},t.prototype.justBeforeDraw=function(t){var i=o.default.getManager();e.prototype.justBeforeDraw.call(this,t);var r=t.getActiveShader(),s=this.getHighlight(),a=s.type===n.HighlightType.FILTERED_ENTITIES;r.uniform1f("uActiveHighlightIndex",s.index),r.uniform4fv("uHighlightColor",s.color1),r.uniform1f("uHighlightLineWidthMin",a?i.getNumber("HIGHLIGHT_LINE_WIDTH_REDUCED_PX"):i.getNumber("HIGHLIGHT_LINE_WIDTH_MIN_PX")),r.uniform1f("uHighlightPointSizeMin",i.getNumber("HIGHLIGHT_POINT_SIZE_MIN_PX")),this.stippleOverride?(r.uniform4fv("uHighlightLineStipple",this.stippleOverride),r.uniform1f("uUseHighlightLineStipple",1),t.setUseHiddenOpacityForEdgeHighlights(!0)):(r.uniform1f("uUseHighlightLineStipple",0),t.setUseHiddenOpacityForEdgeHighlights(!1)),r.uniform1i("uClippedBySectionPlanes",this.clipAgainstSectionPlane?1:0);var c=this.viewer.getGlContext();c.enable(c.BLEND),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),this.useDepthTest?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),t.getState().callGl("depthMask",!1)},t}(n.DrawPass);t.LinePointSingleHighlightDrawPass=a;var c=function(e){function t(t,i,r,s){var c=e.call(this,t,null)||this;c.childPasses=[];var l=o.default.getManager();c.usage=i||n.bt_graphics_Usage.BASE,c.scenegraph=c.viewer.getSceneGraphs().getMainSceneGraph(),i===n.bt_graphics_Usage.PREVIEW&&(c.scenegraph=c.viewer.getSceneGraphs().getPreviewSceneGraph());for(var u=!!s,h=0;h<c.viewer.getReferenceHighlights().sortedHighlights.length;++h){var d=c.viewer.getReferenceHighlights().sortedHighlights[h].type;if(!s||s.has(d)){var p=d===n.HighlightType.FILTERED_ENTITIES,g=d===n.HighlightType.FILTERED_ENTITIES,f=d===n.HighlightType.FILTERED_ENTITIES&&!u;r?p&&c.childPasses.push(new a(c.viewer,d,c,!0,null,g,f)):p?c.childPasses.push(new a(c.viewer,d,c,!1,l.getStipple("HIGHLIGHT_HIDDEN_LINE_STIPPLE"),g,f)):c.childPasses.push(new a(c.viewer,d,c,!1,null,g,f))}}return c}return(0,r.__extends)(t,e),t.prototype.preDraw=function(t){return!(this.usage===n.bt_graphics_Usage.BASE&&!t.getBaseHighlightsEnabled())&&e.prototype.preDraw.call(this,t)},t.prototype.drawInputs=function(e){for(var t=0;t<this.childPasses.length;++t)this.childPasses[t].setEnabled(this.viewer.getHighlightManager(this.usage).highlightHasSelections(this.childPasses[t].highlightType));n.DrawPass.prototype.drawInputs.apply(this,arguments)},t.prototype.setSceneGraph=function(e){this.scenegraph=e},t.prototype.getSceneGraph=function(){return this.scenegraph},t}(n.DrawPass);t.LinePointAllHighlightsDrawPass=c},62151:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FaceHighlightMaskPass=t.FaceHighlightBufferPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this,t,{id:"highlightBuffer"})||this;r.highlightType=i,r.shaderTag="highlightBuffer",r.childPasses=[],r.clearColor=[0,0,0,0],r.childPasses.push(new n.CustomPass(r.viewer,r,{})),r.childPasses.push(new n.CustomPass(r.viewer,r,{opacity:n.Opacity.TRANSPARENT}));for(var o=0;o<n.RenderOrderPriority.COUNT;++o)r.childPasses.push(new n.CustomPass(r.viewer,r,{visibility:n.DrawPassVisibility.SHOWTHROUGH,priority:o}));return r}return(0,r.__extends)(t,e),t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t);var i=this.viewer.getGlContext();i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE),i.disable(i.DEPTH_TEST),t.getState().callGl("depthMask",!1);var r=t.getActiveShader(),n=this.viewer.getReferenceHighlights().highlights[this.highlightType];r.uniform1f("uActiveHighlightIndex",n.index)},t.prototype.isHighlightPass=function(){return!0},t.prototype.getActiveHighlightType=function(){return this.highlightType},t.prototype.needsAttribute=function(e){var t=e===n.AttributeNames.HIGHLIGHT_ID;return this.parentPass?t||this.parentPass.needsAttribute(e):t},t.prototype.setSceneGraph=function(e){this.scenegraph=e},t.prototype.getSceneGraph=function(){return this.scenegraph},t}(n.BufferedPass);t.FaceHighlightBufferPass=o;var s=function(e){function t(t,i,r){var o=e.call(this,t,{id:"highlightMask"})||this;return o.highlightType=i,o.shaderTag="highlightMask",o.childPasses=[],o.clearColor=[255,255,255,255],o.opaqueFacePass=new n.CustomPass(o.viewer,o,{shaderTagSuffix:r?n.NO_SECTION_SHADER_ID_SUFFIX:""}),o.childPasses.push(o.opaqueFacePass),o}return(0,r.__extends)(t,e),t.prototype.justBeforeDraw=function(e){var t=e.getActiveShader(),i=this.viewer.getReferenceHighlights().highlights[this.highlightType];t.uniform1f("uActiveHighlightIndex",i.index)},t.prototype.setSceneGraph=function(e){for(var t=0;t<this.childPasses.length;t++)this.childPasses[t].setSceneGraph(e)},t.prototype.needsAttribute=function(e){var t=e===n.AttributeNames.HIGHLIGHT_ID;return this.parentPass?t||this.parentPass.needsAttribute(e):t},t.prototype.getActiveHighlightType=function(){return this.highlightType},t}(n.BufferedPass);t.FaceHighlightMaskPass=s},771191:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HudPass=t.HudModelPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this,t,i)||this;r.previousModelViewMatrix=null,r.previousProjectionMatrix=null;var o=new n.FaceEdgePointPass(r.viewer,r,{opacity:n.Opacity.ALL});return r.childPasses=[o],r}return(0,r.__extends)(t,e),t.prototype.getSceneGraph=function(){return this.viewer.getSceneGraphs().getHudModelSceneGraph()},t.prototype.preDraw=function(e){return this.previousModelViewMatrix=e.getModelViewMatrix(),this.previousProjectionMatrix=e.getProjectionMatrix(),e.popProjectionMatrix(),e.popModelViewMatrix(),!0},t.prototype.postDraw=function(e){e.pushModelViewMatrix(this.previousModelViewMatrix),e.pushProjectionMatrix(this.previousProjectionMatrix)},t}(n.DrawPass);t.HudModelPass=o;var s=function(e){function t(t,i){var r,s=e.call(this,t,i)||this,a=new n.DefaultPasses(s.viewer,s,null,n.DefaultPassUsage.HUD,!0);for(s.childPasses=[],s.childPasses.push(a.opaqueFaces),s.childPasses.push(new o(s.viewer,s)),s.childPasses.push(a.nonOitTransparentFaces),s.childPasses.push(a.opaqueEdges),s.childPasses.push(a.opaquePoints),r=0;r<s.childPasses.length;++r){var c=s.childPasses[r];c instanceof n.CustomPass&&(c.clipToSectionPlanes=!1)}return s.childPasses.push(a.showThroughStencilTested),s.childPasses.push(a.showThroughNotStencilTested),s}return(0,r.__extends)(t,e),t.prototype.getSceneGraph=function(){return this.viewer.getSceneGraphs().getHudSceneGraph()},t.prototype.preDraw=function(e){var t=this.viewer.getGlContext();t.clear(t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);var i,r,o,s,a,c=this.isPickPass()&&this.parentPass&&this.parentPass.oldViewport&&this.parentPass.pickRect,l=c?this.parentPass.oldViewport:e.getViewport(),u=e.getActiveCamera(),h=u.getTileViewport();c?a=this.parentPass.pickRect:h&&(a=h,l=u.getViewport(!0)),a?(i=a[0],r=a[0]+a[2],o=l[3]-(a[1]+a[3]),s=l[3]-a[1]):(i=l[0],r=l[0]+l[2],o=l[1],s=l[1]+l[3]);var d=(0,n.getHudLayerDepthRange)(l),p=new n.OrthographicCamera({eye:[0,0,0],direction:[0,0,-1],up:[0,1,0],left:i,right:r,bottom:o,top:s,near:d[0],far:d[1]});return e.pushModelViewMatrix(p.getViewMatrix()),e.pushProjectionMatrix(p.getProjectionMatrix()),!0},t.prototype.postDraw=function(e){e.popProjectionMatrix(),e.popModelViewMatrix()},t}(n.DrawPass);t.HudPass=s},337688:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GhostParentPass=t.IsolateContextPass=t.getTransparencyTransition=t.setTransparencyTransition=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(227441),a=i(712197),c=0;t.setTransparencyTransition=function(e){c=e},t.getTransparencyTransition=function(){return c};var l=function(e){function t(t,i,r,s){var a=e.call(this,t,i,r,s,!1)||this,l=o.default.getManager(),u=function(e){(0,n.clearStencilBufferBit)(e.viewer.getGlContext(),n.StencilRefMask.FACES),n.CustomPass.prototype.postDraw.apply(this,arguments)},h=l.getNumber("ISOLATE_CONTEXT_FACE_TRANSPARENCY"),d=l.getNumber("ISOLATE_CONTEXT_EDGE_TRANSPARENCY"),p=a,g=function(e){var t=p.getTransparencyMultiplier(),i=t*h,r=i*c+(1-c);e.getActiveShader().uniform1f("uIsolateContextOpacity",r),n.CustomPass.prototype.justBeforeDraw.apply(this,arguments)},f=function(e){var t=a.getTransparencyMultiplier()*h*c+(1-c);e.getActiveShader().uniform1f("uIsolateContextOpacity",t)},m=function(e){var t=a.getTransparencyMultiplier()*d*c+(1-c);t=Math.sqrt(t),e.getActiveShader().uniform1f("uIsolateContextOpacity",t)};a.depthFaces.postDraw=u,a.depthFaces.opacity=n.Opacity.ALL,a.depthEdges.forDepth=!0,a.depthEdges.postDraw=function(e){(0,n.clearStencilBufferBit)(e.viewer.getGlContext(),n.StencilRefMask.EDGES),n.CustomPass.prototype.postDraw.apply(this,arguments)},a.depthEdges.opacity=n.Opacity.ALL,a.sectionPlaneEndcap.childPasses.forEach((function(e){e.forDepthTesting=!0,e.shaderTag="endcap-depth"})),a.opaqueFaces=new n.CustomPass(a.viewer,a,{primitiveType:n.Primitive.FACES,opacity:n.Opacity.ALL,depthTestMode:n.DepthTestMode.LEQUAL,performIsolationTest:!0,stencilMode:n.StencilMode.WRITE_AND_TEST_FACES,sceneGraph:r}),a.opaqueFaces.postDraw=u,a.opaqueFaces.justBeforeDraw=g,a.opaqueFacesCurvatureVisualization=new n.CustomPass(a.viewer,a,{facesShader:n.FacesShadeMode.CURVATURE,performIsolationTest:!0,opacity:n.Opacity.ALL,depthTestMode:n.DepthTestMode.LEQUAL,extraShaderUniforms:[{name:"uStripeCount",value:l.getNumber("ZEBRA_STRIPE_COUNT")},{name:"uStripeRotation",value:l.getNumber("ZEBRA_STRIPE_ROTATION")},{name:"uFilterWidth",value:l.getNumber("ZEBRA_STRIPE_FILTER_WIDTH")},{name:"uRespectOrthographic",value:l.getNumber("ZEBRA_STRIPE_RESPECT_ORTHOGRAPHIC")}]}),a.opaqueFacesCurvatureVisualization.justBeforeDraw=g,a.opaqueEdges.justBeforeDraw=m,a.transparentEdges.justBeforeDraw=m,a.opaquePoints.justBeforeDraw=m;for(var y=n.RenderOrderPriority.LOWER;y<=n.RenderOrderPriority.HIGHEST;++y)a.showThroughStencilTested.getChildPass(y).justBeforeDraw=f;return a}return(0,r.__extends)(t,e),t.prototype.setFilters=function(){var e=this.getNodeOccurrenceFilter();if(e){this.depthFaces.setNodeOccurrenceFilterFunction(e),this.opaqueFaces.setNodeOccurrenceFilterFunction(e),this.opaqueFacesCurvatureVisualization.setNodeOccurrenceFilterFunction(e),this.opaqueEdges.setNodeOccurrenceFilterFunction(e),this.transparentEdges.setNodeOccurrenceFilterFunction(e),this.opaquePoints.setNodeOccurrenceFilterFunction(e);for(var t=n.RenderOrderPriority.LOWER;t<=n.RenderOrderPriority.HIGHEST;++t)this.showThroughStencilTested.getChildPass(t).setNodeOccurrenceFilterFunction(e)}this.depthEdges.setNodeOccurrenceFilterFunction((function(e){return e.occurrenceData.getIsolated()})),this.depthFaces.setExtraMeshNodeFilter(this.createExcludeForNonBodyFilter())},t.prototype.preDraw=function(t){return 0!==this.getTransparencyMultiplier()&&e.prototype.preDraw.call(this,t)},t.prototype.setRenderingMode=function(t){e.prototype.setRenderingMode.call(this,t),this.opaqueFaces.setOpacity(n.Opacity.ALL),this.depthFaces.setOpacity(n.Opacity.ALL),this.depthEdges.setOpacity(n.Opacity.ALL)},t.prototype.setZebraStripeCount=function(e){this.opaqueFacesCurvatureVisualization.setShaderUniform("uStripeCount",e)},t.prototype.setZebraStripeRotation=function(e){this.opaqueFacesCurvatureVisualization.setShaderUniform("uStripeRotation",e)},t}(n.DefaultPasses),u=function(e){function t(t,i,r,n){var o=e.call(this,t,i,r,n)||this;return o.setFilters(),o}return(0,r.__extends)(t,e),t.prototype.getNodeOccurrenceFilter=function(){var e=this.viewer.getModelViewManagers().getManager();return function(t){var i=t.occurrenceData.getOccurrenceId();return!e.isOccurrenceIdForInContext(i)}},t.prototype.getTransparencyMultiplier=function(){return this.viewer.getIsolatedOccurrenceManager().getIsIsolateFullyTransparent()?0:1},t.prototype.preDraw=function(t){return!!(this.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode()||null!==this.viewer.getInterferenceCallId()&&""!==this.viewer.getInterferenceCallId())&&e.prototype.preDraw.call(this,t)},t}(l),h=function(e){function t(t,i,r,n,o){var s=e.call(this,t,i,r,n)||this;return s.filterForInContext=o,s.setFilters(),s}return(0,r.__extends)(t,e),t.prototype.getNodeOccurrenceFilter=function(){var e=this,t=this.viewer.getModelViewManagers().getManager();return this.filterForInContext?function(e){if(!t.isDisplayingIncontextAssembly())return!1;var i=e.occurrenceData.getOccurrenceId();return t.isOccurrenceIdForInContext(i)}:function(i){if(!e.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode())return!0;var r=i.occurrenceData;return t.isOccurrenceIdForInContext(r.getOccurrenceId())||r.getIsolated()}},t.prototype.getTransparencyMultiplier=function(){return this.viewer.getIsolatedOccurrenceManager().getContextTransparencyMultiplier()},t.prototype.preDraw=function(t){return!!(0,a.getActiveInContextNodeId)()&&e.prototype.preDraw.call(this,t)},t}(l),d=function(e){function t(t,i,r,o){var a=e.call(this,t,i)||this;if(a.ghostedChildrenPasses=[],o=o||a.viewer.getSceneGraphs().getMainSceneGraph(),r){if(a.ghostedChildrenPasses.push(new h(a.viewer,a,o,n.DefaultPassUsage.ISOLATION,!1)),o.isForPreview()){var c=a.viewer.getSceneGraphs().getMainSceneGraph();a.ghostedChildrenPasses.push(new h(a.viewer,a,c,n.DefaultPassUsage.ISOLATION,!0))}}else a.ghostedChildrenPasses.push(new u(a.viewer,a,o,n.DefaultPassUsage.ISOLATION));return a.childPasses=[],a.ghostedChildrenPasses.forEach((function(e){a.childPasses.push(e.depthFaces)})),a.ghostedChildrenPasses.forEach((function(e){a.childPasses.push(e.sectionPlaneEndcap)})),a.ghostedChildrenPasses.forEach((function(e){a.childPasses.push(e.depthEdges)})),a.ghostedChildrenPasses.forEach((function(e){a.addModelPasses(e)})),a.childPasses.push(new n.DepthClearPass(a.viewer,a)),a.ghostedChildrenPasses.forEach((function(e){a.addShowThroughPasses(e)})),a.setRenderingMode(s.GBTGraphicsRenderMode.SHADED_WITH_EDGES),a}return(0,r.__extends)(t,e),t.prototype.addModelPasses=function(e){this.childPasses.push(e.opaqueFaces),this.childPasses.push(e.opaqueFacesCurvatureVisualization),this.childPasses.push(e.opaqueEdges),this.childPasses.push(e.transparentEdges),this.childPasses.push(e.opaquePoints)},t.prototype.addShowThroughPasses=function(e){for(var t=n.RenderOrderPriority.LOWER;t<=n.RenderOrderPriority.HIGHEST;++t)this.childPasses.push(e.showThroughStencilTested.getChildPass(t))},t.prototype.forIsolate=function(){return!1},t.prototype.preDraw=function(t){return!!this.ghostedChildrenPasses.reduce((function(e,i){return i.preDraw(t)||e}),!1)&&e.prototype.preDraw.call(this,t)},t.prototype.setRenderingMode=function(e){e!==s.GBTGraphicsRenderMode.TRANSLUCENT&&e!==s.GBTGraphicsRenderMode.DRAFT_ANALYSIS||(e=s.GBTGraphicsRenderMode.SHADED_WITH_EDGES),this.ghostedChildrenPasses.forEach((function(t){t.setRenderingMode(e)}))},t.prototype.setHideSelectionInterior=function(e){this.ghostedChildrenPasses.forEach((function(t){t.setHideSelectionInterior(e)}))},t.prototype.justBeforeDraw=function(e){var t=this.viewer.getGlContext();t.disable(t.BLEND)},t.prototype.setZebraStripeCount=function(e){this.ghostedChildrenPasses.forEach((function(t){return t.setZebraStripeCount(e)}))},t.prototype.setZebraStripeRotation=function(e){this.ghostedChildrenPasses.forEach((function(t){return t.setZebraStripeRotation(e)}))},t}(n.DrawPass);t.IsolateContextPass=d;var p=function(e){function t(t,i,r,o){var s=e.call(this,t,i)||this;s.isolateContextPass=new d(t,s,r,o);s.childBuffer=(0,n.makeBufferedPass)(s.viewer,s.isolateContextPass,1,"highlightBuffer"),s.childBuffer.clearColor=[1,1,1,0];var a=new n.BlitBufferedPass(s.viewer,s.childBuffer,{performDrawInputs:!0});return s.childPasses=[a],s}return(0,r.__extends)(t,e),t.prototype.preDraw=function(t){return!!this.isolateContextPass.preDraw(t)&&e.prototype.preDraw.call(this,t)},t.prototype.setRenderingMode=function(e){this.isolateContextPass.setRenderingMode(e)},t.prototype.setHideSelectionInterior=function(e){this.isolateContextPass.setHideSelectionInterior(e)},t.prototype.setZebraStripeCount=function(e){this.isolateContextPass.setZebraStripeCount(e)},t.prototype.setZebraStripeRotation=function(e){this.isolateContextPass.setZebraStripeRotation(e)},t}(n.DrawPass);t.GhostParentPass=p},228722:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MainDrawPass=void 0;var r=i(423902),n=i(73055),o=i(227441),s=i(311611),a=function(e){function t(t){var i=e.call(this,t,null)||this;i.shaderTag="draw",i.ssaoBufferPass=null,i.inferenceDisplayPasses=[],i.clearColor=[0,0,0,0],i.forceHideInteriorSelections=!1;var r=n.default.getManager();i.defaultPasses=new s.DefaultPasses(i.viewer,i,i.viewer.getSceneGraphs().getMainSceneGraph(),s.DefaultPassUsage.RENDERING),i.childPasses=[],i.childPasses.push(i.defaultPasses.opaqueFaces),i.childPasses.push(i.defaultPasses.opaqueFacesCurvatureVisualization),i.childPasses.push(i.defaultPasses.draftAnalysisFaces),i.childPasses.push(i.defaultPasses.qualityVisualization),r.getNumber("AMBIENT_OCCLUSION_EFFECT_FACTOR")>0&&(0,s.isSSAOSupported)(t.getGlContext())&&(i.ssaoBufferPass=(0,s.makeSSAOPass)(i.viewer),i.defaultPasses.opaqueFaces.setInput("uOcclusionMap",i.ssaoBufferPass)),i.partPreviewPass=new s.PartPreviewPass(i.viewer,i),i.childPasses.push(i.partPreviewPass),i.partComparePass=new s.PartComparePass(i.viewer,i),i.childPasses.push(i.partComparePass),i.childPasses.push(i.defaultPasses.transparentFaces),i.defaultPasses.depthTransparentFaces.setEnabled(!1),i.childPasses.push(i.defaultPasses.depthTransparentFaces),i.childPasses.push(i.defaultPasses.sketchImageFaces),i.childPasses.push(i.defaultPasses.sectionPlaneEndcap),i.childPasses.push(i.defaultPasses.opaqueEdges),i.childPasses.push(i.defaultPasses.silhouettes);var a=new s.CustomPass(i.viewer,i,{primitiveType:s.Primitive.EDGES,stencilMode:s.StencilMode.OFF});i.childPasses.push(a),i.childPasses.push(i.defaultPasses.transparentEdges);var c=new s.LinePointAllHighlightsDrawPass(i.viewer,s.bt_graphics_Usage.BASE,!0);i.childPasses.push(c),i.childPasses.push(i.defaultPasses.isolatePass),i.defaultPasses.contextPass&&i.childPasses.push(i.defaultPasses.contextPass),i.childPasses.push(i.defaultPasses.opaquePoints);var l=new s.FaceAllHighlightsDrawPass(i.viewer,i,!1),u=new s.FaceAllHighlightsDrawPass(i.viewer,i,!0);i.faceHighlightDrawPass=new s.SwitchPass(i.viewer,l,u,s.isSectionPlaneModeEnabled),i.childPasses.push(i.faceHighlightDrawPass),i.childPasses.push(new s.DepthClearPass(i.viewer,i));for(var h=s.RenderOrderPriority.LOWER;h<=s.RenderOrderPriority.DEFAULT;++h)i.childPasses.push(i.defaultPasses.showThroughStencilTested.getChildPass(h)),i.childPasses.push(i.defaultPasses.showThroughNotStencilTested.getChildPass(h)),i.childPasses.push(i.defaultPasses.showThroughDepthTested.getChildPass(h));i.linePointAllHighlightsDrawPass=new s.LinePointAllHighlightsDrawPass(i.viewer,s.bt_graphics_Usage.BASE,!1),i.childPasses.push(i.linePointAllHighlightsDrawPass);for(h=s.RenderOrderPriority.HIGHER;h<=s.RenderOrderPriority.HIGHEST;++h)i.childPasses.push(i.defaultPasses.showThroughStencilTested.getChildPass(h)),i.childPasses.push(i.defaultPasses.showThroughNotStencilTested.getChildPass(h)),i.childPasses.push(i.defaultPasses.showThroughDepthTested.getChildPass(h));if(i.childPasses.push(new s.HudPass(i.viewer,i)),i.visualizeBodyCheckPass=new s.BlitBufferedPass(i.viewer,i.viewer.bodyCheckPass,{viewport:[0,0,s.BodyCheckPass.TEST_VIEWPORT_WIDTH,s.BodyCheckPass.TEST_VIEWPORT_HEIGHT]}),i.visualizeBodyCheckPass.enabled=!1,i.childPasses.push(i.visualizeBodyCheckPass),i.visualizeFullScreenBodyCheckPass=new s.BlitBufferedPass(i.viewer,new s.BodyCheckPass(t,!0),{shaderTag:"blitBodyCheck",performDrawInputs:!0}),i.visualizeFullScreenBodyCheckPass.enabled=!1,i.childPasses.push(i.visualizeFullScreenBodyCheckPass),i.debugDrawPickPass=new s.DebugPickPass(i.viewer),i.debugDrawPickPass.setEnabled(!1),i.childPasses.push(i.debugDrawPickPass),0!==r.getNumber("DISPLAY_INFERENCE_BUFFER")){var d=new s.CustomPass(i.viewer,i,{primitiveType:s.Primitive.EDGES,visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:s.RenderOrderPriority.LOWER});d.setEnabled(!1);var p=new s.CustomPass(i.viewer,i,{primitiveType:s.Primitive.POINTS,visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:s.RenderOrderPriority.DEFAULT});p.setEnabled(!1);var g=new s.CustomPass(i.viewer,i,{primitiveType:s.Primitive.POINTS,visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:s.RenderOrderPriority.HIGHER});g.setEnabled(!1),i.childPasses.push(d),i.childPasses.push(p),i.childPasses.push(g),i.inferenceDisplayPasses.push(d),i.inferenceDisplayPasses.push(p),i.inferenceDisplayPasses.push(g)}return i.setRenderingMode(o.GBTGraphicsRenderMode.SHADED_WITH_EDGES),i.listenTo((0,s.getEditState)(),s.Events.PREVIEW_STATE_CHANGE,i.onPreviewStateChange),i.listenTo((0,s.getEditState)(),s.Events.PREVIEW_BLEND_CHANGE,i.updateHideInteriorSelections),i.onPreviewStateChange(),i.listenTo(i.viewer.getEventDispatcher(),s.SESSION_ENDED,i.onSessionEnded),i}return(0,r.__extends)(t,e),t.prototype.setClearColor=function(e,t,i,r){this.clearColor=[e,t,i,r]},t.prototype.onPreviewStateChange=function(){this.partPreviewPass.setEnabled((0,s.isUsagePreview)()),this.partComparePass.setEnabled((0,s.isUsageCompare)()),(0,s.isUsageCompare)()?(this.faceHighlightDrawPass.setEnabled(!1),this.linePointAllHighlightsDrawPass.setEnabled(!1)):(this.faceHighlightDrawPass.setEnabled(!0),this.linePointAllHighlightsDrawPass.setEnabled(!0)),(0,s.isUsageBase)()?(this.defaultPasses.setBlendFilter(s.BlendFilter.ALL),this.defaultPasses.transparentFaces.setEnabled(!0),this.defaultPasses.sectionPlaneEndcap.setEnabled(!0),this.defaultPasses.isolatePass.setEnabled(!0),this.defaultPasses.contextPass&&this.defaultPasses.contextPass.setEnabled(!0)):(this.defaultPasses.setBlendFilter(s.BlendFilter.NON_BLEND_ONLY),(0,s.isUsagePreviewFinal)()&&this.defaultPasses.transparentFaces.setEnabled(!1),this.defaultPasses.sectionPlaneEndcap.setEnabled(!1),this.defaultPasses.isolatePass.setEnabled(!1),this.defaultPasses.contextPass&&this.defaultPasses.contextPass.setEnabled(!1)),this.updateHideInteriorSelections(),this.viewer.requestDraw()},Object.defineProperty(t.prototype,"sectionPlaneEndcapMaskPass",{get:function(){return this.defaultPasses.sectionPlaneEndcapMask},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"draftAnalysisPass",{get:function(){return this.defaultPasses.draftAnalysisFaces},enumerable:!1,configurable:!0}),t.prototype.setForceHideInteriorSelections=function(e){this.forceHideInteriorSelections=e,this.updateHideInteriorSelections()},t.prototype.updateHideInteriorSelections=function(){var e=(0,s.isUsagePreviewAfter)(),t=n.default.getManager().getNumber("DEFAULT_INTERIOR_HIGHLIGHT_OVERLAY_OPACITY");this.forceHideInteriorSelections?this.setHideSelectionInterior(!0):e?(this.defaultPasses.setHideSelectionInterior(!0),this.faceHighlightDrawPass.setHideSelectionInterior(!1),this.partPreviewPass.setHideSelectionInterior(!0),t=n.default.getManager().getNumber("PREVIEW_INTERIOR_HIGHLIGHT_OVERLAY_OPACITY")):this.setHideSelectionInterior(!1),this.faceHighlightDrawPass.pass1.setInteriorHighlightOpacity(t),this.faceHighlightDrawPass.pass2.setInteriorHighlightOpacity(t)},t.prototype.setHideSelectionInterior=function(e){this.defaultPasses.setHideSelectionInterior(e),this.faceHighlightDrawPass.setHideSelectionInterior(e),this.partPreviewPass.setHideSelectionInterior(e)},t.prototype.visualizeInferenceSceneGraph=function(e){for(var t=0;t<this.inferenceDisplayPasses.length;++t)this.inferenceDisplayPasses[t].setEnabled(!!e),this.inferenceDisplayPasses[t].setSceneGraph(e)},t.prototype.setRenderingMode=function(e){this.defaultPasses.setRenderingMode(e),this.partPreviewPass.setRenderingMode(e),this.partComparePass.setRenderingMode(e)},t.prototype.drawInputs=function(t){this.ssaoBufferPass&&this.ssaoBufferPass.setEnabled(t.getDetailSettings().enableSSAO),e.prototype.drawInputs.call(this,t)},t.prototype.preDraw=function(e){var t=this.viewer.getGlContext();return t.stencilMask(255),t.clearStencil(0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[1],this.clearColor[2]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),!0},t.prototype.nodeFilter=function(e){return e.isMeshNode()||e.getIsVisible()},t.prototype.setDraftAnalysisPullDirection=function(e){this.defaultPasses.draftAnalysisFaces.setPullDirection(e),this.partPreviewPass.setDraftAnalysisPullDirection(e)},t.prototype.setDraftAnalysisMinimumAngle=function(e){this.defaultPasses.draftAnalysisFaces.setMinimumAngle(e),this.partPreviewPass.setDraftAnalysisMinimumAngle(e)},t.prototype.setDraftAnalysisParts=function(e){this.defaultPasses.draftAnalysisFaces.setParts(e),this.partPreviewPass.setDraftAnalysisParts(e)},t.prototype.setDraftAnalysisShowUndercut=function(e){this.defaultPasses.draftAnalysisFaces.setShowUndercut(e),this.partPreviewPass.setDraftAnalysisShowUndercut(e)},t.prototype.getDebugDrawPickPass=function(){return this.debugDrawPickPass},t.prototype.setZebraStripeCount=function(e){this.defaultPasses.setZebraStripeCount(e),this.partComparePass.setZebraStripeCount(e),this.partPreviewPass.setZebraStripeCount(e)},t.prototype.setZebraStripeRotation=function(e){this.defaultPasses.setZebraStripeRotation(e),this.partComparePass.setZebraStripeRotation(e),this.partPreviewPass.setZebraStripeRotation(e)},t}(s.DrawPass);t.MainDrawPass=a},696096:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NormalDepthWithMaskPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this,t)||this;return r.shaderTag="normalDepthWithMask",r.tintedEdges=new n.CustomPass(r.viewer,r,{primitiveType:n.Primitive.EDGES}),r.tintedEdges.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()})),r.tintedPoints=new n.CustomPass(r.viewer,r,{primitiveType:n.Primitive.POINTS}),r.tintedPoints.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()})),r.childPasses.push(r.tintedEdges),r.childPasses.push(r.tintedPoints),i&&(r.inputs.uMask=i),r}return(0,r.__extends)(t,e),t.prototype.justBeforeDraw=function(t){var i=t.getActiveShader();if(this.inputs.uMask){i.useTexture("uMask",this.inputs.uMask.getColorTexture());var r=t.getViewport();i.uniform2f("uMaskWidthHeight",r[2],r[3]),i.uniform1f("uUseMask",1)}else i.uniform1f("uUseMask",0),i.useBlankTexture("uMask");e.prototype.justBeforeDraw.call(this,t)},t.prototype.nodeFilter=function(e){return!!e.isMeshNode()&&e.getIsVisible()},t}(n.NormalDepthPass);t.NormalDepthWithMaskPass=o},311814:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeSSAOPass=t.FilterOcclusionPass=t.CalculateOcclusionPass=t.NormalDepthFilter=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(911748),a=i(991140),c=64,l=function(e){for(var t=new a.MersenneTwister(0),i=new Uint8Array(4096),r=0;r<4096;++r)i[r]=Math.floor(256*t.random());var o=new n.TextureDefinition(e);return o.internalFormat=e.LUMINANCE,o.format=e.LUMINANCE,o.bytes=i,o.width=c,o.height=c,o.minificationFilter=e.LINEAR,o.magnificationFilter=e.LINEAR,o.wrapS=e.REPEAT,o.wrapT=e.REPEAT,o},u=function(e){function t(t,i){var r=e.call(this,t)||this;return r.shaderTag="normalDepthFilter",r.blendPass=!1,r.inputs.uNormalDepthTexture=i,r}return(0,r.__extends)(t,e),t}(n.BlitPass);t.NormalDepthFilter=u;var h=function(e){function t(t,i,r){var o=e.call(this,t)||this;return o.shaderTag="occlusion",o.inputs.uNormalDepthTexture=r||i,o.normalDepthPass=i,o.filteredNormalDepthPass=r,o.randomTexture=new n.Texture(o.viewer,l),o}return(0,r.__extends)(t,e),t.prototype.drawInputs=function(e){var t=e.getDetailSettings();this.filteredNormalDepthPass&&t.enableSSAOFilter?this.inputs.uNormalDepthTexture=this.filteredNormalDepthPass:this.inputs.uNormalDepthTexture=this.normalDepthPass,n.BlitPass.prototype.drawInputs.call(this,e)},t.prototype.justBeforeDraw=function(t){var i=o.default.getManager();e.prototype.justBeforeDraw.call(this,t),this.shader.useTexture("uRandomTexture",this.randomTexture);var r=t.getViewport(),n=r[2],a=r[3],l=Math.sqrt(n*n+a*a);this.shader.uniform2fv("uRandomTextureScale",[(n-1)/c,(a-1)/c]);var u=s.mat4.inverse(t.getProjectionMatrix(),s.mat4.create());u&&this.shader.uniformMatrix4fv("uPMatrixInv_fs",!1,u),this.shader.uniform1f("uIntensity",i.getNumber("AMBIENT_OCCLUSION_INTENSITY")),this.shader.uniform1f("uBias",i.getNumber("AMBIENT_OCCLUSION_BIAS")),this.shader.uniform1f("uScale",i.getNumber("AMBIENT_OCCLUSION_SCALE")),this.shader.uniform1f("uRadiusNear",Math.max(i.getNumber("AMBIENT_OCCLUSION_RADIUS_NEAR")*l,2)),this.shader.uniform1f("uRadiusFar",Math.max(i.getNumber("AMBIENT_OCCLUSION_RADIUS_FAR")*l,2))},t}(n.BlitPass);t.CalculateOcclusionPass=h;var d=function(e){function t(t,i){var r=e.call(this,t)||this;return r.shaderTag="occlusionFilter",r.blendPass=!1,r.inputs.uOcclusionMap=i,r}return(0,r.__extends)(t,e),t}(n.BlitPass);t.FilterOcclusionPass=d,t.makeSSAOPass=function(e){var t=o.default.getManager(),i=(0,n.makeBufferedNormalDepthPass)(e,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoBuffer1"),r=null;if(e.isSSAOFilteringSupported()){var s=new u(e,i);r=(0,n.makeBufferedPass)(e,s,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoFilterBuffer")}var a=new h(e,i,r),c=(0,n.makeBufferedPass)(e,a,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoBuffer2"),l=new d(e,c);return(0,n.makeBufferedPass)(e,l,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoBuffer1")}},131642:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OITBufferPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r,o){var s=e.call(this,t,{makeFrameBuffer:!1})||this;return s.component=r,s.depthPass=o,s.sceneGraph=null,s.clearColor=[0,0,0,0],s.colorPass=new n.OITColorPass(s.viewer,r),s.childPasses=[s.depthPass,s.colorPass],s.component!==n.OITComponent.ACCUMULATION&&(s.clearColor=[1,1,1,1]),s}return(0,r.__extends)(t,e),t.prototype.clearBuffer=function(e){var t=this.viewer.getGlContext();t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e&&e.getFrameId()===this.depthPass.getLastRenderedFrame()?t.clear(t.COLOR_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.prototype.appliesTranslucentAlphaToAll=function(e){this.colorPass.appliesTranslucentAlphaToAll(e)},t.prototype.setSceneGraph=function(e){this.colorPass.setSceneGraph(e),this.depthPass.setSceneGraph(e)},t.prototype.setBlendFilter=function(e){this.colorPass.setBlendFilter(e)},t.prototype.setDepthPassEnabled=function(e){this.depthPass.setEnabled(e)},t.prototype.setDepthOpacity=function(e){e===n.Opacity.ALL?this.depthPass.setExtraMeshNodeFilter(this.createExcludeForNonBodyFilter()):this.depthPass.setExtraMeshNodeFilter(null),this.depthPass.setOpacity(e)},t.prototype.setExtraMeshNodeFilter=function(e){this.colorPass.setExtraMeshNodeFilter(e)},t.prototype.setTintColor=function(e){this.colorPass.setTintColor(e)},t.prototype.setTintFactor=function(e){this.colorPass.setTintFactor(e)},t.prototype.setHideSelectionInterior=function(e){this.colorPass.setHideSelectionInterior(e)},t.prototype.setPerformIsolationTest=function(e){this.colorPass.performIsolationTest=e},t}(n.BufferedPass);t.OITBufferPass=o},910152:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OITColorPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this,t,null)||this;return r.component=i,r.shader=null,r.applyTranslucentAlphaToAll=!1,r.sceneGraph=null,r.tintColor=[1,1,1],r.tintFactor=0,r.performIsolationTest=!1,r.shaderTag="OIT"+i,r.blendFilter=n.BlendFilter.ALL,r}return(0,r.__extends)(t,e),t.prototype.usesShader=function(){return!0},t.prototype.preDraw=function(e){this.initializeShader();var t=this.viewer.getGlContext();e.setMaterial(),e.activateShader(this.shader);var i=this;if(e.nodeFilter=function(e){if(e.getIsShowThrough()||!e.getIsDepthTested())return!1;if(i.blendFilter===n.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(i.blendFilter===n.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;return!(!i.applyTranslucentAlphaToAll||!e.isFaces())||!(i.extraMeshNodeFilter&&!i.extraMeshNodeFilter(e))&&!(!e.isFaces()||!e.hasTransparency())},(0,n.updateShaderClippingUniforms)(this.viewer,!0),this.shader.uniform1i("uApplyTranslucentAlphaToAll",this.applyTranslucentAlphaToAll?1:0),this.shader.uniform1i("uHideSelectionInterior",this.hideSelectionInterior?1:0),this.shader.uniform1f("uTintFactor",this.tintFactor),this.shader.uniform3f("uTintColor",this.tintColor[0],this.tintColor[1],this.tintColor[2]),this.testIsolation(e)?this.shader.uniform1f("uIsolationSelector",this.forIsolate()?1:0):this.shader.uniform1f("uIsolationSelector",-1),e.getState().callGl("depthMask",!1),this.component===n.OITComponent.ACCUMULATION){var r=this.viewer.getResources().getHighlightTexture();this.shader.useTexture("uHighlightColorTexture",r),this.shader.uniform1f("uHighlightColorTextureWidth",this.viewer.getReferenceHighlights().getHighlightTextureWidth()),t.blendFunc(t.ONE,t.ONE)}else t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_ALPHA);return this.applyTranslucentAlphaToAll?t.disable(t.DEPTH_TEST):t.enable(t.DEPTH_TEST),t.enable(t.BLEND),!0},t.prototype.appliesTranslucentAlphaToAll=function(e){this.applyTranslucentAlphaToAll=e},t.prototype.setSceneGraph=function(e){this.sceneGraph=e},t.prototype.getSceneGraph=function(){return this.sceneGraph?this.sceneGraph:e.prototype.getSceneGraph.call(this)},t.prototype.setBlendFilter=function(e){this.blendFilter=e},t.prototype.setExtraMeshNodeFilter=function(e){this.extraMeshNodeFilter=e},t.prototype.setTintColor=function(e){this.tintColor=e},t.prototype.setTintFactor=function(e){this.tintFactor=e},t.prototype.testIsolation=function(e){return this.performIsolationTest&&e.getHasIsolate()},t}(n.DrawPass);t.OITColorPass=o},86004:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OITCompositePass=void 0;var r=i(423902),n=function(e){function t(t,i,r,n,o){var s=e.call(this,t)||this;s.shaderTag="OITComposite",s.inputs.uAccumulationBuffer=i,s.inputs.uRevealageBuffer=r,s.sceneGraph=n;var a=s.viewer.getGlContext(),c={id:"transparency",storageType:a.DEPTH_COMPONENT16,attachmentType:a.DEPTH_ATTACHMENT};o=o||"";var l=s.viewer.getOrCreateFrameBuffer(s.viewer.getDefaultFloatTextureType(),o+"TranslucentBufferAccumulation",c),u=s.viewer.getOrCreateFrameBuffer(a.UNSIGNED_BYTE,o+"TranslucentBufferRevealage",c);return s.inputs.uAccumulationBuffer.setFrameBuffer(l),s.inputs.uRevealageBuffer.setFrameBuffer(u),s}return(0,r.__extends)(t,e),t.prototype.setSceneGraph=function(e){this.sceneGraph=e},t.prototype.getSceneGraph=function(){return this.sceneGraph?this.sceneGraph:e.prototype.getSceneGraph.call(this)},t}(i(311611).BlitPass);t.OITCompositePass=n},914533:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartComparePass=void 0;var r=i(423902),n=i(311611),o=i(73055).default.getManager(),s=(n.DefaultPasses,n.Opacity),a=n.Primitive,c=function(e,t,i,r,o,s){var a=new n.TranslucentPass(e,t,i,s);return a.setTintColor(r),a.setTintFactor(o),a},l=function(e){function t(t,i){var r=e.call(this,t,i)||this,l=r.viewer.getSceneGraphs().getPreviewSceneGraph(),u=o.getColor("COMPARE_BASE_TINT"),h=o.getColor("COMPARE_TARGET_TINT"),d=o.getColor("COMPARE_SAME_LIT_TINT"),p=o.getColor("COMPARE_SAME_UNLIT_TINT");r.underDepthPass=(0,n.makeBufferedNormalDepthWithMaskPass)(r.viewer,null,1),r.existsInBothDepthPass=(0,n.makeBufferedNormalDepthWithMaskPass)(r.viewer,r.underDepthPass,1),r.underPlaneIdPass=(0,n.makeBufferedPass)(r.viewer,new n.PlaneIdPass(r.viewer,r,null),1),r.existsInBothPlaneIdPass=(0,n.makeBufferedPass)(r.viewer,new n.PlaneIdPass(r.viewer,r,r.underPlaneIdPass),1),r.baseDefaultPasses.opaqueFaces=new n.TintedPass(r.viewer,r,{},u,d,r.existsInBothDepthPass),r.compareDefaultPasses.opaqueFaces=new n.TintedPass(r.viewer,r,{sceneGraph:l},h,d,r.existsInBothDepthPass),r.viewer.supportsOrderIndependentTranslucency()&&(r.baseDefaultPasses.transparentFaces=c(r.viewer,r,null,u,1,"CompareBase"),r.compareDefaultPasses.transparentFaces=c(r.viewer,r,l,h,1,"CompareTarget")),r.baseDefaultPasses.opaqueEdges.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),r.compareDefaultPasses.opaqueEdges.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),r.baseDefaultPasses.opaquePoints.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),r.compareDefaultPasses.opaquePoints.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),r.baseDefaultPasses.compareTransparentFaces=new n.TintedPass(r.viewer,r,{opacity:s.TRANSPARENT},u,p,r.existsInBothPlaneIdPass),r.compareDefaultPasses.compareTransparentFaces=new n.TintedPass(r.viewer,r,{sceneGraph:l,opacity:s.TRANSPARENT},h,p,r.existsInBothPlaneIdPass),r.baseDefaultPasses.compareTintedEdges=new n.TintedPass(r.viewer,r,{primitiveType:a.EDGES},u,p,r.existsInBothDepthPass),r.baseDefaultPasses.compareTintedPoints=new n.TintedPass(r.viewer,r,{primitiveType:a.POINTS},u,p,r.existsInBothDepthPass),r.compareDefaultPasses.compareTintedEdges=new n.TintedPass(r.viewer,r,{sceneGraph:l,primitiveType:a.EDGES},h,p,r.existsInBothDepthPass),r.compareDefaultPasses.compareTintedPoints=new n.TintedPass(r.viewer,r,{sceneGraph:l,primitiveType:a.POINTS},h,p,r.existsInBothDepthPass);var g=function(e,t,i,r){var o,s=[];for(s.push(i.opaqueFaces),s.push(i.opaqueFacesCurvatureVisualization),s.push(i.draftAnalysisFaces),s.push(i.qualityVisualization),s.push(i.transparentFaces),s.push(i.sketchImageFaces),s.push(i.compareTransparentFaces),s.push(i.opaqueEdges),s.push(i.silhouettes),s.push(i.compareTintedEdges),s.push(new n.FaceAllHighlightsDrawPass(e,t,!1,r)),s.push(i.opaquePoints),s.push(i.compareTintedPoints),s.push(new n.LinePointAllHighlightsDrawPass(e,r,!0)),s.push(new n.DepthClearPass(e,t)),o=0;o<=n.RenderOrderPriority.DEFAULT;++o)s.push(i.showThroughNotStencilTested.getChildPass(o)),s.push(i.showThroughDepthTested.getChildPass(o));for(s.push(new n.LinePointAllHighlightsDrawPass(e,r,!1)),o=n.RenderOrderPriority.HIGHER;o<=n.RenderOrderPriority.HIGHEST;++o)s.push(i.showThroughNotStencilTested.getChildPass(o)),s.push(i.showThroughDepthTested.getChildPass(o));return i.showThroughNotStencilTested.setBlendFilter(n.BlendFilter.BLEND_ONLY),i.showThroughDepthTested.setBlendFilter(n.BlendFilter.BLEND_ONLY),s};r.underBasePass=new n.DrawPass(r.viewer,r),r.underBasePass.childPasses=g(r.viewer,r.underBasePass,r.baseDefaultPasses,n.bt_graphics_Usage.BASE),r.underComparePass=new n.DrawPass(r.viewer,r),r.underComparePass.childPasses=g(r.viewer,r.underComparePass,r.compareDefaultPasses,n.bt_graphics_Usage.PREVIEW),r.overBufferPass=new n.BufferedPass(r.viewer),r.overBufferPass.clearColor=[1,1,1,1],r.overBufferPass.childPasses=[];for(var f=0;f<r.underBasePass.childPasses.length;++f)r.overBufferPass.childPasses.push(r.underBasePass.childPasses[f]),r.overBufferPass.childPasses.push(r.underComparePass.childPasses[f]);return r.compareBlendPass=new n.CompareBlendPass(r.viewer,r.overBufferPass),r.listenTo((0,n.getEditState)(),n.Events.PREVIEW_BLEND_CHANGE,r.onStateChange),r.listenTo(r.viewer.getEventDispatcher(),n.SESSION_ENDED,r.onSessionEnded),r.setBlendFilters(),r}return(0,r.__extends)(t,e),t.prototype.onStateChange=function(){this.enabled&&(0,n.requestDraw)()},t.prototype.drawInputs=function(e){var t;if((0,n.getPreviewAlpha)()<.5){for(t=0;t<this.underDepthPass.childPasses.length;++t)this.underDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph()),this.existsInBothDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph());this.underPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph()),this.existsInBothPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.childPasses=[this.underBasePass,this.compareBlendPass]}else{for(t=0;t<this.underDepthPass.childPasses.length;++t)this.underDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.existsInBothDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph());this.underPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.existsInBothPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph()),this.childPasses=[this.underComparePass,this.compareBlendPass]}n.DrawPass.prototype.drawInputs.call(this,e)},t.prototype.setZebraStripeCount=function(e){this.baseDefaultPasses.setZebraStripeCount(e),this.compareDefaultPasses.setZebraStripeCount(e)},t.prototype.setZebraStripeRotation=function(e){this.baseDefaultPasses.setZebraStripeRotation(e),this.compareDefaultPasses.setZebraStripeRotation(e)},t}(n.PartStudioBlendPass);t.PartComparePass=l},158825:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartPreviewPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this,t,i)||this,o=[1,1,1,1];r.baseBufferPass=new n.BufferedPass(r.viewer),r.compareBufferPass=new n.BufferedPass(r.viewer),r.baseBufferPass.clearColor=o,r.compareBufferPass.clearColor=o;var s=new Set;s.add(n.HighlightType.FILTERED_ENTITIES);var a=function(e,t,i){var o=[r.nonEditedFaceDepthPass,r.nonEditedEdgeDepthPass,t.opaqueFaces,t.opaqueFacesCurvatureVisualization,t.draftAnalysisFaces,t.qualityVisualization,t.transparentFaces,t.depthTransparentFaces,t.sketchImageFaces,t.sectionPlaneEndcap,t.opaqueEdges,t.silhouettes,t.transparentEdges,t.opaquePoints,t.isolatePass];t.contextPass&&o.push(t.contextPass),o.push(new n.FaceAllHighlightsDrawPass(e,null,!1,i,s)),o.push(new n.LinePointAllHighlightsDrawPass(e,i,!0,s)),o.push(new n.DepthClearPass(e,r));for(var a=0;a<n.RenderOrderPriority.COUNT;++a)o.push(t.showThroughStencilTested.getChildPass(a)),o.push(t.showThroughNotStencilTested.getChildPass(a)),o.push(t.showThroughDepthTested.getChildPass(a));return o.push(new n.LinePointAllHighlightsDrawPass(e,i,!1,s)),o};return r.baseBufferPass.childPasses=a(r.viewer,r.baseDefaultPasses,n.bt_graphics_Usage.BASE),r.compareBufferPass.childPasses=a(r.viewer,r.compareDefaultPasses,n.bt_graphics_Usage.PREVIEW),r.previewBlendPass=new n.PreviewBlendPass(r.viewer,r.baseBufferPass,r.compareBufferPass),r.setBlendFilters(),r.listenTo((0,n.getEditState)(),n.Events.PREVIEW_BLEND_CHANGE,r.onStateChange),r.listenTo((0,n.getEditState)(),n.Events.PREVIEW_STATE_CHANGE,r.onStateChange),r.listenTo(r.viewer.getEventDispatcher(),n.SESSION_ENDED,r.onSessionEnded),r.onStateChange(),r}return(0,r.__extends)(t,e),t.prototype.onStateChange=function(){if(this.childPasses=[],!(0,n.isUsageBase)()&&!(0,n.isUsageCompare)())if((0,n.isUsagePreviewAfter)())this.pushOpaqueDepthPassWithAlpha(),this.childPasses.push(this.previewBlendPass);else for(var e=0;e<this.compareBufferPass.childPasses.length;++e){var t=this.compareBufferPass.childPasses[e];t!==this.nonEditedFaceDepthPass&&t!==this.nonEditedEdgeDepthPass&&this.childPasses.push(t)}this.viewer.requestDraw()},t.prototype.setDraftAnalysisPullDirection=function(e){this.baseDefaultPasses.draftAnalysisFaces.setPullDirection(e),this.compareDefaultPasses.draftAnalysisFaces.setPullDirection(e)},t.prototype.setDraftAnalysisMinimumAngle=function(e){this.baseDefaultPasses.draftAnalysisFaces.setMinimumAngle(e),this.compareDefaultPasses.draftAnalysisFaces.setMinimumAngle(e)},t.prototype.setDraftAnalysisParts=function(e){this.baseDefaultPasses.draftAnalysisFaces.setParts(e),this.compareDefaultPasses.draftAnalysisFaces.setParts(e)},t.prototype.setDraftAnalysisShowUndercut=function(e){this.baseDefaultPasses.draftAnalysisFaces.setShowUndercut(e),this.compareDefaultPasses.draftAnalysisFaces.setShowUndercut(e)},t.prototype.setZebraStripeCount=function(e){this.baseDefaultPasses.setZebraStripeCount(e),this.compareDefaultPasses.setZebraStripeCount(e)},t.prototype.setZebraStripeRotation=function(e){this.baseDefaultPasses.setZebraStripeRotation(e),this.compareDefaultPasses.setZebraStripeRotation(e)},t}(n.PartStudioBlendPass);t.PartPreviewPass=o},296152:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioBlendPass=void 0;var r=i(423902),n=i(311611),o=i(227441),s=function(e){function t(t,i){var r=e.call(this,t,i)||this,s=r.viewer.getSceneGraphs().getMainSceneGraph(),a=r.viewer.getSceneGraphs().getPreviewSceneGraph();return r.baseDefaultPasses=new n.DefaultPasses(r.viewer,r,s,n.DefaultPassUsage.RENDERING),r.compareDefaultPasses=new n.DefaultPasses(r.viewer,r,a,n.DefaultPassUsage.RENDERING),r.baseDefaultPasses.depthTransparentFaces.setEnabled(!1),r.compareDefaultPasses.depthTransparentFaces.setEnabled(!1),r.nonEditedFaceDepthPass=new n.CustomPass(r.viewer,r,{primitiveType:n.Primitive.FACES,disableColorWrites:!0}),r.nonEditedEdgeDepthPass=new n.CustomPass(r.viewer,r,{primitiveType:n.Primitive.EDGES,disableColorWrites:!0}),r.setRenderingMode(o.GBTGraphicsRenderMode.SHADED_WITH_EDGES),r}return(0,r.__extends)(t,e),t.prototype.setBlendFilters=function(){this.baseDefaultPasses.setBlendFilter(n.BlendFilter.BLEND_ONLY),this.compareDefaultPasses.setBlendFilter(n.BlendFilter.BLEND_ONLY),this.nonEditedFaceDepthPass.setBlendFilter(n.BlendFilter.NON_BLEND_ONLY),this.nonEditedEdgeDepthPass.setBlendFilter(n.BlendFilter.NON_BLEND_ONLY)},t.prototype.setHideSelectionInterior=function(e){this.baseDefaultPasses.setHideSelectionInterior(e),this.compareDefaultPasses.setHideSelectionInterior(e)},t.prototype.pushOpaqueDepthPassWithAlpha=function(){n.DefaultPasses;(0,n.getPreviewAlpha)()>.5?(this.childPasses.push(this.compareDefaultPasses.depthFaces),this.childPasses.push(this.compareDefaultPasses.sectionPlaneEndcap),this.childPasses.push(this.compareDefaultPasses.depthEdges)):(this.childPasses.push(this.baseDefaultPasses.depthFaces),this.childPasses.push(this.baseDefaultPasses.sectionPlaneEndcap),this.childPasses.push(this.baseDefaultPasses.depthEdges))},t.prototype.setRenderingMode=function(e){this.baseDefaultPasses.setRenderingMode(e),this.compareDefaultPasses.setRenderingMode(e)},t}(n.DrawPass);t.PartStudioBlendPass=s},756848:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBlendAmount=void 0;var r=i(311611);t.getBlendAmount=function(){var e=(0,r.getEditState)().get("previewAlpha");return e<.5?2*e:2*(1-e)}},794576:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickAlternates=void 0;var r=i(423902),n=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.enabled=!1,n.shaderTag="alternates-"+n.shaderTag,n}return(0,r.__extends)(t,e),t.prototype.usesShader=function(){return!0},t.prototype.preDraw=function(t){return this.initializeShader(),t.setPickPrimitiveAlternates(!0),e.prototype.preDraw.call(this,t)},t.prototype.postDraw=function(t){return t.setPickPrimitiveAlternates(!1),e.prototype.postDraw.call(this,t)},t}(i(311611).CustomPass);t.PickAlternates=n},157352:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickPass=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(712197),a=i(227441),c=i(911748),l=o.default.getManager(),u=function(e){function t(t,i){var r=e.call(this,t)||this;r.TEMP_VEC4=c.vec4.create(),r.TEMP_MAT4=c.mat4.create(),r.shaderTag="pick",r.checkFrameId=!1,r.pickBuffer=null,r.pickRect=[0,0,1,1],r.pickViewportWidthHeight=[1,1],r.enablePickViewportScaling=!0,r.oldViewport=[0,0,1,1],r.hitlist=[],r.isBoxSelecting=!1,r.suppressNonIsolatedPicks=!0,r.childrenPerformIsolationTest=null,r.childPassIsolateTests=[],r.nodeFilterOverride=null,r.pickFromPreview=!1,r.pickFrustum=new n.ViewFrustum;var o=new n.DefaultPasses(r.viewer,r,null,n.DefaultPassUsage.PICKING);r.opaqueFacePass=o.opaqueFaces,r.opaqueFaceAlternatePass=new n.PickAlternates(r.viewer,r,{performIsolationTest:!0}),r.childPasses=[],r.childPasses.push(r.opaqueFacePass),r.childPasses.push(r.opaqueFaceAlternatePass),i&&r.childPasses.push(new n.SectionPlaneEndcapDrawPasses(r.viewer,r,i.sectionPlaneEndcapMaskPass)),r.transparentFacePass=o.nonOitTransparentFaces,r.transparentFaceAlternatePass=new n.PickAlternates(r.viewer,r,{opacity:n.Opacity.TRANSPARENT,performIsolationTest:!0}),r.childPasses.push(r.transparentFacePass),r.childPasses.push(r.transparentFaceAlternatePass),r.childPasses.push(o.sketchImageFaces),r.postOpaqueFaceDepthClearPass=(0,n.makeDepthClearPass)(r.viewer,r),r.postOpaqueFaceDepthClearPass.setEnabled(!1),r.childPasses.push(r.postOpaqueFaceDepthClearPass),r.opaqueEdgesPass=new n.CustomPass(r.viewer,r,{primitiveType:n.Primitive.EDGES,performIsolationTest:!0}),r.opaqueEdgesAlternatesPass=new n.PickAlternates(r.viewer,r,{primitiveType:n.Primitive.EDGES,performIsolationTest:!0}),r.childPasses.push(r.opaqueEdgesPass),r.childPasses.push(r.opaqueEdgesAlternatesPass),r.childPasses.push(o.transparentEdges),r.childPasses.push(new n.PickAlternates(r.viewer,r,{primitiveType:n.Primitive.EDGES,opacity:n.Opacity.TRANSPARENT,performIsolationTest:!0})),r.opaquePointsPass=o.opaquePoints,r.childPasses.push(r.opaquePointsPass),r.childPasses.push((0,n.makeDepthClearPass)(r.viewer,r));for(var s=0;s<n.RenderOrderPriority.COUNT;++s)r.childPasses.push(o.showThroughStencilTested.getChildPass(s)),r.childPasses.push(o.showThroughNotStencilTested.getChildPass(s)),r.childPasses.push(o.showThroughDepthTested.getChildPass(s));r.childPasses.push((0,n.buildHudPass)(r.viewer,r)),r.clearColor=n.PICK_CLEAR_COLOR;for(s=0;s<r.childPasses.length;s++)r.childPassIsolateTests[s]=r.childPasses[s].getPerformIsolationTest();return r.isolatedNodeOccurrenceFilter=function(e){if(e.occurrenceData.getIsolated()||!r.viewer.getIsolatedOccurrenceManager().isInIsolateMode()&&!r.viewer.getIsolatedOccurrenceManager().isInMakeTransparentMode()||r.viewer.getIsForFlattenedDisplay())return!0;var t=e.occurrenceData.getOccurrenceId();return t===n.PART_STUDIO_ELEMENT_ID||!(!r.viewer.getModelViewManagers().getManager().isDisplayingIncontextAssembly()||!r.viewer.getModelViewManagers().getManager().isOccurrenceIdForInContext(t))},r}return(0,r.__extends)(t,e),t.prototype.setPickFromPreview=function(e){this.pickFromPreview=e},t.prototype.setPickAlternatesEnabled=function(e){for(var t=0;t<this.childPasses.length;++t)if(this.childPasses[t]instanceof n.PickAlternates)this.childPasses[t].setEnabled(e);else if(this.childPasses[t]instanceof n.FaceEdgePointPass)for(var i=0;i<this.childPasses[t].childPasses.length;++i)this.childPasses[t].childPasses[i]instanceof n.PickAlternates&&this.childPasses[t].childPasses[i].setEnabled(e)},t.prototype.setPerformIsolationTest=function(e){if(this.childrenPerformIsolationTest!==e)if(this.childrenPerformIsolationTest=e,this.childrenPerformIsolationTest)for(var t=0;t<this.childPasses.length;t++)this.childPasses[t].setPerformIsolationTest(this.childPassIsolateTests[t]);else for(t=0;t<this.childPasses.length;t++)this.childPasses[t].setPerformIsolationTest(!1)},t.prototype.setSuppressNonIsolatedPicks=function(e){this.suppressNonIsolatedPicks=e},t.prototype.setIsBoxSelecting=function(e){this.isBoxSelecting=e},t.prototype.setRenderingMode=function(e){var t=this,i=function(e){e?(t.opaqueEdgesPass.setNodeFilter(null),t.opaqueEdgesAlternatesPass.setNodeFilter(null),t.opaquePointsPass.setNodeFilter(null)):(t.opaqueEdgesPass.setNodeFilter(n.hidePartNodesThatDoNotAddToBoundsFilter),t.opaqueEdgesAlternatesPass.setNodeFilter(n.hidePartNodesThatDoNotAddToBoundsFilter),t.opaquePointsPass.setNodeFilter(n.hidePartNodesThatDoNotAddToBoundsFilter))};switch(e){case a.GBTGraphicsRenderMode.SHADED_WITH_EDGES:case a.GBTGraphicsRenderMode.DRAFT_ANALYSIS:case a.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION:case a.GBTGraphicsRenderMode.SIMULATION_RESULTS:case a.GBTGraphicsRenderMode.SHADED_WITHOUT_EDGES:this.postOpaqueFaceDepthClearPass.setEnabled(!1),i(!0);break;case a.GBTGraphicsRenderMode.SHADED_WITH_HIDDEN_EDGES:this.postOpaqueFaceDepthClearPass.setEnabled(!0),i(!0);break;case a.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED:this.postOpaqueFaceDepthClearPass.setEnabled(!1),i(!0);break;case a.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE:case a.GBTGraphicsRenderMode.WIREFRAME:case a.GBTGraphicsRenderMode.TRANSLUCENT:this.postOpaqueFaceDepthClearPass.setEnabled(!0),i(!0)}},t.prototype.isPickPass=function(){return!0},t.prototype.setEnablePickViewportScaling=function(e){this.enablePickViewportScaling=e},t.prototype.getMaxHighResPickViewportSamples=function(){return l.getNumber("MAX_HIGH_RES_PICKING_RECT_SAMPLES")},t.prototype.setPickRect=function(e,t,i,r,n){this.pickRect=[e,t,i,r];var o=i*r;if(n&&o>n){var s=Math.sqrt(n/o),a=Math.floor((i-1)*s)+1,c=Math.floor((r-1)*s)+1;this.pickViewportWidthHeight=[a,c]}else if(this.enablePickViewportScaling&&o>this.getMaxHighResPickViewportSamples()){var u=l.getNumber("LOW_RES_PICKING_RECT_SCALE"),h=1/Math.min(i,r);s=Math.max(u,h),a=Math.floor((i-1)*s)+1,c=Math.floor((r-1)*s)+1;this.pickViewportWidthHeight=[a,c]}else this.pickViewportWidthHeight=[i,r]},t.prototype.getPickRect=function(){return this.pickRect},t.prototype.getPickViewportWidthHeight=function(){return this.pickViewportWidthHeight},t.prototype.getPickFrustum=function(e,t){var i=this.TEMP_VEC4;i[0]=this.pickRect[0]-t,i[1]=this.pickRect[1]-t,i[2]=this.pickRect[2]+2*t,i[3]=this.pickRect[3]+2*t;var r=(0,n.createPickMatrix)(i,e.getViewport(),e.getActiveCamera().getCanvasHeight()),o=c.mat4.multiply(r,e.getProjectionMatrix(),this.TEMP_MAT4);return this.pickFrustum.updateClippingPlanes(e.getModelViewMatrix(),o),this.pickFrustum},t.prototype.preDraw=function(t){t.setNodeOccurrenceFilterFunction(this.isolatedNodeOccurrenceFilter);var i=this.getAllowedSelections(),r=this.suppressNonIsolatedPicks||!1===i.allowsNonModifiableGeometry;this.setPerformIsolationTest(r),this.oldViewport=t.getViewport();var o=(0,n.createPickMatrix)(this.pickRect,this.oldViewport,t.getActiveCamera().getCanvasHeight()),s=c.mat4.multiply(o,t.getProjectionMatrix(),this.TEMP_MAT4);return t.pushProjectionMatrix(s),t.pushViewport([0,0,this.pickViewportWidthHeight[0],this.pickViewportWidthHeight[1]]),e.prototype.preDraw.call(this,t)},t.prototype.getAllowedSelections=function(){return this.isBoxSelecting?(0,s.getAllowedBoxSelections)():(0,s.getAllowedSelections)()},t.prototype.setNodeFilterOverride=function(e){this.nodeFilterOverride=e||null},t.prototype.nodeFilter=function(e){if(this.nodeFilterOverride)return this.nodeFilterOverride(e);var t=this.getAllowedSelections(),i=this.viewer.getModelViewManagers().getManagerForUsage(this.getUsage());if(t&&i.isNodeForModel(e)){var r=e.getParent();if(!t.allowsBodies&&!1===t.allowsSketchEntities&&i.isNodeForSketch(r))return!1;if(!1===t.allowsBodyEntities&&!1===t.allowsBodies&&i.isNodeForBody(r))return!1;if(e.isMeshNode()){if(!t.allowsBodies&&!1===t.allowsEdges&&i.isNodeForEdges(e))return!1;if(!t.allowsBodies&&!1===t.allowsVertices&&i.isNodeForPoints(e))return!1}}return e.getIsPickable()},t.prototype.postDraw=function(t){t.setNodeOccurrenceFilterFunction(null);var i=this.pickViewportWidthHeight[0]*this.pickViewportWidthHeight[1]*4;(!this.pickBuffer||this.pickBuffer.length<i)&&(this.pickBuffer=new Uint8Array(i));var r=this.viewer.getGlContext();r.readPixels(0,0,this.pickViewportWidthHeight[0],this.pickViewportWidthHeight[1],r.RGBA,r.UNSIGNED_BYTE,this.pickBuffer),this.hitlist=[];for(var o=0;o<i/4;o++){var s=4*o,a=(0,n.decodePickingIndex)(this.pickBuffer[s],this.pickBuffer[s+1],this.pickBuffer[s+2],this.pickBuffer[s+3]);this.hitlist.push(a)}t.popProjectionMatrix(),t.popViewport(),e.prototype.postDraw.call(this,t)},t.prototype.getPositionForPickHit=function(e){var t=this.pickRect[0],i=this.pickRect[1],r=this.pickRect[2],n=this.pickRect[3],o=r/this.pickViewportWidthHeight[0],s=n/this.pickViewportWidthHeight[1];return[t+e%this.pickViewportWidthHeight[0]*o,i+(n-1-Math.floor(e/this.pickViewportWidthHeight[0])*s)]},t.prototype.getSceneGraph=function(){return this.pickFromPreview?this.viewer.getSceneGraphs().getPreviewSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()},t.prototype.getUsage=function(){return this.pickFromPreview?n.bt_graphics_Usage.PREVIEW:n.bt_graphics_Usage.BASE},t}(n.BufferedPass);t.PickPass=u},335760:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneIdPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r){var o=e.call(this,t,i,{opacity:n.Opacity.TRANSPARENT,blendMode:n.BlendMode.ADD})||this;return o.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()})),r&&(o.inputs.uPlaneIdSetBuffer=r),o}return(0,r.__extends)(t,e),t.prototype.getShaderId=function(){return"-planeId-"+this.shaderTag},t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t);var i=t.getActiveShader();i.uniform1i("uDoSetTest",this.inputs.uPlaneIdSetBuffer?1:0),this.inputs.uPlaneIdSetBuffer?i.useTexture("uPlaneIdSetBuffer",this.inputs.uPlaneIdSetBuffer.getColorTexture()):i.useBlankTexture("uPlaneIdSetBuffer")},t}(n.CustomPass);t.PlaneIdPass=o},834682:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewBlendPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.shaderTag="previewBlend",n.inputs.uBaseTexture=i,n.inputs.uPreviewTexture=r,n}return(0,r.__extends)(t,e),t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t),this.shader.uniform1f("uPreviewAlpha",(0,n.getEditState)().get("previewAlpha"))},t}(n.BlitPass);t.PreviewBlendPass=o},321146:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QualityVisualizationPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r,o){var s=e.call(this,t,i,{facesShader:n.FacesShadeMode.QUALITY_VISUALIZATION,performIsolationTest:r})||this;return s.setSceneGraph(o),s}return(0,r.__extends)(t,e),t}(n.CustomPass);t.QualityVisualizationPass=o},258120:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScalarRetrievalPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t){var i=e.call(this,t,null)||this;i.shaderTag="retrieveScalar",i.clearColor=[0,0,0,0],i.results=[];for(var r=0;r<i.childPasses.length;++r)i.childPasses[r].destroy();i.setNodeFilterOverride((function(e){var t=e.getParent();return 0===(t?t.getId():"").indexOf("SimulationManager")&&t.getIsVisible()}));var o=new n.CustomPass(i.viewer,i,{primitiveType:n.Primitive.FACES,performIsolationTest:!0});return i.childPasses=[o],i}return(0,r.__extends)(t,e),t.prototype.draw=function(e){throw"Use retrieve method instead"},t.prototype.retrieve=function(t,i){return this.scalarRange=i,e.prototype.draw.call(this,t),this.results},t.prototype.postDraw=function(t){var i=this.pickRect[2]*this.pickRect[3]*4,r=new Uint8Array(i),o=this.viewer.getGlContext();o.readPixels(0,0,this.pickRect[2],this.pickRect[3],o.RGBA,o.UNSIGNED_BYTE,r),this.results=[];for(var s=this.viewer.isHighPrecisionSupportedInFragmentShader(),a=0;a<i/4;a++){var c=4*a,l=[r[c],r[c+1],r[c+2],r[c+3]];if(r[3]!==this.clearColor[3]){var u=(0,n.decodeFloat)(l,s),h=this.scalarRange.scalarFromTextureCoordinate(u);this.results.push({canvasCoordinate:[this.pickRect[0]+a%this.pickRect[2],this.pickRect[1]+(this.pickRect[3]-Math.floor(a/this.pickRect[2]))],scalar:h})}}e.prototype.postDraw.call(this,t)},t}(n.PickPass);t.ScalarRetrievalPass=o},860115:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SectionPlaneEndcapMaskDrawPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r){var n=e.call(this,t,i)||this;return n.shaderTag="faces",n.sceneGraph=r,n}return(0,r.__extends)(t,e),t.prototype.usesShader=function(){return!0},t.prototype.getSceneGraph=function(){return this.sceneGraph?this.sceneGraph:e.prototype.getSceneGraph.call(this)},t.prototype.preDraw=function(e){this.initializeShader(),e.activateShader(this.shader);var t=this;return e.nodeFilter=function(e){return t.nodeFilter(e)},!0},t.prototype.onShaderActivated=function(e,t){(0,n.updateShaderClippingUniforms)(this.viewer,!0)},t.prototype.postDraw=function(e){},t.prototype.nodeFilter=function(e){return!!(e.isMeshNode()&&e.getIsVisible()&&e.isFaces()&&!(0,n.isNodeForSurfaceBody)(e)&&e.getClippedBySectionPlanes())&&this.parentPass.nodeFilter(e)},t.prototype.needsFaceAppearances=function(){return!1},t}(n.DrawPass);t.SectionPlaneEndcapMaskDrawPass=o},259141:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SectionPlaneEndcapMaskPass=void 0;var r=i(423902),n=i(712197),o=i(311611),s=function(e){function t(t,i){var r=e.call(this,t)||this;r.checkFrameId=!0,r.shaderTag="endcapMask",r.frameBuffer=null,r.childPasses=[],r.childPasses.push(new o.SectionPlaneEndcapMaskDrawPass(r.viewer,r,i));var n=r.viewer.getIsolatedOccurrenceManager();return r.fullyTransparentGhostedNodeOccurrenceFilter=function(e){return!!e.occurrenceData.getIsolated()||(r.viewer.getModelViewManagers().getManager().isOccurrenceIdForInContext(e.occurrenceData.getOccurrenceId())?!(0===n.getContextTransparencyMultiplier()):!(n.isInIsolateOrMakeTransparentMode&&n.getIsIsolateFullyTransparent()))},r}return(0,r.__extends)(t,e),t.prototype.shouldCheckSectionPlaneCount=function(){return!0},t.prototype.forSectionPlaneEndcapMask=function(){return!0},t.prototype.preDraw=function(t){if(!this.frameBuffer){var i=this.viewer.getGlContext();this.frameBuffer=this.viewer.getOrCreateFrameBuffer(this.viewer.getHighPrecisionFloatTextureType(),void 0,{storageType:i.DEPTH_STENCIL,attachmentType:i.DEPTH_STENCIL_ATTACHMENT})}if(this.shouldCheckSectionPlaneCount()&&0===(0,o.getSectionPlaneCount)())return!1;if(!e.prototype.preDraw.call(this,t))return!1;var r=this.viewer.getGlContext();r.disable(r.DEPTH_TEST),r.blendFunc(r.ONE,r.ONE),r.enable(r.BLEND),t.setOverrideFaceCullingMode(o.CullFace.NONE);var s=this.viewer.getIsolatedOccurrenceManager();return(s.isInIsolateOrMakeTransparentMode()&&s.getIsIsolateFullyTransparent()||(0,n.getActiveInContextNodeId)()&&0===s.getContextTransparencyMultiplier())&&t.setNodeOccurrenceFilterFunction(this.fullyTransparentGhostedNodeOccurrenceFilter),!0},t.prototype.postDraw=function(t){e.prototype.postDraw.call(this,t);var i=this.viewer.getGlContext();i.enable(i.DEPTH_TEST),i.disable(i.BLEND),t.clearOverrideFaceCullingMode(),t.setNodeOccurrenceFilterFunction(null)},t}(o.BufferedPass);t.SectionPlaneEndcapMaskPass=s},854465:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeDetectAndBlurPass=t.SeparatedGaussianFilterBufferPass=t.EdgeDetectBufferPass=t.SeparatedGaussianFilterPass=t.DIRECTION=t.EdgeDetectPass=t.SectionPlaneEndcapDrawPasses=t.SectionPlaneEndcapDrawPass=void 0;var r=i(423902),n=i(311611),o=i(911748),s=function(e){function t(t,i,r,n,o){var s=e.call(this,t)||this;return s.shaderTag="endcap",s.forDepthTesting=!1,s.parentPass=i,s.planeIndex=r,s.inputs.uEndcapMaskTexture=n,o&&(s.inputs.uEdgeDetectTexture=o),s}return(0,r.__extends)(t,e),t.prototype.getEnabled=function(){return!!e.prototype.getEnabled.call(this)&&(0,n.getSectionPlaneCount)()>this.planeIndex},t.prototype.isFacingTheViewer=function(e){var t=e.getActiveCamera().getForward(),i=o.vec3.create((0,n.getActiveSectionPlane)(this.planeIndex).normal);return o.vec3.dot(t,i)<0},t.prototype.preDraw=function(t){return!((0,n.getSectionPlaneCount)()<=this.planeIndex||this.isFacingTheViewer(t)||!this.inputs.uEndcapMaskTexture.getColorTexture())&&(!!e.prototype.preDraw.call(this,t)&&(t.setOverrideFaceCullingMode(n.CullFace.NONE),!0))},t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t);var i=this.viewer.getGlContext();this.inputs.uEdgeDetectTexture&&t.detailSettings.enableSectionPlaneEdgeDetection||this.shader.useBlankTexture("uEdgeDetectTexture"),this.shader.uniformMatrix4fv("uPMatrix",!1,t.getProjectionMatrix());var r=o.vec4.create();r[this.planeIndex]=1,this.shader.uniform4fv("uPlaneSelector",r);var s=t.getActiveCamera().getSceneBounds().diameter();this.shader.uniform1f("uSceneDiameter",s),(0,n.updateShaderClippingUniforms)(this.viewer,!0),(0,n.updateShaderEndcapUniforms)(t,this.planeIndex),this.isPickPass()?(this.shader.uniform4fv("uPickRect",this.parentPass.pickRect),this.shader.uniform2f("uPickRectScale",this.parentPass.pickRect[2]/this.parentPass.pickViewportWidthHeight[0],this.parentPass.pickRect[3]/this.parentPass.pickViewportWidthHeight[1]),this.shader.uniform2f("uMaskTextureDimensions",this.inputs.uEndcapMaskTexture.getWidth(),this.inputs.uEndcapMaskTexture.getHeight()),(0,n.updateShaderEndcapPickingUniforms)(t,this.planeIndex),i.disable(i.BLEND)):(0,n.updateShaderEndcapPatternUniforms)(t,this.planeIndex),i.enable(i.DEPTH_TEST)},t.prototype.draw=function(e){if(this.enabled&&(e.setActivePass(this),this.preDraw(e))){this.justBeforeDraw(e);var t=this.viewer.getGlContext();this.isPickPass()||((0,n.setupStencilForWriteWithoutTest)(t,n.StencilRefValue.LOW_PRIORITY_EDGES,n.StencilRefMask.EDGES),this.forDepthTesting||this.shader.uniform1f("uDiscardPatternBackground",1),t.colorMask(!1,!1,!1,!1),e.getState().callGl("depthMask",!1),this.drawBlitNodes(e),t.colorMask(!0,!0,!0,!0),this.forDepthTesting||this.shader.uniform1f("uDiscardPatternBackground",0),t.disable(t.STENCIL_TEST)),e.getState().callGl("depthMask",!0),this.forDepthTesting&&t.colorMask(!1,!1,!1,!1),this.drawBlitNodes(e),this.justAfterDraw(e),this.postDraw(e)}},t.prototype.postDraw=function(t){e.prototype.postDraw.call(this,t);var i=this.viewer.getGlContext();this.isPickPass()&&i.enable(i.BLEND),i.colorMask(!0,!0,!0,!0),t.clearOverrideFaceCullingMode()},t}(n.BlitPass);t.SectionPlaneEndcapDrawPass=s;var a=function(e){function t(t,i,r,n){var o=e.call(this,t,i)||this;return o.childPasses=[new s(t,i,0,r,n),new s(t,i,1,r,n),new s(t,i,2,r,n),new s(t,i,3,r,n)],o}return(0,r.__extends)(t,e),t}(n.DrawPass);t.SectionPlaneEndcapDrawPasses=a;var c,l=function(e){function t(t,i){var r=e.call(this,t)||this;return r.shaderTag="edgeDetect",r.inputs.uSourceBuffer=i,r}return(0,r.__extends)(t,e),t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t);var i=t.getViewport();this.shader.uniform2f("uPixelScale",1/i[2],1/i[3]),this.shader.uniform1f("uDoEdgeDetection",1)},t}(n.BlitPass);t.EdgeDetectPass=l,function(e){e.X="X",e.Y="Y"}(c=t.DIRECTION||(t.DIRECTION={}));var u=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.direction=r,n.shaderTag="gaussianFilter",n.inputs.uSourceBuffer=i,n}return(0,r.__extends)(t,e),t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t);var i=t.getViewport();this.shader.uniform2f("uPixelScale",1/i[2],1/i[3]),this.direction===c.X?this.shader.uniform2f("uDirection",1,0):this.shader.uniform2f("uDirection",0,1)},t}(n.BlitPass);t.SeparatedGaussianFilterPass=u;var h=function(e){function t(t,i){var r=e.call(this,t,{id:"edgeDetectAndBlurPassBufferA"})||this;return r.childPasses=[new l(t,i)],r}return(0,r.__extends)(t,e),t}(n.BufferedPass);t.EdgeDetectBufferPass=h;var d=function(e){function t(t,i,r){var n=e.call(this,t,{id:"edgeDetectAndBlurPassBufferB"})||this;return n.childPasses=[new u(t,i,r)],n}return(0,r.__extends)(t,e),t}(n.BufferedPass);t.SeparatedGaussianFilterBufferPass=d;var p=function(e){function t(t,i){var r=e.call(this,t,{id:"edgeDetectAndBlurPassBufferA"})||this;return r.edgeDetect=new h(t,i),r.filterX=new d(t,r.edgeDetect,c.X),r.filterY=new u(t,r.filterX,c.Y),r.childPasses=[r.filterY],r}return(0,r.__extends)(t,e),t.prototype.preDraw=function(t){return!!t.detailSettings.enableSectionPlaneEdgeDetection&&e.prototype.preDraw.call(this,t)},t}(n.BufferedPass);t.EdgeDetectAndBlurPass=p},932414:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SilhouettePass=t.BackFaceStencilPass=t.BackFaceSilhouettePass=void 0;var r=i(423902),n=i(73055),o=i(968507),s=i(481515),a=i(311611),c=n.default.getManager(),l=function(e){function t(t,i,r,n){var o=e.call(this,t,i)||this;return o.noSection=n,o.isBackFacePassEnabled=!0,o.blendFilter=a.BlendFilter.ALL,o.sceneGraph=r,o}return(0,r.__extends)(t,e),t.prototype.usesShader=function(){return!0},t.prototype.getShaderId=function(){return"-backfacesil-faces"+(this.noSection?a.NO_SECTION_SHADER_ID_SUFFIX:"")},t.prototype.getSceneGraph=function(){return this.sceneGraph?this.sceneGraph:e.prototype.getSceneGraph.call(this)},t.prototype.preDraw=function(t){if(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances())return!1;this.initializeShader(),e.prototype.preDraw.call(this,t);var i=this.viewer.getGlContext();t.setOverrideFaceCullingMode(a.CullFace.FRONT),t.activateShader(this.shader);var r=this;return t.nodeFilter=function(e){return r.nodeFilter(e)},(0,a.updateShaderClippingUniforms)(this.viewer,!0),this.shader.uniform1f("uLineWidth",c.getNumber("DEFAULT_LINE_WIDTH")*c.getNumber("BACKFACE_SILHOUETTE_WIDTH_FACTOR")),this.shader.uniform4fv("uLineColor",c.getColor("LINE_POINT_COLOR")),this.shader.uniform1f("uSceneDiameter",t.getActiveCamera().getSceneBounds().diameter()),(0,a.setupStencilForTestWithoutWrite)(i,a.StencilRefValue.LOW_PRIORITY_EDGES,a.StencilRefMask.EDGES),!0},t.prototype.postDraw=function(t){e.prototype.postDraw.call(this,t);var i=this.viewer.getGlContext();t.clearOverrideFaceCullingMode(),i.disable(i.STENCIL_TEST)},t.prototype.nodeFilter=function(e){var t=this.viewer.getModelViewManagers().getManager(),i=e.getParent();if(this.blendFilter===a.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(this.blendFilter===a.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;return!e.hasTransparency()&&(!!(e.isFaces()&&i&&t.isNodeForBody(i))&&this.parentPass.nodeFilter(e))},t.prototype.setBlendFilter=function(e){this.blendFilter=e},t}(a.DrawPass);t.BackFaceSilhouettePass=l;var u=function(e){function t(t,i,r,n){var o=e.call(this,t,i,{primitiveType:a.Primitive.FACES,sceneGraph:r,disableColorWrites:!0,performIsolationTest:!0})||this;return o.noSection=n,o}return(0,r.__extends)(t,e),t.prototype.getShaderId=function(){return"-depth-faces"+(this.noSection?a.NO_SECTION_SHADER_ID_SUFFIX:"")},t.prototype.preDraw=function(t){if(!e.prototype.preDraw.call(this,t))return!1;var i=this.viewer.getGlContext();return t.setOverrideFaceCullingMode(a.CullFace.FRONT),t.getState().callGl("depthMask",!1),(0,a.setupStencilForWriteWithoutTest)(i,a.StencilRefValue.LOW_PRIORITY_EDGES,a.StencilRefMask.EDGES),!0},t.prototype.postDraw=function(t){e.prototype.postDraw.call(this,t),t.clearOverrideFaceCullingMode()},t}(a.CustomPass);t.BackFaceStencilPass=u;var h=function(e){function t(t,i,r,n){var o=e.call(this,t,i)||this;return o.isBackFacePassEnabled=!0,o.edgePass=new a.EdgeAndHiddenEdgePass(t,o,{primitiveType:a.Primitive.SILHOUETTES,performIsolationTest:!0,sceneGraph:r,shaderTagSuffix:n?a.NO_SECTION_SHADER_ID_SUFFIX:""}),o.backFaceStencilPass=new u(t,o,r,n),o.backfacePass=new l(t,o,r,n),o.childPasses=[o.edgePass,o.backFaceStencilPass,o.backfacePass],o}return(0,r.__extends)(t,e),t.prototype.setDrawHidden=function(e){this.edgePass.setDrawHidden(e)},t.prototype.setDrawVisibleParts=function(e){this.edgePass.setDrawVisibleParts(e),this.backFaceStencilPass.setEnabled(e),this.backfacePass.setEnabled(e)},t.prototype.setBlendFilter=function(e){this.edgePass.setBlendFilter(e),this.backFaceStencilPass.setBlendFilter(e),this.backfacePass.setBlendFilter(e)},t.prototype.setDrawBackFaceSilhouettes=function(e){this.isBackFacePassEnabled=e},t.prototype.preDraw=function(t){if(!this.viewer.debugIsShowingSilhouetteEdgesOnNonVisibleTangentEdgeStyle()&&this.viewer.getSmoothEdgesRenderStyle()!==s.GBTSmoothEdgeStyle.VISIBLE&&this.viewer.getRenderingMode()!==o.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE&&this.viewer.getRenderingMode()!==o.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED)return!1;e.prototype.preDraw.call(this,t);var i=t.getDetailSettings();this.edgePass.setEnabled(i.enableEdgeSilhouettes);var r=i.enableBackfaceSilhouettes&&this.isBackFacePassEnabled;return this.backFaceStencilPass.setEnabled(r),this.backfacePass.setEnabled(r),!0},t}(a.DrawPass);t.SilhouettePass=h},380511:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TintedPass=t.TINT_TEST_TYPE=void 0;var r,n=i(423902),o=i(311611),s=i(73055);!function(e){e[e.DEPTH_AND_NORMAL=0]="DEPTH_AND_NORMAL",e[e.DEPTH_ONLY=1]="DEPTH_ONLY",e[e.PLANE_ID=2]="PLANE_ID"}(r=t.TINT_TEST_TYPE||(t.TINT_TEST_TYPE={}));var a=function(e){function t(t,i,n,a,c,l){var u=e.call(this,t,i,n)||this;return u.tintOpacity=1,u.tintColor=a,u.matchesCompareColor=c,u.inputs.uCompareBuffer=l,u.tintTestType=r.DEPTH_ONLY,u.primitiveType===o.Primitive.FACES&&(u.opacity===o.Opacity.TRANSPARENT?u.tintTestType=r.PLANE_ID:u.tintTestType=r.DEPTH_AND_NORMAL),u.opacity===o.Opacity.TRANSPARENT&&(u.tintOpacity=s.default.getManager().getNumber("COMPARE_TRANSLUCENT_FACE_OPACITY")),u.tintTestType===r.DEPTH_ONLY&&u.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()})),u}return(0,n.__extends)(t,e),t.prototype.getShaderId=function(){return this.tintTestType===r.PLANE_ID?"-tintByPlaneId-"+this.shaderTag:this.tintTestType===r.DEPTH_AND_NORMAL?"-tintByNormalDepth-"+this.shaderTag:"-tintByDepth-"+this.shaderTag},t.prototype.justBeforeDraw=function(t){e.prototype.justBeforeDraw.call(this,t);var i=t.getActiveShader();i.uniform3f("uTintColor",this.tintColor[0],this.tintColor[1],this.tintColor[2]),i.uniform1f("uTintOpacity",this.tintOpacity),i.uniform1f("uBlendOverdrawAdjustment",1/(1+(0,o.getBlendAmount)())),i.uniform3f("uMatchesCompareColor",this.matchesCompareColor[0],this.matchesCompareColor[1],this.matchesCompareColor[2]),this.inputs.uCompareBuffer&&i.useTexture("uCompareBuffer",this.inputs.uCompareBuffer.getColorTexture())},t}(o.CustomPass);t.TintedPass=a},157650:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransparencySwitchPass=t.TranslucentPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r,o){var s=e.call(this,t,i)||this;s.childPasses=[],s.applyTranslucentAlphaToAll=!1,s.blendFilter=n.BlendFilter.ALL,s.sceneGraph=r;var a=new n.CustomPass(s.viewer,i,{primitiveType:n.Primitive.FACES,disableColorWrites:!0,performIsolationTest:!0}),c=new n.CustomPass(s.viewer,i,{primitiveType:n.Primitive.FACES,disableColorWrites:!0,performIsolationTest:!0,shaderTagSuffix:n.NO_SECTION_SHADER_ID_SUFFIX}),l=new n.SwitchPass(t,a,c,n.isSectionPlaneModeEnabled);return l.setCheckFrameId(!0),s.accumulationPass=new n.OITBufferPass(s.viewer,i,n.OITComponent.ACCUMULATION,l),s.revealagePass=new n.OITBufferPass(s.viewer,i,n.OITComponent.REVEALAGE,l),s.compositePass=new n.OITCompositePass(s.viewer,s.accumulationPass,s.revealagePass,r,o),s.setSceneGraph(r),s.childPasses.push(s.compositePass),s}return(0,r.__extends)(t,e),t.prototype.appliesTranslucentAlphaToAll=function(e){this.applyTranslucentAlphaToAll=e,this.accumulationPass.appliesTranslucentAlphaToAll(e),this.revealagePass.appliesTranslucentAlphaToAll(e)},t.prototype.setSceneGraph=function(e){this.sceneGraph=e,this.accumulationPass.setSceneGraph(e),this.revealagePass.setSceneGraph(e),this.compositePass.setSceneGraph(e)},t.prototype.getSceneGraph=function(){return this.sceneGraph?this.sceneGraph:e.prototype.getSceneGraph.call(this)},t.prototype.setBlendFilter=function(e){this.blendFilter=e,this.accumulationPass.setBlendFilter(e),this.revealagePass.setBlendFilter(e)},t.prototype.setDepthPassEnabled=function(e){this.accumulationPass.setDepthPassEnabled(e),this.revealagePass.setDepthPassEnabled(e)},t.prototype.setDepthOpacity=function(e){this.accumulationPass.setDepthOpacity(e),this.revealagePass.setDepthOpacity(e)},t.prototype.setExtraMeshNodeFilter=function(e){this.accumulationPass.setExtraMeshNodeFilter(e),this.revealagePass.setExtraMeshNodeFilter(e),this.extraMeshNodeFilter=e},t.prototype.setTintColor=function(e){this.accumulationPass.setTintColor(e)},t.prototype.setTintFactor=function(e){this.accumulationPass.setTintFactor(e)},t.prototype.setHideSelectionInterior=function(e){this.accumulationPass.setHideSelectionInterior(e)},t.prototype.setPerformIsolationTest=function(e){this.accumulationPass.setPerformIsolationTest(e),this.revealagePass.setPerformIsolationTest(e)},t}(n.DrawPass);t.TranslucentPass=o;var s=function(e){function t(t,i,r,n){return e.call(this,t,i,r,n)||this}return(0,r.__extends)(t,e),t.prototype.appliesTranslucentAlphaToAll=function(e){this.pass1.appliesTranslucentAlphaToAll(e)},t.prototype.setDepthOpacity=function(e){this.pass1.setDepthOpacity(e)},t.prototype.setDepthPassEnabled=function(e){this.pass1.setDepthPassEnabled(e)},t.prototype.setExtraMeshNodeFilter=function(e){this.pass2.setExtraMeshNodeFilter(e)},t}(n.SwitchPass);t.TransparencySwitchPass=s},856942:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransparentFaceDepth=void 0;var r=i(423902),n=i(311611),o=i(227441),s=i(712197),a=function(e){function t(t,i,r,o){var s=e.call(this,t,i,{primitiveType:n.Primitive.FACES,opacity:n.Opacity.TRANSPARENT,disableColorWrites:!0,performIsolationTest:o})||this;return s.setSceneGraph(r),s.setNodeFilter(s.createExcludeForNonBodyFilter()),s}return(0,r.__extends)(t,e),t.prototype.getEnabled=function(){switch(this.viewer.getRenderingMode()){case o.GBTGraphicsRenderMode.SHADED_WITH_HIDDEN_EDGES:return!0;case o.GBTGraphicsRenderMode.SHADED_WITH_EDGES:case o.GBTGraphicsRenderMode.SHADED_WITHOUT_EDGES:case o.GBTGraphicsRenderMode.TRANSLUCENT:case o.GBTGraphicsRenderMode.SIMULATION_RESULTS:return(0,s.getFilteredEntitiesList)().length>0;default:return!1}},t}(n.CustomPass);t.TransparentFaceDepth=a},14381:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FaceEdgePointPass=t.makeDepthClearPass=t.DepthClearPass=t.makeBufferedNormalDepthPass=t.normalDepthClearColor=t.NormalDepthPass=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t){var i=e.call(this,t,null)||this;return i.shaderTag="normalDepth",i.childPasses=[],i.points=[],i.scenegraph=null,i.opaqueFacePass=new n.CustomPass(i.viewer,i,{}),i.childPasses.push(i.opaqueFacePass),i}return(0,r.__extends)(t,e),t.prototype.setSceneGraph=function(e){this.sceneGraph=e,this.opaqueFacePass.setSceneGraph(e)},t.prototype.getSceneGraph=function(){return this.sceneGraph?this.sceneGraph:e.prototype.getSceneGraph.call(this)},t.prototype.setOpacity=function(e){this.opaqueFacePass.setOpacity(e)},t.prototype.justBeforeDraw=function(t){var i=this.viewer.getGlContext();i.disable(i.BLEND),e.prototype.justBeforeDraw.call(this,t)},t.prototype.nodeFilter=function(e){var t=this.viewer.getModelViewManagers().getManager();return!!(!e.isMeshNode()||t.isNodeForModel(e)&&t.isNodeForFaces(e))&&e.getIsVisible()},t}(n.DrawPass);t.NormalDepthPass=o,t.normalDepthClearColor=[.5,.5,1,1],t.makeBufferedNormalDepthPass=function(e,i,r){var s=(0,n.makeBufferedPass)(e,new o(e),i,r);return s.clearColor=t.normalDepthClearColor,s};var s=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.childPasses=[],r}return(0,r.__extends)(t,e),t.prototype.preDraw=function(e){var t=this.viewer.getGlContext();return t.clear(t.DEPTH_BUFFER_BIT),!0},t}(n.DrawPass);t.DepthClearPass=s,t.makeDepthClearPass=function(e,t){return new s(e,t)};var a=function(e){function t(t,i,r){var o=e.call(this,t,i)||this;return o.childPasses=(0,n.buildFacesLinesPointsPasses)(t,o,r),o}return(0,r.__extends)(t,e),t}(n.DrawPass);t.FaceEdgePointPass=a},445285:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgePointController=void 0;var r=i(423902),n=i(663748),o=i(311611),s=i(73055),a=i(712197),c=i(501242),l=i(507025),u=i(227441),h=i(911748),d=i(601759),p=function(){this.selected=!1,this.preSelected=!1,this.edgePreSelected=!1,this.edgePointUiElement=null,this.selectedSheetmetalModelId=null},g=function(e){return e===(0,a.getPreselectionList)()},f=function(e,t){if(!(t.isEdge()&&!t.isClosedCurve()))return!1;var i=e.getSketch();if(!t.getSketchEntityId()||!i)return!0;var r=t.getFeatureIds();return 1!==r.length||i.id!==r[0]},m=function(e){return e.isEdgePoint()},y=function(e){return e.isVertex()},v=function(e){var t=c.DocumentController.getActiveFeatureController();if(t){var i=t.featureModel;if(i&&(!e||!i.get("isSketch")))return i}return null},E=function(e){function t(t){var i=e.call(this)||this;i.viewer=t,i.edgePointUiElements={},i.purgeTimer=null,i.isEnabled=!1,(0,o.viewerCheck)(t),i.edgePointCandidate=new o.FilterEdgePointCandidate;var r=s.default.getManager();return i.edgePointPixelSize=r.getNumber("POINT_BODY_SIZE"),i}return(0,r.__extends)(t,e),t.prototype.enable=function(){this.isEnabled=!0,this.stopListening(),this.listenTo((0,a.getSelectionList)(),"add",this.onSelectionAdded),this.listenTo((0,a.getSelectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,a.getSelectionList)(),"reset",this.onSelectionReset),this.listenTo((0,a.getPreselectionList)(),"add",this.onSelectionAdded),this.listenTo((0,a.getPreselectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,a.getPreselectionList)(),"reset",this.onSelectionReset)},t.prototype.disable=function(){this.isEnabled&&(this.isEnabled=!1,this.stopListening(),this.removeAllEdgePointUiElements((0,a.getSelectionList)()),this.removeAllEdgePointUiElements((0,a.getPreselectionList)()))},t.prototype.addEdgePointUiElement=function(e,t,i){var r,n=this;r=t?e.getDeterministicId():e.getIdString();var s=this.edgePointUiElements[r];if(s||(s=new p),t?s.edgePreSelected=!0:i?s.preSelected=!0:s.selected=!0,t&&i){var c=o.EdgePoint.getEdgePointLocation(this.viewer,e,.5),l=this.viewer.getCamera().getPixelSizeAtWorldPoint(c)*this.edgePointPixelSize;if(!c||(0,a.getSelectionList)().models.find((function(e){if(y(e)){var t=n.viewer.getModelViewManagers().getManager().extractMeshIncrement(e.getDeterministicId());if(t){var i=t.points;return h.vec3.length(h.vec3.subtract(c,i,h.vec3.create()))<l}}return!1}),this))return null}return s.edgePointUiElement||(s.edgePointUiElement=new o.EdgePoint(o.MAIN_SCENEGRAPH_ID,e,.5,this.viewer)),this.edgePointUiElements[r]=s,s.edgePointUiElement},t.prototype.removeEdgePointUiElementWithDeterministicId=function(e,t){return!!this.edgePointUiElements.hasOwnProperty(e)&&(t?(this.edgePointUiElements[e].preSelected=!1,this.edgePointUiElements[e].edgePreSelected=!1):this.edgePointUiElements[e].selected=!1,!0)},t.prototype.purgeEdgePointUiElements=function(e){this.purgeTimer&&(clearTimeout(this.purgeTimer),this.purgeTimer=null);var t=[];Object.entries(this.edgePointUiElements).forEach((function(i){var n=(0,r.__read)(i,2),o=n[0],s=n[1];!e&&(s.selected||s.preSelected||s.edgePreSelected)||(s.edgePointUiElement.remove(),t.push(o))})),this.edgePointUiElements=(0,d.omitProperty)(this.edgePointUiElements,t)},t.prototype.delayedPurgeUiElements=function(){if(!this.purgeTimer){var e=this;this.purgeTimer=window.setTimeout((function(){e.purgeEdgePointUiElements()}),0)}},t.prototype.removeEdgePointUiElement=function(e,t,i){var r=e.getDeterministicId();t||(r=e.getIdString()),this.removeEdgePointUiElementWithDeterministicId(r,i)},t.prototype.removeAllEdgePointUiElements=function(e){var t=g(e);Object.entries(this.edgePointUiElements).forEach((function(e){var i=(0,r.__read)(e,2),n=i[0];i[1];this.removeEdgePointUiElementWithDeterministicId(n,t)}),this)},t.prototype.addSelection=function(e,t){if(!e.isFromOccurrence()){var i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(i&&"string"==typeof e.selectionId)if(e.entityMetaData&&e.entityMetaData.isFromSketch()){if(e.isFlattened()!==this.viewer.getIsForFlattenedDisplay())return!1}else{var r=i.getBodyComponent(null).idToMetaData[e.selectionId];if(!r&&this.viewer.getIsForFlattenedDisplay())return!1;if(r&&r instanceof u.BTBodyEntity&&r.getBodyMetaData().isForFlattenedView()!==this.viewer.getIsForFlattenedDisplay())return!1;if(r&&r instanceof u.BTBodyEntity&&this.selectedSheetmetalModelId&&r.getBodyMetaData().sheetMetalModelId!==this.selectedSheetmetalModelId)return!1}var n=g(t),o=m(e),s=f(this.viewer,e);if(o)this.addEdgePointUiElement(e,!1,n);else if(s){if(n){var c=(0,a.getCurrentSelectionQueryFilter)();c&&!c.filter(this.edgePointCandidate)||this.addEdgePointUiElement(e,!0,n)}}else if(y(e)&&!n){var l=this.viewer.getModelViewManagers().getManager();e.getFeatureIds().forEach((function(e){l.showPointBodies(e)}))}}},t.prototype.onSelectionAdded=function(e,t){if(!e)return!1;var i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio(),r=i?i.getEntityIdManager():null;r&&r.getIdForName(e.getIdString())!==o.INVALID_ID&&this.addSelection(e,t)},t.prototype.onSelectionRemoved=function(e,t){if(!e)return!1;var i=this.viewer.getModelViewManagers().getManager(),r=g(t),n=m(e),o=f(this.viewer,e);if(n){this.removeEdgePointUiElement(e,!1,r);var s=e.getSubfeatureId();s&&!r&&i.hidePointBodies(s),this.delayedPurgeUiElements()}else{if(o&&r)this.removeEdgePointUiElement(e,!0,r),this.delayedPurgeUiElements();else if(y(e)&&!r&&v(!0))e.getFeatureIds().forEach((function(e){i.hidePointBodies(e)}))}},t.prototype.addMultipleSelections=function(e){e.models.forEach((function(t){this.addSelection(t,e)}),this)},t.prototype.onSelectionReset=function(e,t){if(this.removeAllEdgePointUiElements(e),!g(e)){var i=v(!0);if(i&&!i.get("isSketch")){var r=(s=i.get("featureMsg"))&&s.subFeatures?s.subFeatures.map((function(e){return e.featureId})):[],n=function(e){return e.filter((function(e){return y(e)&&1===e.getFeatureIds().length})).map((function(e){return e.getFeatureIds()[0]}))}(e),o=this.viewer.getModelViewManagers().getManager();(0,l.difference)(r,n).forEach((function(e){o.hidePointBodies(e)}))}}var s;this.addMultipleSelections(e),t&&t.isForRemapping?this.purgeEdgePointUiElements(!0):this.delayedPurgeUiElements()},t.prototype.getUIElementsForSelection=function(e){if(m(e)){var t=this.edgePointUiElements[e.getIdString()];if(t)return[t.edgePointUiElement]}return[]},t.prototype.hideUIElementsForSelection=function(e){this.getUIElementsForSelection(e).forEach((function(e){e.hide()}))},t.prototype.setSelectedSheetmetalModelId=function(e){this.selectedSheetmetalModelId=e},t}(n.BackboneEventsBaseClass);t.EdgePointController=E},134879:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExplodeLine=void 0;var r=i(423902),n=i(311611),o=new n.NodeProperties({isShowThrough:!1,isPickable:!1,primitiveType:n.PrimitiveType.LINES}),s=function(e){function t(i,r){var n=e.call(this,i)||this;return n.graphicsId=t.GRAPHICS_ID_PREFIX+r,n.setId(n.graphicsId),n}return(0,r.__extends)(t,e),t.prototype.getExplodeLineNodeProperties=function(){return o},t.GRAPHICS_ID_PREFIX="EXPLODE_LINE_GRAPHICS_",t}(n.UIElement);t.ExplodeLine=s},887846:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExplodeLineArcSegment=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(134879),a=i(311611),c=n.default.getManager(),l=function(e){function t(t,i){return e.call(this,t,i)||this}return(0,r.__extends)(t,e),t.prototype.updateDefinition=function(e){e.startPosition&&e.center&&e.axis&&e.hasOwnProperty("angle")&&(this.startPosition=e.startPosition,this.arcCenter=e.center,this.arcAxis=e.axis,this.arcAngle=e.angle),this.updateGraphics()},t.prototype.updateGraphics=function(){var e=o.vec3.subtract(this.startPosition,this.arcCenter,o.vec3.create()),t=o.vec3.normalize(e,o.vec3.create()),i=o.vec3.length(e),r=this.arcAngle,n=c.getNumber("EXPLODE_LINE_CIRCLE_SEGMENT_COUNT")*Math.abs(r-0)/(2*Math.PI),s=(0,a.createArc)(this.arcCenter,i,this.arcAxis,t,0,r,n);(0,a.addSizeToIncrement)(1,s),(0,a.addColorToIncrement)(c.getColor("EXPLODE_LINE_COLOR"),s),(0,a.addStyleToIncrement)(c.getStipple("EXPLODE_LINE_STIPPLE"),s);var l=this.graphicsId+"_MESH_INCREMENT";this.updateMeshIncrement(l,a.NO_SELECTION_ID,s,this.getExplodeLineNodeProperties())},t}(s.ExplodeLine);t.ExplodeLineArcSegment=l},391746:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExplodeLineLineSegment=void 0;var r=i(423902),n=i(73055),o=i(134879),s=i(311611),a=n.default.getManager(),c=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.startPosition=null,r.endPosition=null,r}return(0,r.__extends)(t,e),t.prototype.updateDefinition=function(e){this.startPosition=e.startPosition,this.endPosition=e.endPosition,this.updateGraphics()},t.prototype.updateGraphics=function(){var e=(0,s.createLine)(this.startPosition,this.endPosition);(0,s.addSizeToIncrement)(1,e),(0,s.addColorToIncrement)(a.getColor("EXPLODE_LINE_COLOR"),e),(0,s.addStyleToIncrement)(a.getStipple("EXPLODE_LINE_STIPPLE"),e);var t=this.graphicsId+"_MESH_INCREMENT";this.updateMeshIncrement(t,s.NO_SELECTION_ID,e,this.getExplodeLineNodeProperties())},t}(o.ExplodeLine);t.ExplodeLineLineSegment=c},446862:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsRefinementMode=void 0,function(e){e[e.NORMAL=0]="NORMAL",e[e.AGGRESSIVE_USER_CAUSED=1]="AGGRESSIVE_USER_CAUSED"}(t.GraphicsRefinementMode||(t.GraphicsRefinementMode={}))},824661:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},173567:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationCallbackStatus=void 0,function(e){e[e.ONGOING=0]="ONGOING",e[e.COMPLETE=1]="COMPLETE"}(t.AnimationCallbackStatus||(t.AnimationCallbackStatus={}))},713287:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},43454:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},874197:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectionType=void 0,function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.INTERSECTING=2]="INTERSECTING"}(t.IntersectionType||(t.IntersectionType={}))},657992:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isCountDimension=t.isRadialDimension=t.isCenterlineDimension=t.isLinearDimension=t.isEllipseDiameterDimension=t.isCurveLengthDimension=t.isArcLengthDimension=t.isAngularDimension=t.isDimension=t.DimensionPreferences=void 0;var i=function(){this.ignoreSpaceParameters=!1,this.displayLimitRangeText=!0,this.displayLimitRangeTicks=!1,this.textReadOnly=!1,this.textPrefix=""};t.DimensionPreferences=i,t.isDimension=function(e){return e&&e.isDimension()},t.isAngularDimension=function(e){return e&&"AngularDimension"===e.getId()},t.isArcLengthDimension=function(e){return e&&"ArcLengthDimension"===e.getId()},t.isCurveLengthDimension=function(e){return e&&"CurveLengthDimension"===e.getId()},t.isEllipseDiameterDimension=function(e){return e&&"EllipseDiameterDimension"===e.getId()},t.isLinearDimension=function(e){return e&&"LinearDimension"===e.getId()},t.isCenterlineDimension=function(e){return e&&"CenterlineDimension"===e.getId()},t.isRadialDimension=function(e){return e&&"RadialDimension"===e.getId()},t.isCountDimension=function(e){return e&&"CountDimension"===e.getId()}},131210:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},890130:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},832205:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},644328:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},784746:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LAMINAR_EDGE_FILTER=void 0;t.LAMINAR_EDGE_FILTER=function(e){return e.isEdge()&&!e.isInternalEdge()&&e.isFromBody()&&!e.isFromWireBody()}},280738:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameType=void 0,function(e){e.FULL="full",e.INTERACTIVE="interactive",e.MANIPULATING="manipulating"}(t.FrameType||(t.FrameType={}))},620968:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Action=t.highlightTypesThatChangeColor=t.HighlightType=void 0,function(e){e.UI="UI",e.RELATED_OCCURRENCE="RELATED_OCCURRENCE",e.RELATED_OCCURRENCE_MATE="RELATED_OCCURRENCE_MATE",e.ACCUMULATED_SMART_SELECTION="ACCUMULATED_SMART_SELECTION",e.SMART_SELECTION="SMART_SELECTION",e.ENTITY="ENTITY",e.UI_RELATED_ENTITY="UI_RELATED_ENTITY",e.FEATURE="FEATURE",e.PART="PART",e.OCCURRENCE="OCCURRENCE",e.OCCURRENCE_COMMENT="OCCURRENCE_COMMENT",e.COMMENT="COMMENT",e.FILTERED_ENTITIES="FILTERED_ENTITIES",e.OCCURRENCE_PRE="OCCURRENCE_PRE",e.PRE="PRE",e.ERROR="ERROR",e.SECONDARY="SECONDARY",e.SECONDARY_PRE="SECONDARY_PRE",e.OCCURRENCE_SECONDARY_PRE="OCCURRENCE_SECONDARY_PRE",e.ASSOCIATED_OCCURRENCE="ASSOCIATED_OCCURRENCE",e.ASSOCIATED_OCCURRENCE_PRE="ASSOCIATED_OCCURRENCE_PRE",e.INCONTEXT_REFERENCE="INCONTEXT_REFERENCE",e.INCONTEXT_REFERENCE_PRE="INCONTEXT_REFERENCE_PRE",e.RETRIEVAL="RETRIEVAL",e.OPERATION_PERSISTENT="OPERATION_PERSISTENT"}(i=t.HighlightType||(t.HighlightType={})),t.highlightTypesThatChangeColor=[i.UI,i.ACCUMULATED_SMART_SELECTION,i.SMART_SELECTION,i.ENTITY,i.FEATURE,i.PART,i.OCCURRENCE,i.SECONDARY],function(e){e[e.REMOVE=0]="REMOVE",e[e.ADD=1]="ADD"}(t.Action||(t.Action={}))},521761:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MouseButton=void 0,function(e){e[e.LEFT=1]="LEFT",e[e.MIDDLE=2]="MIDDLE",e[e.RIGHT=3]="RIGHT"}(t.MouseButton||(t.MouseButton={}))},37496:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},642170:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},970846:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFreeDragManipulator=t.isPlanarManipulator=t.isLinearManipulator=t.isAngularManipulator=t.isManipulator=t.FeatureManipulatorEvents=t.ManipulatorEvents=t.TriadManipulatorType=void 0,function(e){e.EXPLODE_CONVENIENCE_MANIPULATOR="explodeConvenienceManipulator",e.DRAG="drag",e.FULL="full",e.PLANE="plane",e.SKETCH="sketch",e.UNKNOWN="unknown"}(t.TriadManipulatorType||(t.TriadManipulatorType={})),function(e){e.MANIPULATION_STARTED="manipulationstarted",e.MANIPULATION_ENDED="manipulationended",e.VALUE_CHANGED="valuechanged",e.VALUE_EDITED="valueedited",e.CACHE_TRANSFORM="cachetransform",e.CLICKED="clicked",e.DOUBLE_CLICKED="doubleclicked",e.MANIPULATOR_ENTER="enter",e.MANIPULATOR_LEAVE="leave"}(t.ManipulatorEvents||(t.ManipulatorEvents={})),function(e){e.MANIPULATION_STARTED="manipulationstarted",e.VALUE_CHANGED="valuechanged",e.MANIPULATION_ENDED="manipulationended"}(t.FeatureManipulatorEvents||(t.FeatureManipulatorEvents={})),t.isManipulator=function(e){return e.isManipulator()},t.isAngularManipulator=function(e){return void 0!==e.getAngle},t.isLinearManipulator=function(e){return void 0!==e.ray},t.isPlanarManipulator=function(e){return void 0!==e.origin},t.isFreeDragManipulator=function(e){return void 0!==e.lastMouseRay}},639501:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},521300:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},971188:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},363540:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPartStudio=void 0;var r=i(227441);t.isPartStudio=function(e){return e&&e.getElementType()===r.GBTElementType.PARTSTUDIO}},265194:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},558474:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},951682:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enableSectionPlaneSelection=t.disableSectionPlaneSelection=t.sectionPlaneSelectionDisabled=t.SECTIONPLANE_SELECTION_ID=void 0,t.SECTIONPLANE_SELECTION_ID="sectionPlaneSelection",t.sectionPlaneSelectionDisabled=!1,t.disableSectionPlaneSelection=function(){t.sectionPlaneSelectionDisabled=!0},t.enableSectionPlaneSelection=function(){t.sectionPlaneSelectionDisabled=!1}},872136:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpaceData=t.IconSelectionType=void 0,function(e){e[e.NOT_SELECTED=0]="NOT_SELECTED",e[e.PREHILITE=1]="PREHILITE",e[e.SELECTED=2]="SELECTED",e[e.MUTED=3]="MUTED"}(t.IconSelectionType||(t.IconSelectionType={}));var i=function(){this.lowerLeft=null,this.lowerRight=null,this.upperLeft=null,this.pixelSize=1};t.ScreenSpaceData=i},925300:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OriginAxesIndex=t.ComponentNames=t.TriadEvents=void 0,function(e){e.REPOSITION_START="repositionStart",e.REPOSITION="reposition",e.REPOSITION_END="repositionEnd",e.ROTATION_START="rotationStart",e.ROTATION_CHANGE="rotationChange",e.ROTATION_END="rotationEnd",e.ROTATION_EDIT="rotationEdit",e.TRANSLATION_START="translationStart",e.TRANSLATION_CHANGE="translationChange",e.TRANSLATION_END="translationEnd",e.TRANSLATION_EDIT="translationEdit",e.SCALING_START="scalingStart",e.SCALING_CHANGE="scalingChange",e.SCALING_END="scalingEnd",e.SCALING_EDIT="scalingEdit",e.COMMAND="componentCommand",e.ENTER_INFERENCE="enterInference",e.LEAVE_INFERENCE="leaveInference",e.DOUBLE_CLICKED="doubleClicked"}(t.TriadEvents||(t.TriadEvents={})),function(e){e.X_ROTATION="TRIAD_X_ROTATION",e.Y_ROTATION="TRIAD_Y_ROTATION",e.Z_ROTATION="TRIAD_Z_ROTATION",e.X_DIRECTION="TRIAD_X_DIRECTION",e.Y_DIRECTION="TRIAD_Y_DIRECTION",e.Z_DIRECTION="TRIAD_Z_DIRECTION",e.XY_PLANE="TRIAD_XY_PLANE",e.XZ_PLANE="TRIAD_XZ_PLANE",e.YZ_PLANE="TRIAD_YZ_PLANE",e.FREE_DRAG="TRIAD_FREE_DRAG",e.SCALING="SCALING"}(t.ComponentNames||(t.ComponentNames={})),function(e){e[e.Origin=0]="Origin",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z"}(t.OriginAxesIndex||(t.OriginAxesIndex={}))},474917:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bt_graphics_ISilhouette_CLICKED=t.InferenceData=t.isImageDisplay=void 0,t.isImageDisplay=function(e){return e&&e.getId&&"image"===e.getId()};var i=function(e,t,i,r,n,o,s,a){this.deterministicId=e,this.secondDeterministicId=t,this.occurrence=i,this.inferenceType=r,this.coordinateSystem=n,this.sourceIsFeature=o,this.meshPointData=null,this.isInContextEntity=!!s,this.isPartStudioMateConnector=!!a};t.InferenceData=i,t.bt_graphics_ISilhouette_CLICKED="clicked"},180954:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},78666:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManipulationMode=void 0,function(e){e.NONE="none",e.ROTATE="rotate",e.AXIS_ROTATE="axisRotate",e.PAN="pan",e.ZOOM="zoom"}(t.ManipulationMode||(t.ManipulationMode={}))},813681:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cursor=void 0,function(e){e.DEFAULT="default",e.CROSSHAIR="url(/images/crosshair-cursor.svg) 7.5 7.5,crosshair",e.HAND="hand",e.POINTER="pointer",e.ZOOM_IN="zoom-in",e.MOVE="move",e.TEXT="text",e.WAIT="wait",e.HELP="help",e.N_RESIZE="n-resize",e.NE_RESIZE="ne-resize",e.E_RESIZE="e-resize",e.SE_RESIZE="se-resize",e.S_RESIZE="s-resize",e.SW_RESIZE="sw-resize",e.W_RESIZE="w-resize",e.NW_RESIZE="nw-resize",e.PROGRESS="progress",e.NOT_ALLOWED="not-allowed",e.NO_DROP="no-drop",e.VERTICAL_TEXT="vertical-text",e.ALL_SCROLL="all-scroll",e.COL_RESIZE="col-resize",e.ROW_RESIZE="row-resize",e.SNAPMATE="url(/images/SnapMate_Cursor.png) 7.5 7.5,nesw-resize",e.CONFIRMATION="url(/images/Confirmation_Cursor.png) 1 1,default"}(t.Cursor||(t.Cursor={}))},394739:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bt_graphics_Usage=void 0,function(e){e[e.BASE=0]="BASE",e[e.PREVIEW=1]="PREVIEW"}(t.bt_graphics_Usage||(t.bt_graphics_Usage={}))},397843:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeCurvatureCheckboxNames=void 0,function(e){e.MINIMUM_RADIUS="minimum_radius",e.CURVATURE_COMBS="show_curvature",e.INFLECTION_POINTS="inflection_points",e.U_CURVES="u_curves",e.V_CURVES="v_curves",e.CROSS_FACE="cross_face"}(t.EdgeCurvatureCheckboxNames||(t.EdgeCurvatureCheckboxNames={}))},734604:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUsagePreviewFinal=t.isUsagePreviewAfter=t.isUsagePreview=t.getLatestDisplayDataUsage=t.isUsageCompare=t.isUsageBase=t.getPickUsage=t.pickFromPreview=t.getPreviewAlpha=t.resetUsage=t.getEditState=t.DEFAULT_PREVIEW_OPACITY=t.Events=void 0;var r,n=i(423902),o=i(514194),s=i(394739),a=i(194598),c=i(311517),l=i(227441);!function(e){e.PREVIEW_STATE_CHANGE="previewStateChange",e.PREVIEW_BLEND_CHANGE="previewBlendChange"}(r=t.Events||(t.Events={})),t.DEFAULT_PREVIEW_OPACITY=.7;var u=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(i,e),i.prototype.defaults=function(){return{previewAlpha:t.DEFAULT_PREVIEW_OPACITY,latestDisplayDataUsage:l.GBTDisplayDataUsage.BASE,inCompareMode:!1}},i.prototype.initialize=function(){a.btInjector.StateService?this.set("inCompareMode",a.btInjector.StateService.isOnDocumentCompare()):this.set("inCompareMode",!1),this.listenTo(this,"change:inCompareMode",(function(){this.trigger(r.PREVIEW_STATE_CHANGE)})),this.listenTo(this,"change:latestDisplayDataUsage",(function(){var e=this.get("inCompareMode");e||this.trigger(r.PREVIEW_STATE_CHANGE);var t=this.get("latestDisplayDataUsage")===l.GBTDisplayDataUsage.BASE,i=this.get("latestDisplayDataUsage")===l.GBTDisplayDataUsage.COMPARE_TARGET;!e||t||i?!e&&i&&c.log.warn("Received COMPARE_TARGET message while not in compare mode."):c.log.warn("Received a non-BASE and non-COMPARE_TARGET message while in compare mode.")})),this.listenTo(this,"change:previewAlpha",(function(){this.trigger(r.PREVIEW_BLEND_CHANGE)}))},i}(o.Model),h=null;function d(){return h||(h=new u),h}function p(){return!!g()&&d().get("previewAlpha")>.5}function g(){return d().get("inCompareMode")}function f(){return d().get("latestDisplayDataUsage")}t.getEditState=d,t.resetUsage=function(){d().set("inCompareMode",!1),d().set("latestDisplayDataUsage",l.GBTDisplayDataUsage.BASE)},t.getPreviewAlpha=function(){return d().get("previewAlpha")},t.pickFromPreview=p,t.getPickUsage=function(){return p()?s.bt_graphics_Usage.PREVIEW:s.bt_graphics_Usage.BASE},t.isUsageBase=function(){return d().get("latestDisplayDataUsage")===l.GBTDisplayDataUsage.BASE&&!d().get("inCompareMode")},t.isUsageCompare=g,t.getLatestDisplayDataUsage=f,t.isUsagePreview=function(){var e=f();return e===l.GBTDisplayDataUsage.PREVIEW_BEFORE||e===l.GBTDisplayDataUsage.PREVIEW_AFTER||e===l.GBTDisplayDataUsage.PREVIEW_FINAL},t.isUsagePreviewAfter=function(){return f()===l.GBTDisplayDataUsage.PREVIEW_AFTER},t.isUsagePreviewFinal=function(){return f()===l.GBTDisplayDataUsage.PREVIEW_FINAL}},82058:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EntityCurvatureWrapper=t.CURVATURE_TYPE=void 0,function(e){e[e.EDGE_U=0]="EDGE_U",e[e.FACE_U=1]="FACE_U",e[e.FACE_V=2]="FACE_V"}(i=t.CURVATURE_TYPE||(t.CURVATURE_TYPE={}));var r=function(){function e(e,t){this.curvatureType=e,this.curvatureData=t}return e.prototype.isEdgeCurvature=function(){return this.curvatureType===i.EDGE_U},e.prototype.isFaceUCurve=function(){return this.curvatureType===i.FACE_U},e.prototype.isFaceVCurve=function(){return this.curvatureType===i.FACE_V},e.prototype.isFaceCurvature=function(){return this.isFaceUCurve()||this.isFaceVCurve()},e}();t.EntityCurvatureWrapper=r},864589:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SECTION_PLANE_REMOVED=t.SECTION_PLANE_ADDED=t.DEFAULT_UNITS_CHANGED=t.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER=t.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER=t.VIEW_CONTAINER_MENU_INVOKED=t.CLOSE_MATE_DOF_CHOOSER=t.SELECTION_REJECTED=t.DEVICE_PIXEL_RATIO_CHANGED=t.GRAPHICS_HANDLED_CLICK_EVENT=t.CHANGE_VIEW=t.CHANGE_FEATURE_APPEARANCE=t.CANVAS_MOUSEMOVE=t.CANVAS_MOUSELEAVE=t.CANVAS_MOUSEENTER=t.CANVAS_CLICK=t.BODY_UNLOADED=t.BODIES_LOADED=t.DIMENSION_VALUE_CHANGED=t.ASSEMBLY_DATA_PROCESSED=t.DISPLAYED_PART_STUDIO=t.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED=t.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED=t.NEW_PART_LIST=t.CLOSE_SKETCH_SUB_DIALOG=t.SKETCH_COMMAND_ACTIVATED=t.SHOW_SKETCH_TEXT=t.CLOSE_SELECT_OTHER=t.SHOW_SMART_SELECTION=t.SELECT_OTHER_REVERSE=t.SELECT_OTHER=t.GL_CONTEXT_RESTORED=t.GL_CONTEXT_LOST=t.SESSION_ENDED=t.DIMENSION_DELETE_REQUEST=t.CLOSE_DIMENSION_EDIT=t.DIMENSION_EDIT_CLOSED=t.DIMENSION_TEXT_DOUBLE_CLICKED=t.DIMENSION_TEXT_SINGLE_CLICKED=t.ELEMENT_PREVIEW_GRAPHICS_LOADED=t.ELEMENT_VIEW_INITIALIZED=t.ELEMENT_GRAPHICS_LOADING=t.VIEW_DID_DRAW=t.VIEW_WILL_PICK=t.VIEW_WILL_DRAW=t.ACTIVE_VIEWER_SET=t.getObservableFromActiveViewerForEvent=t.activeViewerChanging=t.getActiveViewerEventDispatcher=t.EventDispatcher=void 0,t.SIMULATION_RESULTS_DISPLAYED=t.SIMULATION_LEGEND_CLOSED=t.SIMULATION_LEGEND_OPENED=t.SIMULATION_MAXIMUM_CLICKED=t.SIMULATION_MINIMUM_CLICKED=t.AFTER_MARKUP_IMAGE_GENERATION=t.BEFORE_MARKUP_IMAGE_GENERATION=t.ACTIVE_SHEETMETAL_MODEL_CHANGED=t.RETRIEVE_SMOOTH_EDGE_INFORMATION=t.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES=t.ADD_TEMPORARY_TESSELLATION_OVERRIDES=t.RETRIEVE_OCCURRENCE_DISPLAY_DATA=t.DID_RENDER_THUMBNAILS=t.WILL_RENDER_THUMBNAILS=t.SPACEMOUSE_COMMAND=t.SPACEMOUSE_COMMANDS_RECEIVED=t.SPACEMOUSE_ACTION_SET_CHANGED=t.ASSEMBLY_ANIMATE_MATE_ENDED=t.ASSEMBLY_ANIMATE_MATE_STARTED=t.VIEWER_CANVAS_ATTACHED_TO_CONTAINER=t.UPDATE_INCONTEXT_ISOLATION=t.SECTION_VIEW_DIALOG_CLOSED=t.SECTION_VIEW_DIALOG_OPENED=t.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED=void 0;var r=i(423902),n=i(817395),o=i(663748),s=i(992945),a=function(e){function t(){return e.call(this)||this}return(0,r.__extends)(t,e),t}(o.BackboneEventsBaseClass);t.EventDispatcher=a;var c=new a;function l(){if(n.getActiveViewer){var e=(0,n.getActiveViewer)();if(e)return e.getEventDispatcher()}return c}t.getActiveViewerEventDispatcher=l,t.activeViewerChanging=function(e,t){t&&(t.setEventDispatcher(c),c=new a),e&&!t&&(c=e.getEventDispatcher(),e.setEventDispatcher(new a))},t.getObservableFromActiveViewerForEvent=function(e){return(0,s.fromEventPattern)((function(t){return l().on(e,t)}),(function(t){return l().off(e,t)}),(function(e){return arguments}))},t.ACTIVE_VIEWER_SET="ACTIVE_VIEWER_SET",t.VIEW_WILL_DRAW="VIEW_WILL_DRAW",t.VIEW_WILL_PICK="VIEW_WILL_PICK",t.VIEW_DID_DRAW="VIEW_DID_DRAW",t.ELEMENT_GRAPHICS_LOADING="ELEMENT_GRAPHICS_LOADING",t.ELEMENT_VIEW_INITIALIZED="ELEMENT_VIEW_INITIALIZED",t.ELEMENT_PREVIEW_GRAPHICS_LOADED="ELEMENT_PREVIEW_GRAPHICS_LOADED",t.DIMENSION_TEXT_SINGLE_CLICKED="DIMENSION_TEXT_SINGLE_CLICKED",t.DIMENSION_TEXT_DOUBLE_CLICKED="DIMENSION_TEXT_DOUBLE_CLICKED",t.DIMENSION_EDIT_CLOSED="DIMENSION_EDIT_CLOSED",t.CLOSE_DIMENSION_EDIT="CLOSE_DIMENSION_EDIT",t.DIMENSION_DELETE_REQUEST="DIMENSION_DELETE_REQUEST",t.SESSION_ENDED="SESSION_ENDED",t.GL_CONTEXT_LOST="GL_CONTEXT_LOST",t.GL_CONTEXT_RESTORED="GL_CONTEXT_RESTORED",t.SELECT_OTHER="SELECT_OTHER",t.SELECT_OTHER_REVERSE="SELECT_OTHER_REVERSE",t.SHOW_SMART_SELECTION="SHOW_SMART_SELECTION",t.CLOSE_SELECT_OTHER="CLOSE_SELECT_OTHER",t.SHOW_SKETCH_TEXT="SHOW_SKETCH_TEXT",t.SKETCH_COMMAND_ACTIVATED="SKETCH_COMMAND_ACTIVATED",t.CLOSE_SKETCH_SUB_DIALOG="CLOSE_SKETCH_SUB_DIALOG",t.NEW_PART_LIST="NEW_PART_LIST",t.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED="NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED",t.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED="PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED",t.DISPLAYED_PART_STUDIO="DISPLAYED_PART_STUDIO",t.ASSEMBLY_DATA_PROCESSED="ASSEMBLY_DATA_PROCESSED",t.DIMENSION_VALUE_CHANGED="DIMENSION_VALUE_CHANGED",t.BODIES_LOADED="BODIES_LOADED",t.BODY_UNLOADED="BODY_UNLOADED",t.CANVAS_CLICK="CANVAS_CLICK",t.CANVAS_MOUSEENTER="CANVAS_MOUSEENTER",t.CANVAS_MOUSELEAVE="CANVAS_MOUSELEAVE",t.CANVAS_MOUSEMOVE="CANVAS_MOUSEMOVE",t.CHANGE_FEATURE_APPEARANCE="CHANGE_FEATURE_APPEARANCE",t.CHANGE_VIEW="CHANGE_VIEW",t.GRAPHICS_HANDLED_CLICK_EVENT="GRAPHICS_HANDLED_CLICK_EVENT",t.DEVICE_PIXEL_RATIO_CHANGED="DEVICE_PIXEL_RATIO_CHANGED",t.SELECTION_REJECTED="SELECTION_REJECTED",t.CLOSE_MATE_DOF_CHOOSER="CLOSE_MATE_DOF_CHOOSER",t.VIEW_CONTAINER_MENU_INVOKED="VIEW_CONTAINER_MENU_INVOKED",t.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER="CREATE_SECTION_PLANE_INFERENCE_CONTROLLER",t.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER="DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER",t.DEFAULT_UNITS_CHANGED="DEFAULT_UNITS_CHANGED",t.SECTION_PLANE_ADDED="SECTION_PLANE_ADDED",t.SECTION_PLANE_REMOVED="SECTION_PLANE_REMOVED",t.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED="MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED",t.SECTION_VIEW_DIALOG_OPENED="SECTION_VIEW_DIALOG_OPENED",t.SECTION_VIEW_DIALOG_CLOSED="SECTION_VIEW_DIALOG_CLOSED",t.UPDATE_INCONTEXT_ISOLATION="UPDATE_INCONTEXT_ISOLATION",t.VIEWER_CANVAS_ATTACHED_TO_CONTAINER="VIEWER_CANVAS_ATTACHED_TO_CONTAINER",t.ASSEMBLY_ANIMATE_MATE_STARTED="ASSEMBLY_ANIMATE_MATE_STARTED",t.ASSEMBLY_ANIMATE_MATE_ENDED="ASSEMBLY_ANIMATE_MATE_ENDED",t.SPACEMOUSE_ACTION_SET_CHANGED="SPACEMOUSE_ACTION_SET_CHANGED",t.SPACEMOUSE_COMMANDS_RECEIVED="SPACEMOUSE_COMMANDS_RECEIVED",t.SPACEMOUSE_COMMAND="SPACEMOUSE_COMMAND",t.WILL_RENDER_THUMBNAILS="WILL_RENDER_THUMBNAILS",t.DID_RENDER_THUMBNAILS="DID_RENDER_THUMBNAILS",t.RETRIEVE_OCCURRENCE_DISPLAY_DATA="RETRIEVE_OCCURRENCE_DISPLAY_DATA",t.ADD_TEMPORARY_TESSELLATION_OVERRIDES="ADD_TEMPORARY_TESSELLATION_OVERRIDE",t.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES="CLEAR_TEMPORARY_TESSELLATION_OVERRIDES",t.RETRIEVE_SMOOTH_EDGE_INFORMATION="RETRIEVE_SMOOTH_EDGE_INFORMATION",t.ACTIVE_SHEETMETAL_MODEL_CHANGED="ACTIVE_SHEETMETAL_MODEL_CHANGED",t.BEFORE_MARKUP_IMAGE_GENERATION="BEFORE_PRINT_IMAGE_GENERATION",t.AFTER_MARKUP_IMAGE_GENERATION="AFTER_PRINT_IMAGE_GENERATION",t.SIMULATION_MINIMUM_CLICKED="SIMULATION_MINIMUM_CLICKED",t.SIMULATION_MAXIMUM_CLICKED="SIMULATION_MAXIMUM_CLICKED",t.SIMULATION_LEGEND_OPENED="SIMULATION_LEGEND_OPENED",t.SIMULATION_LEGEND_CLOSED="SIMULATION_LEGEND_CLOSED",t.SIMULATION_RESULTS_DISPLAYED="SIMULATION_RESULTS_DISPLAYED"},884640:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NumberIdManager=t.INVALID_NUMBER_ID=t.idFromString=t.idIsValid=t.idsEqual=t.makeId=t.IdManager=t.IdMasks=t.IdSizes=t.FIRST_ID=t.INVALID_ID_ELEMENT=t.INVALID_ID=void 0;var r=i(507025);t.INVALID_ID=[],t.INVALID_ID_ELEMENT=0;var n;t.FIRST_ID=[1],function(e){e[e.DEFAULT=32]="DEFAULT",e[e.ENTITY=20]="ENTITY",e[e.OCCURRENCE_SLICE=12]="OCCURRENCE_SLICE",e[e.OCCURRENCE_ID=24]="OCCURRENCE_ID",e[e.HIGHLIGHT=16]="HIGHLIGHT"}(n=t.IdSizes||(t.IdSizes={})),function(e){e[e.ENTITY=1048575]="ENTITY",e[e.OCCURRENCE_SLICE=4095]="OCCURRENCE_SLICE"}(t.IdMasks||(t.IdMasks={}));var o=function(){function e(e){this.freeIds=[],this.nextId=t.FIRST_ID.slice(0);var i=e||n.DEFAULT;this.maximumElementSize=Math.pow(2,i)-1}return e.prototype.clone=function(){var t=new e;return t.nextId=this.nextId.slice(0),t.freeIds=this.freeIds.slice(0),t.maximumElementSize=this.maximumElementSize,t},e.prototype.reset=function(){this.nextId=t.FIRST_ID.slice(0),this.freeIds=[]},e.prototype.getId=function(){if(this.freeIds.length>1)return this.freeIds.pop();var e,t=this.nextId.slice(0),i=!1;for(e=0;e<this.nextId.length;++e)if(this.nextId[e]<this.maximumElementSize){this.nextId[e]=this.nextId[e]+1;for(var r=0;r<e;++r)this.nextId[r]=1;i=!0;break}if(!i){for(e=0;e<this.nextId.length;++e)this.nextId[e]=1;this.nextId.push(1)}return t},e.prototype.freeId=function(e){a(e)&&this.freeIds.push(e)},e}();function s(e){return e}function a(e){if(!e||e.length<1)return!1;for(var i=0;i<e.length;++i)if(e[i]===t.INVALID_ID_ELEMENT)return!1;return!0}t.IdManager=o,t.makeId=s,t.idsEqual=function(e,t){return(0,r.arraysEqual)(e,t)},t.idIsValid=a,t.idFromString=function(e){for(var t=e.split(","),i=[],r=0;r<t.length;r++)i.push(+t[r]);return i},t.INVALID_NUMBER_ID=0;var c=function(){function e(e){this.freeIds=[],this.nextId=1;var t=e||n.DEFAULT;this.maximumNumberSize=Math.pow(2,t)-1}return e.prototype.reset=function(){this.nextId=1,this.freeIds=[]},e.prototype.getId=function(){if(this.freeIds.length>1)return this.freeIds.pop();if(this.nextId===t.INVALID_NUMBER_ID)return t.INVALID_NUMBER_ID;var e=this.nextId++;return this.nextId>=this.maximumNumberSize&&(this.nextId=t.INVALID_NUMBER_ID),e},e.prototype.isIdValid=function(e){return e!==t.INVALID_NUMBER_ID},e.prototype.freeId=function(e){this.isIdValid(e)&&this.freeIds.push(e)},e}();t.NumberIdManager=c},623639:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(423902);(0,r.__exportStar)(i(734604),t),(0,r.__exportStar)(i(864589),t),(0,r.__exportStar)(i(446862),t),(0,r.__exportStar)(i(824661),t),(0,r.__exportStar)(i(173567),t),(0,r.__exportStar)(i(713287),t),(0,r.__exportStar)(i(43454),t),(0,r.__exportStar)(i(874197),t),(0,r.__exportStar)(i(657992),t),(0,r.__exportStar)(i(131210),t),(0,r.__exportStar)(i(890130),t),(0,r.__exportStar)(i(832205),t),(0,r.__exportStar)(i(644328),t),(0,r.__exportStar)(i(784746),t),(0,r.__exportStar)(i(280738),t),(0,r.__exportStar)(i(620968),t),(0,r.__exportStar)(i(521761),t),(0,r.__exportStar)(i(642170),t),(0,r.__exportStar)(i(37496),t),(0,r.__exportStar)(i(639501),t),(0,r.__exportStar)(i(521300),t),(0,r.__exportStar)(i(971188),t),(0,r.__exportStar)(i(363540),t),(0,r.__exportStar)(i(265194),t),(0,r.__exportStar)(i(558474),t),(0,r.__exportStar)(i(951682),t),(0,r.__exportStar)(i(872136),t),(0,r.__exportStar)(i(474917),t),(0,r.__exportStar)(i(180954),t),(0,r.__exportStar)(i(78666),t),(0,r.__exportStar)(i(813681),t),(0,r.__exportStar)(i(394739),t),(0,r.__exportStar)(i(847264),t),(0,r.__exportStar)(i(564219),t),(0,r.__exportStar)(i(884640),t),(0,r.__exportStar)(i(94012),t),(0,r.__exportStar)(i(328408),t),(0,r.__exportStar)(i(688571),t),(0,r.__exportStar)(i(817395),t)},847264:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NamedIdManager=void 0;var r=i(736202),n=i(623639),o=function(){function e(e){this.nameToId={},this.idToName={},this.idManager=new n.IdManager(e)}return e.prototype.reset=function(){this.nameToId={},this.idToName={},this.idManager.reset()},e.prototype.clone=function(){var t=new e;return t.nameToId=(0,r.clone)(this.nameToId),t.idToName=(0,r.clone)(this.idToName),t.idManager=this.idManager.clone(),t},e.prototype.getOrCreateIdForName=function(e){var t=this.nameToId[e];return t||(t=this.idManager.getId(),this.nameToId[e]=t,this.idToName[t]=e),t},e.prototype.getIdForName=function(e){var t=this.nameToId[e];return t||n.INVALID_ID},e.prototype.getNameForId=function(e){var t=this.idToName[e];return t||null},e.prototype.removeName=function(e){var t=this.nameToId[e];t&&(this.idManager.freeId(t),delete this.nameToId[e],delete this.idToName[t])},e}();t.NamedIdManager=o},564219:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isIdValid=t.OccurrenceIdManager=t.PART_STUDIO_ELEMENT_ID=t.NO_ID=t.INVALID_OCCURRENCE_ID=void 0;var r=i(817395),n=i(884640),o=i(847264),s=i(311517);t.INVALID_OCCURRENCE_ID=-1,t.NO_ID=0,t.PART_STUDIO_ELEMENT_ID=0;var a=1<<n.IdSizes.OCCURRENCE_SLICE,c=function(){function e(e){this.viewer=e,(0,r.viewerCheck)(e),this.namedIdManager=new o.NamedIdManager(n.IdSizes.OCCURRENCE_ID)}return e.prototype.reset=function(){this.namedIdManager.reset()},e.prototype.convertToOccurrenceId=function(e){if(!(0,n.idIsValid)(e))return t.INVALID_OCCURRENCE_ID;if(e.length>1)return s.log.warn("More than the allowed number of occurrences have been allocated"),t.INVALID_OCCURRENCE_ID;for(var i=e[0],r=1;i>=a;)++r,i/=a;return this.viewer.notifyOfPickPassCount(r),e[0]},e.prototype.getOrCreateIdForName=function(e){return this.convertToOccurrenceId(this.namedIdManager.getOrCreateIdForName(e))},e.prototype.getIdForName=function(e){return this.convertToOccurrenceId(this.namedIdManager.getIdForName(e))},e.prototype.getNameForId=function(e){return this.namedIdManager.getNameForId([e])},e.prototype.removeName=function(e){this.namedIdManager.removeName(e)},e}();t.OccurrenceIdManager=c,t.isIdValid=function(e){return null!=e&&e!==t.INVALID_OCCURRENCE_ID}},901893:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.numberToPrimitiveType=t.getPrimitiveTypeDescription=t.PRIMITIVE_TYPE_BITS=t.PrimitiveType=void 0,function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.INFINITE_LINES=2]="INFINITE_LINES",e[e.TRIANGLES=3]="TRIANGLES",e[e.TRIANGLE_STRIP=4]="TRIANGLE_STRIP",e[e.SILHOUETTES=5]="SILHOUETTES",e[e.COUNT=6]="COUNT",e[e.PRIMITIVE_UNKNOWN=-1]="PRIMITIVE_UNKNOWN"}(i=t.PrimitiveType||(t.PrimitiveType={})),t.PRIMITIVE_TYPE_BITS=Math.ceil(Math.log(i.COUNT)/Math.log(2)),t.getPrimitiveTypeDescription=function(e){switch(e){case i.POINTS:return"POINTS";case i.LINES:return"LINES";case i.INFINITE_LINES:return"INFINITE_LINES";case i.TRIANGLES:return"TRIANGLES";case i.TRIANGLE_STRIP:return"TRIANGLE_STRIP";case i.SILHOUETTES:return"SILHOUETTES";default:return"PRIMITIVE_UNKNOWN"}},t.numberToPrimitiveType=function(e){switch(e){case i.POINTS:return i.POINTS;case i.LINES:return i.LINES;case i.INFINITE_LINES:return i.INFINITE_LINES;case i.TRIANGLES:return i.TRIANGLES;case i.TRIANGLE_STRIP:return i.TRIANGLE_STRIP;case i.SILHOUETTES:return i.SILHOUETTES}return i.PRIMITIVE_UNKNOWN}},94012:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateAutoSetting=t.setRendererInfo=t.setRetinaDisplayMode=t.RetinaDisplayMode=void 0;var r,n=i(699716);!function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON",e[e.AUTO=2]="AUTO"}(r=t.RetinaDisplayMode||(t.RetinaDisplayMode={}));var o,s=r.AUTO,a=null;function c(){if(s===r.AUTO){var e=(void 0===o&&(o=navigator.platform.indexOf("Mac")>-1),!o),t=new RegExp(".*intel.*","i");a&&t.test(a.glRenderer)&&(e=!0),(0,n.setPixelScalingDisabled)(e)}}t.setRetinaDisplayMode=function(e){switch(s=e){case r.OFF:(0,n.setPixelScalingDisabled)(!0);break;case r.ON:(0,n.setPixelScalingDisabled)(!1);break;case r.AUTO:c()}},t.setRendererInfo=function(e){a=e,c()},t.updateAutoSetting=c,c()},328408:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SIMULATION_BODY_SCENEGRAPH_ID=t.INFERENCE_PICKER_SCENEGRAPH_ID=t.HUD_MODEL_SCENEGRAPH_ID=t.HUD_SCENEGRAPH_ID=t.PREVIEW_SCENEGRAPH_ID=t.MAIN_SCENEGRAPH_ID=void 0,t.MAIN_SCENEGRAPH_ID="mainSceneGraph",t.PREVIEW_SCENEGRAPH_ID="previewSceneGraph",t.HUD_SCENEGRAPH_ID="hudSceneGraph",t.HUD_MODEL_SCENEGRAPH_ID="hudModelSceneGraph",t.INFERENCE_PICKER_SCENEGRAPH_ID="inferencePickerSceneGraph",t.SIMULATION_BODY_SCENEGRAPH_ID="simulationBodyScenegraph"},766:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCounters=t.Counters=t.CounterNames=void 0;var r,n=i(423902),o=i(514194);!function(e){e.UPDATES="counter updates",e.DRAW_CALLS="draw calls",e.TRIANGLES="triangles",e.LINES="lines",e.POINTS="points"}(r=t.CounterNames||(t.CounterNames={}));var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.__extends)(t,e),t.prototype.initialize=function(){this.counters={},this.updateCount=0},t.prototype.increment=function(e,t){void 0===t&&(t=1);var i=this.counters[e];i||(i=0),this.counters[e]=i+t},t.prototype.resetCounters=function(){this.counters={}},t.prototype.updateModel=function(){var e=this;Object.entries(this.counters).forEach((function(t){var i=(0,n.__read)(t,2),r=i[0],o=i[1];e.set(r,o.toFixed(0))})),this.set(r.UPDATES,this.updateCount++)},t}(o.Model);t.Counters=s;var a=new s;t.getCounters=function(){return a}},688571:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userWebPreferencesGetManager=void 0;var r=i(94012),n=i(817395),o=function(){function e(){this.retinaDisplaySetting=r.RetinaDisplayMode.AUTO}return e.prototype.getRetinaDisplaySetting=function(){return this.retinaDisplaySetting},e.prototype.setRetinaDisplaySetting=function(e){this.retinaDisplaySetting=e,(0,r.setRetinaDisplayMode)(this.retinaDisplaySetting),(0,n.getActiveViewer)().requestDraw()},e.prototype.setUserWebPreference=function(e){var t=r.RetinaDisplayMode[e.retinaDisplaySetting];this.setRetinaDisplaySetting(t)},e}(),s=null;t.userWebPreferencesGetManager=function(){return s||(s=new o),s}},817395:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.viewerCheck=t.getFocusedViewer=t.getActiveViewerModelViewManagers=t.getActiveViewer=t.setActiveViewer=t.setFocusedViewer=t.activeViewer=void 0;var r=i(311517),n=i(864589);t.activeViewer=null;var o=null;function s(e){(o=e)?o.getPrimaryViewController()&&t.activeViewer.getPrimaryViewController()&&(o.getPrimaryViewController().forcedManipulationMode=t.activeViewer.getPrimaryViewController().forcedManipulationMode):o=t.activeViewer}function a(){return t.activeViewer}t.setFocusedViewer=s,t.setActiveViewer=function(e){(0,n.activeViewerChanging)(t.activeViewer,e),t.activeViewer&&e&&r.log.warn("A second viewer was set to be active before the first was deactivated."),t.activeViewer=e,s(e)},t.getActiveViewer=a,t.getActiveViewerModelViewManagers=function(){var e=a();return e?e.getModelViewManagers():null},t.getFocusedViewer=function(){return o},t.viewerCheck=function(e){return!!e||(r.log.warn("viewer is null or undefined"),!1)}},732862:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Display=t.getNodeProperties=void 0;var r=i(423902),n=i(73055),o=i(712197),s=i(227441),a=i(311611),c=new a.Material({diffuseFactor:.5,ambientFactor:.5});function l(){return{0:new a.NodeProperties({isPickable:!1,zOffset:3,isShowThrough:!0,primitiveType:a.PrimitiveType.POINTS}),1:new a.NodeProperties({isPickable:!1,zOffset:4,isShowThrough:!0,primitiveType:a.PrimitiveType.LINES,priority:a.RenderOrderPriority.HIGHEST}),4:new a.NodeProperties({isPickable:!1,isTwoSided:!0,zOffset:5,primitiveType:a.PrimitiveType.TRIANGLE_STRIP,material:c,primitivesHaveTransparency:!0})}}t.getNodeProperties=l;var u=function(e){function t(t,i){var r=e.call(this,i)||this;r.sheetMetalModelId=null,r.incrementIdToHightlight={};n.default.getManager();return t.forEach((function(e,t){var i=null;if(e instanceof s.BTDebugGeometry&&(i=e,this.sheetMetalModelId=i.sheetMetalModelId,i.deterministicId&&i.style===s.GBTDebugEntityStyle.ERROR)){var r=(0,o.createSelectionFromDeterministicId)(i.deterministicId);if(r)return void(0,o.getErrorSelectionList)().add(r)}var n=(0,a.createMeshIncrementForEntityData)(e);if(n){if(!n.colors){var c=(0,a.getColorFromDebugEntityColor)(s.GBTDebugEntityColor.FEATURE_ERROR,n.primitiveType);(0,a.addColorToIncrement)(c,n)}n.primitiveType===a.PrimitiveType.POINTS?n.primitiveSizes||(0,a.addSizeToIncrement)(7,n):n.primitiveType===a.PrimitiveType.LINES&&(0,a.addSizeToIncrement)(2.5,n);var u=l(),h="id"+t;if(this.updateMeshIncrement(h,a.NO_SELECTION_ID,n,u[n.primitiveType]),i&&i.style===s.GBTDebugEntityStyle.ERROR){var d=this.addNewHighlightToIncrement(h,a.HighlightType.ERROR);this.incrementIdToHightlight[h]=d,this.hideIncrement(h)}this.viewer.getIsolatedOccurrenceManager().addIdsToIsolate([this.graphicsOccurrenceId])}}),r),r}return(0,r.__extends)(t,e),t.prototype.show=function(){for(var t in e.prototype.show.call(this),this.incrementIdToHightlight){var i=this.addNewHighlightToIncrement(t,a.HighlightType.ERROR);this.incrementIdToHightlight[t]=i,this.hideIncrement(t)}},t.prototype.hide=function(){for(var t in e.prototype.hide.call(this),this.incrementIdToHightlight)this.removeHighlightFromIncrement(t,this.incrementIdToHightlight[t]);this.freeAllocatedHighlights()},t.prototype.remove=function(){(0,o.getErrorSelectionList)().reset(),this.viewer.getIsolatedOccurrenceManager().removeFromIsolate([this.graphicsOccurrenceId]),e.prototype.remove.call(this)},t}(a.UIElement);t.Display=u},661144:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolDisplay=t.TOOL_EDGE_PROPERTIES=t.TOOL_FACE_PROPERTIES=void 0;var r=i(423902),n=i(73055),o=i(311611),s=new o.Material({diffuseFactor:.5,ambientFactor:.5});t.TOOL_FACE_PROPERTIES=new o.NodeProperties({isPickable:!1,isTwoSided:!0,primitiveType:o.PrimitiveType.TRIANGLE_STRIP,isShowThrough:!0,isDepthTested:!1,priority:o.RenderOrderPriority.LOWER,material:s}),t.TOOL_EDGE_PROPERTIES=new o.NodeProperties({isPickable:!1,primitiveType:o.PrimitiveType.LINES});var a=function(e){function t(t,i){var r=e.call(this,t)||this;return r.manipulatorId=i,r.sourcePrimitives=[],r.sourceIds=[],r}return(0,r.__extends)(t,e),t.prototype.initialize=function(e){return!(e.length<1)&&(!!this.createPreviewMeshes(e)&&!!this.updateMeshes())},t.prototype.duplicatePrimitive=function(e){var t=e.clone();return t.id="",e.points&&(t.points=new Float32Array(e.points)),t},t.prototype.createPreviewMeshes=function(e){this.sourcePrimitives=[];var t=n.default.getManager().getColor("FEATURE_FAST_PREVIEW_COLOR"),i=this.viewer.getModelViewManagers().getManager();return i&&e.forEach((function(e){var r=i.extractMeshIncrement(e);if(r){var n=this.duplicatePrimitive(r);n.colors=null,(0,o.addColorToIncrement)(t,n),this.sourcePrimitives.push(n),this.sourceIds.push(e)}}),this),this.sourceIds.length>=1},t.prototype.updateMeshes=function(){return!1},t}(o.UIElement);t.ToolDisplay=a},893065:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterEdgePointCandidate=t.FilterVertexCandidate=t.FilterCandidate=void 0;var r=i(423902),n=function(){function e(){}return e.prototype.isFromWireBody=function(){return!1},e.prototype.isFromPointBody=function(){return!1},e.prototype.isCompositeBody=function(){return!1},e.prototype.isFromConstructionGeometry=function(){return!1},e.prototype.isInternalEdge=function(){return!1},e.prototype.isPlanar=function(){return!1},e.prototype.getPlanarNormal=function(){return null},e.prototype.isFromBody=function(){return!1},e.prototype.isFromSolidBody=function(){return!1},e.prototype.isFromSheetBody=function(){return!1},e.prototype.isFace=function(){return!1},e.prototype.canContainFace=function(){return!1},e.prototype.isEdge=function(){return!1},e.prototype.canContainEdge=function(){return!1},e.prototype.isVertex=function(){return!1},e.prototype.canContainVertex=function(){return!1},e.prototype.isDegenerateEdge=function(){return!1},e.prototype.isDefinedBySMVertex=function(){return!1},e.prototype.isDefinedBySMEdge=function(){return!1},e.prototype.isDefinedBySMFace=function(){return!1},e.prototype.isMateConnector=function(){return!1},e.prototype.isMate=function(){return!1},e.prototype.containsMesh=function(){return!1},e.prototype.isFlattened=function(){return!1},e.prototype.isFromActiveSheetMetal=function(){return!1},e.prototype.isBody=function(){return!1},e.prototype.isFromSketch=function(){return!1},e.prototype.isSketchTextEntity=function(){return!1},e.prototype.isSketchTextStroke=function(){return!1},e.prototype.isSketchImageEntity=function(){return!1},e.prototype.isSketchGroup=function(){return!1},e.prototype.getSketchGroupSelection=function(){return null},e.prototype.isUserSketchEntity=function(){return!1},e.prototype.getFeatureIds=function(){return[]},e.prototype.makeBodySelection=function(){return null},e.prototype.makeCompositeBodySelections=function(){return null},e.prototype.makeSketchFeatureSelection=function(){return null},e.prototype.isFromOccurrence=function(){return!1},e.prototype.isOccurrence=function(){return!1},e.prototype.makeOccurrenceSelection=function(e){return null},e.prototype.isClosedCurve=function(){return!1},e.prototype.isFromClick=function(){return!1},e.prototype.isEntity=function(){return!1},e.prototype.hasMateQueryData=function(){return!1},e.prototype.isGeometryMate=function(){return!1},e.prototype.getMateType=function(){return null},e.prototype.isMateGroup=function(){return!1},e.prototype.isMateConnectorBasedMate=function(){return!1},e.prototype.isFeature=function(){return!1},e.prototype.getFeatureType=function(){return null},e.prototype.isLine=function(){return!1},e.prototype.isCircle=function(){return!1},e.prototype.isEllipse=function(){return!1},e.prototype.isConic=function(){return!1},e.prototype.isCylinder=function(){return!1},e.prototype.isCone=function(){return!1},e.prototype.isSphere=function(){return!1},e.prototype.isTorus=function(){return!1},e.prototype.isRevolved=function(){return!1},e.prototype.isExtruded=function(){return!1},e.prototype.isAssemblyPattern=function(){return!1},e.prototype.isParametricInstance=function(){return!1},e.prototype.isDerivedInstance=function(){return!1},e.prototype.isReplicatedInstance=function(){return!1},e.prototype.isNonSolidPartOccurrence=function(){return!1},e.prototype.isTemporaryGeometry=function(){return!1},e.prototype.isModifiable=function(){return!1},e.prototype.isNonModifiable=function(){return!1},e.prototype.isEdgePoint=function(){return!1},e.prototype.isPatternedOccurrence=function(){return!1},e.prototype.isAssemblyOccurrence=function(){return!1},e.prototype.isPartOccurrence=function(){return!1},e.prototype.isSuppressedOccurrence=function(){return!1},e.prototype.isFlattenedOccurrence=function(){return!1},e.prototype.isStandardContentOccurrence=function(){return!1},e.prototype.getOccurrence=function(){return null},e.prototype.getOwnerAssemblyOccurrence=function(){return null},e.prototype.makeMateConnectorSelection=function(){return null},e.prototype.isSpline=function(){return!1},e.prototype.isAssemblySketch=function(){return!1},e.prototype.isFromSplineHandle=function(){return!1},e}();t.FilterCandidate=n;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.isFromBody=function(){return!0},t.prototype.isFromSolidBody=function(){return!0},t.prototype.isVertex=function(){return!0},t.prototype.canContainVertex=function(){return!0},t.prototype.isEntity=function(){return!0},t}(n);t.FilterVertexCandidate=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.isEdgePoint=function(){return!0},t}(o);t.FilterEdgePointCandidate=s},844416:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilteredEntitiesHighlightController=void 0;var r=i(423902),n=i(663748),o=i(712197),s=i(311611),a=function(e){function t(t,i){var r=e.call(this)||this;return r.viewer=t,r.isEnabled=!1,(0,s.viewerCheck)(t),r.graphicsViewer=t,r.highlightFilterFunction=i,r}return(0,r.__extends)(t,e),t.prototype.enable=function(){this.isEnabled=!0,this.updateSetOfFilteredEntities(),this.stopListening(),this.listenTo(this.graphicsViewer.getEventDispatcher(),s.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED,this.updateSetOfFilteredEntities),this.listenTo((0,s.getEditState)(),"change:latestDisplayDataUsage",this.updateSetOfFilteredEntities)},t.prototype.disable=function(){this.isEnabled&&(this.isEnabled=!1,this.stopListening(),(0,o.clearFilteredEntitiesHighlight)())},t.prototype.updateSetOfFilteredEntities=function(){(0,o.clearFilteredEntitiesHighlight)(),this.updateHighlightsForPartStudio(this.graphicsViewer.getModelViewManagers().getManager().getDisplayedPartStudio());var e=this.graphicsViewer.getModelViewManagers().getPreviewManager();e&&this.updateHighlightsForPartStudio(e.getDisplayedPartStudio())},t.prototype.updateHighlightsForPartStudio=function(e){if(e)for(var t=e.getFilteredEntityIds(this.highlightFilterFunction),i=!this.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode(),r=e.getBodyComponent(),n=0;n<t.length;++n){var a=(0,o.createSelectionFromDeterministicId)(t[n],null,e.usage);a&&e.getBodyVisibility(a.getBodyId())===s.Visibility.VISIBLE&&(i||r.isBodyIsolated(s.PART_STUDIO_ELEMENT_ID,a.getBodyId()))&&(0,o.getFilteredEntitiesList)().add(a)}},t}(n.BackboneEventsBaseClass);t.FilteredEntitiesHighlightController=a},915443:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameBuffer=void 0;var r=i(423902),n=i(311611),o=i(663748),s=i(311517),a=function(e){function t(t,i,r,o){var s=e.call(this)||this;return s.viewer=t,s.textureType=i,s.GAUGE_MEMORY_TYPE="Frame buffer",s.colorTexture=null,s.renderBuffer=null,s.frameBuffer=null,s.width=0,s.height=0,(0,n.viewerCheck)(t),s.renderBufferArguments=o,s.id=r||"",s.listenTo(s.viewer.getEventDispatcher(),n.GL_CONTEXT_LOST,s.onGlContextLost),s.listenTo(s.viewer.getEventDispatcher(),n.SESSION_ENDED,s.onSessionEnded),s}return(0,r.__extends)(t,e),t.prototype.destroy=function(){this.stopListening(),this.freeResources()},t.prototype.onSessionEnded=function(){this.destroy()},t.prototype.onGlContextLost=function(){this.frameBuffer=null,this.colorTexture=null,this.renderBuffer=null},t.prototype.update=function(e){var t=e.getViewport(),i=t[2],r=t[3];if(!this.colorTexture||i!==this.width||r!==this.height){var n=this.viewer.getGlContext();this.freeResources(),this.width=i,this.height=r;var o=n.getParameter(n.FRAMEBUFFER_BINDING);this.createBuffer(i,r),this.checkFrameBuffer()||this.textureType!==this.viewer.getHalfFloatType()||(this.textureType=n.FLOAT,s.log.info("The creation of a frame buffer with HALF_FLOAT failed.  Attempting to create buffer with full FLOAT"),this.freeResources(),this.createBuffer(i,r),this.checkFrameBuffer()),n.bindFramebuffer(n.FRAMEBUFFER,o||null)}},t.prototype.getColorTextureMemoryUsage=function(){return(0,n.getTextureSize)(this.width,this.height,n.GlPixelFormat.RGBA,this.textureType)},t.prototype.getRenderBufferMemoryUsage=function(){return this.renderBufferArguments?this.width*this.height*(0,n.sizeOfGlRenderBufferType)(this.renderBufferArguments.storageType):0},t.prototype.incrementMemoryGauge=function(){var e=this.viewer.getMemoryGauge();this.colorTexture&&e.incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getColorTextureMemoryUsage()),this.renderBuffer&&e.incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getRenderBufferMemoryUsage())},t.prototype.freeResources=function(){var e=this.viewer.getGlContext();if(e){var t=this.viewer.getMemoryGauge();this.frameBuffer&&(e.deleteFramebuffer(this.frameBuffer),this.frameBuffer=null),this.colorTexture&&(t.decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getColorTextureMemoryUsage()),e.deleteTexture(this.colorTexture),this.colorTexture=null),this.renderBuffer&&(t.decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getRenderBufferMemoryUsage()),e.deleteRenderbuffer(this.renderBuffer),this.renderBuffer=null)}},t.prototype.createBuffer=function(e,t){var i=this.viewer.getGlContext();this.colorTexture=(0,n.createRGBATexture)(this.viewer,e,t,this.textureType),this.renderBufferArguments&&(this.renderBuffer=this.viewer.getOrCreateRenderBuffer(e,t,this.renderBufferArguments)),this.frameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.colorTexture,0),this.renderBufferArguments&&i.framebufferRenderbuffer(i.FRAMEBUFFER,this.renderBufferArguments.attachmentType,i.RENDERBUFFER,this.renderBuffer),this.incrementMemoryGauge()},t.prototype.checkFrameBuffer=function(){var e=this.viewer.getGlContext();switch(e.checkFramebufferStatus(e.FRAMEBUFFER)){case e.FRAMEBUFFER_UNSUPPORTED:return s.log.warn(n.WEBGL_ERROR_LOG_TAG+"Framebuffer is unsupported"),!1;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return this.textureType===this.viewer.getHalfFloatType()?s.log.info("Framebuffer incomplete attachment for half float type"):s.log.warn(n.WEBGL_ERROR_LOG_TAG+"Framebuffer incomplete attachment"),!1;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return s.log.warn(n.WEBGL_ERROR_LOG_TAG+"Framebuffer incomplete dimensions"),!1;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return s.log.warn(n.WEBGL_ERROR_LOG_TAG+"Framebuffer incomplete missing attachment"),!1}return!0},t.prototype.bindBuffer=function(){var e=this.viewer.getGlContext();e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer)},t.prototype.unbindBuffer=function(){var e=this.viewer.getGlContext();e.bindFramebuffer(e.FRAMEBUFFER,null)},t.prototype.getTexture=function(){return this.colorTexture},t.prototype.resetBuffer=function(){this.freeResources()},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t}(o.BackboneEventsBaseClass);t.FrameBuffer=a},829593:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameTimer=t.InteractionTypes=t.TimingDetails=t.getFramerateFromTime=void 0;var r=i(311611),n=i(280738);function o(e){return e<0?"--":(1e3/e).toFixed(1)}t.getFramerateFromTime=o;var s,a=function(){function e(){this.timings=[],this.averageTime=-1,this.framesSinceTiming=0,this.timingFrequency=10,this.timingCount=0,this.activeTimerQuery=null,this.pendingQueries=[],this.availableQueries=[],this.queryTimings=[],this.averageQueryTime=-1}return e.prototype.reset=function(){this.timings=[],this.averageTime=-1,this.timingCount=0,this.framesSinceTiming=0,this.queryTimings=[],this.averageQueryTime=-1},e.prototype.onContextLost=function(){this.activeTimerQuery=null,this.pendingQueries=[],this.availableQueries=[]},e.prototype.hasTimings=function(){return this.timings.length>0},e.prototype.getAverageFramerate=function(){return 1e3/this.averageTime},e.prototype.onDrawStart=function(e,t){if(e&&t){for(var i,r=t.getParameter(e.GPU_DISJOINT_EXT);i=this.pendingQueries.shift();)e.getQueryObjectEXT(i,e.QUERY_RESULT_AVAILABLE_EXT)&&(r||this.addQueryTiming(e.getQueryObjectEXT(i,e.QUERY_RESULT_EXT)/1e6),this.availableQueries.push(i));this.availableQueries.length>0?this.activeTimerQuery=this.availableQueries.shift():this.activeTimerQuery=e.createQueryEXT(),e.beginQueryEXT(e.TIME_ELAPSED_EXT,this.activeTimerQuery)}},e.prototype.addQueryTiming=function(e){this.queryTimings.push(e),this.queryTimings.length>30&&this.queryTimings.shift();for(var t=0,i=0;i<this.queryTimings.length;++i)t+=this.queryTimings[i];this.averageQueryTime=t/this.queryTimings.length},e.prototype.onDrawEnd=function(e){e&&this.activeTimerQuery&&(e.endQueryEXT(e.TIME_ELAPSED_EXT,this.activeTimerQuery),this.pendingQueries.push(this.activeTimerQuery),this.activeTimerQuery=null)},e.prototype.addTiming=function(e){this.timings.push(e),this.timings.length>5&&this.timings.shift();for(var t=0,i=0;i<this.timings.length;++i)t+=this.timings[i];this.averageTime=t/this.timings.length,this.framesSinceTiming=0,++this.timingCount},e}();t.TimingDetails=a,function(e){e[e.ADJUSTING_CAMERA=0]="ADJUSTING_CAMERA",e[e.MANIPULATING=1]="MANIPULATING",e[e.SYSTEM_ANIMATION=2]="SYSTEM_ANIMATION"}(s=t.InteractionTypes||(t.InteractionTypes={}));var c=function(){function e(e){this.viewer=e,this.timingFrameType=null,this.frameTimeStart=0,this.drawLoopStart=0,this.frameTimings=[],this.frameDetails={},this.drawLoopDetails={},this.interactionTimeouts={},(0,r.viewerCheck)(e),this.frameDetails[n.FrameType.INTERACTIVE]=new a,this.drawLoopDetails[n.FrameType.INTERACTIVE]=new a,this.disjointTimer=this.viewer.getExtension("EXT_disjoint_timer_query")}return e.prototype.resetTimings=function(){this.frameDetails[n.FrameType.INTERACTIVE].reset(),this.drawLoopDetails[n.FrameType.INTERACTIVE].reset()},e.prototype.onContextLost=function(){Object.values(this.frameDetails).forEach((function(e){e.onContextLost()})),this.disjointTimer=null},e.prototype.onContextRestored=function(){this.disjointTimer=this.viewer.getExtension("EXT_disjoint_timer_query")},e.prototype.getAverageFrameRate=function(e){return o(this.frameDetails[e].averageTime)},e.prototype.getAverageQueryFrameRate=function(e){return this.disjointTimer?o(this.frameDetails[e].averageQueryTime):null},e.prototype.getTimingDetails=function(e){return this.frameDetails[e]},e.prototype.getDrawLoopDetails=function(e){return this.drawLoopDetails[e]},e.prototype.onDrawStart=function(){var e=this.getCurrentFrameType(),t=this.frameDetails[e];if(t){t.onDrawStart(this.disjointTimer,this.viewer.getGlContext());var i=(0,r.getTimeInMilliseconds)();this.drawLoopStart=i,this.timingFrameType===e?(this.frameTimings.push(i-this.frameTimeStart),this.frameTimings.length<2?(this.frameTimeStart=i,this.viewer.forceRequestDraw()):(t.addTiming(Math.max(this.frameTimings[0],this.frameTimings[1])),this.timingFrameType=null)):(t.framesSinceTiming++,t.framesSinceTiming>=t.timingFrequency&&(this.frameTimeStart=i,this.timingFrameType=e,this.frameTimings=[],this.viewer.forceRequestDraw()))}},e.prototype.onDrawEnd=function(){var e=this.getCurrentFrameType(),t=this.frameDetails[e];t&&t.onDrawEnd(this.disjointTimer);var i=this.drawLoopDetails[e];if(i){var n=(0,r.getTimeInMilliseconds)();i.addTiming(n-this.drawLoopStart)}},e.prototype.setUserIsInteractingWithTimeout=function(e){var t=this;this.interactionTimeouts[e]&&window.clearTimeout(this.interactionTimeouts[e]);this.interactionTimeouts[e]=window.setTimeout((function(){delete t.interactionTimeouts[e],t.viewer.requestDraw()}),500)},e.prototype.resetInteractionStatus=function(){Object.values(this.interactionTimeouts).forEach((function(e){window.clearTimeout(e)}),this),this.interactionTimeouts={}},e.prototype.setUserIsAdjustingCamera=function(){this.setUserIsInteractingWithTimeout(s.ADJUSTING_CAMERA)},e.prototype.setUserIsManipulatingWithTimeout=function(){this.setUserIsInteractingWithTimeout(s.MANIPULATING)},e.prototype.setSystemIsAnimating=function(){this.setUserIsInteractingWithTimeout(s.SYSTEM_ANIMATION)},e.prototype.userIsInteracting=function(){for(var e in this.interactionTimeouts)if(this.interactionTimeouts[e])return!0;return!1},e.prototype.userIsManipulating=function(){return!!this.interactionTimeouts[s.MANIPULATING]},e.prototype.getCurrentFrameType=function(){return this.userIsManipulating()?n.FrameType.MANIPULATING:this.userIsInteracting()?n.FrameType.INTERACTIVE:n.FrameType.FULL},e}();t.FrameTimer=c},976613:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeHighlightFromList=t.addHighlightToList=t.HighlightManager=t.ReferenceHighlights=t.sortHighlights=t.fillHighlightWithDefault=t.highlightsEqual=t.Highlight=t.HighlightFlag=t.HighlightPriority=void 0;var r,n,o=i(73055),s=i(194598),a=i(311517),c=i(441716),l=i(556329),u=i(620968),h=i(311611);!function(e){e[e.OPERATION_PERSISTENT=0]="OPERATION_PERSISTENT",e[e.UI=1]="UI",e[e.FILTERED_ENTITIES=2]="FILTERED_ENTITIES",e[e.ACCUMULATED_SMART_SELECTION=3]="ACCUMULATED_SMART_SELECTION",e[e.SMART_SELECTION=4]="SMART_SELECTION",e[e.INCONTEXT_REFERENCE_PRE=5]="INCONTEXT_REFERENCE_PRE",e[e.ASSOCIATED_OCCURRENCE_PRE=6]="ASSOCIATED_OCCURRENCE_PRE",e[e.OCCURRENCE_SECONDARY_PRE=7]="OCCURRENCE_SECONDARY_PRE",e[e.PRE=8]="PRE",e[e.OCCURRENCE_PRE=9]="OCCURRENCE_PRE",e[e.COMMENT=10]="COMMENT",e[e.INCONTEXT_REFERENCE=11]="INCONTEXT_REFERENCE",e[e.OCCURRENCE_COMMENT=12]="OCCURRENCE_COMMENT",e[e.UI_RELATED_ENTITY=13]="UI_RELATED_ENTITY",e[e.ASSOCIATED_OCCURRENCE=14]="ASSOCIATED_OCCURRENCE",e[e.RELATED_OCCURRENCE=15]="RELATED_OCCURRENCE",e[e.OCCURRENCE=16]="OCCURRENCE",e[e.PART=17]="PART",e[e.FEATURE=18]="FEATURE",e[e.ENTITY=19]="ENTITY",e[e.ERROR=20]="ERROR",e[e.SECONDARY_PRE=21]="SECONDARY_PRE",e[e.SECONDARY=22]="SECONDARY",e[e.RETRIEVAL=23]="RETRIEVAL"}(r=t.HighlightPriority||(t.HighlightPriority={})),function(e){e[e.NO_HIGHLIGHT=0]="NO_HIGHLIGHT",e[e.HIGHLIGHT=1]="HIGHLIGHT",e[e.SUPPRESS_INTERIOR=2]="SUPPRESS_INTERIOR"}(n=t.HighlightFlag||(t.HighlightFlag={}));var d=function(){function e(e,t,i,r,o,s){this.type=e,this.priority=t,this.color1=[0,0,0,0],this.colorBorder=[0,0,0,0],this.indexInstanceIdColor=[0,0,0,n.HIGHLIGHT/255],this.style=null,this.index=0,this.idString="",this.debugStack=null,this.usage=h.bt_graphics_Usage.BASE,this.associatedPrimaryHighlightType=s||null,this.outlineOverlappingInteriorRegions=this.type===u.HighlightType.ENTITY||this.type===u.HighlightType.SMART_SELECTION||this.type===u.HighlightType.ACCUMULATED_SMART_SELECTION,this.forOccurrences=this.type===u.HighlightType.OCCURRENCE||this.type===u.HighlightType.OCCURRENCE_PRE||this.type===u.HighlightType.OCCURRENCE_COMMENT||this.type===u.HighlightType.OCCURRENCE_SECONDARY_PRE||this.type===u.HighlightType.RELATED_OCCURRENCE||this.type===u.HighlightType.RELATED_OCCURRENCE_MATE||this.type===u.HighlightType.ASSOCIATED_OCCURRENCE||this.type===u.HighlightType.ASSOCIATED_OCCURRENCE_PRE||this.type===u.HighlightType.RETRIEVAL||this.type===u.HighlightType.OPERATION_PERSISTENT,this.updateColors(),void 0!==i&&this.setIndex(i),this.instanceId=h.INVALID_ID,void 0!==r&&this.setInstanceId(r),this.occurrence=o}return e.prototype.updateColors=function(e){var t=o.default.getManager();if(this.color1=t.getColor(this.type+"_HIGHLIGHT_COLOR1"),this.colorBorder=t.getColor(this.type+"_HIGHLIGHT_COLOR_BORDER"),e)for(var i=0;i<3;i++)this.color1[i]=e[i],this.colorBorder[i]=e[i]},e.prototype.getIdString=function(){return this.idString},e.prototype.cloneForOccurrence=function(t){return new e(this.type,this.priority,this.index,this.instanceId,t,this.associatedPrimaryHighlightType)},e.prototype.cloneForInstance=function(t){return new e(this.type,this.priority,this.index,t,this.occurrence,this.associatedPrimaryHighlightType)},e.prototype.setIndex=function(e){this.index=e,this.updateIndexInstanceColor()},e.prototype.setInstanceId=function(e){this.instanceId=e,this.idString=this.type+"."+this.instanceId,this.updateIndexInstanceColor()},e.prototype.getInstanceNumber=function(){return(0,h.idIsValid)(this.instanceId)?Math.max(255&this.instanceId[0],1):0},e.prototype.updateIndexInstanceColor=function(){this.indexInstanceIdColor[0]=(255&this.index)/255;var e=this.getInstanceNumber();this.indexInstanceIdColor[1]=(e>>>4&15)/255,this.indexInstanceIdColor[2]=(15&e)/255},e.prototype.getStyle=function(){return this.style||(this.style=new h.Style,this.style.setAttribute(h.Attributes.HIGHLIGHT_ID,this.indexInstanceIdColor)),this.style},e.prototype.getIndexInstanceEncodedInFloat=function(){return this.index+256*this.getInstanceNumber()},e}();function p(e,t){return e.type===t.type&&e.instanceId===t.instanceId&&e.associatedPrimaryHighlightType===t.associatedPrimaryHighlightType&&(0,c.occurrencesEqual)(e.occurrence,t.occurrence)}function g(e){e[u.HighlightType.UI]=new d(u.HighlightType.UI,r.UI),e[u.HighlightType.RELATED_OCCURRENCE]=new d(u.HighlightType.RELATED_OCCURRENCE,r.RELATED_OCCURRENCE),e[u.HighlightType.RELATED_OCCURRENCE_MATE]=new d(u.HighlightType.RELATED_OCCURRENCE_MATE,r.RELATED_OCCURRENCE),e[u.HighlightType.ACCUMULATED_SMART_SELECTION]=new d(u.HighlightType.ACCUMULATED_SMART_SELECTION,r.ACCUMULATED_SMART_SELECTION),e[u.HighlightType.SMART_SELECTION]=new d(u.HighlightType.SMART_SELECTION,r.SMART_SELECTION),e[u.HighlightType.UI_RELATED_ENTITY]=new d(u.HighlightType.UI_RELATED_ENTITY,r.ENTITY),e[u.HighlightType.ENTITY]=new d(u.HighlightType.ENTITY,r.ENTITY),e[u.HighlightType.FEATURE]=new d(u.HighlightType.FEATURE,r.FEATURE),e[u.HighlightType.PART]=new d(u.HighlightType.PART,r.PART),e[u.HighlightType.OCCURRENCE]=new d(u.HighlightType.OCCURRENCE,r.OCCURRENCE),e[u.HighlightType.OCCURRENCE_PRE]=new d(u.HighlightType.OCCURRENCE_PRE,r.OCCURRENCE_PRE),e[u.HighlightType.PRE]=new d(u.HighlightType.PRE,r.PRE),e[u.HighlightType.SECONDARY]=new d(u.HighlightType.SECONDARY,r.SECONDARY),e[u.HighlightType.SECONDARY_PRE]=new d(u.HighlightType.SECONDARY_PRE,r.SECONDARY_PRE),e[u.HighlightType.OCCURRENCE_SECONDARY_PRE]=new d(u.HighlightType.OCCURRENCE_SECONDARY_PRE,r.OCCURRENCE_SECONDARY_PRE),e[u.HighlightType.COMMENT]=new d(u.HighlightType.COMMENT,r.COMMENT),e[u.HighlightType.FILTERED_ENTITIES]=new d(u.HighlightType.FILTERED_ENTITIES,r.FILTERED_ENTITIES),e[u.HighlightType.OCCURRENCE_COMMENT]=new d(u.HighlightType.OCCURRENCE_COMMENT,r.OCCURRENCE_COMMENT),e[u.HighlightType.ASSOCIATED_OCCURRENCE]=new d(u.HighlightType.ASSOCIATED_OCCURRENCE,r.ASSOCIATED_OCCURRENCE),e[u.HighlightType.ASSOCIATED_OCCURRENCE_PRE]=new d(u.HighlightType.ASSOCIATED_OCCURRENCE_PRE,r.ASSOCIATED_OCCURRENCE_PRE),e[u.HighlightType.ERROR]=new d(u.HighlightType.ERROR,r.ERROR),e[u.HighlightType.INCONTEXT_REFERENCE]=new d(u.HighlightType.INCONTEXT_REFERENCE,r.INCONTEXT_REFERENCE),e[u.HighlightType.INCONTEXT_REFERENCE_PRE]=new d(u.HighlightType.INCONTEXT_REFERENCE_PRE,r.INCONTEXT_REFERENCE_PRE),e[u.HighlightType.RETRIEVAL]=new d(u.HighlightType.RETRIEVAL,r.RETRIEVAL),e[u.HighlightType.OPERATION_PERSISTENT]=new d(u.HighlightType.OPERATION_PERSISTENT,r.OPERATION_PERSISTENT)}function f(e,t){for(var i in e)t.push(e[i]);t.sort((function(e,t){return e.priority>t.priority?1:e.priority<t.priority?-1:0}));for(var r=0;r<t.length;++r)t[r].setIndex(r)}t.Highlight=d,t.highlightsEqual=p,t.fillHighlightWithDefault=g,t.sortHighlights=f;var m=function(){function e(e){this.viewer=e,this.highlights={},this.sortedHighlights=[],(0,h.viewerCheck)(e),g(this.highlights),f(this.highlights,this.sortedHighlights)}return e.prototype.getSortedHighlights=function(){return this.sortedHighlights},e.prototype.getHighlightTextureWidth=function(){return this.sortedHighlights.length},e.prototype.updateHighlightColor=function(e,t){this.highlights[e].updateColors(t),this.viewer.getResources().invalidateHighlightTexture()},e.prototype.destroy=function(){this.highlights={},this.sortedHighlights=[]},e}();t.ReferenceHighlights=m;var y=function(){function e(e){for(var t in this.referenceHighlights=e,this.highlightInstanceIdManagers={},this.highlightToSelectionToInstanceId={},this.highlightToSelectionToDebugInfo={},this.loggedPrehighlightIssue=!1,this.usage=h.bt_graphics_Usage.BASE,u.HighlightType)this.highlightInstanceIdManagers[t]=new h.IdManager(h.IdSizes.HIGHLIGHT),this.highlightToSelectionToInstanceId[t]={},this.highlightToSelectionToDebugInfo[t]={};this.debugModeEnabled=s.btInjector.CapabilitiesService.checkClientHighlightDebuggingCurrentlyEnabled()}return e.prototype.getInstanceIdForHighlightAndSelection=function(e,t){var i=this.highlightToSelectionToInstanceId[e][t];return i||h.INVALID_ID},e.prototype.constructHighlightForTypeAndInstance=function(e,t,i){void 0===i&&(i=!1);var r=this.referenceHighlights.highlights[e].cloneForInstance(t);(r.usage=this.usage,this.debugModeEnabled&&(r.debugStack=(new Error).stack),i)&&((255*r.indexInstanceIdColor[3]&n.SUPPRESS_INTERIOR)>0||(r.indexInstanceIdColor[3]+=n.SUPPRESS_INTERIOR/255));return r},e.prototype.createHighlightForSelection=function(e,t,i){if(void 0===i&&(i=!1),!this.referenceHighlights)return new d(u.HighlightType.ERROR,r.ERROR);var n=this.getInstanceIdForHighlightAndSelection(e,t);return(0,h.idIsValid)(n)||(this.debugModeEnabled&&!this.loggedPrehighlightIssue&&(e!==u.HighlightType.PRE&&e!==u.HighlightType.OCCURRENCE_PRE||Object.keys(this.highlightToSelectionToInstanceId[e]).length>=1&&(a.log.warn("Multiple pre-highlights occurred for type "+e+". Existing highlight details:\n"+JSON.stringify(this.highlightToSelectionToDebugInfo[e])+"\n\nStack:\n"+(new Error).stack),this.loggedPrehighlightIssue=!0)),n=this.highlightInstanceIdManagers[e].getId(),this.highlightToSelectionToInstanceId[e][t]=n,this.debugModeEnabled&&(this.highlightToSelectionToDebugInfo[e][t]={stack:(new Error).stack})),this.constructHighlightForTypeAndInstance(e,n,i)},e.prototype.freeHighlightForSelection=function(e,t){var i=this.getInstanceIdForHighlightAndSelection(e,t);return(0,h.idIsValid)(i)&&(this.highlightInstanceIdManagers[e].freeId(i),delete this.highlightToSelectionToInstanceId[e][t],delete this.highlightToSelectionToDebugInfo[e][t]),i},e.prototype.createSecondaryHighlight=function(e,t,i){var r=this.createHighlightForSelection(e,i+l.ID_SEPARATOR+t);return r.associatedPrimaryHighlightType=t,r},e.prototype.freeSecondaryHighlight=function(e,t,i){this.freeHighlightForSelection(e,i+l.ID_SEPARATOR+t)},e.prototype.resetHighlightInstanceIds=function(e){this.highlightInstanceIdManagers[e].reset(),this.highlightToSelectionToInstanceId[e]={},this.highlightToSelectionToDebugInfo[e]={}},e.prototype.highlightHasSelections=function(e){return!(0,h.isMapEmpty)(this.highlightToSelectionToInstanceId[e])},e.prototype.getHighlightDebugInfo=function(){return this.highlightToSelectionToDebugInfo},e}();t.HighlightManager=y,t.addHighlightToList=function(e,t){for(var i=0,r=0;r<t.length;++r){if(p(t[r],e))return-1;if(e.priority<t[r].priority)break;++i}return t.splice(i,0,e),i},t.removeHighlightFromList=function(e,t,i){for(var r=-1,n=0;n<t.length;++n)if(i&&e.type===t[n].type||p(t[n],e)){r=n;break}return r<0||t.splice(r,1),r}},486286:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDisplay=void 0;var r=i(423902),n=i(73055),o=i(712197),s=i(103726),a=i(311611),c=n.default.getManager(),l="image",u=function(e){function t(t,i,r,n,o,c,u,h,d,p,g){var f=e.call(this,h,u===a.bt_graphics_Usage.PREVIEW?a.PREVIEW_SCENEGRAPH_ID:void 0)||this;return f.sketchEntityId=t,f.bottomLeftCorner=r,f.bottomRightCorner=n,f.topLeftCorner=o,f.texture=c,f.usage=u,f.isOnFlat=d,f.flattenedBodyId=p,f.transform=g,f.ownsTexture=!1,f.material=null,f.isActive=!1,f.id="image",f.url=(0,s.updateUriWithWorkspaceId)(i),f.listenTo(f,a.UiEvents.CLICK+l,f.onClick),f.updateImage(i,r,n,o),f}return(0,r.__extends)(t,e),t.prototype.getSource=function(){return{documentId:(0,s.getUriComponent)(this.url,"/d/"),elementId:(0,s.getUriComponent)(this.url,"/e/"),documentVersionId:(0,s.getUriComponent)(this.url,"/v/")}},t.prototype.updateImage=function(e,t,i,r){var n=this.viewer.getGlContext(),o=(0,s.updateUriWithWorkspaceId)(e);if(o||(o=this.url),this.url=o,this.bottomLeftCorner=t,this.bottomRightCorner=i,this.topLeftCorner=r,o){if(n){if(this.texture&&this.url!==o&&(this.texture.destroy(),this.texture=null,this.material&&(this.material.destroy(),this.material=null)),!this.texture){var u=new a.TextureDefinition(n);u.imageSource=o,u.minificationFilter=n.LINEAR,u.magnificationFilter=n.LINEAR,u.defersRendering=!0,this.texture=new a.Texture(this.viewer,u),this.ownsTexture=!0}this.material||(this.material=(0,a.createTextureMaterial)(this.texture));var h=new a.NodeProperties({primitiveType:a.PrimitiveType.TRIANGLES,isPickable:this.isActive,isDepthTested:!1,isTwoSided:!0,includedInBlend:!0,material:this.material}),d=(0,a.createQuad)(this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner,void 0,[0,1],[1,0]).createTransformed(this.transform),p=this.isActive?c.getNumber("SKETCH_IMAGE_ACTIVE_OPACITY"):c.getNumber("SKETCH_IMAGE_INACTIVE_OPACITY");(0,a.addColorToIncrement)([1,1,1,p],d),this.updateMeshIncrement(l,l,d,h),this.isHidden&&this.hideIncrements()}}else this.removeMeshIncrement("image")},t.prototype.remove=function(){this.texture&&this.ownsTexture&&(this.texture.destroy(),this.texture=null,this.ownsTexture=!1),this.material&&(this.material.destroy(),this.material=null),e.prototype.remove.call(this)},t.prototype.getUsage=function(){return this.usage},t.prototype.onClick=function(){(0,o.clearSelection)()},t.prototype.getPickPriority=function(e){return a.PickPriority.SKETCH_FACE},t.prototype.cloneForPreview=function(){var e=new t(this.sketchEntityId,this.url,this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner,this.texture,a.bt_graphics_Usage.PREVIEW,this.viewer,this.isOnFlat,this.flattenedBodyId,this.transform);return this.isHidden&&e.hide(),this.isActive&&e.activate(),e},t.prototype.activate=function(){this.isActive=!0,this.updateImage(this.url,this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner)},t.prototype.deactivate=function(){this.isActive=!1,this.updateImage(this.url,this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner)},t.prototype.preventsSketching=function(){return!1},t}(a.UIElement);t.ImageDisplay=u},591286:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Id=t.IdManager=t.INVALID_OCCURRENCE_ID=t.HUD_MODEL_SCENEGRAPH_ID=t.HighlightType=t.GraphicsRefinementMode=t.GRAPHICS_HANDLED_CLICK_EVENT=t.GL_CONTEXT_RESTORED=t.GL_CONTEXT_LOST=t.FrameType=t.EventData=t.ELEMENT_VIEW_INITIALIZED=t.ELEMENT_PREVIEW_GRAPHICS_LOADED=t.ELEMENT_GRAPHICS_LOADING=t.DISPLAYED_PART_STUDIO=t.DIMENSION_VALUE_CHANGED=t.DIMENSION_TEXT_SINGLE_CLICKED=t.DIMENSION_TEXT_DOUBLE_CLICKED=t.DIMENSION_EDIT_CLOSED=t.DIMENSION_DELETE_REQUEST=t.DID_RENDER_THUMBNAILS=t.DEVICE_PIXEL_RATIO_CHANGED=t.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER=t.DEFAULT_UNITS_CHANGED=t.DEFAULT_PREVIEW_OPACITY=t.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER=t.CLOSE_SKETCH_SUB_DIALOG=t.CLOSE_SELECT_OTHER=t.CLOSE_MATE_DOF_CHOOSER=t.CLOSE_DIMENSION_EDIT=t.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES=t.CHANGE_VIEW=t.CHANGE_FEATURE_APPEARANCE=t.CANVAS_MOUSEMOVE=t.CANVAS_MOUSELEAVE=t.CANVAS_CLICK=t.BODY_UNLOADED=t.AnimationCallbackStatus=t.Action=t.ASSEMBLY_DATA_PROCESSED=t.ASSEMBLY_ANIMATE_MATE_STARTED=t.ASSEMBLY_ANIMATE_MATE_ENDED=t.ADD_TEMPORARY_TESSELLATION_OVERRIDES=t.ACTIVE_VIEWER_SET=t.ACTIVE_SHEETMETAL_MODEL_CHANGED=t.bt_graphics_Usage=t.bt_graphics_ISectionPlane=t.bt_graphics_IDistanceDisplay=t.bt_graphics_IAngleDisplay=t.btTs=void 0,t.ExplodeLine=t.EntityData=t.DEFAULT_SIMULATION_COLOR_MAPPING=t.CursorAppendage=t.viewerCheck=t.userWebPreferencesGetManager=t.resetUsage=t.OccurrenceId=t.NamedIdManager=t.isUsagePreview=t.isUsageCompare=t.isUsageBase=t.idIsValid=t.idsEqual=t.getObservableFromActiveViewerForEvent=t.getFocusedViewer=t.getEditState=t.getActiveViewerModelViewManagers=t.getActiveViewerEventDispatcher=t.getActiveViewer=t.enableSectionPlaneSelection=t.disableSectionPlaneSelection=t.WILL_RENDER_THUMBNAILS=t.VIEW_WILL_DRAW=t.VIEW_DID_DRAW=t.VIEW_CONTAINER_MENU_INVOKED=t.VIEWER_CANVAS_ATTACHED_TO_CONTAINER=t.UPDATE_INCONTEXT_ISOLATION=t.SPACEMOUSE_COMMANDS_RECEIVED=t.SKETCH_COMMAND_ACTIVATED=t.SHOW_SMART_SELECTION=t.SHOW_SKETCH_TEXT=t.SELECT_OTHER_REVERSE=t.SELECT_OTHER=t.SELECTION_REJECTED=t.SECTION_VIEW_DIALOG_OPENED=t.SECTION_VIEW_DIALOG_CLOSED=t.SECTIONPLANE_SELECTION_ID=t.SECTION_PLANE_REMOVED=t.SECTION_PLANE_ADDED=t.RETRIEVE_SMOOTH_EDGE_INFORMATION=t.RETRIEVE_OCCURRENCE_DISPLAY_DATA=t.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED=t.NEW_PART_LIST=t.ManipulationMode=t.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED=t.MAIN_SCENEGRAPH_ID=t.INVALID_ID=t.IntersectionType=t.IdSizes=void 0,t.getPerpendicularBisector2d=t.getPartThumbnailKey=t.getPartStudioThumbnailKey=t.getOrCreateViewerSet=t.getMouseSettingsManager=t.getMostRecentActiveSectionPlaneParameters=t.getMaxSectionPlanes=t.getHasFeatureQLVFacePatternCapability=t.getFeatureThumbnailKey=t.getDrawers=t.getDrawer=t.getDefaultNameForBody=t.getCurrentSectionPlaneParameters=t.getCounters=t.getColorStringArray=t.getAngle=t.getActiveViewerSketch=t.getActiveSectionPlane=t.forEachActiveSectionPlane=t.distanceSquaredToLineSegment2d=t.distanceSquaredBetweenPoints=t.displayEntity=t.deselectEntities=t.createTestViewer=t.createPolyline=t.createInferenceIcon=t.createDimensionForDisplayData=t.createCirclePolyline=t.createArcPolyline=t.clearSavedSectionPlaneParameters=t.cacheCapabilities=t.areAnySectionPlanesSelectedOrPreselected=t.areMatricesEqual=t.are2dPointsEqual=t.angleBetweenVectors=t.addStyleToIncrement=t.ViewerSet=t.View=t.UiEvents=t.UISelection=t.UIElement=t.Text=t.TemporarySketchComponent=t.StandardViews=t.SplineHandle=t.SketchPlaneDisplay=t.Sketch=t.ExplodeLineLineSegment=t.ExplodeLineArcSegment=t.ExplodeLineDefinition=void 0,t.basicPickSort=t.unprojectVectorToWorld=t.unprojectPlaneToWorld=t.toggleZoomModifierEnabled=t.timeRendering=t.tessellateArc=t.snapshotScenegraph=t.setZoomModeEnabled=t.setTransparencyTransition=t.setThumbnailForKey=t.setShowDimensionsMode=t.setSectionPlaneOnMatrix=t.setSectionPlaneOnMateConnector=t.setIsInSectionPlaneMode=t.setIsInFollowMode=t.setInteractionEnabled=t.setFromSerializableSectionViewData=t.setFromSerializablePlaneData=t.setForceHideInteriorSelections=t.setDimensionToolActive=t.setBoxSelectionEnabled=t.collectGraphicsDataForHeapDump=t.requestDraw=t.removeSectionPlanes=t.removeSectionPlane=t.removeGraphicsViewers=t.projectToLine=t.preserveViewersForDocumentId=t.loadSectionPlanesFromParameters=t.isSectionPlaneModeEnabled=t.isRendererStringForIntel=t.IsolatedOccurrencesManager=t.isMapEmpty=t.isInSectionPlaneMode=t.intersectTwoLines2d=t.intersectTwoLineSegments2d=t.intersectLineSegmentRay=t.GlRendererInfo=t.graphicsTakesSelectionPrecedence=t.getZoomToWindowState=t.getUnavailableRendererInfo=t.getTimeInMilliseconds=t.getThumbnailForKey=t.getSerializableSectionViewData=t.getSerializablePlaneData=t.getSectionPlaneCount=t.getSectionedItemsSize=t.getRendererInfo=t.getPointAtAngle=t.getPlaneIndexToAlignNormalTo=void 0;var r=i(736202),n=i(341);t.btTs=(0,r.merge)({},n.btTs);var o=i(623639);Object.defineProperty(t,"bt_graphics_IAngleDisplay",{enumerable:!0,get:function(){return o.bt_graphics_IAngleDisplay}}),Object.defineProperty(t,"bt_graphics_IDistanceDisplay",{enumerable:!0,get:function(){return o.bt_graphics_IDistanceDisplay}}),Object.defineProperty(t,"bt_graphics_ISectionPlane",{enumerable:!0,get:function(){return o.bt_graphics_ISectionPlane}}),Object.defineProperty(t,"bt_graphics_Usage",{enumerable:!0,get:function(){return o.bt_graphics_Usage}}),Object.defineProperty(t,"ACTIVE_SHEETMETAL_MODEL_CHANGED",{enumerable:!0,get:function(){return o.ACTIVE_SHEETMETAL_MODEL_CHANGED}}),Object.defineProperty(t,"ACTIVE_VIEWER_SET",{enumerable:!0,get:function(){return o.ACTIVE_VIEWER_SET}}),Object.defineProperty(t,"ADD_TEMPORARY_TESSELLATION_OVERRIDES",{enumerable:!0,get:function(){return o.ADD_TEMPORARY_TESSELLATION_OVERRIDES}}),Object.defineProperty(t,"ASSEMBLY_ANIMATE_MATE_ENDED",{enumerable:!0,get:function(){return o.ASSEMBLY_ANIMATE_MATE_ENDED}}),Object.defineProperty(t,"ASSEMBLY_ANIMATE_MATE_STARTED",{enumerable:!0,get:function(){return o.ASSEMBLY_ANIMATE_MATE_STARTED}}),Object.defineProperty(t,"ASSEMBLY_DATA_PROCESSED",{enumerable:!0,get:function(){return o.ASSEMBLY_DATA_PROCESSED}}),Object.defineProperty(t,"Action",{enumerable:!0,get:function(){return o.Action}}),Object.defineProperty(t,"AnimationCallbackStatus",{enumerable:!0,get:function(){return o.AnimationCallbackStatus}}),Object.defineProperty(t,"BODY_UNLOADED",{enumerable:!0,get:function(){return o.BODY_UNLOADED}}),Object.defineProperty(t,"CANVAS_CLICK",{enumerable:!0,get:function(){return o.CANVAS_CLICK}}),Object.defineProperty(t,"CANVAS_MOUSELEAVE",{enumerable:!0,get:function(){return o.CANVAS_MOUSELEAVE}}),Object.defineProperty(t,"CANVAS_MOUSEMOVE",{enumerable:!0,get:function(){return o.CANVAS_MOUSEMOVE}}),Object.defineProperty(t,"CHANGE_FEATURE_APPEARANCE",{enumerable:!0,get:function(){return o.CHANGE_FEATURE_APPEARANCE}}),Object.defineProperty(t,"CHANGE_VIEW",{enumerable:!0,get:function(){return o.CHANGE_VIEW}}),Object.defineProperty(t,"CLEAR_TEMPORARY_TESSELLATION_OVERRIDES",{enumerable:!0,get:function(){return o.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES}}),Object.defineProperty(t,"CLOSE_DIMENSION_EDIT",{enumerable:!0,get:function(){return o.CLOSE_DIMENSION_EDIT}}),Object.defineProperty(t,"CLOSE_MATE_DOF_CHOOSER",{enumerable:!0,get:function(){return o.CLOSE_MATE_DOF_CHOOSER}}),Object.defineProperty(t,"CLOSE_SELECT_OTHER",{enumerable:!0,get:function(){return o.CLOSE_SELECT_OTHER}}),Object.defineProperty(t,"CLOSE_SKETCH_SUB_DIALOG",{enumerable:!0,get:function(){return o.CLOSE_SKETCH_SUB_DIALOG}}),Object.defineProperty(t,"CREATE_SECTION_PLANE_INFERENCE_CONTROLLER",{enumerable:!0,get:function(){return o.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER}}),Object.defineProperty(t,"DEFAULT_PREVIEW_OPACITY",{enumerable:!0,get:function(){return o.DEFAULT_PREVIEW_OPACITY}}),Object.defineProperty(t,"DEFAULT_UNITS_CHANGED",{enumerable:!0,get:function(){return o.DEFAULT_UNITS_CHANGED}}),Object.defineProperty(t,"DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER",{enumerable:!0,get:function(){return o.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER}}),Object.defineProperty(t,"DEVICE_PIXEL_RATIO_CHANGED",{enumerable:!0,get:function(){return o.DEVICE_PIXEL_RATIO_CHANGED}}),Object.defineProperty(t,"DID_RENDER_THUMBNAILS",{enumerable:!0,get:function(){return o.DID_RENDER_THUMBNAILS}}),Object.defineProperty(t,"DIMENSION_DELETE_REQUEST",{enumerable:!0,get:function(){return o.DIMENSION_DELETE_REQUEST}}),Object.defineProperty(t,"DIMENSION_EDIT_CLOSED",{enumerable:!0,get:function(){return o.DIMENSION_EDIT_CLOSED}}),Object.defineProperty(t,"DIMENSION_TEXT_DOUBLE_CLICKED",{enumerable:!0,get:function(){return o.DIMENSION_TEXT_DOUBLE_CLICKED}}),Object.defineProperty(t,"DIMENSION_TEXT_SINGLE_CLICKED",{enumerable:!0,get:function(){return o.DIMENSION_TEXT_SINGLE_CLICKED}}),Object.defineProperty(t,"DIMENSION_VALUE_CHANGED",{enumerable:!0,get:function(){return o.DIMENSION_VALUE_CHANGED}}),Object.defineProperty(t,"DISPLAYED_PART_STUDIO",{enumerable:!0,get:function(){return o.DISPLAYED_PART_STUDIO}}),Object.defineProperty(t,"ELEMENT_GRAPHICS_LOADING",{enumerable:!0,get:function(){return o.ELEMENT_GRAPHICS_LOADING}}),Object.defineProperty(t,"ELEMENT_PREVIEW_GRAPHICS_LOADED",{enumerable:!0,get:function(){return o.ELEMENT_PREVIEW_GRAPHICS_LOADED}}),Object.defineProperty(t,"ELEMENT_VIEW_INITIALIZED",{enumerable:!0,get:function(){return o.ELEMENT_VIEW_INITIALIZED}}),Object.defineProperty(t,"EventData",{enumerable:!0,get:function(){return o.EventData}}),Object.defineProperty(t,"FrameType",{enumerable:!0,get:function(){return o.FrameType}}),Object.defineProperty(t,"GL_CONTEXT_LOST",{enumerable:!0,get:function(){return o.GL_CONTEXT_LOST}}),Object.defineProperty(t,"GL_CONTEXT_RESTORED",{enumerable:!0,get:function(){return o.GL_CONTEXT_RESTORED}}),Object.defineProperty(t,"GRAPHICS_HANDLED_CLICK_EVENT",{enumerable:!0,get:function(){return o.GRAPHICS_HANDLED_CLICK_EVENT}}),Object.defineProperty(t,"GraphicsRefinementMode",{enumerable:!0,get:function(){return o.GraphicsRefinementMode}}),Object.defineProperty(t,"HighlightType",{enumerable:!0,get:function(){return o.HighlightType}}),Object.defineProperty(t,"HUD_MODEL_SCENEGRAPH_ID",{enumerable:!0,get:function(){return o.HUD_MODEL_SCENEGRAPH_ID}}),Object.defineProperty(t,"INVALID_OCCURRENCE_ID",{enumerable:!0,get:function(){return o.INVALID_OCCURRENCE_ID}}),Object.defineProperty(t,"IdManager",{enumerable:!0,get:function(){return o.IdManager}}),Object.defineProperty(t,"Id",{enumerable:!0,get:function(){return o.Id}}),Object.defineProperty(t,"IdSizes",{enumerable:!0,get:function(){return o.IdSizes}}),Object.defineProperty(t,"IntersectionType",{enumerable:!0,get:function(){return o.IntersectionType}}),Object.defineProperty(t,"INVALID_ID",{enumerable:!0,get:function(){return o.INVALID_ID}}),Object.defineProperty(t,"MAIN_SCENEGRAPH_ID",{enumerable:!0,get:function(){return o.MAIN_SCENEGRAPH_ID}}),Object.defineProperty(t,"MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED",{enumerable:!0,get:function(){return o.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED}}),Object.defineProperty(t,"ManipulationMode",{enumerable:!0,get:function(){return o.ManipulationMode}}),Object.defineProperty(t,"NEW_PART_LIST",{enumerable:!0,get:function(){return o.NEW_PART_LIST}}),Object.defineProperty(t,"NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED",{enumerable:!0,get:function(){return o.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED}}),Object.defineProperty(t,"RETRIEVE_OCCURRENCE_DISPLAY_DATA",{enumerable:!0,get:function(){return o.RETRIEVE_OCCURRENCE_DISPLAY_DATA}}),Object.defineProperty(t,"RETRIEVE_SMOOTH_EDGE_INFORMATION",{enumerable:!0,get:function(){return o.RETRIEVE_SMOOTH_EDGE_INFORMATION}}),Object.defineProperty(t,"SECTION_PLANE_ADDED",{enumerable:!0,get:function(){return o.SECTION_PLANE_ADDED}}),Object.defineProperty(t,"SECTION_PLANE_REMOVED",{enumerable:!0,get:function(){return o.SECTION_PLANE_REMOVED}}),Object.defineProperty(t,"SECTIONPLANE_SELECTION_ID",{enumerable:!0,get:function(){return o.SECTIONPLANE_SELECTION_ID}}),Object.defineProperty(t,"SECTION_VIEW_DIALOG_CLOSED",{enumerable:!0,get:function(){return o.SECTION_VIEW_DIALOG_CLOSED}}),Object.defineProperty(t,"SECTION_VIEW_DIALOG_OPENED",{enumerable:!0,get:function(){return o.SECTION_VIEW_DIALOG_OPENED}}),Object.defineProperty(t,"SELECTION_REJECTED",{enumerable:!0,get:function(){return o.SELECTION_REJECTED}}),Object.defineProperty(t,"SELECT_OTHER",{enumerable:!0,get:function(){return o.SELECT_OTHER}}),Object.defineProperty(t,"SELECT_OTHER_REVERSE",{enumerable:!0,get:function(){return o.SELECT_OTHER_REVERSE}}),Object.defineProperty(t,"SHOW_SKETCH_TEXT",{enumerable:!0,get:function(){return o.SHOW_SKETCH_TEXT}}),Object.defineProperty(t,"SHOW_SMART_SELECTION",{enumerable:!0,get:function(){return o.SHOW_SMART_SELECTION}}),Object.defineProperty(t,"SKETCH_COMMAND_ACTIVATED",{enumerable:!0,get:function(){return o.SKETCH_COMMAND_ACTIVATED}}),Object.defineProperty(t,"SPACEMOUSE_COMMANDS_RECEIVED",{enumerable:!0,get:function(){return o.SPACEMOUSE_COMMANDS_RECEIVED}}),Object.defineProperty(t,"UPDATE_INCONTEXT_ISOLATION",{enumerable:!0,get:function(){return o.UPDATE_INCONTEXT_ISOLATION}}),Object.defineProperty(t,"VIEWER_CANVAS_ATTACHED_TO_CONTAINER",{enumerable:!0,get:function(){return o.VIEWER_CANVAS_ATTACHED_TO_CONTAINER}}),Object.defineProperty(t,"VIEW_CONTAINER_MENU_INVOKED",{enumerable:!0,get:function(){return o.VIEW_CONTAINER_MENU_INVOKED}}),Object.defineProperty(t,"VIEW_DID_DRAW",{enumerable:!0,get:function(){return o.VIEW_DID_DRAW}}),Object.defineProperty(t,"VIEW_WILL_DRAW",{enumerable:!0,get:function(){return o.VIEW_WILL_DRAW}}),Object.defineProperty(t,"WILL_RENDER_THUMBNAILS",{enumerable:!0,get:function(){return o.WILL_RENDER_THUMBNAILS}}),Object.defineProperty(t,"disableSectionPlaneSelection",{enumerable:!0,get:function(){return o.disableSectionPlaneSelection}}),Object.defineProperty(t,"enableSectionPlaneSelection",{enumerable:!0,get:function(){return o.enableSectionPlaneSelection}}),Object.defineProperty(t,"getActiveViewer",{enumerable:!0,get:function(){return o.getActiveViewer}}),Object.defineProperty(t,"getActiveViewerEventDispatcher",{enumerable:!0,get:function(){return o.getActiveViewerEventDispatcher}}),Object.defineProperty(t,"getActiveViewerModelViewManagers",{enumerable:!0,get:function(){return o.getActiveViewerModelViewManagers}}),Object.defineProperty(t,"getEditState",{enumerable:!0,get:function(){return o.getEditState}}),Object.defineProperty(t,"getFocusedViewer",{enumerable:!0,get:function(){return o.getFocusedViewer}}),Object.defineProperty(t,"getObservableFromActiveViewerForEvent",{enumerable:!0,get:function(){return o.getObservableFromActiveViewerForEvent}}),Object.defineProperty(t,"idsEqual",{enumerable:!0,get:function(){return o.idsEqual}}),Object.defineProperty(t,"idIsValid",{enumerable:!0,get:function(){return o.idIsValid}}),Object.defineProperty(t,"isUsageBase",{enumerable:!0,get:function(){return o.isUsageBase}}),Object.defineProperty(t,"isUsageCompare",{enumerable:!0,get:function(){return o.isUsageCompare}}),Object.defineProperty(t,"isUsagePreview",{enumerable:!0,get:function(){return o.isUsagePreview}}),Object.defineProperty(t,"NamedIdManager",{enumerable:!0,get:function(){return o.NamedIdManager}}),Object.defineProperty(t,"OccurrenceId",{enumerable:!0,get:function(){return o.OccurrenceId}}),Object.defineProperty(t,"resetUsage",{enumerable:!0,get:function(){return o.resetUsage}}),Object.defineProperty(t,"userWebPreferencesGetManager",{enumerable:!0,get:function(){return o.userWebPreferencesGetManager}}),Object.defineProperty(t,"viewerCheck",{enumerable:!0,get:function(){return o.viewerCheck}});var s=i(311611);Object.defineProperty(t,"CursorAppendage",{enumerable:!0,get:function(){return s.CursorAppendage}}),Object.defineProperty(t,"DEFAULT_SIMULATION_COLOR_MAPPING",{enumerable:!0,get:function(){return s.DEFAULT_SIMULATION_COLOR_MAPPING}}),Object.defineProperty(t,"EntityData",{enumerable:!0,get:function(){return s.EntityData}}),Object.defineProperty(t,"ExplodeLine",{enumerable:!0,get:function(){return s.ExplodeLine}}),Object.defineProperty(t,"ExplodeLineDefinition",{enumerable:!0,get:function(){return s.ExplodeLineDefinition}}),Object.defineProperty(t,"ExplodeLineArcSegment",{enumerable:!0,get:function(){return s.ExplodeLineArcSegment}}),Object.defineProperty(t,"ExplodeLineLineSegment",{enumerable:!0,get:function(){return s.ExplodeLineLineSegment}}),Object.defineProperty(t,"Sketch",{enumerable:!0,get:function(){return s.Sketch}}),Object.defineProperty(t,"SketchPlaneDisplay",{enumerable:!0,get:function(){return s.SketchPlaneDisplay}}),Object.defineProperty(t,"SplineHandle",{enumerable:!0,get:function(){return s.SplineHandle}}),Object.defineProperty(t,"StandardViews",{enumerable:!0,get:function(){return s.StandardViews}}),Object.defineProperty(t,"TemporarySketchComponent",{enumerable:!0,get:function(){return s.TemporarySketchComponent}}),Object.defineProperty(t,"Text",{enumerable:!0,get:function(){return s.Text}}),Object.defineProperty(t,"UIElement",{enumerable:!0,get:function(){return s.UIElement}}),Object.defineProperty(t,"UISelection",{enumerable:!0,get:function(){return s.UISelection}}),Object.defineProperty(t,"UiEvents",{enumerable:!0,get:function(){return s.UiEvents}}),Object.defineProperty(t,"View",{enumerable:!0,get:function(){return s.View}}),Object.defineProperty(t,"ViewerSet",{enumerable:!0,get:function(){return s.ViewerSet}}),Object.defineProperty(t,"addStyleToIncrement",{enumerable:!0,get:function(){return s.addStyleToIncrement}}),Object.defineProperty(t,"angleBetweenVectors",{enumerable:!0,get:function(){return s.angleBetweenVectors}}),Object.defineProperty(t,"are2dPointsEqual",{enumerable:!0,get:function(){return s.are2dPointsEqual}}),Object.defineProperty(t,"areMatricesEqual",{enumerable:!0,get:function(){return s.areMatricesEqual}}),Object.defineProperty(t,"areAnySectionPlanesSelectedOrPreselected",{enumerable:!0,get:function(){return s.areAnySectionPlanesSelectedOrPreselected}}),Object.defineProperty(t,"cacheCapabilities",{enumerable:!0,get:function(){return s.cacheCapabilities}}),Object.defineProperty(t,"clearSavedSectionPlaneParameters",{enumerable:!0,get:function(){return s.clearSavedSectionPlaneParameters}}),Object.defineProperty(t,"createArcPolyline",{enumerable:!0,get:function(){return s.createArcPolyline}}),Object.defineProperty(t,"createCirclePolyline",{enumerable:!0,get:function(){return s.createCirclePolyline}}),Object.defineProperty(t,"createDimensionForDisplayData",{enumerable:!0,get:function(){return s.createDimensionForDisplayData}}),Object.defineProperty(t,"createInferenceIcon",{enumerable:!0,get:function(){return s.createInferenceIcon}}),Object.defineProperty(t,"createPolyline",{enumerable:!0,get:function(){return s.createPolyline}}),Object.defineProperty(t,"createTestViewer",{enumerable:!0,get:function(){return s.createTestViewer}}),Object.defineProperty(t,"deselectEntities",{enumerable:!0,get:function(){return s.deselectEntities}}),Object.defineProperty(t,"displayEntity",{enumerable:!0,get:function(){return s.displayEntity}}),Object.defineProperty(t,"distanceSquaredBetweenPoints",{enumerable:!0,get:function(){return s.distanceSquaredBetweenPoints}}),Object.defineProperty(t,"distanceSquaredToLineSegment2d",{enumerable:!0,get:function(){return s.distanceSquaredToLineSegment2d}}),Object.defineProperty(t,"forEachActiveSectionPlane",{enumerable:!0,get:function(){return s.forEachActiveSectionPlane}}),Object.defineProperty(t,"getActiveSectionPlane",{enumerable:!0,get:function(){return s.getActiveSectionPlane}}),Object.defineProperty(t,"getActiveViewerSketch",{enumerable:!0,get:function(){return s.getActiveViewerSketch}}),Object.defineProperty(t,"getAngle",{enumerable:!0,get:function(){return s.getAngle}}),Object.defineProperty(t,"getColorStringArray",{enumerable:!0,get:function(){return s.getColorStringArray}}),Object.defineProperty(t,"getCounters",{enumerable:!0,get:function(){return s.getCounters}}),Object.defineProperty(t,"getCurrentSectionPlaneParameters",{enumerable:!0,get:function(){return s.getCurrentSectionPlaneParameters}}),Object.defineProperty(t,"getDefaultNameForBody",{enumerable:!0,get:function(){return s.getDefaultNameForBody}}),Object.defineProperty(t,"getDrawer",{enumerable:!0,get:function(){return s.getDrawer}}),Object.defineProperty(t,"getDrawers",{enumerable:!0,get:function(){return s.getDrawers}}),Object.defineProperty(t,"getFeatureThumbnailKey",{enumerable:!0,get:function(){return s.getFeatureThumbnailKey}}),Object.defineProperty(t,"getHasFeatureQLVFacePatternCapability",{enumerable:!0,get:function(){return s.getHasFeatureQLVFacePatternCapability}}),Object.defineProperty(t,"getMaxSectionPlanes",{enumerable:!0,get:function(){return s.getMaxSectionPlanes}}),Object.defineProperty(t,"getMostRecentActiveSectionPlaneParameters",{enumerable:!0,get:function(){return s.getMostRecentActiveSectionPlaneParameters}}),Object.defineProperty(t,"getMouseSettingsManager",{enumerable:!0,get:function(){return s.getMouseSettingsManager}}),Object.defineProperty(t,"getOrCreateViewerSet",{enumerable:!0,get:function(){return s.getOrCreateViewerSet}}),Object.defineProperty(t,"getPartStudioThumbnailKey",{enumerable:!0,get:function(){return s.getPartStudioThumbnailKey}}),Object.defineProperty(t,"getPartThumbnailKey",{enumerable:!0,get:function(){return s.getPartThumbnailKey}}),Object.defineProperty(t,"getPerpendicularBisector2d",{enumerable:!0,get:function(){return s.getPerpendicularBisector2d}}),Object.defineProperty(t,"getPlaneIndexToAlignNormalTo",{enumerable:!0,get:function(){return s.getPlaneIndexToAlignNormalTo}}),Object.defineProperty(t,"getPointAtAngle",{enumerable:!0,get:function(){return s.getPointAtAngle}}),Object.defineProperty(t,"getRendererInfo",{enumerable:!0,get:function(){return s.getRendererInfo}}),Object.defineProperty(t,"getSectionedItemsSize",{enumerable:!0,get:function(){return s.getSectionedItemsSize}}),Object.defineProperty(t,"getSectionPlaneCount",{enumerable:!0,get:function(){return s.getSectionPlaneCount}}),Object.defineProperty(t,"getSerializablePlaneData",{enumerable:!0,get:function(){return s.getSerializablePlaneData}}),Object.defineProperty(t,"getSerializableSectionViewData",{enumerable:!0,get:function(){return s.getSerializableSectionViewData}}),Object.defineProperty(t,"getThumbnailForKey",{enumerable:!0,get:function(){return s.getThumbnailForKey}}),Object.defineProperty(t,"getTimeInMilliseconds",{enumerable:!0,get:function(){return s.getTimeInMilliseconds}}),Object.defineProperty(t,"getUnavailableRendererInfo",{enumerable:!0,get:function(){return s.getUnavailableRendererInfo}}),Object.defineProperty(t,"getZoomToWindowState",{enumerable:!0,get:function(){return s.getZoomToWindowState}}),Object.defineProperty(t,"graphicsTakesSelectionPrecedence",{enumerable:!0,get:function(){return s.graphicsTakesSelectionPrecedence}}),Object.defineProperty(t,"GlRendererInfo",{enumerable:!0,get:function(){return s.GlRendererInfo}}),Object.defineProperty(t,"intersectLineSegmentRay",{enumerable:!0,get:function(){return s.intersectLineSegmentRay}}),Object.defineProperty(t,"intersectTwoLineSegments2d",{enumerable:!0,get:function(){return s.intersectTwoLineSegments2d}}),Object.defineProperty(t,"intersectTwoLines2d",{enumerable:!0,get:function(){return s.intersectTwoLines2d}}),Object.defineProperty(t,"isInSectionPlaneMode",{enumerable:!0,get:function(){return s.isInSectionPlaneMode}}),Object.defineProperty(t,"isMapEmpty",{enumerable:!0,get:function(){return s.isMapEmpty}}),Object.defineProperty(t,"IsolatedOccurrencesManager",{enumerable:!0,get:function(){return s.IsolatedOccurrencesManager}}),Object.defineProperty(t,"isRendererStringForIntel",{enumerable:!0,get:function(){return s.isRendererStringForIntel}}),Object.defineProperty(t,"isSectionPlaneModeEnabled",{enumerable:!0,get:function(){return s.isSectionPlaneModeEnabled}}),Object.defineProperty(t,"loadSectionPlanesFromParameters",{enumerable:!0,get:function(){return s.loadSectionPlanesFromParameters}}),Object.defineProperty(t,"preserveViewersForDocumentId",{enumerable:!0,get:function(){return s.preserveViewersForDocumentId}}),Object.defineProperty(t,"projectToLine",{enumerable:!0,get:function(){return s.projectToLine}}),Object.defineProperty(t,"removeGraphicsViewers",{enumerable:!0,get:function(){return s.removeGraphicsViewers}}),Object.defineProperty(t,"removeSectionPlane",{enumerable:!0,get:function(){return s.removeSectionPlane}}),Object.defineProperty(t,"removeSectionPlanes",{enumerable:!0,get:function(){return s.removeSectionPlanes}}),Object.defineProperty(t,"requestDraw",{enumerable:!0,get:function(){return s.requestDraw}}),Object.defineProperty(t,"collectGraphicsDataForHeapDump",{enumerable:!0,get:function(){return s.collectGraphicsDataForHeapDump}}),Object.defineProperty(t,"setBoxSelectionEnabled",{enumerable:!0,get:function(){return s.setBoxSelectionEnabled}}),Object.defineProperty(t,"setDimensionToolActive",{enumerable:!0,get:function(){return s.setDimensionToolActive}}),Object.defineProperty(t,"setForceHideInteriorSelections",{enumerable:!0,get:function(){return s.setForceHideInteriorSelections}}),Object.defineProperty(t,"setFromSerializablePlaneData",{enumerable:!0,get:function(){return s.setFromSerializablePlaneData}}),Object.defineProperty(t,"setFromSerializableSectionViewData",{enumerable:!0,get:function(){return s.setFromSerializableSectionViewData}}),Object.defineProperty(t,"setInteractionEnabled",{enumerable:!0,get:function(){return s.setInteractionEnabled}}),Object.defineProperty(t,"setIsInFollowMode",{enumerable:!0,get:function(){return s.setIsInFollowMode}}),Object.defineProperty(t,"setIsInSectionPlaneMode",{enumerable:!0,get:function(){return s.setIsInSectionPlaneMode}}),Object.defineProperty(t,"setSectionPlaneOnMateConnector",{enumerable:!0,get:function(){return s.setSectionPlaneOnMateConnector}}),Object.defineProperty(t,"setSectionPlaneOnMatrix",{enumerable:!0,get:function(){return s.setSectionPlaneOnMatrix}}),Object.defineProperty(t,"setShowDimensionsMode",{enumerable:!0,get:function(){return s.setShowDimensionsMode}}),Object.defineProperty(t,"setThumbnailForKey",{enumerable:!0,get:function(){return s.setThumbnailForKey}}),Object.defineProperty(t,"setTransparencyTransition",{enumerable:!0,get:function(){return s.setTransparencyTransition}}),Object.defineProperty(t,"setZoomModeEnabled",{enumerable:!0,get:function(){return s.setZoomModeEnabled}}),Object.defineProperty(t,"snapshotScenegraph",{enumerable:!0,get:function(){return s.snapshotScenegraph}}),Object.defineProperty(t,"tessellateArc",{enumerable:!0,get:function(){return s.tessellateArc}}),Object.defineProperty(t,"timeRendering",{enumerable:!0,get:function(){return s.timeRendering}}),Object.defineProperty(t,"toggleZoomModifierEnabled",{enumerable:!0,get:function(){return s.toggleZoomModifierEnabled}}),Object.defineProperty(t,"unprojectPlaneToWorld",{enumerable:!0,get:function(){return s.unprojectPlaneToWorld}}),Object.defineProperty(t,"unprojectVectorToWorld",{enumerable:!0,get:function(){return s.unprojectVectorToWorld}});var a=i(805468);Object.defineProperty(t,"basicPickSort",{enumerable:!0,get:function(){return a.basicPickSort}})},746499:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InferencePicker=void 0;var r=i(423902),n=i(73055),o=i(311611),s=i(805468),a=n.default.getManager(),c=function(e){function t(t,i,r,n){var s=e.call(this,t,o.INFERENCE_PICKER_SCENEGRAPH_ID)||this;return s.pickPass=new o.InferencePickPass(s.viewer),s.pickPass.setSceneGraph(s.getSceneGraph()),s.pointSizeConstantName=void 0!==i?i:"INFERENCE_POINT_SIZE_PX",s.lineWidthConstantName=void 0!==r?r:"INFERENCE_LINE_WIDTH_PX",s.pickRadiusConstantName=void 0!==n?n:"INFERENCE_PICK_RADIUS_PX",s.inferencePointMaterial=new o.Material({color:a.getColor("INFERENCE_DEBUG_POINT_COLOR"),pointSize:a.getNumber(s.pointSizeConstantName)}),s.inferenceLineMaterial=new o.Material({color:a.getColor("INFERENCE_DEBUG_LINE_COLOR"),lineWidth:a.getNumber(s.lineWidthConstantName)}),s.inferenceCurveMaterial=new o.Material({base:a.getColor("INFERENCE_DEBUG_CURVE_COLOR"),lineWidth:a.getNumber(s.lineWidthConstantName)}),s.pointNodeProperties=new o.NodeProperties({primitiveType:o.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,material:s.inferencePointMaterial,priority:o.RenderOrderPriority.HIGHER}),s.importantNodeProperties=new o.NodeProperties({primitiveType:o.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,material:s.inferencePointMaterial,priority:o.RenderOrderPriority.HIGHEST}),s.linesNodeProperties=new o.NodeProperties({primitiveType:o.PrimitiveType.INFINITE_LINES,isShowThrough:!0,isDepthTested:!1,material:s.inferenceLineMaterial,priority:o.RenderOrderPriority.LOWER}),s.curvesNodeProperties=new o.NodeProperties({primitiveType:o.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,material:s.inferenceCurveMaterial,priority:o.RenderOrderPriority.DEFAULT}),s.pickRadius=a.getNumber(s.pickRadiusConstantName),s.viewer.visualizeInferenceSceneGraph(s.getSceneGraph()),s}return(0,r.__extends)(t,e),t.prototype.getSceneGraph=function(){return this.viewer.getSceneGraphs().getSceneGraph(o.INFERENCE_PICKER_SCENEGRAPH_ID)},t.prototype.onDevicePixelRatioChanged=function(e){this.pickRadius=a.getNumber(this.pickRadiusConstantName),this.inferencePointMaterial.pointSize=a.getNumber(this.pointSizeConstantName),this.inferenceLineMaterial.lineWidth=a.getNumber(this.lineWidthConstantName),this.inferenceCurveMaterial.lineWidth=a.getNumber(this.lineWidthConstantName)},t.prototype.remove=function(){e.prototype.remove.call(this),this.viewer&&this.viewer.visualizeInferenceSceneGraph(null),this.inferencePointMaterial.destroy(),this.inferenceLineMaterial.destroy(),this.inferenceCurveMaterial.destroy()},t.prototype.setIncrementPickId=function(e,t){if(!t.pickId)throw"InferencePicker should be supplied increments that already have a pick id set"},t.prototype.pick=function(e,t){if(this.viewer){var i=this.pickInRect(e,t,this.pickRadius),r=i.length>0?i[0]:null;return r?r.primitiveId:o.INVALID_ID}return o.INVALID_ID},t.prototype.pickMultiple=function(e,t){if(this.viewer){var i=this.pickIteratively(e,t,this.pickRadius,a.getNumber("MAXIMUM_INFERENCE_PICKS")).map((function(e){return e?e.primitiveId:o.INVALID_ID}));return this.getHighestPriorityInferences(i)}return[]},t.prototype.pickInRect=function(e,t,i){if(!this.viewer.isReadyForDrawing())return[];var r=2*i+1,n=2*i+1,o=e-i,a=t-i;this.viewer.pushCameraState(),this.pickPass.setSceneGraph(this.getSceneGraph()),this.pickPass.setPickRect(o,a,r,n),this.pickPass.draw(this.viewer.getRenderContext()),this.viewer.popCameraState();var c=this.pickPass.gatherPicksFromPickPass(),l=[];for(var u in c){var h=c[u];for(var d in h)l.push(h[d])}return l.sort(s.basicPickSort)},t.prototype.pickIteratively=function(e,t,i,r){for(var n,o,s=[],a=!1,c=0;!(c>r);){var l=this.pickInRect(e,t,i);if(l.length<1)break;for(n=0;n<l.length;++n)(o=l[n]).fromPass=c,s.push(o);for(n=0;n<l.length;++n)this.hideIncrementFromPick(l[n].primitiveId.toString()),a=!0;++c}return a&&this.occurrenceData.resetHiddenFromPick(),s},t.prototype.getHighestPriorityInferences=function(e){if(0===e.length)return[];for(var t=[e[0]],i=this.getRenderOrderPriority(e[0]),r=1;r<e.length;r++){var n=this.getRenderOrderPriority(e[r]);if(n<0)return t;if(n!==i)break;t.push(e[r])}return t},t.prototype.getMeshIncrementForPrimitiveId=function(e){var t=this.getInstantiatedMeshIncrement(e.toString());return t?t.meshIncrement:null},t.prototype.getRenderOrderPriority=function(e){var t=this.getInstantiatedMeshIncrement(e.toString());return t?t.nodeProperties.priority:-1},t.prototype.updateInference=function(e,t){var i=e.id;if(i){var r=null;e.primitiveType===o.PrimitiveType.POINTS?(r=t?this.importantNodeProperties:this.pointNodeProperties,(0,o.addSizeToIncrement)(a.getNumber(this.pointSizeConstantName),e)):e.primitiveType===o.PrimitiveType.INFINITE_LINES?(r=this.linesNodeProperties,(0,o.addSizeToIncrement)(a.getNumber(this.lineWidthConstantName),e)):e.primitiveType===o.PrimitiveType.LINES&&(r=this.curvesNodeProperties,(0,o.addSizeToIncrement)(a.getNumber(this.lineWidthConstantName),e)),r&&this.updateMeshIncrement(i,i,e,r)}},t.prototype.deleteInference=function(e){this.removeMeshIncrement(e)},t.prototype.resetInferences=function(){this.removeMeshIncrements()},t}(o.UIElement);t.InferencePicker=c},245760:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=void 0;var n=i(73055),o=i(470342),s=i(911748),a=i(402197),c=i(194598),l=i(311517),u=i(712197),h=i(699716),d=i(521761),p=i(311611);(0,p.registerDragHelper)();var g=function(){function e(e,t){this.editFeatureUnderCursor=e,this.viewer=t,this.sketch=null,this.lastMouseMovedEvent=null,this.lastMouseMoveTime=-1,this.showContextMenuOnMouseUp=!1,this.timeOfRightMouseButtonDown=0,this.mouseTravelSinceRightButtonDown=0,this.preHighlightTimeout=0,this.suppressMouseMovePick=!1,this.hoveredUiSelection=null,this.draggedUiSelection=null,this.longPressedUiSelection=null,this.skipNextClickSelection=!1,this.externalDragHandler=null,this.dragHandledExternally=!1,this.initialDragEvent=null,this.leftButtonDownOnDragStart=!1,this.startedLeftButtonDrag=!1,this.forcedManipulationActive=!1,this.dragTravel=0,this.dragStartTime=0,this.mouseInCanvas=!1,this.buttonState={leftButton:!1,middleButton:!1,rightButton:!1},this.middleMouseButtonDoubleClickHandler=null,this.altHeld=!1,(0,p.viewerCheck)(t),this.boxSelector=new p.BoxSelector(this.viewer),this.setupEventHandlers()}return e.prototype.setupEventHandlers=function(){var t=this,i=this.getViewer().$el;i.dragHelper({lastX:0,lastY:0,onStart:function(e,i){t.buttonState=this.buttonState,t.onDragStart(e,i)},onDrag:function(e,i,r){t.buttonState=this.buttonState;var n=(0,h.getDevicePixelRatio)();t.onDrag(e,i*n,r*n,this.lastX*n,this.lastY*n)},onStop:function(e){t.buttonState=this.buttonState,t.onDragStop(e)}});var n=function(e){return e.bind(t)};i.on("mouseenter",n(e.prototype.onMouseEnter)),i.on("mouseleave",n(e.prototype.onMouseLeave)),i.on("mousemove",n(e.prototype.onMouseMove)),i.on("mousedown",n(e.prototype.onMouseDown)),i.on("mouseup",n(e.prototype.onMouseUp)),i.on("click",n(e.prototype.onClick)),i.on("dblclick",n(e.prototype.onDoubleClick)),i.on("mousewheel DOMMouseScroll",n(e.prototype.onMouseWheelScroll)),(0,p.on)(i,n(e.prototype.onLongPress)),this.middleMouseButtonDoubleClickHandler=new p.DoubleClickHandler(i,n(e.prototype.onMiddleMouseButtonDoubleClick)),r(document).on("keyup",n(e.prototype.onKeyUp)),r(document).on("keydown",n(e.prototype.onKeyDown))},e.prototype.remove=function(){this.boxSelector&&(this.boxSelector.remove(),this.boxSelector=null),this.middleMouseButtonDoubleClickHandler&&(this.middleMouseButtonDoubleClickHandler.off(),this.middleMouseButtonDoubleClickHandler=null)},e.prototype.setSketch=function(e){this.sketch=e},e.prototype.setExternalDragHandler=function(e){this.externalDragHandler=e},e.prototype.setSuppressMouseMovePick=function(e){this.suppressMouseMovePick=e,this.suppressMouseMovePick&&this.clearPreHighlightTimeout()},e.prototype.getLastMouseMovedEvent=function(){return this.lastMouseMovedEvent},e.prototype.isMouseRightButtonDown=function(){return this.buttonState.rightButton},e.prototype.isMouseMiddleButtonDown=function(){return this.buttonState.middleButton},e.prototype.isMouseLeftButtonDown=function(){return this.buttonState.leftButton},e.prototype.getViewer=function(){return this.viewer},e.prototype.onMouseEnter=function(e){this.viewer.getEventDispatcher().trigger(p.CANVAS_MOUSEENTER,e),this.mouseInCanvas=!0,this.lastMouseMoveTime=-1,window.focus()},e.prototype.trackMouseMovement=function(e){var t=1/0,i=(0,p.getTimeInMilliseconds)(),r=i-this.lastMouseMoveTime,o=n.default.getManager(),a=o.getNumber("CONTEXT_MENU_DISTANCE_THRESHOLD"),c=this.viewer.getCanvasCoordinateFromEvent(e),u=this.viewer.getCanvasCoordinateFromEvent(this.lastMouseMovedEvent);if(this.lastMouseMoveTime>0&&this.lastMouseMovedEvent){var h=s.vec2.length([c[0]-u[0],c[1]-u[1]]);t=h/r,o.getNumber("OUTPUT_MOUSE_SPEED")&&l.log.debug("Mouse speed: "+t.toFixed(3)+", distance since last movement: "+h.toFixed(2)+", time since last movement: "+r.toFixed(1)),this.mouseTravelSinceRightButtonDown+=h}return this.lastMouseMoveTime=i,this.lastMouseMovedEvent=e,this.showContextMenuOnMouseUp&&this.mouseTravelSinceRightButtonDown>a&&(this.showContextMenuOnMouseUp=!1),t},e.prototype.isViewManipulationActive=function(e){var t=this.getViewer().getPrimaryViewController();if(null!==t){if(t.isBeingManipulated())return!0;if(t.getManipulationMode(e,this.buttonState)!==p.ManipulationMode.NONE)return!0}return(0,p.inZoom)()},e.prototype.isNotManipulatingAndNotInZoom=function(e){return!this.suppressMouseMovePick&&!this.isViewManipulationActive(e)&&!this.draggedUiSelection},e.prototype.onMouseMove=function(e){if(this.viewer.getEventDispatcher().trigger(p.CANVAS_MOUSEMOVE,e),e.isPropagationStopped())return!1;if(!this.viewer.isReadyForDrawing())return!1;var t=n.default.getManager(),i=this.trackMouseMovement(e);this.clearPreHighlightTimeout();var r=this.getViewer();r.updateLastMouseLocation(e),this.isNotManipulatingAndNotInZoom(e)&&(i<t.getNumber("PREHIGHLIGHT_SPEED_THRESHOLD")?this.triggerPreHighlightPick(e):(0,u.getPreselectionList)().length>0?this.triggerPreHighlightPick(e,!0):this.schedulePreHighlightPick(e));var s=o.FollowdataModel.getLeaderFollowModel();if(s.get("active")){s.width=r.el.width,s.height=r.el.height;var a=r.isMouseInsideViewManipulator()?[-1,-1]:r.getCanvasCoordinateFromEvent(e);s.setCursorPosition(a)}return!0},e.prototype.onMouseLeave=function(e){this.viewer.getEventDispatcher().trigger(p.CANVAS_MOUSELEAVE,e),this.mouseInCanvas=!1,this.clearPreHighlightTimeout(),this.suppressMouseMovePick||(0,u.handleEmptyPick)(!0,!1)},e.prototype.eventCanBeUsedForContextMenu=function(e){return e.ctrlKey||e.which===d.MouseButton.RIGHT},e.prototype.onMouseDown=function(e){(0,p.inZoom)()&&(this.hoveredUiSelection=new p.UISelection(this.boxSelector,p.SELECTION_ID,""),this.viewer.getUISelectionManager().setHoveredSelection(this.hoveredUiSelection,e)),this.eventCanBeUsedForContextMenu(e)&&(this.lastMouseMovedEvent=e,this.showContextMenuOnMouseUp=!0,this.mouseTravelSinceRightButtonDown=0,this.timeOfRightMouseButtonDown=(0,p.getTimeInMilliseconds)())},e.prototype.isMouseInCanvas=function(){return this.mouseInCanvas},e.prototype.onContextMenuWillHide=function(e,t){this.eventCanBeUsedForContextMenu(t)&&(this.lastMouseMovedEvent=null,this.showContextMenuOnMouseUp=!0,this.mouseTravelSinceRightButtonDown=0,this.timeOfRightMouseButtonDown=(0,p.getTimeInMilliseconds)())},e.prototype.onMouseUp=function(e){this.trackMouseMovement(e);var t=(0,p.getTimeElapsed)(this.timeOfRightMouseButtonDown)>n.default.getManager().getNumber("CONTEXT_MENU_TIME_THRESHOLD_MS");if(this.eventCanBeUsedForContextMenu(e)&&this.showContextMenuOnMouseUp&&!t){this.cancelDragging(e);var i={pickHandled:!1,contextMenuEnabled:!0,altKey:e.altKey};this.notifyGraphicsHandledClick(i),this.showContextMenu(e),r("#context-menu-layer").on("contextmenu:willhide",this.onContextMenuWillHide.bind(this))}this.longPressedUiSelection&&e.which===d.MouseButton.LEFT&&(this.longPressedUiSelection.uiElement.triggerLongPressEnd(this.longPressedUiSelection,e),this.longPressedUiSelection=null,this.skipNextClickSelection=!0)},e.prototype.updatePicksForKeyEvent=function(e){if(this.isNotManipulatingAndNotInZoom(e)){var t=this.getViewer();if(!t||!t.getGlContext()||null===this.lastMouseMovedEvent)return;if(t!==(0,p.getFocusedViewer)())return;var i=t.getCanvasCoordinateFromEvent(this.lastMouseMovedEvent);t.doPick(i[0],i[1],!0,!0,{onlyRemovePreHighlight:!1,sourceEvent:e,altKey:e.altKey})}},e.prototype.onKeyDown=function(e){e.altKey&&!this.altHeld&&(this.altHeld=!0,this.updatePicksForKeyEvent(e))},e.prototype.onKeyUp=function(e){!e.altKey&&this.altHeld&&(this.altHeld=!1,this.updatePicksForKeyEvent(e)),e.which===a.Keys.ALT&&e.preventDefault()},e.prototype.onClick=function(e){if(this.viewer.getEventDispatcher().trigger(p.CANVAS_CLICK,e),!(e.isPropagationStopped()||this.showContextMenuOnMouseUp&&this.eventCanBeUsedForContextMenu(e))){var t={altKey:e.altKey},i=e.which===d.MouseButton.LEFT;if(!this.isDragging()&&i&&!this.skipNextClickSelection){var r=this.getViewer(),n=r.getCanvasCoordinateFromEvent(e);(t={click:!0,shiftKey:e.shiftKey,altKey:this.altHeld,sourceEvent:e}).pickHandled=r.doPick(n[0],n[1],!1,!0,t)}this.skipNextClickSelection=!1,this.notifyGraphicsHandledClick(t)}},e.prototype.onDoubleClick=function(e){var t;if(!this.isDragging()&&e.which===d.MouseButton.LEFT){var i=this.viewer.getCanvasCoordinateFromEvent(e);!(t=this.viewer.onDoubleClick(i[0],i[1],e))&&this.viewer.getCanEdit()&&this.editFeatureUnderCursor(i[0],i[1])}this.notifyGraphicsHandledClick({pickHandled:t,altKey:e.altKey})},e.prototype.onMiddleMouseButtonDoubleClick=function(e){this.isDragging()||this.viewer.animateZoomFit()},e.prototype.onMouseWheelScroll=function(e){return!this.viewer.performingBoxSelection()&&(!!this.viewer.isReadyForDrawing()&&(!!this.viewer.getPrimaryViewController().zoomOnMouseWheelScroll(e)&&(this.viewer.getEventDispatcher().trigger(p.CHANGE_VIEW,e),this.viewer.setUserIsAdjustingCamera(),this.viewer.requestDraw(),!1)))},e.prototype.cancelDragging=function(e){this.getViewer().$el.dragHelper("cancelDragging",e)},e.prototype.isDragging=function(){return this.getViewer().$el.dragHelper("dragging")},e.prototype.onDragStart=function(e,t){if(this.leftButtonDownOnDragStart=this.buttonState.leftButton,!this.viewer.performingBoxSelection()&&this.viewer.isReadyForDrawing()){this.initialDragEvent=e,this.dragTravel=0,this.dragStartTime=(0,p.getTimeInMilliseconds)();var i=this.viewer.getPrimaryViewController(),r=i.onDragStart(e,t,this.buttonState);this.leftButtonDownOnDragStart&&i.isBeingForceManipulated()&&(this.forcedManipulationActive=!0,this.leftButtonDownOnDragStart=!1),r&&this.viewer.getEventDispatcher().trigger(p.CHANGE_VIEW,e),this.draggedUiSelection=null,this.dragHandledExternally=!1,this.startedLeftButtonDrag=!1,this.preHighlightTimeout&&(this.triggerPreHighlightPick(t),this.clearPreHighlightTimeout()),this.hoveredUiSelection=this.viewer.getUISelectionManager().getHoveredSelection()}},e.prototype.onDrag=function(e,t,i,r,n){this.dragTravel+=s.vec2.length([t,i]);var o=this.getViewer();if(!o.performingBoxSelection()&&o.isReadyForDrawing())if(o.getPrimaryViewController().onDrag(e,this.buttonState,t,i,r,n),o.getPrimaryViewController().isBeingManipulated()?(this.viewer.setUserIsAdjustingCamera(),(0,u.clearPreSelection)()):this.viewer.setUserIsManipulatingWithTimeout(),this.buttonState.leftButton||this.stopLeftMouseButtonHandlers.call(this,e),!this.startedLeftButtonDrag&&this.shouldStartLeftButtonDrag())this.startLeftButtonDrag();else if(this.draggedUiSelection){var a=o.getCanvasCoordinateFromEvent(e);this.draggedUiSelection.uiElement.triggerDrag(this.draggedUiSelection,{mouseX:a[0],mouseY:a[1],camera:o.getCamera(),shiftKey:e.shiftKey})}else this.dragHandledExternally&&(this.sketch&&this.sketch.endPointScreen(o.getCanvasCoordinateFromEvent(e)),this.externalDragHandler&&this.externalDragHandler.onDrag(e))},e.prototype.onDragStop=function(e){var t=this.getViewer();this.leftButtonDownOnDragStart&&!this.startedLeftButtonDrag&&this.initialDragEvent&&!this.forcedManipulationActive&&this.onClick(this.initialDragEvent),this.forcedManipulationActive=!1,t.isReadyForDrawing()&&(t.getPrimaryViewController().onDragStop(e),this.stopLeftMouseButtonHandlers.call(this,e),this.suppressMouseMovePick||this.schedulePreHighlightPick(e))},e.prototype.schedulePreHighlightPick=function(e){var t=this,i=this.viewer.getAveragePickDuration()*n.default.getManager().getNumber("PAUSED_MOUSE_PREHIGHLIGHT_TIMEOUT_MULTIPLIER");this.preHighlightTimeout=window.setTimeout((function(){t.triggerPreHighlightPick(e),t.preHighlightTimeout=0}),i)},e.prototype.clearPreHighlightTimeout=function(){this.preHighlightTimeout&&(window.clearTimeout(this.preHighlightTimeout),this.preHighlightTimeout=0)},e.prototype.triggerPreHighlightPick=function(e,t){var i=this.getViewer();if(i&&i.getGlContext()){var r=i.getCanvasCoordinateFromEvent(e);i.doPick(r[0],r[1],!0,!0,{onlyRemovePreHighlight:!!t,sourceEvent:e,altKey:this.altHeld})}},e.prototype.shouldStartLeftButtonDrag=function(){var e=n.default.getManager(),t=(0,p.getTimeInMilliseconds)()-this.dragStartTime,i=this.getViewer().getPrimaryViewController();return!this.startedLeftButtonDrag&&!i.isBeingForceManipulated()&&this.leftButtonDownOnDragStart&&t>e.getNumber("LEFT_MOUSE_DRAG_TIME_TOLERANCE")&&this.dragTravel>e.getNumber("LEFT_MOUSE_DRAG_DISTANCE_TOLERANCE")},e.prototype.startLeftButtonDrag=function(){var e=this.getViewer();(0,p.inZoom)()?this.hoveredUiSelection=new p.UISelection(this.boxSelector,p.SELECTION_ID,""):this.triggerPreHighlightPick(this.initialDragEvent);var t=e.getCanvasCoordinateFromEvent(this.initialDragEvent);this.hoveredUiSelection&&this.hoveredUiSelection.uiElement.triggerDragStart(this.hoveredUiSelection,{mouseX:t[0],mouseY:t[1],camera:e.getCamera()})&&(this.draggedUiSelection=this.hoveredUiSelection),this.dragHandledExternally=!1,this.draggedUiSelection||(this.sketch&&this.sketch.startPointScreen(t),this.externalDragHandler&&(this.dragHandledExternally=this.externalDragHandler.onDragStart(this.initialDragEvent))),this.draggedUiSelection||this.dragHandledExternally||(this.draggedUiSelection=new p.UISelection(this.boxSelector,p.SELECTION_ID,""),this.draggedUiSelection.uiElement.triggerDragStart(this.draggedUiSelection,{mouseX:t[0],mouseY:t[1],camera:e.getCamera()})||(this.draggedUiSelection=null)),this.startedLeftButtonDrag=!0},e.prototype.stopLeftMouseButtonHandlers=function(e){var t=this.getViewer();if(this.draggedUiSelection){var i=this.viewer.getCanvasCoordinateFromEvent(e);this.draggedUiSelection.uiElement.triggerDragStop(this.draggedUiSelection,{mouseX:i[0],mouseY:i[1],camera:t.getCamera()}),this.draggedUiSelection=null}this.dragHandledExternally&&(this.sketch&&this.sketch.endPointScreen([e.pageX,e.pageY]),this.externalDragHandler&&this.externalDragHandler.onDragStop(e),this.dragHandledExternally=!1)},e.prototype.showContextMenu=function(e){this.getViewer().$el.osContextMenu({x:e.pageX,y:e.pageY})},e.prototype.notifyGraphicsHandledClick=function(e){this.viewer.getEventDispatcher().trigger(p.GRAPHICS_HANDLED_CLICK_EVENT,e),c.btInjector.FlyoutService.collapseAllFlyouts(),e&&e.skipCommentClearHighlight||c.btInjector.CommentEditService.clearCommentHighlights()},e.prototype.onLongPress=function(e,t){for(var i=this.viewer.getCanvasCoordinateFromEvent(t),r=this.viewer.pickIteratively(i[0],i[1],this.viewer.getDefaultPickTerminationEvaluator(),{altKey:e.altKey}),n=null,o=0;o<r.length&&!n;++o)n=r[o].uiSelection;n&&(this.longPressedUiSelection=n,this.longPressedUiSelection.uiElement.triggerLongPressStart(this.longPressedUiSelection,e))},e.prototype.getAltHeld=function(){return this.altHeld},e}();t.InputHandler=g},768867:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InterferenceDisplay=t.BOUNDING_BOX_MESH_INCREMENT_NAME=void 0;var r=i(423902),n=i(63845),o=i(227441),s=i(311611),a=i(416825),c=i(567135),l=i(901893),u=i(145620),h=i(311611),d=i(808035);t.BOUNDING_BOX_MESH_INCREMENT_NAME="boxId";var p=function(e){function i(t,i,r,n,o,u,p,g){var f=e.call(this,i)||this;return f.firstClashParentId=r,f.secondClashParentId=n,f.interferenceIndex=o,f.boundingBox=u,f.LINE_WIDTH=2.5,f.lineNodeProps=new d.NodeProperties({primitiveType:l.PrimitiveType.LINES,isPickable:!0,isHighlightable:!0,isTwoSided:!0,isShowThrough:!1}),f.boxLineNodeProps=new d.NodeProperties({primitiveType:l.PrimitiveType.LINES,isPickable:!1,isHighlightable:!0,isVisible:!1}),f.faceNodeProps=new d.NodeProperties({isPickable:!0,primitiveType:l.PrimitiveType.TRIANGLE_STRIP}),f.interferenceIndex=o,f.selectionId=r+n+o,t.tessellation.forEach((function(e,i){var r,n=(0,c.createMeshIncrementForEntityData)(e),o=t.appearance,s="id"+i;if(n.primitiveType===l.PrimitiveType.LINES){r=f.lineNodeProps,(0,a.addSizeToIncrement)(f.LINE_WIDTH,n);var u=(0,h.getColorFromDebugEntityColor)(o,l.PrimitiveType.LINES);(0,a.addColorToIncrement)(u,n)}else if(n.primitiveType===l.PrimitiveType.TRIANGLE_STRIP){r=f.faceNodeProps;u=(0,h.getColorFromDebugEntityColor)(o,l.PrimitiveType.TRIANGLE_STRIP);(0,a.addColorToIncrement)(u,n)}r&&(f.updateMeshIncrement(s,f.selectionId,n,r),f.viewer.getIsolatedOccurrenceManager().addIdsToIsolate([f.graphicsOccurrenceId],!0))})),f.boxIncrement=(0,s.createWireBox)(f.boundingBox.minCorner.getVec3(),f.boundingBox.maxCorner.getVec3()).createTransformed(p.getGlMatrix()),g&&f.setTransform(g.getGlMatrix()),f}return(0,r.__extends)(i,e),i.prototype.getSelectionId=function(){return this.selectionId},i.prototype.remove=function(){this.viewer.getIsolatedOccurrenceManager().removeFromIsolate([this.graphicsOccurrenceId]),e.prototype.remove.call(this)},i.prototype.getModelSelection=function(){return new n.Selection(o.GBTUiSelectionType.TEMPORARY_GEOMETRY,this.selectionId)},i.prototype.processResetSelection=function(e){e===h.HighlightType.SECONDARY&&this.boxIncrement&&this.removeMeshIncrement(t.BOUNDING_BOX_MESH_INCREMENT_NAME),this.removeHighlightFromOccurrence(e)},i.prototype.processAddSelection=function(e,i){this.selectionId===e&&(i===h.HighlightType.SECONDARY&&this.boxIncrement&&this.updateMeshIncrement(t.BOUNDING_BOX_MESH_INCREMENT_NAME,this.selectionId,this.boxIncrement,this.boxLineNodeProps),this.addNewHighlightToOccurrence(i))},i.prototype.processRemoveSelection=function(e,t){this.selectionId===e&&this.removeHighlightFromOccurrence(t)},i}(u.UIElement);t.InterferenceDisplay=p},311611:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsRefinementMode=t.SectionPlaneParameters=t.ScreenSpaceData=t.OriginAxesIndex=t.MouseButton=t.EntityFilterFunction=t.InferenceData=t.IconSelectionType=t.DimensionPreferences=t.ComponentNames=t.sectionPlaneSelectionDisabled=t.enableSectionPlaneSelection=t.disableSectionPlaneSelection=t.MAIN_SCENEGRAPH_ID=t.PREVIEW_SCENEGRAPH_ID=t.HUD_SCENEGRAPH_ID=t.HUD_MODEL_SCENEGRAPH_ID=t.INFERENCE_PICKER_SCENEGRAPH_ID=t.sign=t.EventData=t.IntersectionType=t.ManipulationMode=t.HighlightType=t.Action=t.GLRenderingContext=t.ExplodeLineLineSegment=t.ExplodeLineArcSegment=t.ExplodeLineDefinition=t.ExplodeLine=t.viewerCheck=t.getFocusedViewer=t.setFocusedViewer=t.getColorFromDebugEntityColor=void 0;var r=i(423902);(0,r.__exportStar)(i(532981),t),(0,r.__exportStar)(i(274208),t),(0,r.__exportStar)(i(536868),t),(0,r.__exportStar)(i(854465),t),(0,r.__exportStar)(i(771191),t),(0,r.__exportStar)(i(910152),t),(0,r.__exportStar)(i(14381),t),(0,r.__exportStar)(i(696096),t),(0,r.__exportStar)(i(296152),t),(0,r.__exportStar)(i(996828),t),(0,r.__exportStar)(i(298771),t),(0,r.__exportStar)(i(321146),t),(0,r.__exportStar)(i(648809),t),(0,r.__exportStar)(i(864960),t),(0,r.__exportStar)(i(834682),t),(0,r.__exportStar)(i(311814),t),(0,r.__exportStar)(i(444357),t),(0,r.__exportStar)(i(380511),t),(0,r.__exportStar)(i(157352),t),(0,r.__exportStar)(i(742364),t),(0,r.__exportStar)(i(592381),t),(0,r.__exportStar)(i(259141),t),(0,r.__exportStar)(i(157650),t),(0,r.__exportStar)(i(86004),t),(0,r.__exportStar)(i(914533),t),(0,r.__exportStar)(i(794576),t),(0,r.__exportStar)(i(16295),t),(0,r.__exportStar)(i(131642),t),(0,r.__exportStar)(i(490026),t),(0,r.__exportStar)(i(158825),t),(0,r.__exportStar)(i(337688),t),(0,r.__exportStar)(i(419722),t),(0,r.__exportStar)(i(356860),t),(0,r.__exportStar)(i(184270),t),(0,r.__exportStar)(i(860115),t),(0,r.__exportStar)(i(355003),t),(0,r.__exportStar)(i(606753),t),(0,r.__exportStar)(i(335760),t),(0,r.__exportStar)(i(658064),t),(0,r.__exportStar)(i(228722),t),(0,r.__exportStar)(i(62151),t),(0,r.__exportStar)(i(756848),t),(0,r.__exportStar)(i(258120),t),(0,r.__exportStar)(i(932414),t),(0,r.__exportStar)(i(856942),t),(0,r.__exportStar)(i(4534),t),(0,r.__exportStar)(i(388131),t),(0,r.__exportStar)(i(400129),t),(0,r.__exportStar)(i(445285),t),(0,r.__exportStar)(i(884640),t),(0,r.__exportStar)(i(145620),t),(0,r.__exportStar)(i(901893),t),(0,r.__exportStar)(i(949768),t),(0,r.__exportStar)(i(114328),t),(0,r.__exportStar)(i(144788),t),(0,r.__exportStar)(i(808035),t),(0,r.__exportStar)(i(553944),t),(0,r.__exportStar)(i(105089),t),(0,r.__exportStar)(i(177196),t),(0,r.__exportStar)(i(729499),t),(0,r.__exportStar)(i(925037),t),(0,r.__exportStar)(i(130098),t),(0,r.__exportStar)(i(245760),t),(0,r.__exportStar)(i(770188),t),(0,r.__exportStar)(i(734604),t),(0,r.__exportStar)(i(950204),t),(0,r.__exportStar)(i(661144),t),(0,r.__exportStar)(i(888590),t),(0,r.__exportStar)(i(140859),t),(0,r.__exportStar)(i(881183),t),(0,r.__exportStar)(i(198861),t),(0,r.__exportStar)(i(976613),t),(0,r.__exportStar)(i(766),t),(0,r.__exportStar)(i(688571),t),(0,r.__exportStar)(i(332254),t),(0,r.__exportStar)(i(639501),t),(0,r.__exportStar)(i(394739),t),(0,r.__exportStar)(i(521300),t),(0,r.__exportStar)(i(971188),t),(0,r.__exportStar)(i(558474),t),(0,r.__exportStar)(i(890130),t),(0,r.__exportStar)(i(813681),t),(0,r.__exportStar)(i(270706),t),(0,r.__exportStar)(i(486286),t),(0,r.__exportStar)(i(379983),t),(0,r.__exportStar)(i(34824),t),(0,r.__exportStar)(i(53841),t),(0,r.__exportStar)(i(483556),t),(0,r.__exportStar)(i(924128),t),(0,r.__exportStar)(i(167303),t),(0,r.__exportStar)(i(480155),t),(0,r.__exportStar)(i(558518),t),(0,r.__exportStar)(i(757845),t),(0,r.__exportStar)(i(175700),t),(0,r.__exportStar)(i(571334),t),(0,r.__exportStar)(i(918928),t),(0,r.__exportStar)(i(691596),t),(0,r.__exportStar)(i(275441),t),(0,r.__exportStar)(i(255589),t),(0,r.__exportStar)(i(829593),t),(0,r.__exportStar)(i(915443),t),(0,r.__exportStar)(i(626627),t),(0,r.__exportStar)(i(392861),t),(0,r.__exportStar)(i(898271),t),(0,r.__exportStar)(i(988821),t),(0,r.__exportStar)(i(899457),t),(0,r.__exportStar)(i(825039),t),(0,r.__exportStar)(i(428821),t),(0,r.__exportStar)(i(317179),t),(0,r.__exportStar)(i(13014),t),(0,r.__exportStar)(i(94012),t),(0,r.__exportStar)(i(222550),t),(0,r.__exportStar)(i(233678),t),(0,r.__exportStar)(i(628980),t),(0,r.__exportStar)(i(132034),t),(0,r.__exportStar)(i(956834),t),(0,r.__exportStar)(i(198187),t),(0,r.__exportStar)(i(82567),t),(0,r.__exportStar)(i(147864),t),(0,r.__exportStar)(i(269881),t),(0,r.__exportStar)(i(195218),t),(0,r.__exportStar)(i(905253),t),(0,r.__exportStar)(i(289354),t),(0,r.__exportStar)(i(667453),t),(0,r.__exportStar)(i(13754),t),(0,r.__exportStar)(i(414156),t),(0,r.__exportStar)(i(330079),t),(0,r.__exportStar)(i(119003),t),(0,r.__exportStar)(i(855965),t),(0,r.__exportStar)(i(767605),t),(0,r.__exportStar)(i(742446),t),(0,r.__exportStar)(i(469986),t),(0,r.__exportStar)(i(998250),t),(0,r.__exportStar)(i(181298),t),(0,r.__exportStar)(i(116021),t),(0,r.__exportStar)(i(315490),t),(0,r.__exportStar)(i(325357),t),(0,r.__exportStar)(i(987517),t),(0,r.__exportStar)(i(109579),t),(0,r.__exportStar)(i(627873),t),(0,r.__exportStar)(i(345150),t),(0,r.__exportStar)(i(392647),t),(0,r.__exportStar)(i(417595),t),(0,r.__exportStar)(i(834233),t),(0,r.__exportStar)(i(480214),t),(0,r.__exportStar)(i(537224),t),(0,r.__exportStar)(i(515965),t),(0,r.__exportStar)(i(384783),t),(0,r.__exportStar)(i(700196),t),(0,r.__exportStar)(i(893065),t),(0,r.__exportStar)(i(184314),t),(0,r.__exportStar)(i(614801),t),(0,r.__exportStar)(i(178111),t),(0,r.__exportStar)(i(700882),t),(0,r.__exportStar)(i(235337),t),(0,r.__exportStar)(i(735297),t),(0,r.__exportStar)(i(836461),t),(0,r.__exportStar)(i(450552),t),(0,r.__exportStar)(i(300005),t),(0,r.__exportStar)(i(732862),t),(0,r.__exportStar)(i(564219),t),(0,r.__exportStar)(i(847264),t),(0,r.__exportStar)(i(22789),t),(0,r.__exportStar)(i(460980),t),(0,r.__exportStar)(i(567135),t),(0,r.__exportStar)(i(416825),t),(0,r.__exportStar)(i(205105),t),(0,r.__exportStar)(i(807147),t),(0,r.__exportStar)(i(663612),t),(0,r.__exportStar)(i(14378),t),(0,r.__exportStar)(i(639586),t),(0,r.__exportStar)(i(404483),t),(0,r.__exportStar)(i(278295),t),(0,r.__exportStar)(i(841475),t),(0,r.__exportStar)(i(72082),t),(0,r.__exportStar)(i(540063),t),(0,r.__exportStar)(i(310952),t),(0,r.__exportStar)(i(430546),t),(0,r.__exportStar)(i(59142),t),(0,r.__exportStar)(i(486608),t),(0,r.__exportStar)(i(806776),t),(0,r.__exportStar)(i(611947),t),(0,r.__exportStar)(i(670898),t),(0,r.__exportStar)(i(749575),t),(0,r.__exportStar)(i(689723),t),(0,r.__exportStar)(i(171911),t),(0,r.__exportStar)(i(81220),t),(0,r.__exportStar)(i(134980),t),(0,r.__exportStar)(i(452964),t),(0,r.__exportStar)(i(765045),t),(0,r.__exportStar)(i(726992),t),(0,r.__exportStar)(i(107953),t),(0,r.__exportStar)(i(332514),t),(0,r.__exportStar)(i(843373),t),(0,r.__exportStar)(i(955897),t),(0,r.__exportStar)(i(967013),t),(0,r.__exportStar)(i(269676),t),(0,r.__exportStar)(i(63032),t),(0,r.__exportStar)(i(104338),t),(0,r.__exportStar)(i(867297),t),(0,r.__exportStar)(i(180333),t),(0,r.__exportStar)(i(121356),t),(0,r.__exportStar)(i(877248),t),(0,r.__exportStar)(i(550470),t),(0,r.__exportStar)(i(130799),t),(0,r.__exportStar)(i(746499),t),(0,r.__exportStar)(i(768867),t),(0,r.__exportStar)(i(851758),t),(0,r.__exportStar)(i(470318),t),(0,r.__exportStar)(i(249702),t),(0,r.__exportStar)(i(355720),t),(0,r.__exportStar)(i(37228),t),(0,r.__exportStar)(i(967854),t),(0,r.__exportStar)(i(17037),t),(0,r.__exportStar)(i(201823),t),(0,r.__exportStar)(i(318733),t),(0,r.__exportStar)(i(659916),t),(0,r.__exportStar)(i(413229),t),(0,r.__exportStar)(i(884894),t),(0,r.__exportStar)(i(369704),t),(0,r.__exportStar)(i(334538),t),(0,r.__exportStar)(i(816602),t),(0,r.__exportStar)(i(864589),t),(0,r.__exportStar)(i(653387),t),(0,r.__exportStar)(i(829582),t),(0,r.__exportStar)(i(237752),t),(0,r.__exportStar)(i(603880),t),(0,r.__exportStar)(i(141855),t),(0,r.__exportStar)(i(49627),t),(0,r.__exportStar)(i(867185),t),(0,r.__exportStar)(i(819740),t),(0,r.__exportStar)(i(94012),t),(0,r.__exportStar)(i(844416),t),(0,r.__exportStar)(i(42586),t);var n=i(567135);Object.defineProperty(t,"getColorFromDebugEntityColor",{enumerable:!0,get:function(){return n.getColorFromDebugEntityColor}});var o=i(817395);Object.defineProperty(t,"setFocusedViewer",{enumerable:!0,get:function(){return o.setFocusedViewer}}),Object.defineProperty(t,"getFocusedViewer",{enumerable:!0,get:function(){return o.getFocusedViewer}}),Object.defineProperty(t,"viewerCheck",{enumerable:!0,get:function(){return o.viewerCheck}});var s=i(134879);Object.defineProperty(t,"ExplodeLine",{enumerable:!0,get:function(){return s.ExplodeLine}}),Object.defineProperty(t,"ExplodeLineDefinition",{enumerable:!0,get:function(){return s.ExplodeLineDefinition}});var a=i(887846);Object.defineProperty(t,"ExplodeLineArcSegment",{enumerable:!0,get:function(){return a.ExplodeLineArcSegment}});var c=i(391746);Object.defineProperty(t,"ExplodeLineLineSegment",{enumerable:!0,get:function(){return c.ExplodeLineLineSegment}});var l=i(813681);Object.defineProperty(t,"GLRenderingContext",{enumerable:!0,get:function(){return l.GLRenderingContext}});var u=i(620968);Object.defineProperty(t,"Action",{enumerable:!0,get:function(){return u.Action}}),Object.defineProperty(t,"HighlightType",{enumerable:!0,get:function(){return u.HighlightType}});var h=i(78666);Object.defineProperty(t,"ManipulationMode",{enumerable:!0,get:function(){return h.ManipulationMode}});var d=i(874197);Object.defineProperty(t,"IntersectionType",{enumerable:!0,get:function(){return d.IntersectionType}});var p=i(180954);Object.defineProperty(t,"EventData",{enumerable:!0,get:function(){return p.EventData}});var g=i(376931);Object.defineProperty(t,"sign",{enumerable:!0,get:function(){return g.sign}});var f=i(328408);Object.defineProperty(t,"INFERENCE_PICKER_SCENEGRAPH_ID",{enumerable:!0,get:function(){return f.INFERENCE_PICKER_SCENEGRAPH_ID}});var m=i(328408);Object.defineProperty(t,"HUD_MODEL_SCENEGRAPH_ID",{enumerable:!0,get:function(){return m.HUD_MODEL_SCENEGRAPH_ID}});var y=i(328408);Object.defineProperty(t,"HUD_SCENEGRAPH_ID",{enumerable:!0,get:function(){return y.HUD_SCENEGRAPH_ID}});var v=i(328408);Object.defineProperty(t,"PREVIEW_SCENEGRAPH_ID",{enumerable:!0,get:function(){return v.PREVIEW_SCENEGRAPH_ID}});var E=i(328408);Object.defineProperty(t,"MAIN_SCENEGRAPH_ID",{enumerable:!0,get:function(){return E.MAIN_SCENEGRAPH_ID}});var I=i(951682);Object.defineProperty(t,"disableSectionPlaneSelection",{enumerable:!0,get:function(){return I.disableSectionPlaneSelection}}),Object.defineProperty(t,"enableSectionPlaneSelection",{enumerable:!0,get:function(){return I.enableSectionPlaneSelection}}),Object.defineProperty(t,"sectionPlaneSelectionDisabled",{enumerable:!0,get:function(){return I.sectionPlaneSelectionDisabled}});var T=i(925300);Object.defineProperty(t,"ComponentNames",{enumerable:!0,get:function(){return T.ComponentNames}});var S=i(623639);Object.defineProperty(t,"DimensionPreferences",{enumerable:!0,get:function(){return S.DimensionPreferences}});var P=i(623639);Object.defineProperty(t,"IconSelectionType",{enumerable:!0,get:function(){return P.IconSelectionType}});var _=i(623639);Object.defineProperty(t,"InferenceData",{enumerable:!0,get:function(){return _.InferenceData}});var M=i(623639);Object.defineProperty(t,"EntityFilterFunction",{enumerable:!0,get:function(){return M.EntityFilterFunction}});var D=i(623639);Object.defineProperty(t,"MouseButton",{enumerable:!0,get:function(){return D.MouseButton}});var C=i(925300);Object.defineProperty(t,"OriginAxesIndex",{enumerable:!0,get:function(){return C.OriginAxesIndex}});var O=i(623639);Object.defineProperty(t,"ScreenSpaceData",{enumerable:!0,get:function(){return O.ScreenSpaceData}});var A=i(623639);Object.defineProperty(t,"SectionPlaneParameters",{enumerable:!0,get:function(){return A.SectionPlaneParameters}});var R=i(623639);Object.defineProperty(t,"GraphicsRefinementMode",{enumerable:!0,get:function(){return R.GraphicsRefinementMode}})},37228:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsolatedManagerBase=void 0;var r=i(423902),n=i(663748),o=i(911748),s=i(227441),a=i(311611),c=function(e){function t(t){var i=e.call(this)||this;return i.viewer=t,i.affectedOccurrenceIds=[],i.centersOfInitialAffectedInstances=null,i.dialog=null,i.isIsolateFullyTransparent=!1,i.setUpListeners(),i}return(0,r.__extends)(t,e),t.prototype.destroy=function(){this.dialog&&(this.dialog.destroy(),this.dialog=null),this.stopListening()},t.prototype.setIsIsolateFullyTransparent=function(e){this.isIsolateFullyTransparent=e,this.viewer.requestDraw()},t.prototype.getIsIsolateFullyTransparent=function(){return this.isIsolateFullyTransparent},t.prototype.clearEffectNoAnimation=function(){this.hasAffectedInstances()&&(this.setIsIsolateFullyTransparent(!1),this.clearEffect(),this.viewer.onIsolateRemoved(),(0,a.requestDraw)()),this.dialog&&(this.dialog.destroy(),this.dialog=null)},t.prototype.clearEffectExit=function(e){if(this.viewer===e){var t=!0;this.setIsIsolateFullyTransparent(!1),this.currentRenderModeSupportsAnimation()?this.hasAffectedInstances()&&(t=!1,this.viewer.animateIsolation(!1,function(){this.destroyDialog(),this.clearEffect(),this.viewer.onIsolateRemoved(),(0,a.requestDraw)()}.bind(this))):this.clearEffectNoAnimation(),t&&this.destroyDialog()}},t.prototype.destroyDialog=function(){this.dialog&&(this.dialog.destroy(),this.dialog=null)},t.prototype.currentRenderModeSupportsAnimation=function(){return!(this.viewer.getRenderingMode()===s.GBTGraphicsRenderMode.TRANSLUCENT)},t.prototype.getModelViewManager=function(){return this.viewer.getModelViewManagers().getManager()},t.prototype.getPreviewViewManager=function(){return this.viewer.getModelViewManagers().getPreviewManager()},t.prototype.hasAffectedInstances=function(){return this.affectedOccurrenceIds.length>0},t.prototype.addIdsToAffect=function(e,t){if(this.hasAffectedInstances()||t){for(var i=!1,r=0;r<e.length;r++)this.affectedOccurrenceIds.indexOf(e[r])<0&&(this.affectedOccurrenceIds.push(e[r]),i=!0);i&&this.updateOccurrenceManagerAndPreviewBoundingBoxes()}},t.prototype.removeFromEffect=function(e){if(this.hasAffectedInstances()){for(var t=!1,i=0;i<e.length;i++){var r=this.affectedOccurrenceIds.indexOf(e[i]);r>-1&&(this.affectedOccurrenceIds.splice(r,1),t=!0)}t&&(this.updateOccurrenceManagerAndPreviewBoundingBoxes(),this.viewer.onIsolateRemoved())}},t.prototype.makeTransparent=function(e,t){var i=t?function(){var e=(0,a.getActiveViewer)();e.setSuppressMouseMovePick(!1),e.getInputHandler().isMouseInCanvas()&&e.doPreHighlightPick()}:function(){};e&&this.currentRenderModeSupportsAnimation()?this.viewer.animateIsolation(!0):((0,a.setTransparencyTransition)(1),this.viewer.requestDraw(function(){this.viewer.getAnimationController().incrementAnimationSequence(),i()}.bind(this)))},t.prototype.getSelectionFromNodeModelOrSelection=function(e){return a.IsolatedOccurrencesManager.getSelectionFromNodeModelOrSelection(e,this.viewer)},t.prototype.setAffectedOccurrenceIds=function(e){this.affectedOccurrenceIds=e,this.updateOccurrenceManagerAndPreviewBoundingBoxes()},t.prototype.isInEffectMode=function(){return!!this.dialog},t.prototype.isWithinDistanceOfAnInitialAffectedOccurrence=function(e,t){var i=this.getModelViewManager().getOccurrenceBounds(t);return!!i&&this.isBoundsWithinDistanceOfInitialAffectedInstances(i,e)},t.prototype.isBoundsWithinDistanceOfInitialAffectedInstances=function(e,t){var i=e.center();return this.isPointWithinDistanceOfInitialAffectedInstances(i,t)},t.prototype.isPointWithinDistanceOfInitialAffectedInstances=function(e,t){var i,n;try{for(var s=(0,r.__values)(this.centersOfInitialAffectedInstances),a=s.next();!a.done;a=s.next()){var c=a.value;if(o.vec3.distanceSquared(c,e)<t)return!0}}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return!1},t.prototype.getMinDistanceSquaredFromInitialAffectedInstanceToCenterOfModel=function(){var e=1/0,t=this.getModelBoundsForEffect();if(t){var i=t.center();this.updateCentersOfInitialAffectedInstances();var n=this.centersOfInitialAffectedInstances.map((function(e){return o.vec3.distanceSquared(e,i)}));e=Math.min.apply(Math,(0,r.__spreadArray)([],(0,r.__read)(n),!1))}return e},t.prototype.getModelBoundsForEffect=function(){return this.viewer.getModelBounds()},t.prototype.expandEffectByConnectivity=function(e){},t.prototype.getAffectedOccurrences=function(){return[]},t.prototype.initialAffectedOccurrencesHaveConnectedOccurrences=function(){return!1},t.prototype.affectOccurrences=function(e,t,i){},t.prototype.updateOccurrenceManagerAndPreviewBoundingBoxes=function(){this.updateOccurrenceDataManager(),this.updatePreviewBoundingBoxes()},t.prototype.updatePreviewBoundingBoxes=function(){this.viewer.getBodyManager().refreshReducedDetailBoxes()},t.prototype.clearAffectedOccurrenceIdsNoGraphicsUpdate=function(){this.affectedOccurrenceIds=[]},t}(n.BackboneEventsBaseClass);t.IsolatedManagerBase=c},369704:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsolatedManagersUtils=void 0;var r=i(311611),n=i(438849),o=function(){function e(){}return e.createIsolateDialog=function(e){var t={isolateManager:e};return new n.IsolateDialog(t)},e.updateOccurrenceDataManager=function(e,t){e&&t&&(0===e.length?t.clearIsolation():e.forEach((function(e){e!==r.INVALID_OCCURRENCE_ID&&t.setOccurrenceIsolated(e,!0)})))},e}();t.IsolatedManagersUtils=o},816602:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsolatedOccurrencesManager=t.IsolateFlag=void 0;var r=i(423902),n=i(942921),o=i(663748),s=i(784167),a=i(129346),c=i(163113),l=i(712197),u=i(227441),h=i(311611),d=i(501242);!function(e){e[e.INITIAL=0]="INITIAL",e[e.ASSEMBLY_DATA_UPDATE=1]="ASSEMBLY_DATA_UPDATE",e[e.EXPAND=2]="EXPAND",e[e.PART_STUDIO_UPDATE=3]="PART_STUDIO_UPDATE"}(t.IsolateFlag||(t.IsolateFlag={}));var p=function(e){function t(t){var i=e.call(this)||this;return i.viewer=t,i.contextTransparencyMultiplier=1,(0,c.isInPartStudioElement)()?i.currentIsolateManager=new h.PartStudioIsolateManager(t):i.currentIsolateManager=new h.AssemblyIsolateManager(t),i.setUpListeners(),i}return(0,r.__extends)(t,e),t.prototype.switchActiveElement=function(e){this.currentIsolateManager.destroy(),this.currentMakeTransparentManager&&(this.currentMakeTransparentManager.destroy(),this.currentMakeTransparentManager=null),this.currentIsolateManager=e?new h.PartStudioIsolateManager(this.viewer):new h.AssemblyIsolateManager(this.viewer)},t.prototype.clearIsolateManagerNoGraphicsUpdate=function(){this.currentIsolateManager.clearAffectedOccurrenceIdsNoGraphicsUpdate()},t.prototype.removeMakeTransparentManager=function(){this.currentMakeTransparentManager&&this.currentMakeTransparentManager.destroy(),this.currentMakeTransparentManager=null},t.prototype.getContextTransparencyMultiplier=function(){return this.contextTransparencyMultiplier},t.prototype.getIsIsolateFullyTransparent=function(){return this.currentMakeTransparentManager?this.currentMakeTransparentManager.getIsIsolateFullyTransparent():this.currentIsolateManager.getIsIsolateFullyTransparent()},t.prototype.setContextTransparencyMultiplier=function(e){this.contextTransparencyMultiplier=e,this.viewer.requestDraw()},t.prototype.onMakeTransparentParts=function(e,t){if(0!==e.length&&!this.currentMakeTransparentManager){this.currentMakeTransparentManager=new h.PartStudioMakeTransparentManager(this.viewer,this,e,t);var i=t.getFilteredEntitiesHighlightController();i&&i.updateSetOfFilteredEntities()}},t.prototype.onMakeTransparentComponents=function(e,t,i,r){this.currentMakeTransparentManager||(this.currentMakeTransparentManager=new h.AssemblyMakeTransparentManager(this.viewer,this,e,i,t,r))},t.partCanBeIsolated=function(e){return e.bodyType===u.GBTBodyType.SOLID||e.bodyType===u.GBTBodyType.SHEET||e.bodyType===u.GBTBodyType.WIRE||e.isComposite},t.prototype.setUpListeners=function(){this.listenTo((0,s.getCommandDispatcher)(),a.commands.MAKE_TRANSPARENT_COMPONENTS,this.onMakeTransparentComponents),this.listenTo((0,s.getCommandDispatcher)(),a.commands.MAKE_TRANSPARENT_PARTS,this.onMakeTransparentParts),this.currentIsolateManager.setUpListeners()},t.prototype.destroy=function(){this.currentIsolateManager.destroy(),this.currentMakeTransparentManager&&this.currentMakeTransparentManager.destroy()},t.prototype.isIsolateManagerInUse=function(){return this.isInIsolateMode()||!!(0,l.getActiveInContextNodeId)()||d.DocumentController.getOpenDocumentController().isInterferenceDetectionActive()},t.prototype.clearAllIsolateNoAnimation=function(){this.currentIsolateManager.clearIsolateNoAnimation(),this.currentMakeTransparentManager&&this.currentMakeTransparentManager.clearTransparentNoAnimation()},t.prototype.hasIsolatedInstances=function(){return this.currentIsolateManager.hasIsolatedInstances()||this.currentMakeTransparentManager&&this.currentMakeTransparentManager.hasTransparentInstances()},t.prototype.areSelectionsAlreadyIsolated=function(e){return this.currentIsolateManager.areSelectionsAlreadyIsolated(e)},t.prototype.areSelectionsInListAlreadyIsolated=function(e){return this.currentIsolateManager.areSelectionsInListAlreadyIsolated(e)},t.prototype.isInIsolateMode=function(){return this.currentIsolateManager.isInIsolateMode()},t.prototype.addIdsToIsolate=function(e,t){this.currentIsolateManager.addIdsToIsolate(e,t)},t.prototype.removeFromIsolate=function(e){this.currentIsolateManager.removeFromIsolate(e)},t.prototype.isolateOccurrences=function(e,t){this.currentIsolateManager.isolateOccurrences(e,t)},t.prototype.getIsolatedOccurrences=function(){return this.currentMakeTransparentManager?this.currentMakeTransparentManager.getTransparentOccurrences():this.currentIsolateManager.getIsolatedOccurrences()},t.prototype.setIsolatedOccurrenceIds=function(e){this.currentIsolateManager.setIsolatedOccurrenceIds(e)},t.prototype.isInMakeTransparentMode=function(){return!!this.currentMakeTransparentManager},t.prototype.areSelectionsInListAlreadyTransparent=function(e){var t=this;if(this.currentMakeTransparentManager)return this.currentMakeTransparentManager.areSelectionsInListAlreadyTransparent(e);var i=!0;return e.forEach((function(e){t.noOccurrencesOrPartsSelected(e)||(i=!1)})),i},t.prototype.areSelectionsAlreadyTransparent=function(e){return this.currentMakeTransparentManager?this.currentMakeTransparentManager.areSelectionsAlreadyTransparent(e):this.noOccurrencesOrPartsSelected(e)},t.prototype.isInIsolateOrMakeTransparentMode=function(){return this.isInIsolateMode()||this.isInMakeTransparentMode()},t.prototype.noOccurrencesOrPartsSelected=function(e){if((0,c.isInPartStudioElement)())return 0===h.PartStudioIsolateManagerBase.getSelectedParts(e,this.viewer).length;if((0,c.isInAssemblyElement)()){if(e)if(0!==t.getSelectionFromNodeModelOrSelection(e,this.viewer).getOccurrencesFromSelection().length)return!1;var i=!1;return(0,l.getSelectionList)().forEach((function(e){0!==e.getOccurrencesFromSelection().length&&(i=!0)})),!i}return!0},t.getSelectionFromNodeModelOrSelection=function(e,t){return e?e instanceof l.Selection?e:e instanceof n.InstanceItem?e.getSelection():e.getSelection(t):null},t}(o.BackboneEventsBaseClass);t.IsolatedOccurrencesManager=p},140859:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLinearToolPreview=t.LinearToolPreview=void 0;var r=i(423902),n=i(911748),o=i(736202),s=i(311611),a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.direction=null,r.distance=0,r}return(0,r.__extends)(t,e),t.prototype.setDistance=function(e){this.update(null,null,e)},t.prototype.update=function(e,t,i){return!(e&&!(0,o.isEqual)(e,this.sourceIds))&&(t&&(this.direction=t),i&&(this.distance=i),this.updateMeshes())},t.prototype.updateMeshes=function(){var e,t,i,r,o,a=n.vec3.create();n.vec3.scale(this.direction,this.distance,a);for(var c=0;c<this.sourceIds.length;++c){for(e=this.sourcePrimitives[c],t=this.duplicatePrimitive(e),i=this.sourceIds[c],r=0;r<e.points.length;r+=3)for(o=0;o<3;++o)t.points[r+o]=e.points[r+o]+a[o];t.isTriangles()?this.updateMeshIncrement(i,s.NO_SELECTION_ID,t,s.TOOL_FACE_PROPERTIES):this.updateMeshIncrement(i,s.NO_SELECTION_ID,t,s.TOOL_EDGE_PROPERTIES)}return!0},t}(s.ToolDisplay);t.LinearToolPreview=a,t.createLinearToolPreview=function(e,t,i,r,n){var o=new a(n,e);return o.direction=i,o.distance=r,o.initialize(t)?o:null}},626627:function(e,t,i){"use strict";var r=i(970732),n=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.Listener=t.off=t.on=void 0;var o=500,s=10,a="mousedown",c="mouseup",l="mousemove",u="longpress",h=1;function d(e){if(e.which===h){var t=r(e.target),i=(new Date).getTime(),a=n.Event(u);for(var d in e)a[d]=e[d];a.type=u,t.on(c,g),t.on(l,f);var p=setTimeout((function(){t.trigger(u,a),m()}),o)}function g(e){(new Date).getTime()-i<o?clearTimeout(p):t.trigger(u,a),m()}function f(e){(Math.abs(e.pageX-a.pageX)>s||Math.abs(e.pageY-a.pageY)>s)&&(clearTimeout(p),m())}function m(){t.off(c,void 0,g),t.off(l,void 0,f)}}t.on=function(e,t){e.on(a,d),e.on(u,t)},t.off=function(e){e.off(a,void 0,d),e.off(u)},t.Listener=d},392861:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getManipulatorDisplacementDisplayManager=void 0;var i=function(){function e(){this.activeManipulator=null}return e.prototype.setActiveManipulator=function(e){this.activeManipulator&&this.activeManipulator.removeDisplacementMeshIncrements(),this.activeManipulator=e},e.prototype.resetActiveManipulator=function(){this.setActiveManipulator(null)},e}(),r=null;t.getManipulatorDisplacementDisplayManager=function(){return r||(r=new i),r}},53841:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScalingManipulator=t.PointSelection=t.FreeDrag=t.AngularWithArrow=t.Angular=t.Planar=t.LinearDisplacement=t.createArrowPrimitives=t.Linear=t.Manipulator=void 0;var r=i(423902),n=i(73055),o=i(129346),s=i(784167),a=i(911748),c=i(311517),l=i(689397),u=i(765421),h=i(227441),d=i(376931),p=i(699716),g=i(673290),f=i(311611),m=i(970846),y=n.default.getManager(),v="selection",E="lines.",I="outlines.",T="lines",S="manipulator-displacement-graphics",P=new f.NodeProperties({isVisible:!0,isPickable:!1,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,priority:f.RenderOrderPriority.DEFAULT,primitiveType:f.PrimitiveType.LINES}),_=new f.NodeProperties(Object.assign({},P,{priority:f.RenderOrderPriority.HIGHEST})),M=new f.NodeProperties({isVisible:!0,isPickable:!1,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,priority:f.RenderOrderPriority.LOWER,primitiveType:f.PrimitiveType.LINES}),D=new f.NodeProperties(Object.assign({},M,{priority:f.RenderOrderPriority.HIGHER})),C=new f.NodeProperties({isVisible:!1,isPickable:!0,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,primitiveType:f.PrimitiveType.TRIANGLES}),O=function(e){function t(t,i){var r=e.call(this,t)||this;return r.isDragging=!1,r.isHovering=!1,r.isEnabled=!0,r.meshIncrement=null,r.pickIncrement=null,r.updateIncrement=!1,r.doSnappingBehavior=!0,r.offsetRoundDecimals=8,r.hasEditView=!1,r.isLocked=!1,i||(i={displayEditView:!1}),r.style=h.GBTManipulatorStyleEnum.DEFAULT,r.lineColor=new Uint8Array([0,0,0,0]),r.outlineColor=new Uint8Array([0,0,0,0]),r.triadOwnerType=m.TriadManipulatorType.UNKNOWN,r.displayEditView=i.displayEditView,r.listenTo(r,f.UiEvents.MOUSE_ENTER+v,r.onMouseEnter),r.listenTo(r,f.UiEvents.MOUSE_LEAVE+v,r.onMouseLeave),r.listenTo(r,f.UiEvents.DRAG_START+v,r.onDragStart),r.listenTo(r,f.UiEvents.DRAG+v,r.onDrag),r.listenTo(r,f.UiEvents.DRAG_STOP+v,r.onDragStop),r.listenTo(r,f.UiEvents.CLICK+v,r.onClick),r.listenTo(r,f.UiEvents.DOUBLE_CLICK+v,r.onDoubleClick),r}return(0,r.__extends)(t,e),t.prototype.isManipulator=function(){return!0},t.prototype.setIsLocked=function(e){this.isLocked=e},t.prototype.getIsLocked=function(){return this.isLocked},t.prototype.onDevicePixelRatioChanged=function(e){this.meshIncrement=null,this.updateGraphics(e)},t.prototype.setStyle=function(e){this.style=e||h.GBTManipulatorStyleEnum.DEFAULT},t.prototype.setFadeParameters=function(e,t){this.fadeAngleStart=(0,f.toRadians)((0,f.clamp)(e,0,90)),this.fadeAngleEnd=(0,f.toRadians)((0,f.clamp)(t,0,90))},t.prototype.setIsEnabled=function(e){this.isEnabled=e,(0,f.requestDraw)()},t.prototype.getIsEnabled=function(){return this.isEnabled},t.prototype.setTriadOwnerType=function(e){this.triadOwnerType=e},t.prototype.getTriadOwnerType=function(){return this.triadOwnerType},t.prototype.onViewWillDraw=function(e,t){this.updateGraphics(e)},t.prototype.onMouseEnter=function(e,t){this.isEnabled&&(this.isHovering=!0,this.updateIncrement=!0,this.trigger(m.ManipulatorEvents.MANIPULATOR_ENTER,this),(0,f.requestDraw)())},t.prototype.onMouseLeave=function(e,t){this.isEnabled&&(this.isHovering=!1,this.updateIncrement=!0,this.trigger(m.ManipulatorEvents.MANIPULATOR_LEAVE,this),(0,f.requestDraw)())},t.prototype.onDragStart=function(e,t,i){this.isEnabled&&(this.isDragging=!0,this.updateIncrement=!0,i.requestDrag=!0,this.trigger(m.ManipulatorEvents.MANIPULATION_STARTED,this),(0,f.requestDraw)())},t.prototype.onDragStop=function(e,t){this.isDragging=!1,this.updateIncrement=!0,this.trigger(m.ManipulatorEvents.MANIPULATION_ENDED),(0,f.requestDraw)()},t.prototype.onDrag=function(e,t){},t.prototype.onClick=function(e,t){this.isEnabled&&this.trigger(m.ManipulatorEvents.CLICKED,this)},t.prototype.onDoubleClick=function(e,t){this.isEnabled&&this.trigger(m.ManipulatorEvents.DOUBLE_CLICKED,this)},t.prototype.getOutlineColor=function(){return this.isEnabled?this.isDragging?y.getColor("MANIPULATOR_OUTLINE_DRAG_COLOR"):this.isHovering?y.getColor("MANIPULATOR_OUTLINE_HOVER_COLOR"):y.getColor("MANIPULATOR_OUTLINE_COLOR"):y.getColor("MANIPULATOR_OUTLINE_DISABLED_COLOR")},t.prototype.getLineColor=function(){return this.isEnabled?this.isDragging?y.getColor("MANIPULATOR_LINE_DRAG_COLOR"):this.isHovering?y.getColor("MANIPULATOR_LINE_HOVER_COLOR"):y.getColor("MANIPULATOR_LINE_COLOR"):y.getColor("MANIPULATOR_LINE_DISABLED_COLOR")},t.prototype.isHighlighted=function(){return this.isDragging||this.isHovering},t.prototype.updateLines=function(e,t,i){var r=t.clone();i=void 0!==i?i:1,this.isEnabled||(i*=y.getNumber("MANIPULATOR_DISABLED_OPACITY"));var n=this.getLineColor();n[3]=(0,f.clamp)(n[3]*i,1/255,1),(0,f.addColorToIncrement)(n,t),(0,f.addSizeToIncrement)(y.getNumber("MANIPULATOR_LINE_WIDTH"),t),this.updateMeshIncrement(E+e,f.NO_SELECTION_ID,t,this.isHighlighted()?_:P);var o=this.getOutlineColor();o[3]=(0,f.clamp)(o[3]*i,1/255,1),(0,f.addColorToIncrement)(o,r),(0,f.addSizeToIncrement)(y.getNumber("MANIPULATOR_LINE_WIDTH")+2*y.getNumber("MANIPULATOR_OUTLINE_WIDTH"),r),this.updateMeshIncrement(I+e,f.NO_SELECTION_ID,r,this.isHighlighted()?D:M)},t.prototype.removeDisplacementMeshIncrements=function(){this.removeMeshIncrement(S)},t.prototype.updatePickArea=function(e){this.viewer.performingBoxSelection()||((0,f.addColorToIncrement)([0,0,0,1],e),this.updateMeshIncrement("pickarea",v,e,C))},t.prototype.updateGeometry=function(){},t.prototype.updateColor=function(e){if(e=void 0!==e?e:1,this.isEnabled||(e*=y.getNumber("MANIPULATOR_DISABLED_OPACITY")),e<=0?this.isTransparent||this.makeTransparent():this.isTransparent&&this.makeOpaque(),!this.isHidden&&!this.isTransparent){var t=this.getLineColor();t[3]=(0,f.clamp)(t[3]*e,1/255,1),t=[255*t[0],255*t[1],255*t[2],255*t[3]],this.lineColor[0]===t[0]&&this.lineColor[1]===t[1]&&this.lineColor[2]===t[2]&&this.lineColor[3]===t[3]||(this.lineColor.set(t),this.updateIncrementAttribute("lines.lines",f.Attributes.COLOR,this.lineColor));var i=this.getOutlineColor();i[3]=(0,f.clamp)(i[3]*e,1/255,1),i=[255*i[0],255*i[1],255*i[2],255*i[3]],this.outlineColor[0]===i[0]&&this.outlineColor[1]===i[1]&&this.outlineColor[2]===i[2]&&this.outlineColor[3]===i[3]||(this.outlineColor.set(i),this.updateIncrementAttribute("outlines.lines",f.Attributes.COLOR,this.outlineColor))}},t.prototype.updateGraphics=function(e){var t=this.updateIncrement;this.meshIncrement||(this.updateGeometry(),t=!0),this.meshIncrement&&t&&(this.updateLines(T,this.meshIncrement),this.updatePickArea(this.pickIncrement))},t.prototype.isBeingManipulated=function(){return this.isDragging},t.prototype.getLinearSnapValue=function(e,t,i){var r=e.camera.getPixelSizeAtWorldPoint(i),n=y.getNumber("MANIPULATOR_LINEAR_SNAP_RESOLUTION_PX")*r,o=(0,l.getCurrentDocumentSettingsModel)().getLengthUnits(),s=(0,u.convertFromBase)(n,o);if(s<=0)return t;var a=Math.round(Math.log(s)/Math.log(10)),c=Math.pow(10,a-1);c/=y.getNumber("MANIPULATOR_LINEAR_INCREMENT_DIVISOR");var h=(0,u.convertFromBase)(t,o)/c,d=Math.round(h),p=d-h,g=y.getNumber("MANIPULATOR_LINEAR_SNAP_DEVIATION");if(Math.abs(p)<=g){var f=c*d;t=(0,u.convertToBase)(f,o)}return t},t.prototype.onEditChange=function(e){},t.prototype.onEditCreate=function(){this.hasEditView=!0},t.prototype.onEditClose=function(){this.hasEditView=!1},t.prototype.triggerEditValueChange=function(e){(0,s.getCommandDispatcher)().trigger(o.commands.SET_EDIT_VALUE,e)},t.prototype.triggerEditValueChangeNoUnit=function(e){(0,s.getCommandDispatcher)().trigger(o.commands.SET_EDIT_VALUE_NO_UNIT,e)},t.prototype.triggerEditOriginChange=function(e,t){(0,s.getCommandDispatcher)().trigger(o.commands.SET_EDIT_VIEW_ORIGIN,e,t)},t.prototype.remove=function(){this.hasEditView&&((0,s.getCommandDispatcher)().trigger(o.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,f.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)),e.prototype.remove.call(this)},t.prototype.removeEditViewAndHighlights=function(){this.isHovering=!1,(0,s.getCommandDispatcher)().trigger(o.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,f.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)},t.prototype.dragByIncrementValue=function(e){},t}(f.UIElement);t.Manipulator=O;var A=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.offset=0,r.initialRay=null,r.editOffset=0,r.visualGapPx=0,r.flipDirectionWhenNegative=!1,r.dragOffset=0,r.minOffset=-1/0,r.maxOffset=1/0,r.displacementGraphics=null,r.ray=new f.Ray([0,0,0],[0,0,1]),r.shaftLengthPx=y.getNumber("MANIPULATOR_LINEAR_SHAFT_LENGTH_PX"),r.isDraggable=!i||!i.hasOwnProperty("isDraggable")||i.isDraggable,r.setFadeParameters(y.getNumber("MANIPULATOR_LINEAR_FADE_ANGLE_START"),y.getNumber("MANIPULATOR_LINEAR_FADE_ANGLE_END")),r}return(0,r.__extends)(t,e),t.prototype.remove=function(){e.prototype.remove.call(this),this.displacementGraphics&&(this.displacementGraphics.remove(),this.displacementGraphics=null)},t.prototype.updateGeometry=function(){var e=this.shaftLengthPx,t=y.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"),i=y.getNumber("MANIPULATOR_LINEAR_HEAD_RADIUS_PX"),r=y.getNumber("MANIPULATOR_CIRCLE_SEGMENTS");if(this.style===h.GBTManipulatorStyleEnum.DEFAULT)this.meshIncrement=(0,f.createArrow)(a.vec3.createFrom(0,0,0),a.vec3.createFrom(0,0,1),a.vec3.createFrom(1,0,0),e,t,i),this.pickIncrement=(0,f.createQuad)(a.vec3.createFrom(-i,0,0),a.vec3.createFrom(i,0,0),a.vec3.createFrom(-i,0,e+t));else if(this.style===h.GBTManipulatorStyleEnum.TANGENTIAL){var n=y.getNumber("MANIPULATOR_TANGENTIAL_SHAFT_LENGTH_PX"),o=y.getNumber("MANIPULATOR_TANGENTIAL_HEAD_LENGTH_PX"),s=y.getNumber("MANIPULATOR_TANGENTIAL_HEAD_RADIUS_PX"),c=y.getNumber("MANIPULATOR_TANGENTIAL_BASE_RADIUS_PX"),l=2*Math.max(s,c),u=2*(o+n)+c,d=(0,f.createArrow)(a.vec3.createFrom(0,0,c),a.vec3.createFrom(0,0,1),a.vec3.createFrom(1,0,0),n,o,s),p=(0,f.createArrow)(a.vec3.createFrom(0,0,-c),a.vec3.createFrom(0,0,-1),a.vec3.createFrom(1,0,0),n,o,s),g=(0,f.createCircle)(a.vec3.createFrom(0,0,0),c,a.vec3.createFrom(0,1,0),r);this.meshIncrement=g.concatenate(d).concatenate(p),this.pickIncrement=(0,f.createQuad)(a.vec3.createFrom(-l/2,0,-u/2),a.vec3.createFrom(l/2,0,-u/2),a.vec3.createFrom(-l/2,0,u/2))}else e-=t*y.getNumber("SECOND_DIRECTION_MANIPULATOR_OFFSET_PERCENT"),this.meshIncrement=(0,f.createDoubleHeadArrow)(a.vec3.createFrom(0,0,0),a.vec3.createFrom(0,0,1),a.vec3.createFrom(1,0,0),e,t,i),this.pickIncrement=(0,f.createQuad)(a.vec3.createFrom(-i,0,0),a.vec3.createFrom(i,0,0),a.vec3.createFrom(-i,0,e+t))},t.prototype.setVisualGap=function(e){this.visualGapPx=e},t.prototype.setShaftLength=function(e){this.shaftLengthPx=e},t.prototype.setFlipDirectionWhenNegative=function(e){this.flipDirectionWhenNegative=e},t.prototype.setIsDraggable=function(e){this.isDraggable=e},t.prototype.getOffsetFromEvent=function(e){var t=e.camera.getRay(e.mouseX,e.mouseY),i=this.ray.findClosestPositionToOtherRay(t);return i||0},t.prototype.onDefaultUnitsChanged=function(){this.hasEditView&&this.createEditView()},t.prototype.createEditView=function(){this.editViewUnits=(0,l.getCurrentDocumentSettingsModel)().getLengthUnits();var e=new h.BTMParameterQuantity;e.parameterId="length",e.units=this.editViewUnits,e.value=this.offset;var t={paramQuantity:e,quantityType:h.GBTQuantityType.LENGTH,range:null};(0,s.getCommandDispatcher)().trigger(o.commands.CREATE_MANIPULATOR_EDIT_VIEW,this,t,this.viewer)},t.prototype.onDragStart=function(t,i,r){this.dragOffset=this.getOffsetFromEvent(i)-this.offset,e.prototype.onDragStart.call(this,t,i,r),this.displayEditView&&!this.hasEditView&&(this.createEditView(),this.initialRay=new f.Ray(this.ray.point,this.ray.direction),(0,f.getManipulatorDisplacementDisplayManager)().setActiveManipulator(this))},t.prototype.onEditChange=function(e){var t=e.units;this.editOffset=(0,u.convertToBase)(e.value,t),this.trigger(m.ManipulatorEvents.VALUE_EDITED)},t.prototype.onDrag=function(e,t){if(!this.isLocked&&this.isDraggable){this.offset=this.getOffsetFromEvent(t)-this.dragOffset,this.offset=(0,f.clamp)(this.offset,this.minOffset,this.maxOffset);var i=!t.shiftKey;if(i&&(this.offset=this.getLinearSnapValue(t,this.offset,this.ray.point),this.offset=(0,f.clamp)(this.offset,this.minOffset,this.maxOffset)),this.offset=parseFloat(this.offset.toFixed(this.offsetRoundDecimals)),this.hasEditView){var r=t.camera.getRay(t.mouseX,t.mouseY),n=this.initialRay.findClosestPositionToOtherRay(r);n=n?n-this.dragOffset:0,i&&(n=this.getLinearSnapValue(t,n,this.initialRay.point),n=(0,f.clamp)(n,this.minOffset,this.maxOffset)),this.editOffset=n}this.trigger(m.ManipulatorEvents.VALUE_CHANGED,this.offset,t),(0,f.requestDraw)()}},t.prototype.updateDefinition=function(e,t,i){if(this.isBeingManipulated()){var r=this.ray.evaluate(this.offset);this.ray=new f.Ray(e,t);var n=this.ray.findPositionOfPoint(r);this.offset=n}else this.ray=new f.Ray(e,t),i||(i=0),this.offset=i;(0,f.requestDraw)()},t.prototype.updateDefinitionForLocalManipulatorAtRest=function(e,t,i){var r=2*g.Tolerances.ZERO_LENGTH,n=i?-r:r;this.updateDefinition(e,t,n)},t.prototype.updateLimits=function(e,t){this.minOffset=e,this.maxOffset=t},t.prototype.getOffset=function(){return this.offset},t.prototype.getEditOffset=function(){return this.editOffset},t.prototype.getOffsetPosition=function(){return this.ray.evaluate(this.offset)},t.prototype.getEditOffsetPosition=function(){return this.initialRay.evaluate(this.editOffset)},t.prototype.getInitialOffsetPosition=function(){return this.initialRay.point},t.prototype.getEditTranslation=function(){return a.vec3.subtract(this.getOffsetPosition(),this.getInitialOffsetPosition(),a.vec3.create())},t.prototype.dragByIncrementValue=function(e){var t=this.ray.point,i=this.viewer.getCamera(),r=i.projectWorldPointToCanvas(t),n={mouseX:r[0],mouseY:r[1],camera:i};this.onDragStart(null,n,{requestDrag:!1});var o=(0,l.getCurrentDocumentSettingsModel)().getLengthUnits(),s=(0,u.convertToBase)(e,o),a=this.ray.evaluate(s),c=i.projectWorldPointToCanvas(a);n.mouseX=c[0],n.mouseY=c[1],this.onDrag(null,n),this.onDragStop(null,n)},t.prototype.updateGraphics=function(t){e.prototype.updateGraphics.call(this,t);var i=Math.acos(Math.min(Math.abs(a.vec3.dot(t.getForward(),this.ray.direction)),1)),r=this.isBeingManipulated()?1:(0,f.smoothstep)(this.fadeAngleEnd,this.fadeAngleStart,i);if(this.updateColor(r),!this.isHidden){var n=t.getPixelSizeAtWorldPoint(this.ray.evaluate(this.offset)),o=this.offset<0&&this.flipDirectionWhenNegative?-1:1,s=this.visualGapPx*n+this.offset,c=this.ray.evaluate(s),h=a.vec3.scale(a.vec3.normalize(this.ray.direction,a.vec3.create()),o*n),d=a.vec3.scale(a.vec3.normalize(a.vec3.cross(t.getForward(),h,a.vec3.create())),n),g=a.vec3.scale(a.vec3.normalize(a.vec3.cross(h,d,a.vec3.create())),n),m=a.mat4.createFrom(d[0],d[1],d[2],0,g[0],g[1],g[2],0,h[0],h[1],h[2],0,c[0],c[1],c[2],1);if(this.hasEditView){var y=(0,l.getCurrentDocumentSettingsModel)().getLengthUnits(),v=this.getEditTranslation(),E=a.vec3.dot(this.initialRay.direction,v)<0?-1:1,I=a.vec3.length(v)*E,T=(0,u.convertFromBase)(I,y);this.triggerEditValueChange({value:T,isLength:!0});var S=(0,p.getDevicePixelRatio)(),P=this.shaftLengthPx*n*S,_=this.ray.evaluate(this.offset+P),M=t.projectWorldPointToCanvas(_),D=N(t.projectWorldPointToCanvas(c),M);M[0]=D.x+M[0]/(0,p.getDevicePixelRatio)(),M[1]=D.y+M[1]/(0,p.getDevicePixelRatio)(),this.triggerEditOriginChange(M[0],M[1]),this.displacementGraphics||(this.displacementGraphics=new w(this.viewer,this)),this.displacementGraphics.updateGraphics(t,d,I)}this.setTransform(m)}},t.prototype.removeDisplacementMeshIncrements=function(){this.displacementGraphics&&this.displacementGraphics.removeMeshIncrement(S)},t}(O);function R(e,t,i,r,n,o){o=o||h.GBTManipulatorStyleEnum.DEFAULT;var s=e.point,c=e.evaluate(t),l=a.vec3.cross(e.direction,n.getForward(),a.vec3.create());a.vec3.normalize(l);var u=a.vec3.add(a.vec3.scale(l,i,a.vec3.create()),c),d=a.vec3.add(a.vec3.scale(l,-i,a.vec3.create()),c),p=e.evaluate(t+r),g={};if(o!==h.GBTManipulatorStyleEnum.SECONDARY)g.lines=(0,f.createLines)([s,c,u,d,u,p,d,p]);else{var m=e.evaluate(t+.5*r),y=a.vec3.add(a.vec3.scale(l,i,a.vec3.create()),m),v=a.vec3.add(a.vec3.scale(l,-i,a.vec3.create()),m);g.lines=(0,f.createLines)([s,c,u,d,u,m,d,m,y,v,y,p,v,p])}var E=a.vec3.add(a.vec3.scale(l,-i,a.vec3.create()),s),I=a.vec3.add(a.vec3.scale(l,-i,a.vec3.create()),p),T=a.vec3.add(a.vec3.scale(l,i,a.vec3.create()),s);return g.pickArea=(0,f.createQuad)(E,I,T),g}function N(e,t){var i=a.vec3.subtract(t,e,a.vec3.create());i=a.vec3.normalize(i,a.vec3.create());var r=Math.atan2(-i[1],i[0]),n={x:y.getNumber("MANIPULATOR_EDIT_VIEW_ORIGIN_X_OFFSET"),y:y.getNumber("MANIPULATOR_EDIT_VIEW_ORIGIN_Y_OFFSET")};return Math.abs(r)>=Math.PI/2&&(n.x=-(n.x+75)),r>=0&&(n.y=-(30+n.y)),n}t.Linear=A,t.createArrowPrimitives=R;var w=function(e){function t(t,i){var r=e.call(this,t)||this;return r.parent=i,r}return(0,r.__extends)(t,e),t.prototype.updateGraphics=function(e,t,i){var r=y.getNumber("MANIPULATOR_LINEAR_START_LINE_LENGTH_PX"),n=e.getPixelSizeAtWorldPoint(this.parent.initialRay.point),o=a.vec3.normalize(t,a.vec3.create());o=a.vec3.scale(o,n*r,a.vec3.create());var s=a.vec3.add(this.parent.initialRay.point,o,a.vec3.create());o=a.vec3.scale(o,-1);var c=a.vec3.add(this.parent.initialRay.point,o,a.vec3.create()),l=(0,f.createLines)([this.parent.initialRay.point,this.parent.initialRay.evaluate(i),s,c]);(0,f.addColorToIncrement)(y.getColor("MANIPULATOR_DISPLACEMENT_COLOR"),l),(0,f.addSizeToIncrement)(y.getNumber("MANIPULATOR_DISPLACEMENT_LINE_WIDTH"),l),this.updateMeshIncrement(S,f.NO_SELECTION_ID,l,P)},t}(f.UIElement);t.LinearDisplacement=w;var b=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.direction0=[1,0,0],r.direction1=[0,1,0],r.normal=[0,0,1],r.visualGapPx=0,r.sideLengthPx=0,r.dragOffset=[0,0],r.origin=a.vec3.create(),r.offset=a.vec2.create(),r.dragDelta=a.vec2.create(),r.setFadeParameters(y.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_START"),y.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_END")),r}return(0,r.__extends)(t,e),t.prototype.updateGeometry=function(){this.meshIncrement=(0,f.createLines)([a.vec3.createFrom(0,0,0),a.vec3.createFrom(1,0,0),a.vec3.createFrom(1,0,0),a.vec3.createFrom(1,1,0),a.vec3.createFrom(1,1,0),a.vec3.createFrom(0,1,0),a.vec3.createFrom(0,1,0),a.vec3.createFrom(0,0,0)]),this.pickIncrement=(0,f.createQuad)(a.vec3.createFrom(0,0,0),a.vec3.createFrom(1,0,0),a.vec3.createFrom(0,1,0))},t.prototype.setVisualGap=function(e){this.visualGapPx=e},t.prototype.setSideLength=function(e){this.sideLengthPx=e},t.prototype.getOffsetFromEvent=function(e){var t=e.camera.getRay(e.mouseX,e.mouseY),i=a.vec3.create(),r=[this.normal[0],this.normal[1],this.normal[2],-a.vec3.dot(this.normal,this.origin)],n=(0,f.intersectRayPlane)(t,r);return null===n?null:[a.vec3.dot(a.vec3.subtract(n,this.origin,i),this.direction0),a.vec3.dot(a.vec3.subtract(n,this.origin,i),this.direction1)]},t.prototype.onDragStart=function(t,i,r){var n=this.getOffsetFromEvent(i);this.displayEditView&&((0,s.getCommandDispatcher)().trigger(o.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,f.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)),n&&(this.dragOffset=a.vec2.subtract(n,this.offset,a.vec2.create()),e.prototype.onDragStart.call(this,t,i,r))},t.prototype.onDrag=function(e,t){if(!this.isLocked){var i=this.getOffsetFromEvent(t);if(i){this.offset=a.vec2.subtract(i,this.dragOffset,a.vec2.create());for(var r=0;r<this.offset.length;r++)t.shiftKey||(this.offset[r]=this.getLinearSnapValue(t,this.offset[r],this.origin)),this.offset[r]=parseFloat(this.offset[r].toFixed(this.offsetRoundDecimals));this.trigger(m.ManipulatorEvents.VALUE_CHANGED,this.offset,t),(0,f.requestDraw)()}}},t.prototype.updateDefinition=function(e,t,i,r){this.origin=e,this.direction0=t,this.direction1=i,(0,d.areUnitVectorsParallel)(this.direction0,this.direction1)?c.log.warn("Trying to create a planar manipulator with two parallel directions"):this.normal=a.vec3.normalize(a.vec3.cross(this.direction0,this.direction1,a.vec3.create())),this.offset=r,(0,f.requestDraw)()},t.prototype.getOffset=function(){return this.offset},t.prototype.evaluatePosition=function(e,t){return a.vec3.add(a.vec3.scale(this.direction0,e,a.vec3.create()),a.vec3.add(a.vec3.scale(this.direction1,t,a.vec3.create()),this.origin))},t.prototype.getOffsetPosition=function(){return this.evaluatePosition(this.offset[0],this.offset[1])},t.prototype.updateGraphics=function(t){e.prototype.updateGraphics.call(this,t);var i=Math.acos(Math.min(Math.abs(a.vec3.dot(t.getForward(),this.normal)),1)),r=this.isBeingManipulated()?1:1-(0,f.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,i);if(this.updateColor(r),!this.isHidden){var n=t.getPixelSizeAtWorldPoint(this.getOffsetPosition()),o=this.visualGapPx*n,s=this.sideLengthPx*n,c=this.evaluatePosition(this.offset[0]+o,this.offset[1]+o),l=a.vec3.scale(this.direction0,s,a.vec3.create()),u=a.vec3.scale(this.direction1,s,a.vec3.create()),h=this.normal,d=a.mat4.createFrom(l[0],l[1],l[2],0,u[0],u[1],u[2],0,h[0],h[1],h[2],0,c[0],c[1],c[2],1);this.setTransform(d)}},t}(O);t.Planar=b;var L=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.zeroAngleDirection=[1,0,0],r.upDirection=[0,1,0],r.angle=0,r.angleRelativeToInitialZeroDirection=0,r.angleRelativeToInitialZeroDirectionForEdit=0,r.isClockWiseRotation=!0,r.radius=0,r.radialOffsetPx=0,r.dragOffset=0,r.disableMinimumOffset=!1,r.axis=new f.Ray([0,0,0],[0,0,1]),r.initialZeroAngleDirection=r.zeroAngleDirection,r.initialUpDirection=r.upDirection,r.minAngle=-Math.PI,r.maxAngle=Math.PI,r.minDisplayAngle=-Math.PI,r.maxDisplayAngle=Math.PI,r.setFadeParameters(y.getNumber("MANIPULATOR_ANGULAR_FADE_ANGLE_START"),y.getNumber("MANIPULATOR_ANGULAR_FADE_ANGLE_END")),r}return(0,r.__extends)(t,e),t.prototype.updateGeometry=function(){this.meshIncrement=(0,f.createCircle)(a.vec3.createFrom(0,0,0),1,a.vec3.createFrom(0,0,1),y.getNumber("MANIPULATOR_CIRCLE_SEGMENTS"));var e=y.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS_SCALE"),t=Math.abs(Math.atan(1/e)),i=y.getNumber("MANIPULATOR_ANGULAR_HANDLE_SUBTENSION_FACTOR"),r=y.getNumber("MANIPULATOR_ANGULAR_HANDLE_ARC_SEGMENTS"),n=(0,f.createArc)(a.vec3.createFrom(-e,0,0),e,a.vec3.createFrom(0,0,1),a.vec3.createFrom(1,0,0),t,i*t,r);this.meshIncrement=this.meshIncrement.concatenate(n);var o=(0,f.createArc)(a.vec3.createFrom(-e,0,0),e,a.vec3.createFrom(0,0,1),a.vec3.createFrom(1,0,0),-t,-i*t,r);this.meshIncrement=this.meshIncrement.concatenate(o);var s=6*e*t;this.pickIncrement=(0,f.createQuad)(a.vec3.createFrom(-1,s/2,0),a.vec3.createFrom(-1,-s/2,0),a.vec3.createFrom(1,s/2,0))},t.prototype.setAngle=function(e){this.angle=e},t.prototype.setRadialOffset=function(e){this.radialOffsetPx=e},t.prototype.getMousePlanePosition=function(e){var t=[this.axis.direction[0],this.axis.direction[1],this.axis.direction[2],-a.vec3.dot(this.axis.point,this.axis.direction)],i=e.camera.getRay(e.mouseX,e.mouseY);return(0,f.intersectRayPlane)(i,t)},t.prototype.getAngleFromEvent=function(e,t,i,r,n,o,s){var c=this.getMousePlanePosition(e);if(!c)return null;var l=a.vec3.subtract(c,this.axis.point),u=a.vec3.dot(l,i),h=a.vec3.dot(l,r);if(u*u+h*h<g.Tolerances.ZERO_LENGTH*g.Tolerances.ZERO_LENGTH)return null;var d=Math.atan2(h,u)+t;return(0,f.closestAngleInRange)(d,n,o,s)},t.prototype.onDefaultUnitsChanged=function(){this.hasEditView&&this.createEditView()},t.prototype.createEditView=function(){var e=new h.BTMParameterQuantity;e.parameterId="angle",e.units=(0,l.getCurrentDocumentSettingsModel)().getAngleUnits(),e.value=this.angle;var t=new h.BTQuantityRange;t.minValue=Math.max(0,B(this.minDisplayAngle)),t.maxValue=Math.max(0,B(this.maxDisplayAngle)),t.units=e.units;var i={paramQuantity:e,quantityType:h.GBTQuantityType.ANGLE,range:t};(0,s.getCommandDispatcher)().trigger(o.commands.CREATE_MANIPULATOR_EDIT_VIEW,this,i,this.viewer)},t.prototype.onDragStart=function(t,i,r){this.dragOffset=this.angle-this.getAngleFromEvent(i,0,this.zeroAngleDirection,this.upDirection,this.angle,this.minAngle,this.maxAngle),e.prototype.onDragStart.call(this,t,i,r),this.displayEditView&&!this.hasEditView&&(this.createEditView(),this.initialZeroAngleDirection=a.vec3.create(this.zeroAngleDirection),this.initialUpDirection=a.vec3.create(this.upDirection),this.trigger(m.ManipulatorEvents.CACHE_TRANSFORM),this.isClockWiseRotation=this.dragOffset>0,this.angleRelativeToInitialZeroDirectionForEdit=0,(0,f.getManipulatorDisplacementDisplayManager)().setActiveManipulator(this))},t.prototype.onEditChange=function(e){var t=Math.abs(F(e.value));this.isClockWiseRotation?this.angleRelativeToInitialZeroDirectionForEdit=t:this.angleRelativeToInitialZeroDirectionForEdit=-t,this.trigger(m.ManipulatorEvents.VALUE_EDITED)},t.prototype.getSnapAngle=function(e,t){var i=e.camera,r=y.getNumberArray("MANIPULATOR_ANGULAR_SNAP_DIVISOR"),n=y.getNumber("MANIPULATOR_ANGULAR_SNAP_RESOLUTION_PX"),o=this.getMousePlanePosition(e),s=0;if(o)for(var c=i.getUnitSizeAtWorldPoint(o)/(0,p.getDevicePixelRatio)(),l=a.vec3.subtract(o,this.axis.point),u=a.vec3.length(l);s<r.length;++s){if(u*(Math.PI/r[s])*c<=n)break}var h=r[s]*t/Math.PI,d=Math.round(h),g=d-h,f=y.getNumber("MANIPULATOR_ANGULAR_SNAP_ANGLE_DEVIATION");return f*=1+s/r.length,Math.abs(g)<=f&&(t=d*Math.PI/r[s]),t},t.prototype.onDrag=function(e,t){if(!this.isLocked){var i=this.getAngleFromEvent(t,this.dragOffset,this.zeroAngleDirection,this.upDirection,this.angle,this.minAngle,this.maxAngle);if(null!==i){if(this.angle=i,this.angle=parseFloat(this.angle.toFixed(this.offsetRoundDecimals)),t.shiftKey||(this.angle=this.getSnapAngle(t,this.angle)),this.angle=(0,f.clamp)(this.angle,this.minAngle,this.maxAngle),this.hasEditView){var r=this.getAngleFromEvent(t,this.dragOffset,this.initialZeroAngleDirection,this.initialUpDirection,this.angleRelativeToInitialZeroDirectionForEdit,this.minDisplayAngle,this.maxDisplayAngle);if(null!==r){this.isClockWiseRotation=r>0;var n=(0,f.angleBetweenVectors)(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction)+this.angle;n<this.minDisplayAngle?n=(0,f.closestAngleGreaterThanOrEqual)(n,this.minDisplayAngle):n>this.maxDisplayAngle&&(n=(0,f.closestAngleLessThanOrEqual)(n,this.maxDisplayAngle)),this.angleRelativeToInitialZeroDirection=r,this.angleRelativeToInitialZeroDirectionForEdit=n}}this.trigger(m.ManipulatorEvents.VALUE_CHANGED,this.angle,t),(0,f.requestDraw)()}}},t.prototype.updateDefinition=function(e,t,i,r,n){var o;if(this.isBeingManipulated()&&(o=a.vec3.add(a.vec3.scale(this.zeroAngleDirection,Math.cos(this.angle),a.vec3.create()),a.vec3.scale(this.upDirection,Math.sin(this.angle),a.vec3.create()))),this.axis=new f.Ray(e,t),this.zeroAngleDirection=a.vec3.normalize(i,a.vec3.create()),this.radius=r,this.upDirection=a.vec3.cross(this.axis.direction,this.zeroAngleDirection,a.vec3.create()),a.vec3.normalize(this.upDirection),n||(n=0),this.isBeingManipulated()&&o){var s=a.vec3.dot(o,this.zeroAngleDirection),c=a.vec3.dot(o,this.upDirection);if(s*s+c*c<g.Tolerances.ZERO_LENGTH*g.Tolerances.ZERO_LENGTH)this.angle=n;else{var l=Math.atan2(c,s);this.angle=(0,f.closestAngleInRange)(l,this.angle,this.minAngle,this.maxAngle)}}else this.angle=n;(0,f.requestDraw)()},t.prototype.updateLimits=function(e,t){this.minAngle=e,this.maxAngle=t},t.prototype.updateEditLimits=function(e,t){this.minDisplayAngle=e,this.maxDisplayAngle=t},t.prototype.setDisableMinimumOffset=function(e){this.disableMinimumOffset=e},t.prototype.getAngle=function(){return this.angle},t.prototype.getEditAngle=function(){return this.angleRelativeToInitialZeroDirectionForEdit},t.prototype.getEditAngleDisplacement=function(){var e=(0,f.angleBetweenVectors)(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction);if(this.maxDisplayAngle-this.minDisplayAngle>2*Math.PI&&(0,f.sign)(e)!==(0,f.sign)(this.angleRelativeToInitialZeroDirection)){var t=2*Math.PI-Math.abs(e);e=(0,f.sign)(this.angleRelativeToInitialZeroDirection)*t}var i=Math.abs(e)-Math.abs(this.angleRelativeToInitialZeroDirectionForEdit);return this.angleRelativeToInitialZeroDirection<0&&(i=-i),i},t.prototype.getAxis=function(){return this.axis},t.prototype.getZeroAngleDirection=function(){return this.zeroAngleDirection},t.prototype.getPosition=function(e,t){var i=Math.cos(e)*t,r=Math.sin(e)*t,n=a.vec3.create(),o=a.vec3.create();return a.vec3.add(a.vec3.scale(this.zeroAngleDirection,i,n),a.vec3.add(a.vec3.scale(this.upDirection,r,o),this.axis.point))},t.prototype.updateEditBoxPosition=function(e){var t=e.getPixelSizeAtWorldPoint(this.axis.point),i=(0,p.getDevicePixelRatio)(),r=(y.getNumber("MANIPULATOR_ANGULAR_ARROW_SHAFT_LENGTH_PX")+y.getNumber("MANIPULATOR_ANGULAR_ARROW_RADIUS_PX")+y.getNumber("MANIPULATOR_ANGULAR_ARROW_LENGTH_PX")+2*y.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS")*i+2*y.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS")*i)*t,n=this.getPosition(0,r),o=e.projectWorldPointToCanvas(this.axis.point),s=e.projectWorldPointToCanvas(n),a=N(o,s);s[0]=a.x+s[0]/(0,p.getDevicePixelRatio)(),s[1]=a.y+s[1]/(0,p.getDevicePixelRatio)(),this.triggerEditOriginChange(s[0],s[1])},t.prototype.updateGraphics=function(t){e.prototype.updateGraphics.call(this,t);var i=Math.acos(Math.abs(a.vec3.dot(t.getForward(),this.axis.direction))),r=this.isBeingManipulated()?1:1-(0,f.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,i);if(this.updateColor(r),!this.isHidden){var n=t.getPixelSizeAtWorldPoint(this.axis.point),o=this.axis.point,s=this.radius+n*this.radialOffsetPx,c=this.getPosition(this.angle,s),l=y.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS")*n,u=c,h=a.vec3.scale(a.vec3.normalize(a.vec3.subtract(c,o,a.vec3.create())),l),d=a.vec3.normalize(this.axis.direction,a.vec3.create()),m=a.vec3.cross(d,h,a.vec3.create()),v=a.mat4.createFrom(h[0],h[1],h[2],0,m[0],m[1],m[2],0,d[0],d[1],d[2],0,u[0],u[1],u[2],1),E=(0,p.getDevicePixelRatio)();if(a.mat4.scale(v,a.vec3.createFrom(E,E,E)),this.hasEditView){this.updateEditBoxPosition(t);var I=0;if(this.isDragging)I=this.angleRelativeToInitialZeroDirectionForEdit;else{var T=(0,f.angleBetweenVectors)(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction);this.maxDisplayAngle-this.minDisplayAngle>2*Math.PI&&(T=Math.abs(this.angleRelativeToInitialZeroDirectionForEdit)>g.Tolerances.ZERO_ANGLE?function(e,t,i,r){var n=(0,f.angleBetweenVectors)(e,t,i);r?n<0&&(n=2*Math.PI+n):n>0&&(n=-1*(2*Math.PI-n));return n}(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction,this.isClockWiseRotation):this.angleRelativeToInitialZeroDirectionForEdit),I=T}var _=Math.abs(B(I));this.triggerEditValueChange({value:_,isLength:!1});var M=y.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS_SCALE")-1.5,D=y.getNumber("MANIPULATOR_ANGULAR_HANDLE_SUBTENSION_FACTOR")*Math.abs(Math.atan(1/M)),C=2*y.getNumber("MANIPULATOR_CIRCLE_SEGMENTS"),O=I<0?D:-D,A=a.vec3.createFrom(-M,0,0),R=(0,f.createArc)(A,M,a.vec3.createFrom(0,0,1),a.vec3.createFrom(1,0,0),O,-I,C),N=a.vec3.create(),w=a.vec3.createFrom(0,1,0),b=a.vec3.createFrom(1,0,0),L=M*Math.cos(-I),F=M*Math.sin(-I);a.vec3.add(A,a.vec3.add(a.vec3.scale(w,F,a.vec3.create()),a.vec3.scale(b,L,a.vec3.create()),N),N);var x=new f.Ray(A,a.vec3.subtract(A,N,a.vec3.create())),U=y.getNumber("MANIPULATOR_ANGULAR_START_LINE_LENGTH_FACTOR"),G=(0,f.createLines)([x.evaluate(-M+U),x.evaluate(-M-U)]);R=R.concatenate(G),(0,f.addColorToIncrement)(y.getColor("MANIPULATOR_DISPLACEMENT_COLOR"),R),(0,f.addSizeToIncrement)(y.getNumber("MANIPULATOR_DISPLACEMENT_LINE_WIDTH"),R),this.updateMeshIncrement(S,f.NO_SELECTION_ID,R,P)}this.setTransform(v)}},t.prototype.dragByIncrementValue=function(e){var t=this.viewer.getCamera(),i=t.getPixelSizeAtWorldPoint(this.axis.point),r=this.getClampedRadius(i,!0),n=t.projectWorldPointToCanvas(this.getPosition(this.angle,r)),o={mouseX:n[0],mouseY:n[1],camera:t};this.onDragStart(null,o,{requestDrag:!1}),e=F(e),n=t.projectWorldPointToCanvas(this.getPosition(this.angle+e,r)),o.mouseX=n[0],o.mouseY=n[1],this.onDrag(null,o),this.onDragStop(null,o)},t.prototype.getClampedRadius=function(e,t){if(this.disableMinimumOffset)return this.radius;var i=this.radius,r=y.getNumber("MANIPULATOR_ANGULAR_MINIMUM_RADIUS_PX")*e;return i<r&&(i=r),t&&(i+=e*this.radialOffsetPx),i},t}(O);function F(e){return e="degree"===(0,l.getCurrentDocumentSettingsModel)().getAngleUnits()?e*Math.PI/180:e}function B(e){return e="degree"===(0,l.getCurrentDocumentSettingsModel)().getAngleUnits()?180*e/Math.PI:e}t.Angular=L;var x=function(e){function t(t){return e.call(this,t)||this}return(0,r.__extends)(t,e),t.prototype.updateGraphics=function(e){var t=Math.abs(a.vec3.dot(e.getForward(),this.axis.direction));t>1?t=1:t<-1&&(t=-1);var i=Math.acos(t),r=this.isBeingManipulated()?1:1-(0,f.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,i);if(r<=0)this.removeMeshIncrements();else{var n=e.getPixelSizeAtWorldPoint(this.axis.point),o=this.getClampedRadius(n,!0),s=this.getPosition(this.angle,o),c=Math.cos(this.angle),l=Math.sin(this.angle),u=a.vec3.add(a.vec3.scale(this.zeroAngleDirection,-l,a.vec3.create()),a.vec3.scale(this.upDirection,c,a.vec3.create()));this.angle<0&&a.vec3.negate(u);var h=R(new f.Ray(s,u),y.getNumber("MANIPULATOR_ANGULAR_ARROW_SHAFT_LENGTH_PX")*n,y.getNumber("MANIPULATOR_ANGULAR_ARROW_RADIUS_PX")*n,y.getNumber("MANIPULATOR_ANGULAR_ARROW_LENGTH_PX")*n,e,this.style);this.updateLines("linear",h.lines,r),this.updatePickArea(h.pickArea);var d=this.getClampedRadius(n,!1),p=d+y.getNumber("MANIPULATOR_ANGULAR_ARROW_LEADER_EXTENSION_PX")*n,g=this.getPosition(0,p),m=this.getPosition(this.angle,p),v=(0,f.createLines)([this.axis.point,g,this.axis.point,m]);this.updateLines("leaders",v,.5*r);var E=Math.abs(this.angle)*d/n,I=(0,f.createArc)(this.axis.point,d,this.axis.direction,this.zeroAngleDirection,0,this.angle,Math.floor(E/10));this.updateLines("arc",I,.5*r),!this.isHidden&&this.hasEditView&&this.updateEditBoxPosition(e)}},t}(L);t.AngularWithArrow=x;var U=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.position=[0,0,0],r.dragPlane=[0,0,1,0],r.lastMouseRay=new f.Ray([0,0,0],[1,0,0]),r}return(0,r.__extends)(t,e),t.prototype.updateGeometry=function(){var e=y.getNumber("MANIPULATOR_CIRCLE_SEGMENTS");this.meshIncrement=(0,f.createCircle)(a.vec3.createFrom(0,0,0),1,a.vec3.createFrom(0,0,1),e),this.pickIncrement=(0,f.createDisc)(a.vec3.createFrom(0,0,0),1,a.vec3.createFrom(0,0,1),e)},t.prototype.onDragStart=function(t,i,r){if(this.isEnabled){this.displayEditView&&((0,s.getCommandDispatcher)().trigger(o.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,f.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null));var n=i.camera.getForward();this.dragPlane=[n[0],n[1],n[2],a.vec3.dot(n,this.position)],e.prototype.onDragStart.call(this,t,i,r)}},t.prototype.onDrag=function(e,t){if(!this.isLocked){this.lastMouseRay=t.camera.getRay(t.mouseX,t.mouseY);var i=(0,f.intersectRayPlane)(this.lastMouseRay,this.dragPlane);i&&(this.position=i,this.trigger(m.ManipulatorEvents.VALUE_CHANGED,this.position,t.mouseX,t.mouseY,t),(0,f.requestDraw)())}},t.prototype.getLastMouseRay=function(){return this.lastMouseRay},t.prototype.updateDefinition=function(e){this.position=e,(0,f.requestDraw)()},t.prototype.updateGraphics=function(t){if(e.prototype.updateGraphics.call(this,t),this.updateColor(),!this.isHidden){var i=t.getPixelSizeAtWorldPoint(this.position),r=y.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX")*i,n=this.position,o=a.vec3.scale(t.getForward(),-1,a.vec3.create()),s=a.vec3.scale(t.getRight(),r,a.vec3.create()),c=a.vec3.scale(t.getUp(),r,a.vec3.create()),l=a.mat4.createFrom(s[0],s[1],s[2],0,c[0],c[1],c[2],0,o[0],o[1],o[2],0,n[0],n[1],n[2],1);this.setTransform(l)}},t}(O);t.FreeDrag=U;var G=new f.NodeProperties({isVisible:!0,isPickable:!0,isShowThrough:!0,isDepthTested:!1,priority:f.RenderOrderPriority.DEFAULT,primitiveType:f.PrimitiveType.POINTS}),H=new f.NodeProperties(Object.assign({},G,{priority:f.RenderOrderPriority.HIGHEST})),V=function(e){function t(i){var r=e.call(this,i)||this;return r.points=[],r.hoveredPointIndex=t.NO_SELECTED_INDEX,r.selectedPointIndex=t.NO_SELECTED_INDEX,r}return(0,r.__extends)(t,e),t.prototype.updateDefinition=function(e,t){this.selectedPointIndex=t,this.points=e,this.updatePointGraphics()},t.prototype.updatePointGraphics=function(){this.removeMeshIncrements(),this.stopListening(this);for(var e=y.getNumber("MANIPULATOR_POINT_SIZE_PX"),t=y.getPointFont("MANIPULATOR_POINT_FONT"),i=0;i<this.points.length;++i){var r="point"+i,n=this.getSelectionIdForIndex(i),o=(0,f.createPoint)(this.points[i],r,this.getPointColor(i),e,t);this.updateMeshIncrement(r,n,o,this.getPointNodeProperties(i)),this.listenTo(this,f.UiEvents.MOUSE_ENTER+n,this.onMouseEnter),this.listenTo(this,f.UiEvents.MOUSE_LEAVE+n,this.onMouseLeave),this.listenTo(this,f.UiEvents.CLICK+n,this.onClick)}},t.prototype.onViewWillDraw=function(e,t){},t.prototype.onMouseEnter=function(e,t){this.isEnabled&&this.setHoveredPoint(this.getIndexForSelection(e))},t.prototype.onMouseLeave=function(e,i){this.isEnabled&&(this.getIndexForSelection(e)===this.hoveredPointIndex&&this.setHoveredPoint(t.NO_SELECTED_INDEX))},t.prototype.onClick=function(e,t){if(this.isEnabled){var i=this.getIndexForSelection(e);this.selectedPointIndex!==i&&this.setSelectedPoint(i)}},t.prototype.getSelectionIdForIndex=function(e){return""+e},t.prototype.getIndexForSelection=function(e){return+e.selectionId},t.prototype.getPointColor=function(e){return e===this.selectedPointIndex?y.getColor("MANIPULATOR_OUTLINE_DRAG_COLOR"):e===this.hoveredPointIndex?y.getColor("MANIPULATOR_OUTLINE_HOVER_COLOR"):y.getColor("MANIPULATOR_OUTLINE_COLOR")},t.prototype.getPointNodeProperties=function(e){return e===this.selectedPointIndex||e===this.hoveredPointIndex?H:G},t.prototype.setHoveredPoint=function(e){this.hoveredPointIndex!==e&&(this.hoveredPointIndex=e,this.updatePointGraphics())},t.prototype.setSelectedPoint=function(e){this.selectedPointIndex!==e&&(this.selectedPointIndex=e,this.trigger(m.ManipulatorEvents.VALUE_CHANGED,this.selectedPointIndex),this.updatePointGraphics())},t.NO_SELECTED_INDEX=-1,t}(O);t.PointSelection=V;var k=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scale=1,r.dragScale=1,r.minScale=1e-5,r.maxScale=1e3,r.ray=new f.Ray([0,0,0],[0,0,1]),r.gapLengthPx=y.getNumber("MANIPULATOR_LINEAR_SHAFT_LENGTH_PX")*Math.sqrt(2),y.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"),r.headLengthPx=y.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"),r.isDraggable=!i||!i.hasOwnProperty("isDraggable")||i.isDraggable,r.setFadeParameters(y.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_START"),y.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_END")),r}return(0,r.__extends)(t,e),t.prototype.updateGeometry=function(){this.meshIncrement=(0,f.createArrow)(a.vec3.createFrom(0,0,this.gapLengthPx),a.vec3.createFrom(0,0,1),a.vec3.createFrom(1,0,0),0,this.headLengthPx,this.headLengthPx/Math.sqrt(3)),this.pickIncrement=(0,f.createQuad)(a.vec3.createFrom(-this.headLengthPx/2,0,this.gapLengthPx),a.vec3.createFrom(this.headLengthPx/2,0,this.gapLengthPx),a.vec3.createFrom(-this.headLengthPx/2,0,this.gapLengthPx+this.headLengthPx))},t.prototype.setGapLength=function(e){this.gapLengthPx=e},t.prototype.setHeadLength=function(e){this.headLengthPx=e},t.prototype.setIsDraggable=function(e){this.isDraggable=e},t.prototype.getMousePlanePosition=function(e){var t=[this.normal[0],this.normal[1],this.normal[2],-a.vec3.dot(this.ray.point,this.normal)],i=e.camera.getRay(e.mouseX,e.mouseY);return(0,f.intersectRayPlane)(i,t)},t.prototype.createEditView=function(){var e=new h.BTMParameterQuantity;e.parameterId="scale",e.units="",e.value=this.scale;var t=new h.BTQuantityRange;t.minValue=this.minScale,t.maxValue=this.maxScale,t.units="";var i={paramQuantity:e,quantityType:h.GBTQuantityType.REAL,range:t};(0,s.getCommandDispatcher)().trigger(o.commands.CREATE_MANIPULATOR_EDIT_VIEW,this,i,this.viewer)},t.prototype.onDragStart=function(t,i,r){var n=this.getMousePlanePosition(i);if(n){var o=a.vec3.subtract(n,this.ray.point,a.vec3.create());this.originToInitialLength=a.vec3.length(o),this.dragScale=this.scale,e.prototype.onDragStart.call(this,t,i,r),this.displayEditView&&!this.hasEditView&&(this.createEditView(),(0,f.getManipulatorDisplacementDisplayManager)().setActiveManipulator(this))}},t.prototype.onEditChange=function(e){this.scale=Math.max(0,e.value),this.trigger(m.ManipulatorEvents.VALUE_EDITED)},t.prototype.getScaleFromEvent=function(e){var t=this.getMousePlanePosition(e),i=a.vec3.subtract(t,this.ray.point,a.vec3.create());return a.vec3.length(i)/this.originToInitialLength},t.prototype.onDrag=function(e,t){this.isLocked||this.isDraggable&&(this.scale=this.dragScale*this.getScaleFromEvent(t),this.scale=parseFloat(this.scale.toFixed(this.offsetRoundDecimals)),this.trigger(m.ManipulatorEvents.VALUE_CHANGED,this.scale,t),(0,f.requestDraw)())},t.prototype.resetScale=function(){this.scale=1},t.prototype.updateDefinition=function(e,t,i){this.ray=new f.Ray(e,i),this.normal=t,(0,f.requestDraw)()},t.prototype.getScale=function(){return this.scale},t.prototype.updateGraphics=function(t){e.prototype.updateGraphics.call(this,t);var i=Math.acos(Math.min(Math.abs(a.vec3.dot(t.getForward(),this.normal)),1)),r=this.isBeingManipulated()?1:1-(0,f.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,i);if(this.updateColor(r),!this.isHidden){var n=t.getPixelSizeAtWorldPoint(this.ray.point),o=this.isBeingDragged?this.scale/this.dragScale:1,s=this.ray.point,c=a.vec3.scale(a.vec3.normalize(this.ray.direction,a.vec3.create()),o*n),l=a.vec3.scale(a.vec3.normalize(a.vec3.cross(t.getForward(),c,a.vec3.create())),o*n),u=a.vec3.scale(a.vec3.normalize(a.vec3.cross(c,l,a.vec3.create())),o*n),h=a.mat4.createFrom(l[0],l[1],l[2],0,u[0],u[1],u[2],0,c[0],c[1],c[2],0,s[0],s[1],s[2],1);if(this.hasEditView){this.triggerEditValueChangeNoUnit({value:this.scale});var d=(0,p.getDevicePixelRatio)(),g=this.gapLengthPx*n*d,m=this.ray.evaluate(g),y=t.projectWorldPointToCanvas(m),v=N(t.projectWorldPointToCanvas(s),y);y[0]=v.x+y[0]/(0,p.getDevicePixelRatio)(),y[1]=y[1]/(0,p.getDevicePixelRatio)(),this.triggerEditOriginChange(y[0],y[1])}this.setTransform(h)}},t}(O);t.ScalingManipulator=k},144788:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTextureMaterial=t.DEFAULT_MATERIAL=t.UNLIT_COLOR_FROM_ATTRIBUTE=t.Material=void 0;var r=i(423650),n=i(311611),o=i(73055),s=i(601759),a=new n.NumberIdManager,c=function(){function e(e){this.ambientTextureFactor=0,this.ambientTexture=null,this.shaderId=null,this.customFloatUniformSettings=null;var t=o.default.getManager();this.color=t.getColor("DEFAULT_MATERIAL_COLOR"),this.specularColor=t.getColor("DEFAULT_SPECULAR"),this.diffuseFactor=t.getNumber("COLOR_DIFFUSE_FACTOR"),this.ambientFactor=t.getNumber("COLOR_AMBIENT_FACTOR"),this.shininess=t.getNumber("DEFAULT_SHININESS"),this.translucentPassAlpha=t.getNumber("TRANSLUCENT_PASS_ALPHA"),this.pointSize=t.getNumber("DEFAULT_POINT_SIZE"),this.pointFont=t.getPointFont("DEFAULT_POINT_FONT"),this.lineWidth=t.getNumber("DEFAULT_LINE_WIDTH"),this.lineStipple=t.getStipple("DEFAULT_LINE_STIPPLE"),e&&((0,s.overwriteMatchingProperties)(this,e),e.hasOwnProperty("ambientTexture")&&!e.hasOwnProperty("ambientTextureFactor")&&(this.ambientTextureFactor=1)),this.id=a.getId(),this.specularColor=this.specularColor.slice(0,3),this.highlightSpecularContribution=t.getNumber("HIGHLIGHT_SPECULAR_CONTRIBUTION")}return e.prototype.destroy=function(){a.isIdValid(this.id)&&(a.freeId(this.id),this.id=n.INVALID_NUMBER_ID)},e.prototype.makeSceneDebugObject=function(){return(0,n.makeSceneDebugObjectFromObject)(this,"Material "+this.id)},e.prototype.setCustomFloatUniform=function(e,t){this.customFloatUniformSettings||(this.customFloatUniformSettings=new r.FastIteratorMap),this.customFloatUniformSettings.set(e,t)},e.prototype.setAttributes=function(e,t){if(e&&(t.setLastBufferBound(null),e.vertexAttrib4fv(n.AttributeNames.COLOR,this.color),e.uniform3fv("uSpecular",this.specularColor),e.uniform1f("uShininess",this.shininess),e.uniform1f("uColorDiffuseFactor",this.diffuseFactor),e.uniform1f("uColorAmbientFactor",this.ambientFactor),this.ambientTexture?(this.ambientTexture.viewer=t.viewer,e.useTexture("uAmbientTexture",this.ambientTexture)):e.useBlankTexture("uAmbientTexture"),e.uniform1f("uAmbientTextureFactor",this.ambientTextureFactor),e.uniform1f("uTranslucentPassAlpha",this.translucentPassAlpha),e.uniform1f("uHighlightSpecularContribution",this.highlightSpecularContribution),this.customFloatUniformSettings))for(var i=this.customFloatUniformSettings.getKeyValues(),r=0;r<i.length;r+=2)e.setFloatUniform(i[r],i[r+1])},e.prototype.hasTransparency=function(){return this.color[3]<1||!!this.ambientTexture&&this.ambientTexture.getHasTransparency()},e.prototype.getExtendedShaderId=function(){return this.shaderId},e}();t.Material=c,t.UNLIT_COLOR_FROM_ATTRIBUTE=new c({ambientFactor:1,diffuseFactor:0,specularColor:[0,0,0]}),t.DEFAULT_MATERIAL=new c,t.createTextureMaterial=function(e){return new c({ambientTexture:e||null,diffuseFactor:0,ambientFactor:1,specularColor:[0,0,0]})}},553944:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEulerAnglesFromMatrix=t.toRotationMat=t.isUnitVector=t.vec4FromVec3=t.getPerpendicularBisector2d=t.distanceSquaredBetweenPoints=t.distanceSquaredToLineSegment2d=t.getIntersectionParameters=t.intersectTwoLineSegments2d=t.intersectLineSegmentRay=t.intersectTwoLines2d=t.difference2d=t.crossProduct2d=t.isMatrixIdentity=t.areMatricesEqual=t.areVectorsEqual=t.toDegrees=t.toRadians=t.smoothstep=t.interpolateInArray=t.mix=t.clamp=t.planeToWorld=t.worldToPlane=t.intersectRayTriangle=t.intersectRaySphere=t.intersectRayBox=t.intersectRayPlane=t.intersectRayPlaneMatrix=t.unprojectVectorToWorld=t.unprojectPlaneToWorld=t.projectWorldToPlane=t.extractPlaneFromMatrix=t.closestPointOnLine=t.projectToLine=t.getCosineOfAngleBetweenTwoVectors=t.Ray=t.isValidForBounding=t.BoundingBox=t.BoundingBox2D=t.BoundingSpot=t.intervalsOverlap=t.floorTowardsZero=t.ceilAwayFromZero=t.angleBetweenVectors=t.LARGEST_REPRESENTABLE_INTEGER=t.NUMBER_INTEGER_BITS=t.are2dPointsEqual=t.IDENTITY_MATRIX=t.canPointBeDisplayed=void 0,t.packedNormalsToFloatArray=t.isFiniteVector=t.isFinite=t.getNextPowerOfTwo=t.closestAngleInRange=t.closestAngleLessThanOrEqual=t.closestAngleGreaterThanOrEqual=t.closestAngle=t.getAngle=t.getPointAtAngle=t.getScaleFromMatrix=t.createTileViewportMatrix=t.createPickMatrix=t.createOffsetTileViewportMatrix=t.getMatrixFromEulerAngles=void 0;var r=i(911748),n=i(311517),o=i(673290),s=[0,0,0];function a(e,t,i,r){return!(e>t||i>r)&&(e<i?i<t-o.Tolerances.ZERO_LENGTH:e<r-o.Tolerances.ZERO_LENGTH)}window.glMatrixArrayType=Array,t.canPointBeDisplayed=function(e){return r.vec3.squaredLength(e)<Math.pow(o.Tolerances.MAX_MODEL_SIZE,2)},t.IDENTITY_MATRIX=r.mat4.identity(r.mat4.create()),t.are2dPointsEqual=function(e,t){return r.vec2.squaredLength(r.vec2.subtract(e,t,r.vec2.create()))<o.Tolerances.ZERO_LENGTH_SQUARED},t.NUMBER_INTEGER_BITS=53,t.LARGEST_REPRESENTABLE_INTEGER=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:9007199254740991,t.angleBetweenVectors=function(e,t,i){var n=r.vec3.dot(e,t),o=r.vec3.dot(r.vec3.cross(e,t,r.vec3.create()),r.vec3.normalize(i,r.vec3.create()));return Math.atan2(o,n)},t.ceilAwayFromZero=function(e){return e<0?Math.floor(e):Math.ceil(e)},t.floorTowardsZero=function(e){return e<0?Math.ceil(e):Math.floor(e)},t.intervalsOverlap=a,function(e){e[e.LOW=0]="LOW",e[e.MID=.5]="MID",e[e.HIGH=1]="HIGH"}(t.BoundingSpot||(t.BoundingSpot={}));var c=function(){function e(){this.reset()}return e.prototype.isInitialized=function(){for(var e=0;e<2;++e)if(this.min[e]>this.max[e])return!1;return!0},e.prototype.reset=function(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]},e.prototype.set=function(e,t){r.vec2.set(e,this.min),r.vec2.set(t,this.max)},e.prototype.copyFrom=function(e){this.set(e.min,e.max)},e.prototype.add=function(e){for(var t=e.length,i=0;i<t;++i)for(var r=0;r<2;++r)e[i][r]<this.min[r]&&(this.min[r]=e[i][r]),e[i][r]>this.max[r]&&(this.max[r]=e[i][r])},e.prototype.addPoint=function(e){for(var t=0;t<2;++t)e[t]<this.min[t]&&(this.min[t]=e[t]),e[t]>this.max[t]&&(this.max[t]=e[t])},e.prototype.addPointXY=function(e,t){e<this.min[0]&&(this.min[0]=e),e>this.max[0]&&(this.max[0]=e),t<this.min[1]&&(this.min[1]=t),t>this.max[1]&&(this.max[1]=t)},e.prototype.addBox=function(e){if(e.isInitialized())for(var t=0;t<2;++t)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])},e.prototype.getDimensions=function(){return r.vec2.subtract(this.max,this.min,r.vec2.create())},e.prototype.overlapsWith=function(e){return a(this.min[0],this.max[0],e.min[0],e.max[0])&&a(this.min[1],this.max[1],e.min[1],e.max[1])},e.prototype.contains=function(e){return e[0]>=this.min[0]&&e[1]>=this.min[1]&&e[0]<=this.max[0]&&e[1]<=this.max[1]},e.prototype.makeCenteredBoxOnPoint=function(e,t){var i=.5*t;this.min[0]=e[0]-i,this.min[1]=e[1]-i,this.max[0]=e[0]+i,this.max[1]=e[1]+i},e.prototype.center=function(e){return e=e||r.vec2.create(),r.vec2.scale(r.vec2.add(this.min,this.max,e),.5)},e.prototype.getCorners=function(e){if(!e){e=[];for(var t=0;t<4;++t)e.push(r.vec2.create())}for(var i=0;i<2;++i)for(var n=0;n<2;++n){var o=e[2*n+i];o[0]=0===i?this.min[0]:this.max[0],o[1]=0===n?this.min[1]:this.max[1]}return e},e.prototype.translate=function(e){r.vec2.add(this.min,e,this.min),r.vec2.add(this.max,e,this.max)},e}();t.BoundingBox2D=c;var l=[0,0,0],u=function(){function e(e,t){this.min=r.vec3.create(),this.max=r.vec3.create(),void 0!==e&&void 0!==t?this.set(e,t):this.reset()}return e.prototype.clone=function(){return new e(this.min,this.max)},e.prototype.toString=function(){return"min: "+this.min+", max: "+this.max},e.prototype.makeSceneDebugObject=function(){var e="BoundingBox: ";if(this.isInitialized()){for(var t=[],i=[],r=0;r<3;++r)t.push(this.min[r].toFixed(5)),i.push(this.max[r].toFixed(5));e+="(min: "+t+", max: "+i+")"}else e+="(Uninitialized)";return{text:e,children:[]}},e.prototype.getMin=function(){return r.vec3.create(this.min)},e.prototype.getMax=function(){return r.vec3.create(this.max)},e.prototype.set=function(e,t){r.vec3.set(e,this.min),r.vec3.set(t,this.max)},e.prototype.copyFrom=function(e){this.set(e.min,e.max)},e.prototype.reset=function(){this.set([1/0,1/0,1/0],[-1/0,-1/0,-1/0])},e.prototype.equals=function(e){for(var t=0;t<3;++t)if(this.min[t]!==e.min[t]||this.max[t]!==e.max[t])return!1;return!0},e.prototype.setInfinite=function(){this.set([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},e.prototype.isInitialized=function(){for(var e=0;e<3;++e)if(this.min[e]>this.max[e])return!1;return!0},e.prototype.isInfinite=function(){for(var e=0;e<3;++e)if(this.min[e]===-1/0||this.max[e]===1/0)return!0;return!1},e.prototype.isFinite=function(){return this.isInitialized()&&!this.isInfinite()},e.prototype.areBoundDimensionsSmallerThan=function(e){for(var t=0;t<3;++t)if(this.max[t]-this.min[t]>=e)return!1;return!0},e.prototype.addPoint=function(e){for(var t=0;t<3;++t)e[t]<this.min[t]&&(this.min[t]=e[t]),e[t]>this.max[t]&&(this.max[t]=e[t])},e.prototype.addXYZ=function(e,t,i){e<this.min[0]&&(this.min[0]=e),e>this.max[0]&&(this.max[0]=e),t<this.min[1]&&(this.min[1]=t),t>this.max[1]&&(this.max[1]=t),i<this.min[2]&&(this.min[2]=i),i>this.max[2]&&(this.max[2]=i)},e.prototype.addPointArray=function(e){for(var t=0;t<e.length;++t)for(var i=0;i<3;++i)e[t][i]<this.min[i]&&(this.min[i]=e[t][i]),e[t][i]>this.max[i]&&(this.max[i]=e[t][i])},e.prototype.createTransformedCopy=function(t){var i=new e;return i.addBox(this,t),i},e.prototype.addBox=function(e,t,i){if(e&&e.isInitialized())if(e.isInfinite())this.setInfinite();else{if(i&&h.copyFrom(this),!t||O(t))this.addXYZ(e.min[0],e.min[1],e.min[2]),this.addXYZ(e.max[0],e.max[1],e.max[2]);else for(var n=[e.min,e.max],o=0;o<2;o++)for(var s=0;s<2;s++)for(var a=0;a<2;a++){var c=[n[o][0],n[s][1],n[a][2]];r.mat4.multiplyVec3(t,c),this.addPoint(c)}i&&!p(this)&&this.copyFrom(h)}},e.prototype.getCorners=function(){var e=[this.min,this.max],t=[];if(!this.isInitialized())return null;for(var i=0;i<2;i++)for(var r=0;r<2;r++)for(var n=0;n<2;n++)t.push([e[i][0],e[r][1],e[n][2]]);return t},e.prototype.getLocationInBox=function(e,t,i){return[_(this.min[0],this.max[0],e),_(this.min[1],this.max[1],t),_(this.min[2],this.max[2],i)]},e.prototype.isExtensive=function(){for(var e=0;e<3;e++)if(Math.abs(this.max[e]-this.min[e])>o.Tolerances.ZERO_LENGTH)return!0;return!1},e.prototype.center=function(e){e||(e=r.vec3.create());var t=r.vec3.add(this.min,this.max,e);return r.vec3.scale(t,.5),t},e.prototype.diagonalVector=function(e){return e||(e=r.vec3.create()),r.vec3.subtract(this.max,this.min,e)},e.prototype.diameter=function(){return r.vec3.length(r.vec3.subtract(this.max,this.min,l))},e.prototype.maxDimension=function(){var e=r.vec3.subtract(this.max,this.min,r.vec3.create());return Math.max(Math.abs(e[0]),Math.max(Math.abs(e[1]),Math.abs(e[2])))},e.prototype.scale=function(e){var t=this.center();r.vec3.subtract(this.max,t),r.vec3.scale(this.max,e),r.vec3.add(this.max,t),r.vec3.subtract(this.min,t),r.vec3.scale(this.min,e),r.vec3.add(this.min,t)},e.prototype.dilate=function(e){var t=r.vec3.createFrom(e,e,e);r.vec3.add(this.max,t),r.vec3.subtract(this.min,t)},e}();t.BoundingBox=u;var h=new u,d=!1;function p(e){return!!e&&(!!e.isInitialized()&&(!!e.areBoundDimensionsSmallerThan(o.Tolerances.MAX_BOUNDS_DIMENSION)||(d||(n.log.info("Found scenegraph node with very large bounds. It will be omitted from bounds computation"),d=!0),!1)))}t.isValidForBounding=p;var g=function(){function e(e,t){this.point=r.vec3.create(e),this.direction=r.vec3.normalize(t,r.vec3.create())}return e.prototype.setPoint=function(e){this.point=r.vec3.create(e)},e.prototype.setDirection=function(e){this.direction=r.vec3.normalize(e,r.vec3.create())},e.prototype.evaluate=function(e,t){return r.vec3.add(r.vec3.scale(this.direction,e,t||r.vec3.create()),this.point)},e.prototype.findClosestPositionToOtherRay=function(e){var t=r.vec3.dot(this.direction,this.direction),i=r.vec3.dot(this.direction,e.direction),n=r.vec3.dot(e.direction,e.direction),s=t*n-i*i;if(Math.abs(s)<o.Tolerances.ZERO_ANGLE)return null;var a=r.vec3.subtract(this.point,e.point,r.vec3.create()),c=r.vec3.dot(this.direction,a);return(i*r.vec3.dot(e.direction,a)-n*c)/s},e.prototype.findPositionOfPoint=function(e){return r.vec3.dot(this.direction,r.vec3.subtract(e,this.point,r.vec3.create()))},e}();function f(e,t,i){var r=i[0],n=i[1],o=(r*t[0]-r*e[0]+n*t[1]-n*e[1])/(r*r+n*n);t[0]=r*o+e[0],t[1]=n*o+e[1]}function m(e){var t=r.vec3.create();t[0]=e[8],t[1]=e[9],t[2]=e[10];var i=r.vec3.create();i[0]=e[12],i[1]=e[13],i[2]=e[14];var n=r.vec3.dot(t,i),o=new Float32Array(4);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=-n,o}function y(e,t,i){var n=r.vec3.dot(e.point,t),s=r.vec3.dot(e.direction,t);if(i=i||o.Tolerances.ZERO_ANGLE,Math.abs(s)<i)return null;var a=-(n+t[3])/s;return r.vec3.linComb(e.point,1,e.direction,a,r.vec3.create())}t.Ray=g,t.getCosineOfAngleBetweenTwoVectors=function(e,t){var i=e[0]*t[0]+e[1]*t[1],r=Math.sqrt(e[0]*e[0]+e[1]*e[1]),n=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return r<=o.Tolerances.ZERO_LENGTH||n<=o.Tolerances.ZERO_LENGTH?null:i/(r*n)},t.projectToLine=f,t.closestPointOnLine=function(e,t,i){var n=r.vec3.subtract(t,e,r.vec3.create()),o=(r.vec3.dot(i,n)-r.vec3.dot(e,n))/r.vec3.squaredLength(n);return o<=0?(n[0]=e[0],n[1]=e[1],n[2]=e[2]):o>=1?(n[0]=t[0],n[1]=t[1],n[2]=t[2]):r.vec3.add(r.vec3.scale(n,o),e),n},t.extractPlaneFromMatrix=m,t.projectWorldToPlane=function(e,t){var i=new Float32Array(4),n=new Float32Array(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1,[(i=r.mat4.multiplyVec4(t,n,i))[0],i[1],i[2]]},t.unprojectPlaneToWorld=function(e,t){var i=new Float32Array(4),n=new Float32Array(4);return n[0]=e[0],n[1]=e[1],n[2]=0,n[3]=1,[(i=r.mat4.multiplyVec4(t,n,i))[0],i[1],i[2]]},t.unprojectVectorToWorld=function(e,t){var i=new Float32Array(4),n=new Float32Array(4);return n[0]=e[0],n[1]=e[1],n[2]=0,n[3]=0,[(i=r.mat4.multiplyVec4(t,n,i))[0],i[1],i[2]]},t.intersectRayPlaneMatrix=function(e,t,i){return y(e,m(t),i)},t.intersectRayPlane=y;var v=r.vec3.create(),E=r.vec3.create(),I=r.vec3.create(),T=r.vec3.create(),S=r.vec3.create();function P(e,t,i){return Math.min(i,Math.max(e,t))}function _(e,t,i){return(1-i)*e+i*t}t.intersectRayBox=function(e,t,i){var n,o=!0,s=v,a=E,c=I;for(n=0;n<3;++n)e.point[n]<t.min[n]?(s[n]=1,c[n]=t.min[n],o=!1):e.point[n]>t.max[n]?(s[n]=0,c[n]=t.max[n],o=!1):s[n]=2;if(o)return i=i||r.vec3.create(),r.vec3.set(e.point,i),i;for(n=0;n<3;++n)2!==s[n]&&0!==e.direction[n]?a[n]=(c[n]-e.point[n])/e.direction[n]:a[n]=-1;var l=0;for(n=1;n<3;++n)a[l]<a[n]&&(l=n);if(a[l]<0)return null;for(i=i||r.vec3.create(),n=0;n<3;++n)if(l!==n){if(i[n]=e.point[n]+a[l]*e.direction[n],i[n]<t.min[n]||i[n]>t.max[n])return null}else i[n]=c[n];return i},t.intersectRaySphere=function(e,t,i,n){var s=r.vec3.dot(e.direction,e.direction),a=2*e.direction[0]*(e.point[0]-t[0])+2*e.direction[1]*(e.point[1]-t[1])+2*e.direction[2]*(e.point[2]-t[2]),c=a*a-4*s*(r.vec3.dot(t,t)+r.vec3.dot(e.point,e.point)-2*r.vec3.dot(t,e.point)-i*i);if(c<-o.Tolerances.ZERO_LENGTH_SQUARED)return null;if(Math.abs(c)<o.Tolerances.ZERO_LENGTH_SQUARED){var l=-a/2*s;return e.evaluate(l,n)}var u=(-a-(c=Math.sqrt(c)))/(2*s);return u<0&&(-a+c)/(2*s)<0?null:u<0?r.vec3.set(e.point,n||r.vec3.create()):e.evaluate(u,n)},t.intersectRayTriangle=function(e,t,i,n){var o=1e-6,s=v,a=E,c=I,l=T,u=S;r.vec3.subtract(i,t,s),r.vec3.subtract(n,t,a),r.vec3.cross(e.direction,a,c);var h=r.vec3.dot(s,c);if(!(h>-o&&h<o)){var d=1/h;r.vec3.subtract(e.point,t,u);var p=r.vec3.dot(u,c)*d;if(!(p<0||p>1)){r.vec3.cross(u,s,l);var g=r.vec3.dot(e.direction,l)*d;if(!(g<0||p+g>1)){var f=r.vec3.dot(a,l);return f>o?f:void 0}}}},t.worldToPlane=function(e,t,i,n){var o=r.vec3.subtract(e,t,r.vec3.create());return[r.vec3.dot(o,n),r.vec3.dot(o,r.vec3.cross(i,n,r.vec3.create()))]},t.planeToWorld=function(e,t,i,n){var o=r.vec3.normalize(n,r.vec3.create()),s=r.vec3.scale(o,e[0],r.vec3.create()),a=r.vec3.scale(r.vec3.cross(i,o,r.vec3.create()),e[1],r.vec3.create());return r.vec3.add(t,r.vec3.add(s,a,r.vec3.create()),r.vec3.create())},t.clamp=P,t.mix=_,t.interpolateInArray=function(e,t){if(e&&0!==e.length){var i=(t-Math.floor(t))*e.length,r=Math.floor(i),n=(r+1)%e.length,o=i-r;return _(e[r],e[n],o)}},t.smoothstep=function(e,t,i){return(i=P((i-e)/(t-e),0,1))*i*(3-2*i)};var M=Math.PI/180,D=180/Math.PI;function C(e,t){if(e===t)return!0;var i=!!e;if(i!==!!t)return!1;if(!i)return!0;if(e.length!==t.length)return!1;for(var r=0;r<e.length;++r)if(Math.abs(e[r]-t[r])>=o.Tolerances.ZERO_LENGTH)return!1;return!0}function O(e){return!!e&&(0,t.areMatricesEqual)(e,t.IDENTITY_MATRIX)}function A(e,t){return e[0]*t[1]-e[1]*t[0]}function R(e,t){return[e[0]-t[0],e[1]-t[1]]}function N(e,t,i,r,n){var s=A(t,r);if(Math.abs(s)<o.Tolerances.ZERO_LENGTH)return!1;var a=R(i,e);return n[0]=A(a,r)/s,n[1]=A(a,t)/s,!0}function w(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}t.toRadians=function(e){return e*M},t.toDegrees=function(e){return e*D},t.areVectorsEqual=C,t.areMatricesEqual=C,t.isMatrixIdentity=O,t.crossProduct2d=A,t.difference2d=R,t.intersectTwoLines2d=function(e,t,i,r,n){var o=[];return!!N(e,t,i,r,o)&&(n[0]=e[0]+o[0]*t[0],n[1]=e[1]+o[0]*t[1],!0)},t.intersectLineSegmentRay=function(e,t,i,r,n){var o=[];return!!N(e,t,i,[r[0]-i[0],r[1]-i[1]],o)&&(o[0]>=0&&o[1]>=0&&o[1]<=1&&(n[0]=i[0]+o[0]*t[0],n[1]=i[1]+o[0]*t[1],!0))},t.intersectTwoLineSegments2d=function(e,t,i,r,n){var o=[t[0]-e[0],t[1]-e[1]],s=[];return!!N(e,o,i,[r[0]-i[0],r[1]-i[1]],s)&&(s[0]>=0&&s[0]<=1&&s[1]>=0&&s[1]<=1&&(n[0]=e[0]+s[0]*o[0],n[1]=e[1]+s[0]*o[1],!0))},t.getIntersectionParameters=N,t.distanceSquaredToLineSegment2d=function(e,t,i){var r=[i[0],i[1]];return f(e,r,[t[0]-e[0],t[1]-e[1]]),r[0]<=Math.max(e[0],t[0])&&r[0]>=Math.min(e[0],t[0])&&r[1]<=Math.max(e[1],t[1])&&r[1]>=Math.min(e[1],t[1])?w(i,r):Math.min(w(i,e),w(i,t))},t.distanceSquaredBetweenPoints=w,t.getPerpendicularBisector2d=function(e,t,i,r){i[0]=(e[0]+t[0])/2,i[1]=(e[1]+t[1])/2;var n=[t[0]-e[0],t[1]-e[1]],s=[n[1],-n[0]],a=Math.sqrt(s[0]*s[0]+s[1]*s[1]);return!(a<o.Tolerances.ZERO_LENGTH)&&(r[0]=s[0]/a,r[1]=s[1]/a,!0)},t.vec4FromVec3=function(e,t){return[e[0],e[1],e[2],t]},t.isUnitVector=function(e){return Math.abs(1-r.vec3.squaredLength(e))<=o.Tolerances.ZERO_LENGTH_SQUARED},t.toRotationMat=function(e,t){return t||(t=r.mat4.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=0,t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};var b=[0,0,0];function L(e,t,i,n){var o=r.mat4.identity(),s=t[2]/e[2],a=t[3]/e[3];r.mat4.scale(o,[s,a,1]);var c=e[0]-i+e[2]/2,l=e[1]-n+e[3]/2,u=1-2*c/t[2],h=2*l/t[3]-1;return r.mat4.translate(o,[u,h,0]),o}function F(e,t){for(var i=0;i<3;++i){for(var n=0;n<3;++n)s[n]=e[4*i+n];t[i]=r.vec3.length(s)}}function B(e,t){return e-2*Math.round((e-t)/(2*Math.PI))*Math.PI}function x(e,t){return e-2*Math.floor((e-t)/(2*Math.PI))*Math.PI}function U(e,t){return e+2*Math.floor((t-e)/(2*Math.PI))*Math.PI}function G(e){for(var t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}t.getEulerAnglesFromMatrix=function(e,t){if(F(e,b),Math.abs(1-Math.abs(e[2]/b[0]))>o.Tolerances.ZERO_ANGLE){t[1]=-Math.asin(e[2]/b[0]);var i=Math.cos(t[1]);t[0]=Math.atan2(e[6]/(i*b[1]),e[10]/(i*b[2])),t[2]=Math.atan2(e[1]/(i*b[0]),e[0]/(i*b[0]))}else t[2]=0,e[2]<0?(t[1]=Math.PI/2,t[0]=t[2]+Math.atan2(e[4]/b[1],e[8]/b[2])):(t[1]=-Math.PI/2,t[0]=-t[2]+Math.atan2(-e[4]/b[1],-e[8]/b[2]))},t.getMatrixFromEulerAngles=function(e){var t=Math.cos(e[0]),i=Math.sin(e[0]),n=Math.cos(e[1]),o=Math.sin(e[1]),s=Math.cos(e[2]),a=Math.sin(e[2]),c=r.mat4.identity();return c[0]=n*s,c[1]=n*a,c[2]=-o,c[4]=i*o*s-t*a,c[5]=i*o*a+t*s,c[6]=i*n,c[8]=t*o*s+i*a,c[9]=t*o*a-i*s,c[10]=t*n,c},t.createOffsetTileViewportMatrix=L,t.createPickMatrix=function(e,t,i){var r=i-(t[1]+t[3]);return L(e,t,t[0],r)},t.createTileViewportMatrix=function(e,t){return L(e,t,0,0)},t.getScaleFromMatrix=F,t.getPointAtAngle=function(e,t,i){var r=Math.cos(i),n=Math.sin(i);return[e[0]+r*t,e[1]+n*t]},t.getAngle=function(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])},t.closestAngle=B,t.closestAngleGreaterThanOrEqual=x,t.closestAngleLessThanOrEqual=U,t.closestAngleInRange=function(e,t,i,r){var n;return r-i<2*Math.PI?(n=x(e,i))>r&&(n=x(n,r)-r>x(i,n)-n?i:r):(n=B(e,t))>r?n=x(n,i):n<i&&(n=U(n,r)),n},t.getNextPowerOfTwo=function(e){for(var t=1;t<e;)t*=2;return t},t.isFinite=function(e){return e.length?G(e):Number.isFinite(e)},t.isFiniteVector=G;var H=1023,V=1/511;function k(e){return e>511?e-1024:e}t.packedNormalsToFloatArray=function(e,t){for(var i=new Float32Array(3*e.length),r=0,n=0;n<e.length;++n){var o=t?t[n]*V:V,s=0|e[n];i[r++]=k(s&H)*o,i[r++]=k(s>>10&H)*o,i[r++]=k(s>>20&H)*o}return i}},141855:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AngleDisplay=t.DistanceDisplay=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(311611),a=new s.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,primitiveType:s.PrimitiveType.LINES}),c=new s.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,primitiveType:s.PrimitiveType.POINTS}),l=n.default.CONSTANT_DEFAULTS,u=n.default.getManager(),h="distanceedge",d=function(e){function t(t,i,r){var n=e.call(this,r)||this;return n.startPoint=t,n.endPoint=i,n.drawDeltaP=!1,n.drawStartPointP=!1,n.drawEndPointP=!1,n.drawDistanceP=!1,n.deltaPoint=o.vec3.subtract(i,t,o.vec3.create()),n.distance=o.vec3.length(n.deltaPoint),n.distanceColor=u.getColor("PROJECT_MEASUREMENT_DISTANCE_COLOR"),n.componentColors=[u.getColor("X_AXIS_COLOR"),u.getColor("Y_AXIS_COLOR"),u.getColor("Z_AXIS_COLOR")],n.measurementStipple=u.getStipple("PROJECT_MEASUREMENT_STIPPLE"),n.pointSize=l.PROJECT_MEASUREMENT_POINT_SIZE,n.lineWidth=l.PROJECT_MEASUREMENT_DISTANCE_LINE_WIDTH,n}return(0,r.__extends)(t,e),t.prototype.onViewWillDraw=function(e,t){this.updateGraphics()},t.prototype.updateGraphics=function(){if(this.drawDistanceP||this.drawDeltaP){var e=[this.deltaPoint[0],0,0],t=[0,this.deltaPoint[1],0],i=o.vec3.add(this.startPoint,e,o.vec3.create()),r=o.vec3.add(i,t,o.vec3.create()),n=this.endPoint;if(this.drawDeltaP){var l=(0,s.createLine)(this.startPoint,i);(0,s.addColorToIncrement)(this.componentColors[0],l),(0,s.addSizeToIncrement)(this.lineWidth,l),(0,s.addStyleToIncrement)(this.measurementStipple,l),this.updateMeshIncrement("xedge",s.NO_SELECTION_ID,l,a);var u=(0,s.createLine)(i,r);(0,s.addColorToIncrement)(this.componentColors[1],u),(0,s.addSizeToIncrement)(this.lineWidth,u),(0,s.addStyleToIncrement)(this.measurementStipple,u),this.updateMeshIncrement("yedge",s.NO_SELECTION_ID,u,a);var d=(0,s.createLine)(r,n);(0,s.addColorToIncrement)(this.componentColors[2],d),(0,s.addSizeToIncrement)(this.lineWidth,d),(0,s.addStyleToIncrement)(this.measurementStipple,d),this.updateMeshIncrement("zedge",s.NO_SELECTION_ID,d,a)}if(this.drawDistanceP){var p=(0,s.createLine)(this.startPoint,this.endPoint);(0,s.addColorToIncrement)(this.distanceColor,p),(0,s.addSizeToIncrement)(this.lineWidth,p),(0,s.addStyleToIncrement)(this.measurementStipple,p),this.updateMeshIncrement(h,s.NO_SELECTION_ID,p,a)}}else if(this.drawStartPointP&&this.startPoint){var g=(0,s.createPoint)(this.startPoint,"startPoint",this.distanceColor,this.pointSize);this.updateMeshIncrement("point0",s.NO_SELECTION_ID,g,c)}else if(this.drawEndPointP&&this.endPoint){var f=(0,s.createPoint)(this.endPoint,"endPoint",this.distanceColor,this.pointSize);this.updateMeshIncrement("point1",s.NO_SELECTION_ID,f,c)}},t.prototype.setPermanentlyHighlightDistance=function(e){this.permanentlyHighlightDistance=e},t.prototype.drawNothing=function(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!1,this.drawEndPointP=!1,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()},t.prototype.drawDelta=function(){this.removeMeshIncrements(),this.drawDeltaP=!0,this.drawStartPointP=!1,this.drawEndPointP=!1,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()},t.prototype.drawStartPoint=function(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!0,this.drawEndPointP=!1,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()},t.prototype.drawEndPoint=function(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!1,this.drawEndPointP=!0,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()},t.prototype.drawDistance=function(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!1,this.drawEndPointP=!1,this.drawDistanceP=!0,this.viewer.requestDraw()},t.prototype.drawAngle=function(){},t.prototype.callMethod=function(e){switch(e){case"drawAngle":this.drawAngle();break;case"drawDistance":this.drawDistance();break;case"drawDelta":this.drawDelta();break;case"drawStartPoint":this.drawStartPoint();break;case"drawEndPoint":this.drawEndPoint();break;default:this.drawNothing()}},t.prototype.getValue=function(){return this.distance},t.prototype.getDeltaPoint=function(){return this.deltaPoint},t.prototype.getStartPoint=function(){return this.startPoint},t.prototype.getEndPoint=function(){return this.endPoint},t}(s.UIElement);t.DistanceDisplay=d;var p=function(e){function t(t,i,r,n,s,a,c){var h=e.call(this,t,i,c)||this;return h.startVector=r,h.endVector=n,h.angle=a,h.isInvalid=!1,h.drawAngleP=!1,h.startLength=o.vec3.length(r),h.startDir=o.vec3.normalize(r,o.vec3.create()),h.endLength=o.vec3.length(n),h.endDir=o.vec3.normalize(n,o.vec3.create()),h.normalDir=s,h.angleColor=u.getColor("PROJECT_MEASUREMENT_ANGLE_COLOR"),h.angleLineWidth=l.PROJECT_MEASUREMENT_ANGLE_LINE_WIDTH,h.measurementStipple=u.getStipple("PROJECT_MEASUREMENT_STIPPLE"),h}return(0,r.__extends)(t,e),t.prototype.getValue=function(){return this.angle},t.prototype.updateGraphics=function(){if(this.drawAngleP){var e=(0,s.createLine)(this.getStartPoint(),this.getEndPoint());(0,s.addColorToIncrement)(this.distanceColor,e),(0,s.addSizeToIncrement)(this.lineWidth,e),(0,s.addStyleToIncrement)(this.measurementStipple,e),this.updateMeshIncrement(h,s.NO_SELECTION_ID,e,a);var t=o.vec3.add(this.getStartPoint(),this.startVector,o.vec3.create()),i=o.vec3.add(this.getStartPoint(),this.endVector,o.vec3.create()),r=o.vec3.add(this.getEndPoint(),this.startVector,o.vec3.create()),n=o.vec3.add(this.getEndPoint(),this.endVector,o.vec3.create()),c=(0,s.createLine)(this.getStartPoint(),t);(0,s.addColorToIncrement)(this.angleColor,c),(0,s.addSizeToIncrement)(this.angleLineWidth,c),this.updateMeshIncrement("edge00",s.NO_SELECTION_ID,c,a);var l=(0,s.createLine)(this.getStartPoint(),i);(0,s.addColorToIncrement)(this.angleColor,l),(0,s.addSizeToIncrement)(this.angleLineWidth,l),(0,s.addStyleToIncrement)(u.getStipple("PROJECT_MEASUREMENT_STIPPLE"),l),this.updateMeshIncrement("edge01",s.NO_SELECTION_ID,l,a);var d=(this.startLength+this.endLength)/4,p=(0,s.createArc)(this.getStartPoint(),d,this.normalDir,this.startDir,0,this.angle,50);(0,s.addColorToIncrement)(this.angleColor,p),(0,s.addSizeToIncrement)(this.angleLineWidth,p),this.updateMeshIncrement("arc0",s.NO_SELECTION_ID,p,a);var g=(0,s.createLine)(this.getEndPoint(),r);(0,s.addColorToIncrement)(this.angleColor,g),(0,s.addSizeToIncrement)(this.angleLineWidth,g),(0,s.addStyleToIncrement)(u.getStipple("PROJECT_MEASUREMENT_STIPPLE"),g),this.updateMeshIncrement("edge10",s.NO_SELECTION_ID,g,a);var f=(0,s.createLine)(this.getEndPoint(),n);(0,s.addColorToIncrement)(this.angleColor,f),(0,s.addSizeToIncrement)(this.angleLineWidth,f),this.updateMeshIncrement("edge11",s.NO_SELECTION_ID,f,a);var m=(0,s.createArc)(this.getEndPoint(),d,this.normalDir,this.startDir,0,this.angle,50);(0,s.addColorToIncrement)(this.angleColor,m),(0,s.addSizeToIncrement)(this.angleLineWidth,m),this.updateMeshIncrement("arc1",s.NO_SELECTION_ID,m,a)}},t.prototype.drawNothing=function(){this.removeMeshIncrements(),this.drawAngleP=!1,(0,s.requestDraw)()},t.prototype.drawAngle=function(){this.removeMeshIncrements(),this.drawAngleP=!0,(0,s.requestDraw)()},t.prototype.drawDistance=function(){},t.prototype.drawDelta=function(){},t.prototype.drawStartPoint=function(){},t.prototype.drawEndPoint=function(){},t}(d);t.AngleDisplay=p},836461:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryGauge=void 0;var r=i(736202),n=i(311611),o=function(){function e(){this.TOTAL_PROPERTY="total",this.BYTE_TO_MB=1/1048576,this.memoryUsage={}}return e.prototype.reset=function(){this.memoryUsage={}},e.prototype.incrementMemoryUsage=function(e,t){if(e===this.TOTAL_PROPERTY)throw'Do not use "'+this.TOTAL_PROPERTY+'" as memory type.';this.memoryUsage.hasOwnProperty(e)?this.memoryUsage[e]+=t:this.memoryUsage[e]=t},e.prototype.decrementMemoryUsage=function(e,t){if(e===this.TOTAL_PROPERTY)throw'Do not use "'+this.TOTAL_PROPERTY+'" as memory type.';this.memoryUsage.hasOwnProperty(e)&&(this.memoryUsage[e]-=t)},e.prototype.addToStatistics=function(){var e=(0,n.getCounters)();for(var t in this.memoryUsage)e.increment("MB "+t,this.memoryUsage[t]*this.BYTE_TO_MB)},e.prototype.getUsageDetails=function(){var e=(0,r.clone)(this.memoryUsage),t=0;for(var i in this.memoryUsage)t+=this.memoryUsage[i];return e[this.TOTAL_PROPERTY]=t,e},e}();t.MemoryGauge=o},270706:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshPointController=void 0;var r=i(423902),n=i(663748),o=i(311611),s=i(712197),a=i(73055),c=i(911748),l=a.default.getManager().getColor("DEFAULT_MATERIAL_COLOR"),u=function(e){return e===(0,s.getPreselectionList)()},h=function(e,t,i){this.pointElement=e,this.highlight=t,this.isPreSelection=i},d=function(e){function t(t){var i=e.call(this)||this;return i.viewer=t,i.meshPoints={},(0,o.viewerCheck)(t),i.addMultipleSelections((0,s.getPreselectionList)()),i.addMultipleSelections((0,s.getSelectionList)()),i.resetSelectionListHandlers(),i}return(0,r.__extends)(t,e),t.prototype.resetSelectionListHandlers=function(){this.listenTo((0,s.getPreselectionList)(),"add",this.onSelectionAdded),this.listenTo((0,s.getPreselectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,s.getPreselectionList)(),"reset",this.onSelectionReset),this.listenTo((0,s.getSelectionList)(),"add",this.onSelectionAdded),this.listenTo((0,s.getSelectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,s.getSelectionList)(),"reset",this.onSelectionReset)},t.prototype.onSelectionAdded=function(e,t){this.addSelection(e,t)},t.prototype.onSelectionReset=function(e){this.deleteAllMeshPoints(u(e)),this.addMultipleSelections(e)},t.prototype.onSelectionRemoved=function(e,t){this.removeSelection(e,t)},t.prototype.addMultipleSelections=function(e){e.each((function(t){this.addSelection(t,e)}),this)},t.prototype.deleteAllMeshPoints=function(e){Object.entries(this.meshPoints).forEach((function(t){var i=(0,r.__read)(t,2),n=i[0];i[1].isPreSelection===e&&this.deleteMeshPoint(n)}),this)},t.prototype.removeSelection=function(e,t){e&&e.isMeshPoint()&&e.id in this.meshPoints&&(u(t)===this.meshPoints[e.id].isPreSelection&&this.deleteMeshPoint(e.id))},t.prototype.deleteMeshPoint=function(e){if(e in this.meshPoints){var t=this.meshPoints[e].pointElement,i=this.meshPoints[e].highlight;this.viewer.getHighlightManager(o.bt_graphics_Usage.BASE).freeHighlightForSelection(i.type,e),t.removeHighlight(i),t.remove(),delete this.meshPoints[e]}},t.prototype.addSelection=function(e,t){if(e&&e.isMeshPoint()){var i=u(t);if(e.id in this.meshPoints){if(i)return;this.deleteMeshPoint(e.id)}var r=this.viewer.getHighlightManager(o.bt_graphics_Usage.BASE).createHighlightForSelection(function(e){return u(e)?o.HighlightType.PRE:o.HighlightType.ENTITY}(t),e.id),n=e.sourcePick?this.viewer.getOccurrenceDataManager().getOccurrenceTransform(e.sourcePick.getOccurrenceId()):null,s=function(e,t,i,r){if(!e)return null;var n=c.vec3.create(e);r&&(n=c.mat4.multiplyVec3(r,n));var s=new o.PointElement(n,o.MAIN_SCENEGRAPH_ID,l,0,i);return s.addHighlight(t),s}(e.getMeshPointData().point,r,this.viewer,n);s&&(this.meshPoints[e.id]=new h(s,r,i))}},t.prototype.destroy=function(){this.deleteAllMeshPoints(!0),this.deleteAllMeshPoints(!1),this.stopListening()},t}(n.BackboneEventsBaseClass);t.MeshPointController=d},416825:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setIncrementOpacity=t.clearPlaneEquationIds=t.getPlaneEquationColor=t.getBitForPlaneEquationId=t.getBitForPlaneEquation=t.getPlaneEquationId=t.hashXYZ=t.hashPoint=t.numberToFixedPointString=t.createTriangleStrip=t.createTriangles=t.addStyleToIncrement=t.addSizeToIncrement=t.addPackedIntegerToIncrement=t.addByteColorToIncrement=t.addColorToIncrement=t.addTextureCoordinateToIncrement=t.addNormalToIncrement=t.addQuadToMesh=t.createWireBox=t.createBox=t.createRoundedRectangle=t.createQuadOutline=t.createQuad=t.createTriangle=t.createRing=t.createDoubleHeadArrow=t.createArrow=t.createArc=t.createCircle=t.createDisc=t.getCirclePoints=t.createPoint=t.addLinesToMesh=t.createLines=t.createLineLoop=t.addLineToMesh=t.createLine=t.makeCone=t.makeCylinder=t.makeSphere=t.createEdgesFromTriangles=t.createEdgesFromTriangleStrip=void 0;var r=i(311517),n=i(911748),o=i(376931),s=i(311611);function a(e,t,i,r,n,o){var a=[e[0],e[1],e[2],t[0],t[1],t[2]],c=new s.MeshIncrement(s.PrimitiveType.LINES,a,[0,1],i);return r&&g(r,c),void 0!==n&&m(n,c),o&&y(o,c),c}function c(e,t,i,r,n){for(var o=new Float32Array(3*e.length),a=new Int32Array(e.length),c=0;c<e.length;++c){a[c]=c;for(var l=0;l<3;++l)o[3*c+l]=e[c][l]}var u=new s.MeshIncrement(s.PrimitiveType.LINES,o,a,t);return i&&g(i,u),void 0!==r&&m(r,u),n&&y(n,u),u}function l(e,t,i,r,s,a,c){var l=s;l||(l=[1,0,0],(0,o.areUnitVectorsParallel)(i,l)&&(l=[0,1,0]));var u=n.vec3.normalize(n.vec3.cross(i,l,n.vec3.create()));l=n.vec3.normalize(n.vec3.cross(u,i,n.vec3.create())),void 0===a&&(a=0),void 0===c&&(c=2*Math.PI);for(var h=new Float32Array(3*(r+1)),d=a,p=(c-a)/r,g=n.vec3.create(),f=n.vec3.create(),m=n.vec3.create(),y=0;y<r+1;++y){var v=t*Math.cos(d),E=t*Math.sin(d);n.vec3.add(e,n.vec3.add(n.vec3.scale(u,E,f),n.vec3.scale(l,v,m),g),g);for(var I=0;I<3;++I)h[3*y+I]=g[I];d+=p}return h}function u(e,t,i,r,o,a){var c,l=n.vec3.subtract(t,e,n.vec3.create()),u=n.vec3.subtract(i,e,n.vec3.create()),h=n.vec3.normalize(n.vec3.cross(l,u,n.vec3.create())),d=new Float32Array(12),p=new Float32Array(12),g=function(e,t){for(var i=0;i<3;++i)d[3*e+i]=t[i],p[3*e+i]=h[i]};if(g(0,e),g(1,t),g(2,n.vec3.add(t,u,n.vec3.create())),g(3,i),o&&a){c=new Float32Array(8);var f=function(e,t,i){c[2*e]=t,c[2*e+1]=i};f(0,o[0],o[1]),f(1,a[0],o[1]),f(2,a[0],a[1]),f(3,o[0],a[1])}var m=new s.MeshIncrement(s.PrimitiveType.TRIANGLES,d,[0,1,2,0,2,3],r);return m.normals=p,m.textureCoordinates=c||null,m}t.createEdgesFromTriangleStrip=function(e,t){for(var i=[],r=0;r<e.indices.length-2;r++)e.indices[r+2]!==e.indices[r+1]&&e.indices[r+1]!==e.indices[r]&&(i.push(e.indices[r]),i.push(e.indices[r+1]),i.push(e.indices[r]),i.push(e.indices[r+2]),i.push(e.indices[r+1]),i.push(e.indices[r+2]));return new s.MeshIncrement(s.PrimitiveType.LINES,e.points,i,t)},t.createEdgesFromTriangles=function(e,t){if(e.primitiveType!==s.PrimitiveType.TRIANGLES)throw new Error("createEdgesFromTriangles can only be called with triangle primitives");for(var i=[],r=0;r<e.indices.length;r+=3)i.push(e.indices[r]),i.push(e.indices[r+1]),i.push(e.indices[r]),i.push(e.indices[r+2]),i.push(e.indices[r+1]),i.push(e.indices[r+2]);return new s.MeshIncrement(s.PrimitiveType.LINES,e.points,i,t)},t.makeSphere=function(e,t){t||(t=12),e||(e=12);var i,r,n=[],o=[],s=[],a=function(e,t,i){n.push(e),n.push(t),n.push(i),o.push(e),o.push(t),o.push(i)};for(a(0,0,1),i=0;i<t;i++){var c=i*Math.PI*2/t,l=Math.cos(c),u=Math.sin(c);for(r=1;r<=e;r++){var h=r*Math.PI/(e+1),d=Math.sin(h);a(d*l,d*u,Math.cos(h))}}a(0,0,-1);var p=function(i,r){return e*(r%t)+i+1},g=function(){s.push(s[s.length-1])};for(i=0;i<t;i++){for(s.length>1&&g(),s.push(0),r=0;r<e;r++)s.push(p(r,i)),s.push(p(r,i+1));s.push(e*t+1),g(),s.length%2==0&&g()}return v(n,s,o)},t.makeCylinder=function(e){(!e||e<3)&&(e=12);var t,i=[],r=[],n=[],o=function(e){var t=Math.cos(e),n=Math.sin(e);i.push(t),i.push(n),i.push(1),r.push(t),r.push(n),r.push(0),i.push(t),i.push(n),i.push(0),r.push(t),r.push(n),r.push(0)};for(t=0;t<e;t++)o(2*Math.PI*t/e);for(t=0;t<e;t++)n.push(2*t),n.push(2*t+1);return n.push(0),n.push(1),v(i,n,r)},t.makeCone=function(e){(!e||e<3)&&(e=12);var t,i=[],r=[],o=[],s=function(e){var t=Math.cos(e),o=Math.sin(e),s=[t,o,1];n.vec3.normalize(s),i.push(0),i.push(0),i.push(1),r.push(s[0]),r.push(s[1]),r.push(s[2]),i.push(t),i.push(o),i.push(0),r.push(s[0]),r.push(s[1]),r.push(s[2])};for(t=0;t<e;t++)s(2*Math.PI*t/e);for(t=0;t<e;t++)o.push(2*t),o.push(2*t+1);return o.push(0),o.push(1),v(i,o,r)},t.createLine=a,t.addLineToMesh=function(e,t,i,r,n,o){e.addIncrement(a(t,i,r,n,o))},t.createLineLoop=function(e,t,i,r){for(var n=new Float32Array(3*e.length),o=new Int32Array(2*e.length),a=0;a<e.length;++a){for(var c=0;c<3;++c)n[3*a+c]=e[a][c];o[2*a]=a,o[2*a+1]=(a+1)%e.length}var l=new s.MeshIncrement(s.PrimitiveType.LINES,n,o,t);return i&&g(i,l),void 0!==r&&m(r,l),l},t.createLines=c,t.addLinesToMesh=function(e,t,i,r,n){e.addIncrement(c(t,i,r,n))},t.createPoint=function(e,t,i,r,n){var o=new s.MeshIncrement(s.PrimitiveType.POINTS,e,[0],t);return i&&g(i,o),void 0!==r&&m(r,o),n&&y(n,o),o},t.getCirclePoints=l,t.createDisc=function(e,t,i,r){var n,o=l(e,t,i,r=Math.floor(Math.max(3,r))),a=o.length/3,c=new Float32Array(3*a);for(n=0;n<a;++n)for(var u=0;u<3;++u)c[3*n+u]=i[u];var h=r-2,d=new Int32Array(3*h);for(n=0;n<h;++n)d[3*n]=0,d[3*n+1]=n+1,d[3*n+2]=n+2;var p=new s.MeshIncrement(s.PrimitiveType.TRIANGLES,o,d);return p.normals=c,p},t.createCircle=function(e,t,i,r){var n,o=l(e,t,i,r=Math.floor(Math.max(3,r))),a=new Int32Array(2*r);for(n=0;n<r;++n)a[2*n]=n,a[2*n+1]=n+1;return a[a.length-1]=0,new s.MeshIncrement(s.PrimitiveType.LINES,o,a)},t.createArc=function(e,t,i,r,n,o,a){for(var c=l(e,t,i,a=Math.floor(Math.max(3,a)),r,n,o),u=new Int32Array(2*a),h=0;h<a;++h)u[2*h]=h,u[2*h+1]=h+1;return new s.MeshIncrement(s.PrimitiveType.LINES,c,u)},t.createArrow=function(e,t,i,r,o,s){var a=e,l=n.vec3.add(n.vec3.scale(t,r,n.vec3.create()),a),u=n.vec3.add(n.vec3.scale(t,o,n.vec3.create()),l),h=n.vec3.add(n.vec3.scale(i,-s,n.vec3.create()),l),d=n.vec3.add(n.vec3.scale(i,s,n.vec3.create()),l);return c([a,l,h,d,h,u,d,u])},t.createDoubleHeadArrow=function(e,t,i,r,o,s){var a=e,l=n.vec3.scale(t,.5*o,n.vec3.create()),u=n.vec3.add(n.vec3.scale(t,r,n.vec3.create()),a),h=n.vec3.add(l,u,n.vec3.create()),d=n.vec3.add(n.vec3.scale(i,-s,n.vec3.create()),u),p=n.vec3.add(n.vec3.scale(i,s,n.vec3.create()),u),g=n.vec3.add(n.vec3.scale(t,o,n.vec3.create()),u),f=n.vec3.add(d,l,n.vec3.create()),m=n.vec3.add(p,l,n.vec3.create());return c([a,u,d,p,d,h,p,h,f,m,f,g,m,g])},t.createRing=function(e,t,i,r,n,o,a,c){c=Math.floor(Math.max(3,c));for(var u=(0,s.concatenateFloat32Arrays)(l(e,t,r,c,n,o,a),l(e,i,r,c,n,o,a)),h=c+1,d=new Int32Array(2*h),g=0;g<h;++g)d[2*g]=g,d[2*g+1]=h+g;var f=new s.MeshIncrement(s.PrimitiveType.TRIANGLE_STRIP,u,d);return p(r,f),f},t.createTriangle=function(e,t,i,r,o,a,c){var l,u=n.vec3.subtract(t,e,n.vec3.create()),h=n.vec3.subtract(i,e,n.vec3.create()),d=n.vec3.normalize(n.vec3.cross(u,h,n.vec3.create())),p=new Float32Array(9),g=new Float32Array(9),f=function(e,t){for(var i=0;i<3;++i)p[3*e+i]=t[i],g[3*e+i]=d[i]};if(f(0,e),f(1,t),f(2,i),o&&a&&c){l=new Float32Array(6);var m=function(e,t,i){l[2*e]=t,l[2*e+1]=i};m(0,o[0],o[1]),m(1,a[0],a[1]),m(2,c[0],c[1])}var y=new s.MeshIncrement(s.PrimitiveType.TRIANGLES,p,[0,1,2],r);return y.normals=g,y.textureCoordinates=l||null,y},t.createQuad=u,t.createQuadOutline=function(e,t,i,r,o){var s=n.vec3.add(e,n.vec3.scale(t,-1,n.vec3.create()),n.vec3.create());n.vec3.add(s,i);var a=n.vec3.add(s,n.vec3.scale(t,2,n.vec3.create()),n.vec3.create()),l=n.vec3.add(s,n.vec3.scale(i,-2,n.vec3.create()),n.vec3.create()),u=n.vec3.add(a,n.vec3.scale(i,-2,n.vec3.create()),n.vec3.create());return c([s,l,l,u,u,a,a,s],"outlineLines",r,o)},t.createRoundedRectangle=function(e,t,i,r,o,a){var c=n.vec3.subtract(t,e,n.vec3.create()),u=n.vec3.subtract(i,e,n.vec3.create()),h=n.vec3.length(c),d=n.vec3.length(u);n.vec3.normalize(c),n.vec3.normalize(u);var p=n.vec3.normalize(n.vec3.cross(c,u,n.vec3.create())),g=n.vec3.add(n.vec3.scale(c,h,n.vec3.create()),n.vec3.scale(u,d,n.vec3.create())),f=n.vec3.add(e,g,n.vec3.create()),m=(n.vec3.add(n.vec3.scale(g,.5,n.vec3.create()),e),n.vec3.add(n.vec3.add(n.vec3.scale(c,r,n.vec3.create()),n.vec3.scale(u,r,n.vec3.create())),e)),y=n.vec3.add(n.vec3.add(n.vec3.scale(c,-r,n.vec3.create()),n.vec3.scale(u,r,n.vec3.create())),t),v=n.vec3.add(n.vec3.add(n.vec3.scale(c,r,n.vec3.create()),n.vec3.scale(u,-r,n.vec3.create())),i),E=n.vec3.add(n.vec3.add(n.vec3.scale(c,-r,n.vec3.create()),n.vec3.scale(u,-r,n.vec3.create())),f),I=4*(o+1),T=new Float32Array(3*I),S=new Float32Array(3*I),P=0,_=function(e,t){for(var i=0;i<3;++i)T[3*e+i]=t[i],S[3*e+i]=p[i]},M=function(e,t,i){for(var n=l(e,r,p,o,c,t,i),s=0;s<n.length/3;++s)_(P++,[n[3*s],n[3*s+1],n[3*s+2]])};M(y,-Math.PI/2,0),M(E,0,Math.PI/2),M(v,Math.PI/2,Math.PI),M(m,-Math.PI,-Math.PI/2);for(var D=[],C=1;C<I-1;++C)D.push(0),D.push(C),D.push(C+1);var O=new s.MeshIncrement(s.PrimitiveType.TRIANGLES,T,D,a);return O.normals=S,O};var h=[0,1,2,3,3,4,4,5,6,7,7,8,8,9,10,11,11,12,12,13,14,15,15,16,16,17,18,19,19,20,20,21,22,23],d=[-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1];function p(e,t){for(var i=t.vertexCount(),r=new Float32Array(3*i),n=0;n<i;++n)for(var o=0;o<3;++o)r[3*n+o]=e[o];t.normals=r}function g(e,t){for(var i=[255,255,255,255],r=0;r<4&&r<e.length;++r)i[r]=255*e[r];f(i,t)}function f(e,t){var i,n=t.vertexCount(),o=new Uint8Array(4*n);if(4===e.length){for(i=0;i<n;++i)for(var s=0;s<4;++s)o[4*i+s]=e[s];t.colors=o}else r.log.warn("Tried to add a color with the wrong number of channels to a mesh increment")}function m(e,t){for(var i=t.vertexCount(),r=new Float32Array(i),n=0;n<i;++n)r[n]=e;t.primitiveSizes=r}function y(e,t){var i,r=t.vertexCount(),n=new Uint8Array(s.Attributes.PRIMITIVE_STYLE.dimension*r),o=[];for(i=0;i<s.Attributes.PRIMITIVE_STYLE.dimension;++i)i<e.length?o.push((0,s.clamp)(Math.round(e[i]),0,255)):o.push(0);for(i=0;i<r;++i)for(var a=0;a<s.Attributes.PRIMITIVE_STYLE.dimension;++a)n[i*s.Attributes.PRIMITIVE_STYLE.dimension+a]=o[a];t.primitiveStyles=n}function v(e,t,i,r){var n=new s.MeshIncrement(s.PrimitiveType.TRIANGLE_STRIP,e,t);return i&&(n.normals=i),r&&g(r,n),n}function E(e){return e.toFixed(10).slice(0,12)}function I(e){return T(e[0],e[1],e[2])}function T(e,t,i){return E(e)+"_"+E(t)+"_"+E(i)}t.createBox=function(e,t){var i=new Float32Array(72),r=0,n=new Float32Array(3),o=function(o,s){n[o]=s?t[o]:e[o];for(var a=0===o?2:1===o?0:1,c=0===o?1:1===o?2:0,l=0;l<2;++l)for(var u=0;u<2;++u)n[a]=s!==(0===u)?e[a]:t[a],n[c]=0===l?e[c]:t[c],i.set(n,4*r*3+3*(2*l+u));++r};o(0,!1),o(0,!0),o(1,!1),o(1,!0),o(2,!1),o(2,!0);var a=new s.MeshIncrement(s.PrimitiveType.TRIANGLE_STRIP,i,h);return a.normals=d,a},t.createWireBox=function(e,t){for(var i=[],r=[e,t],o=0;o<2;o++)for(var s=0;s<2;s++)for(var a=0;a<2;a++)i.push(n.vec3.createFrom(r[o][0],r[s][1],r[a][2]));for(var l=[],u=0;u<i.length;u++)for(var h=u+1;h<i.length;h++){var d=i[u],p=i[h],g=d[0]===p[0],f=d[1]===p[1],m=d[2]===p[2];(g&&f||g&&m||f&&m)&&(l.push(d),l.push(p))}return c(l)},t.addQuadToMesh=function(e,t,i,r,n,o,s){e.addIncrement(u(t,i,r,n,o,s))},t.addNormalToIncrement=p,t.addTextureCoordinateToIncrement=function(e,t){for(var i=t.vertexCount(),r=new Float32Array(2*i),n=0;n<i;++n)for(var o=0;o<2;++o)r[2*n+o]=e[o];t.textureCoordinates=r},t.addColorToIncrement=g,t.addByteColorToIncrement=f,t.addPackedIntegerToIncrement=function(e,t){f((0,s.convertIntToUcharArray)(e),t)},t.addSizeToIncrement=m,t.addStyleToIncrement=y,t.createTriangles=function(e,t,i,r){var n=new s.MeshIncrement(s.PrimitiveType.TRIANGLES,e,t,i);return r&&g(r,n),n},t.createTriangleStrip=v,t.numberToFixedPointString=E,t.hashPoint=I,t.hashXYZ=T;var S={},P=1;function _(e,t){var i=n.vec3.dot(e,t);i<0&&(i=-i,t=n.vec3.createFrom(-t[0],-t[1],-t[2]));var r=I(t)+"_"+E(i);return S[r]||(S[r]=P,P=Math.max((P+1)%24,1)),S[r]}function M(e){var t=(0,s.convertIntToUcharArray)(1<<e);return t[1]<<8|t[2]<<16|t[3]<<24}t.getPlaneEquationId=_,t.getBitForPlaneEquation=function(e,t){return M(_(e,t))},t.getBitForPlaneEquationId=M,t.getPlaneEquationColor=function(e){var t=M(e),i=(0,s.convertIntToUcharArray)(t);return(0,s.convertRGBA255ToRGBA)(i)},t.clearPlaneEquationIds=function(){S={},P=1},t.setIncrementOpacity=function(e,t){var i,r,n=e.vertexCount(),o=new Uint8Array(4*n);for(i=0;i<n;++i)for(var s=0;s<4;++s)r=4*i+s,e.colors?o[r]=e.colors[r]:o[r]=255,(r+1)%4==0&&(o[r]=255*t);return e.colors=o,e}},205105:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DoubleClickHandler=t.MouseEvents=void 0;var r=i(73055),n=i(463943),o=i(311611);t.MouseEvents={mouseup:"mouseup"};var s=function(){function e(e,t){var i=this;this.element=e,this.firstMiddleMouseButtonUp=!1,this.timeOfFirstMiddleMouseUp=-1,this.elementDoubleClickHandler=t,this.mouseUpHandler=function(e){return i.MouseUpHandler(e)},this.setupEventHandlers()}return e.prototype.setupEventHandlers=function(){this.element&&this.element.on(t.MouseEvents.mouseup,this.mouseUpHandler)},e.prototype.off=function(){this.element&&this.element.off(t.MouseEvents.mouseup,this.mouseUpHandler)},e.prototype.resetFirstMiddleButtonUpState=function(){this.firstMiddleMouseButtonUp=!1,this.timeOfFirstMiddleMouseUp=-1},e.prototype.setFirstMiddleButtonUpState=function(){this.firstMiddleMouseButtonUp=!0,this.timeOfFirstMiddleMouseUp=(0,o.getTimeInMilliseconds)()},e.prototype.MouseUpHandler=function(e){if(e.which===n.MouseButton.MIDDLE)if(this.firstMiddleMouseButtonUp){if((0,o.getTimeElapsed)(this.timeOfFirstMiddleMouseUp)<=r.default.getManager().getNumber("MIDDLE_MOUSE_BUTTON_DOUBLE_CLICK_TIMEOUT"))return this.resetFirstMiddleButtonUpState(),void this.elementDoubleClickHandler(e);this.setFirstMiddleButtonUpState()}else this.setFirstMiddleButtonUpState();else this.resetFirstMiddleButtonUpState()},e}();t.DoubleClickHandler=s},567135:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureIdCompound=t.filterEntitiesWithData=t.getEntityPrimitiveType=t.createMeshIncrementForEntityData=t.getColorFromDebugEntityColor=t.getMeshIncrementForEntityData=t.MODEL_MESH_MANAGER_SETTINGS=t.PART_STUDIO_OCCURRENCE_ID=t.OCCURRENCE_SOURCE=t.ASSEMBLY_PREFIX=t.PART_STUDIO_PREFIX=t.TEMPORARY_SKETCH_COMPONENT_NODE_ID=t.ROOT_ELEMENT_PREVIEW_NODE_ID=t.ROOT_ELEMENT_NODE_ID=void 0;var r=i(311611),n=i(73055),o=i(227441);function s(e,t){var i="";switch(e){case o.GBTDebugEntityColor.RED:i="CPP_RED";break;case o.GBTDebugEntityColor.GREEN:i="CPP_GREEN";break;case o.GBTDebugEntityColor.BLUE:i="CPP_BLUE";break;case o.GBTDebugEntityColor.CYAN:i="CPP_CYAN";break;case o.GBTDebugEntityColor.YELLOW:i="CPP_YELLOW";break;case o.GBTDebugEntityColor.MAGENTA:i="CPP_MAGENTA";break;case o.GBTDebugEntityColor.BLACK:i="CPP_BLACK";break;case o.GBTDebugEntityColor.TRANSLUCENT_PURPLE:i="CPP_TRANSLUCENT_PURPLE";break;case o.GBTDebugEntityColor.FEATURE_ERROR:case o.GBTDebugEntityColor.FEATURE_DEBUG:i="FEATURE_ERROR_GRAPHIC_COLOR";break;case o.GBTDebugEntityColor.TRANSLUCENT_GREEN:i="CPP_TRANSLUCENT_GREEN";break;case o.GBTDebugEntityColor.TRANSLUCENT_BLUE:i="CPP_TRANSLUCENT_BLUE";break;case o.GBTDebugEntityColor.TRANSLUCENT_CYAN:i="CPP_TRANSLUCENT_CYAN";break;case o.GBTDebugEntityColor.TRANSLUCENT_YELLOW:i="CPP_TRANSLUCENT_YELLOW";break;case o.GBTDebugEntityColor.TRANSLUCENT_BLACK:i="CPP_TRANSLUCENT_BLACK";break;default:i="CPP_RED"}var s=n.default.getManager().getColor(i);return e!==o.GBTDebugEntityColor.FEATURE_ERROR||t!==r.PrimitiveType.POINTS&&t!==r.PrimitiveType.LINES?s:[s[0],s[1],s[2],1]}t.ROOT_ELEMENT_NODE_ID="element.",t.ROOT_ELEMENT_PREVIEW_NODE_ID="elementpreview.",t.TEMPORARY_SKETCH_COMPONENT_NODE_ID="temporary_sketch_component.",t.PART_STUDIO_PREFIX="partStudio.",t.ASSEMBLY_PREFIX="assembly.",t.OCCURRENCE_SOURCE="occurrence",t.PART_STUDIO_OCCURRENCE_ID="",t.MODEL_MESH_MANAGER_SETTINGS={bufferAllocationPolicy:r.BufferAllocationPolicy.MAXIMUM},t.getMeshIncrementForEntityData=function(e,t,i){var r=a(e);return r&&(t&&(r.id=t),r.pickId=i),r},t.getColorFromDebugEntityColor=s;function a(e){var t=null;switch(e.getMessageName()){case"display.GBTEntityFace":var i=e;if(i.decompress(),!i.points||!i.indices||!i.normals)return null;(t=new r.MeshIncrement(r.PrimitiveType.TRIANGLE_STRIP,i.points,i.indices)).normals=i.normals;break;case"display.GBTEntityEdge":var c=e;if((!c.points||c.points.length<6)&&(!c.compressedPoints||c.compressedPoints.length<6))return null;c.compressedPoints&&c.compressedPoints.length>1&&(c.points=function(e){var t=null;if(e&&e.length>1){var i=new Float32Array(e.buffer,0,6),r=new Uint16Array(e.buffer,24);t=new Float32Array(r.length);for(var n=(i[3]-i[0])/65535,o=(i[4]-i[1])/65535,s=(i[5]-i[2])/65535,a=i[0],c=i[1],l=i[2],u=0;u<r.length;u+=3)t[u+0]=a+n*r[u+0],t[u+1]=c+o*r[u+1],t[u+2]=l+s*r[u+2]}return t}(c.compressedPoints),c.compressedPoints=new Uint8Array(0));for(var l=Math.floor(c.points.length/3)-1,u=new Int32Array(2*l),h=0;h<l;++h)u[2*h]=h,u[2*h+1]=h+1;t=new r.MeshIncrement(r.PrimitiveType.LINES,c.points,u,void 0,!0);break;case"display.GBTEntityPoint":case"display.GBTEntityDegenerateEdge":var d=e;if(!d.point)return null;t=new r.MeshIncrement(r.PrimitiveType.POINTS,d.point,[0],void 0,!0);break;case"display.GBTFeatureEntity":case"display.GBTConstructionPlaneEntity":case"display.GBTBodyEntity":case"display.GBTPointEntity":case"display.GBTOriginEntity":case"display.GBTMateConnectorEntity":case"display.GBTSketchEntity":var p=e;t=p.getGeometry()?a(p.getGeometry()):null;break;case"display.GBTDebugGeometry":var g=e;if(!g.tessellation)return null;if(t=a(g.tessellation),g.style!==o.GBTDebugEntityStyle.ERROR){var f=s(g.color,t.primitiveType);(0,r.addColorToIncrement)(f,t),t.primitiveType===r.PrimitiveType.POINTS&&(g.style===o.GBTDebugEntityStyle.STAR&&(0,r.addStyleToIncrement)(n.default.getManager().getPointFont("STAR_POINT"),t),(0,r.addSizeToIncrement)(n.default.getManager().getNumber("DEBUG_POINT_SIZE"),t))}}return t}t.createMeshIncrementForEntityData=a,t.getEntityPrimitiveType=function(e){switch(e.getEntityType()){case o.GBTEntityType.VERTEX:return r.PrimitiveType.POINTS;case o.GBTEntityType.EDGE:return r.PrimitiveType.LINES;case o.GBTEntityType.FACE:return r.PrimitiveType.TRIANGLE_STRIP;case o.GBTEntityType.DEGENERATE_EDGE:return r.PrimitiveType.POINTS}return r.PrimitiveType.PRIMITIVE_UNKNOWN},t.filterEntitiesWithData=function(e,t,i){return e?(i?(r=[],e.each((function(e,n){return i(t[n])&&r.push(n),!1}))):r=e.getKeys(),r):[];var r},t.isFeatureIdCompound=function(e){return!!e&&-1!==e.indexOf(".")}},899457:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelViewManagers=t.ModelViewManager=void 0;var r=i(423902),n=i(663748),o=i(73055),s=i(342211),a=i(163113),c=i(911748),l=i(194598),u=i(311517),h=i(165542),d=i(712197),p=i(227441),g=i(769754),f=i(337740),m=i(736202),y=i(320078),v=i(997862),E=i(556329),I=i(311611),T=i(280738),S=o.default.getManager(),P=function(e){function t(t,i,r){var n=e.call(this)||this;return n.usage=t,n.occurrenceDataManager=i,n.viewer=r,n.partStudios={},n.sharedBaseMeshManager=null,n.i18next=i18n,n.assemblies={},n.displayedElementMicroversionIdAndConfiguration=null,n.displayedElementType=null,n.displayedPartStudio=null,n.partStudioPreservedForPreview=null,n.selectionsToClearOnReset={},n.secondaryOccurrenceHighlights={},n.secondaryEntityHighlights={},n.secondaryEntityHighlightSelectionRepeats={},n.addDerivedEntityHighlights=!0,n.selectionListsHandled=[],n.bodyLoadTasks=null,n.meshPointController=null,n.queuedAssemblyDisplayData=[],n.queuedAssemblyTimeout=null,n.notCollapsedAssemblyMessageCount=0,n.selectedSheetmetalModelId=null,n.lastFitSheetMetalModelId=null,n.resyncFunction=null,n.resyncNeeded=!1,n.resyncReason=null,n.resyncPromise=null,n.lastPartStudioProcessed="",n.lastPartStudioMicroversionIdAndConfigurationIntervalProcessed=null,n.temporarySketchComponents={},n.partStudioVisibilityUpdated=!1,n.resyncInContextElementIds=[],n.partDisplayDataPendingVisibilityUpdate=null,n.subFeaturesShownByParameters={},(0,I.viewerCheck)(r),n.meshManager=new I.MeshManager(n.viewer,I.MODEL_MESH_MANAGER_SETTINGS),n.displayedElementId="",n.partsAtTheBeginningOfEdit=new v.StringSet,n.sheetModelIdsAtTheBeginningOfEdit=new v.StringSet,n.handleAllSelectionListHighlights(),n.collapsibleDisplayDataTimer=new I.TimingDetails,n.bodyNode=new I.Node(I.BodyComponentId,new I.NodeProperties,t),n.sketchNode=new I.Node(I.SketchComponentId,new I.NodeProperties,t),n.elementPreviewBodyNode=new I.Node(I.BodyComponentId,new I.NodeProperties,t),n.isBase()&&(n.listenTo(n.viewer.getEventDispatcher(),I.BODIES_LOADED,n.refreshHighlight),l.btInjector.CapabilitiesService.checkFgsSimulationCurrentlyEnabled()&&!r.getIsForFlattenedDisplay()&&(n.simulationManager=new I.SimulationManager(n))),n.alternateEntityMapping=new g.AlternateEntityMapping,n.listenTo((0,I.getEditState)(),"change:latestDisplayDataUsage",n.clearAndRefreshHighlights),n.meshPointController=new I.MeshPointController(n.viewer),n}return(0,r.__extends)(t,e),t.prototype.clearAndRefreshHighlights=function(){this.clearHighlights(),this.refreshHighlight()},t.prototype.getViewer=function(){return this.viewer},t.prototype.onViewerShown=function(){this.viewer.getIsForFlattenedDisplay()&&this.fitToSelectedSheetMetalModel()},t.prototype.setAlternateEntityMapping=function(e){this.alternateEntityMapping=e},t.prototype.setResyncFunction=function(e){this.resyncFunction=e},t.prototype.getResyncPromise=function(){return this.resyncPromise?this.resyncPromise:null},t.prototype.getSimulationManager=function(){return this.simulationManager},t.prototype.purgeUnusedPartStudios=function(e,t,i,r){var n=(0,y.isBrowserFirefox)()?16e7:6e7,o=0;Object.values(this.partStudios).forEach((function(e){o+=e.getRetainedSize()}),this);if(!((o+=.5*t)<n)||r){var s=Object.values(this.partStudios).sort((function(e,t){return e.getRetainedSize()>t.getRetainedSize()?-1:e.getRetainedSize()<t.getRetainedSize()?1:0})),a=[];s.forEach((function(t){var i=t.getFullElementId();(r||o>=n&&!e.contains(i)&&!t.getIsCachedPartStudioPendingUse())&&(o-=t.getRetainedSize(),t.onDeletion(),delete this.partStudios[i],a.push(i),this.displayedElementId&&this.setResyncNeeded(p.GBTUiSyncClientReason.CLIENT_UNLOADED_DISPLAY_DATA))}),this),r&&Object.keys(this.partStudios).length>0&&u.log.error("Failed to purge all part studios. Remaining part studios: "+Object.keys(this.partStudios)+", deleted part studios: "+a),a.length>0&&(this.meshManager.removeEmptyMeshes(),u.log.info(i+" triggered deletion of part studios: "+a))}},t.prototype.purgeOnNewPartStudio=function(e){var t=new v.StringSet;this.getPartStudioIdsUsedInPartStudio(e,t);for(var i=e.assemblyReferenceDisplayData,r=0;r<i.assemblyReferences.length;r++){var n=i.assemblyReferences[r],o=n.assemblyDisplayData;this.getPartStudioIdsUsedInAssembly(o,i.elementId,n.referenceNodeId,t)}this.purgeUnusedPartStudios(t,e._serializedByteLength,"purgeOnNewPartStudio")},t.prototype.purgeOnNewAssembly=function(e){var t=new v.StringSet;this.getPartStudioIdsUsedInAssembly(e,null,null,t),this.purgeUnusedPartStudios(t,e._serializedByteLength,"purgeOnNewAssembly")},t.prototype.getPartStudioIdsUsedInPartStudio=function(e,t){e&&(e.microversionIdAndConfigurationInterval.from&&t.add(e.buildFullElementId(!0)),t.add(e.buildFullElementId(!1)))},t.prototype.getPartStudioIdsUsedInAssembly=function(e,t,i,r){var n=i&&t?(0,I.getAssemblyInContextElementId)(e.elementId,t,i):e.elementId,o=this.assemblies[n];o&&o.getUsedPartStudioIds(r);for(var s=0;s<e.occurrences.length;++s)r.add(e.occurrences[s].fullElementId.getKey())},t.prototype.getEstimatedMemoryUsageOfBodies=function(){var e=new s.Timer("ModelViewManager.prototype.getEstimatedMemoryUsageOfBodies"),t=0;return Object.values(this.partStudios).forEach((function(e){t+=e.getEstimatedMemoryUsageOfBodies()}),this),e.report(),t},t.prototype.getBodyDisplayMemoryLimit=function(){return 1024*((0,y.isBrowser64BitFirefox)()?S.getNumber("BODY_DISPLAY_MEMORY_LIMIT_FIREFOX64_MB"):S.getNumber("BODY_DISPLAY_MEMORY_LIMIT_MB"))*1024},t.prototype.getBodyRefinementMemoryLimit=function(){return this.getBodyDisplayMemoryLimit()},t.prototype.isEstimatedBodyMemoryUsageAboveThreshold=function(){return this.getEstimatedMemoryUsageOfBodies()>this.getBodyDisplayMemoryLimit()},t.prototype.checkBodyMemoryUsage=function(e){var t=this;if(this.isBase()&&!this.viewer.getIsForFlattenedDisplay()&&!this.bodyLoadTasks.hasPendingUnloads()&&!e.fromDisplayCache){var i=this.getEstimatedMemoryUsageOfBodies(),r=this.getBodyDisplayMemoryLimit();if(!(i<=r)){var n=new s.Timer("ModelViewManager.prototype.checkBodyMemoryUsage",{logResult:(0,I.isRetrievalDebuggingEnabled)()});(0,I.isRetrievalDebuggingEnabled)()&&u.log.info("bodyMemoryUse before unload: "+(0,I.byteToMbString)(i));var o=this.viewer.getBodyManager().unloadBodies(i-r,this);if(o){var a=new s.Timer("Unloading body display data",{logResult:(0,I.isRetrievalDebuggingEnabled)()});o.then((function(e){t.setResyncNeeded(p.GBTUiSyncClientReason.CLIENT_UNLOADED_DISPLAY_DATA),t.resyncAsNeeded(),a.report(),(0,I.isRetrievalDebuggingEnabled)()&&(i=t.getEstimatedMemoryUsageOfBodies(),u.log.info("Unloaded "+e.bodiesProcessedSinceStart+" bodies after "+e.iterationsSinceStart+" frames. bodyMemoryUse after unload: "+(0,I.byteToMbString)(i)))}))}n.report()}}},t.prototype.setResyncNeeded=function(e){this.resyncNeeded=!0,this.resyncReason=void 0!==e?e:null},t.prototype.resyncAsNeeded=function(){if(this.resyncFunction&&this.resyncNeeded){var e=this.resyncFunction(this.resyncReason,this.resyncInContextElementIds);return this.resyncInContextElementIds=[],this.resyncNeeded=!1,this.resyncReason=null,e}return h()},t.prototype.integrityCheck=function(){if(this.displayedElementId in this.assemblies&&this.displayedElementType!==p.GBTElementType.ASSEMBLY)u.log.warn("Found an assembly with the displayed element id, but the element type is incorrect");else{var e=this.displayedElementId,t=!1;if(e)for(var i in this.partStudios)if(0===i.indexOf(e)){t=!0;break}t&&this.displayedElementType!==p.GBTElementType.PARTSTUDIO&&u.log.warn("Found a part studio with the displayed element id, but the element type is incorrect")}},t.prototype.getSharedBodyNode=function(){return this.bodyNode},t.prototype.getSharedSketchNode=function(){return this.sketchNode},t.prototype.getElementPreviewBodyNode=function(){return this.elementPreviewBodyNode},t.prototype.clearSilhouetteRequests=function(){this.viewer.getSilhouetteTask().clearPendingRequestsForUsage(this.usage)},t.prototype.instantiateSharedNodes=function(e){e.addChild(this.bodyNode),e.addChild(this.sketchNode)},t.prototype.isBase=function(){return this.usage===I.bt_graphics_Usage.BASE},t.prototype.getDisplayedFullElementId=function(){return this.displayedElementMicroversionIdAndConfiguration?p.BTFullElementId.getFullElementIdString(this.displayedElementId,this.displayedElementMicroversionIdAndConfiguration.getKey()):this.displayedElementId},t.prototype.setBodyLoadTasks=function(e){this.bodyLoadTasks=e},t.prototype.getHideableFeatureIdsForDisplayedPartStudio=function(e){if(e===this.getDisplayedElementId()){var t=this.partStudios[this.getDisplayedFullElementId()];if(t)return t.getHideableFeatureIds()}return[]},t.prototype.onDeletion=function(){Object.values(this.assemblies).forEach((function(e){e.onDeletion()})),Object.values(this.partStudios).forEach((function(e){e.onDeletion(!0)}),this),this.meshManager.destroy(),this.sharedBaseMeshManager&&(this.sharedBaseMeshManager.destroy(),this.sharedBaseMeshManager=null),this.stopListening(),this.meshPointController&&this.meshPointController.destroy(),this.clearSilhouetteRequests(),(0,m.isNumber)(this.queuedAssemblyTimeout)&&(window.clearTimeout(this.queuedAssemblyTimeout),this.queuedAssemblyTimeout=null)},t.prototype.getSceneGraph=function(){return this.usage===I.bt_graphics_Usage.PREVIEW?this.viewer.getSceneGraphs().getPreviewSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()},t.prototype.getMeshManager=function(){return this.meshManager},t.prototype.getSharedBaseMeshManager=function(){return this.sharedBaseMeshManager},t.prototype.isTessellationUpdate=function(e){return!!this.displayedElementMicroversionIdAndConfiguration&&e.microversionIdAndConfigurationInterval.to.equals(this.displayedElementMicroversionIdAndConfiguration)},t.prototype.processRootAssemblyDisplayData=function(e,t){if(!t&&(e.isCollapsible||this.viewer.getFrameTimer().userIsInteracting()&&this.isTessellationUpdate(e))){var i=this.queuedAssemblyDisplayData.length>0?this.queuedAssemblyDisplayData[this.queuedAssemblyDisplayData.length-1]:null;i&&i.isCollapsible&&e.isCollapsible?(++i.collapseCount,i.mergeCollapsibleData(e)):this.queuedAssemblyDisplayData.push(e),this.startAssemblyDisplayDataQueueTimeout()}else this.emptyAssemblyDisplayDataQueue(),this.processRootAssemblyDisplayDataInternal(e,t),this.collapsibleDisplayDataTimer.reset()},t.prototype.startAssemblyDisplayDataQueueTimeout=function(){var e=this;if(!(0,m.isNumber)(this.queuedAssemblyTimeout)){var t=this.viewer.getFrameTimer().getTimingDetails(T.FrameType.INTERACTIVE).averageTime,i=this.collapsibleDisplayDataTimer.averageTime,r=Math.max((t+i)*S.getNumber("ASSEMBLY_DRAG_COLLAPSE_WAIT_RATIO"),0);this.queuedAssemblyTimeout=window.setTimeout((function(){return e.processAssemblyDisplayDataQueue()}),r)}},t.prototype.emptyAssemblyDisplayDataQueue=function(){(0,m.isNumber)(this.queuedAssemblyTimeout)&&(window.clearTimeout(this.queuedAssemblyTimeout),this.queuedAssemblyTimeout=null);for(var e=0;e<this.queuedAssemblyDisplayData.length;++e){var t=this.queuedAssemblyDisplayData[e];t.elementId!==this.displayedElementId||t.isCollapsible||this.processRootAssemblyDisplayDataInternal(t)}this.queuedAssemblyDisplayData=[]},t.prototype.processAssemblyDisplayDataQueue=function(){this.queuedAssemblyTimeout=null;for(var e=!1,t=0;t<this.queuedAssemblyDisplayData.length&&!e;++t)e=e||this.queuedAssemblyDisplayData[t].elementId===this.displayedElementId&&this.queuedAssemblyDisplayData[t].isCollapsible;if(e||!this.viewer.getFrameTimer().userIsInteracting()){var i=this.queuedAssemblyDisplayData.shift();if(i&&i.elementId===this.displayedElementId){i.isCollapsible&&S.getNumber("LOG_ASSEMBLY_DRAG_COLLAPSE_INFO")&&(i.collapseCount>1?(u.log.debug("Did not collapse "+this.notCollapsedAssemblyMessageCount+" messages"),u.log.debug("Collapsed "+i.collapseCount+" display data messages for "+i.elementId),this.notCollapsedAssemblyMessageCount=0):++this.notCollapsedAssemblyMessageCount);var r=(0,I.getTimeInMilliseconds)();this.processRootAssemblyDisplayDataInternal(i),i.isCollapsible&&this.collapsibleDisplayDataTimer.addTiming((0,I.getTimeElapsed)(r))}this.queuedAssemblyDisplayData.length>0&&this.startAssemblyDisplayDataQueueTimeout()}else this.startAssemblyDisplayDataQueueTimeout()},t.prototype.resetAllIncontextGraphicsForPartstudio=function(e){if(this.assemblies)for(var t="",i=Object.keys(this.assemblies),r=0;r<i.length;r++){var n=i[r];if((0,I.getPartstudioElementIdFromContextId)(n)===e){t=n;var o=this.assemblies[t];if(!o)continue;o.reset()}}},t.prototype.processPartStudioDisplayDataList=function(e,t,i){e.forEach((function(e){var r=e;if(r){var n=this.getAndUpdatePartStudioForMessage(r,t,!0);n&&n.processDisplayData(r,!1,t,i)}}),this)},t.prototype.processRootAssemblyDisplayDataInternal=function(e,t){var i=this,r=new s.Timer("processRootAssemblyDisplayDataInternal",{setTraceId:!0}),n=e.elementId,o=!!t,a=this.isTessellationUpdate(e);o||this.purgeOnNewAssembly(e),n!==this.displayedElementId||e.incremental||e.fromDisplayCache||this.clearSilhouetteRequests();var c=this.assemblies[n];c||(c=new I.Assembly(n,this,this.viewer),this.assemblies[n]=c,this.integrityCheck()),e.isForInContext&&this.showAssembly(n,e.isForInContext),this.clearHighlights(),c.processOccurrenceDeletions(e,t),this.processPartStudioDisplayDataList(e.partStudioDisplayData,o,a),this.resyncNeeded&&this.resyncFunction?a?(this.resyncNeeded=!1,u.log.warn("Skipped resync when processing tessellation update for assembly "+this.displayedElementId+" "+this.displayedElementMicroversionIdAndConfiguration)):this.resyncPromise=this.resyncAsNeeded().then((function(){i.processRootAssemblyDisplayDataHelper(n,c,e,a,r),i.resyncPromise=null})):this.processRootAssemblyDisplayDataHelper(n,c,e,a,r)},t.prototype.processRootAssemblyDisplayDataHelper=function(e,t,i,r,n){if(i.isForInContext&&this.showAssembly(e,i.isForInContext),r&&(0,I.isRetrievalDebuggingEnabled)()){for(var o=[],s=0;s<i.partStudioDisplayData.length;++s){var a=i.partStudioDisplayData[s];for(var c in a.deterministicPartIdToData)if(a.deterministicPartIdToData.hasOwnProperty(c)){var l=a.deterministicPartIdToData[c];o.push(c+"-"+l.tessellationSettings)}}u.log.info("Processing update for bodies:\n"+o);var h=this.getEstimatedMemoryUsageOfBodies();u.log.info("bodyMemoryUse prior to update: "+(0,I.byteToMbString)(h))}t.processDisplayData(i),e===this.displayedElementId&&(this.displayedElementMicroversionIdAndConfiguration=i.microversionIdAndConfigurationInterval.to,this.displayAssembly(this.displayedElementId)),this.updateOrVerifySelections(null,e),this.refreshHighlight(),this.viewer.getEventDispatcher().trigger(I.ASSEMBLY_DATA_PROCESSED,i,r),this.viewer.requestDraw(),t.microversionIdAndConfiguration=i.microversionIdAndConfigurationInterval.to,this.checkBodyMemoryUsage(i),this.resyncAsNeeded(),n.report()},t.prototype.getOrCreatePartStudio=function(e,t){var i=t?p.BTFullElementId.getFullElementIdString(e,t.getKey()):e,r=this.partStudios[i];if(!r){if(!this.bodyLoadTasks)throw"Loaders should be constructed prior to handling display data";r=new I.PartStudio(e,t||null,this,this.bodyLoadTasks,this.usage,this.viewer),this.partStudios[i]=r,this.integrityCheck()}return r},t.prototype.getMicroversionIdsString=function(e){var t=[];for(var i in this.partStudios){var r=this.partStudios[i];r.getElementId()===e&&t.push(r.getMicroversionIdAndConfiguration())}return"["+t.join(", ")+"]"},t.prototype.getAndUpdatePartStudioForMessage=function(e,t,i){var r;if(!this.isBase())return(r=this.partStudios[e.elementId]||this.getOrCreatePartStudio(e.elementId)).microversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to,r;var n=!(e.isExternal||t||e.elementId!==this.displayedElementId||e.fromDisplayCache||i),o=!1;!this.displayedElementMicroversionIdAndConfiguration&&n&&(this.displayedElementMicroversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to,o=!0);var s=e.buildFullElementId(!0).toString(),a=e.buildFullElementId(!1).toString();if(this.isBase()&&this.viewer.getModelViewManagers().getPreviewManager()&&!e.incremental&&!e.keepFromMicroversion&&s in this.partStudios&&(u.log.info("Received non-incremental base display data during preview/compare. Cloning base reference"),r=this.partStudios[s],this.partStudioPreservedForPreview=r,this.partStudios[s]=r.clone(e.incremental)),s!==a&&s in this.partStudios)a in this.partStudios&&(u.log.info("Deleting existing local copy of : "+a),this.partStudios[a].onDeletion(),delete this.partStudios[a]),r=this.partStudios[s],e.keepFromMicroversion?r=r.clone(e.incremental):delete this.partStudios[s],this.partStudios[a]=r,r.microversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to,this.getDisplayedFullElementId()===s&&n&&(this.displayedElementMicroversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to);else{if(s!==a&&e.microversionIdAndConfigurationInterval.from&&e.microversionIdAndConfigurationInterval.from.microversion.theId)return this.partStudios[a]?(u.log.trace("Skipped application of increment for part studio "+e.elementId+" because it was incrementing to a microversion that was already present "+e.microversionIdAndConfigurationInterval.to),n&&(this.displayedElementMicroversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to),this.partStudios[a].updateExternalState(e,t)):(u.log.warn("Skipped application of increment for part studio "+e.elementId+" due to missing from data.  Interval with missing data: "+e.microversionIdAndConfigurationInterval+". Existing microversions for element: "+this.getMicroversionIdsString(e.elementId)),this.setResyncNeeded(),o&&(this.displayedElementMicroversionIdAndConfiguration=null)),null;if(e.incremental&&!(a in this.partStudios))return t?(this.setResyncNeeded(),u.log.info("Skipped creation of in-context part studio "+e.elementId+" because the destination microversion is missing.  MV interval: "+e.microversionIdAndConfigurationInterval+". Existing microversions for element: "+this.getMicroversionIdsString(e.elementId)),this.resyncInContextElementIds.push(e.buildFullElementId(!1)),null):(u.log.warn("Skipped creation of part studio "+e.elementId+" because the destination microversion is missing.  MV interval: "+e.microversionIdAndConfigurationInterval+". Existing microversions for element: "+this.getMicroversionIdsString(e.elementId)),this.setResyncNeeded(),o&&(this.displayedElementMicroversionIdAndConfiguration=null),null);r=this.getOrCreatePartStudio(e.elementId,e.microversionIdAndConfigurationInterval.to)}return r.updateExternalState(e,t),r},t.prototype.processPartStudioDisplayData=function(e,t){var i=!!this.displayedElementMicroversionIdAndConfiguration;this.lastPartStudioProcessed=e.elementId,this.lastPartStudioMicroversionIdAndConfigurationIntervalProcessed=e.microversionIdAndConfigurationInterval;var r=this.isTessellationUpdate(e);r||this.viewer.getBodyManager().clearPreviewOccurrences(),this.isBase()&&this.hideInactiveContextAssemblies(e),this.purgeOnNewPartStudio(e);var n=this.getAndUpdatePartStudioForMessage(e);if(e.incremental)for(var o in e.deterministicPartIdToData)if(!e.deterministicPartIdToData[o].isACopyForTessellationSettings){var s=(0,I.getPartThumbnailKey)(e.elementId,o,70,40);(0,I.removeThumbnailForKey)(s),(0,I.setPartThumbnailNeedsToBeRerendered)(s)}var a=this.isBase()?e.buildFullElementId().toString()===this.getDisplayedFullElementId():this.displayedElementId===e.elementId&&!e.fromDisplayCache;if(a&&(this.displayPartStudio(this.getDisplayedFullElementId()),e.incremental||(this.partStudioVisibilityUpdated=!1)),n&&!e.isNoop){var c,l=this.viewer.getModelViewManagers().getManager();if(e.usage===p.GBTDisplayDataUsage.PREVIEW_AFTER){c=new v.StringSet;var h=l.partsAtTheBeginningOfEdit,d=l.sheetModelIdsAtTheBeginningOfEdit;e.partDisplayData.forEach((function(t){var i=e.deterministicPartIdToData[t.id],r=i?i.sheetMetalModelId:null;h.contains(t.id)||d.contains(r)||c.add(t.id)}))}if(n.processDisplayData(e,a,!1,r,c),this.processPartVisibility(e.partDisplayData),e.usage===p.GBTDisplayDataUsage.PREVIEW_BEFORE){this.partsAtTheBeginningOfEdit=new v.StringSet,this.sheetModelIdsAtTheBeginningOfEdit=new v.StringSet,this.newParts=new v.StringSet;var g=this.displayedPartStudio,f=this;e.partDisplayData.forEach((function(e){f.partsAtTheBeginningOfEdit.add(e.id);var t=g.retrieveBodyMetaData(e.id);t&&t.sheetMetalModelId&&f.sheetModelIdsAtTheBeginningOfEdit.add(t.sheetMetalModelId)}))}else e.usage===p.GBTDisplayDataUsage.PREVIEW_AFTER&&(l.newParts=c);this.updateOrVerifySelections(t,e.elementId),this.viewer.getEventDispatcher().trigger(I.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED,e.elementId),this.refreshHighlight()}else n&&(this.partDisplayDataPendingVisibilityUpdate&&this.processPartVisibility(this.partDisplayDataPendingVisibilityUpdate),n.processInContextData(e,a));this.resyncNeeded&&(r?(this.resyncNeeded=!1,u.log.warn("Skipped resync when processing tessellation update for part studio "+this.displayedElementId+" "+this.displayedElementMicroversionIdAndConfiguration)):this.resyncAsNeeded()),a&&(this.processInContextDisplayData(e,r),this.selectedSheetmetalModelId&&this.showPartsWithSheetmetalModelIdOnly(this.selectedSheetmetalModelId),i||this.viewer.getIsForFlattenedDisplay()||this.viewer.getEventDispatcher().trigger(I.DISPLAYED_PART_STUDIO,e.elementId)),this.checkBodyMemoryUsage(e)},t.prototype.processPartVisibility=function(e){var t=this.viewer.getModelViewManagers().getManager();if(t.getDisplayedPartStudio()){var i=this.viewer.getModelViewManagers().previewManagerExists()||!!this.viewer.getSketch();e.forEach((function(e){var r=e.id;e.visibility===p.GBTPartVisibility.HIDDEN?i&&!e.isModifiable||t.hidePart(r):e.visibility===p.GBTPartVisibility.VISIBLE&&t.showPart(r)})),this.partDisplayDataPendingVisibilityUpdate=null}else this.partDisplayDataPendingVisibilityUpdate=e},t.prototype.populateClientCacheStateDisplayInformation=function(e){this.emptyAssemblyDisplayDataQueue();this.viewer.processQueuedDisplayData(!0),this.getPartStudioSortedForCache().forEach((function(t){t.populateClientCacheStateDisplayInformation(e)}),this),Object.values(this.assemblies).forEach((function(t){t.populateClientCacheStateDisplayInformation(e)}),this)},t.prototype.displayPartStudio=function(e){var t=this.partStudios[e];t!==this.displayedPartStudio&&this.removePartStudioDisplay(),t&&(t.instantiateForEditingInNode(this.getElementRootNode()),this.displayedPartStudio=t),a.DocumentModel.isElementAtVersionOrLater(p.GBTFeatureScriptVersionNumber.V343_SUBFEATURES)&&!l.btInjector.StateService.isOnDocumentCompare()?(this.viewer.getEdgePointController()||this.viewer.createEdgePointController(),this.viewer.getEdgePointController().enable()):this.viewer.getEdgePointController()&&this.viewer.getEdgePointController().disable()},t.prototype.removePartStudioDisplay=function(){this.displayedPartStudio&&(this.displayedPartStudio.removeInstantiationForEditing(this.getElementRootNode()),this.displayedPartStudio=null)},t.prototype.displayAssembly=function(e){var t=this.assemblies[e];t&&(this.getElementRootNode(),t.show(),this.simulationManager&&this.simulationManager.onAssemblyDisplayed())},t.prototype.getModelBounds=function(e){var t=new I.BoundingBox,i=this.getSceneGraph().getRootNode(),r=i.getChildById(I.ROOT_ELEMENT_NODE_ID);if(r&&r.getBoundingBox().isInitialized()&&t.addBox(r.getBoundingBox()),!e||!e.doNotBoundTemporarySketchEntities){var n=i.getChildrenWithPrefix(I.TEMPORARY_SKETCH_COMPONENT_NODE_ID);if(n)for(var o=0;o<n.length;++o)t.addBox(n[o].getBoundingBox())}var s=this.getDisplayedElement();return s&&t.addBox(s.getBoundsOutsideElementNode()),t.addBox(this.viewer.getBodyManager().getUnloadedBodyBounds()),t.isInitialized()?t:null},t.prototype.getEntityBounds=function(e,t){var i=this.getPartStudioDataFromOccurrence(t);if(!i)return null;var r=i.getEntityBounds(e,t);return r&&t?r.createTransformedCopy(this.getOccurrenceTransform(t)):r},t.prototype.getFeatureBounds=function(e){if(!this.displayingPartStudio())return null;var t=this.getDisplayedPartStudio();return t?t.getFeatureBounds(e):null},t.prototype.getBodyBounds=function(e,t){var i=this.getDisplayedElement();return i?i.getBodyBounds(e,t):null},t.prototype.getSelectionFitBounds=function(e){if(!e)return null;var t=e.getIdString(),i=e.getOccurrence();switch(e.getType()){case p.GBTUiSelectionType.ENTITY:var r=this.getEntityBounds(t,i);return r||(r=this.getEntityBounds(this.alternateEntityMapping.get(t),i)),r;case p.GBTUiSelectionType.FEATURE:if((0,I.isUsageCompare)()){var n=new I.BoundingBox;return n.addBox((0,I.getActiveViewerModelViewManagers)().getManager().getFeatureBounds(t)),n.addBox((0,I.getActiveViewerModelViewManagers)().getPreviewManager().getFeatureBounds(t)),n}return this.getFeatureBounds(t);case p.GBTUiSelectionType.BODY:var o=this.getBodyBounds(t,i);return o||(o=this.getBodyBounds(this.alternateEntityMapping.get(t),i)),o;case p.GBTUiSelectionType.TABLE_ITEM:case p.GBTUiSelectionType.OCCURRENCE:return i?this.getOccurrenceBounds(i):null;default:return null}},t.prototype.getElementRootNode=function(){var e=this.getSceneGraph().getRootNode();if(!e.getChildById(I.ROOT_ELEMENT_NODE_ID)){var t=new I.Node(I.ROOT_ELEMENT_NODE_ID);e.addChild(t,0),this.instantiateSharedNodes(t)}return e.getChildById(I.ROOT_ELEMENT_NODE_ID)},t.prototype.getElementPreviewRootNode=function(){var e=this.getSceneGraph().getRootNode();if(!e.getChildById(I.ROOT_ELEMENT_PREVIEW_NODE_ID)){var t=new I.Node(I.ROOT_ELEMENT_PREVIEW_NODE_ID);e.addChild(t),t.addChild(this.elementPreviewBodyNode)}return e.getChildById(I.ROOT_ELEMENT_PREVIEW_NODE_ID)},t.prototype.cloneForPreview=function(e){var i=new s.Timer("ModelViewManager.cloneForPreview"),r=new t(I.bt_graphics_Usage.PREVIEW,this.occurrenceDataManager,this.viewer),n=this.getDisplayedPartStudio();if(!n)throw"There is no base part studio to clone.";if(n.getElementId()!==e.elementId)throw"Displayed part studio does not match the part studio being previewed";r.sharedBaseMeshManager=this.meshManager.cloneForPreview(n.getMeshOwnerId());var o=n.cloneForPreview(r,!1);return r.partStudios[e.elementId]=o,r.displayedElementId=e.elementId,r.displayedElementType=p.GBTElementType.PARTSTUDIO,r.setBodyLoadTasks(this.bodyLoadTasks),r.displayPartStudio(e.elementId),r.occurrenceDataManager=this.occurrenceDataManager,r.alternateEntityMapping=this.alternateEntityMapping,r.selectedSheetmetalModelId=this.selectedSheetmetalModelId,i.report(),r},t.prototype.onPreviewDestroyed=function(){Object.values(this.partStudios).forEach((function(e){e.onPreviewDestroyed()}),this),this.partStudioPreservedForPreview&&(this.partStudioPreservedForPreview.onDeletion(),this.partStudioPreservedForPreview=null)},t.prototype.getPartStudioSortedForCache=function(){return Object.values(this.partStudios).sort((function(e,t){return e.getIsInternal()===t.getIsInternal()?e.microversionIdAndConfiguration.microversion.theId===t.microversionIdAndConfiguration.microversion.theId?e.microversionIdAndConfiguration.getKey()<t.microversionIdAndConfiguration.getKey()?-1:1:e.microversionIdAndConfiguration.microversion.theId<t.microversionIdAndConfiguration.microversion.theId?-1:1:e.getIsInternal()?-1:1}))},t.prototype.onChangeActiveElement=function(e,t){if(this.clearSilhouetteRequests(),this.simulationManager&&this.simulationManager.clearSimulationGraphics(),this.displayingAssembly()){var i=this.assemblies[this.displayedElementId];i&&i.hide()}else this.displayingPartStudio()&&this.removePartStudioDisplay();this.displayedElementId="",this.displayedElementMicroversionIdAndConfiguration=null,this.partStudioVisibilityUpdated=!1,e?(this.displayedElementType=t,this.displayedElementType===p.GBTElementType.PARTSTUDIO?(this.displayedElementId=e,this.displayedElementMicroversionIdAndConfiguration=null,this.viewer.requestDraw()):this.displayedElementType===p.GBTElementType.ASSEMBLY?(this.displayedElementId=e,this.viewer.requestDraw()):this.displayedElementId=""):this.displayedElementId="",this.integrityCheck(),!this.displayingPartStudio()&&this.viewer.getEdgePointController()&&this.viewer.getEdgePointController().disable()},t.prototype.displayingPartStudio=function(){return this.displayedElementType===p.GBTElementType.PARTSTUDIO},t.prototype.displayingAssembly=function(){return this.displayedElementType===p.GBTElementType.ASSEMBLY},t.prototype.getDisplayedElementId=function(){return this.displayedElementId},t.prototype.getDisplayedElement=function(){return this.displayingPartStudio()?this.partStudios[this.isBase()?this.getDisplayedFullElementId():this.displayedElementId]:this.displayingAssembly?this.assemblies[this.displayedElementId]:null},t.prototype.getDisplayedElementMicroversionId=function(e){if(e===I.bt_graphics_Usage.PREVIEW&&this.usage!==I.bt_graphics_Usage.PREVIEW)return this.applyToPreview(this.getDisplayedElementMicroversionId,arguments);var t=this.getDisplayedElement();return t&&t.microversionIdAndConfiguration&&t.microversionIdAndConfiguration.microversion?t.microversionIdAndConfiguration.microversion.theId:""},t.prototype.getDisplayedPartStudio=function(){return this.partStudios[this.getDisplayedFullElementId()]||null},t.prototype.getDisplayedInContextAssembly=function(){var e=this.getDisplayedPartStudio();return e&&e.isDisplayingIncontextAssembly()?this.assemblies[e.getVisibleInContextAssemblyId()]:null},t.prototype.getDisplayedAssembly=function(){return this.assemblies[this.displayedElementId]||null},t.prototype.getPartStudioVisibilityUpdated=function(){return this.partStudioVisibilityUpdated},t.prototype.setPartStudioVisibilityUpdated=function(){this.getDisplayedPartStudio()&&(this.partStudioVisibilityUpdated=!0)},t.prototype.getInContextOccurrenceDisplayData=function(e){var t=this.getDisplayedPartStudio();if(t){var i=this.assemblies[t.getVisibleInContextAssemblyId()];if(i){var r=i.getDisplayDataForOccurrence(e);if(r)return r}}return null},t.prototype.getOccurrenceDisplayData=function(e){var t=this.assemblies[this.displayedElementId];return t?t.getOccurrenceDisplayData(e):this.getInContextOccurrenceDisplayData(e)},t.prototype.getMateConnectorGraphics=function(e,t){if(this.displayingAssembly()){var i=this.assemblies[this.displayedElementId];if(i)return i.getMateConnectorGraphics(e,t)}else if(this.displayingPartStudio()){var r=this.partStudios[this.getDisplayedFullElementId()];if(r)return r.getMateConnectorGraphics(e,t)}return null},t.prototype.hasMateIndicatorForOccurrence=function(e){if(this.displayingAssembly()){var t=this.assemblies[this.displayedElementId];if(t)return t.hasMateIndicatorForOccurrence(e)}return!1},t.prototype.hasGraphicsOccurrenceData=function(e){return!!e.isAssemblyRoot()||!!this.getOccurrenceDisplayData(e)},t.prototype.getOccurrenceElementId=function(e){var t=this.getOccurrenceDisplayData(e);return t?t.fullElementId:null},t.prototype.getOccurrenceTransform=function(e){var t=this.getOccurrenceDisplayData(e);return t?t.occurrenceData.transform.getGlMatrix():c.mat4.identity()},t.prototype.updateOccurrenceTransform=function(e,t){var i=this.assemblies[this.displayedElementId];i&&i.updateOccurrenceTransform(e,t)},t.prototype.batchUpdateOccurrenceTransforms=function(e){if(0===e.length)return!0;var t=this.assemblies[this.displayedElementId];return!!t&&t.batchUpdateOccurrenceTransforms(e)},t.prototype.getPartStudios=function(){return Object.values(this.partStudios)},t.prototype.getPartStudioDataFromOccurrence=function(e){if(this.displayingAssembly()){if(!e)return u.log.warn("An attempt was made to retrieve an part studio data from an assembly without a specified occurrence"),null;var t=this.assemblies[this.displayedElementId];if(t)if(i=t.getDisplayDataForOccurrence(e))return this.partStudios[i.fullElementId.toString()]||null}else if(this.displayingPartStudio()){var i;if(e)if((i=this.getInContextOccurrenceDisplayData(e))&&this.partStudios[i.fullElementId.toString()])return this.partStudios[i.fullElementId.toString()];return this.partStudios[this.getDisplayedFullElementId()]||null}return null},t.prototype.getPartStudio=function(e){return(e=e.toString()).length>0&&e.length<=25&&"-"!==e&&this.isBase()&&u.log.info("An attempt was made to get part studio with id that is not in elementId-microversionId format"),this.partStudios[e]||null},t.prototype.getDeterministicIdForFeature=function(e,t,i){var r,n=this,o=n.getEntitiesForFeature(e,t);return o&&(r=o.find((function(t){var r=n.retrieveEntityMetaData(e,t);if(r){var o=(0,d.createSelectionFromEntityData)(t,r,{},e);if(o&&(!i||i.filter(o)))return!0}return!1}))),r||""},t.prototype.getDeterministicIdForPickId=function(e,t){var i=e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio();return i?i.getEntityIdManager().getNameForId(t):null},t.prototype.retrieveEntityMetaData=function(e,t){var i=this.getDisplayedPartStudio();if(e&&(i=this.getPartStudioDataFromOccurrence(e)),!i)return null;var r=i.retrieveEntityMetaData(t);if(!r){var n=this.alternateEntityMapping.get(t);n&&(r=i.retrieveEntityMetaData(n))}return r},t.prototype.retrieveBodyMetaData=function(e,t){var i=this.getDisplayedPartStudio();if(e&&(i=this.getPartStudioDataFromOccurrence(e)),!i)return null;var r=i.retrieveBodyMetaData(t);return!r&&(r=this.applyToPreview(this.retrieveBodyMetaData,arguments)||null)?(r.foundInPreview=!0,r):r},t.prototype.getFlattenedEntityOwnerBodyDetails=function(e,t){if(!this.viewer.getIsForFlattenedDisplay())return null;var i=this.retrieveEntityMetaData(t,e);if(!i)return null;var r=this.getPartStudioDataFromOccurrence(t);if(!r)return null;var n=null;if(!(n=i.isFromSketch()?r.getSketchComponent().getOwnerFlattenedBodyId(e):i.getBodyId()))return null;var o=r.retrieveBodyMetaData(n);return o?{bodyMetaData:o,transform:r.getBodyComponent().getTransformFromSheetMetalBodyMetaData(o)}:null},t.prototype.updatePSOI=function(e){var t=this.getDisplayedPartStudio();t&&t.updatePSOI(e)},t.prototype.getPartStudioBodyMetaDataAssociatedWithSelections=function(e){if(!this.displayingPartStudio())return[];var t=new Set;e&&t.add(e),(0,d.getSelectionList)().each((function(e){if(!e.getOccurrence()){var i=e.getBodyId();i&&t.add(i)}}),this);var i=[];return t.forEach((function(e){var t=this.retrieveBodyMetaData(null,e);t&&i.push(t)}),this),i},t.prototype.hasEntity=function(e,t){return!!this.retrieveEntityMetaData(e,t)},t.prototype.hasFeature=function(e,t){var i=this.getCurrentPartStudioData(e);return!!i&&i.hasFeature(t)},t.prototype.getFirstMateConnectorId=function(e){var t=this.getCurrentPartStudioData(e);return t?t.mateConnectorComponent.featureToIds.firstKey():null},t.prototype.assemblyHasHiddenOccurrences=function(){var e=this.getDisplayedAssembly();if(e)for(var t in e.occurrences)if(e.occurrences[t].isHidden)return!0;return!1},t.prototype.getAllMateConnectorIds=function(e,t){var i=[],r=this.getCurrentPartStudioData(e);if(r)i=r.mateConnectorComponent.getInstantiatedMateConnectorsForOccurrence(e);else if(this.displayingAssembly()&&e){var n=this.assemblies[this.displayedElementId];n&&(i=n.getMateConnectorIdsForOccurrence(e,t))}return i},t.prototype.hasBody=function(e,t){var i=this.getCurrentPartStudioData(e);return!!i&&i.hasBody(t)},t.prototype.getCurrentPartStudioData=function(e){return e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio()},t.prototype.hideSketch=function(e){var t=this.getDisplayedPartStudio();t&&t.hideSketch(e),this.applyToPreview(this.hideSketch,arguments)},t.prototype.retrieveSketchEntityDeterministicId=function(e,t){var i=this.getDisplayedPartStudio();return i?i.retrieveSketchEntityDeterministicId(e,t):null},t.prototype.showSketch=function(e){var t=this.getDisplayedPartStudio();t&&t.showSketch(e),this.applyToPreview(this.showSketch,arguments)},t.prototype.displaySketchAsActive=function(e){var t=this.getDisplayedPartStudio();t&&t.displaySketchAsActive(e)},t.prototype.displaySketchAsInactive=function(e){var t=this.getDisplayedPartStudio();t&&t.displaySketchAsInactive(e)},t.prototype.hasActiveSketch=function(){var e=this.getDisplayedPartStudio();return!!e&&e.hasActiveSketch()},t.prototype.hideInactiveContextAssemblies=function(e){if(!(0,I.isUsagePreviewFinal)()){var t,i=e.assemblyReferenceDisplayData,r=new v.StringSet;for(t=0;t<i.assemblyReferences.length;t++){var n=i.assemblyReferences[t],o=n.assemblyDisplayData,s=(0,I.getAssemblyInContextElementId)(o.elementId,i.elementId,n.referenceNodeId);r.add(s),n.visibility!==p.GBTBSFeatureVisibility.VISIBLE&&this.hideAssembly(s)}var a=this.getDisplayedPartStudio();if(a){var c=a.getReferencedInContextAssemblyIds();for(t=0;t<c.length;t++)r.contains(c[t])||this.hideAssembly(c[t])}}},t.prototype.processInContextDisplayData=function(e,t){e.isBase()&&(this.viewer.getIsForFlattenedDisplay()?this.processInContextDisplayDataForFlat(e,t):this.processInContextDisplayDataFor3d(e,t))},t.prototype.processInContextDisplayDataFor3d=function(e,t){for(var i=!1,r=e.assemblyReferenceDisplayData,n=function(t){var n=r.assemblyReferences[t],s=n.assemblyDisplayData;if(n.visibility!==p.GBTBSFeatureVisibility.VISIBLE)return"continue";s.elementId=(0,I.getAssemblyInContextElementId)(s.elementId,r.elementId,n.referenceNodeId);var a=[];n.occurrencesToExclude.forEach((function(e){a.push(e.getPathAsString())}));var l=[];s.occurrences.forEach((function(e){var t=e.occurrenceData.occurrence.getPathAsString();if(a.indexOf(t)<0){var i=e.occurrenceData.transform.getGlMatrix(),r=n.transform.getGlMatrix(),o=c.mat4.multiply(r,i,c.mat4.create());e.occurrenceData.transform.updateFromGlMatrix(o),l.push(e)}})),s.occurrences=l,(0,I.isUsagePreviewFinal)()||o.viewer.onRootAssemblyDisplayData(s,e),i=!0},o=this,s=0;s<r.assemblyReferences.length;s++)n(s);i?(0,I.getActiveViewerEventDispatcher)().trigger(I.UPDATE_INCONTEXT_ISOLATION,i):e.isNoop||(0,I.getActiveViewerEventDispatcher)().trigger(I.UPDATE_INCONTEXT_ISOLATION,i)},t.prototype.processInContextDisplayDataForFlat=function(e,t){if(!(0,I.isUsagePreviewFinal)())for(var i=e.assemblyReferenceDisplayData,r=0;r<i.assemblyReferences.length;r++){var n=i.assemblyReferences[r].assemblyDisplayData;this.processPartStudioDisplayDataList(n.partStudioDisplayData,!0,t)}},t.prototype.applyToPreview=function(e,t){if(this.isBase()){var i=this.viewer.getModelViewManagers().getPreviewManager();if(i)return e.apply(i,t)}return null},t.prototype.showConstructionPlane=function(e){var t=this.getDisplayedPartStudio();t&&t.showConstructionPlane(e),this.applyToPreview(this.showConstructionPlane,arguments),this.viewer.requestDraw()},t.prototype.hideMateConnector=function(e){var t=this.getDisplayedPartStudio();t&&t.hideMateConnector(e),this.applyToPreview(this.hideMateConnector,arguments),this.viewer.requestDraw()},t.prototype.showMateConnector=function(e){var t=this.getDisplayedPartStudio();t&&t.showMateConnector(e),this.applyToPreview(this.showMateConnector,arguments),this.viewer.requestDraw()},t.prototype.hideFeatureBodies=function(e,t){var i=this.getDisplayedPartStudio();i&&i.hideFeatureBodies(e,t),this.applyToPreview(this.hideFeatureBodies,arguments),this.viewer.requestDraw()},t.prototype.showFeatureBodies=function(e,t){var i=this.getDisplayedPartStudio();i&&i.showFeatureBodies(e,t),this.applyToPreview(this.showFeatureBodies,arguments),this.viewer.requestDraw()},t.prototype.hideConstructionPlane=function(e){var t=this.getDisplayedPartStudio();t&&t.hideConstructionPlane(e),this.applyToPreview(this.hideConstructionPlane,arguments),this.viewer.requestDraw()},t.prototype.hidePart=function(e){var t=this.getDisplayedPartStudio();t&&t.hidePart(e),this.applyToPreview(this.hidePart,arguments),this.viewer.requestDraw()},t.prototype.showPart=function(e){var t=this.getDisplayedPartStudio();t&&t.showPart(e),this.applyToPreview(this.showPart,arguments),this.viewer.requestDraw()},t.prototype.setPlaneAppearance=function(e,t){var i=this.getDisplayedPartStudio();i&&(i.setPlaneAppearance(e,t),this.viewer.requestDraw()),this.applyToPreview(this.setPlaneAppearance,arguments)},t.prototype.hidePointBodies=function(e){var t=this.getDisplayedPartStudio();t&&(t.hidePointBodies(e),this.applyToPreview(this.hidePointBodies,arguments),this.viewer.requestDraw())},t.prototype.showPointBodies=function(e){var t=this.getDisplayedPartStudio();t&&(t.showPointBodies(e),this.applyToPreview(this.showPointBodies,arguments),this.viewer.requestDraw())},t.prototype.changePartColor=function(e,t,i){var r=this.getDisplayedPartStudio();r&&(r.changePartColor(e,t,i),this.viewer.requestDraw())},t.prototype.changePartOpacity=function(e,t,i){var r=this.getDisplayedPartStudio();r&&(r.changePartOpacity(e,t,i),this.viewer.requestDraw())},t.prototype.getPartColor=function(e){var t=this.getDisplayedPartStudio();return t?t.getPartColor(e):null},t.prototype.getPartOpacity=function(e){var t=this.getDisplayedPartStudio();return t?t.getPartOpacity(e):-1},t.prototype.getOccurrenceColor=function(e){var t=this.getPartStudioDataFromOccurrence(e);return t?t.getBodyComponent(e).getOccurrenceColor(e):null},t.prototype.setOccurrenceAlphaModifier=function(e,t){var i=this.getPartStudioDataFromOccurrence(e);i&&i.getBodyComponent(e).setOccurrenceAlphaModifier(e,t)},t.prototype.clearOccurrenceAlphaModifier=function(e){var t=this.getPartStudioDataFromOccurrence(e);t&&t.getBodyComponent(e).clearOccurrenceAlphaModifier(e)},t.prototype.addTemporarySketchComponent=function(e){this.temporarySketchComponents[e.getUniqueId()]=e},t.prototype.removeTemporarySketchComponent=function(e){delete this.temporarySketchComponents[e.getUniqueId()]},t.prototype.processEntitiesHighlight=function(e,t,i,r){var n=I.PART_STUDIO_ELEMENT_ID,o=this.getPartStudioDataFromOccurrence(t);if(t&&(n=this.viewer.getOccurrenceIdManager().getIdForName(t.getPathAsString())),n!==I.INVALID_OCCURRENCE_ID)for(var s=0;s<i.length;++s){var a=i[s];o.updateEntityHighlight(e,r,a,n),this.updateTemprorarySketchHighlights(e,r,a,n);var c=this.alternateEntityMapping.get(a);c&&o.updateEntityHighlight(e,r,c,n)}},t.prototype.updateTemprorarySketchHighlights=function(e,t,i,r){for(var n in this.temporarySketchComponents)this.temporarySketchComponents[n].updateEntityHighlight(e,t,i,r)},t.prototype.getDimensionGraphic=function(e,t){var i=null;return this.displayedElementType===p.GBTElementType.PARTSTUDIO&&(i=this.getDisplayedPartStudio()),i?i.getDimensionGraphic(e,t):null},t.prototype.processOccurrenceHighlight=function(e,t,i){var r,n=i.cloneForOccurrence(t);if(t&&t.path[0]===I.BodyComponent.PART_STUDIO_BODY_OCCURRENCE_PREFIX)r=[t];else{var o=this.assemblies[this.displayedElementId];if(!o)return;r=o.getLeafOccurrencesContainedWithinOccurrence(t);for(var s=0;s<r.length;++s){var a=o.getOccurrenceEntityIdsForHighlight(r[s]);a.length>0&&this.processEntitiesHighlight(e,r[s],a,n)}}this.occurrenceDataManager.processHighlightForOccurrences(e,r,n,this.usage)},t.prototype.getOccurrenceIdForSelection=function(e){if(e.getOccurrence())return this.viewer.getOccurrenceIdManager().getIdForName(e.getOccurrence().getPathAsString());var t=this.getPartStudioDataFromOccurrence(e.getOccurrence());return t?t.getPartStudioOccurrenceIdForSelection(e):I.INVALID_OCCURRENCE_ID},t.prototype.getEntityIdsForSelection=function(e){var t=null,i=this.getPartStudioDataFromOccurrence(e.getOccurrence());return i&&(t=i.getEntityIdsForSelection(e)),t||[]},t.prototype.getEntitiesForFeature=function(e,t,i){var r=this.getDisplayedPartStudio();return e&&(r=this.getPartStudioDataFromOccurrence(e)),r?r.getEntitiesForFeature(t,i):null},t.prototype.getFeatureIdsRelatedToBody=function(e,t){var i=e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio();if(!i)return[];for(var n=new Set,o=i.getEntitiesForBody(t),s=0;s<o.length;++s){var a=i.retrieveEntityMetaData(o[s]);if(a)for(var c=a.getFeatureIds(),l=0;l<c.length;++l)n.add(c[l])}return(0,r.__spreadArray)([],(0,r.__read)(n),!1)},t.prototype.getBodyIdsRelatedToFeature=function(e,t){var i=e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio();if(!i)return[];for(var n=i.getEntitiesForFeature(t),o=new Set,s=0;s<n.length;++s){var a=i.retrieveEntityMetaData(n[s]);a&&o.add(a.getBodyId())}return(0,r.__spreadArray)([],(0,r.__read)(o),!1)},t.prototype.getEntitiesForBody=function(e,t){var i=this.getPartStudioDataFromOccurrence(e);return i?i.getEntitiesForBody(t):null},t.prototype.getIncrementsForFeature=function(e,t){var i=this,r=[],n=i.getEntitiesForFeature(e,t);return n&&n.forEach((function(t){var n=i.extractMeshIncrement(t,e);n&&r.push(n)})),r},t.prototype.extractMeshIncrement=function(e,t){var i=this.getDisplayedPartStudio();return t&&(i=this.getPartStudioDataFromOccurrence(t)),i?i.extractMeshIncrement(e):null},t.prototype.isEntityOnOccurrence=function(e,t){var i=this.getOccurrenceDisplayData(t);if(!i)return!1;var r=this.retrieveEntityMetaData(t,e);return!!r&&(this.occurrenceContainsBody(i,r.getBodyId())||i.containsPart(e))},t.prototype.occurrenceContainsBody=function(e,t){var i,n;if(e.containsPart(t))return!0;var o=this.partStudios[e.fullElementId.toString()];if(!o)return!1;var s=o.retrieveBodyMetaData(t);if(!s)return!1;if(s.isClosedCompositeConstituent&&e.containsPart(s.consumingClosedCompositeData.id))return!0;if(s.referencingOpenCompositeData)try{for(var a=(0,r.__values)(s.referencingOpenCompositeData),c=a.next();!c.done;c=a.next()){var l=(0,r.__read)(c.value,2),u=l[0];l[1];if(e.containsPart(u))return!0}}catch(e){i={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return!1},t.prototype.isNodeForModel=function(e){return e.getId()===I.ROOT_ELEMENT_NODE_ID||!!e.getParent()&&this.isNodeForModel(e.getParent())},t.prototype.isNodeForSketch=function(e){return e.getId()===I.SketchComponentId},t.prototype.isNodeForBody=function(e){return 0===e.getId().indexOf(I.BodyComponentId)},t.prototype.isNodeForFaces=function(e){return e.isFaces()},t.prototype.isNodeForEdges=function(e){return e.isEdges()},t.prototype.isNodeForPoints=function(e){return e.isPoints()},t.prototype.handleAllSelectionListHighlights=function(){this.handleSelectionListHighlights("selectionList",(0,d.getSelectionList)()),this.handleSelectionListHighlights("preselectionList",(0,d.getPreselectionList)(),I.HighlightType.PRE),this.handleSelectionListHighlights("secondarySelectionList",(0,d.getSecondarySelectionList)(),I.HighlightType.SECONDARY),this.handleSelectionListHighlights("secondaryPreSelectionList",(0,d.getSecondaryPreSelectionList)(),I.HighlightType.SECONDARY_PRE),this.handleSelectionListHighlights("smartSelectionList",(0,d.getSmartSelectionList)(),I.HighlightType.SMART_SELECTION),this.handleSelectionListHighlights("accumulatedSmartSelections",(0,d.getAccumulatedSmartSelections)(),I.HighlightType.ACCUMULATED_SMART_SELECTION),this.handleSelectionListHighlights("commentSelectionList",(0,d.getCommentSelectionList)(),I.HighlightType.COMMENT),this.handleSelectionListHighlights("filteredEntitiesList",(0,d.getFilteredEntitiesList)(),I.HighlightType.FILTERED_ENTITIES),this.handleSelectionListHighlights("errorSelectionList",(0,d.getErrorSelectionList)(),I.HighlightType.ERROR),this.handleSelectionListHighlights("retrievalSelectionList",(0,d.getRetrievalSelectionList)(),I.HighlightType.RETRIEVAL)},t.prototype.resetSelectionListHandlers=function(){this.selectionListsHandled.forEach((function(e){this.stopListening(e.selectionList)}),this),this.selectionListsHandled=[],this.handleAllSelectionListHighlights(),this.meshPointController&&this.meshPointController.resetSelectionListHandlers()},t.prototype.handleSelectionListHighlights=function(e,t,i){this.selectionListsHandled.push({selectionListName:e,selectionList:t,highlightType:i});var r=this;this.selectionsToClearOnReset[e]={},this.listenTo(t,"add",(function(t){r.processSelectionHighlight(I.Action.ADD,t,e,i)})),this.listenTo(t,"remove",(function(t){r.processSelectionHighlight(I.Action.REMOVE,t,e,i)})),this.listenTo(t,"reset",(function(t){r.resetSelectionListHighlights(t,e,i)})),t.each((function(t){r.processSelectionHighlight(I.Action.ADD,t,e,i)}))},t.prototype.removeSelectionListHandler=function(e){var t=this.selectionListsHandled.findIndex((function(t){return t.selectionListName===e}));if(t>=0){var i=this.selectionListsHandled[t];this.clearSelectionHighlight(i.selectionListName,i.highlightType),this.stopListening(i.selectionList),this.selectionListsHandled.splice(t,1)}delete this.selectionsToClearOnReset[e]},t.prototype.resetSelectionListHighlights=function(e,t,i){this.clearSelectionHighlight(t,i),e.each((function(e){this.processSelectionHighlight(I.Action.ADD,e,t,i)}),this)},t.prototype.updateOrVerifySelections=function(e,t){if(!this.viewer.getIsForFlattenedDisplay()){var i=this;(0,d.getAllSelectionLists)().forEach((function(r){i.updateOrVerifySelectionsInList(e,t,r)}))}},t.prototype.updateOrVerifySelectionsInList=function(e,t,i){var r=[],n=!1,o=!0,s=this,a={},c=(0,d.getSelectionFocus)(),l=!c||!c.getReceivesComputedData();return i.each((function(i){var c=i;if(c.getUsage()===s.usage){e&&(c=(c=e.updateSelection(c,t))||i);var u=!l&&!!c;if(c&&l)switch(c.getType()){case p.GBTUiSelectionType.ENTITY:u=s.hasEntity(c.getOccurrence(),c.getIdString());break;case p.GBTUiSelectionType.FEATURE:case p.GBTUiSelectionType.FOLDER:u=!0;break;case p.GBTUiSelectionType.BODY:u=s.hasBody(c.getOccurrence(),c.getIdString());break;case p.GBTUiSelectionType.MATE_CONNECTOR:case p.GBTUiSelectionType.OCCURRENCE:case p.GBTUiSelectionType.MATE:case p.GBTUiSelectionType.NON_GEOMETRIC_ITEM:case p.GBTUiSelectionType.EDGE_POINT:case p.GBTUiSelectionType.MESH_POINT:case p.GBTUiSelectionType.TABLE_ITEM:u=!0}u?(n=n||c.getIdString()!==i.getIdString(),a.hasOwnProperty(c.id)?(r[a[c.id]]=c,n=!0):(a[c.id]=r.length,r.push(c))):(n=!0,o=o&&i.isInContextSubFeature())}})),n&&i.reset(r,{suppressServerCalls:o,isForRemapping:!0}),n},t.prototype.clearHighlights=function(){for(var e=0;e<this.selectionListsHandled.length;++e){var t=this.selectionListsHandled[e];this.clearSelectionHighlight(t.selectionListName,t.highlightType)}},t.prototype.refreshHighlight=function(){for(var e=this,t=function(t,i,r){i.each((function(n){n.isMeshPoint()&&n.getMeshPointData()?e.meshPointController.addSelection(n,i):e.processSelectionHighlight(I.Action.ADD,n,t,r)}))},i=0;i<this.selectionListsHandled.length;++i){var r=this.selectionListsHandled[i];t(r.selectionListName,r.selectionList,r.highlightType)}},t.prototype.handlesHighlightForSelection=function(e,t){if(e.getUsage()!==this.usage)return!1;if(t===I.HighlightType.PRE&&e.source===d.Source.PICK&&S.getNumber("INHIBIT_PREHIGHLIGHT"))return!1;switch(e.getType()){case p.GBTUiSelectionType.ENTITY:case p.GBTUiSelectionType.FEATURE:case p.GBTUiSelectionType.BODY:case p.GBTUiSelectionType.OCCURRENCE:case p.GBTUiSelectionType.MATE:case p.GBTUiSelectionType.MATE_CONNECTOR:case p.GBTUiSelectionType.EDGE_POINT:case p.GBTUiSelectionType.TABLE_ITEM:case p.GBTUiSelectionType.SKETCH_GROUP:case p.GBTUiSelectionType.NON_GEOMETRIC_ITEM:case p.GBTUiSelectionType.PROPERTY:case p.GBTUiSelectionType.SIMULATION_LOAD:case p.GBTUiSelectionType.FOLDER:return!0}return!1},t.prototype.getHighlightTypeForSelection=function(e,t){if(t===I.HighlightType.PRE&&(e.isOccurrence()||e.isFolder()))return I.HighlightType.OCCURRENCE_PRE;if(t===I.HighlightType.SECONDARY_PRE&&e.isOccurrence())return I.HighlightType.OCCURRENCE_SECONDARY_PRE;if(t===I.HighlightType.COMMENT&&e.isOccurrence())return I.HighlightType.OCCURRENCE_COMMENT;if(t)return t;switch(e.getType()){case p.GBTUiSelectionType.ENTITY:return I.HighlightType.ENTITY;case p.GBTUiSelectionType.FEATURE:case p.GBTUiSelectionType.SKETCH_GROUP:return I.HighlightType.FEATURE;case p.GBTUiSelectionType.BODY:return I.HighlightType.PART;case p.GBTUiSelectionType.FOLDER:case p.GBTUiSelectionType.OCCURRENCE:case p.GBTUiSelectionType.NON_GEOMETRIC_ITEM:return I.HighlightType.OCCURRENCE;case p.GBTUiSelectionType.TABLE_ITEM:if(e.getOccurrence())return I.HighlightType.OCCURRENCE}return I.HighlightType.UI},t.prototype.processSelectionHighlight=function(e,t,i,r,n,o){if(t&&this.handlesHighlightForSelection(t,r)){var s=this.getDisplayedElement();if(s){var a=!r||r===I.HighlightType.PRE;r=this.getHighlightTypeForSelection(t,r);var c=!1;if(t.isFromBody()&&(t.isBody()||t.isFace())){var l=void 0;(l=t.isBody()?t.getBodyMetaData():t.getEntityMetaData().getBodyMetaData())&&(!l.isModifiableBody()||(0,I.isUsagePreview)()&&t.isBody())&&(c=!0)}var u=this.viewer.getHighlightManager(this.usage),h=u.createHighlightForSelection(r,t.getIdForCollection(),c),d=this.getEntityIdsForSelection(t),p=s.getInContextImportEntityIdsForSelection(t),g=r===I.HighlightType.PRE?I.HighlightType.INCONTEXT_REFERENCE_PRE:I.HighlightType.INCONTEXT_REFERENCE,f=n?[]:s.getOccurrencesForSelection(t),m=!t.isEntity()||t.isFromConstructionGeometry()||this.addDerivedEntityHighlights;r!==I.HighlightType.COMMENT||t.isPlane()||(m=!1);var y=[];if(o||!m&&e===I.Action.ADD||(y=this.viewer.getEdgePointController()&&t.isEdgePoint()?this.viewer.getEdgePointController().getUIElementsForSelection(t):s.getUIElementsForSelection(t)),this.processUiHighlights(e,y,t,i,h),t.isMateConnector()||t.isMate()||t.isMateRelation()||t.isExplodeStep()||t.isNonGeometricItem()||t.isSimulationLoad())this.processSecondaryAssemblyFeatureHighlights(e,f,t,i,r);else if(d&&d.length>0&&this.processEntitiesHighlight(e,t.getOccurrence(),d,h),p&&p.length>0&&a&&this.processEntitiesHighlight(e,t.getOccurrence(),p,u.createHighlightForSelection(this.getHighlightTypeForSelection(t,g),t.getIdForCollection())),f&&f.length>0&&m){var v=t.isBody()&&!!t.getOccurrence(),E=h;(t.isEntity()||v||t.isFeature())&&(e===I.Action.ADD&&(this.selectionsToClearOnReset[i][t.getIdForCollection()]=t),E=r===I.HighlightType.FEATURE?u.createSecondaryHighlight(I.HighlightType.OCCURRENCE,I.HighlightType.OCCURRENCE,t.getIdForCollection()):u.createSecondaryHighlight(r===I.HighlightType.PRE?I.HighlightType.ASSOCIATED_OCCURRENCE_PRE:I.HighlightType.ASSOCIATED_OCCURRENCE,r,t.getIdForCollection()));for(var T=0;T<f.length;++T)this.processOccurrenceHighlight(e,f[T],E);E.associatedPrimaryHighlightType&&e===I.Action.REMOVE&&u.freeSecondaryHighlight(E.type,E.associatedPrimaryHighlightType,t.getIdForCollection())}e===I.Action.REMOVE&&(u.freeHighlightForSelection(r,t.getIdForCollection()),a&&u.freeHighlightForSelection(g,t.getIdForCollection())),this.viewer.requestDraw()}}},t.prototype.processUiHighlights=function(e,t,i,r,n){if(t&&!(t.length<=0)){for(var o=!0,s=0;s<t.length;++s)e===I.Action.ADD?t[s].addHighlight(n):o=o&&t[s].removeHighlight(n);e===I.Action.ADD?this.selectionsToClearOnReset[r][i.getIdForCollection()]=i:o&&delete this.selectionsToClearOnReset[r][i.getIdForCollection()]}},t.prototype.processSecondaryAssemblyFeatureHighlights=function(e,t,i,r,n){var o=this.getDisplayedElement();if(o){var s,a,c=i.getIdForCollection()+E.ID_SEPARATOR+n,l=this.viewer.getHighlightManager(this.usage);a=i.isMateConnector()||i.isMate()&&i.featureType!==f.FeatureTypeName.MATE_GROUP?l.createSecondaryHighlight(I.HighlightType.RELATED_OCCURRENCE_MATE,n,i.getIdForCollection()):l.createSecondaryHighlight(I.HighlightType.RELATED_OCCURRENCE,n,i.getIdForCollection());var h=n===I.HighlightType.UI?I.HighlightType.UI_RELATED_ENTITY:n;if(e===I.Action.ADD){var d=this.secondaryOccurrenceHighlights[c];if(d&&d.length>0){for(s=0;s<d.length;++s)this.processOccurrenceHighlight(I.Action.REMOVE,d[s],a);delete this.secondaryOccurrenceHighlights[c]}this.secondaryOccurrenceHighlights[c]=t}else t=this.secondaryOccurrenceHighlights[c],delete this.secondaryOccurrenceHighlights[c];for(s=0;t&&s<t.length;++s)this.processOccurrenceHighlight(e,t[s],a);if(this.displayingAssembly()){var p=void 0;if(this.secondaryEntityHighlights.hasOwnProperty(c))for(p=this.secondaryEntityHighlights[c],delete this.secondaryEntityHighlights[c],s=0;p&&s<p.length;++s)this.updateSecondaryEntityHighlightRepeatCount(p[s],r,n,!1)||this.processSelectionHighlight(I.Action.REMOVE,p[s],r,h,!0,!0);if(e===I.Action.ADD)for(p=o.getEntitiesForNonInstanceSelection(i),this.secondaryEntityHighlights[c]=p,s=0;p&&s<p.length;++s)this.updateSecondaryEntityHighlightRepeatCount(p[s],r,n,!0)||u.log.warn("Adding highlight should always result in an existing entity highlight"),this.processSelectionHighlight(e,p[s],r,h,!0,!0)}e===I.Action.ADD?this.selectionsToClearOnReset[r][i.getIdForCollection()]=i:l.freeSecondaryHighlight(I.HighlightType.RELATED_OCCURRENCE,n,i.getIdForCollection())}},t.prototype.updateSecondaryEntityHighlightRepeatCount=function(e,t,i,r){var n=e.id+t+i.toString(),o=this.secondaryEntityHighlightSelectionRepeats[n];return o||(o=0),r?o++:o--,o>0?(this.secondaryEntityHighlightSelectionRepeats[n]=o,!0):(delete this.secondaryEntityHighlightSelectionRepeats[n],!1)},t.prototype.clearHighlight=function(e,t,i){var r=this.viewer.getReferenceHighlights().highlights[e];this.occurrenceDataManager.clearHighlight(r,this.usage),this.clearIndividualHighlights(r,t,i),this.viewer.getHighlightManager(this.usage).resetHighlightInstanceIds(e),e===I.HighlightType.PRE?(this.clearHighlight(I.HighlightType.OCCURRENCE_PRE,t,i),this.clearHighlight(I.HighlightType.ASSOCIATED_OCCURRENCE_PRE,t,i),this.clearHighlight(I.HighlightType.INCONTEXT_REFERENCE_PRE,t,!0)):e===I.HighlightType.SECONDARY_PRE?this.clearHighlight(I.HighlightType.OCCURRENCE_SECONDARY_PRE,t,i):e===I.HighlightType.COMMENT&&this.clearHighlight(I.HighlightType.OCCURRENCE_COMMENT,t,i),this.viewer.requestDraw()},t.prototype.clearSelectionHighlight=function(e,t){t?this.clearHighlight(t,e,!0):(this.clearHighlight(I.HighlightType.ENTITY,e,!1),this.clearHighlight(I.HighlightType.FEATURE,e,!1),this.clearHighlight(I.HighlightType.PART,e,!1),this.clearHighlight(I.HighlightType.OCCURRENCE,e,!1),this.clearHighlight(I.HighlightType.UI,e,!0),this.clearHighlight(I.HighlightType.INCONTEXT_REFERENCE,e,!0))},t.prototype.clearIndividualHighlights=function(e,t,i){var r=this.selectionsToClearOnReset[t];if(r){for(var n=Object.keys(r),o=0;o<n.length;++o)this.processSelectionHighlight(I.Action.REMOVE,r[n[o]],t,e.type);i&&(this.selectionsToClearOnReset[t]={})}},t.prototype.getOccurrencesStartingWithPath=function(e){var t=this.assemblies[this.displayedElementId];return t?t.getLeafOccurrencesContainedWithinOccurrence(e):[]},t.prototype.getOccurrenceBounds=function(e){var t=this.assemblies[this.displayedElementId];return t?(this.getSceneGraph().updateBounds(),t.getOccurrenceBounds(e)):null},t.prototype.setPlaneName=function(e,t,i){var r=this.getDisplayedPartStudio();r&&r.getElementId()===e&&(r.setPlaneName(t,i),(0,I.isUsageCompare)()||this.applyToPreview(this.setPlaneName,arguments))},t.prototype.setAddDerivedEntityHighlights=function(e){this.addDerivedEntityHighlights!==e&&(this.clearHighlights(),this.addDerivedEntityHighlights=e,this.refreshHighlight())},t.prototype.getAddDerivedEntityHighlights=function(){return this.addDerivedEntityHighlights},t.prototype.isActiveElementEditingInContext=function(){var e=this.partStudios[this.getDisplayedFullElementId()];return!!e&&e.isDisplayingIncontextAssembly()},t.prototype.isDisplayingIncontextAssembly=function(){var e=this.getDisplayedPartStudio();return!!e&&e.isDisplayingIncontextAssembly()},t.prototype.isolateAllPartStudioBodies=function(){var e=this.getDisplayedPartStudio();if(e){var t=e.getPartStudioOccurrenceIds(),i=this.viewer.getIsolatedOccurrenceManager();this.isBase()?i.setIsolatedOccurrenceIds(t):i.addIdsToIsolate(t);var r=e.getAllMateConnectorGraphics(null).map((function(e){return e.getOccurrenceData().getOccurrenceId()}));i.addIdsToIsolate(r),(0,I.setTransparencyTransition)(1),this.viewer.requestDraw()}},t.prototype.clearIsolatedBodies=function(){this.viewer.getIsolatedOccurrenceManager().clearAllIsolateNoAnimation()},t.prototype.switchIsolateActiveElement=function(e){this.viewer.getIsolatedOccurrenceManager().switchActiveElement(e)},t.prototype.getModelStatistics=function(e,t){void 0===t&&(t=!1);var i,n={faces:0,triangles:0,edges:0,lines:0,vertices:0,silhouettes:0,settingCounts:{},uniqueParts:0,uniqueSurfaces:0,uniqueCurves:0,uniqueOpenComposites:0,uniqueClosedComposites:0,partOccurrences:0,surfaceOccurrences:0,curveOccurrences:0,openCompositeOccurrences:0,openCompositeConstituentOccurrences:0,closedCompositeOccurrences:0,closedCompositeConstituentOccurrences:0,bodiesPendingRetrieval:0,errors:[],veryFineParts:new Array,veryFineOccurrences:new Array};for(i in this.partStudios){var o=this.partStudios[i].getStatistics(e,t);for(var s in n.faces+=o.faces,n.triangles+=o.triangles,n.edges+=o.edges,n.lines+=o.lines,n.vertices+=o.vertices,n.silhouettes+=o.silhouettes,n.uniqueParts+=o.uniqueParts,n.uniqueSurfaces+=o.uniqueSurfaces,n.uniqueCurves+=o.uniqueCurves,n.uniqueOpenComposites+=o.uniqueOpenComposites,n.uniqueClosedComposites+=o.uniqueClosedComposites,n.partOccurrences+=o.partOccurrences,n.surfaceOccurrences+=o.surfaceOccurrences,n.curveOccurrences+=o.curveOccurrences,n.openCompositeOccurrences+=o.openCompositeOccurrences,n.openCompositeConstituentOccurrences+=o.openCompositeConstituentOccurrences,n.closedCompositeOccurrences+=o.closedCompositeOccurrences,n.closedCompositeConstituentOccurrences+=o.closedCompositeConstituentOccurrences,n.bodiesPendingRetrieval+=o.bodiesPendingRetrieval,o.settingCounts){var a=n.settingCounts[s]||0;n.settingCounts[+s]=a+o.settingCounts[+s]}t&&(o.veryFineOccurrences.length&&(n.veryFineOccurrences=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(n.veryFineOccurrences),!1),(0,r.__read)(o.veryFineOccurrences),!1)),o.veryFineParts.size&&n.veryFineParts.push(o.veryFineParts)),o.errorMessage&&n.errors.push(o.errorMessage)}return n},t.prototype.removeSelectionHighlights=function(){var e=this;(0,d.getSelectionList)().each((function(t){e.processSelectionHighlight(I.Action.REMOVE,t,"selectionList")}))},t.prototype.reAddSelectionHighlights=function(){var e=this;(0,d.getSelectionList)().each((function(t){e.processSelectionHighlight(I.Action.ADD,t,"selectionList")}))},t.prototype.hideAssembly=function(e){var t=this.assemblies[e];t&&t.hide()},t.prototype.showAssembly=function(e,t){var i=this.assemblies[e];i&&i.show(t)},t.prototype.getInstantiatedTriangleCount=function(){var e=0;for(var t in this.partStudios)e+=this.partStudios[t].getInstantiatedTriangleCount();return e},t.prototype.showPartsWithSheetmetalModelIdOnly=function(e){var t=this.getDisplayedPartStudio();if(t&&(e||this.selectedSheetmetalModelId)&&(t.getBodyComponent(null).showPartsWithSheetmetalModelIdOnly(e),t.getSketchComponent().showPartsWithSheetmetalModelIdOnly(e),t.getImageComponent().showPartsWithSheetmetalModelIdOnly(e),t.getDimensionComponent().showDimensionsWithSheetmetalModelIdOnly(e,t)),this.selectedSheetmetalModelId!==e){this.selectedSheetmetalModelId=e;for(var i=0;i<this.selectionListsHandled.length;++i){var r=this.selectionListsHandled[i];this.resetSelectionListHighlights(r.selectionList,r.selectionListName,r.highlightType)}this.fitToSelectedSheetMetalModel(),this.viewer.getEventDispatcher().trigger(I.ACTIVE_SHEETMETAL_MODEL_CHANGED,e),this.viewer.requestDraw()}},t.prototype.fitToSelectedSheetMetalModel=function(){this.lastFitSheetMetalModelId===this.selectedSheetmetalModelId||this.viewer.isHidden()||!this.viewer.getPrimaryViewController()||(this.viewer.getPrimaryViewController().setStandardView(this.viewer.getDefaultStandardView()),this.viewer.setViewInitialized(!1),this.viewer.requestDraw(),this.lastFitSheetMetalModelId=this.selectedSheetmetalModelId)},t.prototype.hasSelectedSheetmetalModelId=function(){return!!this.selectedSheetmetalModelId},t.prototype.getSelectedSheetmetalModelId=function(){return this.selectedSheetmetalModelId},t.prototype.isBodyEntityMeasurable=function(e,t){var i=this.getDisplayedPartStudio();return!!i&&i.getBodyComponent(null).isEntityMeasurable(e,t)},t.prototype.needsDisplayData=function(e){var t=!1;for(var i in this.partStudios)e.elementId===this.partStudios[i].id&&(t=t||this.partStudios[i].getBodyComponent(null).needsDisplayData(e));return t},t.prototype.getOccurrenceSketchFeatureId=function(e){var t=this.getPartStudioDataFromOccurrence(e),i=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString());return t&&i!==I.INVALID_OCCURRENCE_ID?t.getSketchComponent().getFeatureIdForOccurrence(i):null},t.prototype.getDescriptionOfLastProcessedPartStudio=function(){return this.lastPartStudioProcessed+" : "+this.lastPartStudioMicroversionIdAndConfigurationIntervalProcessed},t.prototype.isOccurrenceIdForInContext=function(e){var t=this.getDisplayedPartStudio();if(t){var i=this.assemblies[t.getVisibleInContextAssemblyId()];if(i){var r=this.viewer.getOccurrenceIdManager().getNameForId(e);return!!i.getDisplayDataForOccurrencePath(r)}}return!1},t.prototype.hideEntityFromPick=function(e,t,i){var r=this.getPartStudioDataFromOccurrence(i);if(r){var n=this.viewer.getOccurrenceDataManager().getOccurrenceData(t);if(n){var o=r.getMeshManager().getIncrementDetails(e,r.getMeshOwnerId());o&&n.hideIncrementFromPick(o,this.usage)}}},t.prototype.hideBodyFromPick=function(e,t,i){var r=this.getPartStudioDataFromOccurrence(i);if(r){var n=this.viewer.getOccurrenceDataManager().getOccurrenceData(t);if(n)for(var o=r.getEntitiesForBody(e),s=0;o&&s<o.length;++s){var a=r.getMeshManager().getIncrementDetails(o[s],r.getMeshOwnerId());a&&n.hideIncrementFromPick(a,this.usage)}}},t.prototype.setDebugFaceTriangles=function(e){Object.values(this.partStudios).forEach((function(t){t.getBodyComponent().setDebugFaceTriangles(e)})),this.simulationManager&&this.simulationManager.setDebugMeshEdges(e)},t.prototype.clearSubFeaturesShownByParameters=function(){this.subFeaturesShownByParameters={}},t.prototype.getSubFeaturesShownByParameters=function(){return this.subFeaturesShownByParameters},t.prototype.collectComponentsForHeapDump=function(e){for(var t in this.partStudios)this.partStudios[t].collectComponentsForHeapDump(e);(0,I.resetStaticSilhouetteState)()},t.prototype.hideSimulationLoadDisplays=function(){var e=this.getDisplayedAssembly();e&&e.hideSimulationLoadDisplays()},t.prototype.showSimulationLoadDisplays=function(){var e=this.getDisplayedAssembly();e&&e.showSimulationLoadDisplays()},t.prototype.onStartEditingAssemblyFeature=function(e){var t=this.getDisplayedAssembly();t&&t.setEditState(e,!0)},t.prototype.onStopEditingAssemblyFeature=function(e){var t=this.getDisplayedAssembly();t&&t.setEditState(e,!1)},t.prototype.refreshSmoothEdgesForAllPartStudios=function(e){var t=l.btInjector.CapabilitiesService.checkSmoothEdgesRenderOptionsForAssembliesCurrentlyEnabled();for(var i in this.partStudios){var r=this.partStudios[i],n=r.getBodyComponent();if(n&&(n.refreshSmoothEdges(),!e)){this.viewer.getSmoothEdgesRenderStyle()===p.GBTSmoothEdgeStyle.VISIBLE&&r.setIsMissingTangencyInformationMessageShown(!1);var o=this.getDisplayedPartStudio()===r;if((o||t)&&this.viewer.getSmoothEdgesRenderStyle()!==p.GBTSmoothEdgeStyle.VISIBLE&&n.hasDisplayedEdgesWithUnknownSmoothness()){if(!o)return this.viewer.showTangencyInformationMissingMessage(),r.setIsMissingTangencyInformationMessageShown(!0),!1;this.updateSmoothEdgesForDisplayedPartStudio()}}}return!0},t.prototype.updateSmoothEdgesForDisplayedPartStudio=function(){this.viewer.getIsForFlattenedDisplay()||(this.isBase()?u.log.debug("Triggered smooth edge update from base viewer"):u.log.debug("Triggered smooth edge update from preview"),this.viewer.getEventDispatcher().trigger(I.RETRIEVE_SMOOTH_EDGE_INFORMATION))},t.prototype.processSmoothEdgeUpdate=function(e){for(var t=0;t<e.tangencyReponses.length;++t){var i=e.tangencyReponses[t],r=this.getPartStudio(i.source);r?r.getBodyComponent().updateEdgeSmoothness(i.edgeDeterministicIDToIsSmoothMap):u.log.warn("Part studio not found when applying smooth edge response")}this.refreshSmoothEdgesForAllPartStudios(!0),this.viewer.requestDraw()},t}(n.BackboneEventsBaseClass);t.ModelViewManager=P;var _=function(){function e(e,t){var i=this;this.occurrenceDataManager=e,this.viewer=t,this.modelViewManagers={},this.lastPreviewedPartStudioId=null,(0,I.viewerCheck)(t),this.viewer.getEventDispatcher().on(I.SESSION_ENDED,(function(){i.clearTheManagers()}))}return e.prototype.getManager=function(){var e=I.bt_graphics_Usage.BASE,t=this.modelViewManagers[e];return t||(t=new P(e,this.occurrenceDataManager,this.viewer),this.modelViewManagers[e]=t),t},e.prototype.clearTheManagers=function(){Object.values(this.modelViewManagers).forEach((function(e){e&&e.onDeletion()})),this.modelViewManagers={}},e.prototype.getManagerForUsage=function(e){return e===I.bt_graphics_Usage.BASE?this.getManager():e===I.bt_graphics_Usage.PREVIEW?this.getPreviewManager():null},e.prototype.getPreviewManager=function(e){var t=this.getManager().bodyLoadTasks,i=e?e.buildFullElementId(!0):null;if(!i||this.modelViewManagers[I.bt_graphics_Usage.PREVIEW]&&i.elementId===this.lastPreviewedPartStudioId){var r=this.modelViewManagers[I.bt_graphics_Usage.PREVIEW];return r&&t&&t.completeTasks(),r}t&&t.completeTasks(),this.resetPreviewManager();var n=this.getManager().cloneForPreview(i);return this.modelViewManagers[I.bt_graphics_Usage.PREVIEW]=n,this.lastPreviewedPartStudioId=i.elementId,n},e.prototype.previewManagerExists=function(){return null!==this.lastPreviewedPartStudioId&&!!this.modelViewManagers[I.bt_graphics_Usage.PREVIEW]},e.prototype.resetPreviewManager=function(){this.viewer.getUiResourceManager().destroyPreviewGraphics(),this.viewer.getSceneGraphs().getPreviewSceneGraph().removeEverything(),this.modelViewManagers[I.bt_graphics_Usage.PREVIEW]&&this.modelViewManagers[I.bt_graphics_Usage.PREVIEW].onDeletion(),this.modelViewManagers[I.bt_graphics_Usage.PREVIEW]=null,this.lastPreviewedPartStudioId=null,this.getManager().onPreviewDestroyed(),this.viewer.getOccurrenceDataManager().onPreviewDestroyed()},e}();t.ModelViewManagers=_},653387:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMouseSettingsManager=void 0;var r=i(463943),n=i(402197),o=i(311611),s=i(601759),a=function(){function e(){this.zoomScrollDirection=!1,this.viewManipulationMouseKeyMapping={},this.mouseStringCodeMap={},this.keyStringCodeMap={},this.defaultReverseScrollWheelZoomDirection=!1,this.mouseStringCodeMap.LMB=r.MouseButton.LEFT,this.mouseStringCodeMap.MMB=r.MouseButton.MIDDLE,this.mouseStringCodeMap.RMB=r.MouseButton.RIGHT,this.keyStringCodeMap.CTRL=n.Keys.CONTROL,this.keyStringCodeMap.SHIFT=n.Keys.SHIFT,this.keyStringCodeMap.ALT=n.Keys.ALT}return e.prototype.setMouseSettings=function(e){this.zoomScrollDirection=e.reverseScrollWheelZoomDirection,this.viewManipulationMouseKeyMapping=e.viewManipulationMouseKeyMapping,this.applyViewManipulationMouseKeyMapping()},e.prototype.getMouseButtons=function(e){var t=[];return e.forEach((function(e){this.mouseStringCodeMap.hasOwnProperty(e)&&t.push(this.mouseStringCodeMap[e])}),this),t},e.prototype.getKeyCodes=function(e){var t=[];return e.forEach((function(e){this.keyStringCodeMap.hasOwnProperty(e)&&t.push(this.keyStringCodeMap[e])}),this),t},e.prototype.applyViewManipulationMouseKeyMapping=function(){var e=this;if(this.viewManipulationMouseKeyMapping){var t=(0,o.viewManipulationSettingsGetManager)();t.clearMouseKeyManipulationBindings(),Object.keys(this.viewManipulationMouseKeyMapping).forEach((function(i){var r=o.ManipulationMode.NONE;switch(i){case"pan3DMapping":r=o.ManipulationMode.PAN;break;case"zoom3DMapping":r=o.ManipulationMode.ZOOM;break;case"rotate3DMapping":r=o.ManipulationMode.ROTATE;break;case"axisRotate3DMapping":r=o.ManipulationMode.AXIS_ROTATE;break;default:r=o.ManipulationMode.NONE}if(r!==o.ManipulationMode.NONE)for(var n=e.viewManipulationMouseKeyMapping[i],a=0;a<n.length;++a){var c=n[a],l=e.getMouseButtons(c.mouseButtons),u=e.getKeyCodes(c.keys);(0,s.isEmptyObjectOrArray)(l)&&(0,s.isEmptyObjectOrArray)(u)||t.addMouseKeyManipulationModeBinding(l,u,r)}}))}},e.prototype.isScrollZoomDefault=function(){return this.zoomScrollDirection===this.defaultReverseScrollWheelZoomDirection},e}(),c=null;t.getMouseSettingsManager=function(){return c||(c=new a),c}},341:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.btTs=void 0;var r=i(736202),n=i(817395),o=i(311611),s=i(311611),a=i(311611),c=i(311611),l=i(311611),u=i(311611),h=i(311611),d=i(311611),p=i(311611),g=i(311611),f=i(311611),m=i(311611),y=i(311611),v=i(311611),E=i(311611),I=i(311611),T=i(311611),S=i(311611),P=i(311611),_=i(311611),M=i(311611),D=i(311611),C=i(311611),O=i(311611),A=i(311611),R=i(311611),N=i(311611),w=i(311611),b=i(311611),L=i(311611),F=i(311611),B=i(311611);!function(e){!function(e){e.camera=h,e.frametimer=u,e.math=s,e.editstate=o,e.debugTools=a,e.eventdispatcher=c,e.utilities=(0,r.merge)({},l,{RetinaDisplayMode:B.RetinaDisplayMode},{pixelscaling:w}),e.viewcontroller=p,e.measurementdisplay=d,e.sectionplane=g,e.statistics=f,e.sketchdisplaydata=m,e.imagedisplay=y,e.sketchcomponent=v,e.splinehandle=E,e.zoomToWindowState=I,e.dimensions=T,e.coordinatesysteminference=S,e.triad=P,e.mateconnector=_,e.animationcontroller=M,e.occurrence=D,e.manipulators=C,e.idmanager=O,e.inferencepicker=A,e.mateindicator=R,e.viewerset=N,e.viewmanipulator=b,e.axes=L,e.inputhandler=F}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={})),function(e){!function(e){!function(e){e.getActiveViewer=B.getActiveViewer,e.viewerCheck=n.viewerCheck,e.getFocusedViewer=B.getFocusedViewer,e.getActiveViewerModelViewManagers=B.getActiveViewerModelViewManagers,e.retrieveViewportAsImage=B.retrieveViewportAsImage,e.getActiveViewerOccurrenceDataManager=B.getActiveViewerOccurrenceDataManager}(e.viewer||(e.viewer={}))}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={})),function(e){!function(e){!function(e){e.setRefinementMode=B.setRefinementMode,e.RefinementMode=B.RefinementMode}(e.bodymanager||(e.bodymanager={}))}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={})),function(e){!function(e){!function(e){e.View=B.View}(e.sketchinformation||(e.sketchinformation={}))}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={})),function(e){!function(e){!function(e){e.PrimitiveType=B.PrimitiveType}(e.meshattr||(e.meshattr={}))}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={})),function(e){!function(e){!function(e){e.EdgePoint=B.EdgePoint}(e.edgepoint||(e.edgepoint={}))}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={})),function(e){!function(e){!function(e){e.Manager=B.DetailManager}(e.detail||(e.detail={}))}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={})),function(e){!function(e){!function(e){e.visualizePicks=B.visualizePicks}(e.debug||(e.debug={}))}(e.graphics||(e.graphics={}))}(t.btTs||(t.btTs={}))},167303:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OccurrenceData=void 0;var r=i(423902),n=i(311611),o=i(911748),s=i(601759),a=new n.ChainedOperator,c=function(){function e(e,t){this.occurrenceId=e,this.shouldSetOccurrenceUniform=!0,this.isolated=!1,this.canIsolateChange=!0,this.cullingState=null,this.hiddenBaseMeshRanges=null,this.hiddenPreviewMeshRanges=null,this.hiddenFromPickBaseMeshRanges=null,this.hiddenFromPickPreviewMeshRanges=null,this.baseHighlights=null,this.previewHighlights=null,this.transform=o.mat4.identity(),this.lod=n.Lod.DEFAULT,this.visibility=n.Visibility.VISIBLE,this.boundables=new Set,this.isClippedBySectionPlane=t}return e.prototype.destroy=function(){this.hiddenBaseMeshRanges&&(this.hiddenBaseMeshRanges.destroy(),this.hiddenBaseMeshRanges=null),this.hiddenPreviewMeshRanges&&(this.hiddenPreviewMeshRanges.destroy(),this.hiddenPreviewMeshRanges=null),this.hiddenFromPickBaseMeshRanges&&(this.hiddenFromPickBaseMeshRanges.destroy(),this.hiddenFromPickBaseMeshRanges=null),this.hiddenFromPickPreviewMeshRanges&&(this.hiddenFromPickPreviewMeshRanges.destroy(),this.hiddenFromPickPreviewMeshRanges=null),this.baseHighlights&&(this.baseHighlights.destroy(),this.baseHighlights=null),this.previewHighlights&&(this.previewHighlights.destroy(),this.previewHighlights=null),this.boundables.clear()},e.prototype.onPreviewDestroyed=function(){this.hiddenPreviewMeshRanges&&(this.hiddenPreviewMeshRanges.destroy(),this.hiddenPreviewMeshRanges=null),this.hiddenFromPickPreviewMeshRanges&&(this.hiddenFromPickPreviewMeshRanges.destroy(),this.hiddenFromPickPreviewMeshRanges=null),this.previewHighlights&&(this.previewHighlights.destroy(),this.previewHighlights=null)},e.prototype.getOccurrenceId=function(){return this.occurrenceId},e.prototype.setShouldSetOccurrenceUniform=function(e){this.shouldSetOccurrenceUniform=e},e.prototype.getShouldSetOccurrenceUniform=function(){return this.shouldSetOccurrenceUniform},e.prototype.setTransform=function(e){(0,n.areMatricesEqual)(this.transform,e)||(this.transform=o.mat4.create(e),this.damageBoundables())},e.prototype.getTransform=function(){return this.transform},e.prototype.setIsolated=function(e){this.canIsolateChange&&(this.isolated=e)},e.prototype.getIsolated=function(){return this.isolated},e.prototype.setCanIsolateChange=function(e){this.canIsolateChange=e},e.prototype.setLod=function(e){this.lod=e},e.prototype.getLod=function(){return this.lod},e.prototype.setVisibility=function(e){e!==this.visibility&&(this.visibility=e,this.damageBoundables())},e.prototype.getVisibility=function(){return this.visibility},e.prototype.getCullingState=function(){return this.cullingState},Object.defineProperty(e.prototype,"culledMeshGroupIdSet",{get:function(){var e=this.cullingState;return e&&e.size?e:null},enumerable:!1,configurable:!0}),e.prototype.setCullingState=function(e,t){if(t){var i=this.culledMeshGroupIdSet;e===n.CullingState.CULLED?(i||(i=new Set,this.cullingState=i),i.add(t)):i&&(i.delete(t),0===i.size&&(this.cullingState=n.CullingState.VISIBLE))}else this.cullingState=e},e.prototype.getMeshGroupCullingState=function(e){if(this.cullingState===n.CullingState.VISIBLE||this.cullingState===n.CullingState.CULLED)return this.cullingState;var t=this.culledMeshGroupIdSet;return t&&t.has(e)?n.CullingState.CULLED:n.CullingState.VISIBLE},e.prototype.isStyledRangeCulled=function(e,t){if(this.cullingState===n.CullingState.VISIBLE||t.getUsage()!==n.bt_graphics_Usage.BASE)return!1;if(this.cullingState===n.CullingState.CULLED)return!0;var i=e.getMeshRangesGroupId();return!!i&&this.getMeshGroupCullingState(i)===n.CullingState.CULLED},e.prototype.isVisible=function(e){return!(this.cullingState===n.CullingState.CULLED&&e.getUsage()===n.bt_graphics_Usage.BASE)&&(e.isHighlighting()?this.hasHighlight():this.visibility===n.Visibility.VISIBLE)},e.prototype.isBoundable=function(){return this.visibility===n.Visibility.VISIBLE||this.hasHighlight()},e.prototype.isIncrementBoundable=function(e,t){var i=this.getHiddenRangesForUsage(t),r=this.getHighlightsForUsage(t),n=!!i&&i.containsIncrement(e),o=!!r&&r.entityHasHighlight(e);return!n||o},e.prototype.hasHighlight=function(){var e=!1;return this.baseHighlights&&(e=this.baseHighlights.hasHighlight()),this.previewHighlights&&(e=e||this.previewHighlights.hasHighlight()),e},e.prototype.getOrCreateHiddenRangesForUsage=function(e){return e===n.bt_graphics_Usage.BASE?(this.hiddenBaseMeshRanges||(this.hiddenBaseMeshRanges=new n.SubtractMeshRanges(this.occurrenceId+".hiddenBaseMeshRanges")),this.hiddenBaseMeshRanges):(this.hiddenPreviewMeshRanges||(this.hiddenPreviewMeshRanges=new n.SubtractMeshRanges(this.occurrenceId+".hiddenPreviewMeshRanges")),this.hiddenPreviewMeshRanges)},e.prototype.getHiddenRangesForUsage=function(e){return e===n.bt_graphics_Usage.BASE?this.hiddenBaseMeshRanges:this.hiddenPreviewMeshRanges},e.prototype.getOrCreateHiddenFromPickRangesForUsage=function(e){return e===n.bt_graphics_Usage.BASE?(this.hiddenFromPickBaseMeshRanges||(this.hiddenFromPickBaseMeshRanges=new n.SubtractMeshRanges(this.occurrenceId+".hiddenFromPickBaseMeshRanges")),this.hiddenFromPickBaseMeshRanges):(this.hiddenFromPickPreviewMeshRanges||(this.hiddenFromPickPreviewMeshRanges=new n.SubtractMeshRanges(this.occurrenceId+".hiddenFromPickPreviewMeshRanges")),this.hiddenFromPickPreviewMeshRanges)},e.prototype.getHiddenFromPickRangesForUsage=function(e){return e===n.bt_graphics_Usage.BASE?this.hiddenFromPickBaseMeshRanges:this.hiddenFromPickPreviewMeshRanges},e.prototype.hideIncrement=function(e,t){this.getOrCreateHiddenRangesForUsage(t).onIncrementAdded(e)&&this.damageBoundables()},e.prototype.showIncrement=function(e,t){var i=this.getHiddenRangesForUsage(t);i&&i.onIncrementRemoved(e)&&this.damageBoundables()},e.prototype.isIncrementHidden=function(e,t){var i=this.getHiddenRangesForUsage(t);return!!i&&i.containsIncrement(e)},e.prototype.hideIncrementFromPick=function(e,t){this.getOrCreateHiddenFromPickRangesForUsage(t).onIncrementAdded(e)},e.prototype.isIncrementHiddenFromPick=function(e,t){var i=this.getHiddenFromPickRangesForUsage(t);return!!i&&i.containsIncrement(e)},e.prototype.resetHiddenFromPick=function(){this.hiddenFromPickBaseMeshRanges&&(this.hiddenFromPickBaseMeshRanges.destroy(),this.hiddenFromPickBaseMeshRanges=null),this.hiddenFromPickPreviewMeshRanges&&(this.hiddenFromPickPreviewMeshRanges.destroy(),this.hiddenFromPickPreviewMeshRanges=null)},e.prototype.getOrCreateHighlightsForUsage=function(e){return e===n.bt_graphics_Usage.BASE?(this.baseHighlights||(this.baseHighlights=new n.OccurrenceHighlights),this.baseHighlights):(this.previewHighlights||(this.previewHighlights=new n.OccurrenceHighlights),this.previewHighlights)},e.prototype.getBaseOccurrenceHighlight=function(){return this.baseHighlights?this.baseHighlights.getHighestPriorityOccurrenceHighlight():null},e.prototype.getHighlightsForUsage=function(e){return e===n.bt_graphics_Usage.BASE?this.baseHighlights:this.previewHighlights},e.prototype.updateEntityHighlight=function(e,t,i,r){var n=this.hasHighlight();this.getOrCreateHighlightsForUsage(r).updateEntityHighlight(e,t,i),n!==this.hasHighlight()&&this.damageBoundables()},e.prototype.updateOccurrenceHighlight=function(e,t,i){var r=this.hasHighlight();this.getOrCreateHighlightsForUsage(i).updateOccurrenceHighlight(e,t),r!==this.hasHighlight()&&this.damageBoundables()},e.prototype.clearHighlight=function(e,t){var i=this.hasHighlight(),r=this.getHighlightsForUsage(t);r&&r.clearHighlight(e),i!==this.hasHighlight()&&this.damageBoundables()},e.prototype.clearAllOccurrenceLevelHighlights=function(){this.hasHighlight()&&(this.baseHighlights&&this.baseHighlights.clearAllOccurrenceLevelHighlights(),this.previewHighlights&&this.previewHighlights.clearAllOccurrenceLevelHighlights(),this.damageBoundables())},e.prototype.getEntityHighlights=function(e,t){var i=this.getHighlightsForUsage(t);return i?i.getEntityHighlights(e):null},e.prototype.removeEntityHighlights=function(e,t){var i=this.getHighlightsForUsage(t);i&&i.removeEntityHighlights(e)},e.prototype.getMeshRangeOperator=function(e){if(e.isHighlighting())return(r=this.getHighlightsForUsage(e.getUsage()))?r.getHighlightOperator(e):n.NO_RANGE_OPERATOR;if(e.isPicking()){var t=this.getHiddenRangesForUsage(e.getUsage()),i=this.getHiddenFromPickRangesForUsage(e.getUsage());return i&&t?(a.resetWithOperands(t,i),a):t||i}e.applyStyle(n.EMPTY_HIGHLIGHT_STYLE);var r=this.getHighlightsForUsage(e.getUsage()),o=this.getHiddenRangesForUsage(e.getUsage());return r?r.getHighlightStyleOperator(e,o):o},e.prototype.addBoundable=function(e){this.boundables.add(e)},e.prototype.removeBoundable=function(e){this.boundables.delete(e)},e.prototype.damageBoundables=function(){var e,t;try{for(var i=(0,r.__values)(this.boundables.values()),n=i.next();!n.done;n=i.next()){n.value.damageBounds()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.makeSceneDebugObject=function(){var e="Occurrence "+this.occurrenceId,t=[];return t.push((0,n.createTextDebugObject)("transform",this.transform)),t.push((0,n.createTextDebugObject)("isolated",this.isolated)),t.push((0,n.createTextDebugObject)("clippedBySectionPlane",this.isClippedBySectionPlane)),t.push((0,n.createTextDebugObject)("lod",this.lod)),t.push((0,n.createTextDebugObject)("visibility",(0,n.visibilityDescriptor)(this.visibility))),t.push((0,n.createTextDebugObject)("cullingState",this.cullingState instanceof Set?Array.from(this.cullingState).toString():(0,s.getKeyForValue)(n.CullingState,this.cullingState))),t.push((0,n.createTextDebugObject)("shouldSetOccurrenceUniform",this.shouldSetOccurrenceUniform)),this.hiddenBaseMeshRanges&&t.push(this.hiddenBaseMeshRanges.makeSceneDebugObject()),this.hiddenPreviewMeshRanges&&t.push(this.hiddenPreviewMeshRanges.makeSceneDebugObject()),this.hiddenFromPickBaseMeshRanges&&t.push(this.hiddenFromPickBaseMeshRanges.makeSceneDebugObject()),this.hiddenFromPickPreviewMeshRanges&&t.push(this.hiddenFromPickPreviewMeshRanges.makeSceneDebugObject()),this.baseHighlights&&t.push(this.baseHighlights.makeSceneDebugObject("baseHighlights")),this.previewHighlights&&t.push(this.previewHighlights.makeSceneDebugObject("previewHighlights")),{text:e,children:t}},e.prototype.getHighlightDebugInfo=function(){return this.hasHighlight()?{baseHighlights:this.baseHighlights?this.baseHighlights.getEntityHighlightsDebugInfo():null,previewHighlights:this.previewHighlights?this.previewHighlights.getEntityHighlightsDebugInfo():null}:null},e.prototype.getIsClippedBySectionPlanes=function(){return this.isClippedBySectionPlane},e.prototype.setIsClippedBySectionPlanes=function(e){this.isClippedBySectionPlane=e},e}();t.OccurrenceData=c},428821:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataManager=void 0;var r=i(311611),n=i(911748),o=function(){function e(e){this.viewer=e,this.occurrenceData={},(0,r.viewerCheck)(e),this.getOrCreateOccurrenceData(r.PART_STUDIO_ELEMENT_ID)}return e.prototype.destroy=function(){Object.values(this.occurrenceData).forEach((function(e){e.destroy()})),this.occurrenceData={},(0,r.resetSharedOperators)()},e.prototype.onPreviewDestroyed=function(){Object.values(this.occurrenceData).forEach((function(e){e.onPreviewDestroyed()}))},e.prototype.forEach=function(e){for(var t in this.occurrenceData)e(t,this.occurrenceData[t])},e.prototype.getOrCreateOccurrenceData=function(e){var t=this.occurrenceData[e];return t||(this.occurrenceData[e]=t=new r.OccurrenceData(+e,this.viewer.getIsExcludingItemsForSection())),t},e.prototype.getOccurrenceData=function(e){var t=this.occurrenceData[e];return t||null},e.prototype.destroyOccurrenceData=function(e){var t=this.occurrenceData[e];t&&(t.destroy(),delete this.occurrenceData[e])},e.prototype.setOccurrenceTransform=function(e,t){var i=this.getOrCreateOccurrenceData(e);return i.setTransform(t),this.viewer.requestDraw(),i},e.prototype.getOccurrenceTransform=function(e){var t=this.getOrCreateOccurrenceData(e);return t?t.getTransform():n.mat4.identity()},e.prototype.processHighlightForOccurrences=function(e,t,i,n){for(var o=this.viewer.getOccurrenceIdManager(),s=0;s<t.length;++s){var a=o.getIdForName(t[s].getPathAsString());a!==r.INVALID_OCCURRENCE_ID&&this.getOrCreateOccurrenceData(a).updateOccurrenceHighlight(e,i,n)}this.viewer.requestDraw()},e.prototype.clearHighlight=function(e,t){for(var i in this.occurrenceData){this.occurrenceData[i].clearHighlight(e,t)}this.viewer.requestDraw()},e.prototype.clearIsolation=function(){this.setAllIsolated(!1)},e.prototype.isolateAll=function(){this.setAllIsolated(!0)},e.prototype.setAllIsolated=function(e){for(var t in this.occurrenceData){this.occurrenceData[t].setIsolated(e)}this.viewer.requestDraw()},e.prototype.setOccurrenceIsolated=function(e,t){this.getOrCreateOccurrenceData(e).setIsolated(t),this.viewer.requestDraw()},e.prototype.resetHiddenFromPick=function(){for(var e in this.occurrenceData)this.occurrenceData[e].resetHiddenFromPick()},e.prototype.makeSceneDebugObject=function(){var e=[];return Object.values(this.occurrenceData).forEach((function(t){e.push(t.makeSceneDebugObject())})),{text:"Occurrence data",children:e}},e}();t.DataManager=o},659916:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioIsolateManager=void 0;var r=i(423902),n=i(129346),o=i(784167),s=i(311611),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.setUpListeners=function(){e.prototype.setUpListeners.call(this),this.listenTo((0,o.getCommandDispatcher)(),n.commands.EXIT_ISOLATE,this.clearEffectExit),this.listenTo((0,o.getCommandDispatcher)(),n.commands.ISOLATE_PARTS,this.affectParts)},t.prototype.clearIsolateNoAnimation=function(){this.clearEffectNoAnimation()},t.prototype.hasIsolatedInstances=function(){return this.hasAffectedInstances()},t.prototype.areSelectionsAlreadyIsolated=function(e){return this.areSelectionsAlreadyAffected(e)},t.prototype.areSelectionsInListAlreadyIsolated=function(e){return this.areSelectionsInListAlreadyAffected(e)},t.prototype.isInIsolateMode=function(){return this.isInEffectMode()},t.prototype.addIdsToIsolate=function(e,t){this.addIdsToAffect(e,t)},t.prototype.removeFromIsolate=function(e){this.removeFromEffect(e)},t.prototype.isolateOccurrences=function(e,t){this.affectOccurrences(e,t)},t.prototype.getIsolatedOccurrences=function(){return this.getAffectedOccurrences()},t.prototype.setIsolatedOccurrenceIds=function(e){this.setAffectedOccurrenceIds(e)},t.prototype.clearEffect=function(){this.initialAffectedPartIds=[],this.setAffectedOccurrenceIds([]),this.setIsolatedPartMates(!1),this.initialAffectedSheetMetalIds=new Set},t.prototype.triggerExit=function(){(0,o.getCommandDispatcher)().trigger(n.commands.EXIT_ISOLATE,this.viewer)},t.prototype.shouldNotDoAnimation=function(){return this.hasAffectedInstances()},t.prototype.shouldClearOccurrenceIds=function(){return this.hasAffectedInstances()},t.prototype.refreshMateIsolation=function(e){this.setIsolatedPartMates(!1),this.setIsolatedPartMates(!0,e)},t.prototype.shouldAddPreexistingParts=function(){return!1},t.prototype.shouldAddSketchesToIsolate=function(){return!0},t.prototype.showDialog=function(){this.dialog?this.dialog.onAssemblyOrPartStudioDataProcessed():this.dialog=s.IsolatedManagersUtils.createIsolateDialog(this)},t.prototype.updateOccurrenceDataManager=function(){s.IsolatedManagersUtils.updateOccurrenceDataManager(this.affectedOccurrenceIds,this.viewer.getOccurrenceDataManager())},t}(s.PartStudioIsolateManagerBase);t.PartStudioIsolateManager=a},318733:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioIsolateManagerBase=void 0;var r=i(423902),n=i(163113),o=i(691565),s=i(712197),a=i(601759),c=i(311611),l=i(673290),u=i(501242),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.initialAffectedPartIds=[],t.initialAffectedSheetMetalIds=new Set,t.affectedPartIds=[],t}return(0,r.__extends)(t,e),t.prototype.setUpListeners=function(){this.stopListening(),this.listenTo(this.viewer.getEventDispatcher(),c.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,this.onPartDataProcessed)},t.prototype.onPartDataProcessed=function(e){var t=e.elementId,i=u.DocumentController.getOpenDocumentController().getDeterministicIdMapper(t);this.initialAffectedPartIds=this.initialAffectedPartIds.map((function(t){return i.remapDetId(t,e.featureIdToOperationIndices)})),this.isInEffectMode()&&(0,n.isInPartStudioElement)()&&this.reAffectParts(this.initialAffectedPartIds,c.IsolateFlag.PART_STUDIO_UPDATE,!1)},t.prototype.affectParts=function(e,t,i){this.viewer===t&&this.reAffectParts(e.map((function(e){return e.id})),c.IsolateFlag.INITIAL,i)},t.prototype.clearEffectExit=function(t){var i=this.viewer.getModelViewManagers().getManager().isDisplayingIncontextAssembly();i?(this.clearEffectNoAnimation(),(0,c.getActiveViewerEventDispatcher)().trigger(c.UPDATE_INCONTEXT_ISOLATION,i)):(e.prototype.clearEffectExit.call(this,t),this.updateLaminarEdges())},t.prototype.clearEffectNoAnimation=function(){e.prototype.clearEffectNoAnimation.call(this),this.updateLaminarEdges()},t.prototype.reAffectParts=function(e,t,i){this.shouldAddPreexistingParts()&&(e=(0,a.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(e),!1),(0,r.__read)(this.initialAffectedPartIds),!1),(function(e){return e}))),t===c.IsolateFlag.INITIAL&&(this.initialAffectedSheetMetalIds=this.getSheetMetalIds(e,this.getModelViewManager()));var n=this.getAssociatedPartIdsFromSheetMetalIds(this.initialAffectedSheetMetalIds,this.getModelViewManager());this.getPreviewViewManager()&&(n=n.concat(this.getAssociatedPartIdsFromSheetMetalIds(this.initialAffectedSheetMetalIds,this.getPreviewViewManager()))),e=(0,a.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(e),!1),(0,r.__read)(n),!1),(function(e){return e}));var o=this.getIndividualOccurrenceIdsFromPartIds(e);if(0!==o.length){var l=!0;this.shouldNotDoAnimation()&&(l=!1),this.shouldClearOccurrenceIds()&&this.setAffectedOccurrenceIds([]),!(0,s.isSelectionFocused)()&&t!==c.IsolateFlag.PART_STUDIO_UPDATE&&!u.DocumentController.getOpenDocumentController().getActiveElementController().getViewAlignmentController().isSectionViewDialogVisible()&&((0,s.clearSelection)(),(0,s.clearPreSelection)()),t!==c.IsolateFlag.INITIAL&&t!==c.IsolateFlag.PART_STUDIO_UPDATE||(this.initialAffectedPartIds=e,this.centersOfInitialAffectedInstances=null),this.affectedPartIds=e,this.refreshMateIsolation(this.affectedPartIds),this.affectPartOccurrenceIds(o,t,l,i)}else this.triggerExit()},t.prototype.getSheetMetalIds=function(e,t){var i=t.getDisplayedPartStudio(),r=new Set;return e.forEach((function(e){var t=i.retrieveBodyMetaData(e);t&&t.sheetMetalModelId&&r.add(t.sheetMetalModelId)})),r},t.prototype.getAssociatedPartIdsFromSheetMetalIds=function(e,t){var i=t.getDisplayedPartStudio(),r=[];for(var n in i.bodyComponent.bodyMetaData){var o=i.bodyComponent.bodyMetaData[n];o.sheetMetalModelId&&e.has(o.sheetMetalModelId)&&r.push(n)}return r},t.prototype.setIsolatedPartMates=function(e,t){var i=this.getModelViewManager().getDisplayedPartStudio();if(i){var r=i.getAllMateConnectorGraphics(null).filter((function(e){return""!==e.definition.partId}));this.isolateMateConnectors(r,this.getModelViewManager(),e,t)}var n=this.getPreviewViewManager();if(n){var o=n.getDisplayedPartStudio();if(o){var s=o.getAllMateConnectorGraphics(null).filter((function(e){return""!==e.definition.partId}));this.isolateMateConnectors(s,n,e,t)}}},t.prototype.isolateMateConnectors=function(e,t,i,r){if(r){var n=this.getIndividualPartIds(r,t),o=t.getDisplayedPartStudio();e.forEach((function(e){var t=e.definition.partId,r=o.retrieveBodyMetaData(t);r&&r.consumingClosedCompositeData&&(t=r.consumingClosedCompositeData.id),n.has(t)&&e.getOccurrenceData().setIsolated(i)}))}else e.forEach((function(e){e.getOccurrenceData().setIsolated(i)}))},t.prototype.shouldAddSketchesToEffect=function(){return!0},t.prototype.updateLaminarEdges=function(){var e=this.viewer.getFilteredEntitiesHighlightController();e&&e.updateSetOfFilteredEntities()},t.prototype.affectPartOccurrenceIds=function(e,t,i,r){0!==e.length?(this.shouldAddSketchesToEffect()&&e.push(this.getModelViewManager().getDisplayedPartStudio().getSketchComponent().sketchComponentElementId),this.hasAffectedInstances()&&this.setAffectedOccurrenceIds([]),this.addIdsToAffect(e,!0),this.refreshMateIsolation(this.affectedPartIds),this.makeTransparent(i,r),(t===c.IsolateFlag.INITIAL||t===c.IsolateFlag.PART_STUDIO_UPDATE&&this.isInEffectMode())&&this.showDialog(),this.updateLaminarEdges()):this.triggerExit()},t.prototype.getIndividualOccurrenceIdsFromPartIds=function(e){var t=[],i=this.getIndividualPartIds(e,this.getModelViewManager()),r=this;return i.forEach((function(e){var i=r.getOccurrenceIdFromPartId(e);i&&t.push(i)})),t},t.prototype.getIndividualPartIds=function(e,t){var i=t.getDisplayedPartStudio(),r=new Set;return e.forEach((function(e){var t=i.retrieveBodyMetaData(e);t&&(t.isComposite&&!t.isGroupableCompositeBody?t.constituentBodyIds.forEach((function(e){r.add(e)})):r.add(e))})),r},t.prototype.getOccurrenceIdFromPartId=function(e){var t=this.getModelViewManager().getDisplayedPartStudio().getBodyComponent().getBodyOccurrenceData(e);if(t){var i=t.getOccurrenceId();if(i&&i!==c.INVALID_OCCURRENCE_ID)return i}return null},t.prototype.areSelectionsAlreadyAffected=function(e){if((0,n.isInPartStudioElement)()){var i=t.getSelectedParts(e,this.viewer);return this.arePartsAlreadyAffected(i)}return!1},t.prototype.areSelectionsInListAlreadyAffected=function(e){var t=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio().id;if((0,n.isInPartStudioElement)()){var i=(0,s.getPartModelsFromListOfSelections)(t,e);return this.arePartsAlreadyAffected(i)}return!1},t.prototype.arePartsAlreadyAffected=function(e){var t=e.map((function(e){return e.id}));return(0,a.hasEquivalentValues)(t,this.initialAffectedPartIds,(function(e){return e}))},t.getSelectedParts=function(e,t){var i,r=c.IsolatedOccurrencesManager.getSelectionFromNodeModelOrSelection(e,t),n=t.getModelViewManagers().getManager().getDisplayedPartStudio().id;return r&&(i=o.PartList.getPartModelFromPartId(r.getPartId(),n)),(0,s.getSelectedAndAssociatedPartModels)(n,i)},t.prototype.updateCentersOfInitialAffectedInstances=function(){var e=this;if(!this.centersOfInitialAffectedInstances){var t=[];this.initialAffectedPartIds.forEach((function(i){var r=e.getModelViewManager().getBodyBounds(i,null);r&&t.push(r.center())})),this.centersOfInitialAffectedInstances=t.filter(a.isDefined,this)}},t.prototype.expandEffectByProximity=function(e){var t=this.getAffectedPartIdsForExpandEffectByProximity(e,this.getModelViewManager(),!1),i=this.getIndividualOccurrenceIdsFromPartIds(t),n=this.getPreviewViewManager();if(n){var o=this.getAffectedPartIdsForExpandEffectByProximity(e,n,!0),s=n.getDisplayedPartStudio().getBodyComponent(),l=[];o.forEach((function(e){var t=s.getBodyOccurrenceData(e);t&&l.push(t.getOccurrenceId())})),t=(0,a.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(t),!1),(0,r.__read)(o),!1),(function(e){return e})),i=(i=(0,a.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(i),!1),(0,r.__read)(l),!1),(function(e){return e+""}))).concat(this.getAffectedOwnerlessMatesOccurrenceIdsByProximity(e,n))}this.affectedPartIds=t,this.affectPartOccurrenceIds(i,c.IsolateFlag.EXPAND,!1,!1)},t.prototype.getAffectedOwnerlessMatesOccurrenceIdsByProximity=function(e,t){var i,n;if(Math.abs(e)<=l.Tolerances.ZERO_LENGTH)return[];var o=[],s=t.getDisplayedPartStudio().getAllMateConnectorGraphics(null).filter((function(e){return""===e.definition.partId})),a=e*e;try{for(var c=(0,r.__values)(s),u=c.next();!u.done;u=c.next()){var h=u.value;this.isPointWithinDistanceOfInitialAffectedInstances(h.worldSpacePosition,a)&&o.push(h.getOccurrenceData().getOccurrenceId())}}catch(e){i={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}return o},t.prototype.getAffectedPartIdsForExpandEffectByProximity=function(e,t,i){var n=this.getAssociatedPartIdsFromSheetMetalIds(this.initialAffectedSheetMetalIds,t);if(!i&&Math.abs(e)<=l.Tolerances.ZERO_LENGTH)return(0,a.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(this.initialAffectedPartIds),!1),(0,r.__read)(n),!1),(function(e){return e}));this.updateCentersOfInitialAffectedInstances();var o=t.getDisplayedPartStudio().getBodyComponent(),s=[],c=e*e;for(var u in o.partStudioBodyIdToOccurrenceId)this.isWithinDistanceOfAnInitialIsolatedPart(c,u,null,t)&&s.push(u);var h=this.getSheetMetalIds(s,t),d=this.getAssociatedPartIdsFromSheetMetalIds(h,t);return(0,a.unionWithoutDuplicateValues)((0,r.__spreadArray)((0,r.__spreadArray)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(s),!1),(0,r.__read)(this.initialAffectedPartIds),!1),(0,r.__read)(d),!1),(0,r.__read)(n),!1),(function(e){return e}))},t.prototype.isWithinDistanceOfAnInitialIsolatedPart=function(e,t,i,r){var n=r.getBodyBounds(t,i);return!!n&&this.isBoundsWithinDistanceOfInitialAffectedInstances(n,e)},t}(c.IsolatedManagerBase);t.PartStudioIsolateManagerBase=h},413229:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioMakeTransparentManager=void 0;var r=i(423902),n=i(438849),o=i(784167),s=i(129346),a=i(311611),c=function(e){function t(t,i,r,n){var o=e.call(this,t)||this;return o.isolatedOccurrencesManager=i,o.affectParts(r,n),o}return(0,r.__extends)(t,e),t.prototype.getTransparentOccurrences=function(){return this.getAffectedOccurrences()},t.prototype.areSelectionsAlreadyTransparent=function(e){return this.areSelectionsAlreadyAffected(e)},t.prototype.areSelectionsInListAlreadyTransparent=function(e){return this.areSelectionsInListAlreadyAffected(e)},t.prototype.hasTransparentInstances=function(){return this.hasAffectedInstances()},t.prototype.clearTransparentNoAnimation=function(){this.clearEffectNoAnimation()},t.prototype.setUpListeners=function(){e.prototype.setUpListeners.call(this),this.listenTo((0,o.getCommandDispatcher)(),s.commands.MAKE_TRANSPARENT_PARTS,this.affectParts),this.listenTo((0,o.getCommandDispatcher)(),s.commands.EXIT_MAKE_TRANSPARENT,this.clearEffectExit)},t.prototype.showDialog=function(){if(this.dialog)this.dialog.onAssemblyOrPartStudioDataProcessed();else{var e={isolateManager:this};this.dialog=new n.MakeTransparentDialog(e)}},t.prototype.clearEffect=function(){this.viewer.getOccurrenceDataManager().clearIsolation(),this.isolatedOccurrencesManager.removeMakeTransparentManager(),this.updateLaminarEdges()},t.prototype.updateOccurrenceDataManager=function(){var e=this;if(0===this.affectedOccurrenceIds.length){var t=this.getModelViewManager().getDisplayedPartStudio().getPartStudioOccurrenceIds();this.getPreviewViewManager()&&(t=t.concat(this.getPreviewViewManager().getDisplayedPartStudio().getPartStudioOccurrenceIds())),t.forEach((function(t){t!==a.INVALID_OCCURRENCE_ID&&e.viewer.getOccurrenceDataManager().setOccurrenceIsolated(t,!0)}))}else this.affectedOccurrenceIds.forEach((function(t){t!==a.INVALID_OCCURRENCE_ID&&e.viewer.getOccurrenceDataManager().setOccurrenceIsolated(t,!1)}))},t.prototype.refreshMateIsolation=function(e){this.setIsolatedPartMates(!0),this.setIsolatedPartMates(!1,e)},t.prototype.triggerExit=function(){(0,o.getCommandDispatcher)().trigger(s.commands.EXIT_MAKE_TRANSPARENT,this.viewer)},t.prototype.shouldAddPreexistingParts=function(){return!0},t.prototype.shouldAddSketchesToEffect=function(){return!1},t.prototype.shouldNotDoAnimation=function(){return this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()},t.prototype.shouldClearOccurrenceIds=function(){return!0},t}(a.PartStudioIsolateManagerBase);t.PartStudioMakeTransparentManager=c},614801:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pick=t.PickPriority=void 0;var r,n=i(556329),o=i(712197),s=i(311517),a=i(227441),c=i(911748);!function(e){e[e.UNKNOWN=-10]="UNKNOWN",e[e.REDUCED_DIMENSION_PRIORITY=-1]="REDUCED_DIMENSION_PRIORITY",e[e.CONSTRUCTION_PLANE=0]="CONSTRUCTION_PLANE",e[e.CONSTRUCTION_PLANE_EDGE=1]="CONSTRUCTION_PLANE_EDGE",e[e.PART_FACE=5]="PART_FACE",e[e.NON_MODIFIABLE_FACE=7]="NON_MODIFIABLE_FACE",e[e.NON_MODIFIABLE_EDGE=8]="NON_MODIFIABLE_EDGE",e[e.NON_MODIFIABLE_VERTEX=9]="NON_MODIFIABLE_VERTEX",e[e.SKETCH_FACE=10]="SKETCH_FACE",e[e.ORIGIN=15]="ORIGIN",e[e.SECTION_PLANE=16]="SECTION_PLANE",e[e.PART_EDGE=20]="PART_EDGE",e[e.POINT_BODY=25]="POINT_BODY",e[e.PART_VERTEX=30]="PART_VERTEX",e[e.DIMENSION=45]="DIMENSION",e[e.MATE_CONNECTOR=46]="MATE_CONNECTOR",e[e.DEGENERATE_SKETCH_EDGE=47]="DEGENERATE_SKETCH_EDGE",e[e.SKETCH_EDGE=50]="SKETCH_EDGE",e[e.SKETCH_VERTEX=60]="SKETCH_VERTEX",e[e.UI=70]="UI"}(r=t.PickPriority||(t.PickPriority={}));var l=function(){function e(e,t,i,r){this.occurrenceId=t,this.location=i,this.usage=r,this.deterministicId=null,this.partId=null,this.locationCount=1,this.locationsSinceSample=0,this.distance=1,this.coverage=0,this.fromPass=0,this.entityMetaData=null,this.bodyMetaData=null,this.uiSelection=null,this.occurrence=null,this.isPickThrough=null,this.primitiveId=e.slice(0),this.locationSum=c.vec2.create(i),this.locationSamples=[this.location]}return e.prototype.incorporateLocation=function(e){c.vec2.add(this.locationSum,e,this.locationSum),++this.locationCount;var t=this.locationSamples.length<10?5:this.locationSamples.length<20?50:500;this.locationsSinceSample>=t?(this.locationSamples.push(e),this.locationsSinceSample=0):++this.locationsSinceSample},e.prototype.determineBestLocation=function(){for(var e=c.vec2.scale(this.locationSum,1/this.locationCount,c.vec2.create()),t=1/0,i=0;i<this.locationSamples.length;++i){var r=c.vec2.distanceSquared(e,this.locationSamples[i]);r<t&&(this.location=this.locationSamples[i],t=r)}},e.prototype.isUIPick=function(){return!!this.uiSelection},e.prototype.getUISelection=function(){return this.uiSelection?this.uiSelection.uiElement:null},e.prototype.isEntityPick=function(){return!!this.entityMetaData},e.prototype.isBodyPick=function(){return!!this.bodyMetaData},e.prototype.isModelPick=function(){return this.isBodyPick()||this.isEntityPick()},e.prototype.getBodyId=function(){return this.bodyMetaData?this.bodyMetaData.id:this.entityMetaData?this.entityMetaData.getBodyId():null},e.prototype.getOccurrence=function(){return this.occurrence},e.prototype.getId=function(){return this.primitiveId+n.ID_SEPARATOR+this.occurrenceId},e.prototype.getModelSelection=function(){if(this.isEntityPick())return new o.Selection(a.GBTUiSelectionType.ENTITY,this.deterministicId,this.occurrence,{entityMetaData:this.entityMetaData,source:o.Source.PICK,sourcePick:this,usage:this.usage});if(this.isBodyPick())return new o.Selection(a.GBTUiSelectionType.BODY,this.deterministicId,this.occurrence,{bodyMetaData:this.bodyMetaData,source:o.Source.PICK,sourcePick:this,usage:this.usage});var e=this.isUIPick()?this.uiSelection.getModelSelection():null;return e&&(e.sourcePick||(e.sourcePick=this),e.source=o.Source.PICK,e.usage=this.usage),e},e.prototype.getPickPriority=function(){if(this.isUIPick()){var e=this.uiSelection.getPickPriority();return null!==e?e:r.UI}if(this.entityMetaData){if(this.entityMetaData.isFromOrigin())return r.ORIGIN;if(this.entityMetaData.isPointEntity())return r.POINT_BODY;if(this.entityMetaData.isFromSketch())return this.entityMetaData.isFace()?r.SKETCH_FACE:this.entityMetaData.isEdge()?r.SKETCH_EDGE:this.entityMetaData.isDegenerateEdge()?r.DEGENERATE_SKETCH_EDGE:r.SKETCH_VERTEX;if(this.entityMetaData.isFromBody())return this.entityMetaData.getBodyMetaData()&&!this.entityMetaData.getBodyMetaData().isModifiableBody()?this.entityMetaData.isFace()?r.NON_MODIFIABLE_FACE:this.entityMetaData.isEdge()?r.NON_MODIFIABLE_EDGE:r.NON_MODIFIABLE_VERTEX:this.entityMetaData.isFace()?r.PART_FACE:this.entityMetaData.isEdge()?r.PART_EDGE:r.PART_VERTEX}return r.UNKNOWN},e.prototype.getIncrementId=function(){if(this.isModelPick()){if(this.deterministicId)return this.deterministicId;s.log.warn("Found a model pick without a valid entity id")}else{if(this.uiSelection)return this.uiSelection.meshIncrementId;if(this.primitiveId)return this.primitiveId.toString();s.log.warn("Found a pick without an owner from which to retrieve an increment id")}return""},e.prototype.getEntityMetaData=function(){if(this.entityMetaData)return this.entityMetaData;var e=this.getModelSelection();return e?e.getEntityMetaData():null},e.prototype.getDeterministicId=function(){if(this.deterministicId)return this.deterministicId;var e=this.getModelSelection();return e?e.getDeterministicId():""},e.prototype.setIsPickThrough=function(e){this.isPickThrough=e},e.prototype.canPickThrough=function(e,t,i){if(i&&i.pickHiddenOccurrences&&t.isPickFromHiddenOccurrence(this))return!0;if(null===this.isPickThrough)if(this.uiSelection)this.isPickThrough=this.uiSelection.canPickThrough();else{var r=this.getEntityMetaData();if(r){var n=r.isTranslucent();if(!!i&&i.altKey&&r.isFromBody()&&r.isFace()){var o=t.getModelViewManagers().getManagerForUsage(this.usage).getPartStudioDataFromOccurrence(this.occurrence).getBodyComponent().getFaceColor(this.deterministicId,this.occurrenceId);n=!!o&&o[3]<1}this.isPickThrough=n&&e!==a.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED||r.isFromSketch()&&(r.isFace()||r.isVertex())}else this.isPickThrough=!1}return this.isPickThrough},e.prototype.getOccurrenceId=function(){return this.occurrenceId},e}();t.Pick=l},805468:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pickSortWithTranslucency=t.basicPickSort=void 0;var r=i(712197),n=i(614801);function o(e,t){if(!e&&!t)return 0;if(e&&!t)return-1;if(!e&&t)return 1;var i=e.getPickPriority(),o=t.getPickPriority();if(i>o)return-1;if(i<o)return 1;if(i!==n.PickPriority.SKETCH_VERTEX){if(e.fromPass<t.fromPass)return-1;if(e.fromPass>t.fromPass)return 1}var s=(1+e.distance)*(1-e.coverage),a=(1+t.distance)*(1-t.coverage);if(s<a)return-1;if(s>a)return 1;if(i===n.PickPriority.SKETCH_VERTEX&&e.deterministicId&&t.deterministicId){var c=r.SelectionMapper.unpackDetId(e.deterministicId),l=r.SelectionMapper.unpackDetId(t.deterministicId);if(c.operationIdx<l.operationIdx)return-1;if(c.operationIdx>l.operationIdx)return 1;if(c.entityIdx<l.entityIdx)return-1;if(c.entityIdx>l.entityIdx)return 1}return 0}t.basicPickSort=o,t.pickSortWithTranslucency=function(e,t){return e.sort((function(e,i){if(null!==e.getUISelection()||null!==i.getUISelection())return o(e,i);if(e.getModelSelection().isPlane()||i.getModelSelection().isPlane())return o(e,i);if(e.getModelSelection().isFace()!==i.getModelSelection().isFace())return o(e,i);var r=t(e);return r===t(i)?o(e,i):r?1:-1}))}},13754:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointElement=void 0;var r=i(423902),n=i(911748),o=i(311611),s=new o.NodeProperties({primitiveType:o.PrimitiveType.POINTS,isPickable:!1,isShowThrough:!0,isDepthTested:!1}),a=function(e){function t(t,i,r,n,a,c){var l=e.call(this,a,i)||this;return l.position=t,l.increment=(0,o.createPoint)([0,0,0],"point",r,n),l.updatePosition(t),l.nodeProperties=s,c&&(l.nodeProperties=c),l.updateGraphics(),l}return(0,r.__extends)(t,e),t.prototype.updatePosition=function(e){if(e){this.position=e;var t=n.mat4.identity(n.mat4.create());t[12]=this.position[0],t[13]=this.position[1],t[14]=this.position[2],this.setTransform(t)}},t.prototype.setStyle=function(e){(0,o.addStyleToIncrement)(e,this.increment),this.updateGraphics()},t.prototype.updateGraphics=function(){this.updateMeshIncrement(t.INCREMENT_ID,"pointElementSelection",this.increment,this.nodeProperties)},t.prototype.addHighlight=function(t){e.prototype.addHighlight.call(this,t),this.addHighlightToIncrement("pointElement",t),this.highlight=t},t.prototype.removeHighlight=function(t){return!!t&&(this.removeHighlightFromIncrement("pointElement",t),!!e.prototype.removeHighlight.call(this,t))},t.INCREMENT_ID="pointElement",t}(o.UIElement);t.PointElement=a},851758:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Quad=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r,o,s,a){var c=e.call(this,s,a)||this,l=(0,n.createQuad)(t,i,r);return c.updateMeshIncrement("quad",n.NO_SELECTION_ID,l,o),c}return(0,r.__extends)(t,e),t}(n.UIElement);t.Quad=o},663612:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.spliceRangesFromArray=t.removeRange=t.insertRangeStartEnd=t.insertRange=t.binarySearchRanges=void 0;var r=i(311517);function n(e,t,i,r,n){for(var o,s=t;t!==i;)if(n>(o=e[s=Math.floor(.5*(t+i))][r]))s=t=s+1;else{if(!(n<o))break;i=s}return s}function o(e,t){if(t.length<1)t.push(e.slice(0));else{var i=n(t,0,t.length,0,e[0]),r=!1,o=0,s=e[1];i>0&&t[i-1][1]>=e[0]&&(r=!0,s=Math.max(s,t[i-1][1]));for(var a=i;a<t.length&&t[a][0]<=e[1];++a)++o,s=Math.max(s,t[a][1]);r?(t[i-1][1]=s,t.splice(i,o)):t.splice(i,o,[e[0],s])}}t.binarySearchRanges=n,t.insertRange=o;var s=[0,1];t.insertRangeStartEnd=function(e,t,i){s[0]=e,s[1]=t,o(s,i)},t.removeRange=function(e,t){if(e[0]!==e[1]){var i=n(t,0,t.length,1,e[0]),o=n(t,i,t.length,0,e[1]);if(i>=t.length||i===o)r.log.warn("Failed to find range to remove");else{var s=null,a=null;t[i][0]<e[0]&&(s=[t[i][0],e[0]]),t[o-1][1]>e[1]&&(a=[e[1],t[o-1][1]]),s&&a?t.splice(i,o-i,s,a):s?t.splice(i,o-i,s):a?t.splice(i,o-i,a):t.splice(i,o-i)}}},t.spliceRangesFromArray=function(e,t){for(var i=0,r=0;r<t.length;++r){var n=t[r],o=n[0]-i,s=n[1]-n[0];e.splice(o,s),i+=s}}},14378:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderContext=t.INVALID_FRAME_ID=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(663748),a=i(311517),c=i(227441),l=i(911748),u=i(699716),h=o.default.getManager(),d="uViewport",p="uOneOverViewportWidthHeight";t.INVALID_FRAME_ID=-1;var g=!1,f=function(e){function t(t){var i=e.call(this)||this;return i.viewer=t,i.MAXIMUM_Z_OFFSET=h.getNumber("MAXIMUM_Z_OFFSET"),i.activeShader=null,i.shaderStack=[],i.modelViewMatrixStack=[],i.projectionMatrixStack=[],i.viewport=[0,0,1,1],i.viewportStack=[],i.materialPushedShaderStack=[!1],i.activePass=null,i.lastPolygonOffsetFactor=NaN,i.lastPolygonOffsetUnits=NaN,i.overridePolygonOffset=!1,i.lastCullFace=null,i.pickBackFaces=!1,i.pickPrimitiveAlternates=!1,i.baseHighlightsEnabled=!0,i.activeCamera=null,i.isPickingHiddenOccurrences=!1,i.useHiddenOpacityForEdgeHighlights=!1,i.frameId=0,i.lastBufferBound=null,i.lastStyleApplied=new n.Style,i.hasIsolate=!1,i.nodeOccurrenceFilterFunction=null,(0,n.viewerCheck)(t),i.state=new n.State,i.modelViewMatrix=l.mat4.identity(l.mat4.create()),i.projectionMatrix=l.mat4.identity(l.mat4.create()),i.materialStack=[n.DEFAULT_MATERIAL],i.overrideFaceCullingMode=n.CullFace.UNSPECIFIED,i.renderingMode=c.GBTGraphicsRenderMode.SHADED_WITH_EDGES,i.detailSettings=new n.Settings,i.listenTo(i.viewer.getEventDispatcher(),n.GL_CONTEXT_LOST,i.onGlContextLost),i.listenTo(i.viewer.getEventDispatcher(),n.DEVICE_PIXEL_RATIO_CHANGED,i.onDevicePixelRatioChanged),i}return(0,r.__extends)(t,e),t.prototype.onNewContext=function(e){this.state.setGlContext(e),this.setFacesToCull(n.CullFace.BACK)},t.prototype.onDevicePixelRatioChanged=function(e){if(this.activeShader){var t=(0,u.getDevicePixelRatio)();this.activeShader.uniform1f("uDevicePixelRatio",t)}},t.prototype.destroy=function(){this.stopListening()},t.prototype.onGlContextLost=function(){this.activeShader=null},t.prototype.setOccurrencePickId=function(e){this.activeShader&&this.activeShader.uniform4fv("uOccurrencePickId",e)},t.prototype.getViewer=function(){return this.viewer},t.prototype.setActiveCamera=function(e){this.activeCamera=e},t.prototype.getActiveCamera=function(){return this.activeCamera},t.prototype.getState=function(){return this.state},t.prototype.pushModelViewMatrix=function(e){this.modelViewMatrixStack.push(this.modelViewMatrix),this.modelViewMatrix=e},t.prototype.getModelViewMatrix=function(){return this.modelViewMatrix},t.prototype.popModelViewMatrix=function(){0!==this.modelViewMatrixStack.length?this.modelViewMatrix=this.modelViewMatrixStack.pop():a.log.warn("Tried to pop modelview matrix from stack with zero length")},t.prototype.updateModelviewUniforms=function(){var e=this.activeShader;e&&e.uniformMatrix4fv("uMVMatrix",!1,this.modelViewMatrix)},t.prototype.pushProjectionMatrix=function(e){this.projectionMatrixStack.push(this.projectionMatrix),this.projectionMatrix=e,this.updateProjectionUniforms()},t.prototype.updateProjectionUniforms=function(){this.activeShader&&(this.activeShader.uniformMatrix4fv("uPMatrix",!1,this.projectionMatrix),this.activeShader.uniformMatrix4fv("uPMatrix_fs",!1,this.projectionMatrix))},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.popProjectionMatrix=function(){0!==this.projectionMatrixStack.length?(this.projectionMatrix=this.projectionMatrixStack.pop(),this.updateProjectionUniforms()):a.log.warn("Tried to pop projection matrix from stack with zero length")},t.prototype.updateViewportUniforms=function(){var e=this.getActiveShader();e&&e.getUniformLocation(d)&&e.uniform4fv(d,this.viewport),e&&e.getUniformLocation(p)&&e.uniform2f(p,1/this.viewport[2],1/this.viewport[3])},t.prototype.setViewport=function(e){this.viewport=e,this.viewer.getGlContext().viewport(e[0],e[1],e[2],e[3]),this.updateViewportUniforms()},t.prototype.pushViewport=function(e){this.viewportStack.push(this.viewport),this.setViewport(e)},t.prototype.getViewport=function(){return this.viewport},t.prototype.popViewport=function(){if(0!==this.viewportStack.length){var e=this.viewportStack.pop();this.setViewport(e)}else a.log.warn("Tried to pop viewport from stack with zero length")},t.prototype.activateShader=function(e,t){if((null===this.activeShader||!this.activeShader.equals(e))&&(this.activeShader&&this.activeShader.deactivate(),this.lastBufferBound=null,this.defaultStyle=null,this.lastStyleApplied.clear(),this.activeShader=e,t||(this.shaderStack=[this.activeShader]),null!==this.activeShader)){this.lastNormalMatrixComputed=null,this.activeShader.useShader(),this.updateProjectionUniforms(),this.updateModelviewUniforms(),this.updateViewportUniforms();this.activeShader.vertexAttrib4fv(n.AttributeNames.COLOR,[0,0,0,-1]),this.activeShader.vertexAttrib4fv(n.AttributeNames.HIGHLIGHT_ID,[0,0,0,0]),this.activeShader.vertexAttrib4fv(n.AttributeNames.PRIMITIVE_STYLE,[0,0,0,0]),this.activeShader.vertexAttrib1f(n.AttributeNames.OCCURRENCE_ID,0),this.activeShader.uniform2fv("uHighlightPointFont",h.getPointFont("HIGHLIGHT_POINT_FONT")),this.activeShader.uniform1f("uHighlightPointSizeMin",h.getNumber("HIGHLIGHT_POINT_SIZE_MIN_PX")),this.activeShader.uniform1f("uHighlightPointSizeScale",h.getNumber("HIGHLIGHT_POINT_SIZE_SCALE")),this.activeShader.uniform4fv("uHighlightLineStipple",h.getStipple("HIGHLIGHT_LINE_STIPPLE")),this.activeShader.uniform1f("uHighlightLineWidthMin",h.getNumber("HIGHLIGHT_LINE_WIDTH_MIN_PX")),this.activeShader.uniform1f("uHighlightLineWidthScale",h.getNumber("HIGHLIGHT_LINE_WIDTH_SCALE")),this.activeShader.uniform1f("uHighlightCount",this.viewer.getReferenceHighlights().sortedHighlights.length),this.activeShader.uniform1f("uSketchTextureOn",h.getNumber("SKETCH_TEXTURE_ON")),this.activeShader.uniform1f("uSketchTextureTileSize",h.getNumber("SKETCH_TEXTURE_TILE_SIZE")),this.activeShader.uniform1f("uSketchTextureBrightness",h.getNumber("SKETCH_TEXTURE_BRIGHTNESS")),this.activeShader.uniform1f("uSketchTextureTransparency",h.getNumber("SKETCH_TEXTURE_TRANSPARENCY")),this.activeShader.uniform1f("uSketchTextureContrast",h.getNumber("SKETCH_TEXTURE_CONTRAST"));var i=(0,u.getDevicePixelRatio)();this.activeShader.uniform1f("uDevicePixelRatio",i),this.activePass.onShaderActivated(this,this.activeShader)}},t.prototype.getActiveShader=function(){return this.activeShader},t.prototype.pushShader=function(e){this.shaderStack.push(e)},t.prototype.activateTopShader=function(){this.shaderStack.length>0&&this.activateShader(this.shaderStack[this.shaderStack.length-1],!0)},t.prototype.popShader=function(){0!==this.shaderStack.length?this.shaderStack.pop():a.log.warn("Tried to pop a shader off of an empty stack")},t.prototype.getExtendedShaderForMaterial=function(e){var t=e.getExtendedShaderId();if(!t)return null;var i=(0,n.getShaderIdWithExtension)(this.activeShader.getId(),t);return(0,n.shaderExistsForId)(i)?this.viewer.getShader(i):null},t.prototype.pushMaterial=function(e){this.materialStack.push(e);var t=this.getExtendedShaderForMaterial(e);t&&this.pushShader(t),this.materialPushedShaderStack.push(!!t)},t.prototype.setMaterial=function(){this.activeShader&&this.materialStack&&this.materialStack.length>0&&this.materialStack[this.materialStack.length-1].setAttributes(this.activeShader,this)},t.prototype.popMaterial=function(){0!==this.materialStack.length?(this.materialStack.pop(),this.materialPushedShaderStack.pop()&&this.popShader()):a.log.warn("Tried to pop a material off of an empty stack")},t.prototype.setActivePass=function(e){this.activePass=e},t.prototype.getActivePass=function(){return this.activePass},t.prototype.setIsPickingHiddenOccurrences=function(e){this.isPickingHiddenOccurrences=e},t.prototype.getIsPickingHiddenOccurrences=function(){return this.isPickingHiddenOccurrences},t.prototype.isPicking=function(){return!!this.activePass&&this.activePass.isPickPass()},t.prototype.isHighlighting=function(){return!!this.activePass&&this.activePass.isHighlightPass()},t.prototype.getActiveHighlightType=function(){return this.activePass?this.activePass.getActiveHighlightType():null},t.prototype.needsAttribute=function(e){return!!this.activePass&&this.activePass.needsAttribute(e)},t.prototype.getPickPassIteration=function(){return this.activePass&&this.activePass.isPickPass()?this.activePass.getPickIteration():-1},t.prototype.isShowthrough=function(){return!!this.activePass&&this.activePass.isShowthroughPass()},t.prototype.setBackFacePicking=function(e){this.pickBackFaces=e},t.prototype.isPickingBackFaces=function(){return this.isPicking()&&this.pickBackFaces},t.prototype.setOverrideFaceCullingMode=function(e){this.overrideFaceCullingMode=e},t.prototype.clearOverrideFaceCullingMode=function(){this.overrideFaceCullingMode=n.CullFace.UNSPECIFIED},t.prototype.nodeFilter=function(e){return!0},t.prototype.setZOffset=function(e){var t=e/this.MAXIMUM_Z_OFFSET;this.setPolygonOffset(t,e)},t.prototype.setOverridePolygonOffset=function(e,t){this.overridePolygonOffset=!1,this.setPolygonOffset(e,t),this.overridePolygonOffset=!0},t.prototype.clearOverridePolygonOffset=function(){this.overridePolygonOffset=!1},t.prototype.setPolygonOffset=function(e,t){if(!(this.overridePolygonOffset||e===this.lastPolygonOffsetFactor&&t===this.lastPolygonOffsetUnits)){var i=this.viewer.getGlContext();0===e&&0===t?i.disable(i.POLYGON_OFFSET_FILL):(i.polygonOffset(e,t),i.enable(i.POLYGON_OFFSET_FILL)),this.lastPolygonOffsetFactor=e,this.lastPolygonOffsetUnits=t}},t.prototype.setFacesToCull=function(e){if(this.lastCullFace!==e){var t=e;this.overrideFaceCullingMode!==n.CullFace.UNSPECIFIED&&(t=this.overrideFaceCullingMode);var i=this.viewer.getGlContext();n.CullFace.BACK===t?(i.enable(i.CULL_FACE),i.cullFace(i.BACK)):n.CullFace.FRONT===t?(i.enable(i.CULL_FACE),i.cullFace(i.FRONT)):n.CullFace.NONE===t?i.disable(i.CULL_FACE):a.log.error("Unknown face culling parameter: "+t)}},t.prototype.setPointSize=function(e){this.setPrimitiveSize(e)},t.prototype.setPointFont=function(e){this.setPrimitiveStyle([e[0],e[1],0,0])},t.prototype.setLineWidth=function(e){this.setPrimitiveSize(e)},t.prototype.setLineStipple=function(e){this.setPrimitiveStyle(e)},t.prototype.setPrimitiveSize=function(e){var t=this.getActiveShader();t&&t.vertexAttrib1f(n.AttributeNames.PRIMITIVE_SIZE,e)},t.prototype.setPrimitiveStyle=function(e){var t=this.getActiveShader();t&&t.vertexAttrib4fv(n.AttributeNames.PRIMITIVE_STYLE,e)},t.prototype.setPickPrimitiveAlternates=function(e){this.pickPrimitiveAlternates=e},t.prototype.getPickPrimitiveAlternates=function(){return this.pickPrimitiveAlternates},t.prototype.setBaseHighlightsEnabled=function(e){this.baseHighlightsEnabled=e},t.prototype.getBaseHighlightsEnabled=function(){return this.baseHighlightsEnabled},t.prototype.setUseHiddenOpacityForEdgeHighlights=function(e){this.useHiddenOpacityForEdgeHighlights=e},t.prototype.getUseHiddenOpacityForEdgeHighlights=function(){return this.useHiddenOpacityForEdgeHighlights},t.prototype.prepareForNextFrame=function(){this.frameId<n.LARGEST_REPRESENTABLE_INTEGER?this.frameId+=1:this.frameId=0,this.hasIsolate=this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances(),!g&&this.materialStack.length>5&&(a.log.warn("Material stack has grown unexpectedly long"),g=!0)},t.prototype.getFrameId=function(){return this.frameId},t.prototype.getHasIsolate=function(){return this.hasIsolate},t.prototype.setRenderingMode=function(e){this.renderingMode=e},t.prototype.setDetailSettings=function(e){this.detailSettings=e},t.prototype.getDetailSettings=function(){return this.detailSettings},t.prototype.setUsage=function(e){this.usage=e},t.prototype.getUsage=function(){return this.usage},t.prototype.getLastBufferBound=function(){return this.lastBufferBound},t.prototype.setLastBufferBound=function(e){this.lastBufferBound=e},t.prototype.applyStyle=function(e){e&&!(0,n.stylesEqual)(e,this.lastStyleApplied)&&e.applyStyle(this),e?this.lastStyleApplied.copyFrom(e):this.lastStyleApplied.clear()},t.prototype.activePassNeedsIsolationTest=function(){return!!this.activePass&&this.activePass.testIsolation(this)},t.prototype.activePassIsForIsolate=function(){return!!this.activePass&&this.activePass.forIsolate()},t.prototype.activePassIsForSectionPlaneEndcapMask=function(){return!!this.activePass&&this.activePass.forSectionPlaneEndcapMask()},t.prototype.setNodeOccurrenceFilterFunction=function(e){this.nodeOccurrenceFilterFunction=e},t.prototype.doesNodeOcccurrencePassFilter=function(e){return!this.nodeOccurrenceFilterFunction||this.nodeOccurrenceFilterFunction(e)},t.prototype.activePassNeedsFaceAppearances=function(){return!this.activePass||this.activePass.needsFaceAppearances()},t}(s.BackboneEventsBaseClass);t.RenderContext=f},819740:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeManipulator=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(227441),a=i(911748),c=i(699716),l=o.default.getManager(),u=1e-6,h=500,d="move",p=new n.NodeProperties({primitiveType:n.PrimitiveType.TRIANGLES,material:n.UNLIT_COLOR_FROM_ATTRIBUTE,zOffset:2,isTwoSided:!0,includedInBlend:!1,primitivesHaveTransparency:!0,isShowThrough:!0,isDepthTested:!1,addsToBounds:!1}),g=new n.NodeProperties({primitiveType:n.PrimitiveType.TRIANGLE_STRIP,material:n.UNLIT_COLOR_FROM_ATTRIBUTE,zOffset:2,isTwoSided:!0,includedInBlend:!1,primitivesHaveTransparency:!0,isShowThrough:!0,isDepthTested:!1,addsToBounds:!1}),f=function(e){function t(t,i,r,o,s,c,l){var u=e.call(this,l,o.usage===n.bt_graphics_Usage.BASE?n.MAIN_SCENEGRAPH_ID:n.PREVIEW_SCENEGRAPH_ID)||this;return u.highlighted=!1,u.dragOffset=[0,0],u.resizeUniformly=!1,u.cursorString="",u.staticIncrements=null,u.center=i,u.normal=r,u.direction0=s,u.direction1=c,u.offset=a.vec2.create(),u.parent=o,u.selectionId=t,u.listenTo(u,n.UiEvents.MOUSE_ENTER+u.selectionId,u.onMouseEnter),u.listenTo(u,n.UiEvents.MOUSE_LEAVE+u.selectionId,u.onMouseLeave),u.listenTo(u,n.UiEvents.DRAG_START+u.selectionId,u.onDragStart),u.listenTo(u,n.UiEvents.DRAG+u.selectionId,u.onDrag),u.listenTo(u,n.UiEvents.DRAG_STOP+u.selectionId,u.onDragStop),u}return(0,r.__extends)(t,e),t.prototype.onViewWillDraw=function(e,t){this.updateTransform(e),this.hasMeshIncrements()||this.updateGraphics()},t.prototype.updateTransform=function(e){var t=a.mat4.identity(a.mat4.create()),i=[this.center[0],this.center[1],this.center[2]],r=(a.vec3.length(this.parent.getXAxis())+a.vec3.length(this.parent.getYAxis()))/2,n=Math.min(e.getPixelSizeAtWorldPoint(this.transformPoint(i)),r/16),o=(0,c.getDevicePixelRatio)();t[0]=n*o,t[5]=n*o,t[10]=n*o,t[12]=this.center[0],t[13]=this.center[1],t[14]=this.center[2],this.setTransform(t)},t.prototype.getClearModelSelectionsOnPrehilite=function(){return!1},t.prototype.getStaticIncrements=function(){if(this.staticIncrements)return this.staticIncrements;this.staticIncrements={};var e=[0,0,0],t=a.vec3.normalize(this.direction0,a.vec3.create()),i=l.getNumber("RESIZE_MANIPULATOR_RADIUS"),r=this.selectionId+"FrontFace",o=(0,n.createDisc)(e,i,this.normal,36);this.staticIncrements[r]={selection:this.selectionId,data:o,type:p,color:l.getColor("RESIZE_MANIPULATOR_INNER_COLOR")};var s=this.selectionId+"Border",c=(0,n.createRing)(e,i,1.3*i,this.normal,t,0,2*Math.PI,36);return this.staticIncrements[s]={selection:this.selectionId,data:c,type:g,color:l.getColor("RESIZE_MANIPULATOR_OUTER_COLOR")},this.staticIncrements},t.prototype.updateGraphics=function(){this.updateIncrementsOnEntity(this.selectionId,"FrontFace"),this.updateIncrementsOnEntity(this.selectionId,"Border")},t.prototype.updateIncrementsOnEntity=function(e,t){var i=this.getStaticIncrements();i[e+t].type===p?(0,n.addColorToIncrement)(i[e+t].color,i[e+t].data):i[e+t].type===g&&(0,n.addColorToIncrement)(this.highlighted?l.getColor("RESIZE_MANIPULATOR_OUTER_COLOR_HIGHLIGHT"):i[e+t].color,i[e+t].data),this.updateMeshIncrement(e+t,i[e+t].selection,i[e+t].data.clone(),i[e+t].type)},t.prototype.cleanup=function(){this.cursorString===d&&(this.cursorString="",this.viewer.popCursor())},t.prototype.updateDefinition=function(e,t,i,r){this.staticIncrements=null,this.center=e,this.normal=a.vec3.normalize(t,a.vec3.create()),this.direction0=a.vec3.normalize(i,a.vec3.create()),this.direction1=a.vec3.normalize(r,a.vec3.create()),this.updateGraphics()},t.prototype.onMouseEnter=function(e,t){this.highlighted=!0,0===this.cursorString.length&&(this.cursorString=d,this.viewer.pushCursor(this.cursorString)),this.updateGraphics(),(0,n.requestDraw)()},t.prototype.onMouseLeave=function(e,t){this.highlighted&&(this.highlighted=!1,this.updateGraphics()),this.cursorString===d&&(this.cursorString="",this.viewer.popCursor()),(0,n.requestDraw)()},t.prototype.getOffsetFromEvent=function(e){var t=e.camera.getRay(e.mouseX,e.mouseY),i=a.vec3.create(),r=this.normal,o=[r[0],r[1],r[2],-a.vec3.dot(r,this.center)],s=(0,n.intersectRayPlane)(t,o);return null===s?null:[a.vec3.dot(a.vec3.subtract(s,this.center,i),this.direction0),a.vec3.dot(a.vec3.subtract(s,this.center,i),this.direction1)]},t.prototype.onDragStart=function(e,t,i){var r=this.getOffsetFromEvent(t);r&&(this.dragOffset=a.vec2.subtract(r,this.offset,a.vec2.create()),i.requestDrag=!0,this.resizeUniformly=this.viewer.getLastMouseMovedEvent().shiftKey)},t.prototype.onDrag=function(e,t){var i=this.getOffsetFromEvent(t);if(i){this.offset=a.vec2.subtract(i,this.dragOffset,a.vec2.create());for(var r=0;r<this.offset.length;r++)this.offset[r]=parseFloat(this.offset[r].toFixed(8));var o,s,c=0,l=0;this.resizeUniformly?(o=2*a.vec3.length(this.parent.getXAxis())+2*this.offset[0],s=2*a.vec3.length(this.parent.getYAxis())+2*this.offset[1],o>u&&o<h&&(this.parent.width=o),s>u&&s<h&&(this.parent.height=s)):(o=2*a.vec3.length(this.parent.getXAxis())+1*this.offset[0],s=2*a.vec3.length(this.parent.getYAxis())+1*this.offset[1],o>u&&o<h&&(this.parent.width=o,c=this.offset[0]/2*a.vec3.dot(this.direction0,a.vec3.normalize(this.parent.getXAxis(),a.vec3.create()))),s>u&&s<h&&(this.parent.height=s,l=this.offset[1]/2*a.vec3.dot(this.direction1,a.vec3.normalize(this.parent.getYAxis(),a.vec3.create()))),this.parent.centerOffset=a.vec3.subtract(a.vec3.add(this.parent.centerOffset,(0,n.planeToWorld)([c,l],this.parent.getCenter(),this.normal,a.vec3.normalize(this.parent.getXAxis(),a.vec3.create())),a.vec3.create()),this.parent.getCenter(),a.vec3.create())),this.parent.updateDefinition(this.parent.getName(),this.parent.getCenter(),this.parent.getXAxis(),this.parent.getYAxis(),!0),(0,n.requestDraw)()}},t.prototype.onDragStop=function(e,t){var i=new s.BTFeaturePlaneAppearance;i.width=this.parent.width,i.height=this.parent.height;var r=(0,n.worldToPlane)(a.vec3.add(this.parent.centerOffset,this.parent.getCenter(),a.vec3.create()),this.parent.getCenter(),this.normal,a.vec3.normalize(this.parent.getXAxis(),a.vec3.create()));i.xOffset=r[0],i.yOffset=r[1],this.viewer.getEventDispatcher().trigger(n.CHANGE_FEATURE_APPEARANCE,i,this.parent.planeId),this.offset=[0,0]},t}(n.UIElement);t.ResizeManipulator=f},898271:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSceneGraphIdForUsage=t.SceneGraphs=t.SceneGraph=void 0;var r=i(328408),n=i(311611),o=function(){function e(e){this.id=e;var t=e===r.PREVIEW_SCENEGRAPH_ID?n.bt_graphics_Usage.PREVIEW:n.bt_graphics_Usage.BASE;this.rootNode=new n.Node(e+" root",{},t)}return e.prototype.getRootNode=function(){return this.rootNode},e.prototype.isForPreview=function(){return this.rootNode.getUsage()===n.bt_graphics_Usage.PREVIEW},e.prototype.getBounds=function(){return this.rootNode.getBoundingBox()},e.prototype.updateBounds=function(){this.rootNode.updateBounds()},e.prototype.removeEverything=function(){this.rootNode&&this.rootNode.removeAllChildren()},e.prototype.draw=function(e){this.rootNode.draw(e)},e.prototype.passesNodeFilter=function(e){return this.rootNode.passesNodeFilter(e)},e.prototype.getAllNodesWithId=function(e){var t=[],i=function(r){r.getId()===e&&t.push(r);for(var n=0;n<r.getChildCount();++n)i(r.getChildByIndex(n))};return i(this.rootNode),t},e.prototype.getNodeAtEndOfPath=function(e){var t=e.slice(0),i=this.rootNode;for(t.shift();t.length>0;){var r=t.shift();if(null===(i=i.getChildById(r)))return null}return i},e.prototype.ownsNode=function(e){for(;e;){if(e===this.rootNode)return!0;e=e.getParent()}return!1},e.prototype.makeSceneDebugObject=function(){return{text:this.id,children:[this.rootNode.makeSceneDebugObject(0)]}},e}();t.SceneGraph=o;var s=function(){function e(){this.theSceneGraphs={}}return e.prototype.destroySceneGraphs=function(){Object.values(this.theSceneGraphs).forEach((function(e){e.getRootNode().onPermanentlyRemoved()})),this.theSceneGraphs={}},e.prototype.getSceneGraph=function(e){var t=this.theSceneGraphs[e];return t||(this.theSceneGraphs[e]=t=new o(e)),t},e.prototype.getMainSceneGraph=function(){return this.getSceneGraph(r.MAIN_SCENEGRAPH_ID)},e.prototype.getPreviewSceneGraph=function(){return this.getSceneGraph(r.PREVIEW_SCENEGRAPH_ID)},e.prototype.getHudSceneGraph=function(){return this.getSceneGraph(r.HUD_SCENEGRAPH_ID)},e.prototype.getHudModelSceneGraph=function(){return this.getSceneGraph(r.HUD_MODEL_SCENEGRAPH_ID)},e}();t.SceneGraphs=s,t.getSceneGraphIdForUsage=function(e){return e===n.bt_graphics_Usage.BASE?r.MAIN_SCENEGRAPH_ID:r.PREVIEW_SCENEGRAPH_ID}},670898:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BooleanIterator=void 0;var i=function(){function e(){this.resultRange1=[0,0,null],this.resultRange2=[0,0,null],this.nextResult=null}return e.prototype.hasMoreRanges=function(){return!!this.nextResult},e.prototype.getNextRange=function(){var e=this.nextResult;return this.nextResult=this.findNextRange(),e},e.prototype.getStorageForNextResult=function(){var e=this.nextResult===this.resultRange1?this.resultRange2:this.resultRange1;return e[2]=null,e},e}();t.BooleanIterator=i},278295:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},107953:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.releaseScratchSpace=t.getScratchSpace=t.scratchSpaces=t.setTestingBuffers=t.getTestingBuffers=void 0;var r=i(311517),n=i(311611),o=!1;function s(){return o}function a(e,i){for(var r=1/0,o=-1,s=1/0,a=-1,c=0;c<t.scratchSpaces.length;++c)t.scratchSpaces[c].byteLength>=e&&t.scratchSpaces[c].byteLength<s?(s=t.scratchSpaces[c].byteLength,a=c):t.scratchSpaces[c].byteLength<r&&(r=t.scratchSpaces[c].byteLength,o=c);if(a>=0){var l=t.scratchSpaces[a];return i&&(0,n.zeroOutArrayBuffer)(l,e),t.scratchSpaces.splice(a,1),l}return o>=0&&t.scratchSpaces.splice(o,1),new ArrayBuffer(e)}function c(e){e&&t.scratchSpaces.push(e)}t.getTestingBuffers=s,t.setTestingBuffers=function(e){o=e},t.scratchSpaces=[],t.getScratchSpace=a,t.releaseScratchSpace=c;var l=function(){function e(e,t,i,n){this.viewer=e,this.target=i,this.componentCount=n,this.GAUGE_MEMORY_TYPE="Vertex buffer",this.scratchSpace=null,this.floatView=null,this.indexView=null,this.uint8View=null,this.initialCopyPerfomed=!1,this.rangesToCopy=[],this.gl=this.viewer.getGlContext(),this.size=t,this.webGlBuffer=this.gl.createBuffer(),this.webGlBuffer||r.log.error("Failed to create gl buffer")}return e.prototype.ensureScratchSpace=function(){if(!this.scratchSpace){var e=!this.initialCopyPerfomed;this.scratchSpace=a(this.size,e)}},e.prototype.releaseScratchSpace=function(){this.scratchSpace&&!s()&&(c(this.scratchSpace),this.scratchSpace=null,this.floatView=null,this.indexView=null,this.uint8View=null)},e.prototype.destroy=function(){this.gl&&this.webGlBuffer&&this.gl.deleteBuffer(this.webGlBuffer),this.webGlBuffer&&this.viewer.getMemoryGauge().decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.size),this.webGlBuffer=null},e.prototype.getComponentCount=function(){return this.componentCount},e.prototype.copyToGl=function(){return this.scratchSpace?(e=this.initialCopyPerfomed?this.copyPartialUpdatesToGl():this.copyWholeBufferToGl(),this.releaseScratchSpace(),e):(this.rangesToCopy.length>0&&r.log.warn("Encountered buffer with ranges that need copying, but no scratch space to copy from"),!1);var e},e.prototype.copyWholeBufferToGl=function(){if(!this.webGlBuffer)return!1;this.gl.bindBuffer(this.target,this.webGlBuffer);var e=new DataView(this.scratchSpace,0,this.size);return this.gl.bufferData(this.target,e,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.target,null),this.viewer.getMemoryGauge().incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.size),this.initialCopyPerfomed=!0,this.rangesToCopy=[],!0},e.prototype.addRangeToCopyToGl=function(e,t){this.initialCopyPerfomed&&(0,n.insertRangeStartEnd)(e,t,this.rangesToCopy)},e.prototype.copyPartialUpdatesToGl=function(){if(this.rangesToCopy.length<1)return!1;this.gl.bindBuffer(this.target,this.webGlBuffer);for(var e=0;e<this.rangesToCopy.length;++e){var t=this.rangesToCopy[e],i=new Uint8Array(this.scratchSpace,t[0],t[1]-t[0]);this.gl.bufferSubData(this.target,t[0],i)}return this.gl.bindBuffer(this.target,null),this.rangesToCopy=[],!0},e.prototype.getSize=function(){return this.size},e.prototype.getFloatView=function(){return this.ensureScratchSpace(),this.floatView||(this.floatView=new Float32Array(this.scratchSpace,0,this.size/4)),this.floatView},e.prototype.getIndexView=function(e){if(this.ensureScratchSpace(),!this.indexView){var t=e===Uint32Array?4:2;this.indexView=new e(this.scratchSpace,0,this.size/t)}return this.indexView},e.prototype.getUint8View=function(){return this.ensureScratchSpace(),this.uint8View||(this.uint8View=new Uint8Array(this.scratchSpace,0,this.size)),this.uint8View},e.prototype.getGlBuffer=function(){return this.webGlBuffer},e.prototype.bind=function(){this.webGlBuffer?this.gl.bindBuffer(this.target,this.webGlBuffer):r.log.warn("Attempting to bind a null gl buffer")},e.prototype.makeSceneDebugObject=function(e){for(var t=new e(this.scratchSpace),i=[],r=0;r<t.length;++r)i.push(t[r].toString());return"["+i.join(", ")+"]"},e}();t.Buffer=l},843373:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=t.debugIdCount=t.incrementListenerIdCounter=t.IncrementDetails=void 0;var r=i(601759),n=i(311611),o=i(59142),s=i(513774),a=i(311517),c=o.Attributes,l=[c.POINT,c.NORMAL,c.OFFSET_VECTOR,c.COLOR,c.TEXTURE,c.POINT_DATA,c.EDGE_DATA,c.PRIMITIVE_SIZE,c.PRIMITIVE_STYLE],u=0,h=1,d=[1/0,1/0,1/0],p=8388608,g=new n.AttributeBinding(n.GlDataType.UNSIGNED_BYTE,4,0,0,!0),f=null,m=!1,y=function(e,t,i,r){this.increment=e,this.bufferSet=r,this.vertexRange=t,this.indexRange=i,this.pickId=e.pickId};t.IncrementDetails=y;var v=0;t.incrementListenerIdCounter=function(){return v++},t.debugIdCount=0;var E=function(){function e(e){this.parent=e,this.vertexBuffer=null,this.indexBuffer=null,this.lineStripIndexBuffer=null,this.pickIdBuffers=[],this.indexRangesToDelete=[],this.attributeBindings=null,this.pendingFreeSpace=[[],[]],this.freeSpace=[[],[]],this.incrementDeletionListeners=null,this.initialVertexCount=1,this.initialIndexCount=this.getDefaultIndexCount(),this.incrementsToBuffer=new s.TemplatedCountedMap,this.increments=new s.TemplatedCountedMap,this.debugId=t.debugIdCount++}return e.prototype.clone=function(t){var i=new e(t);if(i.increments.insertCountedMap(this.increments),this.attributeBindings)for(var r in i.attributeBindings={},this.attributeBindings)this.attributeBindings[r]&&(i.attributeBindings[r]=this.attributeBindings[r].clone());i.initialVertexCount=this.initialVertexCount,i.initialIndexCount=this.initialIndexCount;for(var n=0;n<this.freeSpace[u].length;++n)i.freeSpace[u].push(this.freeSpace[u][n].slice(0));for(n=0;n<this.freeSpace[h].length;++n)i.freeSpace[h].push(this.freeSpace[h][n].slice(0));return i.markAllIncrementsForBuffering(),i.updateBuffers({forClone:!0}),i},e.prototype.markAllIncrementsForBuffering=function(){this.incrementsToBuffer.insertCountedMap(this.increments)},e.prototype.destroy=function(){if(this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null),this.indexBuffer&&(this.indexBuffer.destroy(),this.indexBuffer=null),this.lineStripIndexBuffer&&(this.lineStripIndexBuffer.destroy(),this.lineStripIndexBuffer=null),this.pickIdBuffers){for(var e=0;e<this.pickIdBuffers.length;++e)this.pickIdBuffers[e].destroy();this.pickIdBuffers=[]}},e.prototype.getDebugId=function(){return this.debugId.toString()},e.prototype.addIncrementDeletionListener=function(e){this.incrementDeletionListeners||(this.incrementDeletionListeners={}),this.incrementDeletionListeners[e.getListenerId()]=e},e.prototype.removeIncrementDeletionListener=function(e){this.incrementDeletionListeners&&delete this.incrementDeletionListeners[e.getListenerId()]},e.prototype.triggerDeletedListeners=function(e){if(e&&this.incrementDeletionListeners)for(var t in this.incrementDeletionListeners)this.incrementDeletionListeners[t].onIncrementDeleted(e)},e.prototype.getDefaultIndexCount=function(){return this.isTriangleStrip()?1:0},e.prototype.getComponentCount=function(){return this.vertexBuffer?this.vertexBuffer.getComponentCount():0},e.prototype.getUsedVertexCount=function(){var e=0;return this.increments.each((function(t){return e+=t.increment.points.length/3,!1}),this),e},e.prototype.addFreeSpace=function(e,t,i,r){var o=r?this.pendingFreeSpace[e]:this.freeSpace[e];(0,n.insertRangeStartEnd)(t,i,o)},e.prototype.incorporatePendingFreeSpace=function(){for(var e=0;e<this.pendingFreeSpace.length;++e){for(var t=this.pendingFreeSpace[e],i=this.freeSpace[e],r=0;r<t.length;++r)(0,n.insertRange)(t[r],i);t.splice(0,t.length)}},e.prototype.findFreeSpace=function(e,t){for(var i=0;i<this.freeSpace[e].length;++i){var r=this.freeSpace[e][i];if(r[1]-r[0]>=t)return r[0]}return-1},e.prototype.markFreeSpaceUsed=function(e,t,i){(0,n.removeRange)([t,t+i],this.freeSpace[e])},e.prototype.getLastUsedIndex=function(){var e=this.freeSpace[h][this.freeSpace[h].length-1],t=this.indexBuffer.getComponentCount();return e&&e[1]===t?e[0]:t},e.prototype.reinitialize=function(){this.vertexBuffer=null,this.indexBuffer=null,this.lineStripIndexBuffer=null,this.pickIdBuffers=[],this.markAllIncrementsForBuffering(),this.updateBuffers({forReinitialize:!0})},e.prototype.getIncrement=function(e){var t=this.increments.get(e);return t?t.increment:null},e.prototype.incorporateIncrement=function(e){if(!e||!e.getFullId())return null;var t,i,r=e.getPreparedVertexCount(),o=e.getPreparedIndexCount(),s=this.findFreeSpace(u,r),a=this.findFreeSpace(h,o);if(s>=0&&a>=0)t=[s,s+r],i=[a,a+o],this.markFreeSpaceUsed(u,s,r),this.markFreeSpaceUsed(h,a,o);else if(!this.areBuffersInitialized()){var c=this.initialVertexCount+r<=(0,n.getMaximumVerticesPerVbo)(),l=(this.initialVertexCount+r)*this.parent.vertexSize,d=l<=p,g=this.initialIndexCount===this.getDefaultIndexCount()&&l<=268435456;c&&(d||g)&&(t=[this.initialVertexCount,this.initialVertexCount+r],i=[this.initialIndexCount,this.initialIndexCount+o],this.initialVertexCount+=r,this.initialIndexCount+=o)}if(t&&i){var f=new y(e,t,i,this);return this.incrementsToBuffer.insert(e.getFullId(),f),this.increments.insert(e.getFullId(),f),f}return null},e.prototype.getIncrementDetails=function(e){return this.increments.get(e)||null},e.prototype.deleteIncrement=function(e){var t=this.increments.get(e);return t&&(this.addFreeSpace(u,t.vertexRange[0],t.vertexRange[1],!1),this.addFreeSpace(h,t.indexRange[0],t.indexRange[1],!0),(0,n.insertRange)(t.indexRange,this.indexRangesToDelete),this.increments.remove(e)),this.incrementsToBuffer.remove(e),this.triggerDeletedListeners(t),t||null},e.prototype.areBuffersInitialized=function(){return(0,r.objectsDefinedInSameWay)(this.vertexBuffer,this.indexBuffer)||this.logInconsistency("BEL-56218, BEL-55900, BEL-56214 The vertex buffer and index buffer were initialized independently"),!!this.vertexBuffer&&!!this.indexBuffer},e.prototype.hasBufferUpdates=function(){return!this.incrementsToBuffer.isEmpty()||this.indexRangesToDelete.length>0},e.prototype.updateBuffers=function(e){this.areBuffersInitialized()||this.initializeBuffers(e),this.processDeletedRanges(),this.processNewIncrements();var t=this.copyBuffersToGl();return this.incorporatePendingFreeSpace(),t},e.prototype.validateBufferIndices=function(e){if((0,n.getTestingBuffers)()){var t=this.vertexBuffer.getUint8View(),i=this.indexBuffer.getIndexView((0,n.getIndexBufferType)());for(var r in this.attributeBindings){var o=this.attributeBindings[r],s=o.size*(0,n.sizeOfGlType)(o.type);e||(e=[0,i.length]);for(var c=e[0];c<e[1];++c){var l=i[c];if(o.offset+l*(o.stride+s)+s>t.length){a.log.warn("Found inconsistency in buffer set "+this.debugId+" for attribute "+r);break}}}}else a.log.warn("Can only validate index buffers when getTestingBuffers is true")},e.prototype.copyBuffersToGl=function(){var e=this.vertexBuffer.copyToGl();e=this.indexBuffer.copyToGl()||e,this.lineStripIndexBuffer&&(e=this.lineStripIndexBuffer.copyToGl()||e);for(var t=0;t<this.pickIdBuffers.length;++t)e=this.pickIdBuffers[t].copyToGl()||e;return e},e.prototype.initializeBuffers=function(e){if(!this.areBuffersInitialized()){var t,i=this.parent.viewer,r=i.getGlContext(),o=this.initialVertexCount,s=this.initialIndexCount,a=e&&e.forClone,l=e&&e.forReinitialize;if(this.parent.bufferAllocationPolicy===n.BufferAllocationPolicy.MAXIMUM&&this.parent.vertexSize>0){var g=Math.floor(p/this.parent.vertexSize);o=Math.max(o,g);var m=Math.ceil(1.5*o);s=Math.max(s,m)}else this.parent.bufferAllocationPolicy===n.BufferAllocationPolicy.MEDIUM&&(o=Math.max(o,512),s=Math.max(s,2048));this.vertexBuffer=new n.Buffer(i,o*this.parent.vertexSize,r.ARRAY_BUFFER,o),this.initialVertexCount<o&&!a&&!l&&this.addFreeSpace(u,this.initialVertexCount,o,!1);var y=this.vertexBuffer.getFloatView();for(t=0;t<c.POINT.dimension;++t)y[t]=d[t];this.indexBuffer=new n.Buffer(i,s*(0,n.getIndexElementSize)(),r.ELEMENT_ARRAY_BUFFER,s),this.initialIndexCount<s&&!a&&!l&&this.addFreeSpace(h,this.initialIndexCount,s,!1);var v=this.indexBuffer.getIndexView((0,n.getIndexBufferType)());for(t=0;t<this.getDefaultIndexCount();++t)v[t]=0;this.isTriangleStrip()&&(this.lineStripIndexBuffer=new n.Buffer(i,s*(0,n.getIndexElementSize)(),r.ELEMENT_ARRAY_BUFFER,s),function(e,t){var i=e.getGlContext();f||(f=new n.AttributeBinding(i.FLOAT,1,0,0)),(!e.getResources().primitiveRestartBuffer||e.getResources().primitiveRestartBuffer.getComponentCount()<t)&&(e.getResources().primitiveRestartBuffer=new n.Buffer(e,4*t,i.ARRAY_BUFFER,t),e.getResources().primitiveRestartBuffer.getFloatView()[0]=16384,e.getResources().primitiveRestartBuffer.copyToGl())}(i,s)),this.pickIdBuffers=[]}},e.prototype.processDeletedRanges=function(){for(var e=0;e<this.indexRangesToDelete.length;++e){for(var t=this.indexRangesToDelete[e],i=t[1]-t[0],r=t[0],o=this.indexBuffer.getIndexView((0,n.getIndexBufferType)()),s=t[0];s<t[1];++s)o[s]=0;this.isTriangleStrip()&&this.updateLineStripIndices(t),this.indexBuffer.addRangeToCopyToGl(r*(0,n.getIndexElementSize)(),(r+i)*(0,n.getIndexElementSize)())}this.indexRangesToDelete=[]},e.prototype.updateLineStripIndices=function(e){if(this.isTriangleStrip())if(this.lineStripIndexBuffer){var t=this.indexBuffer.getIndexView((0,n.getIndexBufferType)()),i=this.lineStripIndexBuffer.getIndexView((0,n.getIndexBufferType)()),r=!1,o=0;i[e[0]]=0;for(var s=e[0]+1;s<e[1]-1;++s)r?(t[s]!==t[s-1]?++o:o=0,2===o&&(r=!1,i[s-2]=t[s-2],i[s-1]=t[s-1])):t[s]===t[s-1]&&(r=!0,o=0),i[s]=r?0:t[s];i[e[1]-1]=0,this.lineStripIndexBuffer.addRangeToCopyToGl(e[0]*(0,n.getIndexElementSize)(),e[1]*(0,n.getIndexElementSize)())}else a.log.warn("Did not find line strip index buffer for triangle strip")},e.prototype.processNewIncrements=function(){this.incrementsToBuffer.each((function(e,t){return e.increment.isPreparedForBuffering()||e.increment.prepareForBuffering(),this.copyIncrementVertices(e.increment,e.vertexRange),this.copyIncrementPickIds(e,e.vertexRange),this.copyIncrementIndices(e.increment,e.indexRange,e.vertexRange),!1}),this),this.incrementsToBuffer.clear()},e.prototype.replicateAttributeValue=function(e,t,i,r){if(e.dimension===r.length)for(var o=t/e.typeSize(),s=o+i[0]*e.dimension,c=o+i[1]*e.dimension,l=e.type===n.GlDataType.FLOAT?this.vertexBuffer.getFloatView():this.vertexBuffer.getUint8View(),u=s;u<c;u+=e.dimension)l.set(r,u);else a.log.warn("An attempt was made to update a vertex attribute with a value with the wrong dimension")},e.prototype.copyIncrementVertices=function(e,t){var i=this.vertexBuffer.getComponentCount(),r=this.vertexBuffer.getFloatView(),o=this.vertexBuffer.getUint8View(),s=e.vertexCount(),a=t[0],c=0,u=0,h=0,d=!1;this.attributeBindings||(this.attributeBindings={},d=!0);for(var p=0;p<l.length;++p){var g=l[p],f=!1;e[g.incrementProperty]&&(g.type===n.GlDataType.FLOAT?r.set(e[g.incrementProperty],c+g.dimension*a):o.set(e[g.incrementProperty],u+g.dimension*a),f=!0),d&&f&&(this.attributeBindings[g.name]=new n.AttributeBinding(+g.type,g.dimension,h,0,g.normalize),h+=g.sizeInBytes()*i),f&&(this.vertexBuffer.addRangeToCopyToGl(u+a*g.sizeInBytes(),u+(a+s)*g.sizeInBytes()),u+=g.sizeInBytes()*i,c+=g.sizeInBytes()/4*i)}},e.prototype.updateIncrementAttribute=function(e,t,i){this.areBuffersInitialized()||this.updateBuffers();var r=this.increments.get(t);if(r){var n=this.attributeBindings[e.name];n?(this.replicateAttributeValue(e,n.offset,r.vertexRange,i),this.vertexBuffer.addRangeToCopyToGl(n.offset+r.vertexRange[0]*e.sizeInBytes(),n.offset+r.vertexRange[1]*e.sizeInBytes())):a.log.warn("An attempt was made to update an attribute that did not have a binding")}else a.log.warn("Increment was not found in updateIncrementAttribute")},e.prototype.copyIncrementPickIds=function(e,t){var i=e.pickId;if((0,n.idIsValid)(i)){this.parent.viewer.notifyOfPickPassCount(i.length);for(var r=0;r<i.length;++r){var o=this.pickIdBuffers[r];o||(this.pickIdBuffers[r]=o=new n.Buffer(this.parent.viewer,4*this.vertexBuffer.getComponentCount(),this.parent.viewer.getGlContext().ARRAY_BUFFER,this.vertexBuffer.getComponentCount()));for(var s=o.getUint8View(),a=(0,n.convertIntToUcharArray)(i[r]),c=t[0];c<t[1];++c)s.set(a,4*c);o.addRangeToCopyToGl(4*t[0],4*t[1])}}},e.prototype.copyIncrementIndices=function(e,t,i){if(this.indexBuffer){var r=this.indexBuffer.getIndexView((0,n.getIndexBufferType)()),o=0;this.isTriangleStrip()&&(r[t[0]]=i[0]+e.indices[o],o=1);var s=0;for(s=0;s<e.indices.length;++s)r[t[0]+s+o]=i[0]+e.indices[s];if(this.isTriangleStrip()){for(var a=i[0]+e.indices[e.indices.length-1];s<e.indexLengthWithDegenerates();++s)r[t[0]+s]=a;this.updateLineStripIndices(t)}this.indexBuffer.addRangeToCopyToGl(t[0]*(0,n.getIndexElementSize)(),t[1]*(0,n.getIndexElementSize)())}},e.prototype.isTriangleStrip=function(){return this.parent.getPrimitiveType()===n.PrimitiveType.TRIANGLE_STRIP},e.prototype.logInconsistency=function(e){m||(a.log.warn(e),m=!0)},e.prototype.drawRanges=function(e,t){if(this.parent.compileBuffers(e),this.attributeBindings)if(this.areBuffersInitialized()){var i=t.getRangeIteratorForBufferSet(this);if(i&&i.hasMoreRanges()){var r=e.getActiveShader(),o=this.parent.viewer.getGlContext(),s=this.isTriangleStrip(),a=e.getPickPrimitiveAlternates()?this.parent.getAlternatePrimitiveMode():this.parent.getPrimitiveMode();if(e.getLastBufferBound()!==this){e.setLastBufferBound(this),this.vertexBuffer.bind();for(var c=0;c<l.length;++c){var u=l[c],h=this.attributeBindings[u.name];h?r.vertexAttribPointer(u.name,h):r.enableVertexAttribArray(u.name,!1)}e.isPicking()&&e.getPickPassIteration()>=0?this.pickIdBuffers[e.getPickPassIteration()]?(this.pickIdBuffers[e.getPickPassIteration()].bind(),r.vertexAttribPointer(n.AttributeNames.PICKING,g)):r.vertexAttrib4fv(n.AttributeNames.PICKING,n.PICK_CLEAR_COLOR):r.enableVertexAttribArray(n.AttributeNames.PICKING,!1),e.getPickPrimitiveAlternates()&&this.isTriangleStrip()?(this.parent.viewer.getResources().primitiveRestartBuffer.bind(),r.vertexAttribPointer(n.AttributeNames.PRIMITIVE_RESTART,f)):r.enableVertexAttribArray(n.AttributeNames.PRIMITIVE_RESTART,!1);var d=this.indexBuffer;e.getPickPrimitiveAlternates()&&s&&(d=this.lineStripIndexBuffer),d.bind()}for(var p=0,m=0;i.hasMoreRanges();){var y=i.getNextRange();if(y){var v=y[0],E=y[1]-y[0];1&v&&s&&(E-=1,v+=1),E<3&&s||(e.applyStyle(y[2]),o.drawElements(a,E,(0,n.getIndexElementType)(),v*(0,n.getIndexElementSize)()),p++,m+=E,e.getPickPrimitiveAlternates()&&s&&o.drawElements(o.POINTS,E,(0,n.getIndexElementType)(),v*(0,n.getIndexElementSize)()))}}this.parent.incrementStatisticsForCall(m,p)}}else this.logInconsistency("BEL-53632 BufferSet.prototype.draw without initialized buffers")},e.prototype.makeSceneDebugObject=function(){var e={};if(this.increments.isEmpty())return e;this.markAllIncrementsForBuffering(),this.processNewIncrements(),e.vertexBuffer=this.vertexBuffer.makeSceneDebugObject(Uint8Array),e.indexBuffer=this.indexBuffer.makeSceneDebugObject((0,n.getIndexBufferType)()),this.lineStripIndexBuffer&&(e.lineStripIndexBuffer=this.lineStripIndexBuffer.makeSceneDebugObject((0,n.getIndexBufferType)())),e.pickIdBuffers=[];for(var t=0;t<this.pickIdBuffers.length;++t)e.pickIdBuffers.push(this.pickIdBuffers[t].makeSceneDebugObject(Uint32Array));return this.copyBuffersToGl(),e},e.prototype.addGroupIncrementsToBounds=function(e,t,i,r){this.increments.each((function(n){var o=n.increment;return o.groupId===e&&o.ownerId===t&&o.lod===i&&r.addBox(o.getBounds()),!1}),this)},e}();t.BufferSet=E},924128:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChainedOperator=void 0;var r=i(311611),n=function(){function e(){this.operandA=null,this.operandB=null}return e.prototype.resetWithOperands=function(e,t){return this.operandA=e,this.operandB=t,this.operandB.setOperand(this.operandA),this},e.prototype.getRangeIteratorForBufferSet=function(e){return this.operandA&&this.operandB?this.operandB.getRangeIteratorForBufferSet(e):null},e.prototype.setOperand=function(e){this.operandA.setOperand(e)},e.prototype.makeSceneDebugObject=function(){var e={text:"ChainedOperator",children:[]};return(0,r.addDebuggableChild)(e,this.operandA),e},e}();t.ChainedOperator=n},967013:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupRanges=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i,r,n){var o=e.call(this)||this;return o.groupId=t,o.ownerId=i,o.primitiveType=r,o.lod=n,o.bounds=null,o}return(0,r.__extends)(t,e),t.prototype.getOwnerId=function(){return this.ownerId},t.prototype.getMeshGroupId=function(){return this.groupId},t.prototype.cloneForPreview=function(){var e=new t(this.groupId,this.ownerId,this.primitiveType,this.lod);return this.copyDataTo(e),e.setListenForDeletions(!0),e.setBounds(this.bounds),e},t.prototype.onIncrementDeleted=function(e){e.increment.groupId===this.groupId&&e.increment.ownerId===this.ownerId&&this.onIncrementRemoved(e)},t.prototype.makeSceneDebugObject=function(e){var t=e?this.shouldDrawForOccurrences(e):void 0,i="Group ranges: (ownerId: "+this.ownerId+", groupId: "+this.groupId+", primitiveType: "+(0,n.getPrimitiveTypeDescription)(this.primitiveType)+", lod: "+this.lod+", shouldDrawForOccurrence: "+t+", listenForDeletions: "+this.listenForDeletions+")",r=this.getChildSceneDebugObjects();return this.bounds&&r.push(this.bounds.makeSceneDebugObject()),{text:i,children:r,state:{opened:t}}},t.prototype.isCheaplyBoundable=function(){return this.lod===n.Lod.LOWEST},t.prototype.damageBounds=function(){this.bounds=null,n.Ranges.prototype.damageBounds.apply(this,arguments)},t.prototype.setBounds=function(e){this.bounds=e},t.prototype.getBounds=function(e,t){if(!this.bounds){this.bounds=new n.BoundingBox;for(var i=this.bufferSetRanges.getKeyValues(),r=0;r<i.length;r+=2){i[r].addGroupIncrementsToBounds(this.groupId,this.ownerId,this.lod,this.bounds)}}return this.bounds},t.prototype.shouldDrawForOccurrences=function(e){return e.getLod()===this.lod},t.prototype.getPrimitiveCount=function(){for(var e=0,t=this.bufferSetRanges.getKeyValues(),i=0;i<t.length;i+=2)for(var r=t[i+1],o=0;o<r.length;++o){var s=r[o];this.primitiveType===n.PrimitiveType.TRIANGLE_STRIP?e+=s[1]-s[0]-2:this.primitiveType===n.PrimitiveType.TRIANGLES?e+=(s[1]-s[0])/3:this.primitiveType===n.PrimitiveType.SILHOUETTES&&(e+=(s[1]-s[0])/6)}return e},t}(n.Ranges);t.GroupRanges=o},269676:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IncrementRanges=void 0;var r=i(423902),n=i(311611),o=function(e){function t(t,i){var r=e.call(this)||this;return r.debugId=t,r.sourceMeshGroupId=i,r.incrementDetails=new Set,r}return(0,r.__extends)(t,e),t.prototype.clone=function(){var e=new t(this.debugId,this.sourceMeshGroupId);return e.incrementDetails=new Set(this.incrementDetails),this.copyDataTo(e),e},t.prototype.getMeshGroupId=function(){return this.sourceMeshGroupId},t.prototype.makeSceneDebugObject=function(){var e="",t=!0;return this.incrementDetails.forEach((function(i){t||(e+=","),t=!1,e+=i.increment.getFullId()})),{text:"Increment ranges "+this.debugId+": (incrementIds: ["+e+"], listenForDeletions: "+this.listenForDeletions+")",children:this.getChildSceneDebugObjects()}},t.prototype.isEmpty=function(){return 0===this.incrementDetails.size},t.prototype.containsIncrement=function(e){return this.incrementDetails.has(e)},t.prototype.onIncrementAdded=function(e,t){if(this.incrementDetails.has(e)&&!t)return!1;this.incrementDetails.add(e);var i=n.Ranges.prototype.onIncrementAdded.apply(this,arguments);return this.listenForDeletions&&e.bufferSet.addIncrementDeletionListener(this),i},t.prototype.onIncrementRemoved=function(e){if(!this.incrementDetails.has(e))return!1;this.incrementDetails.delete(e);var t=n.Ranges.prototype.onIncrementRemoved.apply(this,arguments);return this.listenForDeletions&&!this.bufferSetRanges.has(e.bufferSet)&&e.bufferSet.removeIncrementDeletionListener(this),t},t.prototype.getListenerId=function(){return this.listenerId},t.prototype.onIncrementDeleted=function(e){this.onIncrementRemoved(e)},t.prototype.getBounds=function(e,t){var i=new n.BoundingBox;return this.incrementDetails.forEach((function(r){e.isIncrementBoundable(r,t)&&i.addBox(r.increment.getBounds())})),i},t}(n.Ranges);t.IncrementRanges=o},689723:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectOperator=void 0;var r=i(311611),n=function(){function e(){this.operandA=null,this.operandB=null,this.iterator=new r.IntersectIterator}return e.prototype.setOperandA=function(e){this.operandA=e},e.prototype.setOperand=function(e){this.operandB=e},e.prototype.getRangeIteratorForBufferSet=function(e){if(!this.operandA||!this.operandB)return null;var t=this.operandA.getRangeIteratorForBufferSet(e);if(!t)return null;var i=this.operandB.getRangeIteratorForBufferSet(e);return i?(this.iterator.reset(t,i),this.iterator):null},e.prototype.makeSceneDebugObject=function(){var e={text:"IntersectOperator",children:[]};return(0,r.addDebuggableChild)(e,this.operandA),(0,r.addDebuggableChild)(e,this.operandB),e},e}();t.IntersectOperator=n},749575:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectIterator=void 0;var r=i(423902),n=function(e){function t(){var t=e.call(this)||this;return t.operandA=null,t.currentARange=null,t.operandB=null,t.currentBRange=null,t}return(0,r.__extends)(t,e),t.prototype.reset=function(e,t){this.operandA=e,this.currentARange=null,this.operandB=t,this.currentBRange=null,this.nextResult=this.findNextRange()},t.prototype.findNextRange=function(){if(this.currentARange||(this.currentARange=this.operandA.getNextRange()),!this.currentARange)return null;for(;this.bIsBehind();)this.currentBRange=this.operandB.getNextRange();if(!this.currentBRange)return null;if(this.currentARange[1]<=this.currentBRange[0])return this.currentARange=null,this.findNextRange();var e=this.getStorageForNextResult();return e[2]=this.currentARange[2],this.currentARange[0]>=this.currentBRange[0]?e[0]=this.currentARange[0]:e[0]=this.currentBRange[0],this.currentARange[1]<=this.currentBRange[1]?(e[1]=this.currentARange[1],this.currentARange[1]===this.currentBRange[1]&&(this.currentBRange=null),this.currentARange=null):(e[1]=this.currentBRange[1],this.currentBRange=null),e},t.prototype.bIsBehind=function(){return this.currentBRange?this.currentBRange[1]<=this.currentARange[0]:this.operandB.hasMoreRanges()},t}(i(311611).BooleanIterator);t.IntersectIterator=n},460980:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=t.BufferAllocationPolicy=void 0;var r,n=i(423902),o=i(663748),s=i(311611),a=i(513774),c=i(311517);!function(e){e[e.MINIMUM=0]="MINIMUM",e[e.MEDIUM=1]="MEDIUM",e[e.MAXIMUM=2]="MAXIMUM"}(r=t.BufferAllocationPolicy||(t.BufferAllocationPolicy={}));var l=(0,s.getCounters)(),u=function(e){function t(t,i){var n=e.call(this)||this;return n.viewer=t,n.bufferSets=[],n.buffersNeedCompilation=!1,n.vertexSize=0,(0,s.viewerCheck)(t),n.bufferAllocationPolicy=i&&void 0!==i.bufferAllocationPolicy?i.bufferAllocationPolicy:r.MINIMUM,n.id=i?i.id:void 0,n.primitiveType=s.PrimitiveType.PRIMITIVE_UNKNOWN,n.incrementToBufferSetIndex=new a.TemplatedCountedMap,n.listenTo(n.viewer.getEventDispatcher(),s.GL_CONTEXT_RESTORED,n.onGlContextRestored),n.listenTo(n.viewer.getEventDispatcher(),s.SESSION_ENDED,n.onGlContextDestroyed),n}return(0,n.__extends)(t,e),t.prototype.destroy=function(){var e;for(e=0;e<this.bufferSets.length;++e)this.bufferSets[e].destroy();this.incrementToBufferSetIndex.clear(),this.stopListening()},t.prototype.getId=function(){return this.id},t.prototype.onGlContextRestored=function(e){for(var t=0;t<this.bufferSets.length;++t)this.bufferSets[t].reinitialize()},t.prototype.onGlContextDestroyed=function(){this.destroy()},t.prototype.getPrimitiveType=function(){return this.primitiveType},t.prototype.getBuffersNeedCompilation=function(){return this.buffersNeedCompilation},t.prototype.setBuffersNeedCompilation=function(){this.buffersNeedCompilation=!0},t.prototype.onPermanentlyRemoved=function(){this.destroy()},t.prototype.incrementStatisticsForCall=function(e,t){switch(l.increment(s.CounterNames.DRAW_CALLS,t),this.primitiveType){case s.PrimitiveType.LINES:l.increment(s.CounterNames.LINES,Math.floor(e/6));break;case s.PrimitiveType.POINTS:l.increment(s.CounterNames.POINTS,Math.floor(e/6));break;case s.PrimitiveType.TRIANGLES:l.increment(s.CounterNames.TRIANGLES,Math.floor(e/3));break;case s.PrimitiveType.TRIANGLE_STRIP:l.increment(s.CounterNames.TRIANGLES,e-2)}},t.prototype.getPrimitiveMode=function(){var e=this.viewer.getGlContext();switch(this.primitiveType){case s.PrimitiveType.POINTS:case s.PrimitiveType.LINES:case s.PrimitiveType.INFINITE_LINES:case s.PrimitiveType.TRIANGLES:case s.PrimitiveType.SILHOUETTES:return e.TRIANGLES;case s.PrimitiveType.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;default:c.log.warn("Unknown mesh primitive type: "+this.primitiveType)}return 0},t.prototype.getAlternatePrimitiveMode=function(){var e=this.viewer.getGlContext();switch(this.primitiveType){case s.PrimitiveType.LINES:return e.POINTS;case s.PrimitiveType.TRIANGLE_STRIP:return e.LINE_STRIP}return 0},t.prototype.getBufferSetIndexForIncrement=function(e){return this.incrementToBufferSetIndex.has(e)?this.incrementToBufferSetIndex.get(e):-1},t.prototype.addIncrement=function(e){if(!e.getFullId())return c.log.warn("An attempt was made to add a increment without a valid id"),null;if(!this.updateMeshPropertiesFromIncrement(e))return null;var t=this.getBufferSetIndexForIncrement(e.getFullId());t>=0&&this.bufferSets[t].deleteIncrement(e.getFullId());for(var i=null,r=-1,n=0;n<this.bufferSets.length;++n)if(i=this.bufferSets[n].incorporateIncrement(e)){r=n;break}if(r<0){var o=new s.BufferSet(this);(i=o.incorporateIncrement(e))?(r=this.bufferSets.length,this.bufferSets.push(o)):c.log.warn("A new buffer set failed to incorporate a single mesh increment")}return r>=0&&this.incrementToBufferSetIndex.insert(e.getFullId(),r),this.setBuffersNeedCompilation(),i},t.prototype.updateMeshPropertiesFromIncrement=function(e){if(this.primitiveType===s.PrimitiveType.PRIMITIVE_UNKNOWN)this.primitiveType=e.primitiveType;else if(this.primitiveType!==e.primitiveType)return c.log.warn("Tried to add two different increment types to the same mesh."),!1;var t=e.getVertexSize(this.viewer);if(this.vertexSize){if(this.vertexSize!==t)return c.log.warn("Encountered primitives with different sized vertices in the same mesh"),!1}else this.vertexSize=t;return!0},t.prototype.getIncrementDetails=function(e){var t=this.getBufferSetIndexForIncrement(e);return t>=0?this.bufferSets[t].getIncrementDetails(e):null},t.prototype.deleteIncrement=function(e){var t=this.getBufferSetIndexForIncrement(e),i=null;return t>=0&&(i=this.bufferSets[t].deleteIncrement(e),this.incrementToBufferSetIndex.remove(e),this.setBuffersNeedCompilation()),i},t.prototype.updateIncrementAttribute=function(e,t,i){var r=this.getBufferSetIndexForIncrement(t);r>=0&&(this.bufferSets[r].updateIncrementAttribute(e,t,i),this.setBuffersNeedCompilation())},t.prototype.extractMeshIncrement=function(e){var t=this.getBufferSetIndexForIncrement(e);return t>=0?this.bufferSets[t].getIncrement(e):null},t.prototype.compileBuffers=function(e){if(this.buffersNeedCompilation){this.buffersNeedCompilation=!1;for(var t=!1,i=0;i<this.bufferSets.length;++i)t=this.bufferSets[i].updateBuffers()||t,this.buffersNeedCompilation=this.buffersNeedCompilation||this.bufferSets[i].hasBufferUpdates();e&&t&&e.setLastBufferBound(null)}},t.prototype.isEmpty=function(){return this.incrementToBufferSetIndex.isEmpty()},t}(o.BackboneEventsBaseClass);t.Mesh=u},59142:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lod=t.Attributes=t.Attribute=void 0;var r=i(311611),n=r.GlDataType,o=function(){function e(e,t,i,r,n){this.name=e,this.dimension=t,this.type=i,this.incrementProperty=r,this.normalize=!!n}return e.prototype.typeSize=function(){return(0,r.sizeOfGlType)(this.type)},e.prototype.sizeInBytes=function(){return this.dimension*this.typeSize()},e}();t.Attribute=o,t.Attributes={POINT:new o(r.AttributeNames.POSITION,3,n.FLOAT,"points"),NORMAL:new o(r.AttributeNames.NORMAL,3,n.FLOAT,"normals"),OFFSET_VECTOR:new o(r.AttributeNames.OFFSET_VECTOR,3,n.FLOAT,"offsetVectors"),COLOR:new o(r.AttributeNames.COLOR,4,n.UNSIGNED_BYTE,"colors",!0),TEXTURE:new o(r.AttributeNames.TEXTURE,2,n.FLOAT,"textureCoordinates"),POINT_DATA:new o(r.AttributeNames.POINT_DATA,1,n.FLOAT,"pointData"),EDGE_DATA:new o(r.AttributeNames.EDGE_DATA,4,n.FLOAT,"edgeData"),PRIMITIVE_SIZE:new o(r.AttributeNames.PRIMITIVE_SIZE,1,n.FLOAT,"primitiveSizes"),PRIMITIVE_STYLE:new o(r.AttributeNames.PRIMITIVE_STYLE,4,n.UNSIGNED_BYTE,"primitiveStyles"),HIGHLIGHT_ID:new o(r.AttributeNames.HIGHLIGHT_ID,4,n.UNSIGNED_BYTE,"highlightVisibility",!0)},function(e){e.LOWEST="LOWEST",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.DEFAULT="MEDIUM"}(t.Lod||(t.Lod={}))},486608:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshIncrement=t.makeFullId=void 0;var r=i(911748),n=i(311517),o=i(507025),s=i(601759),a=i(311611),c=a.Attributes,l={globallyUniqueId:!0,pickId:!0,properties:!0},u=r.mat3.create(),h=r.mat4.create(),d=r.vec3.create(),p=r.vec3.create();Math.pow(2,16);function g(e,t){return t?t+"."+e:e}t.makeFullId=g;var f=1,m=function(e,t,i,r,n,o,s,a,c,l,u,h,d,p){return t[3*e+0]=a[0],t[3*e+1]=a[1],t[3*e+2]=a[2],c&&(i[3*e+0]=c[0],i[3*e+1]=c[1],i[3*e+2]=c[2]),l&&(r[4*e+0]=l[0],r[4*e+1]=l[1],r[4*e+2]=l[2],r[4*e+3]=l[3]),null!==u&&(n[e]=u),h&&(o[4*e+0]=h[0],o[4*e+1]=h[1],o[4*e+2]=h[2],o[4*e+3]=h[3]),s[4*e+0]=d[0],s[4*e+1]=d[1],s[4*e+2]=d[2],s[4*e+3]=p,e+1},y=r.vec3.create(),v=r.vec3.create(),E=r.vec3.create(),I=r.vec3.create(),T=r.vec4.create(),S=r.vec4.create(),P=r.vec3.create(),_=r.vec3.create(),M=r.vec4.create(),D=r.vec4.create(),C=r.vec3.create(),O=r.vec3.create(),A=r.vec3.create(),R=function(){function e(e,t,i,r,n){this.primitiveType=e,this.points=t,this.properties={},this.id=r||"",this.indices=i,n||this.prepareForBuffering()}return e.prototype.clone=function(t){var i=new e(this.primitiveType,this.points,this.indices,this.id,!0);for(var r in(0,s.overwriteMatchingProperties)(i,this,l),this.properties)l[r]||(i.properties[r]=this.properties[r]);return t&&(i.ownerId=t),i},e.prototype.setProperty=function(e,t){null==t?delete this.properties[e]:this.properties[e]=t},Object.defineProperty(e.prototype,"indices",{get:function(){return this.properties.indices||null},set:function(e){this.setProperty("indices",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"normals",{get:function(){return this.properties.normals||null},set:function(e){this.setProperty("normals",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetVectors",{get:function(){return this.properties.offsetVectors||null},set:function(e){this.setProperty("offsetVectors",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colors",{get:function(){return this.properties.colors||null},set:function(e){this.setProperty("colors",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textureCoordinates",{get:function(){return this.properties.textureCoordinates||null},set:function(e){this.setProperty("textureCoordinates",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitiveSizes",{get:function(){return this.properties.primitiveSizes||null},set:function(e){this.setProperty("primitiveSizes",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"primitiveStyles",{get:function(){return this.properties.primitiveStyles||null},set:function(e){this.setProperty("primitiveStyles",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointData",{get:function(){return this.properties.pointData||null},set:function(e){this.setProperty("pointData",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"edgeData",{get:function(){return this.properties.edgeData||null},set:function(e){this.setProperty("edgeData",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pickId",{get:function(){return this.properties.pickId||void 0},set:function(e){this.setProperty("pickId",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupId",{get:function(){return this.properties.groupId||""},set:function(e){this.setProperty("groupId",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownerId",{get:function(){return this.properties.ownerId||""},set:function(e){this.setProperty("ownerId",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundingBox",{get:function(){return this.properties.boundingBox||null},set:function(e){this.setProperty("boundingBox",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globallyUniqueId",{get:function(){return this.properties.globallyUniqueId||null},set:function(e){this.setProperty("globallyUniqueId",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lod",{get:function(){return this.properties.lod||a.Lod.DEFAULT},set:function(e){this.setProperty("lod",e)},enumerable:!1,configurable:!0}),e.prototype.getFullId=function(){return g(this.id,this.ownerId)},e.prototype.getFullGroupId=function(){return g(this.groupId,this.ownerId)},e.prototype.getPoint=function(e,t){var i=3*e;return e<0||i>=this.points.length?null:t?(t[0]=this.points[i],t[1]=this.points[i+1],t[2]=this.points[i+2],t):this.points instanceof Float32Array?this.points.subarray(i,i+3):this.points.slice(i,i+3)},e.prototype.getLinesLength=function(){if(this.primitiveType!==a.PrimitiveType.LINES)return-1;this.isPreparedForBuffering()||this.prepareForBuffering();for(var e=0,t=0;t<this.indices.length;t+=6)e+=r.vec3.dist(this.getPoint(this.indices[t+0]),this.getPoint(this.indices[t+1]));return e},e.prototype.getPositionAtDistanceAlongLines=function(e){if(this.primitiveType!==a.PrimitiveType.LINES)return null;this.isPreparedForBuffering()||this.prepareForBuffering();for(var t=0,i=0;i<this.indices.length;i+=6){var n=this.getPoint(this.indices[i+0]),o=this.getPoint(this.indices[i+1]),s=r.vec3.dist(n,o);if(t+s>=e){var c=(e-t)/s;return r.vec3.add(n,r.vec3.scale(r.vec3.subtract(o,n,r.vec3.create()),c),r.vec3.create())}t+=s}return null},e.prototype.getLineDirection=function(e){if(!this.isLines())return null;if(this.isPreparedForBuffering()||this.prepareForBuffering(),e<0||6*(e+1)>this.indices.length)return null;var t=6*e,i=r.vec3.subtract(this.getPoint(this.indices[t+1]),this.getPoint(this.indices[t+0]),r.vec3.create());return r.vec3.normalize(i)},e.prototype.getRepresentativeDirection=function(){return this.isLines()?this.getLineDirection(0):this.isTriangles()&&this.normals&&this.normals.length>=3?this.normals instanceof Float32Array?this.normals.subarray(0,3):this.normals.slice(0,3):null},e.prototype.equals=function(e){return!(!e||this.primitiveType!==e.primitiveType)&&(this.id===e.id&&(0,o.arraysEqual)(this.pickId,e.pickId)&&(0,o.arraysEqual)(this.points,e.points)&&(0,o.arraysEqual)(this.indices,e.indices)&&(0,o.arraysEqual)(this.normals,e.normals)&&(0,o.arraysEqual)(this.offsetVectors,e.offsetVectors)&&(0,o.arraysEqual)(this.colors,e.colors)&&(0,o.arraysEqual)(this.textureCoordinates,e.textureCoordinates)&&(0,o.arraysEqual)(this.primitiveSizes,e.primitiveSizes)&&(0,o.arraysEqual)(this.primitiveStyles,e.primitiveStyles)&&(0,o.arraysEqual)(this.pointData,e.pointData)&&(0,o.arraysEqual)(this.edgeData,e.edgeData))},e.prototype.getBounds=function(){if(!this.boundingBox){this.boundingBox=new a.BoundingBox;for(var e=0;e<this.points.length;e+=3)this.boundingBox.addXYZ(this.points[e],this.points[e+1],this.points[e+2])}return this.boundingBox},e.prototype.getGloballyUniqueId=function(){return this.globallyUniqueId||(this.globallyUniqueId=f,f+=1),this.globallyUniqueId},e.prototype.isPreparedForBuffering=function(){return this.isTriangles()||this.isPoints()&&!!this.pointData||this.isLines()&&!!this.edgeData},e.prototype.hasAttribute=function(e){return!!(this.isLines()&&"edgeData"===e||this.isPoints()&&"pointData"===e)||!!this[e]},e.prototype.prepareForBuffering=function(){this.points&&this.indices&&!this.pointData&&this.isPoints()&&this.createPointData(),this.points&&this.indices&&!this.edgeData&&this.isLines()&&this.createEdgeData()},e.prototype.isPoints=function(){return this.primitiveType===a.PrimitiveType.POINTS},e.prototype.isLines=function(){return this.primitiveType===a.PrimitiveType.LINES||this.primitiveType===a.PrimitiveType.INFINITE_LINES||this.primitiveType===a.PrimitiveType.SILHOUETTES},e.prototype.isTriangles=function(){return this.primitiveType===a.PrimitiveType.TRIANGLES||this.primitiveType===a.PrimitiveType.TRIANGLE_STRIP},e.prototype.getTriangleCount=function(){return this.primitiveType===a.PrimitiveType.TRIANGLES?this.indices.length/3:this.primitiveType===a.PrimitiveType.TRIANGLE_STRIP?this.indices.length-2:0},e.prototype.getLineCount=function(){return this.isLines()?this.isPreparedForBuffering()?this.indices.length/6:this.indices.length/2:0},e.prototype.createPointData=function(){for(var e=this.indices.length,t=4*e,i=6*e,r=new Float32Array(c.POINT.dimension*t),n=new Int32Array(i),o=this.colors?new Uint8Array(c.COLOR.dimension*t):null,s=this.primitiveSizes?new Float32Array(c.PRIMITIVE_SIZE.dimension*t):null,a=this.primitiveStyles?new Uint8Array(c.PRIMITIVE_STYLE.dimension*t):null,l=new Float32Array(c.POINT_DATA.dimension*t),u=0,h=function(e,t,i,n,c){r[3*u+0]=e[0],r[3*u+1]=e[1],r[3*u+2]=e[2],t&&(o[4*u+0]=t[0],o[4*u+1]=t[1],o[4*u+2]=t[2],o[4*u+3]=t[3]),null!==i&&(s[u]=i),n&&(a[4*u+0]=n[0],a[4*u+1]=n[1],a[4*u+2]=n[2],a[4*u+3]=n[3]),l[u]=c,u+=1},d=0,p=0;p<e;++p){var g=this.indices[p],f=[this.points[3*g+0],this.points[3*g+1],this.points[3*g+2]],m=null;if(this.colors)m=[this.colors[4*g+0],this.colors[4*g+1],this.colors[4*g+2],this.colors[4*g+3]];var y=null;this.primitiveSizes&&(y=this.primitiveSizes[4*g]);var v=null;if(this.primitiveStyles)v=[this.primitiveStyles[4*g+0],this.primitiveStyles[4*g+1],this.primitiveStyles[4*g+2],this.primitiveStyles[4*g+3]];h(f,m,y,v,1),h(f,m,y,v,2),h(f,m,y,v,3),h(f,m,y,v,4),n[6*p+0]=d+0,n[6*p+1]=d+1,n[6*p+2]=d+2,n[6*p+3]=d+0,n[6*p+4]=d+2,n[6*p+5]=d+3,d+=4}this.points=r,this.indices=n,this.colors=o,this.primitiveSizes=s,this.primitiveStyles=a,this.pointData=l,this.normals=null,this.textureCoordinates=null},e.prototype.createEdgeData=function(){this.indices.length%2!=0&&n.log.warn("Trying to create lines with an odd number of indices");for(var e=Math.floor(this.indices.length/2),t=4*e,i=6*e,o=new Float32Array(c.POINT.dimension*t),s=new Int32Array(i),l=this.normals?new Float32Array(c.NORMAL.dimension*t):null,u=this.colors?new Uint8Array(c.COLOR.dimension*t):null,h=this.primitiveSizes?new Float32Array(c.PRIMITIVE_SIZE.dimension*t):null,d=this.primitiveStyles?new Uint8Array(c.PRIMITIVE_STYLE.dimension*t):null,p=new Float32Array(c.EDGE_DATA.dimension*t),g=0,f=0,C=1,O=0;O<e;++O){var A=this.indices[2*O+0],R=r.vec3.setXYZ(this.points[3*A+0],this.points[3*A+1],this.points[3*A+2],E),N=this.normals?r.vec3.setXYZ(this.normals[3*A+0],this.normals[3*A+1],this.normals[3*A+2],I):null,w=this.colors?r.vec4.setXYZW(this.colors[4*A+0],this.colors[4*A+1],this.colors[4*A+2],this.colors[4*A+3],T):null,b=this.primitiveSizes?this.primitiveSizes[A]:null,L=this.primitiveStyles?r.vec4.setXYZW(this.primitiveStyles[4*A+0],this.primitiveStyles[4*A+1],this.primitiveStyles[4*A+2],this.primitiveStyles[4*A+3],S):null,F=this.indices[2*O+1],B=r.vec3.setXYZ(this.points[3*F+0],this.points[3*F+1],this.points[3*F+2],P),x=this.normals?r.vec3.setXYZ(this.normals[3*F+0],this.normals[3*F+1],this.normals[3*F+2],_):null,U=this.colors?r.vec4.setXYZW(this.colors[4*F+0],this.colors[4*F+1],this.colors[4*F+2],this.colors[4*F+3],M):null,G=this.primitiveSizes?this.primitiveSizes[F]:null,H=this.primitiveStyles?r.vec4.setXYZW(this.primitiveStyles[4*F+0],this.primitiveStyles[4*F+1],this.primitiveStyles[4*F+2],this.primitiveStyles[4*F+3],D):null,V=r.vec3.subtract(B,R,y),k=r.vec3.length(V);r.vec3.normalize(V);var W=C,j=C+=k;this.primitiveType===a.PrimitiveType.INFINITE_LINES&&(W=-W,j=-j,B=R),g=m(g,o,l,u,h,d,p,R,N,w,b,L,r.vec3.scale(V,1,v),W),g=m(g,o,l,u,h,d,p,B,x,U,G,H,r.vec3.scale(V,2,v),j),g=m(g,o,l,u,h,d,p,B,x,U,G,H,r.vec3.scale(V,3,v),j),g=m(g,o,l,u,h,d,p,R,N,w,b,L,r.vec3.scale(V,4,v),W),s[6*O+0]=f+0,s[6*O+1]=f+1,s[6*O+2]=f+2,s[6*O+3]=f+0,s[6*O+4]=f+2,s[6*O+5]=f+3,f+=4}this.points=o,this.indices=s,this.normals=l,this.colors=u,this.primitiveSizes=h,this.primitiveStyles=d,this.edgeData=p,this.textureCoordinates=null},e.prototype.createTransformed=function(e){var t,i=[0,0,0],n=r.mat4.toMat3(r.mat4.toRotationMat(e,h),u),o=this.clone();for(o.boundingBox=null,o.points=new Float32Array(o.points.length),t=0;t<this.points.length;t+=3)i[0]=this.points[t],i[1]=this.points[t+1],i[2]=this.points[t+2],r.mat4.multiplyVec3(e,i),o.points[t]=i[0],o.points[t+1]=i[1],o.points[t+2]=i[2];function s(e){var o=new Float32Array(e.length);for(t=0;t<e.length;t+=3)i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],r.mat3.multiplyVec3(n,i),r.vec3.normalize(i),o[t]=i[0],o[t+1]=i[1],o[t+2]=i[2];return o}if(this.normals&&(o.normals=s(this.normals)),this.offsetVectors&&(o.offsetVectors=s(this.offsetVectors)),this.edgeData){var a=this.edgeData,c=new Float32Array(o.edgeData.length);for(t=0;t<this.edgeData.length;t+=4){i[0]=a[t],i[1]=a[t+1],i[2]=a[t+2];var l=r.vec3.length(i);r.mat3.multiplyVec3(n,i),r.vec3.scale(i,l/r.vec3.length(i)),c[t]=i[0],c[t+1]=i[1],c[t+2]=i[2],c[t+3]=this.edgeData[t+3]}o.edgeData=c}return o},e.prototype.concatenate=function(t){if(!(t&&t.primitiveType===this.primitiveType&&(0,s.objectsDefinedInSameWay)(this.normals,t.normals)&&(0,s.objectsDefinedInSameWay)(this.offsetVectors,t.offsetVectors)&&(0,s.objectsDefinedInSameWay)(this.colors,t.colors)&&(0,s.objectsDefinedInSameWay)(this.textureCoordinates,t.textureCoordinates)&&(0,s.objectsDefinedInSameWay)(this.primitiveSizes,t.primitiveSizes)&&(0,s.objectsDefinedInSameWay)(this.primitiveStyles,t.primitiveStyles)&&(0,s.objectsDefinedInSameWay)(this.edgeData,t.edgeData)&&(0,s.objectsDefinedInSameWay)(this.pointData,t.pointData)))return null;var i=(0,a.concatenateFloat32Arrays)(this.points,t.points),r=new Int32Array(this.indexLengthWithDegenerates()+t.indices.length);r.set(this.indices);for(var n=this.indexLengthWithDegenerates(),o=this.vertexCount(),c=0;c<t.indices.length;++c)r[n+c]=t.indices[c]+o;this.primitiveType===a.PrimitiveType.TRIANGLE_STRIP&&(r[n-2]=this.indices[this.indices.length-1],this.indices.length%2&&(r[n-3]=this.indices[this.indices.length-1]),r[n-1]=t.indices[0]+o);var l=new e(this.primitiveType,i,r,void 0,!0);return this.normals&&t.normals&&(l.normals=(0,a.concatenateFloat32Arrays)(this.points,t.points)),this.colors&&t.colors&&(l.colors=(0,a.concatenateUint8Arrays)(this.colors,t.colors)),this.textureCoordinates&&t.textureCoordinates&&(l.textureCoordinates=(0,a.concatenateFloat32Arrays)(this.textureCoordinates,t.textureCoordinates)),this.primitiveSizes&&t.primitiveSizes&&(l.primitiveSizes=(0,a.concatenateFloat32Arrays)(this.primitiveSizes,t.primitiveSizes)),this.primitiveStyles&&t.primitiveStyles&&(l.primitiveStyles=(0,a.concatenateUint8Arrays)(this.primitiveStyles,t.primitiveStyles)),this.edgeData&&t.edgeData&&(l.edgeData=(0,a.concatenateFloat32Arrays)(this.edgeData,t.edgeData)),this.pointData&&t.pointData&&(l.pointData=(0,a.concatenateFloat32Arrays)(this.pointData,t.pointData)),this.offsetVectors&&t.offsetVectors&&(l.offsetVectors=(0,a.concatenateFloat32Arrays)(this.offsetVectors,t.offsetVectors)),l},e.prototype.indexLengthWithDegenerates=function(){return this.primitiveType===a.PrimitiveType.TRIANGLE_STRIP?this.indices.length%2==0?this.indices.length+2:this.indices.length+3:this.indices.length},e.prototype.vertexCount=function(){return this.points.length/c.POINT.dimension},e.prototype.getPreparedVertexCount=function(){return this.isPreparedForBuffering()?this.vertexCount():4*this.vertexCount()},e.prototype.getPreparedIndexCount=function(){return this.isPreparedForBuffering()?this.indexLengthWithDegenerates():this.isLines()?6*Math.floor(this.indices.length/2):this.isPoints()?6*this.indices.length:(n.log.warn("Found unprepared increment that was not lines or points"),this.indexLengthWithDegenerates())},e.prototype.getVertexSize=function(e){var t=0;for(var i in a.Attributes){var r=a.Attributes[i];this.hasAttribute(r.incrementProperty)||r.name===a.AttributeNames.OCCURRENCE_ID?t+=r.sizeInBytes():r.name!==a.AttributeNames.OCCURRENCE_DATA0&&r.name!==a.AttributeNames.OCCURRENCE_DATA1&&r.name!==a.AttributeNames.OCCURRENCE_DATA2||e.areOccurrenceTexturesSupported()||(t+=r.sizeInBytes())}return t},e.prototype.getMeshSetId=function(){var e=0,t=0;for(var i in e|=this.primitiveType<<t,t+=a.PRIMITIVE_TYPE_BITS,a.Attributes){var r=a.Attributes[i];this.hasAttribute(r.incrementProperty)&&(e|=1<<t),++t}return e},e.prototype.iteratePrimitives=function(e){switch(this.primitiveType){case a.PrimitiveType.POINTS:this.iteratePoints(e);break;case a.PrimitiveType.LINES:this.iterateLines(e);break;case a.PrimitiveType.TRIANGLES:this.iterateTriangles(e);break;case a.PrimitiveType.TRIANGLE_STRIP:this.iterateTriangleStrip(e);break;default:n.log.warn("Cannot iterate over primitive type "+this.primitiveType)}},e.prototype.iteratePoints=function(e){this.prepareForBuffering();for(var t=0;t<this.indices.length;t+=6)e(this.getPoint(this.indices[t],C))},e.prototype.iterateLines=function(e){this.prepareForBuffering();for(var t=0;t<this.indices.length;t+=6)e(this.getPoint(this.indices[t],C),this.getPoint(this.indices[t+1],O))},e.prototype.iterateTriangles=function(e){for(var t=Math.floor(this.indices.length/3),i=0;i<3*t;i+=3)e(this.getPoint(this.indices[i],C),this.getPoint(this.indices[i+1],O),this.getPoint(this.indices[i+2],A))},e.prototype.iterateTriangleStrip=function(e){for(var t=0;t<this.indices.length-2;++t)this.indices[t]!==this.indices[t+1]&&this.indices[t]!==this.indices[t+2]&&this.indices[t+1]!==this.indices[t+2]&&(t%2?e(this.getPoint(this.indices[t],C),this.getPoint(this.indices[t+2],O),this.getPoint(this.indices[t+1],A)):e(this.getPoint(this.indices[t],C),this.getPoint(this.indices[t+1],O),this.getPoint(this.indices[t+2],A)))},e.prototype.getPositionNearCenter=function(){return this.getPositionNearPoint(this.getBounds().center()).position},e.prototype.getPositionNearPoint=function(e){var t=null,i=1/0;function n(n){var o=r.vec3.distanceSquared(e,n);o<i&&(t=r.vec3.create(n),i=o)}function o(t,i){n((0,a.closestPointOnLine)(t,i,e))}return this.iteratePrimitives((function(e,t,i){t||i?i?function(e,t,i){o(e,t),o(t,i),o(i,e);var s=d;r.vec3.add(s,r.vec3.scale(e,1/3,p)),r.vec3.add(s,r.vec3.scale(t,1/3,p)),r.vec3.add(s,r.vec3.scale(i,1/3,p)),n(s)}(e,t,i):o(e,t):n(e)})),{position:t,distance:i}},e}();t.MeshIncrement=R},867297:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshManager=t.getNewOwnerId=t.nextOwnerId=void 0;var r=i(736202),n=i(311611);t.nextOwnerId=1,t.getNewOwnerId=function(){var e=t.nextOwnerId.toString();return++t.nextOwnerId,e};var o=function(){function e(e,t){this.viewer=e,this.meshCreationOptions=t,this.meshes={},this.incrementIdToMesh={},this.groupRanges={},this.ownsMeshes=!0}return e.prototype.destroy=function(){if(this.ownsMeshes)for(var e in this.meshes)this.meshes[e].destroy();for(var t in this.groupRanges)this.groupRanges[t].destroy()},e.prototype.cloneForPreview=function(t){var i=new e(this.viewer,this.meshCreationOptions);for(var n in i.ownsMeshes=!1,i.meshes=(0,r.clone)(this.meshes),i.incrementIdToMesh=(0,r.clone)(this.incrementIdToMesh),this.groupRanges){this.groupRanges[n].getOwnerId()===t&&(i.groupRanges[n]=this.groupRanges[n].cloneForPreview())}return i},e.prototype.addMeshIncrement=function(e,t,i){this.removeMeshIncrement(e.id,t),e.ownerId=t;var r=e.getMeshSetId(),o=this.meshes[r];o||(this.meshes[r]=o=new n.Mesh(this.viewer,this.meshCreationOptions));var s=o.addIncrement(e);if(s){this.incrementIdToMesh[e.getFullId()]=o;var a=this.getGroupRangesForIncrement(e);a&&(a.onIncrementAdded(s),i&&a.setBounds(i))}return s},e.prototype.getIncrementDetails=function(e,t){var i=(0,n.makeFullId)(e,t),r=this.incrementIdToMesh[i];return r?r.getIncrementDetails(i):null},e.prototype.removeMeshIncrement=function(e,t){var i=(0,n.makeFullId)(e,t),r=this.incrementIdToMesh[i],o=null;if(r){if(o=r.deleteIncrement(i)){var s=this.getGroupRangesForIncrement(o.increment);s&&s.onIncrementRemoved(o)}delete this.incrementIdToMesh[i]}return o},e.prototype.getGroupRangesForIncrement=function(e){return e.groupId?this.getOrCreateGroupRangesForGroupTypeAndLod(e.groupId,e.ownerId,e.primitiveType,e.lod):null},e.prototype.getGroupRangesId=function(e,t,i,r){return e+"."+t+"."+i+"."+r},e.prototype.getOrCreateGroupRangesForGroupTypeAndLod=function(e,t,i,r){var o=this.getGroupRangesId(e,t,i,r),s=this.groupRanges[o];return s||(this.groupRanges[o]=s=new n.GroupRanges(e,t,i,r)),s},e.prototype.getGroupRangesForGroupTypeAndLod=function(e,t,i,r){var n=this.getGroupRangesId(e,t,i,r);return this.groupRanges[n]||null},e.prototype.removeEmptyMeshes=function(){var e=[],t=null;for(t in this.meshes)this.meshes[t].isEmpty()&&e.push(t);for(var i=0;i<e.length;++i)t=e[i],this.meshes[t].destroy(),delete this.meshes[t]},e.prototype.getMeshForIncrement=function(e){return this.meshes[e.getMeshSetId()]||null},e.prototype.compileBuffers=function(){for(var e in this.meshes)this.meshes[e].compileBuffers()},e}();t.MeshManager=o},841475:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},180333:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},104338:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},611947:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ranges=void 0;var r=i(423902),n=i(311611),o=i(423650),s=function(){function e(){this.bufferSetRanges=new o.FastIteratorMap,this.boundables=new Set,this.iterator=new n.RangeSetIterator,this.listenForDeletions=!1,this.listenerId=(0,n.incrementListenerIdCounter)()}return e.prototype.getMeshGroupId=function(){return null},e.prototype.destroy=function(){this.setListenForDeletions(!1)},e.prototype.copyDataTo=function(e){for(var t=this.bufferSetRanges.getKeyValues(),i=0;i<t.length;i+=2)e.bufferSetRanges.set(t[i],(0,n.cloneStyledRangeSet)(t[i+1]));e.boundables=new Set(this.boundables),e.setListenForDeletions(this.listenForDeletions)},e.prototype.getListenerId=function(){return this.listenerId},e.prototype.onIncrementDeleted=function(e){this.onIncrementRemoved(e)},e.prototype.setListenForDeletions=function(e){if(this.listenForDeletions!==e){this.listenForDeletions=e;for(var t=this.bufferSetRanges.getKeyValues(),i=0;i<t.length;i+=2)this.listenForDeletions?t[i].addIncrementDeletionListener(this):t[i].removeIncrementDeletionListener(this)}},e.prototype.isEmpty=function(){return 0===this.bufferSetRanges.size},e.prototype.onIncrementAdded=function(e,t){var i=this.bufferSetRanges.get(e.bufferSet);i||(i=[],this.bufferSetRanges.set(e.bufferSet,i));var r=e.indexRange;return t&&(r=[r[0],r[1],t]),(0,n.insertStyledRange)(r,i),this.damageBounds(),!0},e.prototype.onIncrementRemoved=function(e){var t=this.bufferSetRanges.get(e.bufferSet);return!!t&&((0,n.removeStyledRange)(e.indexRange,t),0===t.length&&this.bufferSetRanges.delete(e.bufferSet),this.damageBounds(),!0)},e.prototype.addBoundable=function(e){this.boundables.add(e)},e.prototype.removeBoundable=function(e){this.boundables.delete(e)},e.prototype.damageBounds=function(){var e,t;try{for(var i=(0,r.__values)(this.boundables.values()),n=i.next();!n.done;n=i.next()){n.value.damageBounds()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.isCheaplyBoundable=function(){return!1},e.prototype.getRangeIteratorForBufferSet=function(e){var t=this.bufferSetRanges.get(e);return t?(this.iterator.resetForRangeSet(t),this.iterator):null},e.prototype.shouldDrawForOccurrences=function(e){return!0},e.prototype.draw=function(e,t){for(var i=this.bufferSetRanges.getKeyValues(),r=0;r<i.length;r+=2)i[r].drawRanges(e,t||this)},e.prototype.getChildSceneDebugObjects=function(){for(var e=[],t=this.bufferSetRanges.getKeyValues(),i=0;i<t.length;i+=2)e.push({text:"Buffer set "+t[i].getDebugId()+" ranges: ("+(0,n.toString)(t[i+1])+")",children:[]});return e},e}();t.Ranges=s},808035:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Node=t.cleanUpParentlessNodes=t.addParentlessNode=t.NodeProperties=t.RenderOrderPriority=void 0;var r,n=i(311611),o=i(73055),s=i(601759),a=i(423650),c=i(311517),l=i(911748),u=i(194598),h=o.default.getManager();!function(e){e[e.LOWER=0]="LOWER",e[e.DEFAULT=1]="DEFAULT",e[e.HIGHER=2]="HIGHER",e[e.HIGHEST=3]="HIGHEST",e[e.COUNT=4]="COUNT"}(r=t.RenderOrderPriority||(t.RenderOrderPriority={}));var d=Math.ceil(Math.log(r.COUNT)/Math.log(2)),p=new n.BitShiftId,g=function(){function e(e){this.isVisible=!0,this.isPickable=!0,this.isHighlightable=!0,this.isTwoSided=!1,this.isTintedByCompare=!1,this.isShowThrough=!1,this.isDepthTested=!0,this.isStencilTested=!1,this.isStencilWritten=!0,this.clippedBySectionPlanes=!1,this.addsToSectionMask=!0,this.primitivesHaveTransparency=!1,this.zOffset=0,this.addsToBounds=!0,this.includedInBlend=!1,this.priority=r.DEFAULT,this.primitiveType=n.PrimitiveType.PRIMITIVE_UNKNOWN,this.material=n.DEFAULT_MATERIAL,e&&(0,s.overwriteMatchingProperties)(this,e),this.updateId()}return e.prototype.clone=function(){return new e(this)},e.prototype.cloneAndModify=function(t){var i=new e(this);return(0,s.overwriteMatchingProperties)(i,t),i.updateId(),i},e.prototype.toString=function(e){return e?(this.primitiveType!==n.PrimitiveType.PRIMITIVE_UNKNOWN?"primitiveType:"+(0,n.getPrimitiveTypeDescription)(this.primitiveType):"")+(this.material?",m:"+this.material.id:""):"NodeProperties: primitiveType:"+(0,n.getPrimitiveTypeDescription)(this.primitiveType)+",m:"+(this.material?this.material.id:"null")+",iV:"+this.isVisible+",iP:"+this.isPickable+",iH:"+this.isHighlightable+",iTS:"+this.isTwoSided+",iTBC:"+this.isTintedByCompare+",iShTh:"+this.isShowThrough+",iDT:"+this.isDepthTested+",iStTe:"+this.isStencilTested+",iStWr:"+this.isStencilWritten+",cBSP:"+this.clippedBySectionPlanes+",aTSM:"+this.addsToSectionMask+",pHT:"+this.primitivesHaveTransparency+",p:"+this.priority+",zO:"+this.zOffset+",aTB:"+this.addsToBounds+",iIB:"+this.includedInBlend},e.prototype.makeSceneDebugObject=function(){var e=[];return e.push((0,n.createTextDebugObject)("primitiveType",(0,n.getPrimitiveTypeDescription)(this.primitiveType))),e.push(this.material?this.material.makeSceneDebugObject():(0,n.createTextDebugObject)("material",null)),(0,n.addChildDebugObjectsFromProperties)(e,this,{id:!0,primitiveType:!0,material:!0}),{text:"[Node properties] "+this.id+" "+this.toString(!0),children:e}},e.prototype.updateId=function(){p.reset(),p.addBoolean(this.isVisible),p.addBoolean(this.isPickable),p.addBoolean(this.isHighlightable),p.addBoolean(this.isTwoSided),p.addBoolean(this.isShowThrough),p.addBoolean(this.isDepthTested),p.addBoolean(this.isStencilTested),p.addBoolean(this.isStencilWritten),p.addBoolean(this.clippedBySectionPlanes),p.addBoolean(this.addsToSectionMask),p.addBoolean(this.primitivesHaveTransparency),p.addBoolean(this.includedInBlend),p.addNumber(this.priority,d),p.addNumber(this.primitiveType,n.PRIMITIVE_TYPE_BITS),p.addNumber(this.zOffset,5),p.addBoolean(this.addsToBounds);var e=p.getId();this.material&&(e=p.getIdWithIdAppended(this.material.id)),this.id=e},e}();t.NodeProperties=g;var f=[];function m(e){f.push(e)}t.addParentlessNode=m,t.cleanUpParentlessNodes=function(){for(var e=0;e<f.length;++e){var t=f[e];t&&!t.getParent()&&t.onPermanentlyRemoved()}f=[]};var y=function(){function e(t,i,r){this.id=t,this.pose=null,this.children=null,this.childMap={},this.parent=null,this.areBoundsDamaged=!1,this.nodeOccurrences=null,this.usage=void 0!==r?r:n.bt_graphics_Usage.BASE,this.properties=new g(i),this.boundingBox=new n.BoundingBox,null===e.isLeafOccurrenceClippingEnabled&&(e.isLeafOccurrenceClippingEnabled=u.btInjector.CapabilitiesService.checkTPartialSectionViewCurrentlyEnabled())}return e.prototype.integrityCheck=function(){this.nodeOccurrences&&this.children&&this.children.length>0&&c.log.error("Found non-leaf scenegraph node with a node occurrences. Node id: "+this.id)},e.prototype.getId=function(){return this.id},e.prototype.setPose=function(e){e&&this.pose&&l.mat4.equal(e,this.pose)||(this.pose=e,this.damageBounds())},e.prototype.getPose=function(){return this.pose},e.prototype.damageBounds=function(){this.areBoundsDamaged||(this.areBoundsDamaged=!0,this.parent&&this.parent.damageBounds())},e.prototype.getUsage=function(){return this.usage},e.prototype.updateBounds=function(e){var t=!!e&&!!e.includeHiddenBounds;if(this.areBoundsDamaged||t)if(this.boundingBox.reset(),this.nodeOccurrences){if(this.getAddsToBounds()||t)for(var i=this.nodeOccurrences.getKeyValues(),r=0;r<i.length;r+=2)i[r+1].addBounds(this.boundingBox,e);this.areBoundsDamaged=!1}else if(this.children){this.areBoundsDamaged=!1;for(r=0;r<this.children.length;++r){var o=this.children[r].getBoundingBox(e);this.children[r].getIsVisible()&&this.children[r].getAddsToBounds()&&(0,n.isValidForBounding)(o)&&(this.boundingBox.addBox(o,this.pose),this.areBoundsDamaged=this.areBoundsDamaged||this.children[r].areBoundsDamaged)}}},e.prototype.getBoundingBox=function(e){return(this.areBoundsDamaged||e&&e.includeHiddenBounds)&&this.updateBounds(e),this.boundingBox},e.prototype.getOccurrenceBounds=function(e,t){if(this.getAddsToBounds())if(this.nodeOccurrences){var i=this.nodeOccurrences.get(e);i&&i.addBounds(t)}else if(this.children)for(var r=0;r<this.children.length;++r)this.children[r].getOccurrenceBounds(e,t)},e.prototype.addChild=function(e,t){if(e){switch(this.children||(this.children=[]),void 0===t?this.children.push(e):(t=(0,n.clamp)(Math.round(t),0,this.children.length),this.children.splice(t,0,e)),this.childMap[e.id]=e,e.parent=this,e.usage){case n.bt_graphics_Usage.PREVIEW:this.usage!==n.bt_graphics_Usage.PREVIEW&&c.log.warn("Adding PREVIEW node to non-PREVIEW node (usage "+this.usage+")");break;case n.bt_graphics_Usage.BASE:e.usage=this.usage}this.damageBounds(),this.integrityCheck()}else c.log.warn("A scenegraph node cannot add a null child")},e.prototype.addOccurrenceGeometryToNode=function(t,i,r,n,o,s){var a=t.id.toString(),c=this.getChildById(a);return c||(c=new e(a.toString(),t,this.usage),this.addChild(c)),c.addOccurrenceGeometry(i,r,n,o,s)},e.prototype.addOccurrenceGeometry=function(e,t,i,r,o){this.nodeOccurrences||(this.nodeOccurrences=new a.FastIteratorMap);var s=this.nodeOccurrences.get(e.getOccurrenceId());s||(s=new n.NodeOccurrence(this,e),this.nodeOccurrences.set(e.getOccurrenceId(),s));var c=s.addStyledMeshRanges(t,i,r,o);return this.damageBounds(),c},e.prototype.removeOccurrenceFromNode=function(e,t){var i=e.id.toString(),r=this.getChildById(i);r&&r.removeOccurrence(t),this.cleanEmptyMeshNodes()},e.prototype.hasNonIsolatedOccurrences=function(){if(this.nodeOccurrences)for(var e=this.nodeOccurrences.getKeyValues(),t=1;t<e.length;t+=2){if(!e[t].occurrenceData.getIsolated())return!0}return!1},e.prototype.removeOccurrence=function(e){if(e=+e,this.nodeOccurrences){var t=this.nodeOccurrences.get(e);t&&(t.destroy(),this.nodeOccurrences.delete(e),this.damageBounds())}else{for(var i=0;this.children&&i<this.children.length;++i)this.children[i].removeOccurrence(e);this.cleanEmptyMeshNodes()}},e.prototype.removeMeshGroupFromOccurrence=function(e,t){if(t=+t,this.nodeOccurrences){var i=this.nodeOccurrences.get(t);if(i)i.removeStyledMeshRangesForGroup(e)&&(i.isEmpty&&(i.destroy(),this.nodeOccurrences.delete(t)),this.damageBounds())}else{for(var r=0;this.children&&r<this.children.length;++r)this.children[r].removeMeshGroupFromOccurrence(e,t);this.cleanEmptyMeshNodes()}},e.prototype.removeChild=function(e,t){if(this.children){var i=this.children.indexOf(e);i>-1&&(delete this.childMap[e.id],this.children.splice(i,1),e.onRemoved(t),this.damageBounds())}},e.prototype.removeChildById=function(e){if(this.children){var t=this.childMap[e];t&&this.removeChild(t)}},e.prototype.removeAllChildren=function(){if(this.children){for(var e=0;e<this.children.length;++e)this.children[e].onRemoved();this.childMap={},this.children=[],this.damageBounds()}},e.prototype.remove=function(){this.parent?this.parent.removeChild(this):c.log.error("Trying to remove parentless child")},e.prototype.onRemoved=function(e){this.parent=null,e||m(this)},e.prototype.onPermanentlyRemoved=function(){if(this.children)for(var e=0;e<this.children.length;++e)this.children[e]&&this.children[e].onPermanentlyRemoved();else if(this.nodeOccurrences){var t=this.nodeOccurrences.getKeyValues();for(e=0;e<t.length;e+=2)t[e+1].destroy();this.nodeOccurrences=null}},e.prototype.cleanEmptyMeshNodes=function(){if(this.children)for(var e=0;e<this.children.length;++e)this.children[e].isMeshNode()?this.children[e].isEmptyMeshNode()&&this.children[e].remove():this.children[e].cleanEmptyMeshNodes()},e.prototype.getParent=function(){return this.parent},e.prototype.getChildById=function(e){return this.children&&this.childMap[e]||null},e.prototype.getChildrenWithPrefix=function(e){if(!this.children)return null;var t=null;for(var i in this.childMap)0===i.indexOf(e)&&(t=t||[]).push(this.childMap[i]);return t},e.prototype.getChildByIndex=function(e){return!this.children||e>=this.children.length||e<0?null:this.children[e]},e.prototype.getChildCount=function(){return this.children?this.children.length:0},e.prototype.isMeshNode=function(){return!!this.nodeOccurrences},e.prototype.isEmptyMeshNode=function(){return!!this.nodeOccurrences&&0===this.nodeOccurrences.size},e.prototype.getPrimitiveType=function(){return this.properties?this.properties.primitiveType:n.PrimitiveType.PRIMITIVE_UNKNOWN},e.prototype.isFaces=function(){if(!this.isMeshNode())return!1;var e=this.getPrimitiveType();return e===n.PrimitiveType.TRIANGLES||e===n.PrimitiveType.TRIANGLE_STRIP},e.prototype.isEdges=function(){if(!this.isMeshNode())return!1;var e=this.getPrimitiveType();return e===n.PrimitiveType.LINES||e===n.PrimitiveType.INFINITE_LINES},e.prototype.isPoints=function(){return!!this.isMeshNode()&&this.getPrimitiveType()===n.PrimitiveType.POINTS},e.prototype.isSilhouettes=function(){return!!this.isMeshNode()&&this.getPrimitiveType()===n.PrimitiveType.SILHOUETTES},e.prototype.getProperties=function(){return this.properties},e.prototype.getMaterial=function(){return this.properties.material},e.prototype.getIsVisible=function(){return this.properties.isVisible},e.prototype.getIsPickable=function(){return this.properties.isPickable},e.prototype.getIsHighlightable=function(){return this.properties.isHighlightable},e.prototype.getIsTwoSided=function(){return this.properties.isTwoSided},e.prototype.getIsTintedByCompare=function(){return this.properties.isTintedByCompare},e.prototype.getIsShowThrough=function(){return this.properties.isShowThrough},e.prototype.getIsDepthTested=function(){return this.properties.isDepthTested},e.prototype.getIsStencilTested=function(){return this.properties.isStencilTested},e.prototype.getIsStencilWritten=function(){return this.properties.isStencilWritten},e.prototype.getClippedBySectionPlanes=function(){return this.properties.clippedBySectionPlanes},e.prototype.getAddsToSectionMask=function(){return this.properties.addsToSectionMask},e.prototype.hasTransparency=function(){return this.properties.primitivesHaveTransparency||!!this.properties.material&&this.properties.material.hasTransparency()},e.prototype.getRenderOrderPriority=function(){return this.properties.priority},e.prototype.getIncludedInBlend=function(){return this.properties.includedInBlend},e.prototype.getAddsToBounds=function(){return this.properties.addsToBounds},e.prototype.getZOffset=function(){return this.properties.zOffset},e.prototype.draw=function(e){if((!e.isHighlighting()||this.getIsHighlightable())&&(e.isHighlighting()||e.isPicking()||this.getIsVisible())&&(this.children||e.nodeFilter(this))){if(this.pose&&e.pushModelViewMatrix(l.mat4.multiply(e.getModelViewMatrix(),this.pose,l.mat4.create())),this.nodeOccurrences){this.properties.material&&e.pushMaterial(this.properties.material),e.activateTopShader();var t=e.getActiveShader();if(!t)return this.properties.material&&e.popMaterial(),void(this.pose&&e.popModelViewMatrix());e.setMaterial(),e.updateModelviewUniforms(),e.setUsage(this.usage);var i=this.nodeOccurrences.getKeyValues();if(e.isHighlighting()){this.isEdges()?(e.getUseHiddenOpacityForEdgeHighlights()?(t.uniform1f("uHighlightOpacity",h.getNumber("HIGHLIGHT_HIDDEN_EDGE_OPACITY")),t.uniform1f("uHighlightBorderOpacity",h.getNumber("HIGHLIGHT_HIDDEN_EDGE_BORDER_OPACITY"))):(t.uniform1f("uHighlightOpacity",h.getNumber("HIGHLIGHT_EDGE_OPACITY")),t.uniform1f("uHighlightBorderOpacity",h.getNumber("HIGHLIGHT_EDGE_BORDER_OPACITY"))),e.setLineWidth(this.properties.material.lineWidth),e.setLineStipple(this.properties.material.lineStipple)):this.isPoints()&&(t.uniform1f("uHighlightOpacity",h.getNumber("HIGHLIGHT_POINT_OPACITY")),e.setPointSize(this.properties.material.pointSize)),e.setFacesToCull(n.CullFace.NONE);for(var r=0;r<i.length;r+=2)i[r+1].draw(e);e.setFacesToCull(n.CullFace.BACK)}if((this.getIsVisible()||e.isPicking())&&!e.isHighlighting()){this.getIsTwoSided()||e.isPickingBackFaces()?e.setFacesToCull(n.CullFace.NONE):e.setFacesToCull(n.CullFace.BACK),this.isPoints()?(e.setPointSize(this.properties.material.pointSize),e.setPointFont(this.properties.material.pointFont)):(this.isEdges()||this.isSilhouettes())&&(e.setLineWidth(this.properties.material.lineWidth),e.setLineStipple(this.properties.material.lineStipple)),t.uniform1i("uClippedBySectionPlanes",this.getClippedBySectionPlanes()?1:0),t.uniform1f("uAddsToSectionMask",this.getAddsToSectionMask()?1:0);for(r=0;r<i.length;r+=2)i[r+1].draw(e)}this.properties.material&&e.popMaterial()}else if(this.children)for(r=0;r<this.children.length;++r)this.children[r].draw(e);this.pose&&e.popModelViewMatrix()}},e.prototype.passesNodeFilter=function(e){if(e(this))return!0;if(this.children)for(var t=0;t<this.children.length;++t)if(this.children[t].passesNodeFilter(e))return!0;return!1},e.prototype.walk=function(e){if(e(this))return!0;for(var t=!1,i=0;i<this.getChildCount()&&!t;++i)t=this.getChildByIndex(i).walk(e);return t},e.prototype.getIdPath=function(){for(var e="",t=this;t;)e.length>0&&(e="."+e),e=t.id+e,t=t.parent;return e},e.prototype.makeSceneDebugObject=function(e){var t="Node: "+this.getId();this.properties.primitiveType!==n.PrimitiveType.PRIMITIVE_UNKNOWN&&(t+=" "+this.properties.toString(!0));var i=[];i.push(this.properties.makeSceneDebugObject());var r=this.getBoundingBox();if(r&&i.push(r.makeSceneDebugObject()),this.isMeshNode())for(var o=this.nodeOccurrences.getKeyValues(),s=0;s<o.length;s+=2)i.push(o[s+1].makeSceneDebugObject());else for(s=0;s<this.getChildCount();s++)i.push(this.getChildByIndex(s).makeSceneDebugObject(e+1));return{text:t,children:i,state:{opened:e<2}}},e.prototype.setVisible=function(e){if(this.getIsVisible()!==e){var t=this.properties.cloneAndModify({isVisible:e});this.properties=t}},e.isLeafOccurrenceClippingEnabled=null,e}();t.Node=y},332514:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeOccurrence=void 0;var r=i(311611),n=i(73055),o=i(911748),s=o.mat4.identity(),a=function(){function e(e,t){this.parent=e,this.occurrenceData=t,this.NON_ISOLATED_Z_OFFSET_ADDITION=n.default.getManager().getNumber("NON_ISOLATED_Z_OFFSET_ADDITION"),this.styledRanges=[],this.bounds=null,this.occurrenceData.addBoundable(this)}return e.prototype.destroy=function(){for(var e=0;e<this.styledRanges.length;++e)this.styledRanges[e].destroy();this.occurrenceData.removeBoundable(this)},e.prototype.addStyledMeshRanges=function(e,t,i,n){var o=new r.StyledMeshRanges(this,e,t,i,n);return this.styledRanges.push(o),o},e.prototype.removeStyledMeshRangesForGroup=function(e){for(var t=[],i=!1,r=0;r<this.styledRanges.length;++r){var n=this.styledRanges[r];n.getMeshRangesGroupId()===e?(i=!0,n.destroy()):t.push(n)}return this.styledRanges=t,i},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.styledRanges.length},enumerable:!1,configurable:!0}),e.prototype.draw=function(e){var t=e.getActiveShader();if(t&&(this.occurrenceData.isVisible(e)||e.getIsPickingHiddenOccurrences())&&e.doesNodeOcccurrencePassFilter(this)&&(!e.activePassNeedsIsolationTest()||e.activePassIsForIsolate()===this.occurrenceData.getIsolated())){for(var i=!1,r=0;r<this.styledRanges.length;++r){var n=this.styledRanges[r];this.occurrenceData.isStyledRangeCulled(n,e)||(i||(this.pushGraphicsState(e,t),i=!0),n.draw(e,this.occurrenceData))}i&&this.popGraphicsState(e)}},e.prototype.pushGraphicsState=function(e,t){if(e.pushModelViewMatrix(o.mat4.multiply(e.getModelViewMatrix(),this.occurrenceData.getTransform(),s)),e.updateModelviewUniforms(),e.activePassIsForSectionPlaneEndcapMask()){var i=e.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode()&&!this.occurrenceData.getIsolated();t.uniform1f("uOutsideIsolation",i?1:0)}this.occurrenceData.getShouldSetOccurrenceUniform()&&t.uniform1f("uOccurrenceId",this.occurrenceData.getOccurrenceId()),r.Node.isLeafOccurrenceClippingEnabled&&t.uniform1i("uClippedBySectionPlanes",this.parent.getClippedBySectionPlanes()&&this.occurrenceData.getIsClippedBySectionPlanes()?1:0);var n=this.parent.getZOffset();e.getHasIsolate()&&!this.occurrenceData.getIsolated()&&(n+=this.NON_ISOLATED_Z_OFFSET_ADDITION),e.setZOffset(n)},e.prototype.popGraphicsState=function(e){e.popModelViewMatrix()},e.prototype.damageBounds=function(){this.bounds&&this.bounds.reset(),this.parent.damageBounds()},e.prototype.addBounds=function(e,t){if(this.bounds||(this.bounds=new r.BoundingBox),(this.occurrenceData.isBoundable()||t&&t.includeHiddenBounds)&&!this.bounds.isInitialized()){var i=!1,n=void 0;for(n=0;n<this.styledRanges.length;++n)if(this.styledRanges[n].isCheaplyBoundable()){var o=this.styledRanges[n].getBounds(this.occurrenceData,this.parent.getUsage());o.isInitialized()&&(this.bounds.addBox(o,this.occurrenceData.getTransform()),i=!0)}if(!i)for(n=0;n<this.styledRanges.length;++n)this.bounds.addBox(this.styledRanges[n].getBounds(this.occurrenceData,this.parent.getUsage()),this.occurrenceData.getTransform())}e.addBox(this.bounds,null,!0)},e.prototype.makeSceneDebugObject=function(){var e="NodeOccurrence: (Occurrence id: "+this.occurrenceData.getOccurrenceId()+")",t=[this.occurrenceData.makeSceneDebugObject()];this.bounds&&t.push(this.bounds.makeSceneDebugObject());for(var i=0;i<this.styledRanges.length;++i)t.push(this.styledRanges[i].makeSceneDebugObject(this.occurrenceData));return{text:e,children:t,state:{opened:!0}}},e.prototype.parentHasTransparency=function(){return this.parent.hasTransparency()},e}();t.NodeOccurrence=a},430546:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NO_RANGE_OPERATOR=t.NoRangeOperator=void 0;var i=function(){function e(){}return e.prototype.getRangeIteratorForBufferSet=function(e){return null},e.prototype.setOperand=function(e){},e.prototype.makeSceneDebugObject=function(){return{text:"NoRangeOperator",children:[]}},e}();t.NoRangeOperator=i,t.NO_RANGE_OPERATOR=new i},765045:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetSharedOperators=t.OccurrenceHighlights=t.EMPTY_HIGHLIGHT_STYLE=void 0;var r=i(423902),n=i(311611),o=i(513774),s=new n.IntersectOperator,a=new n.ChainedOperator,c=new n.StyleOverwriteOperator,l={};t.EMPTY_HIGHLIGHT_STYLE=new n.Style,t.EMPTY_HIGHLIGHT_STYLE.setAttribute(n.Attributes.HIGHLIGHT_ID,[0,0,0,0]);var u=function(){function e(){this.entityHighlightRanges=new Map,this.entityHighlights=new Map,this.occurrenceHighlights=new Map}return e.prototype.destroy=function(){var e,t;try{for(var i=(0,r.__values)(this.entityHighlightRanges.values()),n=i.next();!n.done;n=i.next()){n.value.destroy()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.occurrenceHighlights.clear()},e.prototype.hasHighlight=function(){var e,t;if(this.occurrenceHighlights.size>0)return!0;try{for(var i=(0,r.__values)(this.entityHighlightRanges.values()),n=i.next();!n.done;n=i.next()){if(!n.value.isEmpty())return!0}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return!1},e.prototype.entityHasHighlight=function(e){var t,i;if(this.occurrenceHighlights.size>0)return!0;try{for(var n=(0,r.__values)(this.entityHighlightRanges.values()),o=n.next();!o.done;o=n.next()){if(o.value.containsIncrement(e))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!1},e.prototype.getEntityHighlights=function(e){return this.entityHighlights.get(e)},e.prototype.removeEntityHighlights=function(e){this.entityHighlights.delete(e)},e.prototype.getOrCreateEntityRangesForType=function(e){var t=this.entityHighlightRanges.get(e);return t||(t=new n.IncrementRanges(e),this.entityHighlightRanges.set(e,t),t.setListenForDeletions(!0)),t},e.prototype.updateEntityHighlight=function(e,t,i){var r=this.getOrCreateEntityRangesForType(t.type),s=(0,o.getOrCreateSubMap)(this.entityHighlights,i),a=this.getHighestPriorityHighlightFromMap(s);if(e===n.Action.ADD){if(s.set(t.getIdString(),t),!a||a.priority<t.priority){if(a){var c=this.entityHighlightRanges.get(a.type);c&&c.onIncrementRemoved(i)}r.onIncrementAdded(i,t.getStyle())}}else{s.delete(t.getIdString()),r.onIncrementRemoved(i);var l=this.getHighestPriorityHighlightFromMap(s);if(l)this.getOrCreateEntityRangesForType(l.type).onIncrementAdded(i,l.getStyle());r.isEmpty()&&(this.entityHighlightRanges.delete(t.type),r.destroy()),0===s.size&&this.entityHighlights.delete(i)}},e.prototype.updateOccurrenceHighlight=function(e,t){var i;e===n.Action.ADD?(i=(0,o.getOrCreateSubMap)(this.occurrenceHighlights,t.type)).set(t.getIdString(),t):(i=this.occurrenceHighlights.get(t.type))&&(i.delete(t.getIdString()),0===i.size&&this.occurrenceHighlights.delete(t.type))},e.prototype.getHighestPriorityOccurrenceHighlight=function(){var e,t,i,n;if(0===this.occurrenceHighlights.size)return null;var o=null;try{for(var s=(0,r.__values)(this.occurrenceHighlights.values()),a=s.next();!a.done;a=s.next()){var c=a.value;try{for(var l=(i=void 0,(0,r.__values)(c.values())),u=l.next();!u.done;u=l.next()){var h=u.value;(!o||h.priority>o.priority)&&(o=h)}}catch(e){i={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(i)throw i.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return o},e.prototype.clearHighlight=function(e){var t=this;this.occurrenceHighlights.delete(e.type);var i=this.entityHighlightRanges.get(e.type);i&&(this.entityHighlightRanges.delete(e.type),i.destroy()),this.entityHighlights.forEach((function(i,r){var n=!1;if(i.forEach((function(t,r){t.type===e.type&&(n=!0,i.delete(r))})),n)if(i.size>0){var o=t.getHighestPriorityHighlightFromMap(i);if(o&&o.priority<=e.priority)t.getOrCreateEntityRangesForType(o.type).onIncrementAdded(r,o.getStyle())}else t.entityHighlights.delete(r)}))},e.prototype.clearAllOccurrenceLevelHighlights=function(){this.occurrenceHighlights.clear()},e.prototype.getUnionOperator=function(e,t){var i=l[e];return i||(l[e]=i=new n.StyleUnionOperator),i.setOperandA(t),i.setOperand(null),i},e.prototype.getHighestPriorityHighlightFromMap=function(e){var t,i;if(!e)return null;var n=null;try{for(var o=(0,r.__values)(e.values()),s=o.next();!s.done;s=o.next()){var a=s.value;(!n||a.priority>n.priority)&&(n=a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}return n},e.prototype.getFirstHighlightFromMap=function(e){var t,i;if(e)try{for(var n=(0,r.__values)(e.values()),o=n.next();!o.done;o=n.next()){return o.value}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return null},e.prototype.getFirstOccurrenceHighlightOfType=function(e){return this.getFirstHighlightFromMap(this.occurrenceHighlights.get(e))},e.prototype.getHighlightOperator=function(e){var t=e.getActiveHighlightType(),i=this.getFirstOccurrenceHighlightOfType(t);if(i)return e.applyStyle(i.getStyle()),null;var r=this.entityHighlightRanges.get(t);return r?(s.setOperandA(r),s):n.NO_RANGE_OPERATOR},e.prototype.getHighlightStyleOperator=function(e,i){if(!e.getActiveShader().hasAttribute(n.AttributeNames.HIGHLIGHT_ID)||!this.hasHighlight())return i;var r=c;r.setDefaultStyle(t.EMPTY_HIGHLIGHT_STYLE);for(var o=null,s=null,l=e.getActiveHighlightType(),u=e.getViewer().getReferenceHighlights().getSortedHighlights(),h=0;h<u.length;++h){var d=u[h].type;if(!l||d===l){var p=this.getFirstOccurrenceHighlightOfType(d);if(p)r.setDefaultStyle(p.getStyle()),o=null,s=null;else{var g=this.entityHighlightRanges.get(d);if(g){var f=this.getUnionOperator(h,g);o||(o=f),s&&s.setOperand(f),s=f}}}}return r.setOverwriteOperand(o),i?a.resetWithOperands(i,r):r},e.prototype.makeSceneDebugObject=function(e){var t,i,n=[],o=[];try{for(var s=(0,r.__values)(this.entityHighlightRanges.values()),a=s.next();!a.done;a=s.next()){var c=a.value;o.push(c.makeSceneDebugObject())}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}n.push({text:"entityHighlightRanges",children:o}),n.push({text:"entityHighlights",children:this.getEntityHighlightsDebugInfo()});var l=[];return this.occurrenceHighlights.forEach((function(e,t){var i,n,o=[];try{for(var s=(0,r.__values)(e.keys()),a=s.next();!a.done;a=s.next()){var c=a.value;o.push({text:c.toString(),children:[]})}}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}l.push({text:t.toString(),children:o})})),n.push({text:"occurrenceHighlights",children:l}),{text:e,children:n}},e.prototype.getEntityHighlightsDebugInfo=function(){var e=[];return this.entityHighlights.forEach((function(t,i){var n,o,s=[];try{for(var a=(0,r.__values)(t.keys()),c=a.next();!c.done;c=a.next()){var l=c.value,u=[],h=t.get(l);h.debugStack&&u.push({text:"Stack: "+h.debugStack}),s.push({text:l.toString(),children:u})}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}e.push({text:i.increment.id,children:s})})),e},e}();t.OccurrenceHighlights=u,t.resetSharedOperators=function(){s=new n.IntersectOperator,a=new n.ChainedOperator,c=new n.StyleOverwriteOperator,l={}}},806776:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RangeSetIterator=void 0;var i=function(){function e(){this.rangeSet=null,this.index=0}return e.prototype.resetForRangeSet=function(e){this.rangeSet=e,this.index=0},e.prototype.hasMoreRanges=function(){return!!this.rangeSet&&this.index<this.rangeSet.length},e.prototype.getNextRange=function(){return this.hasMoreRanges()?this.rangeSet[this.index++]:null},e}();t.RangeSetIterator=i},171911:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.merge=t.stylesEqual=t.styleMapsEqual=t.Style=void 0;var r=i(423650),n=function(){function e(){this.attributeSettings=new r.FastIteratorMap,this.floatUniformSettings=new r.FastIteratorMap}return e.prototype.copyFrom=function(e){this.attributeSettings.setAll(e.attributeSettings),this.floatUniformSettings.setAll(e.floatUniformSettings)},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.clear=function(){this.attributeSettings.clear(),this.floatUniformSettings.clear()},e.prototype.equals=function(e){return!!e&&(this===e||!!o(this.attributeSettings,e.attributeSettings)&&!!o(this.floatUniformSettings,e.floatUniformSettings))},e.prototype.setAttribute=function(e,t){this.attributeSettings.set(e,t)},e.prototype.getAttribute=function(e){return this.attributeSettings.get(e)},e.prototype.setFloatUniform=function(e,t){this.floatUniformSettings.set(e,t)},e.prototype.applyStyle=function(e){var t=e.getActiveShader();if(t){for(var i=this.attributeSettings.getKeyValues(),r=0;r<i.length;r+=2)t.setAttribute(i[r],i[r+1]);var n=this.floatUniformSettings.getKeyValues();for(r=0;r<n.length;r+=2)t.setFloatUniform(n[r],n[r+1])}},e.prototype.toString=function(){for(var e="Style: ",t=this.attributeSettings.getKeyValues(),i=", ",r=0;r<t.length;r+=2){var n=t[r],o=t[r+1];r>0&&(e+=i),e+=n.name+": "+o}t.length>0&&(e+=i);var s=this.floatUniformSettings.getKeyValues();for(r=0;r<s.length;r+=2)r>0&&(e+=i),e+=s[r]+": "+s[r+1];return e},e}();function o(e,t){if(e.size!==t.size)return!1;for(var i=e.getKeyValues(),r=0;r<i.length;r+=2){var n=i[r],o=i[r+1],s=t.get(n);if(o!==s){if(void 0===s)return!1;if(void 0===o.length&&void 0===s.length)return!1;if(o.length!==s.length)return!1;for(var a=0;a<o.length;++a)if(o[a]!==s[a])return!1}}return!0}t.Style=n,t.styleMapsEqual=o,t.stylesEqual=function(e,t){return e&&t?e.equals(t):!(e||t)},t.merge=function(e,t,i){return e?t?(i.clear(),i.copyFrom(e),i.copyFrom(t),i):e:t}},310952:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyledMeshRanges=void 0;var r=i(311611),n=new r.StyleResetOperator,o=function(){function e(e,t,i,n,o){this.parent=e,this.style=t,this.meshRanges=i,this.styleOverrideRanges=n,this.styleOverrideOperator=null,this.meshRanges.addBoundable(this),o&&(this.rangeSkipOperator=new r.SubtractOperator,this.rangeSkipOperator.setSubtrahend(o))}return e.prototype.destroy=function(){this.meshRanges.removeBoundable(this)},e.prototype.getMeshRanges=function(){return this.meshRanges},e.prototype.getMeshRangesGroupId=function(){return this.meshRanges.getMeshGroupId()},e.prototype.draw=function(e,t){if(this.meshRanges.shouldDrawForOccurrences(t)){e.applyStyle(this.style);var i=t.getMeshRangeOperator(e);i!==r.NO_RANGE_OPERATOR&&(i&&i.setOperand(this.meshRanges),this.rangeSkipOperator&&(this.rangeSkipOperator.setOperand(i||this.meshRanges),i=this.rangeSkipOperator),e.activePassNeedsFaceAppearances()&&this.styleOverrideRanges&&(this.styleOverrideOperator||(this.styleOverrideOperator=new r.StyleOverwriteOperator,this.styleOverrideOperator.setOverwriteOperand(this.styleOverrideRanges),this.styleOverrideOperator.setDefaultStyle(this.style)),this.styleOverrideOperator.setOperand(i||this.meshRanges),i=this.styleOverrideOperator),e.activePassNeedsFaceAppearances()||(n.setOperand(i||this.meshRanges),n.setResetStyle(this.style),i=n),this.meshRanges.draw(e,i))}},e.prototype.isCheaplyBoundable=function(){return this.meshRanges.isCheaplyBoundable()},e.prototype.damageBounds=function(){this.parent.damageBounds()},e.prototype.getBounds=function(e,t){return this.meshRanges.getBounds(e,t)},e.prototype.makeSceneDebugObject=function(e){var t="Styled mesh range: (style: "+this.style+")",i=[this.meshRanges.makeSceneDebugObject(e)];return this.styleOverrideRanges&&(i.push(this.styleOverrideRanges.makeSceneDebugObject()),t+=", with style overrides"),{text:t,children:i}},e}();t.StyledMeshRanges=o},72082:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cloneStyledRangeSet=t.toString=t.removeStyledRange=t.insertStyledRange=void 0;var r=i(311611);t.insertStyledRange=function(e,t){if(t.length<1)t.push(e.slice(0));else{var i=(0,r.binarySearchRanges)(t,0,t.length,0,e[0]),n=!1,o=0,s=e[1],a=void 0;if(i>0){var c=t[i-1];c[1]>=e[0]&&((0,r.stylesEqual)(c[2],e[2])?(n=!0,s=Math.max(s,c[1])):(c[1]>s&&(a=[e[1],c[1],c[2]]),c[1]=e[0]))}for(var l=i;l<t.length;++l){var u=t[l];if(!(u[0]<=e[1]))break;u[1]<=e[1]?++o:(0,r.stylesEqual)(u[2],e[2])?(++o,s=Math.max(s,u[1])):u[0]<s&&(u[0]=s)}n?(t[i-1][1]=s,t.splice(i,o)):a?t.splice(i,o,[e[0],s,e[2]],a):t.splice(i,o,[e[0],s,e[2]])}},t.removeStyledRange=function(e,t){if(e[0]!==e[1]){var i=(0,r.binarySearchRanges)(t,0,t.length,1,e[0]),n=(0,r.binarySearchRanges)(t,i,t.length,0,e[1]);if(!(i>=t.length||i===n)){var o=null,s=null;t[i][0]<e[0]&&(o=[t[i][0],e[0],t[i][2]]),t[n-1][1]>e[1]&&(s=[e[1],t[n-1][1],t[n-1][2]]),o&&s?t.splice(i,n-i,o,s):o?t.splice(i,n-i,o):s?t.splice(i,n-i,s):t.splice(i,n-i)}}},t.toString=function(e){return 0===e.length?"[]":"[["+e.join("],[")+"]]"},t.cloneStyledRangeSet=function(e){for(var t=new Array(e.length),i=0;i<e.length;++i)t[i]=e[i].slice();return t}},81220:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleMergeIterator=void 0;var r=i(423902),n=i(670898),o=i(171911),s=function(e){function t(t){var i=e.call(this)||this;i.styleMergeStorage=[],i.currentStyleMergeStoragePointer=0;for(var r=0;r<t;++r)i.styleMergeStorage.push(new o.Style);return i}return(0,r.__extends)(t,e),t.prototype.getStyleMergeStorage=function(){var e=this.styleMergeStorage[this.currentStyleMergeStoragePointer];return this.currentStyleMergeStoragePointer=(this.currentStyleMergeStoragePointer+1)%this.styleMergeStorage.length,e},t}(n.BooleanIterator);t.StyleMergeIterator=s},134980:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleModificationOperator=t.StyleModifierIterator=t.getAlphaModifierFunction=void 0;var r=i(311611);t.getAlphaModifierFunction=function(e){return function(t){var i=t.getAttribute(r.Attributes.COLOR);if(i){var n=t.clone(),o=i.slice();return o[3]*=e,n.setAttribute(r.Attributes.COLOR,o),n}return t}};var n=function(){function e(e){this.styleModifier=e,this.baseIterator=null}return e.prototype.reset=function(e){return this.baseIterator=e,this},e.prototype.hasMoreRanges=function(){return this.baseIterator.hasMoreRanges()},e.prototype.getNextRange=function(){var e=this.baseIterator.getNextRange();if(e){var t=[e[0],e[1],e[2]];return t[2]&&(t[2]=this.styleModifier(t[2])),t}return null},e}();t.StyleModifierIterator=n;var o=function(){function e(e){this.baseOperand=null,this.iterator=new n(e)}return e.prototype.setOperand=function(e){this.baseOperand=e},e.prototype.getRangeIteratorForBufferSet=function(e){if(!this.baseOperand)return null;var t=this.baseOperand.getRangeIteratorForBufferSet(e);return t?this.iterator.reset(t):null},e.prototype.makeSceneDebugObject=function(){var e={text:"StyleModificationOperator",children:[]};return(0,r.addDebuggableChild)(e,this.baseOperand),e},e}();t.StyleModificationOperator=o},452964:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleOverwriteOperator=t.StyleOverwriteIterator=void 0;var r=i(423902),n=i(311611),o=function(e){function t(){var t=e.call(this,4)||this;return t.baseIterator=null,t.currentBaseRange=null,t.currentBaseOffset=-1,t.overwriteIterator=null,t.currentOverwriteRange=null,t.defaultStyle=null,t}return(0,r.__extends)(t,e),t.prototype.setDefaultStyle=function(e){this.defaultStyle=e},t.prototype.reset=function(e,t){return this.baseIterator=e,this.currentBaseRange=null,this.currentBaseOffset=-1,this.overwriteIterator=t,this.currentOverwriteRange=null,this.nextResult=this.findNextRange(),this},t.prototype.findNextRange=function(){if(this.currentBaseRange||(this.currentBaseRange=this.baseIterator.getNextRange(),this.currentBaseOffset=-1),!this.currentBaseRange)return null;for(;this.overwriteIteratorIsBehind();)this.currentOverwriteRange=this.overwriteIterator.getNextRange();var e=this.getStorageForNextResult();if(!this.currentOverwriteRange||this.currentOverwriteRange[0]>=this.currentBaseRange[1])e[0]=this.currentBaseOffset>=0?this.currentBaseOffset:this.currentBaseRange[0],e[1]=this.currentBaseRange[1],e[2]=(0,n.merge)(this.defaultStyle,this.currentBaseRange[2],this.getStyleMergeStorage()),this.currentBaseRange=null;else{var t=this.currentBaseOffset>=0?this.currentBaseOffset:this.currentBaseRange[0];e[0]=t;var i=(0,n.merge)(this.defaultStyle,this.currentBaseRange[2],this.getStyleMergeStorage());this.currentOverwriteRange[0]<=t?(e[2]=(0,n.merge)(i,this.currentOverwriteRange[2],this.getStyleMergeStorage()),this.currentBaseRange[1]<this.currentOverwriteRange[1]?(e[1]=this.currentBaseRange[1],this.currentBaseRange=null):this.currentBaseRange[1]>this.currentOverwriteRange[1]?(e[1]=this.currentOverwriteRange[1],this.currentBaseOffset=this.currentOverwriteRange[1],this.currentOverwriteRange=null):(e[1]=this.currentBaseRange[1],this.currentBaseRange=null,this.currentOverwriteRange=null)):(e[1]=this.currentOverwriteRange[0],e[2]=i,this.currentBaseOffset=this.currentOverwriteRange[0])}return e},t.prototype.overwriteIteratorIsBehind=function(){if(this.overwriteIterator){if(this.currentOverwriteRange){var e=this.currentBaseOffset>=0?this.currentBaseOffset:this.currentBaseRange[0];return this.currentOverwriteRange[1]<=e}return this.overwriteIterator.hasMoreRanges()}return!1},t}(n.StyleMergeIterator);t.StyleOverwriteIterator=o;var s=function(){function e(){this.baseOperand=null,this.overwriteOperand=null,this.iterator=new o}return e.prototype.setDefaultStyle=function(e){this.iterator.setDefaultStyle(e)},e.prototype.setOverwriteOperand=function(e){this.overwriteOperand=e},e.prototype.setOperand=function(e){this.baseOperand=e},e.prototype.getRangeIteratorForBufferSet=function(e){if(!this.baseOperand)return null;var t=this.baseOperand.getRangeIteratorForBufferSet(e);if(!t)return null;var i=this.overwriteOperand?this.overwriteOperand.getRangeIteratorForBufferSet(e):null;return this.iterator.reset(t,i)},e.prototype.makeSceneDebugObject=function(){var e={text:"StyleOverwriteOperator",children:[]};return(0,n.addDebuggableChild)(e,this.baseOperand),(0,n.addDebuggableChild)(e,this.overwriteOperand),e},e}();t.StyleOverwriteOperator=s},540063:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleResetOperator=t.StyleResetIterator=void 0;var r=i(423902),n=i(171911),o=i(81220),s=i(950204),a=function(e){function t(){var t=e.call(this,2)||this;return t.baseIterator=null,t.resetStyle=null,t}return(0,r.__extends)(t,e),t.prototype.setResetStyle=function(e){this.resetStyle=e},t.prototype.reset=function(e){return this.baseIterator=e,this.nextResult=this.findNextRange(),this},t.prototype.findNextRange=function(){var e=this.baseIterator.getNextRange();if(!e)return null;var t=this.getStorageForNextResult();return t[0]=e[0],t[1]=e[1],t[2]=(0,n.merge)(e[2],this.resetStyle,this.getStyleMergeStorage()),t},t}(o.StyleMergeIterator);t.StyleResetIterator=a;var c=function(){function e(){this.operand=null,this.iterator=new a}return e.prototype.setResetStyle=function(e){this.iterator.setResetStyle(e)},e.prototype.setOperand=function(e){this.operand=e},e.prototype.getRangeIteratorForBufferSet=function(e){if(!this.operand)return null;var t=this.operand.getRangeIteratorForBufferSet(e);return t?this.iterator.reset(t):null},e.prototype.makeSceneDebugObject=function(){var e={text:"StyleResetOperator",children:[]};return(0,s.addDebuggableChild)(e,this.operand),e},e}();t.StyleResetOperator=c},726992:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleUnionOperator=t.StyleUnionIterator=void 0;var r=i(423902),n=i(311611),o=function(e){function t(){var t=e.call(this)||this;return t.iteratorA=null,t.currentARange=null,t.currentAOffset=-1,t.iteratorB=null,t.currentBRange=null,t.currentBOffset=-1,t}return(0,r.__extends)(t,e),t.prototype.reset=function(e,t){return this.iteratorA=e,this.currentARange=null,this.currentAOffset=-1,this.iteratorB=t,this.currentBRange=null,this.currentBOffset=-1,this.nextResult=this.findNextRange(),this},t.prototype.findNextRange=function(){if(this.currentARange||(this.currentARange=this.iteratorA.getNextRange(),this.currentAOffset=-1),this.currentBRange||(this.currentBRange=this.iteratorB.getNextRange(),this.currentBOffset=-1),!this.currentARange&&!this.currentBRange)return null;var e=this.getStorageForNextResult();if(!this.currentARange){var t=this.currentBOffset>=0?this.currentBOffset:this.currentBRange[0];return e[0]=t,e[1]=this.currentBRange[1],e[2]=this.currentBRange[2],this.currentBRange=null,e}if(!this.currentBRange){var i=this.currentAOffset>=0?this.currentAOffset:this.currentARange[0];return e[0]=i,e[1]=this.currentARange[1],e[2]=this.currentARange[2],this.currentARange=null,e}var r=this.currentAOffset>=0?this.currentAOffset:this.currentARange[0],n=this.currentBOffset>=0?this.currentBOffset:this.currentBRange[0];return r<n?(e[0]=r,e[2]=this.currentARange[2],n<this.currentARange[1]?(e[1]=n,this.currentAOffset=n):(e[1]=this.currentARange[1],this.currentARange=null)):n<r?(e[0]=n,e[2]=this.currentBRange[2],r<this.currentBRange[1]?(e[1]=r,this.currentBOffset=r):(e[1]=this.currentBRange[1],this.currentBRange=null)):(e[0]=n,e[2]=this.currentBRange[2],this.currentARange[1]<this.currentBRange[1]?(e[1]=this.currentARange[1],this.currentBOffset=this.currentARange[1],this.currentARange=null):this.currentBRange[1]<this.currentARange[1]?(e[1]=this.currentBRange[1],this.currentAOffset=this.currentBRange[1],this.currentBRange=null):(e[1]=this.currentARange[1],this.currentARange=null,this.currentBRange=null)),e},t}(n.BooleanIterator);t.StyleUnionIterator=o;var s=function(){function e(){this.operandA=null,this.operandB=null,this.iterator=new o}return e.prototype.setOperandA=function(e){this.operandA=e},e.prototype.setOperand=function(e){this.operandB=e},e.prototype.getRangeIteratorForBufferSet=function(e){var t=this.operandA?this.operandA.getRangeIteratorForBufferSet(e):null,i=this.operandB?this.operandB.getRangeIteratorForBufferSet(e):null;return t||i?t?i?this.iterator.reset(t,i):t:i:null},e.prototype.makeSceneDebugObject=function(){var e={text:"StyleUnionOperator",children:[]};return(0,n.addDebuggableChild)(e,this.operandA),(0,n.addDebuggableChild)(e,this.operandB),e},e}();t.StyleUnionOperator=s},63032:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubtractMeshRanges=void 0;var r=i(423902),n=i(311611),o=function(){function e(e){this.subtractMeshRanges=e}return e.prototype.getRangeIteratorForBufferSet=function(e){return n.IncrementRanges.prototype.getRangeIteratorForBufferSet.call(this.subtractMeshRanges,e)},e.prototype.makeSceneDebugObject=function(){var e={text:"SubtractMeshRangeIncrementProvider",children:[]};return(0,n.addDebuggableChild)(e,this.subtractMeshRanges),e},e}(),s=function(e){function t(t){var i=e.call(this,t)||this;return i.subtractOperator=new n.SubtractOperator,i.subtractOperator.setSubtrahend(new o(i)),i.setListenForDeletions(!0),i}return(0,r.__extends)(t,e),t.prototype.setOperand=function(e){this.subtractOperator.setOperand(e)},t.prototype.getRangeIteratorForBufferSet=function(e){return this.subtractOperator.getRangeIteratorForBufferSet(e)},t}(n.IncrementRanges);t.SubtractMeshRanges=s},955897:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubtractIterator=void 0;var r=i(423902),n=function(e){function t(){var t=e.call(this)||this;return t.minuendRangeIterator=null,t.currentMinuendRange=null,t.minuendSubRangeStart=-1,t.subtrahendRangeIterator=null,t.currentSubtrahendRange=null,t}return(0,r.__extends)(t,e),t.prototype.reset=function(e,t){this.minuendRangeIterator=e,this.currentMinuendRange=null,this.minuendSubRangeStart=-1,this.subtrahendRangeIterator=t,this.currentSubtrahendRange=null,this.nextResult=this.findNextRange()},t.prototype.findNextRange=function(){if(this.currentMinuendRange||(this.currentMinuendRange=this.minuendRangeIterator.getNextRange()),!this.currentMinuendRange)return null;for(;this.subtrahendIsBehind();)this.currentSubtrahendRange=this.subtrahendRangeIterator.getNextRange();var e=this.getStorageForNextResult();if(!this.currentSubtrahendRange||this.currentSubtrahendRange[0]>this.currentMinuendRange[1])e[0]=this.minuendSubRangeStart>=0?this.minuendSubRangeStart:this.currentMinuendRange[0],e[1]=this.currentMinuendRange[1],e[2]=this.currentMinuendRange[2],this.currentMinuendRange=null,this.minuendSubRangeStart=-1;else{var t=this.minuendSubRangeStart>=0?this.minuendSubRangeStart:this.currentMinuendRange[0];if(this.currentSubtrahendRange[0]<=t)return this.currentSubtrahendRange[1]>=this.currentMinuendRange[1]?(this.currentMinuendRange=null,this.minuendSubRangeStart=-1):this.minuendSubRangeStart=this.currentSubtrahendRange[1],this.findNextRange();e[0]=t,e[1]=this.currentSubtrahendRange[0],e[2]=this.currentMinuendRange[2],this.currentSubtrahendRange[1]>=this.currentMinuendRange[1]?(this.currentMinuendRange=null,this.minuendSubRangeStart=-1):this.minuendSubRangeStart=this.currentSubtrahendRange[1]}return e},t.prototype.subtrahendIsBehind=function(){if(this.currentSubtrahendRange){var e=this.minuendSubRangeStart>=0?this.minuendSubRangeStart:this.currentMinuendRange[0];return this.currentSubtrahendRange[1]<=e}return this.subtrahendRangeIterator.hasMoreRanges()},t}(i(311611).BooleanIterator);t.SubtractIterator=n},121356:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubtractOperator=void 0;var r=i(311517),n=i(311611),o=function(){function e(){this.minuend=null,this.subtrahend=null,this.resultIterator=new n.SubtractIterator}return e.prototype.setOperand=function(e){this.minuend=e},e.prototype.setSubtrahend=function(e){this.subtrahend=e},e.prototype.getRangeIteratorForBufferSet=function(e){if(!this.minuend||!this.subtrahend)return r.log.info("SubtractOperator.getRangeIteratorForBufferSet should be called with subtrahend and minuend"),null;var t=this.minuend.getRangeIteratorForBufferSet(e);if(!t)return null;var i=this.subtrahend.getRangeIteratorForBufferSet(e);return i?(this.resultIterator.reset(t,i),this.resultIterator):t},e.prototype.makeSceneDebugObject=function(e){var t={text:"SubtractOperator",children:[]};return(0,n.addDebuggableChild)(t,this.minuend),(0,n.addDebuggableChild)(t,this.subtrahend),t},e}();t.SubtractOperator=o},757845:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelectedSectionPlane=t.SectionPlane=void 0;var r=i(423902),n=i(911748),o=i(925300),s=i(501242),a=i(311611),c=i(42586),l=i(951682),u=i(970846),h=function(e){function t(t,i,r,o,s,c){var u=e.call(this,s)||this;return u.elementConnection=o,u.normal=null,u.tangent=null,u.isPreSelected=!1,u.isSelected=!1,u.isHiddenFromPick=!1,u.manipulator=null,u.inversePreManipulationMatrix=null,u.preManipulationCenter=null,u.preManipulationNormal=null,u.preManipulationTangent=null,u.inferredCenter=null,u.label=-1,u.isManipulatorRemovedOnDeselection=!0,u.listenTo(u,a.UiEvents.CLICK+l.SECTIONPLANE_SELECTION_ID,u.onClick),u.listenTo(u,a.UiEvents.MOUSE_ENTER+l.SECTIONPLANE_SELECTION_ID,u.onMouseEnter),u.listenTo(u,a.UiEvents.MOUSE_LEAVE+l.SECTIONPLANE_SELECTION_ID,u.onMouseLeave),u.listenTo(u,a.UiEvents.SELECT+l.SECTIONPLANE_SELECTION_ID,u.onSelect),u.listenTo(u,a.UiEvents.DESELECT+l.SECTIONPLANE_SELECTION_ID,u.onDeselect),u.center=n.vec4.create(r),t.length<4?u.normal=n.vec4.createFrom(t[0],t[1],t[2],0):u.normal=n.vec4.create(t),i.length<4?u.tangent=n.vec4.createFrom(i[0],i[1],i[2],0):u.tangent=n.vec4.create(i),u.faceSize=c||1,u}return(0,r.__extends)(t,e),t.prototype.getSelection=function(e,t){return new a.UISelection(this,l.SECTIONPLANE_SELECTION_ID,"")},t.prototype.getPickPriority=function(e){return a.PickPriority.SECTION_PLANE},t.prototype.shouldBeClearedWithSelections=function(){return!1},t.prototype.allowSelection=function(){var e=this.viewer.getModelViewManagers().getManager().hasActiveSketch(),t=!(0,a.isUsageBase)();return!l.sectionPlaneSelectionDisabled&&!e&&!t},t.prototype.onClick=function(e,t,i){i.requestSelectedStatus=this.allowSelection()},t.prototype.onMouseEnter=function(){this.isPreSelected=this.allowSelection(),(0,a.requestDraw)()},t.prototype.onMouseLeave=function(){this.isPreSelected=!1,(0,a.requestDraw)()},t.prototype.isInteractionEnabled=function(){return this.allowSelection()},t.prototype.onSelect=function(e){this.isSelected=!0,this.manipulator?this.checkAndCreateInferenceControllerIfNeeded():this.createManipulator(e),(0,a.requestDraw)()},t.prototype.createManipulator=function(e){var t=this.center,i=e.sourcePick?e.sourcePick.location:null;if(i){var r=(0,a.getDrawer)().getCamera().getRay(i[0],i[1]),n=(0,a.intersectRayPlane)(r,this.getWorldSpacePlaneEquation());n&&(t=n)}this.manipulator=new a.Triad(this.viewer,u.TriadManipulatorType.PLANE,{displayEditView:!0}),this.manipulator.updateDefinition(this.getWorldSpaceMatrix(t)),this.viewer.getEventDispatcher().trigger(a.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER,this.manipulator,this.elementConnection),this.listenTo(this.manipulator,o.TriadEvents.REPOSITION_START,this.onRepositionStart),this.listenTo(this.manipulator,o.TriadEvents.REPOSITION_END,this.onRepositionEnd),this.listenTo(this.manipulator,o.TriadEvents.ENTER_INFERENCE,this.onEnterInference),this.listenTo(this.manipulator,o.TriadEvents.LEAVE_INFERENCE,this.onLeaveInference),this.listenTo(this.manipulator,u.ManipulatorEvents.CLICKED,this.onManipulatorClicked),this.listenTo(this.manipulator,o.TriadEvents.ROTATION_START,this.onRotationStart),this.listenTo(this.manipulator,o.TriadEvents.ROTATION_CHANGE,this.onRotationChange),this.listenTo(this.manipulator,o.TriadEvents.ROTATION_EDIT,this.onRotationEdit),this.listenTo(this.manipulator,o.TriadEvents.TRANSLATION_START,this.onTranslationStart),this.listenTo(this.manipulator,o.TriadEvents.TRANSLATION_CHANGE,this.onTranslationChange),this.listenTo(this.manipulator,o.TriadEvents.TRANSLATION_EDIT,this.onTranslationEdit),this.listenTo((0,a.getEditState)(),a.Events.PREVIEW_STATE_CHANGE,this.onPreviewStateChange)},t.prototype.onRepositionStart=function(){var e=this.checkAndCreateInferenceControllerIfNeeded();null!==e&&e.startInferencing(),this.preManipulationCenter=this.center},t.prototype.checkAndCreateInferenceControllerIfNeeded=function(){var e=s.DocumentController.getOpenDocumentController();if(!e)return null;var t=e.getSectionPlaneInferenceControllerManager();return t&&t.activeManipulator!==this.manipulator?(this.viewer.getEventDispatcher().trigger(a.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER,this.manipulator,this.elementConnection),t.activeController):null},t.prototype.onRepositionEnd=function(){this.inferredCenter?(this.center=this.inferredCenter,(0,c.setSerializableDataDirty)(!0)):this.manipulator.updateOrigin(this.preManipulationCenter),this.inferredCenter=null},t.prototype.onEnterInference=function(e){this.inferredCenter=e},t.prototype.onLeaveInference=function(){this.inferredCenter=null},t.prototype.onPreviewStateChange=function(){(0,a.isUsageBase)()||this.onDeselect()},t.prototype.onDeselect=function(){this.manipulator&&(this.getIsManipulatorRemovedOnDeselection()?this.destroyManipulator():this.manipulator.removeEditViewAndHighlights()),this.isSelected=!1,(0,a.requestDraw)()},t.prototype.destroyManipulator=function(){this.manipulator&&(this.stopListening(this.manipulator),this.manipulator.remove(),this.manipulator=null,this.viewer.getEventDispatcher().trigger(a.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER))},t.prototype.getIsManipulatorRemovedOnDeselection=function(){return this.isManipulatorRemovedOnDeselection},t.prototype.setIsManipulatorRemovedOnDeselection=function(e){this.isManipulatorRemovedOnDeselection=e},t.prototype.rotationStart=function(e){this.preManipulationCenter=n.vec3.createFrom(this.center[0],this.center[1],this.center[2]),this.preManipulationNormal=n.vec4.createFrom(this.normal[0],this.normal[1],this.normal[2],0),this.preManipulationTangent=n.vec4.createFrom(this.tangent[0],this.tangent[1],this.tangent[2],0),this.inversePreManipulationMatrix=n.mat4.inverse(e,n.mat4.create())},t.prototype.onManipulatorClicked=function(e){if(e instanceof a.Linear){var t=this.manipulator,i=n.mat4.create(t.transform);t.processUpdateFromAngularManipulator(0,i,Math.PI),this.onRotationEdit(i);var r=t.linearManipulators[0];if(r){var o=r.initialRay;if(o){var s=n.vec3.scale(o.direction,-1,n.vec3.create());r.initialRay=new a.Ray(o.point,s)}}}},t.prototype.onRotationStart=function(){this.rotationStart(this.manipulator.transform)},t.prototype.onRotationChange=function(){var e=n.mat4.multiply(this.manipulator.transform,this.inversePreManipulationMatrix,n.mat4.create());this.center=n.mat4.multiplyVec3(e,this.preManipulationCenter,n.vec3.create()),this.normal=n.mat4.multiplyVec4(e,this.preManipulationNormal,n.vec4.create()),this.tangent=n.mat4.multiplyVec4(e,this.preManipulationTangent,n.vec4.create()),(0,c.setSerializableDataDirty)(!0)},t.prototype.onRotationEdit=function(e){this.rotationStart(e),this.onRotationChange()},t.prototype.onTranslationStart=function(){this.preManipulationCenter=n.vec3.createFrom(this.center[0],this.center[1],this.center[2])},t.prototype.onTranslationChange=function(e){n.vec3.add(this.preManipulationCenter,e,this.center),(0,c.setSerializableDataDirty)(!0)},t.prototype.onTranslationEdit=function(e){this.onTranslationStart(),this.onTranslationChange(e)},t.prototype.onRemove=function(){this.onDeselect()},t.prototype.getWorldSpacePlaneEquation=function(){var e=n.vec3.dot(this.normal,this.center);return n.vec4.createFrom(this.normal[0],this.normal[1],this.normal[2],-e)},t.prototype.getWorldSpaceMatrix=function(e){var t=n.vec3.cross(this.tangent,this.normal,n.vec3.create());return n.mat4.createFrom(this.tangent[0],this.tangent[1],this.tangent[2],0,t[0],t[1],t[2],0,-this.normal[0],-this.normal[1],-this.normal[2],0,e[0],e[1],e[2],1)},t.prototype.getCameraSpacePlaneEquation=function(e,t){var i=n.mat4.multiplyVec4(e,this.normal,n.vec4.create());i=n.vec3.createFrom(i[0],i[1],i[2]);var r=n.vec3.dot(i,t);return n.vec4.createFrom(i[0],i[1],i[2],-r)},t.prototype.getCameraSpaceTangent=function(e){return n.mat4.multiplyVec4(e,this.tangent,n.vec4.create())},t.prototype.getCameraSpaceCenter=function(e){return n.mat4.multiplyVec3(e,this.center,n.vec3.create())},t.prototype.getPlaneMatrix=function(e){e||(e=n.mat4.create()),e[0]=this.tangent[0],e[1]=this.tangent[1],e[2]=this.tangent[2],e[3]=0;var t=[0,0,0,0],i=n.vec3.create();return n.vec3.cross(this.normal,this.tangent,i),n.vec3.normalize(i,t),e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=0,e[8]=this.normal[0],e[9]=this.normal[1],e[10]=this.normal[2],e[11]=0,e[12]=this.center[0],e[13]=this.center[1],e[14]=this.center[2],e[15]=1,e},t.prototype.getViewManipulatorOrigin=function(e){return e||(e=n.vec3.create()),e[0]=this.manipulator?this.manipulator.transform[12]:this.center[0],e[1]=this.manipulator?this.manipulator.transform[13]:this.center[1],e[2]=this.manipulator?this.manipulator.transform[14]:this.center[2],e},t}(a.UIElement);t.SectionPlane=h,t.getSelectedSectionPlane=function(e){var t=e.getUISelectionManager().getSelection();if(t&&t.selectionId===l.SECTIONPLANE_SELECTION_ID&&t.uiElement instanceof h&&(t.uiElement.isSelected||t.uiElement.isPreSelected))return t.uiElement}},42586:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setFromSerializableSectionViewData=t.setFromSerializablePlaneData=t.getSerializableSectionViewDataWithPersistentQueries=t.getSerializableSectionViewData=t.getSerializablePlaneData=t.loadState=t.saveAndClearState=t.resetSectionPlanesHiddenFromPick=t.hideSectionPlaneFromPick=t.isSectionPlaneModeEnabled=t.getSectionedItemsSize=t.getSectionPlaneCount=t.loadSectionPlanesFromParameters=t.removeSectionPlane=t.removeSectionPlanes=t.setSectionPlaneWithParameters=t.setSectionPlaneOnMatrix=t.setSectionPlaneOnMateConnector=t.clearSavedSectionPlaneParameters=t.getMostRecentActiveSectionPlaneParameters=t.updateShaderEndcapPatternUniforms=t.updateShaderEndcapPickingUniforms=t.updateShaderEndcapUniforms=t.updateShaderClippingUniforms=t.setForcePredictableHatching=t.makePlaneEquationMatrixDirty=t.getSectionPlaneOccurrenceIds=t.filterActiveSectionPlanes=t.forEachActiveSectionPlane=t.getActiveSectionPlane=t.areAnySectionPlanesSelectedOrPreselected=t.getPlaneIndexToAlignNormalTo=t.getCurrentSectionPlaneParameters=t.getActiveSectionViewState=t.SectionViewState=t.SectionedItemType=t.getMaxSectionPlanes=t.setSerializableDataDirty=void 0;var r,n=i(423902),o=i(663748),s=i(73055),a=i(163113),c=i(911748),l=i(194598),u=i(311517),h=i(712197),d=i(292959),p=i(227441),g=i(864589),f=i(951682),m=i(757845),y=i(317179),v=i(950204),E=i(388131),I=i(601759),T=i(846518),S=s.default.getManager(),P=!1,_=0;function M(){return 3}t.setSerializableDataDirty=function(e){P=e},t.getMaxSectionPlanes=M,function(e){e[e.Excluded=0]="Excluded",e[e.Included=1]="Included"}(r=t.SectionedItemType||(t.SectionedItemType={}));var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sectionPlanes=[],t.sectionedItems=[null,null],t.currentSectionedItemType=r.Excluded,t.isListening=!1,t.elementId="",t.eligibleCompositeParts=[new Set,new Set],t}return(0,n.__extends)(t,e),t.prototype.isNotEmpty=function(){var e,t;return this.sectionPlanes.length>0||(null===(e=this.sectionedItems[r.Excluded])||void 0===e?void 0:e.selections.length)>0||(null===(t=this.sectionedItems[r.Included])||void 0===t?void 0:t.selections.length)>0},t.prototype.setupListeners=function(){l.btInjector.CapabilitiesService.checkTPartialSectionViewCurrentlyEnabled()&&(this.isListening=!0,this.listenTo((0,g.getActiveViewerEventDispatcher)(),g.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,this.onPartStudioDisplayDataChanged),this.listenTo((0,g.getActiveViewerEventDispatcher)(),g.ASSEMBLY_DATA_PROCESSED,this.onAssemblyDataProcessed))},t.prototype.stopListening=function(t,i,r){this.isListening&&(e.prototype.stopListening.call(this,t,i,r),this.isListening=!1)},t.prototype.onPartStudioDisplayDataChanged=function(){this.setAllOccurrencesClippedExceptSelectedOnes(this.getIsExcludingItemsForSection())},t.prototype.onAssemblyDataProcessed=function(e){this.removeDeletedOccurrencesFromSectionedItems(e),this.setAllOccurrencesClippedExceptSelectedOnes(this.getIsExcludingItemsForSection())},t.prototype.removeDeletedOccurrencesFromSectionedItems=function(e){if(0!==e.deletedOccurrences.length){var t=this.getSectionedItems();if(t&&t.length>0){var i=new Set(e.deletedOccurrences.map((function(e){return e.getPathAsString()})));t.reset(t.filter((function(e){return!i.has(e.getOccurrence().getPathAsString())})))}}},t.prototype.setAllOccurrencesClippedExceptSelectedOnes=function(e){var t=(0,E.getActiveViewer)(),i=t.getModelViewManagers().getManager(),r=(0,a.isInAssemblyElement)()?i.getDisplayedAssembly():i.getDisplayedInContextAssembly();if(r){var n=this.getSectionedItemsAsSetOfOccurrencePaths();r.setAreOccurrencesClippedBySectionPlaneExcept(e,n)}if((0,a.isInPartStudioElement)()){var o=this.getSectionedItemsAsSetOfBodyIds(!0);i.getDisplayedPartStudio().getBodyComponent().setAreOccurrencesClippedBySectionPlaneExcept(e,o),t.getModelViewManagers().previewManagerExists()&&t.getModelViewManagers().getPreviewManager().getDisplayedPartStudio().getBodyComponent().setAreOccurrencesClippedBySectionPlaneExcept(e,o)}},t.prototype.getIsExcludingItemsForSection=function(){return this.currentSectionedItemType===r.Excluded},t.prototype.getCurrentSectionedItemType=function(){return this.currentSectionedItemType},t.prototype.setIsExcludingItemsForSection=function(e){this.currentSectionedItemType=e?r.Excluded:r.Included,P=!0,this.setAllOccurrencesClippedExceptSelectedOnes(e),(0,E.getActiveViewer)().requestDraw()},t.prototype.getSectionPlanes=function(){return this.sectionPlanes},t.prototype.clearSectionPlanes=function(){this.sectionPlanes=[]},t.prototype.addSectionPlane=function(e){this.sectionPlanes.push(e)},t.prototype.removeSectionPlane=function(e){this.sectionPlanes=this.sectionPlanes.filter((function(t){return t!==e}))},t.prototype.destroySectionedItems=function(){this.currentSectionedItemType=r.Excluded,this.sectionedItems.forEach((function(e){e&&e.destroy()})),this.stopListening(),this.sectionedItems=[null,null],this.eligibleCompositeParts.forEach((function(e){return e.clear()})),this.elementId=""},t.prototype.setElementId=function(e,t){this.elementId!==e&&(""!==this.elementId&&this.destroySectionedItems(),this.elementId=e,this.sectionedItems[r.Excluded]=new d.RemappedSelectionListWrapper(e),this.sectionedItems[r.Included]=new d.RemappedSelectionListWrapper(e),t&&this.setupListeners())},t.prototype.getElementId=function(){return this.elementId},t.prototype.setIsItemClipped=function(e,t){if(e){var i=(0,E.getActiveViewer)(),r=i.getModelViewManagers().getManager(),n=(0,a.isInAssemblyElement)()?r.getDisplayedAssembly():r.getDisplayedInContextAssembly(),o=!1;if(n){var s=e.getOccurrence();s&&(n.setAllLeafOccurrencesClippedForOccurrence(s,t),o=!0)}(0,a.isInPartStudioElement)()&&!o&&r.getDisplayedPartStudio().getBodyComponent().setIsBodyClippedBySectionPlane(e.getBodyId(),t,!1,this.getHasEligibleCompositeParts()?this.getSectionedItemsAsSetOfBodyIds():null),i.requestDraw()}},t.prototype.getHasEligibleCompositeParts=function(e){return e=null!=e?e:this.currentSectionedItemType,this.eligibleCompositeParts[e].size>0},t.prototype.addSectionedItem=function(e,t){var i,r;""!==this.getElementId()?(null==t&&(t=this.currentSectionedItemType),null===(i=this.getSectionedItems(t))||void 0===i||i.add(e),t===this.currentSectionedItemType&&this.setIsItemClipped(e,!this.getIsExcludingItemsForSection()),(null===(r=e.getBodyMetaData())||void 0===r?void 0:r.isNonGroupingCompositeBody)&&this.eligibleCompositeParts[t].add(e.getBodyId()),P=!0):u.log.warn("SectionViewState.addSectionedItem used without initializing via setElementId")},t.prototype.removeSectionedItem=function(e,t){var i,r;""!==this.getElementId()?(null==t&&(t=this.currentSectionedItemType),(null===(i=this.getSectionedItems(t))||void 0===i?void 0:i.remove(e))&&(t===this.currentSectionedItemType&&this.setIsItemClipped(e,this.getIsExcludingItemsForSection()),(null===(r=e.getBodyMetaData())||void 0===r?void 0:r.isNonGroupingCompositeBody)&&this.eligibleCompositeParts[t].delete(e.getBodyId()),P=!0)):u.log.warn("SectionViewState.removeSectionedItem used without initializing via setElementId")},t.prototype.getSectionedItems=function(e){return""===this.getElementId()?(u.log.error("SectionViewState.getSectionedItems used without initializing via setElementId"),null):(null==e&&(e=this.currentSectionedItemType),this.sectionedItems[e]?this.sectionedItems[e].selections:null)},t.prototype.getSectionedItemsAsSetOfBodyIds=function(e){var t=new Set,i=this.getSectionedItems();return i&&i.forEach((function(i){!i||e&&i.getOccurrence()||t.add(i.getBodyId())})),t},t.prototype.getSectionedItemsAsSetOfOccurrencePaths=function(){var e=new Set,t=this.getSectionedItems();return t&&t.forEach((function(t){var i=t.getOccurrence();i&&e.add(i.getPathAsString())})),e},t.prototype.resetSectionedItems=function(e,t){var i=this;if(""!==this.getElementId()){for(var r=new h.SelectionList(e),n=this.getSectionedItems(t),o=n.length-1;o>=0;--o){var s=n.at(o);r.has(s)||this.removeSectionedItem(s,t)}r.forEach((function(e){n.has(e)||i.addSectionedItem(e,t)}))}else u.log.warn("SectionViewState.resetSectionedItems used without initializing via setElementId")},t.prototype.destroy=function(){H(!1),this.destroySectionedItems()},t.copy=function(e,t,i){var n,o;e&&t&&(t.sectionPlanes=e.sectionPlanes,t.currentSectionedItemType=e.currentSectionedItemType,""!==e.getElementId()&&(t.elementId="",t.setElementId(e.getElementId(),i),null===(n=t.getSectionedItems(r.Excluded))||void 0===n||n.reset(e.getSectionedItems(r.Excluded).toArray()),null===(o=t.getSectionedItems(r.Included))||void 0===o||o.reset(e.getSectionedItems(r.Included).toArray()),t.eligibleCompositeParts[r.Excluded]=new Set(e.eligibleCompositeParts[r.Excluded]),t.eligibleCompositeParts[r.Included]=new Set(e.eligibleCompositeParts[r.Included])))},t.prototype.clone=function(e){var i=new t;return t.copy(this,i,e),i},t.prototype.setFrom=function(e,i){if(!e)return!1;t.copy(e,this,i);var r=this.sectionPlanes.length>0;return r&&(P=!0,this.sectionPlanes.forEach((function(e){e.viewer.getEventDispatcher().trigger(g.SECTION_PLANE_ADDED,e)}))),r},t.prototype.getSectionedItemsSize=function(e){var t,i;return""===this.getElementId()?(u.log.warn("SectionViewState.getSectionedItemsSize used without initializing via setElementId"),0):null!==(i=null===(t=this.getSectionedItems(e))||void 0===t?void 0:t.length)&&void 0!==i?i:0},t}(o.BackboneEventsBaseClass);t.SectionViewState=D;var C=new D;t.getActiveSectionViewState=function(){return C};var O=c.mat4.create(),A=c.mat4.create(),R=c.mat4.create(),N=[];function w(){var e=[];return C.getSectionPlanes().forEach((function(t){var i={};i.center=c.vec3.create(t.center),i.tangent=c.vec3.create(t.tangent),i.normal=c.vec3.create(t.normal),e.push(i)})),e}t.getCurrentSectionPlaneParameters=w;t.getPlaneIndexToAlignNormalTo=function(e){var t=-1,i=-1;return C.getSectionPlanes().forEach((function(r,n){!1!==e&&r.isPreSelected?t=-1===t?n:-2:r.isSelected&&(i=-1===i?n:-2)})),t>-1?t:i>-1?i:-1},t.areAnySectionPlanesSelectedOrPreselected=function(){for(var e=C.getSectionPlanes(),t=0;t<e.length;t++){var i=e[t];if(i.isSelected||i.isPreSelected)return!0}return!1},t.getActiveSectionPlane=function(e){var t=C.getSectionPlanes();return(e<0||e>=t.length)&&u.log.warn("attempting to retrieve a section plane with an invalid index"),t[e]},t.forEachActiveSectionPlane=function(e,t){C.getSectionPlanes().forEach(e,t)},t.filterActiveSectionPlanes=function(e,t){return C.getSectionPlanes().filter(e,t)},t.getSectionPlaneOccurrenceIds=function(){var e=[];return C.getSectionPlanes().forEach((function(t){e.push(t.graphicsOccurrenceId)})),e},t.makePlaneEquationMatrixDirty=function(){_=-1};var b=S.getNumber("SECTION_PLANE_ENDCAP_ORTHOGRAPHIC_Z_FIGHTING_FACTOR"),L=S.getNumber("SECTION_PLANE_ENDCAP_PERSPECTIVE_Z_FIGHTING_FACTOR"),F=S.getNumber("SECTION_PLANE_INTER_ENDCAP_Z_FIGHTING_FACTOR"),B=!1;t.setForcePredictableHatching=function(e){B=e},t.updateShaderClippingUniforms=function(e,t,i){var r=e.getRenderContext(),n=r.getActiveShader(),o=C.getSectionPlanes();if(t&&e.areSectionPlanesEnabled()&&0!==o.length){!function(e,t){if(t||_!==e.getFrameId()){var i,r,n=C.getSectionPlanes();for(i=0;i<n.length;++i){var o=n[i].getCameraSpaceCenter(e.modelViewMatrix),s=n[i].getCameraSpacePlaneEquation(e.modelViewMatrix,o),a=n[i].getCameraSpaceTangent(e.modelViewMatrix);for(r=0;r<4;++r)O[4*r+i]=s[r],R[4*r+i]=a[r];for(r=0;r<3;++r)A[4*r+i]=o[r]}t||(_=e.getFrameId())}}(r,i),n.uniformMatrix4fv("uSectionPlaneEquations",!1,O),n.uniform1f("uSectionPlaneCount",o.length);var s=r.getActiveCamera(),a=s.getFarDepth()-s.getNearDepth(),c=a*(s.isOrthographic()?b:L),l=a*F;n.uniform1f("uEndcapZFightingThreshold",c),n.uniform1f("uInterEndcapZFightingThreshold",l),n.uniform1f("uUseOccurrenceIdForHatchOffset",B?0:1)}else n.uniform1f("uSectionPlaneCount",0)},t.updateShaderEndcapUniforms=function(e,t){var i=C.getSectionPlanes();if(!(t<0||i.length<=t)){var r=e.getActiveShader();r.uniformMatrix4fv("uSectionPlaneCenters",!1,A),r.uniformMatrix4fv("uSectionPlaneTangents",!1,R)}},t.updateShaderEndcapPickingUniforms=function(e,t){var i=C.getSectionPlanes();if(!(t<0||i.length<=t)){var r=i[t],n=e.getActiveShader();n.uniform1f("uOccurrenceId",r.graphicsOccurrenceId);for(var o=[0,0,0,0],s=0;s<i.length;++s)o[s]=i[s].isHiddenFromPick?1:0;n.uniform4fv("uSectionPlaneIsHiddenFromPick",o)}},t.updateShaderEndcapPatternUniforms=function(e,t){var i=C.getSectionPlanes();if(!(t<0||i.length<=t)){var r=i[t],n=e.getActiveShader();n.uniform1f("uSectionPlaneIsPreSelected",r.isPreSelected?1:0),n.uniform1f("uSectionPlaneIsSelected",r.isSelected?1:0),n.uniform4fv("uSectionPlanePreSelectColor",S.getColor("SECTION_PLANE_PRE_HIGHLIGHT_COLOR")),n.uniform4fv("uSectionPlaneSelectColor",S.getColor("ENTITY_HIGHLIGHT_COLOR1")),n.uniform4fv("uSectionPlaneIntersectingColor",S.getColor("SECTION_PLANE_INTERSECTING_COLOR"));var o=S.getColor("SECTION_PLANE_SELECTOR_COLOR_0"),s=S.getColor("SECTION_PLANE_SELECTOR_COLOR_1"),a=S.getColor("SECTION_PLANE_SELECTOR_COLOR_2"),l=S.getColor("SECTION_PLANE_SELECTOR_COLOR_3");n.uniformMatrix4fv("uSectionPlaneSelectorColor",!1,c.mat4.createFrom(o[0],s[0],a[0],l[0],o[1],s[1],a[1],l[1],o[2],s[2],a[2],l[2],o[3],s[3],a[3],l[3]));var u=e.getActiveCamera();if(u.isPerspective()){var h=u.getSceneBounds().diameter(),d=(u.distanceToCenter()+.5*h)/u.getViewportHeight();n.uniform1f("uSectionPlanePatternScale",d*S.getNumber("SECTION_PLANE_PERSPECTIVE_PATTERN_SCALE"))}else{var g=1/(u.projectionMatrix[5]*u.getViewportHeight());n.uniform1f("uSectionPlanePatternScale",g*S.getNumber("SECTION_PLANE_ORTHOGRAPHIC_PATTERN_SCALE"))}n.uniform1f("uSectionPlanePatternFade",S.getNumber("SECTION_PLANE_PATTERN_FADE")),n.uniform1f("uSectionPlanePatternThickness",S.getNumber("SECTION_PLANE_PATTERN_THICKNESS")),n.uniform1f("uSectionPlanePatternPacingVariation",S.getNumber("SECTION_PLANE_PATTERN_PACING_VARIATION"));var f=0,m=1;switch(e.renderingMode){case p.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED:case p.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE:case p.GBTGraphicsRenderMode.WIREFRAME:case p.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION:f=1;break;case p.GBTGraphicsRenderMode.TRANSLUCENT:m=S.getNumber("TRANSLUCENT_PASS_ALPHA")}n.uniform1f("uSectionPlanePatternIsBlackAndWhite",f),n.uniform1f("uSectionPlaneEndcapAlpha",m),n.uniform1f("uSectionPlaneIsolateContextOpacity",S.getNumber("ISOLATE_CONTEXT_FACE_TRANSPARENCY")),n.uniform1f("uSectionPlaneIntersectingAdditionalAlpha",S.getNumber("SECTION_PLANE_INTERSECTING_ADDITIONAL_ALPHA"))}};var x=function(e){C.getSectionPlanes().length<3?(C.addSectionPlane(e),P=!0,e.viewer.getEventDispatcher().trigger(g.SECTION_PLANE_ADDED,e)):e.viewer.getEventDispatcher().trigger(g.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED)},U=function(e){if(C.getSectionPlanes().length<3){x(e);var t=new y.UISelection(e,f.SECTIONPLANE_SELECTION_ID,"");(0,v.getDrawer)().getUISelectionManager().setSelection(t)}else e.viewer.getEventDispatcher().trigger(g.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED)};function G(e,t,i,r,n){U(new m.SectionPlane(e,t,i,r,n))}function H(e){N=e?w():[],C.getSectionPlanes().forEach((function(e){V(e)})),C.clearSectionPlanes(),P=!0}function V(e){C.removeSectionPlane(e),e.onRemove(),P=!0,e.viewer.getEventDispatcher().trigger(g.SECTION_PLANE_REMOVED,e)}t.getMostRecentActiveSectionPlaneParameters=function(){return N},t.clearSavedSectionPlaneParameters=function(){N=[]},t.setSectionPlaneOnMateConnector=function(e,t,i,r){var n=r.getModelViewManagers().getManager().getMateConnectorGraphics(e,t);if(n){var o=c.vec3.create(n.worldSpacePosition),s=c.mat4.multiplyVec4(n.transform,c.vec4.createFrom(0,0,1,0),c.vec4.create());c.vec4.negate(s),c.quat4.normalize(s);var a=c.mat4.multiplyVec4(n.transform,c.vec4.createFrom(1,0,0,0),c.vec4.create());c.quat4.normalize(a),U(new m.SectionPlane(s,a,o,i,r))}},t.setSectionPlaneOnMatrix=function(e,t,i,r,n){if(t&&!r&&i){var o=c.vec3.createFrom(t[8],t[9],t[10]),s=c.vec3.createFrom(t[0],t[1],t[2]),a=c.vec3.createFrom(t[12],t[13],t[14]),l=c.vec3.dot(o,a)-c.vec3.dot(i.center(),o),u=c.vec3.add(i.center(),c.vec3.scale(o,l,c.vec3.create()),c.vec3.create()),h=(0,v.getDrawer)().getCamera();c.vec3.dot(h.direction,o)<0&&(c.vec3.negate(o),c.vec3.negate(s)),U(new m.SectionPlane(o,s,u,n,e,i.diameter()))}},t.setSectionPlaneWithParameters=G,t.removeSectionPlanes=H,t.removeSectionPlane=V,t.loadSectionPlanesFromParameters=function(e,t,i){H(!1),e.forEach((function(e){G(e.normal,e.tangent,e.center,t,i)}))},t.getSectionPlaneCount=function(){return C.getSectionPlanes().length},t.getSectionedItemsSize=function(){return C.getSectionedItemsSize()},t.isSectionPlaneModeEnabled=function(){return!(0,I.isEmptyObjectOrArray)(C.getSectionPlanes())},t.hideSectionPlaneFromPick=function(e){C.getSectionPlanes().forEach((function(t){t.graphicsOccurrenceId===e&&(t.isHiddenFromPick=!0)}))},t.resetSectionPlanesHiddenFromPick=function(){C.getSectionPlanes().forEach((function(e){e.isHiddenFromPick=!1}))},t.saveAndClearState=function(){var e=C.clone(!1);return C.destroy(),e},t.loadState=function(e){return C.destroy(),C.setFrom(e,!0)};var k=new p.BTGraphicsSectionViewStateData;function W(e){C.getSectionPlanes().forEach((function(t){var i=new p.BTGraphicsSectionPlaneData;i.center.x=t.center[0],i.center.y=t.center[1],i.center.z=t.center[2],i.normal.x=t.normal[0],i.normal.y=t.normal[1],i.normal.z=t.normal[2],i.tangent.x=t.tangent[0],i.tangent.y=t.tangent[1],i.tangent.z=t.tangent[2],e.push(i)}))}function j(){(k=k.clone()).sectionPlanes=[],W(k.sectionPlanes),k.isExcluding=C.getIsExcludingItemsForSection();var e=C.getElementId();return k.elementId=e,e.length>0}function z(e,t){return t?new Promise((function(t){var i=(0,T.createPersistentQueryBTUiSelectionsFromSelectionArray)(C.getSectionedItems(r.Excluded).toArray()),n=(0,T.createPersistentQueryBTUiSelectionsFromSelectionArray)(C.getSectionedItems(r.Included).toArray());Promise.all([i,n]).then((function(i){e.selectionsToExclude=i[0],e.selectionsToInclude=i[1],t()}))})):(e.selectionsToExclude=(0,T.createBTUiSelectionsFromSelectionArray)(C.getSectionedItems(r.Excluded).toArray()),e.selectionsToInclude=(0,T.createBTUiSelectionsFromSelectionArray)(C.getSectionedItems(r.Included).toArray()),null)}function X(e,t,i){var r,n=C.getSectionPlanes();if(e.length===n.length&&e.length>0)for(P=!0,r=0;r<e.length;r++)n[r].center=c.vec4.createFrom(e[r].center.x,e[r].center.y,e[r].center.z,0),n[r].normal=c.vec4.createFrom(e[r].normal.x,e[r].normal.y,e[r].normal.z,0),n[r].tangent=c.vec4.createFrom(e[r].tangent.x,e[r].tangent.y,e[r].tangent.z,0);else for(n.length>0&&H(!1),r=0;r<e.length;r++){var o=c.vec4.createFrom(e[r].center.x,e[r].center.y,e[r].center.z,0),s=c.vec4.createFrom(e[r].normal.x,e[r].normal.y,e[r].normal.z,0),a=c.vec4.createFrom(e[r].tangent.x,e[r].tangent.y,e[r].tangent.z,0);x(new m.SectionPlane(s,a,o,t,i))}}t.getSerializablePlaneData=function(){var e=[];return W(e),e},t.getSerializableSectionViewData=function(){return P&&(j()&&z(k,!1),P=!1),k},t.getSerializableSectionViewDataWithPersistentQueries=function(){var e=null;return P&&j()&&(e=z(k,!0))?e.then((function(){return P=!1,k})):(P=!1,Promise.resolve(k))},t.setFromSerializablePlaneData=X,t.setFromSerializableSectionViewData=function(e,t,i){X(e.sectionPlanes,t,i),function(e,t){var i=C.getElementId();!e||""===e.elementId||""!==i&&e.elementId!==i||(C.setElementId(e.elementId,!0),C.setIsExcludingItemsForSection(e.isExcluding),(0,T.createSelectionsFromBTUiSelectionArrayAsync)(e.selectionsToExclude,t).then((function(e){C.resetSectionedItems(e,r.Excluded)})),(0,T.createSelectionsFromBTUiSelectionArrayAsync)(e.selectionsToInclude,t).then((function(e){C.resetSectionedItems(e,r.Included)})))}(e,i)}},178111:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dumpShader=t.ShaderProgram=t.shaderExistsForId=t.AttributeBinding=t.AttributeNames=t.getShaderIdWithExtension=t.prepareShaderCode=t.NO_SECTION_SHADER_ID_SUFFIX=void 0;var r,n=i(423902),o=i(736202),s=i(663748),a=i(311517),c=i(311611),l=i(7028);function u(e,t){return t?"#define "+e+" 1\n":""}!function(e){e.SKIP_SECTION_PLANES="SKIP_SECTION_PLANES",e.USE_OCCURRENCE_TEXTURE="USE_OCCURRENCE_TEXTURE",e.USE_SECTION_PLANES="USE_SECTION_PLANES",e.USE_VERTEX_HIGHLIGHT_TEXTURE="USE_VERTEX_HIGHLIGHT_TEXTURE"}(r||(r={})),t.NO_SECTION_SHADER_ID_SUFFIX="-nosection";var h,d=null;t.prepareShaderCode=function(e,i){if((!d||i)&&l.shadersGlsl){var n=(0,o.clone)(l.shadersGlsl);for(var s in n){for(var c=n[s],h=/{{{.*}}}/g,p=0,g=h.exec(c);g;){var f=g[0].substr(3,g[0].length-6);if(n.hasOwnProperty(f)){var m=g.index+g[0].length;c=c.substr(0,g.index)+n[f]+c.substr(m,c.length-m),++p>100&&a.log.warn("Encountered a large number of includes while substituting shader "+s+". An include cycle may have been introduced."),h.lastIndex=0,g=h.exec(c)}else a.log.warn("Missing shader include: "+f)}n[s]=c}d={};for(var y=u(r.USE_SECTION_PLANES,e.supportsGraphicalSectionPlanes()),v=(y+=u(r.USE_VERTEX_HIGHLIGHT_TEXTURE,e.areHighlightVertexTexturesSupported()))+u(r.SKIP_SECTION_PLANES,!0),E=Object.keys(n),I=0;I<E.length;++I){c=n[s=E[I]];if(d[s]=y+c,s.startsWith("fs-")&&-1!==c.indexOf("discardIfPositionFails")){d[s+t.NO_SECTION_SHADER_ID_SUFFIX]=v+c;var T="v"+s.substr(1,s.length);T in n&&(d[T+t.NO_SECTION_SHADER_ID_SUFFIX]=v+n[T])}}}},t.getShaderIdWithExtension=function(e,i){var r=e.indexOf(t.NO_SECTION_SHADER_ID_SUFFIX);return r<0?e+"-"+i:e.substr(0,r)+"-"+i+t.NO_SECTION_SHADER_ID_SUFFIX},function(e){e.POSITION="aVertexPosition",e.NORMAL="aVertexNormal",e.OFFSET_VECTOR="aOffsetVector",e.COLOR="aVertexColor",e.PICKING="aPickId",e.TEXTURE="aTextureCoordinate",e.HIGHLIGHT_ID="aHighlightId",e.POINT_DATA="aPointData",e.EDGE_DATA="aEdgeData",e.PRIMITIVE_SIZE="aPrimitiveSize",e.PRIMITIVE_STYLE="aPrimitiveStyle",e.PRIMITIVE_RESTART="aPrimitiveRestart",e.OCCURRENCE_ID="aOccurrenceId",e.OCCURRENCE_DATA0="aOccurrenceData0",e.OCCURRENCE_DATA1="aOccurrenceData1",e.OCCURRENCE_DATA2="aOccurrenceData2"}(h=t.AttributeNames||(t.AttributeNames={}));var p=function(){function e(e,t,i,r,n){this.type=e,this.size=t,this.offset=i,this.stride=r,this.normalize=void 0!==n&&n}return e.prototype.clone=function(){return new e(this.type,this.size,this.offset,this.stride,this.normalize)},e}();t.AttributeBinding=p,t.shaderExistsForId=function(e){var t="vs"+e,i="fs"+e;return d.hasOwnProperty(t)&&d.hasOwnProperty(i)};var g=function(e){function t(t,i){var r=e.call(this)||this;return r.viewer=t,r.id=i,r.vertexShader=null,r.fragmentShader=null,r.shaderProgram=null,r.uniformLocations={},r.attribLocations={},r.boundTextures={},r.shaderValidated=!1,(0,c.viewerCheck)(t),r.listenTo(r.viewer.getEventDispatcher(),c.GL_CONTEXT_LOST,r.onGlContextLost),r.listenTo(r.viewer.getEventDispatcher(),c.GL_CONTEXT_RESTORED,r.onGlContextRestored),r.listenTo(r.viewer.getEventDispatcher(),c.SESSION_ENDED,r.destroy),r.reinitialize(),r}return(0,n.__extends)(t,e),t.prototype.getId=function(){return this.id},t.prototype.destroy=function(){this.stopListening(),this.clearGlReferences()},t.prototype.clearGlReferences=function(){this.shaderValidated=!1,this.shaderProgram=null,this.vertexShader=null,this.fragmentShader=null,this.uniformLocations={},this.attribLocations={}},t.prototype.onGlContextLost=function(){this.clearGlReferences()},t.prototype.onGlContextRestored=function(){this.reinitialize()},t.prototype.reinitialize=function(){this.initializationFailed||(this.clearGlReferences(),this.viewer.getGlContext()&&(this.shaderProgram=this.initProgram()),this.unbindTextures())},t.prototype.equals=function(e){return null!==e&&this.id===e.id},t.prototype.deactivate=function(){for(var e in this.attribLocations)this.enableVertexAttribArray(e,!1);this.unbindTextures()},t.prototype.unbindTextures=function(){for(var e in this.boundTextures)(0,c.unbindTexture)(this.viewer,e);this.boundTextures={}},t.prototype.makeShader=function(e,t){var i=d[e];if(!i||i.length<1)return a.log.warn('Shader "'+e+'" not found'),null;var r=this.viewer.getGlContext();if(!r)return null;var n=r.createShader(t);return r.shaderSource(n,i),r.compileShader(n),n},t.prototype.getVertexShaderId=function(){return"vs"+this.id},t.prototype.getFragmentShaderId=function(){return"fs"+this.id},Object.defineProperty(t.prototype,"initializationFailed",{get:function(){return this.viewer.badShaders.hasOwnProperty(this.id)},set:function(e){e?this.viewer.badShaders[this.id]=!0:delete this.viewer.badShaders[this.id]},enumerable:!1,configurable:!0}),t.prototype.initProgram=function(){if(this.initializationFailed)return null;var e=this.viewer.getGlContext();if(this.vertexShader=this.makeShader(this.getVertexShaderId(),e.VERTEX_SHADER),this.fragmentShader=this.makeShader(this.getFragmentShaderId(),e.FRAGMENT_SHADER),!this.vertexShader||!this.fragmentShader)return this.initializationFailed=!0,null;var t=e.createProgram();return e.attachShader(t,this.vertexShader),e.attachShader(t,this.fragmentShader),e.bindAttribLocation(t,0,h.POSITION),e.linkProgram(t),t},t.prototype.validateProgram=function(){if(!this.shaderValidated){this.validateShader(this.vertexShader,this.getVertexShaderId()),this.validateShader(this.fragmentShader,this.getFragmentShaderId());var e=this.viewer.getGlContext();try{if(!e.getProgramParameter(this.shaderProgram,e.LINK_STATUS)){this.clearGlReferences();var t=e.getProgramInfoLog(this.shaderProgram);a.log.warn(c.WEBGL_ERROR_LOG_TAG+"Could not link shaders for "+this.id+":\n "+t),f(this.getVertexShaderId()),f(this.getFragmentShaderId()),this.initializationFailed=!0}}catch(e){this.initializationFailed=!0,a.log.warn(c.WEBGL_ERROR_LOG_TAG+"Could not link shaders for "+this.id+", and log info retrieval failed.")}this.shaderValidated=!0}},t.prototype.validateShader=function(e,t){var i=this.viewer.getGlContext();try{e&&i.getShaderParameter(e,i.COMPILE_STATUS)||(a.log.warn(c.WEBGL_ERROR_LOG_TAG+"Error compiling shader "+t+":\n"+i.getShaderInfoLog(e)),f(t))}catch(e){a.log.debug(c.WEBGL_ERROR_LOG_TAG+"Error getting shader info for: "+t+":\n"+e)}},t.prototype.ensureShaderIsInitialized=function(){this.shaderProgram||this.reinitialize()},t.prototype.useShader=function(){this.ensureShaderIsInitialized(),this.validateProgram(),this.viewer.getGlContext().useProgram(this.shaderProgram)},t.prototype.getUniformLocation=function(e){this.ensureShaderIsInitialized();var t=this.uniformLocations[e];return void 0!==t||(t=this.initializationFailed?null:this.viewer.getGlContext().getUniformLocation(this.shaderProgram,e),this.uniformLocations[e]=t),t},t.prototype.hasUniform=function(e){return!!this.getUniformLocation(e)},t.prototype.outputUniforms=function(){var e=this.viewer.getGlContext(),t=e.getProgramParameter(this.shaderProgram,e.ACTIVE_UNIFORMS);if(!isNaN(t)){t=+t.toString(),a.log.debug("Uniforms for shader: "+this.id);for(var i=function(e){for(var t="<",i=0;i<e.length;++i)t+=e[i],i<e.length-1&&(t+=", ");return t+=">"},r=0;r<t;++r){var n=e.getActiveUniform(this.shaderProgram,r);if(n){var o=e.getUniform(this.shaderProgram,this.getUniformLocation(n.name));(o instanceof Float32Array||o instanceof Int32Array||o instanceof Array)&&(o=i(o)),a.log.debug("  Uniform: "+n.name+", size: "+n.size+", type: "+n.type+", value: "+o)}}}},t.prototype.outputAttributes=function(){var e=this.viewer.getGlContext(),t=e.getProgramParameter(this.shaderProgram,e.ACTIVE_ATTRIBUTES);if(!isNaN(t)){var i=["VERTEX_ATTRIB_ARRAY_BUFFER_BINDING","VERTEX_ATTRIB_ARRAY_ENABLED","VERTEX_ATTRIB_ARRAY_SIZE","VERTEX_ATTRIB_ARRAY_STRIDE","VERTEX_ATTRIB_ARRAY_TYPE","VERTEX_ATTRIB_ARRAY_NORMALIZED","CURRENT_VERTEX_ATTRIB"];t=+t.toString(),a.log.debug("Attributes for shader: "+this.id);for(var r=0;r<t;++r){var n=e.getActiveAttrib(this.shaderProgram,r);if(n){var o=this.getAttribLocation(n.name);a.log.debug("  Attribute "+r+": "+n.name+", size: "+n.size+", type: "+n.type),a.log.debug("    Location: "+o),a.log.debug("    Pointer offset: "+e.getVertexAttribOffset(o,e.VERTEX_ATTRIB_ARRAY_POINTER));for(var s=0;s<i.length;++s){var c=i[s],l=e.getVertexAttrib(o,e[c]);"CURRENT_VERTEX_ATTRIB"===c?a.log.debug("    "+c+" : ["+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+"]"):a.log.debug("    "+c+" : "+l)}}}}},t.prototype.getAttribLocation=function(e){this.ensureShaderIsInitialized();var t=this.attribLocations[e];return void 0!==t||(t=this.initializationFailed?-1:this.viewer.getGlContext().getAttribLocation(this.shaderProgram,e),this.attribLocations[e]=t),t},t.prototype.hasAttribute=function(e){return this.getAttribLocation(e)>=0},t.prototype.vertexAttribPointer=function(e,t){var i=this.getAttribLocation(e);i<0||(this.viewer.getGlContext().vertexAttribPointer(i,t.size,t.type,t.normalize,t.stride,t.offset),this.enableVertexAttribArray(e,!0))},t.prototype.enableVertexAttribArray=function(e,t){void 0===t&&(t=!0);var i=this.getAttribLocation(e);i<0||this.viewer.enableVertexAttributeArray(i,t)},t.prototype.useTexture=function(e,t){var i;this.hasUniform(e)&&((i=t instanceof c.Texture?t.updateAndBindTexture(e):(0,c.bindTexture)(this.viewer,t,e))<0?this.useBlankTexture(e):(this.boundTextures[e]=i,this.uniform1i(e,i)))},t.prototype.setAttribute=function(e,t){switch(e.dimension){case 1:this.vertexAttrib1f(e.name,t);break;case 2:this.vertexAttrib2fv(e.name,t);break;case 3:this.vertexAttrib3fv(e.name,t);break;case 4:this.vertexAttrib4fv(e.name,t)}},t.prototype.setFloatUniform=function(e,t){switch(t.length){case 2:this.uniform2fv(e,t);break;case 3:this.uniform3fv(e,t);break;case 4:this.uniform4fv(e,t);break;default:this.uniform1f(e,t)}},t.prototype.useBlankTexture=function(e){if(this.hasUniform(e)){var t=this.viewer.getResources().getBlankTexture().updateAndBindTexture(e);t>=0&&(this.boundTextures[e]=t,this.uniform1i(e,t))}},t.prototype.uniform1f=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1f(i,t)},t.prototype.uniform1fv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1fv(i,t)},t.prototype.uniform1i=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1i(i,t)},t.prototype.uniform1iv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1iv(i,t)},t.prototype.uniform2f=function(e,t,i){var r=this.getUniformLocation(e);null!==r&&this.viewer.getGlContext().uniform2f(r,t,i)},t.prototype.uniform2fv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform2fv(i,t)},t.prototype.uniform2i=function(e,t,i){var r=this.getUniformLocation(e);null!==r&&this.viewer.getGlContext().uniform2i(r,t,i)},t.prototype.uniform2iv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform2iv(i,t)},t.prototype.uniform3f=function(e,t,i,r){var n=this.getUniformLocation(e);null!==n&&this.viewer.getGlContext().uniform3f(n,t,i,r)},t.prototype.uniform3fv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform3fv(i,t)},t.prototype.uniform3i=function(e,t,i,r){var n=this.getUniformLocation(e);null!==n&&this.viewer.getGlContext().uniform3i(n,t,i,r)},t.prototype.uniform3iv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform3iv(i,t)},t.prototype.uniform4f=function(e,t,i,r,n){var o=this.getUniformLocation(e);null!==o&&this.viewer.getGlContext().uniform4f(o,t,i,r,n)},t.prototype.uniform4fv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform4fv(i,t)},t.prototype.uniform4i=function(e,t,i,r,n){var o=this.getUniformLocation(e);null!==o&&this.viewer.getGlContext().uniform4i(o,t,i,r,n)},t.prototype.uniform4iv=function(e,t){var i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform4iv(i,t)},t.prototype.uniformMatrix2fv=function(e,t,i){var r=this.getUniformLocation(e);null!==r&&this.viewer.getGlContext().uniformMatrix2fv(r,t,i)},t.prototype.uniformMatrix3fv=function(e,t,i){var r=this.getUniformLocation(e);null!==r&&this.viewer.getGlContext().uniformMatrix3fv(r,t,i)},t.prototype.uniformMatrix4fv=function(e,t,i){var r=this.getUniformLocation(e);null!==r&&this.viewer.getGlContext().uniformMatrix4fv(r,t,i)},t.prototype.vertexAttrib1f=function(e,t){var i=this.getAttribLocation(e);i<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib1f(i,t))},t.prototype.vertexAttrib1fv=function(e,t){var i=this.getAttribLocation(e);i<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib1fv(i,t))},t.prototype.vertexAttrib2f=function(e,t,i){var r=this.getAttribLocation(e);r<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib2f(r,t,i))},t.prototype.vertexAttrib2fv=function(e,t){var i=this.getAttribLocation(e);i<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib2fv(i,t))},t.prototype.vertexAttrib3f=function(e,t,i,r){var n=this.getAttribLocation(e);n<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib3f(n,t,i,r))},t.prototype.vertexAttrib3fv=function(e,t){var i=this.getAttribLocation(e);i<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib3fv(i,t))},t.prototype.vertexAttrib4f=function(e,t,i,r,n){var o=this.getAttribLocation(e);o<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib4f(o,t,i,r,n))},t.prototype.vertexAttrib4fv=function(e,t){var i=this.getAttribLocation(e);i<0||(this.enableVertexAttribArray(e,!1),this.viewer.getGlContext().vertexAttrib4fv(i,t))},t}(s.BackboneEventsBaseClass);function f(e){var t=d[e];if(!t||t.length<1)a.log.warn('Shader "'+e+'" not found');else{for(var i=t.split("\n"),r=0;r<i.length;++r)i[r]=r+1+": "+i[r];a.log.warn(c.WEBGL_ERROR_LOG_TAG+e+" source:\n"+i.join("\n"))}}t.ShaderProgram=g,t.dumpShader=f},7028:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shadersGlsl=void 0,t.shadersGlsl={blitFunctions:i(937225).Z,compareFunctions:i(986358).Z,depthNormalFunctions:i(836803).Z,edgeFragmentUtilityFunctions:i(348438).Z,edgeUtilityFunctions:i(281075).Z,fragmentCurvatureUtilityFunctions:i(45292).Z,fragmentLightingUtilityFunctions:i(583836).Z,"fs-OITAccumulation":i(575669).Z,"fs-OITComposite":i(507788).Z,"fs-OITRevealage":i(195076).Z,"fs-backfacesil-faces":i(617019).Z,"fs-blitBodyCheck":i(178254).Z,"fs-compareBlend":i(250659).Z,"fs-debugPickPass":i(102008).Z,"fs-depth-edges":i(364973).Z,"fs-depth-faces":i(918348).Z,"fs-depth-points":i(261981).Z,"fs-draftAngle-faces":i(852282).Z,"fs-draftShadow-faces":i(199660).Z,"fs-draw-curvatureVisualization":i(518341).Z,"fs-draw-draftAnalysis":i(483885).Z,"fs-draw-edges":i(88244).Z,"fs-draw-endcap":i(776754).Z,"fs-draw-endcap-depth":i(354850).Z,"fs-draw-faces":i(940092).Z,"fs-draw-faces-simulation":i(52713).Z,"fs-draw-faces-sketches":i(116170).Z,"fs-draw-points":i(912e3).Z,"fs-draw-qualityVisualization":i(136280).Z,"fs-draw-silhouettes":i(31490).Z,"fs-drawTexture":i(941798).Z,"fs-edgeDetect":i(134452).Z,"fs-endcapMask-faces":i(531926).Z,"fs-endcapMask-faces-simulation":i(95879).Z,"fs-gaussianFilter":i(656020).Z,"fs-highlightBuffer-faces":i(93680).Z,"fs-highlightDraw-edges":i(585515).Z,"fs-highlightDraw-points":i(258687).Z,"fs-highlightDraw":i(372112).Z,"fs-highlightMask-faces":i(987239).Z,"fs-normalDepth-faces":i(316038).Z,"fs-normalDepthFilter":i(445279).Z,"fs-normalDepthWithMask-edges":i(195815).Z,"fs-normalDepthWithMask-faces":i(269487).Z,"fs-normalDepthWithMask-points":i(946753).Z,"fs-occlusion":i(662291).Z,"fs-occlusionFilter":i(969630).Z,"fs-pick-alternates-edges":i(872665).Z,"fs-pick-alternates-faces":i(702617).Z,"fs-pick-edges":i(763397).Z,"fs-pick-endcap":i(44074).Z,"fs-pick-faces":i(528910).Z,"fs-pick-points":i(699135).Z,"fs-planeId-faces":i(852630).Z,"fs-previewBlend":i(516864).Z,"fs-retrieveScalar-faces":i(691458).Z,"fs-tintByDepth-edges":i(877220).Z,"fs-tintByDepth-points":i(880178).Z,"fs-tintByNormalDepth-faces":i(67205).Z,"fs-tintByPlaneId-faces":i(336555).Z,getNormalSign:i(307454).Z,highlightFunctions:i(113585).Z,normalDepthWithMaskFunctions:i(268837).Z,picking:i(982090).Z,planeIdFunctions:i(745097).Z,pointFragmentUtilityFunctions:i(977256).Z,sectionPlaneClippingFunctions:i(327877).Z,sectionPlaneConstants:i(316542).Z,sectionPlaneEndcapFunctions:i(908076).Z,sectionPlaneEndcapMedianFilter:i(362713).Z,sectionPlaneEndcapPatternFunctions:i(380102).Z,sectionPlaneFragmentUtilityFunctions:i(157133).Z,undercutWeightFunction:i(440289).Z,utilityFunctions:i(460052).Z,vertexPicking:i(938273).Z,vertexUtilityFunctions:i(720662).Z,"vs-OITAccumulation":i(20078).Z,"vs-OITComposite":i(180569).Z,"vs-OITRevealage":i(823814).Z,"vs-backfacesil-faces":i(117471).Z,"vs-blitBodyCheck":i(424009).Z,"vs-compareBlend":i(655067).Z,"vs-debugPickPass":i(355563).Z,"vs-depth-edges":i(100679).Z,"vs-depth-faces":i(789747).Z,"vs-depth-points":i(509199).Z,"vs-draftAngle-faces":i(292207).Z,"vs-draftShadow-faces":i(372631).Z,"vs-draw-curvatureVisualization":i(871439).Z,"vs-draw-draftAnalysis":i(526498).Z,"vs-draw-edges":i(396329).Z,"vs-draw-endcap":i(131558).Z,"vs-draw-endcap-depth":i(323430).Z,"vs-draw-faces":i(881926).Z,"vs-draw-faces-simulation":i(368599).Z,"vs-draw-faces-sketches":i(745617).Z,"vs-draw-points":i(211242).Z,"vs-draw-qualityVisualization":i(971371).Z,"vs-draw-silhouettes":i(423790).Z,"vs-drawTexture":i(38201).Z,"vs-edgeDetect":i(248781).Z,"vs-endcapMask-faces":i(109228).Z,"vs-endcapMask-faces-simulation":i(395183).Z,"vs-gaussianFilter":i(457825).Z,"vs-highlightBuffer-faces":i(245326).Z,"vs-highlightDraw-edges":i(888625).Z,"vs-highlightDraw-points":i(486577).Z,"vs-highlightDraw":i(879958).Z,"vs-highlightMask-faces":i(869798).Z,"vs-normalDepth-faces":i(844818).Z,"vs-normalDepthFilter":i(410956).Z,"vs-normalDepthWithMask-edges":i(243024).Z,"vs-normalDepthWithMask-faces":i(611707).Z,"vs-normalDepthWithMask-points":i(925733).Z,"vs-occlusion":i(715654).Z,"vs-occlusionFilter":i(85938).Z,"vs-pick-alternates-edges":i(866064).Z,"vs-pick-alternates-faces":i(548097).Z,"vs-pick-edges":i(136569).Z,"vs-pick-endcap":i(437761).Z,"vs-pick-faces":i(666954).Z,"vs-pick-points":i(914267).Z,"vs-planeId-faces":i(97782).Z,"vs-previewBlend":i(470958).Z,"vs-retrieveScalar-faces":i(754198).Z,"vs-tintByDepth-edges":i(581147).Z,"vs-tintByDepth-points":i(213638).Z,"vs-tintByNormalDepth-faces":i(935797).Z,"vs-tintByPlaneId-faces":i(214303).Z,weightFunctions:i(100241).Z}},22789:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Silhouette=void 0;var r=i(423902),n=i(73055),o=i(311611),s=i(474917),a=function(e){function t(t,i){var r=e.call(this,i,o.MAIN_SCENEGRAPH_ID)||this;r.idToSilhouetteInfo={},r.sketchProperties=new o.NodeProperties({isPickable:!0,isShowThrough:!0,isDepthTested:!1,primitiveType:o.PrimitiveType.LINES,zOffset:1}),r.worldProperties=new o.NodeProperties({isPickable:!0,isShowThrough:!0,isDepthTested:!0,primitiveType:o.PrimitiveType.LINES,zOffset:1});var s,a=n.default.getManager();for(r.width=a.getNumber("SKETCH_SILHOUETTE_WIDTH"),r.sketchColor=a.getColor("SKETCH_PREVIEW_COLOR"),r.worldColor=a.getColor("SKETCH_SILHOUETTE_WORLD_COLOR"),r.hoverWidth=a.getNumber("HIGHLIGHT_LINE_WIDTH_MIN"),r.hoverColor=a.getColor("PRE_HIGHLIGHT_COLOR_BORDER"),r.worldStipple=a.getStipple("SKETCH_SILHOUETTE_WORLD_STIPPLE"),s=0;s<t.length;++s){var c=t[s].silhouetteId;r.idToSilhouetteInfo[c]=t[s],r.updateSilhouette(c,!1),r.listenTo(r,o.UiEvents.MOUSE_ENTER+c,r.onMouseEnter),r.listenTo(r,o.UiEvents.MOUSE_LEAVE+c,r.onMouseLeave),r.listenTo(r,o.UiEvents.CLICK+c,r.onMouseClick)}return r}return(0,r.__extends)(t,e),t.prototype.updateAllSilhouettes=function(){var e=this;Object.entries(this.idToSilhouetteInfo).forEach((function(t){var i=(0,r.__read)(t,2),n=i[0];i[1];e.updateSilhouette(n,!1)}))},t.prototype.updateSilhouette=function(e,t){var i=this.idToSilhouetteInfo[e];if(i){(0,o.addColorToIncrement)(t?this.hoverColor:this.worldColor,i.worldMesh),(0,o.addSizeToIncrement)(t?this.hoverWidth:this.width,i.worldMesh),(0,o.addStyleToIncrement)(this.worldStipple,i.worldMesh),this.updateMeshIncrement(e,e,i.worldMesh,this.worldProperties);var r=this.getProjectedMeshId(e),n=(0,o.createMeshIncrementForPolylineLines)(this.viewer,i.sketchPolyline);(0,o.addColorToIncrement)(t?this.hoverColor:this.sketchColor,n),(0,o.addSizeToIncrement)(t?this.hoverWidth:this.width,n),this.updateMeshIncrement(r,e,n,this.sketchProperties)}},t.prototype.getProjectedMeshId=function(e){return e+".ske"},t.prototype.getClearModelSelectionsOnPrehilite=function(){return!1},t.prototype.onMouseEnter=function(e){this.updateSilhouette(e.selectionId,!0),(0,o.requestDraw)()},t.prototype.onMouseLeave=function(e){this.updateSilhouette(e.selectionId,!1),(0,o.requestDraw)()},t.prototype.onMouseClick=function(e){this.trigger(s.bt_graphics_ISilhouette_CLICKED,this,this.idToSilhouetteInfo[e.selectionId].disambiguation,e.selectionId)},t.prototype.removeOtherSilhouettes=function(e){for(var t in this.idToSilhouetteInfo)t!==e&&(this.removeMeshIncrement(this.getProjectedMeshId(e)),delete this.idToSilhouetteInfo[t])},t}(o.UIElement);t.Silhouette=a},450552:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetStaticSilhouetteState=t.SilhouetteTask=t.getSilhouetteIncrement=t.getSilhouettesId=void 0;var r=i(311611),n=i(73055),o=i(376931),s=i(311517),a=i(673290),c=i(911748),l=i(564373),u=n.default.getManager(),h=new Int32Array(0),d=new Float32Array(0),p=new Int32Array(0),g=0,f=0,m=1024*u.getNumber("MAX_EDGE_BASED_SILHOUETTE_MEMORY_USE_MB")*1024;function y(){return f>=m}var v=0,E=[],I=function(e,t,i,r,n,s,l,u,h,d,p,g,f){var m=e.normals[3*p+0],y=e.normals[3*p+1],v=e.normals[3*p+2],E=e.normals[3*g+0],I=e.normals[3*g+1],T=e.normals[3*g+2],S=e.normals[3*f+0],P=e.normals[3*f+1],_=e.normals[3*f+2],M=(0,o.crossProduct)(u-n,h-s,d-l,n-t,s-i,l-r);c.vec3.normalize(M);var D=m*M[0]+y*M[1]+v*M[2];D<0&&(c.vec3.negate(M),D*=-1);var C=E*M[0]+I*M[1]+T*M[2],O=S*M[0]+P*M[1]+_*M[2],A=a.Tolerances.FACE_NORMAL_IS_BAD;return(D<A||C<A||O<A)&&c.vec3.setXYZ((m+E+S)/3,(y+I+P)/3,(v+T+_)/3,M),M},T=function(e,t,i,r,n,o,s){var a,c=s[a=t<i?t+"__"+i:i+"__"+t],l=0;void 0!==c?(l=h[c],h[c]=l+1):(c=g,s[a]=c,p[2*c+0]=r,p[2*c+1]=n,h[c]=1,g++),l<2&&(d[6*c+3*l+0]=o[0],d[6*c+3*l+1]=o[1],d[6*c+3*l+2]=o[2])},S=function(e,t,i,r,n){var o=c.vec3.subtract(t,e,n);c.vec3.normalize(o),o=c.vec3.cross(o,i,o);var s=Math.atan2(i[1],i[0]),a=c.vec2.length(i),l=Math.atan2(i[2],a),u=c.vec3.dot(i,r),h=c.vec3.dot(o,r),d=Math.atan2(h,u);c.vec3.setXYZ(s,l,d,n)},P=function(e,t){if(e.indices.length<3||e.indices.length>u.getNumber("MAX_SINGLE_SILHOUETTE_INCREMENT_SIZE"))return null;!function(e){g=0;var t=2*e;h.length<t&&(h=new Int32Array(t),d=new Float32Array(6*t),p=new Int32Array(2*t))}(e.indices.length);for(var i={},n=function(t,r,n){return function(t,i){return c.vec3.setXYZ(e.points[3*t+0],e.points[3*t+1],e.points[3*t+2],i)}(p[2*i[t]+r],n)},o=function(e,t,r){var n=i[e];c.vec3.setXYZ(d[6*n+3*t+0],d[6*n+3*t+1],d[6*n+3*t+2],r)},a=2;a<e.indices.length;++a){var m=e.indices[a-2],v=e.indices[a-1],E=e.indices[a];if(!(m===v||v===E||m===E)){var P=e.points[3*m+0],_=e.points[3*m+1],M=e.points[3*m+2],D=(0,r.hashXYZ)(P,_,M),C=e.points[3*v+0],O=e.points[3*v+1],A=e.points[3*v+2],R=(0,r.hashXYZ)(C,O,A),N=e.points[3*E+0],w=e.points[3*E+1],b=e.points[3*E+2],L=(0,r.hashXYZ)(N,w,b),F=I(e,P,_,M,C,O,A,N,w,b,m,v,E);T(0,D,R,m,v,F,i),T(0,R,L,v,E,F,i),T(0,D,L,m,E,F,i)}}var B=function(e){return 2===h[i[e]]},x=[];for(var U in i)B(U)&&x.push(U);var G=x.length;if(0===G)return null;for(var H=new Float32Array(6*G),V=new Int32Array(2*G),k=new Float32Array(6*G),W=c.vec3.create(),j=c.vec3.create(),z=c.vec3.create(),X=c.vec3.create(),q=c.vec3.create(),Y=0;Y<G;++Y){var Z=x[Y];n(Z,0,W),n(Z,1,j),o(Z,0,z),o(Z,1,X),S(W,j,z,X,q),V[2*Y]=2*Y,V[2*Y+1]=2*Y+1;for(a=0;a<3;++a)H[6*Y+a]=W[a],H[6*Y+3+a]=j[a],k[6*Y+a]=q[a],k[6*Y+3+a]=q[a]}var K=new r.MeshIncrement(r.PrimitiveType.SILHOUETTES,H,V,t,!0);K.normals=k,K.prepareForBuffering();var Q=!y();return f+=e.getTriangleCount()*l.GBTTessellationSetting.SILHOUETTE_BYTES_PER_TRIANGLE,Q&&y()&&s.log.info("Edge-based silhouette memory use exhausted"),K};function _(e,t){return e.getFullId()+"_"+t}var M=function(e,t,i){this.parentIncrement=e,this.usage=t,this.callback=i,this.key=_(e,t),this.id=++v;var r=this.parentIncrement.getBounds();this.bboxDiameter=r.diameter()},D=function(e,t){this.parentIncrementGuid=e,this.silhouetteIncrement=t};function C(e){return e+"_siledges"}function O(e){var t=e.getGloballyUniqueId(),i=function(e){for(var t=E.length-1;t>=0;--t)if(E[t].parentIncrementGuid===e)return E[t];return null}(t),r=null;if(i)r=i.silhouetteIncrement;else{var n=C(e.id);(r=P(e,n))&&function(e){E.length>=100&&E.shift(),E.push(e)}(new D(t,r))}return r}t.getSilhouettesId=C,t.getSilhouetteIncrement=O;var A=function(){function e(e){this.viewer=e,this.silhouetteIncrementToRequest={},this.silhouetteRequestQueue=[],this.silhouetteRequestQueueIsSorted=!1}return e.prototype.process=function(e){if(this.hasPendingWork())for(this.silhouetteRequestQueueIsSorted||(this.silhouetteRequestQueue.sort((function(e,t){return t.bboxDiameter-e.bboxDiameter})),this.silhouetteRequestQueueIsSorted=!0);this.silhouetteRequestQueue.length>0;){var t=this.silhouetteRequestQueue.shift();if(this.silhouetteIncrementToRequest[t.key]===t.id&&(delete this.silhouetteIncrementToRequest[t.key],!y())){var i=O(t.parentIncrement);if(i&&(e&&e.addVertexCost(i.vertexCount()),t.callback(t.parentIncrement,i)),e&&e.budgetExceeded())break}}},e.prototype.hasPendingWork=function(){return this.silhouetteRequestQueue.length>0},e.prototype.postSilhouetteRequest=function(e,t,i){if(this.viewer.areEdgeSilhouettesEnabled()&&!y()){var r=new M(e,t,i);this.silhouetteRequestQueue.push(r),this.silhouetteRequestQueueIsSorted=!1,this.silhouetteIncrementToRequest[r.key]=r.id}},e.prototype.clearPendingRequests=function(){this.silhouetteRequestQueue=[]},e.prototype.clearPendingRequestsForUsage=function(e){for(var t=[],i=0;i<this.silhouetteRequestQueue.length;++i){var r=this.silhouetteRequestQueue[i];r.usage!==e&&t.push(r)}this.silhouetteRequestQueue=t,this.silhouetteRequestQueue=this.silhouetteRequestQueue.filter((function(t){return t.usage!==e}))},e.prototype.removePendingRequest=function(e,t){delete this.silhouetteIncrementToRequest[_(e,t)]},e}();t.SilhouetteTask=A,t.resetStaticSilhouetteState=function(){E=[]}},925037:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sketch=void 0;var r=i(311517),n=i(311611),o=i(726542),s=i(911748),a=i(699716),c=function(){function e(e,t,i){this.viewer=i,this.dragItems=null,this.dragSequenceId=1,this.id=e,this.planeMatrix=s.mat4.identity(),this.planeMatrixrixInverse=s.mat4.create(),this.appliedTransform=s.mat4.identity(),this.computedPlaneMatrix=s.mat4.identity(),this.computedInverse=s.mat4.identity(),t?(this.planeMatrix[0]=t.m00,this.planeMatrix[1]=t.m10,this.planeMatrix[2]=t.m20,this.planeMatrix[3]=0,this.planeMatrix[4]=t.m01,this.planeMatrix[5]=t.m11,this.planeMatrix[6]=t.m21,this.planeMatrix[7]=0,this.planeMatrix[8]=t.m02,this.planeMatrix[9]=t.m12,this.planeMatrix[10]=t.m22,this.planeMatrix[11]=0,this.planeMatrix[12]=t.m03,this.planeMatrix[13]=t.m13,this.planeMatrix[14]=t.m23,this.planeMatrix[15]=1):r.log.info("invalid plane definition"),this.planeMatrixrixInverse=s.mat4.set(this.planeMatrix,this.planeMatrixrixInverse),s.mat4.inverse(this.planeMatrixrixInverse),this.startPt=s.vec3.create(),this.endPt=s.vec3.create(),this.p0=new Float32Array(4),this.p1=new Float32Array(4),this.p2=new Float32Array(4),this.p3=new Float32Array(4),this.updateComputedTransforms()}return e.prototype.updateComputedTransforms=function(){return s.mat4.multiply(this.appliedTransform,this.planeMatrix,this.computedPlaneMatrix),s.mat4.inverse(s.mat4.multiply(this.appliedTransform,this.planeMatrix,this.computedInverse))},e.prototype.getId=function(){return this.id},e.prototype.getAppliedTransform=function(){return this.appliedTransform},e.prototype.getPlaneMatrix=function(){return this.computedPlaneMatrix},e.prototype.getPlaneMatrixInverse=function(){return this.computedInverse},e.prototype.setAppliedTransform=function(e){this.appliedTransform=e,this.updateComputedTransforms()},e.prototype.startPointScreen=function(e){this.startPt=this.toWorld(e)},e.prototype.endPointScreen=function(e){this.endPt=this.toWorld(e)},e.prototype.resetState=function(){this.entityIds=null,this.dragItems=null},e.prototype.toPlane=function(e){var t=this.toWorld(e);if(!t)return null;var i=new Float32Array(4),r=new Float32Array(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1,[(i=s.mat4.multiplyVec4(this.getPlaneMatrixInverse(),r,i))[0],i[1],i[2]]},e.prototype.toWorld=function(e){var t=this.viewer.getPrimaryViewController().camera.getRay(e[0],e[1]);return(0,n.intersectRayPlaneMatrix)(t,this.getPlaneMatrix())},e.prototype.getCanvasCoordinates=function(e){var t=this.viewer.getCamera(),i=this.planeToWorld(e),r=t.projectWorldPointToCanvas(i);return s.vec3.scale(r,1/(0,a.getDevicePixelRatio)())},e.prototype.planeVec4ToWorld=function(e){var t=s.vec4.create();return[(t=s.mat4.multiplyVec4(this.getPlaneMatrix(),e,t))[0],t[1],t[2]]},e.prototype.planeToWorld=function(e){return this.planeVec4ToWorld(s.vec4.createFrom(e[0],e[1],0,1))},e.prototype.planeVectorToWorld=function(e){return this.planeVec4ToWorld(s.vec4.createFrom(e[0],e[1],e[2],0))},e.prototype.worldToPlane=function(e){var t=new Float32Array(4),i=new Float32Array(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1,[(t=s.mat4.multiplyVec4(this.getPlaneMatrixInverse(),i,t))[0],t[1],t[2]]},e.prototype.getSketchNormal=function(){var e=[],t=this.getPlaneMatrix();return e[2]=t[10],e[1]=t[9],e[0]=t[8],e},e.prototype.createIncludeNonParallelPlaneFilter=function(){var e=this.getSketchNormal();return(0,o.makePlaneOrientationFilter)(e)},e}();t.Sketch=c},770188:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deselectEntities=t.createInferenceIcon=t.View=t.OFFSET_DIRECTION_PIXEL_TOLERANCE=t.IconData=t.MAX_COLLAPSED_ICONS=t.ELLIPSIS_ID=void 0;var r=i(423902),n=i(514194),o=i(73055),s=i(911748),a=i(311517),c=i(637963),l=i(507025),u=i(712197),h=i(227441),d=i(302288),p=i(736202),g=i(623639),f=i(311611);t.ELLIPSIS_ID="ellipsis",t.MAX_COLLAPSED_ICONS=5;var m=g.IconSelectionType,y={};y[h.GBTSketchConstraintSolveStatus.BAD]="BAD",y[h.GBTSketchConstraintSolveStatus.DRIVEN]="OK",y[h.GBTSketchConstraintSolveStatus.SOLVED]="OK";var v={};v[m.SELECTED]="SELECTED_COLOR",v[m.PREHILITE]="PREHILITE_COLOR",v[m.MUTED]="MUTED_COLOR",v[m.NOT_SELECTED]="COLOR";var E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.defaults=function(){return{id:"",selectionId:"",selected:g.IconSelectionType.NOT_SELECTED,constraintType:h.GBTConstraintType.UNKNOWN,solveStatus:h.GBTSketchConstraintSolveStatus.SOLVED}},t}(n.Model);t.IconData=E,t.OFFSET_DIRECTION_PIXEL_TOLERANCE=1;var I=function(e,t,i,r){switch(t){case h.GBTSketchConstraintSolveStatus.BAD:e+=":od";break;case h.GBTSketchConstraintSolveStatus.DRIVEN:e+=":dr"}return i===g.IconSelectionType.SELECTED?e+=":s":i===g.IconSelectionType.PREHILITE?e+=":h":i===g.IconSelectionType.MUTED&&(e+=":m"),r&&(e+=":ex"),e},T=function(e,t,i,r){var n;switch(e){case h.GBTConstraintType.QUADRANT:n="qad";break;case h.GBTConstraintType.COINCIDENT:n="coi";break;case h.GBTConstraintType.PARALLEL:n="par";break;case h.GBTConstraintType.VERTICAL:n="ver";break;case h.GBTConstraintType.HORIZONTAL:n="hoz";break;case h.GBTConstraintType.PERPENDICULAR:n="prp";break;case h.GBTConstraintType.CONCENTRIC:n="con";break;case h.GBTConstraintType.MIDPOINT:n="mid";break;case h.GBTConstraintType.TANGENT:n="tan";break;case h.GBTConstraintType.PIERCE:n="prc";break;case h.GBTConstraintType.EQUAL:n="equ";break;case h.GBTConstraintType.NORMAL:n="nor";break;case h.GBTConstraintType.FIX:n="fix";break;case h.GBTConstraintType.PROJECTED:case h.GBTConstraintType.SILHOUETTED:n="prj";break;case h.GBTConstraintType.OFFSET:n="off";break;case h.GBTConstraintType.MIRROR:n="mir";break;case h.GBTConstraintType.CIRCULAR_PATTERN:n="cpt";break;case h.GBTConstraintType.LINEAR_PATTERN:n="lin";break;case h.GBTConstraintType.INTERSECTED:n="int";break;case h.GBTConstraintType.EQUAL_CURVATURE:n="cur";break;default:n="???",a.log.error("Found a constraint with no atlas key.")}return I(n,t,i,r)},S=function(e,t,i,r,n){var s=o.default.getManager(),a=new f.ImageData;a.id=e;var c="CONSTRAINT_"+(y[t]||"OK")+"_"+(v[i]||"COLOR");return r&&(c+="_EXTERNAL"),a.backgroundColor=s.getString(c),a.imageName=n,a},P=function(e,t,i,r,n){r.forEach((function(r){for(var o=0;o<2;o++){var s=1===o;n.push(S(T(e,t,r,s),t,r,s,i))}}))},_=function(e){var t=[],i=[g.IconSelectionType.NOT_SELECTED,g.IconSelectionType.PREHILITE,g.IconSelectionType.SELECTED,g.IconSelectionType.MUTED],n={"Sketch_Constraints_Grayscale_2_Coincident.png":h.GBTConstraintType.COINCIDENT,"Sketch_Constraints_Grayscale_2_Parallel.png":h.GBTConstraintType.PARALLEL,"Sketch_Constraints_Grayscale_2_Vertical.png":h.GBTConstraintType.VERTICAL,"Sketch_Constraints_Grayscale_2_Horizontal.png":h.GBTConstraintType.HORIZONTAL,"Sketch_Constraints_Grayscale_2_Perpendicular.png":h.GBTConstraintType.PERPENDICULAR,"Sketch_Constraints_Grayscale_2_Concentric.png":h.GBTConstraintType.CONCENTRIC,"Sketch_Constraints_Grayscale_2_Midpoint.png":h.GBTConstraintType.MIDPOINT,"Sketch_Constraints_Grayscale_2_Tangent.png":h.GBTConstraintType.TANGENT,"Sketch_Constraints_Grayscale_2_Equal.png":h.GBTConstraintType.EQUAL,"Sketch_Constraints_Grayscale_2_Normal.png":h.GBTConstraintType.NORMAL,"Sketch_Constraints_Grayscale_2_Fix.png":h.GBTConstraintType.FIX,"Sketch_Constraints_Grayscale_2_Use.png":h.GBTConstraintType.PROJECTED,"Sketch_Constraints_Grayscale_2_Offset.png":h.GBTConstraintType.OFFSET,"Sketch_Constraints_Grayscale_2_Mirror.png":h.GBTConstraintType.MIRROR,"Sketch_Constraints_Grayscale_2_CircularPattern.png":h.GBTConstraintType.CIRCULAR_PATTERN,"Sketch_Constraints_Grayscale_2_LinearPattern.png":h.GBTConstraintType.LINEAR_PATTERN,"Sketch_Constraints_Grayscale_2_Pierce.png":h.GBTConstraintType.PIERCE,"Sketch_Constraints_Grayscale_2_Quadrant.png":h.GBTConstraintType.QUADRANT,"Sketch_Constraints_Grayscale_2_Intersection.png":h.GBTConstraintType.INTERSECTED,"Sketch_Constraints_Grayscale_2_Curvature.png":h.GBTConstraintType.EQUAL_CURVATURE};Object.entries(n).forEach((function(e){var n=(0,r.__read)(e,2),o=n[0],s=n[1];P(s,h.GBTSketchConstraintSolveStatus.SOLVED,o,i,t)}));var s={"Sketch_Constraints_OverDefined_Coincident.png":h.GBTConstraintType.COINCIDENT,"Sketch_Constraints_OverDefined_Parallel.png":h.GBTConstraintType.PARALLEL,"Sketch_Constraints_OverDefined_Vertical.png":h.GBTConstraintType.VERTICAL,"Sketch_Constraints_OverDefined_Horizontal.png":h.GBTConstraintType.HORIZONTAL,"Sketch_Constraints_OverDefined_Perpendicular.png":h.GBTConstraintType.PERPENDICULAR,"Sketch_Constraints_OverDefined_Concentric.png":h.GBTConstraintType.CONCENTRIC,"Sketch_Constraints_OverDefined_Midpoint.png":h.GBTConstraintType.MIDPOINT,"Sketch_Constraints_OverDefined_Tangent.png":h.GBTConstraintType.TANGENT,"Sketch_Constraints_OverDefined_Equal.png":h.GBTConstraintType.EQUAL,"Sketch_Constraints_OverDefined_Normal.png":h.GBTConstraintType.NORMAL,"Sketch_Constraints_OverDefined_Fix.png":h.GBTConstraintType.FIX,"Sketch_Constraints_OverDefined_Use.png":h.GBTConstraintType.PROJECTED,"Sketch_Constraints_OverDefined_Offset.png":h.GBTConstraintType.OFFSET,"Sketch_Constraints_OverDefined_Mirror.png":h.GBTConstraintType.MIRROR,"Sketch_Constraints_OverDefined_CircularPattern.png":h.GBTConstraintType.CIRCULAR_PATTERN,"Sketch_Constraints_OverDefined_LinearPattern.png":h.GBTConstraintType.LINEAR_PATTERN,"Sketch_Constraints_OverDefined_Pierce.png":h.GBTConstraintType.PIERCE,"Sketch_Constraints_OverDefined_Quadrant.png":h.GBTConstraintType.QUADRANT,"Sketch_Constraints_OverDefined_Intersection.png":h.GBTConstraintType.INTERSECTED,"Sketch_Constraints_OverDefined_Curvature.png":h.GBTConstraintType.EQUAL_CURVATURE};Object.entries(s).forEach((function(e){var n=(0,r.__read)(e,2),o=n[0],s=n[1];P(s,h.GBTSketchConstraintSolveStatus.BAD,o,i,t)})),i.forEach((function(e){t.push(S(I("...",h.GBTSketchConstraintSolveStatus.SOLVED,e,!1),h.GBTSketchConstraintSolveStatus.SOLVED,e,!1,"Sketch_Constraints_Ellipsis.png"))}));var a=o.default.getManager().getNumber("CONSTRAINT_MAX_INDICATOR_SIZE");return(0,f.createAtlasFromResources)(e,a,t,{sourcesHaveTransparency:!1})};function M(e){e.getResources().constraintAtlasCreationInitiated||(e.getResources().constraintAtlasCreationInitiated=!0,e.getTextureAtlasFactory().getAtlas(f.CONSTRAINT_ATLAS,_.bind(void 0,e)).then((function(t){t?(e.getResources().constraintAtlas=t,e.getResources().constraintMaterial.ambientTexture=t.texture,(0,f.requestDraw)()):a.log.warn("Could not load texture atlas")}),(function(e){a.log.error(e)})))}var D=function(e){return e.get("selected")===g.IconSelectionType.SELECTED},C=function(e){function i(i,r,a,c,l,u){var h=e.call(this,u,f.HUD_SCENEGRAPH_ID)||this;h.permanent=l,h.activated=!1,h.isExpanded=!1,h.lastCameraXform=null,h.lastProjectionXform=null,h.hasLeader=!1,h.lastMouseDelta=null,h.isForInference=!1,h.material=u.getResources().constraintMaterial,h.nodeProperties=h.viewer.getResources().typeToNodeProperties[f.sketchinformation.nodePropertiesTypes.OK],h.leaderProperties=new f.NodeProperties({isPickable:!1,primitiveType:f.PrimitiveType.LINES,zOffset:5}),h.model=i,h.reference=h.model.get("references").get(r),h.listenTo(h.reference,"change:constraintIds",h.onReferenceConstraintIdsChanged),h.listenTo(h.reference,"change:anchor",h.resetLocation);var d=h.model.get("constraints");h.listenTo(d,"change:solveStatus",h.onConstraintStatusChanged),h.listenTo(d,"change:type",h.onConstraintTypeChanged),h.iconData=new n.Collection,h.worldLocation=a,h.leaderOffset=s.vec3.createFrom(0,0,0),h.ellipsisIcon=new E,h.ellipsisIcon.set("id",t.ELLIPSIS_ID),h.ellipsisIcon.set("selectionId",t.ELLIPSIS_ID);var g=o.default.getManager();return h.iconSizeConstantName=l?"CONSTRAINT_PERMANENT_INDICATOR_PIXEL_SIZE":"CONSTRAINT_INDICATOR_PIXEL_SIZE",h.iconSize=g.getNumber(h.iconSizeConstantName),h.leaderColor=g.getColor("CONSTRAINT_INDICATOR_LEADER_COLOR"),h.userOffset=s.vec2.createFrom(0,0),h.worldGeometryDirection=c,(0,p.each)(h.model.get("constraints").models,h.onConstraintAdded.bind(h)),h.listenTo(h.viewer.getEventDispatcher(),f.VIEW_WILL_PICK,h.onViewWillDraw),h.listenTo(h.model,"change:showOnlyOverdefined",h.onShowOnlyOverdefinedChanged),h.listenTo(h.model,"change:showAllConstraints",h.onShowAllConstraintsChanged),M(h.viewer),h}return(0,r.__extends)(i,e),i.prototype.showLeader=function(){this.hasLeader=!0},i.prototype.setUserOffset=function(e){this.userOffset=s.vec2.createFrom(e[0],-e[1]),this.invalidateDisplay()},i.prototype.getUserOffset=function(){return s.vec2.createFrom(this.userOffset[0],-this.userOffset[1])},i.prototype.setLocation=function(e){this.worldLocation=e,this.invalidateDisplay()},i.prototype.setMouseDelta=function(e){this.lastMouseDelta=e},i.prototype.onConstraintAdded=function(e){this.reference.get("constraintIds").indexOf(e.get("id"))>=0&&this.addConstraintIcon(e)},i.prototype.invalidateDisplay=function(){this.lastCameraXform=null,this.lastProjectionXform=null,this.removeMeshIncrements(),(0,f.requestDraw)()},i.prototype.onConstraintStatusChanged=function(e){if(!(this.reference.get("constraintIds").indexOf(e.get("id"))<0)){var t=this.iconData.get(e.id);t&&(t.set("solveStatus",e.get("solveStatus")),t.set("constraintType",e.get("type")),this.invalidateDisplay())}},i.prototype.onReferenceConstraintIdsChanged=function(){var e=this.reference.get("constraintIds"),t=this.reference.previous("constraintIds"),i=(0,l.difference)(t,e),r=(0,l.difference)(e,t);i.length>0&&this.invalidateDisplay(),i.forEach((function(e){this.iconData.remove(e)}),this),r.forEach((function(e){var t=this.model.get("constraints").get(e);this.addConstraintIcon(t)}),this)},i.prototype.onConstraintTypeChanged=function(e){var t=this.iconData.get(e.id);t&&(t.set("constraintType",e.get("type")),this.invalidateDisplay())},i.prototype.addIcon=function(e,t,i,r){var n=new E;n.set("id",e),t&&n.set("constraintType",t),i&&n.set("solveStatus",i),n.set("isExternal",!!r),this.iconData.add(n),this.invalidateDisplay()},i.prototype.getOffset=function(e,i){var r;if(this.isForInference)r=s.vec2.createFrom(1,-1);else if(this.lastMouseDelta)r=this.lastMouseDelta[0]>0?s.vec2.createFrom(-this.lastMouseDelta[1],this.lastMouseDelta[0]):s.vec2.createFrom(this.lastMouseDelta[1],-this.lastMouseDelta[0]);else{var n=e.projectWorldPointToViewport(this.worldLocation),a=s.vec3.add(this.worldLocation,this.worldGeometryDirection,s.vec3.create()),c=e.projectWorldPointToViewport(a),l=s.vec3.subtract(c,n,s.vec3.create());l[2]=0,r=s.vec3.length(l)<t.OFFSET_DIRECTION_PIXEL_TOLERANCE?s.vec2.createFrom(-1,1):s.vec2.createFrom(l[1],-l[0])}s.vec2.normalize(r);var u=.5*i,h=function(e,t){return s.vec2.dot(s.vec2.createFrom(e,t),r)},d=-Math.abs(h(u,.5)),p=-Math.abs(h(u,-.5)),g=o.default.getManager(),m=(this.permanent?g.getNumber("PERMANENT_INFERENCE_OFFSET"):g.getNumber("TEMPORARY_INFERENCE_OFFSET"))-Math.min(d,p),y=-.99*(0,f.getHudLayerDepthRange)(e.getViewport())[1];return[r[0]*m,r[1]*m,y]},i.prototype.onDevicePixelRatioChanged=function(e){var t=o.default.getManager();this.iconSize=t.getNumber(this.iconSizeConstantName),this.invalidateDisplay()},i.prototype.onViewWillDraw=function(e,t){if(this.viewer.getResources().constraintAtlas){var i=e.getViewMatrixInverse(),r=e.getProjectionMatrix();if(!(this.lastCameraXform&&this.lastProjectionXform&&s.mat4.equal(i,this.lastCameraXform)&&s.mat4.equal(r,this.lastProjectionXform))){this.lastCameraXform=i,this.lastProjectionXform=r;var n=e.projectWorldPointToViewport(this.worldLocation);n[2]=0;var o=s.vec3.createFrom(this.userOffset[0],this.userOffset[1],0);n=s.vec3.add(n,o);var a=s.mat4.translate(s.mat4.identity(),n),c=this.iconSize;s.mat4.scale(a,[c,c,1]);var l=this.getVisibleIcons(),u=this.getOffset(e,this.getDisplayedIconCount(l));s.mat4.translate(a,u),a[12]=Math.floor(a[12]),a[13]=Math.floor(a[13]),this.leaderOffset=s.vec3.subtract(s.vec3.scale(o,-1/c,s.vec3.create()),u),this.leaderOffset[2]=0,this.setTransform(a),this.hasMeshIncrements()||this.updateIconGraphics(l),this.updateLeaderGraphics(l)}}},i.prototype.getNodePropertyType=function(e){var t=NaN;switch(e.get("solveStatus")){case h.GBTSketchConstraintSolveStatus.SOLVED:t=e.get("isExternal")?f.sketchinformation.nodePropertiesTypes.EXTERNAL_AND_OK:f.sketchinformation.nodePropertiesTypes.OK;break;case h.GBTSketchConstraintSolveStatus.BAD:t=f.sketchinformation.nodePropertiesTypes.OVERDEFINED;break;case h.GBTSketchConstraintSolveStatus.DRIVEN:t=f.sketchinformation.nodePropertiesTypes.DRIVEN}return t},i.prototype.updateNodeProperties=function(e){if(this.isForInference)this.nodeProperties=this.viewer.getResources().inferenceNodeProperties;else{this.nodeProperties=this.viewer.getResources().typeToNodeProperties[f.sketchinformation.nodePropertiesTypes.OK];var t=f.sketchinformation.nodePropertiesTypes.DRIVEN,i=this;e.forEach((function(e){var r=i.getNodePropertyType(e);r<t&&(t=r)})),this.nodeProperties=this.viewer.getResources().typeToNodeProperties[t]}},i.prototype.onShowOnlyOverdefinedChanged=function(){this.invalidateDisplay()},i.prototype.onShowAllConstraintsChanged=function(){this.invalidateDisplay()},i.prototype.showIconIfPermanent=function(e,t,i,r){return!!e&&(!!t&&(r||i&&e.get("solveStatus")===h.GBTSketchConstraintSolveStatus.BAD))},i.prototype.getVisibleIcons=function(){var e=[];if(this.isForInference)e=this.iconData.models;else for(var t=this.reference.get("constraintVisibilities"),i=this.reference.get("constraintIds"),r=0;r<i.length;r++){var n=this.iconData.get(i[r]);n&&(this.permanent===this.showIconIfPermanent(n,t[r],this.model.get("showOnlyOverdefined"),this.model.get("showAllConstraints"))&&e.push(n))}return(0,p.sortBy)(e,(function(e){return-2*e.get("solveStatus")-e.get("isExternal")}))},i.prototype.getDisplayedIconCount=function(e){return this.isExpanded?e.length:Math.min(e.length,t.MAX_COLLAPSED_ICONS+1)},i.prototype.updateIconGraphics=function(e){if(this.viewer.getResources().constraintAtlas){this.updateNodeProperties(e),this.viewer.getResources().constraintMaterial.ambientTexture=this.viewer.getResources().constraintAtlas.texture;var i=e.length>t.MAX_COLLAPSED_ICONS+1&&!this.isExpanded,r=.5*-this.getDisplayedIconCount(e);e.forEach((function(e,n){if(e.set("selectionId",""+n),i){if(n>t.MAX_COLLAPSED_ICONS)return void this.removeMeshIncrement(e.get("id"));n===t.MAX_COLLAPSED_ICONS&&(this.removeMeshIncrement(e.get("id")),e=this.ellipsisIcon)}var o,s=e.get("selected");if(this.activated||(s=g.IconSelectionType.MUTED),e.get("id")===t.ELLIPSIS_ID)o=I("...",h.GBTSketchConstraintSolveStatus.SOLVED,s,!1);else{var a=e.get("constraintType"),c=e.get("solveStatus"),l=e.get("isExternal");o=T(a,c,s,l)}var u=this.viewer.getResources().constraintAtlas.getTextureCoords(o);if(u){var d=(0,f.createQuad)([r+n,-.5,0],[r+n+1,-.5,0],[r+n,.5,0],e.get("id"),[u.lowS,u.highT],[u.highS,u.lowT]);this.updateMeshIncrement(e.get("id"),e.get("selectionId"),d,this.nodeProperties)}}),this)}},i.prototype.updateLeaderGraphics=function(e){if(this.hasLeader&&0!==e.length){var t=this.leaderOffset,i=(0,f.createLine)([0,0,0],t,"leader",this.leaderColor,1);this.updateMeshIncrement("leader",f.NO_SELECTION_ID,i,this.leaderProperties)}},i.prototype.addConstraintIcon=function(e){e&&this.addIcon(e.id,e.get("type"),e.get("solveStatus"),e.get("isExternal"))},i.prototype.onDelete=function(){var e=this.iconData.filter(D);return 0!==e.length&&this.deleteConstraints(e)},i.prototype.deleteConstraints=function(e){var t=(0,f.getDrawer)(),r=t.uiSelectionManager.selection,n=t.uiSelectionManager.hoveredSelection,o=!1,s=this.model.get("constraints");if(e.forEach((function(e){var a=s.get(e.get("id"));a&&(r&&r.uiElement instanceof i&&r.uiElement.iconData.any((function(t){return t===e}))&&(t.uiSelectionManager.selection=null),n&&n.uiElement instanceof i&&n.uiElement.iconData.any((function(t){return t===e}))&&(t.uiSelectionManager.hoveredSelection=null),s.remove(a),o=!0)})),o&&(this.deselectEntities(),!t.uiSelectionManager.selection)){var a=(0,f.getActiveViewer)().getLastMouseMovedEvent();t.doPick(a.offsetX,a.offsetY,!0,!0,null)}return o},i.prototype.expand=function(){this.isExpanded=!0,this.removeMeshIncrement(t.ELLIPSIS_ID),this.ellipsisIcon.set("selectionId",""),this.invalidateDisplay()},i.prototype.activate=function(){this.activated||(this.activated=!0,this.invalidateDisplay())},i.prototype.isSelected=function(){return!!this.iconData.findWhere({selected:g.IconSelectionType.SELECTED})},i.prototype.select=function(e){if(e.selectionId!==this.ellipsisIcon.get("selectionId")){var t=this.iconData.findWhere({selectionId:e.selectionId});t&&t.get("selected")!==g.IconSelectionType.SELECTED&&(t.set("selected",g.IconSelectionType.SELECTED),this.invalidateDisplay())}else this.expand()},i.prototype.deselect=function(e){var t=this.iconData.findWhere({selectionId:e.selectionId});t&&t.get("selected")===g.IconSelectionType.SELECTED&&(t.set("selected",g.IconSelectionType.NOT_SELECTED),this.invalidateDisplay())},i.prototype.hover=function(e){(0,u.getPreselectionList)().reset();var t=null;(t=e.selectionId===this.ellipsisIcon.get("selectionId")?this.ellipsisIcon:this.iconData.findWhere({selectionId:e.selectionId}))&&t.get("selected")===g.IconSelectionType.NOT_SELECTED&&(t.set("selected",g.IconSelectionType.PREHILITE),this.invalidateDisplay())},i.prototype.dehover=function(e){var t=null;(t=e.selectionId===this.ellipsisIcon.get("selectionId")?this.ellipsisIcon:this.iconData.findWhere({selectionId:e.selectionId}))&&t.get("selected")===g.IconSelectionType.PREHILITE&&(t.set("selected",g.IconSelectionType.NOT_SELECTED),this.invalidateDisplay())},i.prototype.getConstraint=function(e){var t=this.iconData.findWhere({selectionId:e});return t?this.model.get("constraints").get(t.id):null},i.prototype.deselectEntities=function(){O()},i.prototype.highlightReferenceAndAssociatedCurves=function(e,t){var i=t.id;if(t.get("isSketchEntity")){i=this.viewer.getModelViewManagers().getManager().retrieveSketchEntityDeterministicId(e,i);var r=(0,c.getPointParentFromId)(t.id);if(r){var n=this.viewer.getModelViewManagers().getManager().retrieveSketchEntityDeterministicId(e,r);if(n){var o=(0,u.createSelectionFromDeterministicId)(n,null);(0,u.getSecondarySelectionList)().add(o)}}}if(i){var s=(0,u.createSelectionFromDeterministicId)(i,null);(0,u.getSecondaryPreSelectionList)().add(s)}},i.prototype.selectEntities=function(e){this.deselectEntities();var t,i=this.model.id,r=this.getConstraint(e);if(r){var n=this.model.get("references");t=r.get("referenceIds"),(0,p.each)(t,function(e){var t=n.get(e);t&&this.highlightReferenceAndAssociatedCurves(i,t)}.bind(this))}},i.prototype.getClearModelSelectionsOnPrehilite=function(){return!1},i.prototype.remove=function(){e.prototype.remove.call(this)},i.prototype.resetLocation=function(e,t){t&&this.setLocation(t)},i}(f.UIElement);function O(){(0,u.getSecondaryPreSelectionList)().reset(),(0,u.getSecondarySelectionList)().reset()}t.View=C,t.createInferenceIcon=function(e,t,i){if(0===t.length)return null;var r=new C((0,d.createFakeGraphForConstraints)("inference",t),"inference",e,[0,0,0],!1,i);return r.isForInference=!0,r},t.deselectEntities=O},691596:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayEntity=t.createMeshIncrementForPolylineLines=t.createEntityMetaData=t.createPolyline=t.createSplinePolyline=t.createConicPolyline=t.createArcPolyline=t.tessellateArc=t.createEllipsePolyline=t.createCirclePolyline=t.EntityData=void 0;var r=i(311611),n=i(998739),o=i(227441),s=i(853524),a=i(911748),c=i(673290),l=function(){function e(e,t){this.entityId=e,this.isSubEntity=!1,this.start=null,this.end=null,this.type="unknown",this.subEntities=[],this.mid=null,this.radius=void 0,this.minorRadius=void 0,this.center=null,this.xAxis=null,this.point=null,this.useCenterPointForArcRadius=void 0,this.splineCPData=null,this.splineKnotData=null,this.lowParameter=void 0,this.highParameter=void 0,this.closedSpline=void 0,this.rationalSpline=void 0,this.splineDegree=0,this.offset=0,this.sourceId=void 0,this.bottomLeftCorner=null,this.bottomRightCorner=null,this.topLeftCorner=null,this.rho=0,this.controlPoint=null,this.hasSplineHandlesInSketch=!1,t&&this.update(t)}return e.prototype.update=function(t){var i=this;if(t instanceof o.BTSketchPointDisplayData)this.point=t.getPoint(0),this.type="point";else if(t instanceof o.BTSketchLineDisplayData)this.start=t.getPoint(0),this.end=t.getPoint(1),this.type="line";else if(t instanceof o.BTSketchArcDisplayData)this.start=t.getPoint(0),this.mid=t.getPoint(1),this.end=t.getPoint(2),this.center=t.getPoint(3),this.type="arc";else if(t instanceof o.BTSketchCircleDisplayData){var r=t;this.center=r.getPoint(0),this.radius=r.radius,this.type="circle"}else if(t instanceof o.BTSketchSplineDisplayData){var n=t;this.type="spline",this.closedSpline=n.closed,this.rationalSpline=n.rational,this.splineDegree=n.degree,this.hasSplineHandlesInSketch=t.hasHandlesInSketch;var s=n.controlPointCount,a=s+n.degree+1,c=3*s;if(this.splineCPData=n.points.slice(0,c),this.splineKnotData=n.points.slice(c,c+a),this.offset=n.points[c+a],n.segment){var l=c+a+1;this.start=[n.points[l],n.points[l+1]],this.lowParameter=n.points[l+2],this.end=[n.points[l+3],n.points[l+4]],this.highParameter=n.points[l+5]}else this.lowParameter=this.splineKnotData[this.splineDegree],this.highParameter=this.splineKnotData[this.splineKnotData.length-this.splineDegree-1]}else if(t instanceof o.BTSketchTextDisplayData||t instanceof o.BTSketchImageDisplayData){var u=t instanceof o.BTSketchTextDisplayData;if(u)this.type="text";else{this.type="image";var h=t;this.sourceId=h.sourceId,this.bottomLeftCorner=h.bottomLeftCorner.getVec3(),this.bottomRightCorner=h.bottomRightCorner.getVec3(),this.topLeftCorner=h.topLeftCorner.getVec3()}var d=0;if(i.subEntities.length===t.entities.length)for(d=0;d<i.subEntities.length;d++)i.subEntities[d].update(t.entities[d]);else{i.subEntities=[];var p=u?o.BTMSketchTextEntity.ID_PREFIX:o.BTMSketchImageEntity.ID_PREFIX;t.entities.forEach((function(t){var r=new e(i.entityId+p+"."+d);r.isSubEntity=!0,r.update(t),i.subEntities.push(r),d++}))}}else if(t instanceof o.BTSketchEllipseDisplayData){var g=t;this.type="ellipse",this.center=g.getPoint(0),this.xAxis=g.getPoint(1),this.radius=g.radius,this.minorRadius=g.minorRadius,this.offset=g.offset}else if(t instanceof o.BTSketchEllipticalArcDisplayData){var f=t;this.type="ellipticalArc",this.center=f.getPoint(0),this.xAxis=f.getPoint(1),this.radius=f.radius,this.minorRadius=f.minorRadius,this.lowParameter=f.startParam,this.highParameter=f.endParam,this.offset=f.offset}else if(t instanceof o.BTSketchConicDisplayData){var m=t;this.type="conic",this.start=m.getPoint(0),this.controlPoint=m.getPoint(1),this.end=m.getPoint(2),this.lowParameter=m.points[6],this.highParameter=m.points[7],this.offset=m.offset,this.rho=m.rho}},e}();function u(e){var t=null,i=[e.center];if(e.radius>c.Tolerances.ZERO_LENGTH){t=new Array(c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE);for(var r=2*Math.PI/(c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE-1),n=0,o=e.radius,s=0;s<c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE;++s){n=r*s;var a=Math.cos(n),l=Math.sin(n);t[s]=[e.center[0]+a*o,e.center[1]+l*o]}}return{linePoints:t,points:i}}function h(e,t,i){i<t&&(i+=2*Math.PI);var r=null,n=[e.center],o=e.xAxis,s=[-e.xAxis[1],e.xAxis[0]],a=e.offset;if(e.radius>c.Tolerances.ZERO_LENGTH&&e.minorRadius>c.Tolerances.ZERO_LENGTH){r=[];for(var l=Math.max((i-t)/(2*Math.PI)*c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE,2),u=(i-t)/((l=Math.floor(l))-1),h=0,d=e.radius,p=e.minorRadius,g=0;g<l;++g){h=u*g+t;var f=Math.cos(h),m=Math.sin(h),y=o[0]*d*f+s[0]*p*m,v=o[1]*d*f+s[1]*p*m;if(0!==a){var E=o[0]*p*f+s[0]*d*m,I=o[1]*p*f+s[1]*d*m,T=Math.sqrt(E*E+I*I);y+=a*E/T,v+=a*I/T}r[g]=[e.center[0]+y,e.center[1]+v]}}return{linePoints:r,points:n}}t.EntityData=l,t.createCirclePolyline=u,t.createEllipsePolyline=h;var d=function(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])},p=function(e,t,i){var r=Math.cos(i),n=Math.sin(i);return[e[0]+r*t,e[1]+n*t]};function g(e,t,i,r){for(var n=.01*Math.PI,o=2+Math.floor(Math.abs(r-i)/n),s=(r-i)/(o-1),a=new Array(o),c=0;c<o;++c)a[c]=p(e,t,i),i+=s;return a}function f(e,t,i,n,o){var s=n;if(o){var a=[0,0],c=[0,0],l=[0,0],u=[0,0];if(!(0,r.getPerpendicularBisector2d)(e,t,a,c)||!(0,r.getPerpendicularBisector2d)(t,i,l,u))return null;var h=[0,0];if(!(0,r.intersectTwoLines2d)(a,c,l,u,h))return null;s=h}var p=d(s,e),f=d(s,i),m=d(s,t),y=0;p>f&&(y=p,p=f,f=y),(m<p||m>f)&&(y=p,p=f,f=y+2*Math.PI);var v=e[0]-s[0],E=e[1]-s[1];return{linePoints:g(s,Math.sqrt(v*v+E*E),p,f),points:[e,i,s]}}function m(e){var t=new l(e.entityId),i=1;return Math.abs(1-e.rho)>c.Tolerances.ZERO_LENGTH?(i=e.rho/(1-e.rho),t.splineKnotData=[0,0,0,1,1,1],t.splineCPData=[e.start[0],e.start[1],1,e.controlPoint[0],e.controlPoint[1],i,e.end[0],e.end[1],1]):(t.splineKnotData=[0,0,0,.5,1,1,1],t.splineCPData=[e.start[0],e.start[1],1,e.controlPoint[0],e.controlPoint[1],i,e.controlPoint[0],e.controlPoint[1],i,e.end[0],e.end[1],1]),t.rationalSpline=!0,t.closedSpline=!1,t.offset=e.offset,t.splineDegree=2,t.lowParameter=e.lowParameter,t.highParameter=e.highParameter,y(t)}function y(e){var t=[],i=[];if(e.splineCPData&&e.splineCPData.length>0&&e.splineDegree&&e.splineKnotData){var r=[],o=void 0;for(o=0;o<e.splineCPData.length;o+=3)r.push([e.splineCPData[o]*e.splineCPData[o+2],e.splineCPData[o+1]*e.splineCPData[o+2],e.splineCPData[o+2]]);var s=new n.Bspline(e.splineDegree,e.splineKnotData,r,a.vec3,!!e.closedSpline),l=e.splineCPData.length*c.Tolerances.NUMBER_OF_POINTS_PER_BSPLINE_CPOINT,u=Math.min(e.lowParameter,e.highParameter),h=Math.abs(e.highParameter-e.lowParameter)/l,d=void 0,p=void 0;for(o=0;o<=l;o++)d=u+o*h,p=s.evaluate(d),t.push([p[0]/p[2],p[1]/p[2]]);if(e.offset&&Math.abs(e.offset)>c.Tolerances.ZERO_LENGTH){var g=[],f=a.vec2.create(),m=a.vec2.create(),y=!1;if(e.closedSpline){var v=s.domain();y=Math.abs(Math.abs(e.highParameter-e.lowParameter)-v[1]+v[0])<c.Tolerances.ZERO_LENGTH}for(o=0;o<=l;++o)f=0===o?a.vec2.subtract(t[1],t[0],f):o===l?y?a.vec2.subtract(t[1],t[0],f):a.vec2.subtract(t[l],t[l-1],f):a.vec2.subtract(t[o+1],t[o-1],f),a.vec2.normalize(f),m=a.vec2.scale([f[1],-f[0]],e.offset,m),g.push(a.vec2.add(t[o],m,a.vec2.create()));t=g}e.start&&i.push(e.start),e.end&&i.push(e.end)}return{linePoints:t,points:i}}function v(e,t,i,r){var n=!1,a=!1,c=!1;t&&((i||"point"===e.type)&&(n=t.isConstruction),a=t.forPreview,t.isFromSplineHandle&&(c=t.isFromSplineHandle));var l=t?t.status:o.GBTMGeomStatus.UNKNOWN;return(0,s.createSketchEntity)(i,n,c,l,r,a)}function E(e,t){var i,n=e.getSketch(),o=[],s=[],a=0;if(t.linePoints){var c=t.linePoints.length,l=0;t.linePoints.forEach((function(e){i=n.planeToWorld(e),o.push(i[0],i[1],i[2]),s.push(a),l>0&&l<c-1&&s.push(a),l++,a++}))}return o.length>0?new r.MeshIncrement(r.PrimitiveType.LINES,o,s):null}t.tessellateArc=g,t.createArcPolyline=f,t.createConicPolyline=m,t.createSplinePolyline=y,t.createPolyline=function(e){switch(e.type){case"line":var t=[e.start,e.end];return{linePoints:t,points:t};case"point":return{linePoints:null,points:[e.point]};case"circle":return u(e);case"arc":return f(e.start,e.mid,e.end,e.center,!e.useCenterPointForArcRadius);case"spline":return y(e);case"ellipse":return h(e,0,2*Math.PI);case"ellipticalArc":if(void 0!==e.lowParameter&&void 0!==e.highParameter)return h(e,e.lowParameter,e.highParameter);break;case"conic":return m(e)}return console.warn("Failed to create polyline for unsupported entity type: "+e.type),{linePoints:null,points:null}},t.createEntityMetaData=v,t.createMeshIncrementForPolylineLines=E,t.displayEntity=function(e,t,i,n,o,s){var a=e.getSketch();if(a&&t){var c=null,l=[],u=[],h=0;t.points&&t.points.forEach((function(e){c=a.planeToWorld(e),l.push(c[0],c[1],c[2]),u.push(h),h++}));var d=E(e,t);d?i.updateTemporaryEntity(o,d,v(n,s,!0,o)):l.length>0&&i.updateTemporaryEntity(o,new r.MeshIncrement(r.PrimitiveType.POINTS,l,u),v(n,s,!1,o))}}},130799:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SketchPlaneDisplay=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(712197),a=i(227441),c=i(911748),l=new n.NodeProperties({isPickable:!1,primitiveType:n.PrimitiveType.LINES,isStencilWritten:!1,includedInBlend:!0}),u="text",h=o.default.getManager(),d=function(e){function t(t,i,r){var o=e.call(this,r)||this;return o.name=t,o.featureModel=i,o.minPlanePoint=null,o.maxPlanePoint=null,o.textTexture=null,o.planeMatrix=null,o.planeMatrixInverse=null,o.lineColor=h.getColor("SKETCH_PLANE_LINE_COLOR"),o.textColor=h.getColor("SKETCH_PLANE_TEXT_COLOR"),o.textMaterial=(0,n.createTextureMaterial)(),o.textNodeProperties=new n.NodeProperties({isPickable:!1,isTwoSided:!0,primitiveType:n.PrimitiveType.TRIANGLES,material:o.textMaterial}),o.onPlaneChange(),o.listenTo(i,"change:planeMatrix",o.onPlaneChange),o.listenTo(i,"change:hasRegenError",o.onRegenErrorChange),o}return(0,r.__extends)(t,e),t.prototype.remove=function(){this.destroyText(),this.textMaterial&&(this.textMaterial.destroy(),this.textMaterial=null),e.prototype.remove.call(this)},t.prototype.destroyText=function(){this.textTexture&&(this.textTexture.destroy(),this.textTexture=null)},t.prototype.onRegenErrorChange=function(){this.featureModel.getHasRegenError()===a.GBTNodeStatusType.ERROR!==this.isHidden&&this.onPlaneChange()},t.prototype.onPlaneChange=function(){this.planeMatrix=null,this.planeMatrixInverse=null,this.destroyText(),this.minPlanePoint=null,this.maxPlanePoint=null;var e=this.featureModel.getHasRegenError()===a.GBTNodeStatusType.ERROR;this.viewer.getSketch()&&!e?(this.planeMatrix=this.viewer.getSketch().getPlaneMatrix(),this.planeMatrixInverse=c.mat4.inverse(this.planeMatrix,c.mat4.create()),this.show()):this.hide(),(0,n.requestDraw)()},t.prototype.getEntityBoundsCenter=function(){var e=this.featureModel.parameters[0].getBtParameterForCurrentConfiguration();if(this.featureModel&&this.featureModel.parameters&&this.featureModel.parameters.length>0&&e.getIsAQueryList()&&!e.getIsEmptyQueryList()){var t=e.getQueryListItems()[0],i=t.getDeterministicIds();if(i&&i.length>0){var r=this.viewer.getModelViewManagers().getManager(),o=r.extractMeshIncrement(i[0]);if(o){var a=null,l=r.getDisplayedElement();if(l instanceof n.PartStudio){var u=(0,s.createSelectionFromDeterministicId)(i[0]);u&&(a=l.getBodyTransform(u.getBodyId(),this.viewer))}return a?c.mat4.multiplyVec3(a,o.getBounds().center()):o.getBounds().center()}var h=r.getMateConnectorGraphics(null,t.getFeatureId());if(h)return h.worldSpacePosition}}return null},t.prototype.hasBounds=function(){return!!this.minPlanePoint&&!!this.maxPlanePoint},t.prototype.updateBounds=function(e){if(this.planeMatrix&&!this.hasBounds()){var t=this.getEntityBoundsCenter();if(t){var i=(0,n.projectWorldToPlane)(t,this.planeMatrixInverse),r=e.projectWorldPointToViewport(t);if(r[0]<e.getViewportLeft()||r[0]>=e.getViewportWidth()||r[1]<e.getViewportBottom()||r[1]>=e.getViewportHeight()){var o=e.viewportToCanvas([e.getViewportWidth()/2,e.getViewportHeight()/2,0]),s=e.getRay(o[0],o[1]),a=(0,n.intersectRayPlaneMatrix)(s,this.planeMatrix,.258819);a&&(i=(0,n.projectWorldToPlane)(a,this.planeMatrixInverse))}var c=e.getPixelSizeAtWorldPoint((0,n.unprojectPlaneToWorld)(i,this.planeMatrix)),u=h.getNumber("VIEWPORT_HEIGHT_TO_PLANE_HEIGHT_RATIO")*e.getViewportHeight()*c,d=u*h.getNumber("PLANE_DEFAULT_WIDTH_HEIGHT_RATIO");this.minPlanePoint=[i[0]-d/2,i[1]-u/2],this.maxPlanePoint=[i[0]+d/2,i[1]+u/2];var p=(0,n.unprojectPlaneToWorld)([this.minPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),g=(0,n.unprojectPlaneToWorld)([this.maxPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),f=(0,n.unprojectPlaneToWorld)([this.maxPlanePoint[0],this.maxPlanePoint[1]],this.planeMatrix),m=(0,n.unprojectPlaneToWorld)([this.minPlanePoint[0],this.maxPlanePoint[1]],this.planeMatrix),y=(0,n.createLines)([p,g,g,f,f,m,m,p]);(0,n.addColorToIncrement)(this.lineColor,y),this.updateMeshIncrement("edges",n.NO_SELECTION_ID,y,l)}}},t.prototype.updateText=function(e){if(this.planeMatrix&&this.hasBounds()){var t=this.getTextTexture(),i=(0,n.unprojectPlaneToWorld)([this.minPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),r=(0,n.unprojectPlaneToWorld)([this.maxPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),o=(0,n.unprojectPlaneToWorld)([this.minPlanePoint[0],this.maxPlanePoint[1]],this.planeMatrix),s=c.vec3.subtract(r,i,c.vec3.create()),a=c.vec3.length(s);c.vec3.normalize(s);var l=c.vec3.subtract(o,i,c.vec3.create()),d=c.vec3.length(l);c.vec3.normalize(l);var p=1/e.getUnitSizeAtWorldPoint(o),g=p*t.filledWidthPx,f=p*t.filledHeightPx,m=p*h.getNumber("PLANE_TEXT_MARGIN");if(g>a-2*m||f>d-2*m){var y=Math.min((a-2*m)/g,(d-2*m)/f);if(y<=0)return void this.removeMeshIncrement(u);g*=y,f*=y}var v=c.vec3.add(o,c.vec3.scale(l,-m-f,c.vec3.create()),c.vec3.create());c.vec3.add(v,c.vec3.scale(s,m,c.vec3.create()));var E=c.vec3.add(v,c.vec3.scale(s,g,c.vec3.create()),c.vec3.create()),I=c.vec3.add(v,c.vec3.scale(l,f,c.vec3.create()),c.vec3.create());this.textMaterial.ambientTexture=t;var T=(0,n.createQuad)(v,E,I,void 0,[t.leftCoordinate,t.bottomCoordinate],[t.rightCoordinate,t.topCoordinate]);this.updateMeshIncrement(u,n.NO_SELECTION_ID,T,this.textNodeProperties)}},t.prototype.getTextTexture=function(){return this.textTexture||(this.textTexture=(0,n.createTextureFromText)(this.viewer,this.name,{color:this.textColor,font:h.getString("PLANE_TEXT_FONT"),size:h.getNumber("PLANE_TEXT_HEIGHT_PX"),paddingWithinBorder:h.getNumber("PLANE_TEXT_BACKGROUND_PADDING")})),this.textTexture},t.prototype.onViewWillDraw=function(e,t){this.updateBounds(e),this.updateText(e)},t}(n.UIElement);t.SketchPlaneDisplay=d},918928:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.onViewerDraw=t.hasSpaceballConnected=t.stopActionController=t.initializeSpaceballConnection=t.SpaceballConnection=void 0;var n=i(311611),o=i(311517),s=i(73055),a=i(450846),c=i(194598),l=i(911748),u=!1,h=function(){function e(){this.rayAperture=0,this.hitSelectionOnly=!1,this.mouseCreated=!1,this.mouseIsInMotion=!1,this.hitTestRay=new n.Ray([0,0,0],[0,0,0]),this.connexion=new _3Dconnexion(this),this.connexion.connect()||o.log.trace("Failed to initialize connection to 3Dconnexion NL-Proxy")}return e.prototype.logMatrix=function(e,t){var i=function(t){return e[t].toFixed(2)};console.group(t),console.log(i(0)+" "+i(1)+" "+i(2)+" "+i(3)),console.log(i(4)+" "+i(5)+" "+i(6)+" "+i(7)),console.log(i(8)+" "+i(9)+" "+i(10)+" "+i(11)),console.log(i(12)+" "+i(13)+" "+i(14)+" "+i(15)),console.groupEnd()},e.prototype.logVector=function(e,t){console.group(t),console.log(e[0].toFixed(2)+" "+e[1].toFixed(2)+" "+e[2].toFixed(2)),console.groupEnd()},e.prototype.logNumber=function(e,t){console.group(t),console.log(e),console.groupEnd()},e.prototype.onConnect=function(){this.connexion.create3dmouse(window,"Onshape"),u=!0},e.prototype.onDisconnect=function(e){o.log.trace("3Dconnexion NL-Proxy disconnected: "+e)},e.prototype.getViewer=function(){return(0,n.getFocusedViewer)()},e.prototype.getViewController=function(){var e=this.getViewer();return e?e.getPrimaryViewController():null},e.prototype.getCamera=function(){var e=this.getViewer();return e?e.getCamera():null},e.prototype.checkState=function(e){return!!(this.getViewer()&&this.getViewController()&&this.getCamera())||(o.log.trace("Attempted to call spaceball."+e+" with no active document."),!1)},e.prototype.onViewerDraw=function(e,t){this.checkState("onViewerDraw")&&this.mouseCreated&&this.mouseIsInMotion&&e===this.getViewer()&&this.connexion.update3dcontroller({frame:{time:t}})},e.prototype.getViewMatrix=function(){return this.checkState("getViewMatrix")?this.getCamera().getFrame():null},e.prototype.getConstructionPlane=function(){if(!this.checkState("getConstructionPlane"))return null;var e=this.getViewer().getSketch(),t=null;return e&&(t=(0,n.extractPlaneFromMatrix)(e.getPlaneMatrix()),t=Array.prototype.slice.call(t)),t},e.prototype.getViewExtents=function(){return this.checkState("getViewExtents")?this.getCamera().isOrthographic()?this.getCamera().getExtents():(o.log.info("Tried to get view extents for a non-orthographic camera."),null):null},e.prototype.getFov=function(){return this.checkState("getFov")?this.getCamera().isOrthographic()?(o.log.info("Tried to get fov for an orthographic camera"),0):(0,n.toRadians)(this.getCamera().getFieldOfView()):0},e.prototype.getViewFrustum=function(){return this.checkState("getViewFrustum")?this.getCamera().isOrthographic()?(o.log.info("Tried to get frustum for an orthographic camera"),null):this.getCamera().getFrustum():null},e.prototype.getPerspective=function(){return!!this.checkState("getPerspective")&&this.getCamera().isPerspective()},e.prototype.getViewTarget=function(){if(!this.checkState("getViewTarget"))return null;var e=this.getCamera().getViewport();return this.getCamera().getRay(e[2]/2,e[3]/2).point},e.prototype.getModelExtents=function(){if(!this.checkState("getModelExtents"))return null;var e=this.getCamera().getSceneBounds();return e?[e.min[0],e.min[1],e.min[2],e.max[0],e.max[1],e.max[2]]:[-1,-1,-1,1,1,1]},e.prototype.getPivotPosition=function(){if(!this.checkState("getPivotPosition"))return null;var e=this.getViewController();return e.updateRotationPanCenterForSpaceball(),e.getRotateOrPanCenter()},e.prototype.getLookAt=function(){if(!this.checkState("getLookAt"))return null;var e=this.getViewer(),t=this.getCamera(),i=this.hitTestRay.evaluate(1),r=t.projectWorldPointToCanvas(i);r[2]=0;var n,o=t.canvasToWorld(r),a=this.rayAperture/2*t.getUnitSizeAtWorldPoint(o),c=t.getViewport(),u=c[2]*c[3]/s.default.getManager().getNumber("DEPTH_SAMPLES_PER_VIEWPORT"),h=Math.sqrt(u/2),d=(a+h)*(a+h);n=this.hitSelectionOnly?e.retrieveHighlightsOnlyDepthSampling():e.retrieveDepthSampling();for(var p=null,g=l.vec2.create(),f=0;f<n.length;f++){l.vec2.set([r[0]-n[f][0],r[1]-n[f][1]],g),l.vec2.squaredLength(g)<d&&(!p||n[f][2]<p[2])&&(p=n[f])}return p?t.canvasToWorld(p):null},e.prototype.getSelectionEmpty=function(){return!this.checkState("getSelectionEmpty")||0===(0,a.getSelectionList)().size()},e.prototype.getSelectionExtents=function(){var e=this;if(!this.checkState("getSelectionExtents"))return null;var t=new n.BoundingBox;(0,a.getSelectionList)().each((function(i){t.addBox(e.getViewer().getSelectionFitBounds(i))}));var i=t.getMin(),r=t.getMax();return[i[0],i[1],i[2],r[0],r[1],r[2]]},e.prototype.getPointerPosition=function(){if(!this.checkState)return null;var e=this.getViewController().getPointerPosition();return this.getCamera().getRay(e[0],e[1]).point},e.prototype.getCoordinateSystem=function(){return[1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]},e.prototype.getFrontView=function(){return[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]},e.prototype.setViewMatrix=function(e){if(this.checkState("setViewMatrix")){var t=this.getViewer();this.getCamera().setFrame(e),t.setUserIsAdjustingCamera(),t.getEventDispatcher().trigger(n.CHANGE_VIEW)}},e.prototype.setViewExtents=function(e){this.checkState("setViewExtents")&&(this.getCamera().isOrthographic()?this.getCamera().setExtents(e):o.log.info("Tried to get view extents for a non-orthographic camera."))},e.prototype.setFov=function(e){this.checkState("setFov")&&this.getCamera().setFieldOfView((0,n.toDegrees)(e))},e.prototype.setPivotPosition=function(e){this.checkState("setPivotPosition")&&this.getViewController().setRotationPivotPosition(e)},e.prototype.setPivotVisible=function(e){this.checkState("setPivotVisible")&&this.getViewController().setShowRotationPivot(e)},e.prototype.setLookFrom=function(e){this.hitTestRay.setPoint(e)},e.prototype.setLookDirection=function(e){this.hitTestRay.setDirection(e)},e.prototype.setLookAperture=function(e){this.rayAperture=e},e.prototype.setSelectionOnly=function(e){this.hitSelectionOnly=e},e.prototype.setTransaction=function(e){this.checkState("setTransaction")&&0===e&&this.getViewer().requestDraw()},e.prototype.onStartMotion=function(){this.checkState("onStartMotion")&&(this.mouseIsInMotion=!0,this.getViewer().setSuppressMouseMovePick(!0),(0,a.clearPreSelection)(),this.getViewController().setIsSpaceballMoving(!0),this.getViewer().requestDraw())},e.prototype.onStopMotion=function(){this.checkState("onStopMotion")&&(this.mouseIsInMotion=!1,this.getViewController().setIsSpaceballMoving(!1),this.getViewer().setSuppressMouseMovePick(!1),this.getViewer().doPreHighlightPick())},e.prototype.setActiveCommand=function(e){e&&(0,n.getActiveViewerEventDispatcher)().trigger(n.SPACEMOUSE_COMMAND,e)},e.prototype.on3dmouseCreated=function(){u&&(c.btInjector.SpaceballService.initializeSpacemouseCommands(),this.connexion.update3dcontroller({frame:{timingSource:1}}),this.mouseCreated=!0)},e.prototype.update3dcontroller=function(e){u&&this.mouseCreated&&this.connexion.update3dcontroller(e)},e}();t.SpaceballConnection=h;var d=null,p=null;t.initializeSpaceballConnection=function(){r("iframe").attr("tabindex","-1"),!(0,n.isSpaceballSupported)()||d||p||(d=new h,(p=new n.ActionSetController(d)).startListeningToEvents())},t.stopActionController=function(){p&&p.stopListeningToEvents()},t.hasSpaceballConnected=function(){return u},t.onViewerDraw=function(e,t){d&&d.onViewerDraw(e,t)}},400129:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;var r=i(311517),n=function(){function e(){this.gl=null,this.state={},this.stack=[]}return e.prototype.setGlContext=function(e){this.gl=e,this.callGl("depthMask",!0),this.callGl("depthFunc",this.getGl().LEQUAL)},e.prototype.getGl=function(){return this.gl},e.prototype.capture=function(){var e=function(){};e.prototype=this.state,this.stack.push(this.state),this.state=new e},e.prototype.restore=function(){if(0!==this.stack.length){var e=this.state,t=this.stack.pop();for(var i in e)if(e.hasOwnProperty(i)){var n=t[i];n&&this.callGl(i,n[0],n[1],n[2],n[3])}this.state=t}else r.log.warn("Graphics state restore attempted without previous capture")},e.prototype.callGl=function(e,t,i,r,n){var o=this.state[e];if(!o||o[0]!==t||o[1]!==i||o[2]!==r||o[3]!==n){var s=[t,i,r,n];this.gl[e].apply(this.gl,s),this.state[e]=s}},e.prototype.getState=function(e){return this.state[e]},e}();t.State=n},249702:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TaskManager=t.MEDIUM_INTERACTIVE_BUDGET=t.SMALL_INTERACTIVE_BUDGET=t.Budget=void 0;var r=i(73055),n=i(311611),o=function(){function e(e,t){this.timeBudget=e,this.vertexBudget=t,this.startTime=0,this.verticesSpent=0}return e.prototype.addVertexCost=function(e){this.verticesSpent+=e},e.prototype.reset=function(){this.startTime=(0,n.getTimeInMilliseconds)(),this.verticesSpent=0},e.prototype.budgetExceeded=function(){return this.verticesSpent>this.vertexBudget||(0,n.getTimeElapsed)(this.startTime)>this.timeBudget},e}();t.Budget=o,t.SMALL_INTERACTIVE_BUDGET=new o(r.default.getManager().getNumber("GRAPHICS_TASK_SMALL_INTERACTIVE_TIME_BUDGET"),r.default.getManager().getNumber("GRAPHICS_TASK_SMALL_INTERACTIVE_VERTEX_BUDGET")),t.MEDIUM_INTERACTIVE_BUDGET=new o(r.default.getManager().getNumber("GRAPHICS_TASK_MEDIUM_INTERACTIVE_TIME_BUDGET"),r.default.getManager().getNumber("GRAPHICS_TASK_MEDIUM_INTERACTIVE_VERTEX_BUDGET"));var s=function(){function e(){this.tasks=[]}return e.prototype.addTask=function(e,t){this.tasks.push({task:e,budget:t})},e.prototype.processWithBudget=function(e){e&&e.reset();for(var t=0;t<this.tasks.length&&(!e||!e.budgetExceeded());++t)this.tasks[t].task.process(e)},e.prototype.processInteractively=function(){for(var e=null,t=0;t<this.tasks.length;++t)if(this.tasks[t].task.hasPendingWork()){e=this.tasks[t].budget;break}e&&this.processWithBudget(e)},e.prototype.complete=function(){this.processWithBudget(null)},e.prototype.hasPendingWork=function(){for(var e=0;e<this.tasks.length;++e)if(this.tasks[e].task.hasPendingWork())return!0;return!1},e}();t.TaskManager=s},175700:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Text=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(623639),a=i(311611),c=function(e){function t(t,i){var r=e.call(this,i,t.sceneGraphId)||this;r.texture=null,r.text="",r.offsetAdjustmentFunction=null,r.drawBox=!1,r.boxOffsetPixels=0,r.backgroundColor=[1,1,1,1],r.backgroundOpacity=0,r.origin=t.origin,r.right=t.right,r.up=t.up,r.heightPx=t.heightPx;var o=n.default.getManager();return r.color=t.color||o.getColor("DEFAULT_TEXT_COLOR"),r.font=t.font||o.getString("DEFAULT_TEXT_FONT"),r.material=(0,a.createTextureMaterial)(),r.nodeProperties=new a.NodeProperties(Object.assign({},{isPickable:!1,isTwoSided:!0,primitiveType:a.PrimitiveType.TRIANGLES,isShowThrough:!0,isDepthTested:!1,material:r.material},t.textNodePropertyOptions||{})),r.boxNodeProperties=new a.NodeProperties(Object.assign({},{isPickable:!1,primitiveType:a.PrimitiveType.LINES},t.boxNodePropertyOptions||{})),r}return(0,r.__extends)(t,e),t.prototype.remove=function(){this.destroyText(),this.material&&(this.material.destroy(),this.material=null),e.prototype.remove.call(this)},t.prototype.destroyText=function(){this.texture&&(this.texture.destroy(),this.texture=null)},t.prototype.setOffsetAdjustmentFunction=function(e){var t=this.offsetAdjustmentFunction;return this.offsetAdjustmentFunction=e,t},t.prototype.setDrawBox=function(e,t,i,r){this.drawBox=e,t&&(this.boxOffsetPixels=t),i&&(this.backgroundColor=i),r&&(this.backgroundOpacity=r),e||this.removeMeshIncrement("box")},t.prototype.setHeightPx=function(e){this.setHeightAndColor(e)},t.prototype.setText=function(e){this.text!==e&&(this.destroyText(),this.text=e,this.texture=(0,a.createTextureFromText)(this.viewer,e,{color:this.color,font:this.font,size:this.heightPx}),this.material.ambientTexture=this.texture,(0,a.requestDraw)())},t.prototype.setHeightAndColor=function(e,t){var i=!1;t&&this.color!==t&&(this.color=t,i=!0),e&&this.heightPx!==e&&(this.heightPx=e,i=!0),i&&this.text&&(this.destroyText(),this.drawBox?this.texture=(0,a.createTextureFromText)(this.viewer,this.text,{color:this.color,font:this.font,size:this.heightPx,paddingWithinBorder:this.boxOffsetPixels,backgroundColor:this.backgroundColor,backgroundOpacity:this.backgroundOpacity}):this.texture=(0,a.createTextureFromText)(this.viewer,this.text,{color:this.color,font:this.font,size:this.heightPx}),this.material.ambientTexture=this.texture,(0,a.requestDraw)())},t.prototype.onViewWillDraw=function(e){if(this.texture){var t=this.getTextCorners(e);if(this.updateMeshIncrement("text",a.NO_SELECTION_ID,this.createScreenSpaceQuad(e,t.lowerLeft,t.lowerRight,t.upperLeft),this.nodeProperties),this.drawBox){var i=o.vec3.scale(o.vec3.subtract(t.lowerRight,t.lowerLeft,o.vec3.create()),.5),r=o.vec3.scale(o.vec3.subtract(t.upperLeft,t.lowerLeft,o.vec3.create()),.5),n=o.vec3.scale(o.vec3.add(t.lowerRight,t.upperLeft,o.vec3.create()),.5);this.updateMeshIncrement("box",a.NO_SELECTION_ID,(0,a.createQuadOutline)(n,i,r,this.color,1),this.boxNodeProperties)}}},t.prototype.getTextCorners=function(e){var t=this.origin;this.transform&&o.mat4.multiplyVec3(this.transform,this.origin,o.vec3.create());var i=e.getPixelSizeAtWorldPoint(t),r=new s.ScreenSpaceData;return r.pixelSize=i,r.lowerLeft=o.vec3.create(this.origin),r.lowerRight=o.vec3.add(o.vec3.scale(this.right,i*this.texture.filledWidthPx,o.vec3.create()),this.origin),r.upperLeft=o.vec3.add(o.vec3.scale(this.up,i*this.texture.filledHeightPx,o.vec3.create()),this.origin),this.offsetAdjustmentFunction&&(r=this.offsetAdjustmentFunction(r)),r},t.prototype.createScreenSpaceQuad=function(e,t,i,r){var n=(0,a.orientText)(e,this.right,this.up,this.transform);return(0,a.createQuad)(t,i,r,void 0,[n[0]?this.texture.rightCoordinate:this.texture.leftCoordinate,n[1]?this.texture.topCoordinate:this.texture.bottomCoordinate],[n[0]?this.texture.leftCoordinate:this.texture.rightCoordinate,n[1]?this.texture.bottomCoordinate:this.texture.topCoordinate])},t}(a.UIElement);t.Text=c},275441:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createRGBATexture=t.getTextureSize=t.unbindTexture=t.bindTexture=t.Texture=t.TextureDefinition=t.areTexturesPendingLoad=void 0;var r=i(423902),n=i(311611),o=i(997862),s=i(663748),a=i(311517),c=new o.StringSet;t.areTexturesPendingLoad=function(){return!c.isEmpty()};var l=function(){function e(e){this.bytes=null,this.floats=null,this.width=-1,this.height=-1,this.useMipmaps=!1,this.maxAnisotropy=-1,this.canvas=null,this.imageSource="",this.defersRendering=!1,this.internalFormat=e.RGBA,this.format=this.internalFormat,this.minificationFilter=e.NEAREST,this.magnificationFilter=e.NEAREST,this.wrapS=e.CLAMP_TO_EDGE,this.wrapT=e.CLAMP_TO_EDGE}return e.prototype.isImage=function(){return!!this.imageSource},e}();t.TextureDefinition=l;var u=0,h=function(e){function t(t,i,r){var o=e.call(this)||this;return o.viewer=t,o.GAUGE_MEMORY_TYPE="Texture",o.creationFunction=null,o.textureDefinition=null,o.waitingForTextureData=!1,o.texture=null,o.textureSize=0,o.textureNeedsUpdate=!1,o.hasTransparency=!0,(0,n.viewerCheck)(t),"function"==typeof i?o.creationFunction=i:o.textureDefinition=i,o.updateFunction=r,o.id=u.toString(),++u,o.textureDefinition&&o.textureDefinition.isImage()&&o.createTexture(),o.listenTo(o.viewer.getEventDispatcher(),n.SESSION_ENDED,o.onGlContextLostOrDestroyed),o.listenTo(o.viewer.getEventDispatcher(),n.GL_CONTEXT_LOST,o.onGlContextLostOrDestroyed),o}return(0,r.__extends)(t,e),t.prototype.destroy=function(){this.stopListening(),this.texture&&(this.viewer.getGlContext().deleteTexture(this.texture),this.viewer.getMemoryGauge().decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.textureSize)),this.texture=null},t.prototype.setTextureNeedsUpdate=function(e){this.textureNeedsUpdate=e},t.prototype.createTexture=function(){if(!this.texture){var e=this.textureDefinition?this.textureDefinition:this.creationFunction(this.viewer.getGlContext());if(e){var t=this.viewer.getGlContext();if(this.texture=t.createTexture(),this.textureNeedsUpdate=!1,e.isImage())this.loadTextureFromImage(e);else{var i="createTexture temporary";d(this.viewer,this.texture,i)>=0&&(e.bytes?(t.texImage2D(t.TEXTURE_2D,0,e.internalFormat,e.width,e.height,0,e.format,t.UNSIGNED_BYTE,e.bytes),this.setTextureSize(e.width,e.height,e.internalFormat,t.UNSIGNED_BYTE)):e.floats?this.viewer.areFloatTexturesSupported()?(t.texImage2D(t.TEXTURE_2D,0,e.internalFormat,e.width,e.height,0,e.format,t.FLOAT,e.floats),this.setTextureSize(e.width,e.height,e.internalFormat,t.FLOAT)):a.log.warn(n.WEBGL_ERROR_LOG_TAG+"An attempt was made to make a float texture without float texture support"):e.canvas?(t.texImage2D(t.TEXTURE_2D,0,e.internalFormat,e.format,t.UNSIGNED_BYTE,e.canvas),this.setTextureSize(e.canvas.width,e.canvas.height,e.internalFormat,t.UNSIGNED_BYTE)):a.log.warn(n.WEBGL_ERROR_LOG_TAG+"An attempt was made to create a texture without valid input"),this.finishTextureSpecification(e),this.viewer.releaseTextureUnit(i))}}}},t.prototype.setTextureSize=function(e,t,i,r){this.textureSize=p(e,t,i,r),this.viewer.getMemoryGauge().incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.textureSize)},t.prototype.loadTextureFromImage=function(e){var t=this,i=new Image;this.waitingForTextureData=!0,e.defersRendering&&c.add(this.id),i.onload=function(){var r=t.viewer.getGlContext();r&&t.texture&&(t.waitingForTextureData=!1,d(t.viewer,t.texture,"loadTextureFromImage")>=0&&(r.texImage2D(r.TEXTURE_2D,0,e.internalFormat,e.format,r.UNSIGNED_BYTE,i),t.setTextureSize(i.width,i.height,e.internalFormat,r.UNSIGNED_BYTE),t.finishTextureSpecification(e),t.viewer.releaseTextureUnit("loadTextureFromImage")),c.remove(t.id),(0,n.requestDraw)())},i.onerror=function(){a.log.warn("Could not load texture image: "+e.imageSource),c.remove(t.id),(0,n.requestDraw)()};setTimeout((function(){c.contains(t.id)&&(c.remove(t.id),(0,n.requestDraw)())}),2e3),i.src=e.imageSource},t.prototype.finishTextureSpecification=function(e){var t=this.viewer.getGlContext(),i=this.viewer.getAnisotropicExtension();i&&e.maxAnisotropy>0&&t.texParameterf(t.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,e.maxAnisotropy),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.magnificationFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.minificationFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.wrapT),e.useMipmaps&&t.generateMipmap(t.TEXTURE_2D)},t.prototype.updateAndBindTexture=function(e){if((0,n.viewerCheck)(this.viewer),this.texture||this.createTexture(),this.waitingForTextureData)return-1;var t=this.viewer.getGlContext(),i=d(this.viewer,this.texture,e);return i>=0&&this.textureNeedsUpdate&&this.updateFunction&&(t.activeTexture(t.TEXTURE0+i),this.updateFunction(),this.textureNeedsUpdate=!1),i},t.prototype.setHasTransparency=function(e){this.hasTransparency=e},t.prototype.getHasTransparency=function(){return this.hasTransparency},t.prototype.onGlContextLostOrDestroyed=function(){this.texture=null},t}(s.BackboneEventsBaseClass);function d(e,t,i){(0,n.viewerCheck)(e);var r=e.getOrAllocateTextureUnit(i);return r>=0&&e.bindTextureToUnit(t,r),r}function p(e,t,i,r){return e*t*(0,n.getChannelCountOfGlPixelFormat)(i)*(0,n.sizeOfGlType)(r)}t.Texture=h,t.bindTexture=d,t.unbindTexture=function(e,t){(0,n.viewerCheck)(e);var i=e.getTextureUnit(t);i>=0&&(e.bindTextureToUnit(null,i),e.releaseTextureUnit(t))},t.getTextureSize=p,t.createRGBATexture=function(e,t,i,r){(0,n.viewerCheck)(e);var o=e.getGlContext(),s=o.createTexture(),c="createRGBATexture temporary",l=e.getOrAllocateTextureUnit(c);if(l<0)return null;try{e.bindTextureToUnit(s,l),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,i,0,o.RGBA,r,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),e.bindTextureToUnit(null,l),e.releaseTextureUnit(c)}catch(e){throw a.log.warn("BEL-56217 - exception while creating texture with width "+t+", height: "+i+", precision: "+r+", exception: "+e),e}return s}},735297:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAtlasFromResources=t.getMaximumTextureSize=t.TextureAtlas=t.ImageData=void 0;var r=i(423902),n=i(165542),o=i(311611),s=function(){this.id="",this.imageName="",this.backgroundColor="rgba(0,0,0,0)",this.index=-1};t.ImageData=s;var a=function(){function e(e,t){this.viewer=e,this.options=t,this.sources=null,this.imageSize=0,this.gridSize=0,this.textureSize=0,this.texture=null,this.canvas=null,(0,o.viewerCheck)(e)}return e.prototype.getCanvasPosition=function(e){var t=e%this.gridSize,i=(e-t)/this.gridSize;return[t*this.imageSize,i*this.imageSize]},e.prototype.onReceivedImages=function(e){var t=this;this.canvas=document.createElement("canvas"),this.canvas.width=this.textureSize,this.canvas.height=this.textureSize,this.options.debugCanvas&&(this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.bottom="0",this.canvas.style.zIndex="1000",document.body.append(this.canvas));var i=this.canvas.getContext("2d");i.fillStyle="rgba(0, 0, 0, 0)",i.fillRect(0,0,this.textureSize,this.textureSize),e.forEach((function(e,r){var n=t.sources[r],o=t.getCanvasPosition(r);i.fillStyle=n.backgroundColor,i.fillRect(o[0],o[1],t.imageSize,t.imageSize),e&&i.drawImage(e,o[0],o[1],t.imageSize,t.imageSize)})),this.texture=new o.Texture(this.viewer,(function(e){var r=new o.TextureDefinition(e);if(r.width=t.canvas.width,r.height=t.canvas.height,t.options.clearColorOverride){for(var n=i.getImageData(0,0,t.canvas.width,t.canvas.height).data,s=0;s<n.length;s+=4)0===n[s+3]&&(n[s]=t.options.clearColorOverride[0],n[s+1]=t.options.clearColorOverride[1],n[s+2]=t.options.clearColorOverride[2],n[s+3]=t.options.clearColorOverride[3]);r.bytes=n}else r.canvas=t.canvas;return r.magnificationFilter=e.LINEAR,r.minificationFilter=e.LINEAR_MIPMAP_LINEAR,r.maxAnisotropy=4,r.useMipmaps=!0,r})),this.texture.setHasTransparency(this.options.sourcesHaveTransparency)},e.prototype.onImageGetFailed=function(e){},e.prototype.getTextureCoords=function(e){var t=this.sources.find((function(t){return t.id===e}));if(!t)return null;var i=this.getCanvasPosition(t.index);return{lowS:i[0]/this.textureSize,highS:(i[0]+this.imageSize)/this.textureSize,lowT:i[1]/this.textureSize,highT:(i[1]+this.imageSize)/this.textureSize}},e.prototype.getTextureCoordsOffset=function(e,t){var i=this.sources.find((function(t){return t.id===e}));if(!i)return null;var r=this.getCanvasPosition(i.index);return{lowS:(r[0]+t)/this.textureSize,highS:(r[0]+this.imageSize-t)/this.textureSize,lowT:(r[1]+t)/this.textureSize,highT:(r[1]+this.imageSize-t)/this.textureSize}},e}();function c(){return 1024}t.TextureAtlas=a,t.getMaximumTextureSize=c,t.createAtlasFromResources=function(e,t,i,s){var c=Math.ceil(Math.sqrt(i.length)),l=(0,o.getNextPowerOfTwo)(c*t);if(l>1024||0===c)return n.fcall((function(){return null}));var u=new a(e,s);u.sources=(0,r.__spreadArray)([],(0,r.__read)(i),!1),u.gridSize=c,u.imageSize=t,u.textureSize=l;var h=[];return u.sources.forEach((function(e,t){e.index=t;var i=n.defer();h.push(i.promise);var r=new Image;r.onload=function(){i.resolve(r)},r.src="/images/"+e.imageName})),n.all(h).then((function(e){return u.onReceivedImages(e),u}),(function(e){return u.onImageGetFailed(e),null}))}},49627:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=t.MATE_INDICATOR_ATLAS=t.CONSTRAINT_ATLAS=void 0,t.CONSTRAINT_ATLAS="constraints",t.MATE_INDICATOR_ATLAS="mates";var i=function(){function e(){this.creationPromises={}}return e.prototype.getAtlas=function(e,t){var i=this.creationPromises[e];return i||(i=t(),this.creationPromises[e]=i),i},e}();t.Factory=i},255589:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.createTextureFromText=t.findTextBounds=t.displayCanvasInDom=t.orientText=t.drawTextIntoCanvas=t.makeRoundedRectanglePath=t.drawBorderIntoCanvas=t.drawBackgroundIntoCanvas=t.createTextCanvas=t.measureTextWidth=t.fillCanvasWithTransparentColor=t.setupContextForText=t.getUtilityContext=t.getBlankCanvas=t.DEFAULT_OPTIONS=t.TextTexture=t.CanvasTextureDefinition=void 0;var n=i(423902),o=i(673290),s=i(311611),a=i(311517),c=i(911748),l=function(e,t,i,r,n){this.canvas=e,this.filledWidthPx=t,this.filledHeightPx=i,this.leftPixel=r,this.topPixel=n};t.CanvasTextureDefinition=l;var u=function(e){function t(t,i){var r=e.call(this,t,(function(e){return r.textureCreationFunction(e)}))||this;r.canvasCreationFunction=i,r.width=-1,r.height=-1,r.filledWidthPx=-1,r.filledHeightPx=-1,r.leftCoordinate=-1,r.rightCoordinate=-1,r.bottomCoordinate=-1,r.topCoordinate=-1;return r.createTexture(),r}return(0,n.__extends)(t,e),t.prototype.createTexturedQuad=function(){return(0,s.createQuad)([0,0,0],[this.filledWidthPx,0,0],[0,this.filledHeightPx,0],"textQuad",[this.leftCoordinate,this.bottomCoordinate],[this.rightCoordinate,this.topCoordinate])},t.prototype.textureCreationFunction=function(e){var t=this.canvasCreationFunction(e);this.width=t.canvas.width,this.height=t.canvas.height,this.filledWidthPx=t.filledWidthPx,this.filledHeightPx=t.filledHeightPx,this.leftCoordinate=t.leftPixel/t.canvas.width,this.rightCoordinate=this.leftCoordinate+t.filledWidthPx/t.canvas.width,this.topCoordinate=t.topPixel/t.canvas.height,this.bottomCoordinate=this.topCoordinate+t.filledHeightPx/t.canvas.height;var i=new s.TextureDefinition(e);return i.canvas=t.canvas,i.magnificationFilter=e.LINEAR,i.minificationFilter=e.LINEAR_MIPMAP_LINEAR,i.maxAnisotropy=4,i.wrapS=e.CLAMP_TO_EDGE,i.wrapT=e.CLAMP_TO_EDGE,i.useMipmaps=!0,i},t}(s.Texture);function h(e,t){var i=document.createElement("canvas");return i.width=(0,s.getNextPowerOfTwo)(e),i.height=(0,s.getNextPowerOfTwo)(t),i}t.TextTexture=u,t.DEFAULT_OPTIONS={font:"Arial",heightPx:10,weight:"",color:"#000000"},t.getBlankCanvas=h;var d=null;function p(){if(!d){var e=h(128,128);d=e.getContext("2d")}return d}function g(e,i){i=Object.assign({},t.DEFAULT_OPTIONS,i),e.font=(i.weight?i.weight+" ":"")+i.heightPx+"px "+i.font,e.textAlign="left",e.fillStyle=i.color,e.globalAlpha=1,e.textBaseline="hanging"}t.getUtilityContext=p,t.setupContextForText=g;function f(e,t){for(var i=e.getContext("2d"),r=i.getImageData(0,0,e.width,e.height),n=[t[0],t[1],t[2],1],o=r.data.length/4,s=0;s<o;++s)for(var a=0;a<4;++a)r.data[4*s+a]=n[a];return i.putImageData(r,0,0),n}function m(e,t){var i=p();return g(i,t),i.measureText(e).width}function y(e,t){return h(e,t)}function v(e,t,i,r,n,o,s,a){var c=e.getContext("2d");f(e,n),a=(a||0)+1,c.fillStyle="rgba("+n[0]+","+n[1]+","+n[2]+","+o+")",I(c,t,i,r,s,a),c.fill()}function E(e,t,i,r,n,o,s,a,c,l){var u=e.getContext("2d");l||f(e,n),u.strokeStyle="rgba("+n[0]+","+n[1]+","+n[2]+", 1.0)",u.setLineDash([a,c]),u.lineWidth=s,I(u,t,i,r,o+s/2,s/2+1),u.stroke()}function I(e,t,i,r,n,o){var s=o,a=o;t-=2*o,i-=2*o,e.beginPath(),e.moveTo(s+n,a+r),e.arcTo(s+t,a+r,s+t,a+r+i,n),e.arcTo(s+t,a+r+i,s,a+r+i,n),e.arcTo(s,a+r+i,s,a+r,n),e.arcTo(s,a+r,s+t,a+r,n),e.closePath()}function T(e,t,i,r,n){var o=i.getContext("2d");g(o,t),o.fillText(e,r,n),i.filledWithText=e}t.fillCanvasWithTransparentColor=f,t.measureTextWidth=m,t.createTextCanvas=y,t.drawBackgroundIntoCanvas=v,t.drawBorderIntoCanvas=E,t.makeRoundedRectanglePath=I,t.drawTextIntoCanvas=T,t.orientText=function(e,t,i,r){r&&(r=c.mat4.toMat3(r),t=c.mat3.multiply(r,t,c.vec3.create()),i=c.mat3.multiply(r,i,c.vec3.create()));var n=e.getRight(),s=e.getForward(),a=e.up,l=c.vec3.dot(t,n),u=!1;l<=-o.Tolerances.ZERO_LENGTH?u=!0:l<=o.Tolerances.ZERO_LENGTH&&(u=c.vec3.dot(t,a)<=o.Tolerances.ZERO_LENGTH);var h=u?c.vec3.scale(t,-1,c.vec3.create()):t,d=c.vec3.cross(h,s,c.vec3.create());return[u,c.vec3.dot(i,d)<=-o.Tolerances.ZERO_LENGTH]};var S=null;function P(e,t,i,r,n,o){var a=f(e,i);T(t,r,e,n,n+o);for(var l=e.getContext("2d"),u=new s.BoundingBox2D,h=0;h<e.height;++h)for(var d=l.getImageData(0,h,e.width,1),p=0;p<d.width;++p)if(d.data[4*p+3]>1){var g=d.data.subarray(4*p,4*(p+1));c.vec4.distanceSquared(a,g)>256&&u.addPointXY(p,h)}return u}t.displayCanvasInDom=function(e){S||(S=r('<div style="z-index:999999;margin:5px;position:fixed;left:0;bottom:0"></div>').appendTo("body")),r(e).css({background:"yellow",margin:"0 5px"}),r(e).appendTo(S)},t.findTextBounds=P,t.createTextureFromText=function(e,t,i){var r=i.color,n=i.font,o=i.size,s=i.fontWeight,c=i.paddingWithinBorder,h=i.backgroundColor,d=i.backgroundOpacity,p=i.backgroundRadius,g=i.borderColor,I=i.borderThickness,S=i.dashLength,_=i.dashGapLength,M=i.underlineWidth;return new u(e,(function(e){var i=[Math.floor(255*r[0]),Math.floor(255*r[1]),Math.floor(255*r[2])],u={color:"rgb("+i[0]+","+i[1]+","+i[2]+")",font:n,heightPx:o,weight:s},D=(c=c||0)+(I=I||0),C=Math.max(2,Math.ceil(.25*o)),O=Math.ceil(m(t,u))+2*D;O=Math.min(O,e.getParameter(e.MAX_TEXTURE_SIZE));var A=o+2*D,R=y(O,A+2*C),N=R.getContext("2d"),w=P(R,t,i,u,D,C);w.isInitialized()||(a.log.warn("Did not find canvas bounds for text: "+t),w.addPointXY(0,C),w.addPointXY(O,C+A));var b=w.min[1];h?v(R,O,A,b-D,[Math.floor(255*h[0]),Math.floor(255*h[1]),Math.floor(255*h[2]),Math.floor(255*d)],d=d||1,p=p||0,I):f(R,i);g&&E(R,O,A,b-D,[Math.floor(255*g[0]),Math.floor(255*g[1]),Math.floor(255*g[2])],p||0,I,S||1,_||0,!!h);var L=w.getDimensions(),F=D+C+Math.floor((o-L[1])/2);if(M){N.strokeStyle=u.color,N.lineWidth=M,N.beginPath();var B=F+Math.floor(.95*o)-.5*M;N.moveTo(D,B),N.lineTo(O-D,B),N.stroke()}return T(t,u,R,D,F),new l(R,O,A,0,b-D)}))}},558518:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateThumbnails=t.getViewerFitPoints=t.getDataUri=t.getFeatureThumbnailKey=t.getPartThumbnailKey=t.getPartStudioThumbnailKey=t.setSketchNeedsThumbnail=t.removeThumbnailForKey=t.setThumbnailForKey=t.getThumbnailForKey=t.setPartThumbnailNeedsToBeRerendered=void 0;var r=i(311611),n=i(73055),o=i(487152),s=i(712197),a=i(311517),c=i(524627),l=i(227441),u=i(911748),h=window.document.createElement("canvas"),d=window.document.createElement("canvas"),p={},g={},f={};function m(e,t){var i=(0,r.getTimeInMilliseconds)();p[e]=[i,t]}function y(e){delete p[e]}t.setPartThumbnailNeedsToBeRerendered=function(e){g[e]=!0},t.getThumbnailForKey=function(e){var t=(0,r.getTimeInMilliseconds)(),i=p[e];return i?t-i[0]<n.default.getManager().getNumber("THUMBNAIL_LOCAL_EXPIRATION_INTERVAL")?i[1]:(y(e),null):null},t.setThumbnailForKey=m,t.removeThumbnailForKey=y,t.setSketchNeedsThumbnail=function(e){f[e]=!0};var v=new r.Settings;function E(e,t,i,r){return e+"-"+t+"-"+i+"x"+r}function I(e,t,i,r){return e+"-"+t+"-"+i+"x"+r}function T(e,t,i,r){return e+"-"+t+"-"+i+"x"+r}function S(e,t,i,r){h.width=e,h.height=t,d.width=e/r,d.height=t/r;var n=h.getContext("2d"),o=n.createImageData(e,t);o.data.set(i),n.putImageData(o,0,0);var s=d.getContext("2d");return s.translate(0,t/r),s.scale(1/r,-1/r),s.drawImage(h,0,0),d.toDataURL()}function P(e){var t=e.getPrimaryViewController().getZoomFitTargetCamera(e.getCamera().getFrame(),e.getFitBounds());e.pushCameraState(t),e.getBodyManager().updateForFrame(e.getRenderContext()),e.renderContext.prepareForNextFrame(),e.depthSamplingPass.retrieve(e.getRenderContext(),{includePlanes:!0,performIsolationTest:!0}),e.popCameraState();for(var i=[],r=0;r<e.depthSamplingPass.points.length;++r)i.push(t.canvasToWorld(e.depthSamplingPass.points[r]));return i}v.enableSSAO=!1,v.enableEdgeSilhouettes=!1,v.enableBackfaceSilhouettes=!1,t.getPartStudioThumbnailKey=E,t.getPartThumbnailKey=I,t.getFeatureThumbnailKey=T,t.getDataUri=S,t.getViewerFitPoints=P,t.generateThumbnails=function(e,t,i){if(e.getCamera()){var h=e.getModelViewManagers().getManager(),d=h.partStudios[h.getDisplayedFullElementId()];if(d){c.LeaderFollowController.getController().pauseListeningForRedraw();var y=d.bodyComponent,_=d.sketchComponent,M=o.DocumentClientCache.getSingleton().getComputedData(h.getDisplayedElementId()),D=(0,r.getTimeInMilliseconds)(),C=n.default.getManager().getNumber("THUMBNAIL_PART_RENDER_LIMIT"),O=n.default.getManager().getNumber("THUMBNAIL_PART_RENDER_TIME_LIMIT");d.removeInContextAssemblies();var A=e.getGlContext(),R=e.getOrCreateFrameBuffer(A.UNSIGNED_BYTE,"",{storageType:A.DEPTH_STENCIL,attachmentType:A.DEPTH_STENCIL_ATTACHMENT});e.setUserIsManipulatingWithTimeout(),e.detailManager.setOverrideSettings(v),e.getEventDispatcher().trigger(r.WILL_RENDER_THUMBNAILS);var N=e.getRenderingMode();e.setRenderingMode(l.GBTGraphicsRenderMode.SHADED_WITH_EDGES),e.getIsolatedOccurrenceManager().clearAllIsolateNoAnimation(),e.disableCurrentLaminarHighlightController();var w=e.getPrimaryViewController();w.isPerspective()&&e.setPrimaryViewController(w.getMatchingOrthographicController()),e.viewManipulator&&e.viewManipulator.hide();var b=e.getCamera().clone(),L=null,F=(0,r.isOrderIndependentTransparencyEnabled)();(0,r.setOrderIndependentTransparencyEnabled)(!1);var B=d.getHideableFeatureIds(),x=[];for(var U in y.bodyMetaData){(ie=y.retrieveBodyMetaData(U))&&ie.shouldProduceLocalThumbnail()&&x.push(U)}var G=[];for(var H in d.sketchComponent.sketchToSketchEntityMapping)f[H]&&G.push(H);for(var V=M?G.length:0,k=function(e,t,i,r){t&&t.forEach((function(t){var n=e.extractMeshIncrement(t);if(n)for(var o=u.vec3.create(),s=0;s<n.points.length;s+=3*i)o[0]=n.points[s],o[1]=n.points[s+1],o[2]=n.points[s+2],r(o);return!1}))},W=E(h.getDisplayedElementId(),h.displayedElementMicroversionIdAndConfiguration.getKey(),t,i),j=(!(W in p)),z=0,X=0;X<x.length&&z<C;X++){(te=I(h.getDisplayedElementId(),x[X],t,i))in g&&z++}if(j||z>0||V>0){for(var H in d.sketchComponent.sketchToSketchEntityMapping)d.imageComponent.onSketchHidden(H);d.planeComponent.getHideableFeatureIds().forEach((function(e){d.planeComponent.hideShowFeature(e,r.Visibility.HIDDEN)}));var q=d.pointBodyComponent.featureToIds.firstKey();q&&d.pointBodyComponent.hideShowFeature(q,r.Visibility.HIDDEN),d.mateConnectorComponent.getHideableFeatureIds().forEach((function(e){d.mateConnectorComponent.hideShowFeature(e,r.Visibility.HIDDEN)})),e.getEdgePointController()&&(e.getEdgePointController().removeAllEdgePointUiElements((0,s.getSelectionList)()),e.getEdgePointController().purgeEdgePointUiElements()),L=(0,r.saveAndClearState)(),e.viewController.setStandardView("Trimetric")}var Y=P(e),Z=[0,0,2*t,2*i],K=[1,1,2*t-2,2*i-2];e.renderContext.pushViewport(Z),e.getCamera().setViewport(Z),R.update(e.renderContext);var Q=R.width*R.height*4,$=new Uint8Array(Q);if(R.bindBuffer(),j&&(e.getCamera().zoomToFit(Y,1.05,K),e.draw(),A.readPixels(0,0,R.width,R.height,A.RGBA,A.UNSIGNED_BYTE,$),m(W,S(R.width,R.height,$,2))),z>0||V>0){for(X=0;X<B.length;X++)for(var J=0;J<d.components.length;++J)d.components[J].hasFeature(B[X])&&(B[X]in d.sketchComponent.sketchToSketchEntityMapping?d.hideSketch(B[X]):d.components[J].hideShowFeature(B[X],r.Visibility.HIDDEN));for(var U in y.partStudioBodyIdToOccurrenceId)y.setBodyCullingState(y.partStudioBodyIdToOccurrenceId[U],r.CullingState.CULLED,U);e.getBodyManager().setVisible(!1)}if(z>0){e.viewController.setStandardView("Trimetric");var ee=0;for(X=0;X<x.length&&ee<C&&(0,r.getTimeElapsed)(D)<O;X++){var te;if((te=I(h.getDisplayedElementId(),x[X],t,i))in g){var ie,re=[];(ie=y.retrieveBodyMetaData(x[X])).isOpenCompositeBody?re=y.getInstantiableConstituentIds(ie):re.push(x[X]);var ne=null;if(ie.isComposite){ne=[];for(J=0;J<ie.constituentBodyIds.length;++J){y.bodyToEntity.get(ie.constituentBodyIds[J])&&(ne=ne.concat(y.bodyToEntity.get(ie.constituentBodyIds[J]).getKeys()))}}else ne=y.bodyToEntity.get(x[X]).getKeys();for(J=0;J<re.length;++J)y.setBodyCullingState(y.partStudioBodyIdToOccurrenceId[re[J]],r.CullingState.VISIBLE,re[J]),y.hideShowBody(re[J],r.Visibility.VISIBLE,y.partStudioBodyIdToOccurrenceId[re[J]]);e.getCamera().zoomToFit(k.bind(void 0,y,ne,2),1,K),e.draw(0,{skipUpdateBodyCulling:!0}),A.readPixels(0,0,R.width,R.height,A.RGBA,A.UNSIGNED_BYTE,$),m(te,S(R.width,R.height,$,2));for(J=0;J<re.length;++J)y.setBodyCullingState(y.partStudioBodyIdToOccurrenceId[re[J]],r.CullingState.CULLED,re[J]);delete g[te],ee++}}}if(V>0)for(X=0;X<G.length&&!((0,r.getTimeElapsed)(D)>=O);++X){H=G[X];var oe=M.computedData[H];if(oe&&oe.planeMatrix){var se=void 0;if(_.featureToIds.get(H)&&(se=_.featureToIds.get(H).getKeys()),!se)continue;var ae=T(h.getDisplayedElementId(),H,t,i);d.sketchComponent.hideShowFeature(H,r.Visibility.VISIBLE);var ce=oe.planeMatrix,le=[ce.m00,ce.m10,ce.m20,0,ce.m01,ce.m11,ce.m21,0,ce.m02,ce.m12,ce.m22,0,0,0,0,1],ue=e.getCamera().clone();ue.setFrame(le),e.getCamera().copyFrom(ue),e.getCamera().zoomToFit(k.bind(void 0,_,se,1),1.05,K),e.draw(0,{skipUpdateBodyCulling:!0}),A.readPixels(0,0,R.width,R.height,A.RGBA,A.UNSIGNED_BYTE,$),m(ae,S(R.width,R.height,$,2)),d.sketchComponent.hideShowFeature(H,r.Visibility.HIDDEN)}}R.unbindBuffer(),R.destroy(),e.renderContext.popViewport(),e.getCamera().copyFrom(b),e.viewManipulator&&e.viewManipulator.show(),e.detailManager.setOverrideSettings(null),e.setRenderingMode(N),e.setPrimaryViewController(w),e.getBodyManager().setVisible(!0),L&&(0,r.loadState)(L),(0,r.setOrderIndependentTransparencyEnabled)(F),c.LeaderFollowController.resumeListeningForRedraw();var he=(0,r.getTimeInMilliseconds)();f={},e.getEventDispatcher().trigger(r.DID_RENDER_THUMBNAILS),a.log.trace("thumbnailgenerator.generateThumbnail time "+(he-D))}}}},483556:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Triad=t.RotationComponentToAxesIndexMap=void 0;var r=i(423902),n=i(73055),o=i(911748),s=i(970846),a=i(925300),c=i(311611),l=n.default.getManager();t.RotationComponentToAxesIndexMap=new Map([[a.ComponentNames.X_ROTATION.toString(),a.OriginAxesIndex.X],[a.ComponentNames.Y_ROTATION.toString(),a.OriginAxesIndex.Y],[a.ComponentNames.Z_ROTATION.toString(),a.OriginAxesIndex.Z]]);var u=[{zeroAngle:[0,1,0],axis:[1,0,0]},{zeroAngle:[0,0,1],axis:[0,1,0]},{zeroAngle:[1,0,0],axis:[0,0,1]}],h=[a.ComponentNames.X_ROTATION,a.ComponentNames.Y_ROTATION,a.ComponentNames.Z_ROTATION],d=[[1,0,0],[0,1,0],[0,0,1]],p=[a.ComponentNames.X_DIRECTION,a.ComponentNames.Y_DIRECTION,a.ComponentNames.Z_DIRECTION],g=[[[1,0,0],[0,1,0]],[[1,0,0],[0,0,1]],[[0,1,0],[0,0,1]]],f=[a.ComponentNames.XY_PLANE,a.ComponentNames.XZ_PLANE,a.ComponentNames.YZ_PLANE],m=[{zeroAngle:[0,0,1],axis:[1,0,0]},{zeroAngle:[0,0,1],axis:[0,1,0]}],y=[a.ComponentNames.X_ROTATION,a.ComponentNames.Y_ROTATION],v=[[0,0,1]],E=[a.ComponentNames.Z_DIRECTION],I=[],T=[],S=[{zeroAngle:[1,0,0],axis:[0,0,1]}],P=[a.ComponentNames.X_ROTATION],_=[[1,0,0],[0,1,0]],M=[a.ComponentNames.X_DIRECTION,a.ComponentNames.Y_DIRECTION],D=[[[1,0,0],[0,1,0]]],C=[a.ComponentNames.XY_PLANE],O=[{scaleDirection:[1,1,0],normal:[0,0,1]}],A=[a.ComponentNames.SCALING],R=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;n.angularDirections=[],n.angularNames=[],n.linearDirections=[],n.linearNames=[],n.planarDirections=[],n.planarNames=[],n.scalingDirections=[],n.scalingNames=[],n.initialTransform=null,n.originalTransform=null,n.childComponents=[],n.scalingPreTransform=null,n.freeDragManipulator=null,n.linearManipulators=[],n.planarManipulators=[],n.angularManipulators=[],n.scalingManipulators=[],n.activeManipulator=null,n.preManipulationAngle=0,n.disableInactiveComponents=!0,n.disabledComponents=new Set,i||(i=s.TriadManipulatorType.FULL),r||(r={displayEditView:!1});var R,N=!0;switch(i){case s.TriadManipulatorType.FULL:n.angularDirections=u,n.angularNames=h,n.linearDirections=d,n.linearNames=p,n.planarDirections=g,n.planarNames=f;break;case s.TriadManipulatorType.PLANE:n.angularDirections=m,n.angularNames=y,n.linearDirections=v,n.linearNames=E,n.planarDirections=I,n.planarNames=T;break;case s.TriadManipulatorType.DRAG:n.angularDirections=[],n.angularNames=[],n.linearDirections=d,n.linearNames=p,n.planarDirections=g,n.planarNames=f,N=!1;break;case s.TriadManipulatorType.SKETCH:n.angularDirections=S,n.angularNames=P,n.linearDirections=_,n.linearNames=M,n.planarDirections=D,n.planarNames=C,n.scalingDirections=O,n.scalingNames=A;break;case s.TriadManipulatorType.EXPLODE_CONVENIENCE_MANIPULATOR:n.angularDirections=u,n.angularNames=h,n.linearDirections=d,n.linearNames=p,n.planarDirections=[],n.planarNames=[],N=!0}n.transform=o.mat4.identity(),N&&(n.freeDragManipulator=new c.FreeDrag(n.viewer,r),n.freeDragManipulator.setId(a.ComponentNames.FREE_DRAG),n.freeDragManipulator.setTriadOwnerType(i),n.listenTo(n.freeDragManipulator,s.ManipulatorEvents.VALUE_CHANGED,n.onFreeDragChanged),n.listenTo(n.freeDragManipulator,s.ManipulatorEvents.MANIPULATION_STARTED,n.onFreeDragStarted),n.listenTo(n.freeDragManipulator,s.ManipulatorEvents.MANIPULATION_ENDED,n.onFreeDragEnded),n.childComponents.push(n.freeDragManipulator));var w=n,b=function(e){w.listenTo(w.linearManipulators[e],s.ManipulatorEvents.VALUE_CHANGED,(function(t,i){w.updateFromLinearManipulator(e,i)})),w.listenTo(w.linearManipulators[e],s.ManipulatorEvents.VALUE_EDITED,(function(){w.updateOnEditFromLinearManipulator(e)}))};for(R=0;R<n.linearDirections.length;++R){var L=new c.Linear(n.viewer,r);L.setVisualGap(n.freeDragManipulator?l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX"):0),L.setShaftLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX")),L.setFadeParameters(l.getNumber("MANIPULATOR_TRIAD_LINEAR_FADE_ANGLE_START"),l.getNumber("MANIPULATOR_TRIAD_LINEAR_FADE_ANGLE_END")),L.setId(n.linearNames[R]),L.setTriadOwnerType(i),n.linearManipulators.push(L),n.childComponents.push(L),b(R)}var F=function(e){w.listenTo(w.planarManipulators[e],s.ManipulatorEvents.VALUE_CHANGED,(function(t,i){w.updateFromPlanarManipulator(e,i)}))};for(R=0;R<n.planarDirections.length;++R){var B=new c.Planar(n.viewer,r);B.setVisualGap(l.getNumber("MANIPULATOR_TRIAD_PLANAR_OFFSET_PX")),B.setSideLength(l.getNumber("MANIPULATOR_TRIAD_PLANAR_SIDE_LENGTH_PX")),B.setId(n.planarNames[R]),B.setTriadOwnerType(i),n.planarManipulators.push(B),n.childComponents.push(B),F(R)}var x=function(e){w.listenTo(w.angularManipulators[e],s.ManipulatorEvents.VALUE_CHANGED,(function(){w.updateFromAngularManipulator(e)})),w.listenTo(w.angularManipulators[e],s.ManipulatorEvents.CACHE_TRANSFORM,(function(){w.initialTransform=o.mat4.create(w.transform)})),w.listenTo(w.angularManipulators[e],s.ManipulatorEvents.VALUE_EDITED,(function(){w.updateOnEditFromAngularManipulator(e)}))},U=l.getNumber("MANIPULATOR_TRIAD_ANGULAR_GAP_PX")+l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX")+l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX")+l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX");for(R=0;R<n.angularDirections.length;++R){var G=new c.Angular(n.viewer,r);G.setRadialOffset(U),G.setFadeParameters(l.getNumber("MANIPULATOR_TRIAD_ANGULAR_FADE_ANGLE_START"),l.getNumber("MANIPULATOR_TRIAD_ANGULAR_FADE_ANGLE_END")),G.setId(n.angularNames[R]),G.setTriadOwnerType(i),n.angularManipulators.push(G),n.childComponents.push(G),x(R)}var H=function(e){w.listenTo(w.scalingManipulators[e],s.ManipulatorEvents.VALUE_CHANGED,(function(t,i){w.updateFromScalingManipulator(e,i)})),w.listenTo(w.scalingManipulators[e],s.ManipulatorEvents.VALUE_EDITED,(function(){w.updateOnEditFromScalingManipulator(e)}))};for(R=0;R<n.scalingDirections.length;++R){var V=new c.ScalingManipulator(n.viewer,r);V.setGapLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX")*Math.sqrt(2)),V.setHeadLength(l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX")),V.setId(n.scalingNames[R]),V.setTriadOwnerType(i),n.scalingManipulators.push(V),n.childComponents.push(V),H(R)}for(R=0;R<n.childComponents.length;++R)n.listenTo(n.childComponents[R],s.ManipulatorEvents.MANIPULATION_STARTED,n.onManipulationStarted),n.listenTo(n.childComponents[R],s.ManipulatorEvents.MANIPULATION_ENDED,n.onManipulationEnded),n.listenTo(n.childComponents[R],c.UiEvents.COMMAND,n.onCommand),n.listenTo(n.childComponents[R],s.ManipulatorEvents.CLICKED,n.onManipulatorClicked),n.listenTo(n.childComponents[R],s.ManipulatorEvents.DOUBLE_CLICKED,n.onManipulatorDoubleClicked);return n.preManipulationTransform=o.mat4.create(n.transform),n.updateComponentManipulators(),n}return(0,r.__extends)(t,e),t.prototype.onDevicePixelRatioChanged=function(e){for(var t=0;t<this.planarManipulators.length;++t)this.planarManipulators[t].setVisualGap(l.getNumber("MANIPULATOR_TRIAD_PLANAR_OFFSET_PX")),this.planarManipulators[t].setSideLength(l.getNumber("MANIPULATOR_TRIAD_PLANAR_SIDE_LENGTH_PX"));for(t=0;t<this.linearManipulators.length;++t)this.linearManipulators[t].setVisualGap(this.freeDragManipulator?l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX"):0),this.linearManipulators[t].setShaftLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX"));var i=l.getNumber("MANIPULATOR_TRIAD_ANGULAR_GAP_PX")+l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX")+l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX")+l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX");for(t=0;t<this.angularManipulators.length;++t)this.angularManipulators[t].setRadialOffset(i);for(t=0;t<this.scalingManipulators.length;++t)this.scalingManipulators[t].setGapLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX")),this.scalingManipulators[t].setHeadLength(l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"))},t.prototype.remove=function(){e.prototype.remove.call(this);for(var t=0;t<this.childComponents.length;++t)this.childComponents[t].remove()},t.prototype.setIsEnabled=function(e){for(var t=0;t<this.childComponents.length;++t)this.childComponents[t].setIsEnabled(e)},t.prototype.setDisableInactiveComponents=function(e){this.disableInactiveComponents=e},t.prototype.setIsLocked=function(e){this.freeDragManipulator&&this.freeDragManipulator.setIsLocked(e)},t.prototype.onManipulationStarted=function(e){if(this.preManipulationTransform=o.mat4.create(this.transform),this.initialTransform||(this.initialTransform=o.mat4.create(this.transform)),this.originalTransform||(this.originalTransform=o.mat4.create(this.transform)),this.activeManipulator=e,e!==this.freeDragManipulator&&this.disableInactiveComponents)for(var t=0;t<this.childComponents.length;++t)this.childComponents[t].setIsEnabled(e===this.childComponents[t]);for(t=0;t<this.scalingManipulators.length;++t)this.scalingManipulators[t]!==e?(this.scalingManipulators[t].resetScale(),this.scalingPreTransform=void 0):this.scalingPreTransform||(this.scalingPreTransform=o.mat4.create(this.transform));if(e instanceof c.Linear||e instanceof c.Planar)this.trigger(a.TriadEvents.TRANSLATION_START);else if(e instanceof c.Angular){var i=e.getAxis().direction;this.preManipulationAngle=e.getAngle();var r=[this.transform[12],this.transform[13],this.transform[14]];this.trigger(a.TriadEvents.ROTATION_START,r,i)}else e instanceof c.ScalingManipulator&&this.trigger(a.TriadEvents.SCALING_START);this.trigger(s.ManipulatorEvents.MANIPULATION_STARTED)},t.prototype.onManipulationEnded=function(){this.activeManipulator instanceof c.Angular?this.trigger(a.TriadEvents.ROTATION_END,this.transform):this.activeManipulator instanceof c.Linear||this.activeManipulator instanceof c.Planar?this.trigger(a.TriadEvents.TRANSLATION_END,this.transform):this.activeManipulator instanceof c.ScalingManipulator&&this.trigger(a.TriadEvents.SCALING_END),this.activeManipulator=null,this.preManipulationAngle=0;for(var e=0;e<this.childComponents.length;++e)this.disabledComponents.has(this.childComponents[e].getId())||this.childComponents[e].setIsEnabled(!0);this.updateComponentManipulators(),this.trigger(s.ManipulatorEvents.MANIPULATION_ENDED)},t.prototype.onCommand=function(e,t){if(t&&e){var i=[];i[a.OriginAxesIndex.Origin]=[this.transform[12],this.transform[13],this.transform[14]],i[a.OriginAxesIndex.X]=[this.transform[0],this.transform[1],this.transform[2]],i[a.OriginAxesIndex.Y]=[this.transform[4],this.transform[5],this.transform[6]],i[a.OriginAxesIndex.Z]=[this.transform[8],this.transform[9],this.transform[10]],this.trigger(a.TriadEvents.COMMAND,e,t.getId(),i)}},t.prototype.onManipulatorClicked=function(e){this.trigger(s.ManipulatorEvents.CLICKED,e)},t.prototype.onManipulatorDoubleClicked=function(e){this.trigger(a.TriadEvents.DOUBLE_CLICKED,e)},t.prototype.updateDefinition=function(e){this.transform=e,this.updateComponentManipulators()},t.prototype.getTranslationSinceManipulationBegan=function(){return o.vec4.subtract(o.mat4.multiplyVec4(this.transform,[0,0,0,1]),o.mat4.multiplyVec4(this.preManipulationTransform,[0,0,0,1]))},t.prototype.getMouseRayForFreeDrag=function(){return this.activeManipulator instanceof c.FreeDrag?this.activeManipulator.getLastMouseRay():null},t.prototype.getActiveRotationAxis=function(){return this.activeManipulator instanceof c.Angular?this.activeManipulator.getAxis():null},t.prototype.getActiveRotationZeroAngleDirection=function(){return this.activeManipulator instanceof c.Angular?this.activeManipulator.getZeroAngleDirection():null},t.prototype.getActiveRotationAngle=function(){return this.activeManipulator instanceof c.Angular?this.activeManipulator.getAngle():0},t.prototype.setActiveRotationAngle=function(e){if(this.activeManipulator instanceof c.Angular){this.activeManipulator.setAngle(e);var t=o.mat4.rotate(o.mat4.identity(),e,this.activeManipulator.getAxis().direction),i=o.mat4.toMat3(this.preManipulationTransform);o.mat3.multiply(o.mat4.toMat3(t),i,i);for(var r=0;r<3;++r){var n=o.vec3.normalize([i[3*r+0],i[3*r+1],i[3*r+2]]);this.transform[4*r+0]=n[0],this.transform[4*r+1]=n[1],this.transform[4*r+2]=n[2]}this.updateComponentManipulators()}},t.prototype.updateFromLinearManipulator=function(e,t){this.updateOrigin(this.linearManipulators[e].getOffsetPosition()),this.trigger(a.TriadEvents.TRANSLATION_CHANGE,this.getTranslationSinceManipulationBegan(),this.linearManipulators[e],t)},t.prototype.updateOnEditFromLinearManipulator=function(e){var t=this.linearManipulators[e],i=o.vec3.subtract(t.getEditOffsetPosition(),t.ray.point,o.vec3.create()),r=o.vec4.createFrom(i[0],i[1],i[2],0);this.updateOrigin(t.getEditOffsetPosition()),this.trigger(a.TriadEvents.TRANSLATION_EDIT,r)},t.prototype.updateFromPlanarManipulator=function(e,t){this.updateOrigin(this.planarManipulators[e].getOffsetPosition()),this.trigger(a.TriadEvents.TRANSLATION_CHANGE,this.getTranslationSinceManipulationBegan(),this.planarManipulators[e],t)},t.prototype.processUpdateFromAngularManipulator=function(e,t,i){var r=o.mat4.rotate(o.mat4.identity(),i,this.angularManipulators[e].getAxis().direction),n=o.mat4.toMat3(t);o.mat3.multiply(o.mat4.toMat3(r),n,n);for(var s=0;s<3;++s)this.transform[4*s+0]=n[3*s],this.transform[4*s+1]=n[3*s+1],this.transform[4*s+2]=n[3*s+2];this.updateComponentManipulators()},t.prototype.updateFromAngularManipulator=function(e){this.processUpdateFromAngularManipulator(e,this.preManipulationTransform,this.angularManipulators[e].getAngle()),this.trigger(a.TriadEvents.ROTATION_CHANGE,this.getActiveRotationAngle(),this.getActiveRotationAxis(),this.getActiveRotationZeroAngleDirection())},t.prototype.updateOnEditFromAngularManipulator=function(e){var t=this.angularManipulators[e],i=t.getAxis().direction,r=[this.transform[12],this.transform[13],this.transform[14]],n=o.mat4.create(this.transform),s=t.getEditAngleDisplacement();this.processUpdateFromAngularManipulator(e,this.initialTransform,t.getEditAngle()),this.trigger(a.TriadEvents.ROTATION_EDIT,n,s,i,r)},t.prototype.processScalingTransform=function(e,t){var i=o.mat4.createFrom(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);this.transform=o.mat4.multiply(t,i,o.mat4.create())},t.prototype.updateFromScalingManipulator=function(e,t){this.processScalingTransform(this.scalingManipulators[e].getScale(),this.scalingPreTransform),this.trigger(a.TriadEvents.SCALING_CHANGE)},t.prototype.updateOnEditFromScalingManipulator=function(e){this.processScalingTransform(this.scalingManipulators[e].getScale(),this.scalingPreTransform),this.trigger(a.TriadEvents.SCALING_EDIT)},t.prototype.updateOrigin=function(e){for(var t=0;t<3;++t)this.transform[12+t]=e[t];this.updateComponentManipulators()},t.prototype.getOrigin=function(){return[this.transform[12],this.transform[13],this.transform[14]]},t.prototype.getOriginalOrigin=function(){return[this.originalTransform[12],this.originalTransform[13],this.originalTransform[14]]},t.prototype.onFreeDragStarted=function(){this.trigger(a.TriadEvents.REPOSITION_START,this.transform)},t.prototype.onFreeDragChanged=function(e,t,i,r){this.updateOrigin(e),this.trigger(a.TriadEvents.REPOSITION,t,i,this.transform,r)},t.prototype.onFreeDragEnded=function(){this.trigger(a.TriadEvents.REPOSITION_END,this.transform)},t.prototype.updateComponentManipulators=function(){var e,t=[this.transform[12],this.transform[13],this.transform[14]];this.freeDragManipulator&&(this.freeDragManipulator!==this.activeManipulator||this.freeDragManipulator.getIsLocked())&&this.freeDragManipulator.updateDefinition(t);var i=o.mat4.toMat3(this.transform);for(e=0;e<this.linearManipulators.length;++e)if(this.linearManipulators[e]!==this.activeManipulator||this.linearManipulators[e].getIsLocked()){var r=o.vec3.normalize(o.mat3.multiplyVec3(i,this.linearDirections[e],o.vec3.create()));this.linearManipulators[e].updateDefinition(t,r)}for(e=0;e<this.planarManipulators.length;++e)if(this.planarManipulators[e]!==this.activeManipulator||this.planarManipulators[e].getIsLocked()){var n=o.vec3.normalize(o.mat3.multiplyVec3(i,this.planarDirections[e][0],o.vec3.create())),s=o.vec3.normalize(o.mat3.multiplyVec3(i,this.planarDirections[e][1],o.vec3.create()));this.planarManipulators[e].updateDefinition(t,n,s,[0,0])}for(e=0;e<this.angularManipulators.length;++e)(this.angularManipulators[e]!==this.activeManipulator||this.angularManipulators[e].getIsLocked())&&this.angularManipulators[e].updateDefinition(t,o.vec3.normalize(o.mat3.multiplyVec3(i,this.angularDirections[e].axis,o.vec3.create())),o.vec3.normalize(o.mat3.multiplyVec3(i,this.angularDirections[e].zeroAngle,o.vec3.create())),0);for(e=0;e<this.scalingManipulators.length;++e)if(this.scalingManipulators[e]!==this.activeManipulator||this.scalingManipulators[e].getIsLocked()){var a=o.vec3.normalize(o.mat3.multiplyVec3(i,this.scalingDirections[e].scaleDirection,o.vec3.create())),c=o.vec3.normalize(o.mat3.multiplyVec3(i,this.scalingDirections[e].normal,o.vec3.create()));this.scalingManipulators[e].updateDefinition(t,c,a)}},t.prototype.updateAngleRange=function(e,t){for(var i=0;i<this.angularManipulators.length;++i)this.angularManipulators[i].updateLimits(e,t)},t.prototype.updateEditAngleRange=function(e,t){for(var i=0;i<this.angularManipulators.length;++i)this.angularManipulators[i].updateEditLimits(e,t)},t.prototype.reset=function(e){this.originalTransform&&this.updateDefinition(o.mat4.create(this.originalTransform));for(var t=0;t<this.linearManipulators.length;++t){var i=this.linearManipulators[t].initialRay;i&&(i.point=this.getOriginalOrigin())}e.removeEditViewAndHighlights()},t.prototype.disableComponent=function(e){this.disabledComponents.add(e)},t.prototype.disableXYManipulators=function(){this.linearManipulators.forEach((function(e){e.getId()!==a.ComponentNames.X_DIRECTION&&e.getId()!==a.ComponentNames.Y_DIRECTION||e.setIsEnabled(!1)})),this.angularManipulators.forEach((function(e){e.getId()!==a.ComponentNames.X_ROTATION&&e.getId()!==a.ComponentNames.Y_ROTATION||e.setIsEnabled(!1)})),this.scalingManipulators.forEach((function(e){e.setIsEnabled(!1)})),this.disableComponent(a.ComponentNames.X_DIRECTION),this.disableComponent(a.ComponentNames.Y_DIRECTION),this.disableComponent(a.ComponentNames.X_ROTATION),this.disableComponent(a.ComponentNames.Y_ROTATION)},t.prototype.enableXYManipulators=function(){this.disabledComponents.clear()},t}(c.Manipulator);t.Triad=R},145620:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fillInDefaultAttributes=t.UIElement=t.NO_SELECTION_ID=t.UiEvents=void 0;var r,n=i(423902),o=i(663748),s=i(73055),a=i(911748),c=i(311517),l=i(311611),u=s.default.getManager();!function(e){e.MOUSE_ENTER="mouseenter:",e.MOUSE_MOVE="mousemove:",e.MOUSE_LEAVE="mouseleave:",e.DOUBLE_CLICK="doubleclick:",e.CLICK="click:",e.DRAG_START="dragstart:",e.DRAG="drag:",e.DRAG_STOP="dragstop:",e.SELECT="select:",e.DESELECT="deselect:",e.COMMAND="command:",e.LONG_PRESS_START="longpressstart:",e.LONG_PRESS_END="longpressend:"}(r=t.UiEvents||(t.UiEvents={})),t.NO_SELECTION_ID="";var h=new l.IdManager,d=function(e,i){this.nodeProperties=e,this.meshIncrement=i,this.selectionId=t.NO_SELECTION_ID},p=function(e){function t(t,i){var r=e.call(this)||this;return r.viewer=t,r.SHARED_DELETION_DETAILS={wasHidden:!1,wasHiddenFromPick:!1,highlights:null},r.nameToMeshIncrement={},r.isHidden=!1,r.isTransparent=!1,r.transform=null,r.normalTransform=null,r.isBeingDragged=!1,r.id="",r.incrementRanges={},r.highlights=[],r.allocatedHighlights=[],r.hasBeenRemoved=!1,r.removeHighlightFromOccurrence=function(e){for(var t=""+this.graphicsOccurrenceId,i=null,r=-1,n=0;n<this.allocatedHighlights.length;++n){if((a=this.allocatedHighlights[n]).selectionId===t&&e===a.highlightType){i=a,r=n;break}}if(i){this.allocatedHighlights.splice(r,1);var o=this.viewer.getHighlightManager(this.getUsage()),s=o.freeHighlightForSelection(i.highlightType,i.selectionId);if((0,l.idIsValid)(s)){var a=o.constructHighlightForTypeAndInstance(e,s);this.occurrenceData.updateOccurrenceHighlight(l.Action.REMOVE,a,this.getUsage())}}},(0,l.viewerCheck)(t),r.sceneGraphId=i||l.MAIN_SCENEGRAPH_ID,r.collectionId=l.COLLECTION_ID_PREFIX+h.getId(),r.graphicsOccurrenceId=r.viewer.getOccurrenceIdManager().getOrCreateIdForName(r.collectionId),r.meshOwnerId=(0,l.getNewOwnerId)(),r.occurrenceData=r.viewer.getOccurrenceDataManager().setOccurrenceTransform(r.graphicsOccurrenceId,a.mat4.identity()),r.idManager=new l.NamedIdManager(l.IdSizes.ENTITY),r.viewer.addUIElement(r),r.listenTo(r.viewer.getEventDispatcher(),l.DEVICE_PIXEL_RATIO_CHANGED,r.onDevicePixelRatioChanged),r.occurrenceData.setIsolated(!0),r.occurrenceData.setCanIsolateChange(!1),r}return(0,n.__extends)(t,e),t.prototype.getDebugId=function(){return"UIElement"},t.prototype.getOccurrenceData=function(){return this.occurrenceData},t.prototype.onDevicePixelRatioChanged=function(e){},t.prototype.remove=function(){this.hasBeenRemoved?c.log.warn("Attempted to remove ui element "+this.getDebugId()+"-"+this.meshOwnerId+" multiple times"):(this.hasBeenRemoved=!0,this.stopListening(),this.viewer&&this.viewer.removeUIElement(this),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(this.graphicsOccurrenceId),this.viewer.getOccurrenceIdManager().removeName(this.collectionId),this.removeMeshIncrements(),this.freeAllocatedHighlights())},t.prototype.freeAllocatedHighlights=function(){for(var e=this.viewer.getHighlightManager(this.getUsage()),t=0;t<this.allocatedHighlights.length;++t){var i=this.allocatedHighlights[t];e.freeHighlightForSelection(i.highlightType,i.selectionId)}},t.prototype.getMeshManager=function(){return this.viewer.getUiResourceManager().getMeshManager()},t.prototype.getNode=function(){return this.viewer.getUiResourceManager().getNode(this.sceneGraphId)},t.prototype.getCollectionId=function(){return this.collectionId},t.prototype.removeMeshIncrements=function(){for(var e in this.nameToMeshIncrement)this.removeMeshIncrement(e);this.nameToMeshIncrement={},this.viewer.requestDraw()},t.prototype.hasMeshIncrements=function(){return!(0,l.isMapEmpty)(this.nameToMeshIncrement)},t.prototype.containsMeshIncrementWithName=function(e){return this.nameToMeshIncrement.hasOwnProperty(e)},t.prototype.getInstantiatedMeshIncrement=function(e){return this.nameToMeshIncrement[e]||null},t.prototype.shouldBeClearedWithSelections=function(){return!0},t.prototype.getId=function(){return this.id},t.prototype.setId=function(e){this.id=e},t.prototype.isVisibleToUser=function(){return!this.isTransparent&&!this.isHidden},t.prototype.hideIncrements=function(){for(var e in this.nameToMeshIncrement)this.hideInstantiatedMeshIncrement(e,this.nameToMeshIncrement[e])},t.prototype.showIncrements=function(){for(var e in this.nameToMeshIncrement)this.showInstantiatedMeshIncrement(e,this.nameToMeshIncrement[e])},t.prototype.hideIncrement=function(e){var t=this.nameToMeshIncrement[e];t&&this.hideInstantiatedMeshIncrement(e,t)},t.prototype.hide=function(){(0,l.viewerCheck)(this.viewer),this.isVisibleToUser()&&this.hideIncrements(),this.isHidden=!0,this.viewer.requestDraw()},t.prototype.show=function(){(0,l.viewerCheck)(this.viewer);var e=this.isVisibleToUser();this.isHidden=!1,!e&&this.isVisibleToUser()&&this.showIncrements(),this.viewer.requestDraw()},t.prototype.makeTransparent=function(){this.isVisibleToUser()&&this.hideIncrements(),this.isTransparent=!0},t.prototype.makeOpaque=function(){var e=this.isVisibleToUser();this.isTransparent=!1,!e&&this.isVisibleToUser()&&this.showIncrements()},t.prototype.isInteractionEnabled=function(){return!0},t.prototype.getClearModelSelectionsOnPrehilite=function(){return!0},t.prototype.getTransform=function(){return this.transform},t.prototype.setTransform=function(e){e?(this.transform=a.mat4.create(e),this.viewer.getOccurrenceDataManager().setOccurrenceTransform(this.graphicsOccurrenceId,e)):(this.transform=null,this.viewer.getOccurrenceDataManager().setOccurrenceTransform(this.graphicsOccurrenceId,a.mat4.identity()))},t.prototype.transformPoint=function(e){return this.transform?a.mat4.multiplyVec3(this.transform,e,a.vec3.create()):a.vec3.create(e)},t.prototype.getSelection=function(e,t){if(this.graphicsOccurrenceId!==e)return c.log.warn("An attempt was made to get a selection from a ui element with the wrong occurrence id"),null;var i=this.idManager.getNameForId(t);if(!i)return null;var r=this.nameToMeshIncrement[i];return r?new l.UISelection(this,r.selectionId,i):null},t.prototype.canPickThrough=function(){return!1},t.prototype.getModelSelection=function(e){return null},t.prototype.getPickPriority=function(e){return null},t.prototype.getUsage=function(){return l.bt_graphics_Usage.BASE},t.prototype.setIncrementPickId=function(e,t){t.pickId=this.idManager.getOrCreateIdForName(e)},t.prototype.updateMeshIncrement=function(e,t,i,r){var n=this;if(r){g(i);var o=this.removeMeshIncrement(e);i.id=e,this.setIncrementPickId(e,i);var s=new d(r,i);s.selectionId=t;var a=this.getMeshManager().addMeshIncrement(i,this.meshOwnerId);if(a){var c=this.incrementRanges[r.id];if(!c){this.incrementRanges[r.id]=c=new l.IncrementRanges(this.getDebugId()+" - "+r.toString(!0));var u=new l.Style;this.getNode().addOccurrenceGeometryToNode(r,this.occurrenceData,u,c)}c.onIncrementAdded(a)}this.nameToMeshIncrement[e]=s,o&&(o.wasHidden&&this.hideIncrement(e),o.wasHiddenFromPick&&this.hideIncrementFromPick(e),o.highlights&&o.highlights.forEach((function(t){n.addHighlightToIncrement(e,t)}))),this.viewer.requestDraw()}},t.prototype.updateIncrementAttribute=function(e,t,i){var r=this.nameToMeshIncrement[e];if(r){var n=this.getMeshManager().getMeshForIncrement(r.meshIncrement);n&&n.updateIncrementAttribute(t,r.meshIncrement.getFullId(),i)}},t.prototype.removeMeshIncrement=function(e){var t=this.nameToMeshIncrement[e],i=null;return t&&(i=this.removeInstantiatedMeshIncrement(e,t),this.viewer.requestDraw()),i},t.prototype.removeInstantiatedMeshIncrement=function(e,t){this.idManager.removeName(e);var i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId),r=this.SHARED_DELETION_DETAILS;if(i){var n=this.getUsage();r.wasHidden=this.occurrenceData.isIncrementHidden(i,n),r.wasHiddenFromPick=this.occurrenceData.isIncrementHiddenFromPick(i,n),r.highlights=this.occurrenceData.getEntityHighlights(i,n),r.highlights&&this.occurrenceData.removeEntityHighlights(i,n)}else r.wasHidden=!1,r.wasHiddenFromPick=!1,r.highlights=null;if(this.getMeshManager().removeMeshIncrement(e,this.meshOwnerId),i){var o=this.incrementRanges[t.nodeProperties.id];o&&(o.onIncrementRemoved(i),o.isEmpty()&&(this.getNode().removeOccurrenceFromNode(t.nodeProperties,this.graphicsOccurrenceId),delete this.incrementRanges[t.nodeProperties.id]))}return delete this.nameToMeshIncrement[e],r},t.prototype.hideInstantiatedMeshIncrement=function(e,t){var i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.hideIncrement(i,this.getUsage())},t.prototype.showInstantiatedMeshIncrement=function(e,t){var i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.showIncrement(i,this.getUsage())},t.prototype.hideIncrementFromPick=function(e){var t=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);t&&this.occurrenceData.hideIncrementFromPick(t,this.getUsage())},t.prototype.addHighlight=function(e){(0,l.addHighlightToList)(e,this.highlights)},t.prototype.removeHighlight=function(e){return(0,l.removeHighlightFromList)(e,this.highlights,!1)>=0},t.prototype.isHighlighted=function(){return this.highlights.length>0},t.prototype.getHighlight=function(){return this.isHighlighted()?this.highlights[this.highlights.length-1]:null},t.prototype.triggerMouseEnter=function(e,t){this.isBeingDragged||this.trigger(r.MOUSE_ENTER+e.selectionId,e,t)},t.prototype.triggerMouseMove=function(e,t){this.isBeingDragged||this.trigger(r.MOUSE_MOVE+e.selectionId,e,t)},t.prototype.triggerMouseLeave=function(e,t){this.isBeingDragged||this.trigger(r.MOUSE_LEAVE+e.selectionId,e,t)},t.prototype.triggerClick=function(e,t){var i={requestSelectedStatus:!1};return this.trigger(r.CLICK+e.selectionId,e,t,i),i.requestSelectedStatus},t.prototype.triggerDoubleClick=function(e,t){var i={requestSelectedStatus:!1};return this.trigger(r.DOUBLE_CLICK+e.selectionId,e,t,i),i.requestSelectedStatus},t.prototype.triggerSelect=function(e){this.trigger(r.SELECT+e.selectionId,e)},t.prototype.triggerDeselect=function(e){this.trigger(r.DESELECT+e.selectionId,e)},t.prototype.triggerDragStart=function(e,t){var i={requestDrag:!1};return this.trigger(r.DRAG_START+e.selectionId,e,t,i),this.isBeingDragged=i.requestDrag,i.requestDrag},t.prototype.triggerDrag=function(e,t){this.trigger(r.DRAG+e.selectionId,e,t)},t.prototype.triggerDragStop=function(e,t){this.trigger(r.DRAG_STOP+e.selectionId,e,t),this.isBeingDragged=!1},t.prototype.triggerLongPressStart=function(e,t){this.trigger(r.LONG_PRESS_START+e.selectionId,e,t)},t.prototype.triggerLongPressEnd=function(e,t){this.trigger(r.LONG_PRESS_END+e.selectionId,e,t)},t.prototype.addHighlightToIncrement=function(e,t){var i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.updateEntityHighlight(l.Action.ADD,t,i,this.getUsage())},t.prototype.removeHighlightFromIncrement=function(e,t){var i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.updateEntityHighlight(l.Action.REMOVE,t,i,this.getUsage())},t.prototype.addNewHighlightToIncrement=function(e,t){var i=e+"."+this.graphicsOccurrenceId,r=this.viewer.getHighlightManager(this.getUsage()).createHighlightForSelection(t,i);return this.addHighlightToIncrement(e,r),this.allocatedHighlights.push({selectionId:i,highlightType:t}),r},t.prototype.addNewHighlightToOccurrence=function(e){var t=""+this.graphicsOccurrenceId,i=this.viewer.getHighlightManager(this.getUsage()).createHighlightForSelection(e,t);this.occurrenceData.updateOccurrenceHighlight(l.Action.ADD,i,this.getUsage()),this.allocatedHighlights.push({selectionId:t,highlightType:e})},t.prototype.preventsSketching=function(){return!0},t.prototype.getFitBounds=function(){return null},t.prototype.onViewWillDraw=function(e,t){},t.prototype.isViewManipulator=function(){return!1},t.prototype.onDefaultUnitsChanged=function(e){},t.prototype.onIsolateRemoved=function(){},t.prototype.isDimension=function(){return!1},t.prototype.isManipulator=function(){return!1},t.prototype.onHighlightColorUpdated=function(){},t}(o.BackboneEventsBaseClass);function g(e){if(e.primitiveType===l.PrimitiveType.TRIANGLES||e.primitiveType===l.PrimitiveType.TRIANGLE_STRIP){if(e.colors||(0,l.addColorToIncrement)(u.getColor("DEFAULT_TRIANGLE_COLOR"),e),!e.textureCoordinates){(0,l.addTextureCoordinateToIncrement)([0,0],e)}e.normals||(0,l.addNormalToIncrement)([0,0,1],e)}else e.primitiveType===l.PrimitiveType.LINES?(e.colors||(0,l.addColorToIncrement)(u.getColor("DEFAULT_MATERIAL_COLOR"),e),e.primitiveSizes||(0,l.addSizeToIncrement)(u.getNumber("DEFAULT_LINE_WIDTH"),e),e.primitiveStyles||(0,l.addStyleToIncrement)(u.getStipple("DEFAULT_LINE_STIPPLE"),e)):e.primitiveType===l.PrimitiveType.POINTS&&(e.colors||(0,l.addColorToIncrement)(u.getColor("DEFAULT_MATERIAL_COLOR"),e),e.primitiveSizes||(0,l.addSizeToIncrement)(u.getNumber("DEFAULT_POINT_SIZE"),e),e.primitiveStyles||(0,l.addStyleToIncrement)(u.getPointFont("DEFAULT_POINT_FONT"),e))}t.UIElement=p,t.fillInDefaultAttributes=g},807147:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOccurrenceNameForUi=t.COLLECTION_ID_PREFIX=void 0,t.COLLECTION_ID_PREFIX="uielement.",t.isOccurrenceNameForUi=function(e){return!!e&&0===e.indexOf(t.COLLECTION_ID_PREFIX)}},300005:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceManager=void 0;var r=i(311611),n=function(){function e(e,t){var i=this;this.viewer=e,this.sceneGraphs=t,this.nodes={},this.meshManager=new r.MeshManager(this.viewer,{bufferAllocationPolicy:r.BufferAllocationPolicy.MEDIUM}),this.onSessionEnded=function(){i.meshManager.destroy(),i.viewer.getEventDispatcher().off(r.SESSION_ENDED,i.onSessionEnded)},this.viewer.getEventDispatcher().on(r.SESSION_ENDED,this.onSessionEnded)}return e.prototype.getMeshManager=function(){return this.meshManager},e.prototype.getNode=function(e){if(!this.nodes[e]){var t=new r.Node("uinode");this.nodes[e]=t,this.sceneGraphs.getSceneGraph(e).getRootNode().addChild(t)}return this.nodes[e]},e.prototype.destroyPreviewGraphics=function(){delete this.nodes[r.PREVIEW_SCENEGRAPH_ID]},e.prototype.clean=function(){for(var e in this.meshManager.removeEmptyMeshes(),this.nodes)this.nodes[e].cleanEmptyMeshNodes()},e}();t.ResourceManager=n},317179:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UISelectionManager=t.UISelection=void 0;var r=i(712197),n=function(){function e(e,t,i){this.selectionId=t,this.meshIncrementId=i,this.sourcePick=null,this.uiElement=e}return e.prototype.equals=function(e){return!!e&&(this.uiElement===e.uiElement&&this.selectionId===e.selectionId)},e.prototype.hideFromPick=function(){this.uiElement.hideIncrementFromPick(this.meshIncrementId)},e.prototype.canPickThrough=function(){return this.uiElement.canPickThrough()},e.prototype.getModelSelection=function(){return this.uiElement.getModelSelection(this)},e.prototype.getPickPriority=function(){return this.uiElement.getPickPriority(this)},e.prototype.isInteractionEnabled=function(){return this.uiElement.isInteractionEnabled()},e.prototype.preventsSketching=function(){return this.uiElement.preventsSketching()},e}();t.UISelection=n;var o=function(){function e(){this.hoveredSelection=null,this.selection=null}return e.prototype.removeSelectionForUiElement=function(e){this.hoveredSelection&&this.hoveredSelection.uiElement===e&&(this.hoveredSelection.uiElement.triggerMouseLeave(this.hoveredSelection,{}),this.hoveredSelection=null),this.selection&&this.selection.uiElement===e&&(this.selection=null)},e.prototype.reset=function(){this.hoveredSelection=null,this.selection=null},e.prototype.getHoveredSelection=function(){return this.hoveredSelection},e.prototype.isHoveringOverViewManipulator=function(){return!!this.hoveredSelection&&!!this.hoveredSelection.uiElement&&this.hoveredSelection.uiElement.isViewManipulator()},e.prototype.getSelection=function(){return this.selection},e.prototype.uiSelectionShouldBeClearedWithSelections=function(){return!!this.selection&&!!this.selection.uiElement&&!!this.selection.uiElement.shouldBeClearedWithSelections()},e.prototype.overrideHoveredSelection=function(e){this.hoveredSelection&&e&&this.hoveredSelection.equals(e)||!this.hoveredSelection&&!e||(this.hoveredSelection=e)},e.prototype.setHoveredSelection=function(e,t){this.hoveredSelection&&e&&this.hoveredSelection.equals(e)||!this.hoveredSelection&&!e?this.hoveredSelection&&this.hoveredSelection.uiElement.triggerMouseMove(this.hoveredSelection,t):(this.hoveredSelection&&(t.nextSelection=e,this.hoveredSelection.uiElement.triggerMouseLeave(this.hoveredSelection,t)),this.hoveredSelection=e,this.hoveredSelection&&this.hoveredSelection.uiElement.triggerMouseEnter(this.hoveredSelection,t))},e.prototype.setSelection=function(e){(this.selection||e)&&(this.selection&&this.selection.uiElement.triggerDeselect(this.selection),e&&e.equals(this.selection)?this.selection=null:(this.selection=e,this.selection&&((0,r.getSelectionList)().reset(),this.selection.uiElement.triggerSelect(this.selection))))},e.prototype.processUiPick=function(e,t){var i=null,r=null,n=!1;return e.isUIPick()&&e.uiSelection.isInteractionEnabled()&&(r=e.uiSelection),this.setHoveredSelection(r,t),r&&t.click?n=r.uiElement.triggerClick(r,t):r&&t.doubleClick&&(n=r.uiElement.triggerDoubleClick(r,t)),n&&(i=r),(t.click||t.doubleClick)&&!(r&&!n)&&this.setSelection(i),!!r},e.prototype.handleEmptyUiPick=function(e,t){e?this.setHoveredSelection(null,t):t.click&&this.setSelection(null)},e}();t.UISelectionManager=o},950204:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPartstudioElementIdFromContextId=t.getAssemblyInContextElementId=t.getColorStringArray=t.getColorString=t.getHasLongPressHandlerCapability=t.getHasFeatureQLVFacePatternCapability=t.setSubtract=t.arraySubtract=t.concatenateUint8Arrays=t.concatenateFloat32Arrays=t.getTimeElapsed=t.getTimeInMilliseconds=t.convertRGBA255ToRGBA=t.convertRGBToRGBA255=t.convertRGBAToRGBA255=t.isMapEmpty=t.decodeAngle=t.decodeDepth=t.decodeFloat=t.DEPTH_PASS_CLEAR_COLOR=t.UNKNOWN_DEPTH=t.PICK_CLEAR_COLOR=t.decodePickingIndex=t.encodePickingIndex=t.convertIntToUcharArray=t.graphicsTakesSelectionPrecedence=t.isInSectionPlaneMode=t.setIsInSectionPlaneMode=t.isInFollowMode=t.setIsInFollowMode=t.requestDrawForInteractiveProcessing=t.forceRequestDraw=t.requestDraw=t.requestDrawUsingAnimationFrame=t.requestDrawUsingTimer=t.removeDrawer=t.getDrawerForId=t.getDrawer=t.getDrawers=t.addDrawer=t.getTagIntCount=t.isSSAOSupported=t.isHighPrecisionFragmentShaderSupported=t.isSpaceballSupported=t.isOrderIndependentTransparencyEnabled=t.setOrderIndependentTransparencyEnabled=t.CullingState=t.visibilityDescriptor=t.Visibility=t.addDebuggableChild=void 0,t.makeSceneDebugObjectFromObject=t.addChildDebugObjectsFromProperties=t.createTextDebugObject=t.zeroOutArrayBuffer=t.flipImageVertically=t.cacheCapabilities=void 0;var r=i(311517),n=i(194598),o=i(507025),s=i(320078),a=i(311611);t.addDebuggableChild=function(e,t){t&&e.children.push(t.makeSceneDebugObject())};var c,l=!0;function u(e){if(!e)return!1;var t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);return!!t&&t.precision>0}!function(e){e[e.HIDDEN=0]="HIDDEN",e[e.VISIBLE=1]="VISIBLE"}(c=t.Visibility||(t.Visibility={})),t.visibilityDescriptor=function(e){switch(e){case c.HIDDEN:return"hidden";case c.VISIBLE:return"visible"}return"unknown"},function(e){e[e.CULLED=0]="CULLED",e[e.VISIBLE=1]="VISIBLE"}(t.CullingState||(t.CullingState={})),t.setOrderIndependentTransparencyEnabled=function(e){l=e},t.isOrderIndependentTransparencyEnabled=function(){return l},t.isSpaceballSupported=function(){return(0,s.isPlatformWindows)()||(0,s.isPlatformMac)()},t.isHighPrecisionFragmentShaderSupported=u,t.isSSAOSupported=function(e){if((0,s.isPlatformMac)()){var t=(0,a.getRendererInfo)(e);if(new RegExp(".*intel.*[3|4]000.*","i").test(t.glRenderer))return!1}return u(e)},t.getTagIntCount=function(e){return Math.ceil(e.length/5)};var h={};function d(e){for(var t in h)h[t].requestDrawUsingTimer(null,null,e)}function p(e){for(var t in h)h[t].requestDrawUsingAnimationFrame(null,null,e)}t.addDrawer=function(e,t){h[e]=t},t.getDrawers=function(){return h},t.getDrawer=function(){return(0,a.getActiveViewer)()},t.getDrawerForId=function(e){return h[e]},t.removeDrawer=function(e){delete h[e]},t.requestDrawUsingTimer=d,t.requestDrawUsingAnimationFrame=p;var g=d;function f(e){return g(e)}window.requestAnimationFrame&&(g=p),t.requestDraw=f,t.forceRequestDraw=function(){f(!0)},t.requestDrawForInteractiveProcessing=function(){d()};var m=!1;function y(){return m}t.setIsInFollowMode=function(e,t){m=t},t.isInFollowMode=y;var v=!1;function E(){return v}function I(e,t){return t?((e[2]<<16)+(e[1]<<8)+e[0])/16777215:((e[1]<<8)+e[0])/16383}t.setIsInSectionPlaneMode=function(e){v=e},t.isInSectionPlaneMode=E,t.graphicsTakesSelectionPrecedence=function(){return y()||E()},t.convertIntToUcharArray=function(e){var t=new Uint8Array(4);return t[0]=e>>>24&255,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=255&e,t},t.encodePickingIndex=function(e){var t=1/255;return[(e>>>24&255)*t,(e>>>16&255)*t,(e>>>8&255)*t,(255&e)*t]},t.decodePickingIndex=function(e,t,i,r){return(e<<24)+(t<<16)+(i<<8)+r},t.PICK_CLEAR_COLOR=[0,0,0,0],t.UNKNOWN_DEPTH=-1,t.DEPTH_PASS_CLEAR_COLOR=[1,1,1,0],t.decodeFloat=I,t.decodeDepth=function(e,i){return 255*t.DEPTH_PASS_CLEAR_COLOR[3]===e[3]?t.UNKNOWN_DEPTH:I(e,i)},t.decodeAngle=function(e,t){return 0===e[3]?null:I(e,t)*Math.PI},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)},t.isMapEmpty=function(e){var t;for(t in e)return!1;return!0},t.convertRGBAToRGBA255=function(e){return[(0,a.clamp)(Math.floor(255*e[0]),0,255),(0,a.clamp)(Math.floor(255*e[1]),0,255),(0,a.clamp)(Math.floor(255*e[2]),0,255),(0,a.clamp)(Math.floor(255*e[3]),0,255)]},t.convertRGBToRGBA255=function(e){return[(0,a.clamp)(Math.floor(255*e[0]),0,255),(0,a.clamp)(Math.floor(255*e[1]),0,255),(0,a.clamp)(Math.floor(255*e[2]),0,255),255]},t.convertRGBA255ToRGBA=function(e){return[e[0]/255,e[1]/255,e[2]/255,e[3]/255]};var T=null;function S(){return T()}T=window.performance&&window.performance.now?function(){return window.performance.now()}:function(){return(new Date).getTime()},t.getTimeInMilliseconds=S,t.getTimeElapsed=function(e){return S()-e},t.concatenateFloat32Arrays=function(e,t){var i=new Float32Array(e.length+t.length);return i.set(e),i.set(t,e.length),i},t.concatenateUint8Arrays=function(e,t){var i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i},t.arraySubtract=function(e,t){return 0===e.length?[]:0===t.length?e:1===e.length&&1===t.length?e[0]===t[0]?[]:e:(0,o.difference)(e,t)},t.setSubtract=function(e,t){var i=new Set;return e.forEach((function(e){t.has(e)||i.add(e)})),i};var P=!1,_=!1;t.getHasFeatureQLVFacePatternCapability=function(){return P},t.getHasLongPressHandlerCapability=function(){return _};var M=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function D(e,t){if(e.length<3)return r.log.warn("Attempting to create a color string with a color of insufficient length"),"#000000";for(var i="#",n=0;n<3;++n){var o=t?e[n]:0|Math.round(255*e[n]);i+=M[o>>4&15],i+=M[15&o]}return i}t.getColorString=D,t.getColorStringArray=function(e){for(var t=[],i=0;i<e.length;++i){t.push(D(e[i],!0))}return t},t.getAssemblyInContextElementId=function(e,t,i){return e+"."+t+"."+i},t.getPartstudioElementIdFromContextId=function(e){var t=e.split(".");return t.length>1?t[1]:""},t.cacheCapabilities=function(){n.btInjector.CapabilitiesService.isFeatureQLVFacePatternEnabled().then((function(e){P=e})),n.btInjector.CapabilitiesService.isLongPressHandlerEnabled().then((function(e){_=e})),n.btInjector.CapabilitiesService.checkNotifyThirdPartiesToSaveCurrentlyEnabled()},t.flipImageVertically=function(e,t,i){for(var r=4*t,n=new Uint8Array(r),o=Math.floor(i/2),s=0;s<o;++s){var a=e.subarray(s*r,(s+1)*r),c=i-1-s,l=e.subarray(c*r,(c+1)*r);n.set(l),l.set(a),a.set(n)}};var C=new ArrayBuffer(1e4),O=new Uint8Array(C);function A(e,t){return{text:e+": ("+t+")",children:[]}}function R(e,t,i){for(var r in t)!t.hasOwnProperty(r)||i&&i.hasOwnProperty(r)||e.push(A(r,t[r]));return e}t.zeroOutArrayBuffer=function(e,t){for(var i=new Uint8Array(e),r=0;r<t;r+=O.length){var n=O;n.length>i.length-r&&(n=new Uint8Array(C,0,i.length-r)),i.set(n,r)}},t.createTextDebugObject=A,t.addChildDebugObjectsFromProperties=R,t.makeSceneDebugObjectFromObject=function(e,t){return{text:t,children:R([],e)}}},114328:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenOccupancyMap=void 0;for(var r=i(911748),n=i(673290),o=i(553944),s=r.vec2.create(),a=r.vec2.create(),c=[],l=0;l<4;++l)c.push(r.vec2.create());var u=new o.BoundingBox2D,h=function(){function e(){this.occupiedBounds=[]}return e.prototype.clearOccupiedRegions=function(){this.occupiedBounds=[]},e.prototype.addOccupiedRegion=function(e){this.occupiedBounds.push(e)},e.prototype.getUnoccupiedOffsetAlongDirection=function(e,t){var i=u;i.copyFrom(e);for(var o=0;;){for(var l=-1/0,h=!1,d=i.center(s),p=0;p<this.occupiedBounds.length;++p)if(this.occupiedBounds[p].overlapsWith(i)){h=!0;for(var g=-1/0,f=this.occupiedBounds[p].getCorners(c),m=0;m<f.length;++m){(v=r.vec2.dot(t,r.vec2.subtract(f[m],d,a)))>g&&(g=v)}g>l&&(l=g)}if(!h)break;var y=1/0;for(f=i.getCorners(c),p=0;p<f.length;++p){var v;(v=r.vec2.dot(t,r.vec2.subtract(f[p],d,a)))<y&&(y=v)}var E=l-y;if(!(E>n.Tolerances.ZERO_LENGTH))break;i.translate(r.vec2.scale(t,E,a)),o+=E}return o},e}();t.ScreenOccupancyMap=h},4534:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMaximumVerticesPerVbo=t.getIndexElementSize=t.getIndexElementType=t.getIndexBufferType=t.initialize32BitIndexSupport=t.isRendererStringForIntel=t.isRunningIntelGpu=t.getRendererInfo=t.getUnavailableRendererInfo=t.isCpuRenderer=t.getChannelCountOfGlPixelFormat=t.GlPixelFormat=t.sizeOfGlRenderBufferType=t.GlRenderBufferType=t.sizeOfGlType=t.GlDataType=void 0;var r,n,o,s=i(311517);function a(e){switch(e){case r.BYTE:case r.UNSIGNED_BYTE:return 1;case r.SHORT:case r.UNSIGNED_SHORT:case r.HALF_FLOAT:return 2;case r.INT:case r.UNSIGNED_INT:case r.FLOAT:return 4;default:return s.log.warn("Unrecognized GL type: 0x"+e.toString(16)),0}}function c(e){if(e){var t=e.toLowerCase();return["swiftshader"].some((function(e){return t.includes(e)}))}return!1}function l(){return{glVendor:"unavailable",glRenderer:"unavailable",isCpuRenderer:!1}}function u(e){var t=null;if(e){var i=e.getExtension("WEBGL_debug_renderer_info");if(i){var r=e.getParameter(i.UNMASKED_RENDERER_WEBGL);t={glVendor:e.getParameter(i.UNMASKED_VENDOR_WEBGL),glRenderer:r,isCpuRenderer:c(r)}}else t={glVendor:"unavailable",glRenderer:"unavailable",isCpuRenderer:!1}}return t}function h(e){return!!e&&e.toLowerCase().indexOf("intel")>=0}!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=36193]="HALF_FLOAT"}(r=t.GlDataType||(t.GlDataType={})),t.sizeOfGlType=a,function(e){e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(n=t.GlRenderBufferType||(t.GlRenderBufferType={})),t.sizeOfGlRenderBufferType=function(e){switch(e){case n.STENCIL_INDEX:case n.STENCIL_INDEX8:return 1;case n.RGBA4:case n.RGB5_A1:case n.RGB565:case n.DEPTH_COMPONENT16:return 2;case n.DEPTH_STENCIL:return 4;default:return s.log.warn("Unrecognized GL render buffer type: 0x"+e.toString(16)),0}},function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(o=t.GlPixelFormat||(t.GlPixelFormat={})),t.getChannelCountOfGlPixelFormat=function(e){switch(e){case o.DEPTH_COMPONENT:case o.ALPHA:case o.LUMINANCE:return 1;case o.LUMINANCE_ALPHA:return 2;case o.RGB:return 3;case o.RGBA:return 4;default:return s.log.warn("Unrecognized GL pixel format: 0x"+e.toString(16)),0}},t.isCpuRenderer=c,t.getUnavailableRendererInfo=l,t.getRendererInfo=u,t.isRunningIntelGpu=function(e){return h(u(e).glRenderer)},t.isRendererStringForIntel=h;var d=void 0,p=null,g=null,f=null,m=null;t.initialize32BitIndexSupport=function(e){void 0===d?((d=e)?(p=Uint32Array,g=r.UNSIGNED_INT):(p=Uint16Array,g=r.UNSIGNED_SHORT),f=a(g),m=Math.pow(2,8*f)):d!==e&&s.log.warn("initialize32BitIndexSupport called twice with two different values")},t.getIndexBufferType=function(){if(!p)throw"Attempt to get indexBufferType before gl initialized";return p},t.getIndexElementType=function(){if(!g)throw"Attempt to get indexElementType before gl initialized";return g},t.getIndexElementSize=function(){if(!f)throw"Attempt to get indexElementSize before gl initialized";return f},t.getMaximumVerticesPerVbo=function(){if(!m)throw"Attempt to get maximumVerticesPerVbo before gl initialized "+(new Error).stack;return m}},949768:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitShiftId=void 0;var r=i(311517),n=i(311611),o=function(){function e(){this.id=0,this.shiftCount=0}return e.prototype.getId=function(){return this.id},e.prototype.getShiftCount=function(){return this.shiftCount},e.prototype.reset=function(){this.id=0,this.shiftCount=0},e.prototype.addNumber=function(e,t){this.id|=e<<this.shiftCount,this.shiftCount+=t},e.prototype.addBoolean=function(e){this.addNumber(e?1:0,1)},e.prototype.getIdWithIdAppended=function(e){e>=Math.pow(2,n.NUMBER_INTEGER_BITS-this.shiftCount)&&r.log.warn("Lost uniqueness in creating id with getIdWithIdAppended");var t=e*Math.pow(2,this.shiftCount);return this.id+t},e}();t.BitShiftId=o},235337:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.executePerformanceTests=t.Gauge=t.BrowserRefreshRate=t.MINIMUM_REFRESH_RATE_FPS=t.REFRESH_RATE_MEASURE_TIME_MS=t.REFRESH_RATE_MEASURE_SAMPLE_START_TIME_MS=t.EXCELLENT_GPU_RESULTS=t.Results=void 0;var r=i(423902),n=i(911748),o=i(991140),s=i(165542),a=i(320078),c=i(311611),l=new c.NodeProperties({primitiveType:c.PrimitiveType.TRIANGLE_STRIP}),u=new c.NodeProperties({primitiveType:c.PrimitiveType.LINES}),h=null,d=null;var p=function(e){function t(t,i,r){var o=e.call(this,i)||this;o.primitiveType=t;var s=n.mat4.identity();switch(s[12]=32*r.random(),s[13]=18*r.random(),s[14]=18*r.random(),o.setTransform(s),h||(h=(0,c.makeSphere)(100,100),d=(0,c.createEdgesFromTriangleStrip)(h)),o.primitiveType){case c.PrimitiveType.TRIANGLE_STRIP:o.updateMeshIncrement("s","s",h,l);break;case c.PrimitiveType.LINES:o.updateMeshIncrement("s","s",d,u)}return o}return(0,r.__extends)(t,e),t.prototype.getPrimitiveCount=function(){switch(this.primitiveType){case c.PrimitiveType.TRIANGLE_STRIP:return h.getTriangleCount();case c.PrimitiveType.LINES:return d.getLineCount()}return 0},t}(c.UIElement),g=function(){function e(e,t){this.primitiveType=e,this.viewer=t,this.primitiveCount=0,this.spheres=[],this.randomNumberGenerator=new o.MersenneTwister(0)}return e.prototype.addPrimitivesToScene=function(){for(var e=0;e<75e4;){var t=new p(this.primitiveType,this.viewer,this.randomNumberGenerator);this.spheres.push(t),this.primitiveCount+=t.getPrimitiveCount(),e+=t.getPrimitiveCount()}},e.prototype.getPrimitiveCount=function(){return this.primitiveCount},e.prototype.remove=function(){for(var e=0;e<this.spheres.length;++e)this.spheres[e].remove();this.spheres=[]},e}(),f=function(){function e(){this.trianglesPerSecond=0,this.trianglesPerSecondMeasurementHaltedEarly=!1,this.linesPerSecond=0,this.linesPerSecondMeasurementHaltedEarly=!1,this.executionTimeMs=0,this.refreshRate=0,this.testSkippedDueToLowRefreshRate=!0}return e.prototype.getScore=function(){return Math.min(this.getModelSize()/t.EXCELLENT_GPU_RESULTS.getModelSize(),1)},e.prototype.getModelSize=function(){return(5*this.linesPerSecond+this.trianglesPerSecond)/20},e}();t.Results=f,t.EXCELLENT_GPU_RESULTS=new f,t.EXCELLENT_GPU_RESULTS.trianglesPerSecond=8e7,t.EXCELLENT_GPU_RESULTS.linesPerSecond=6e7,t.REFRESH_RATE_MEASURE_SAMPLE_START_TIME_MS=1500,t.REFRESH_RATE_MEASURE_TIME_MS=3e3,t.MINIMUM_REFRESH_RATE_FPS=45;var m=function(){function e(){this.deferred=null,this.startTime=null,this.lastFrameTime=null,this.fpsSamples=[]}return e.prototype.refreshCallback=function(){var e=this,i=performance.now(),r=i-this.startTime;if(r>=t.REFRESH_RATE_MEASURE_TIME_MS){for(var n=0,o=0;o<this.fpsSamples.length;++o)n+=this.fpsSamples[o];var s=this.fpsSamples.length>0?n/this.fpsSamples.length:0;this.deferred.resolve(s)}else r>t.REFRESH_RATE_MEASURE_SAMPLE_START_TIME_MS&&null!==this.lastFrameTime&&this.fpsSamples.push(1e3/(i-this.lastFrameTime)),this.lastFrameTime=i,window.requestAnimationFrame((function(){return e.refreshCallback()}))},e.prototype.measureRefreshRate=function(){var e=this;return this.deferred||(this.deferred=s.defer(),this.startTime=window.performance.now(),window.requestAnimationFrame((function(){return e.refreshCallback()}))),this.deferred.promise},e}();t.BrowserRefreshRate=m;var y=function(){function e(e){this.viewer=e,this.deferred=null,this.frameBuffer=null,this.blitPass=null,this.canvasViewport=[0,0,1,1],this.testViewport=[0,0,1,1],this.startTime=0,this.results=new f,this.fastFrameThresholdMS=1e3/45}return e.prototype.execute=function(){var e=this;if(this.deferred)return this.deferred.promise;this.startTime=(0,c.getTimeInMilliseconds)(),this.canvasViewport=this.viewer.getCamera().getViewport(),this.testViewport=[0,0,1280,720],this.viewer.renderContext.pushViewport(this.canvasViewport),this.viewer.getCamera().setViewport(this.testViewport),this.viewer.renderContext.pushViewport(this.testViewport);var i=this.viewer.getGlContext();return this.frameBuffer=this.viewer.getOrCreateFrameBuffer(i.UNSIGNED_BYTE,"",{storageType:i.DEPTH_STENCIL,attachmentType:i.DEPTH_STENCIL_ATTACHMENT}),this.frameBuffer.update(this.viewer.renderContext),this.viewer.renderContext.popViewport(),this.blitPass=new c.BlitFramebufferPass(this.viewer,this.frameBuffer),this.deferred=s.defer(),(new m).measureRefreshRate().then((function(i){e.results.refreshRate=i,i<t.MINIMUM_REFRESH_RATE_FPS?(e.results.testSkippedDueToLowRefreshRate=!0,e.resolve()):(e.results.testSkippedDueToLowRefreshRate=!1,e.measureTrianglesPerSecond())})),this.deferred.promise},e.prototype.resolve=function(){this.frameBuffer.destroy(),this.viewer.renderContext.popViewport(),this.results.executionTimeMs=(0,c.getTimeElapsed)(this.startTime),this.deferred.resolve(this.results)},e.prototype.measureFrameTime=function(e){var t=this,i=(0,a.isBrowserSafari)()?20:5,r=!1,n=0,o=0,s=0,l=0,u={performFrameTiming:!1};this.viewer.getCamera().setViewport(this.testViewport),this.viewer.getPrimaryViewController().setStandardView("XZ"),this.viewer.zoomFit();var h=500,d=function(a){var p=(0,c.getTimeInMilliseconds)(),g=t.viewer.getPrimaryViewController();(g.rotateAbout(.0698131701,[0,0,1],g.camera.focalPoint()),s)&&(l+=p-s,++n);r?s=p:(o=p,r=!0);var f=p-o;f>500&&2500!==h&&(l/n>=t.fastFrameThresholdMS&&(h=2500));n>=i&&f>=h?e(l/n):(t.frameBuffer.bindBuffer(),t.viewer.getCamera().setViewport(t.testViewport),t.viewer.renderContext.pushViewport(t.testViewport),t.viewer.draw(a),t.viewer.renderContext.popViewport(),t.viewer.getCamera().setViewport(t.canvasViewport),t.frameBuffer.unbindBuffer(),t.blitPass.draw(t.viewer.renderContext),t.viewer.requestDraw(d,u,!0))};this.viewer.requestDraw(d,u,!0)},e.prototype.measureTrianglesPerSecond=function(){var e=this;this.measurePrimitivesPerSecond(c.PrimitiveType.TRIANGLE_STRIP,t.EXCELLENT_GPU_RESULTS.trianglesPerSecond,(function(t,i){e.results.trianglesPerSecond=t,e.results.trianglesPerSecondMeasurementHaltedEarly=i,e.measureLinesPerSecond()}))},e.prototype.measureLinesPerSecond=function(){var e=this;this.measurePrimitivesPerSecond(c.PrimitiveType.LINES,t.EXCELLENT_GPU_RESULTS.linesPerSecond,(function(t,i){e.results.linesPerSecond=t,e.results.linesPerSecondMeasurementHaltedEarly=i,e.resolve()}))},e.prototype.measurePrimitivesPerSecond=function(e,t,i){var r=this,n=new g(e,this.viewer);n.addPrimitivesToScene();var o=10*t,s=function(e){var t=n.getPrimitiveCount()/e*1e3;e<r.fastFrameThresholdMS&&t<=o?(n.addPrimitivesToScene(),r.measureFrameTime(s)):(n.remove(),r.viewer.cleanUpOrphanedObjects(),i(t,t>o))};this.measureFrameTime(s)},e}();t.Gauge=y,t.executePerformanceTests=function(e){return new y(e).execute()}},700882:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RayVisualization=void 0;var r=i(423902),n=i(311611),o=i(73055),s=i(911748),a=function(e){function t(t,i){var r=e.call(this,t)||this;r.POINT_NODE_PROPERTIES=new n.NodeProperties({primitiveType:n.PrimitiveType.POINTS,isPickable:!1}),r.LINE_NODE_PROPERTIES=new n.NodeProperties({primitiveType:n.PrimitiveType.LINES,isPickable:!1,addsToBounds:!1});var a=t.getSceneBounds().diameter(),c=o.default.getManager();if(i.point){var l=(0,n.createPoint)(i.point,void 0,c.getColor("RAY_COLOR"),c.getNumber("RAY_ORIGIN_WIDTH_PX"));r.updateMeshIncrement("point",n.NO_SELECTION_ID,l,r.POINT_NODE_PROPERTIES)}var u=(0,n.createLine)(i.point,s.vec3.add(s.vec3.scale(i.direction,a,s.vec3.create()),i.point),void 0,c.getColor("RAY_COLOR"),c.getNumber("RAY_LINE_WIDTH_PX"));return r.updateMeshIncrement("line",n.NO_SELECTION_ID,u,r.LINE_NODE_PROPERTIES),r}return(0,r.__extends)(t,e),t}(n.UIElement);t.RayVisualization=a},404483:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.viewManipulationSettingsGetManager=void 0;var r=i(402197),n=i(463943),o=i(311611),s=function(){function e(){this.mouseKeyFlags={},this.mouseKeyManipulationModeBinding={},this.hasShiftKeyBinding=!1,this.hasControlKeyBinding=!1,this.hasAltKeyBinding=!1,this.mouseKeyFlags[n.MouseButton.MIDDLE]=1,this.mouseKeyFlags[n.MouseButton.RIGHT]=2,this.mouseKeyFlags[r.Keys.SHIFT]=4,this.mouseKeyFlags[r.Keys.CONTROL]=8,this.mouseKeyFlags[r.Keys.ALT]=16}return e.prototype.getMouseKeyCombinationID=function(e,t){var i=0,r=0;for(r=0;r<e.length;++r)i|=this.mouseKeyFlags[e[r]];for(r=0;r<t.length;++r)i|=this.mouseKeyFlags[t[r]];return i},e.prototype.clearMouseKeyManipulationBindings=function(){this.mouseKeyManipulationModeBinding={},this.hasShiftKeyBinding=!1,this.hasControlKeyBinding=!1,this.hasAltKeyBinding=!1},e.prototype.addMouseKeyManipulationModeBinding=function(e,t,i){var n=this.getMouseKeyCombinationID(e,t);n>0&&(this.mouseKeyManipulationModeBinding[n]=i,this.hasControlKeyBinding||(this.hasControlKeyBinding=0!=(n&this.mouseKeyFlags[r.Keys.CONTROL])),this.hasShiftKeyBinding||(this.hasShiftKeyBinding=0!=(n&this.mouseKeyFlags[r.Keys.SHIFT])),this.hasAltKeyBinding||(this.hasAltKeyBinding=0!=(n&this.mouseKeyFlags[r.Keys.ALT])))},e.prototype.getManipulationMode=function(e,t){return this.mouseKeyManipulationModeBinding[this.getMouseKeyCombinationID(e,t)]},e.prototype.isManipulationModeEnabled=function(e,t,i){var r=this.getMouseKeyCombinationID(t,i);for(var n in this.mouseKeyManipulationModeBinding){var o=parseInt(n,10);if(this.mouseKeyManipulationModeBinding[o]===e)if((r&o)===o)return!0}return!1},e.prototype.getClosestMode=function(e,t,i){var r=o.ManipulationMode.NONE,n=0;for(var s in this.mouseKeyManipulationModeBinding){var a=parseInt(s,10),c=this.mouseKeyManipulationModeBinding[a];c!==i&&(this.isManipulationModeEnabled(c,e,t)&&a>n&&(n=a,r=c))}return r},e.prototype.usesShiftKey=function(){return this.hasShiftKeyBinding},e.prototype.usesControlKey=function(){return this.hasControlKeyBinding},e.prototype.usesAltKey=function(){return this.hasAltKeyBinding},e}(),a=null;t.viewManipulationSettingsGetManager=function(){return a||((a=new s).addMouseKeyManipulationModeBinding([n.MouseButton.RIGHT],[],o.ManipulationMode.ROTATE),a.addMouseKeyManipulationModeBinding([n.MouseButton.RIGHT],[r.Keys.ALT],o.ManipulationMode.AXIS_ROTATE),a.addMouseKeyManipulationModeBinding([n.MouseButton.RIGHT],[r.Keys.CONTROL],o.ManipulationMode.PAN),a.addMouseKeyManipulationModeBinding([n.MouseButton.MIDDLE],[],o.ManipulationMode.PAN)),a}},379983:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrthographicController=t.PerspectiveController=t.ViewController=t.StandardViews=void 0;var r,n=i(423902),o=i(73055),s=i(911748),a=i(402197),c=i(463943),l=i(311517),u=i(280088),h=i(320078),d=i(673290),p=i(173567),g=i(311611);!function(e){e[e.RIGHT_FRONT=0]="RIGHT_FRONT",e[e.RIGHT_BACK=1]="RIGHT_BACK",e[e.LEFT_BACK=2]="LEFT_BACK",e[e.LEFT_FRONT=3]="LEFT_FRONT"}(r||(r={}));var f,m,y,v,E=function(e,t){var i=s.mat4.identity();return s.mat4.rotate(i,e*Math.PI/2+Math.PI/6,[0,0,1]),s.mat4.rotate(i,t?Math.PI/3:2*Math.PI/3,[1,0,0]),i};t.StandardViews={XY:s.mat4.identity(),XYback:[1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1],YZ:[0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1],YZback:[0,-1,0,0,0,0,1,0,-1,0,0,0,0,0,0,1],XZ:[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],XZback:[-1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1],Isometric:(m=Math.sqrt(.5),y=Math.sqrt(1/3),v=Math.sqrt(1/6),[m,m,0,0,-v,v,2*v,0,y,-y,y,0,0,0,0,1]),Dimetric:(f=s.mat4.identity(),s.mat4.rotate(f,Math.PI/4,[0,0,1]),s.mat4.rotate(f,Math.PI/3,[1,0,0]),f),Trimetric:E(r.RIGHT_FRONT,!0),TrimetricTopRightBack:E(r.RIGHT_BACK,!0),TrimetricTopLeftBack:E(r.LEFT_BACK,!0),TrimetricTopLeftFront:E(r.LEFT_FRONT,!0),TrimetricBottomRightFront:E(r.RIGHT_FRONT,!1),TrimetricBottomRightBack:E(r.RIGHT_BACK,!1),TrimetricBottomLeftBack:E(r.LEFT_BACK,!1),TrimetricBottomLeftFront:E(r.LEFT_FRONT,!1)};var I=o.default.getManager();function T(e,t){return s.vec4.set(t.getViewport(),s.vec4.create())}var S=function(){function e(e){this.viewer=e,this.camera=null,this.axisRotateUpAxis=[0,0,1],this.axisRotateCanvasTag="axisRotateView",this.rotateOrPanCenter=[0,0,0],this.haltPostRotationAnimation=!1,this.lastRotationTime=0,this.rotationSpeedX=0,this.rotationSpeedY=0,this.lastButtonState={leftButton:!1,middleButton:!1,rightButton:!1},this.lastCtrlState=!1,this.lastShiftState=!1,this.lastAltState=!1,this.isSpaceballMoving=!1,this.dragZoomCanvasCoordinates=[0,0],(0,g.viewerCheck)(e),this.animationController=e.getAnimationController(),this.manipulationMode=g.ManipulationMode.NONE,this.rotateCenterGraphicsElement=new g.PointElement([0,0,0],g.MAIN_SCENEGRAPH_ID,I.getColor("ROTATION_POINT_COLOR"),I.getNumber("ROTATION_POINT_SIZE"),this.viewer),this.rotateCenterGraphicsElement.setStyle(I.getPointFont("ROTATION_POINT_FONT")),this.rotateCenterGraphicsElement.hide(),this.forcedManipulationMode=g.ManipulationMode.NONE}return e.prototype.getViewer=function(){return this.viewer},e.prototype.destroy=function(){this.rotateCenterGraphicsElement.remove()},e.prototype.isPerspective=function(){return!1},e.prototype.isOrthographic=function(){return!1},e.prototype.getCamera=function(){return this.camera},e.prototype.getRotateOrPanCenter=function(){return this.rotateOrPanCenter},e.prototype.getAxisRotateUpAxis=function(){return this.axisRotateUpAxis},e.prototype.resetInputState=function(){this.lastButtonState={leftButton:!1,middleButton:!1,rightButton:!1},this.lastCtrlState=!1,this.lastShiftState=!1,this.lastAltState=!1},e.prototype.updateInputState=function(e,t){var i=!1;return Object.entries(t).forEach((function(e){var t=(0,n.__read)(e,2),r=t[0],o=t[1];this.lastButtonState[r]!==o&&(this.lastButtonState[r]=o,i=!0)}),this),(0,g.viewManipulationSettingsGetManager)().usesControlKey()&&e.ctrlKey!==this.lastCtrlState&&(this.lastCtrlState=e.ctrlKey,i=!0),(0,g.viewManipulationSettingsGetManager)().usesShiftKey()&&e.shiftKey!==this.lastShiftState&&(this.lastShiftState=e.shiftKey,i=!0),(0,g.viewManipulationSettingsGetManager)().usesAltKey()&&e.altKey!==this.lastAltState&&(this.lastAltState=e.altKey,i=!0),i},e.prototype.getMouseKeyValues=function(e,t){var i=[];t.rightButton&&i.push(c.MouseButton.RIGHT),t.middleButton&&i.push(c.MouseButton.MIDDLE),t.leftButton&&i.push(c.MouseButton.LEFT);var r=[];return(0,g.viewManipulationSettingsGetManager)().usesControlKey()&&e.ctrlKey&&r.push(a.Keys.CONTROL),(0,g.viewManipulationSettingsGetManager)().usesShiftKey()&&e.shiftKey&&r.push(a.Keys.SHIFT),(0,g.viewManipulationSettingsGetManager)().usesAltKey()&&e.altKey&&r.push(a.Keys.ALT),{mouseButtonSettings:i,modifierKeys:r}},e.prototype.getManipulationMode=function(e,t){if(this.forcedManipulationMode!==g.ManipulationMode.NONE&&t.leftButton)return this.forcedManipulationMode;var i=this.getMouseKeyValues(e,t),r=i.mouseButtonSettings,n=i.modifierKeys,o=(0,g.viewManipulationSettingsGetManager)().getManipulationMode(r,n);return o!==g.ManipulationMode.ZOOM&&o!==g.ManipulationMode.AXIS_ROTATE&&o!==g.ManipulationMode.PAN&&o!==g.ManipulationMode.ROTATE?g.ManipulationMode.NONE:o},e.prototype.forceManipulationMode=function(e){this.forcedManipulationMode=e},e.prototype.getClosestMode=function(e,t,i){var r=this.getMouseKeyValues(e,t),n=r.mouseButtonSettings,o=r.modifierKeys;return(0,g.viewManipulationSettingsGetManager)().getClosestMode(n,o,i)},e.prototype.updateManipulationMode=function(e,t){if(this.updateInputState(e,t)){var i=this.manipulationMode,r=this.forcedManipulationMode!==g.ManipulationMode.NONE?this.forcedManipulationMode:this.getManipulationMode(e,t);if(r!==g.ManipulationMode.NONE)this.manipulationMode=r;else{var n=this.getClosestMode(e,t,this.manipulationMode);n!==g.ManipulationMode.NONE?this.manipulationMode=n:this.manipulationMode=this.getClosestMode(e,t)}i!==this.manipulationMode&&(!(this.isRotating()||this.isPanning()||this.isAxisRotating())||this.isRotating()&&i===g.ManipulationMode.AXIS_ROTATE||this.isAxisRotating()&&i===g.ManipulationMode.ROTATE||this.updateRotationPanCenter(e),this.isRotating()&&(this.lastRotationTime=(0,g.getTimeInMilliseconds)(),this.rotationSpeedX=0,this.rotationSpeedY=0),(this.isRotating()||this.isAxisRotating())&&I.getNumber("SHOW_ROTATION_POINT")?this.rotateCenterGraphicsElement.show():this.rotateCenterGraphicsElement.hide())}},e.prototype.setRotationPivotPosition=function(e){this.rotateOrPanCenter=e,this.rotateCenterGraphicsElement.updatePosition(this.rotateOrPanCenter)},e.prototype.setShowRotationPivot=function(e){e?I.getNumber("SHOW_ROTATION_POINT")&&this.rotateCenterGraphicsElement.show():this.rotateCenterGraphicsElement.hide()},e.prototype.setIsSpaceballMoving=function(e){this.isSpaceballMoving=e},e.prototype.isPanning=function(){return this.manipulationMode===g.ManipulationMode.PAN},e.prototype.isRotating=function(){return this.manipulationMode===g.ManipulationMode.ROTATE},e.prototype.isAxisRotating=function(){return this.manipulationMode===g.ManipulationMode.AXIS_ROTATE},e.prototype.isZooming=function(){return this.manipulationMode===g.ManipulationMode.ZOOM},e.prototype.isBeingManipulated=function(){return this.manipulationMode!==g.ManipulationMode.NONE},e.prototype.isBeingForceManipulated=function(){return this.isBeingManipulated()&&this.manipulationMode===this.forcedManipulationMode},e.prototype.getRotateCenterUnderPoint=function(e,t){for(var i=I.getNumber("ROTATION_CENTER_SEARCH_RADIUS"),r=2*i+1,n=2*i+1,o=e-i,a=t-i,c=this.viewer.findDepthsInRect(o,a,r,n,!1),l=null,u=1/0,h=s.vec2.create(),d=[e,t],p=0;p<c.length;++p)if(c[p][2]!==g.UNKNOWN_DEPTH){var f=c[p],m=s.vec2.squaredLength(s.vec2.subtract(f,d,h));m<u&&(l=f,u=m)}return l?this.camera.canvasToWorld(l):null},e.prototype.getRotateCenterBasedOnWindowDepths=function(e){for(var t=this.viewer.retrieveDepthSampling(e),i=[0,0,0],r=t.length,n=0;n<r;++n)for(var o=0;o<3;++o)i[o]+=t[n][o];return r>0&&r>=I.getNumber("MIN_SAMPLES_TO_USE_FOR_DEPTH_AVERAGED_ROTATION_CENTER")?this.camera.canvasToWorld([i[0]/r,i[1]/r,i[2]/r]):null},e.prototype.getRotateCenterBasedOnBounds=function(){var e=this.viewer.getModelViewManagers().getManager().getModelBounds();return e&&e.isInitialized()&&!e.isInfinite()?this.camera.doBoundsFitInViewport(e,this.camera.getViewport(),I.getNumber("MODEL_SIZE_TO_VIEWPORT_ROTATE_BOUNDS_FACTOR"))?e.center():null:[0,0,0]},e.prototype.getRotateCenterBasedOnCanvasLocationAndBoundsDepth=function(e,t){var i=this.viewer.getModelViewManagers().getManager().getModelBounds();if(!i||!i.isInitialized()||i.isInfinite())return[0,0,0];var r=this.camera.getRay(e,t),n=.01*i.diameter();return s.vec3.add(r.point,s.vec3.scale(r.direction,Math.max(s.vec3.dot(r.direction,s.vec3.subtract(i.center(),r.point,s.vec3.create())),n),s.vec3.create()))},e.prototype.getRotateCenterForCanvasLocation=function(e,t){var i=this.getRotateCenterUnderPoint(e,t);return i||((i=this.getRotateCenterBasedOnWindowDepths({includePlanes:!1}))||(i=this.getRotateCenterBasedOnWindowDepths({includePlanes:!0}))?i:(i=this.getRotateCenterBasedOnBounds())||this.getRotateCenterBasedOnCanvasLocationAndBoundsDepth(e,t))},e.prototype.getRotateCenterForSpaceball=function(){var e=this.getRotateCenterBasedOnBounds();if(e)return e;var t=[this.camera.getViewportWidth()/2,this.camera.getViewportHeight()/2];return(e=this.getRotateCenterUnderPoint(t[0],t[1]))||(e=this.getRotateCenterBasedOnWindowDepths({includePlanes:!1}))?e:(e=this.getRotateCenterBasedOnWindowDepths({includePlanes:!0}))||this.getRotateCenterBasedOnCanvasLocationAndBoundsDepth(t[0],t[1])},e.prototype.updateRotationPanCenterForSpaceball=function(){this.setRotationPivotPosition(this.getRotateCenterForSpaceball())},e.prototype.updateRotationPanCenter=function(e){this.rotateOrPanCenter=[0,0,0];var t=this.viewer.getCanvasCoordinateFromEvent(e),i=t[0],r=t[1];(this.isRotating()||this.isAxisRotating()||this.isPanning()&&this.isPerspective())&&this.setRotationPivotPosition(this.getRotateCenterForCanvasLocation(i,r))},e.prototype.onDragStart=function(e,t,i){var r=this.isZooming();if(this.updateManipulationMode(t,i),!r&&this.isZooming()){var n=this.viewer.getCanvasCoordinateFromEvent(e);this.dragZoomCanvasCoordinates[0]=n[0],this.dragZoomCanvasCoordinates[1]=n[1]}return this.haltPostRotationAnimation=this.isBeingManipulated(),this.isBeingManipulated()},e.prototype.zoomOnCanvasPoint=function(e,t,i){var r,n=this.camera.viewNormalPlaneAtPoint(this.camera.focalPoint()),a=(0,g.intersectRayPlane)(this.camera.getRay(e,0),n),c=(0,g.intersectRayPlane)(this.camera.getRay(e,t),n);a&&c?(r=s.vec3.subtract(c,this.camera.getEye(),s.vec3.create()),s.vec3.normalize(r)):(i=0,r=this.camera.getEye());var u=this.viewer.getSceneBounds().getCorners();i<0&&o.default.getManager().getNumber("USE_CENTRAL_ZOOM_OUT")&&(c=(0,g.intersectRayPlane)(this.camera.getRay(this.camera.getViewportWidth()/2,this.camera.getViewportHeight()/2),n)),c?this.zoomPoint(c,{direction:r},i,u):l.log.debug("No point intersection found for zoomOnCanvasPoint")},e.prototype.zoomOnMouseWheelScroll=function(e){e.preventDefault();var t=e.originalEvent,i=0,r=.5;if("mousewheel"===e.type){if(0===t.wheelDelta||t.wheelDeltaX&&Math.abs(t.wheelDeltaX)>Math.abs(t.wheelDeltaY))return!1;r/=120,(0,h.isPlatformWindows)()&&(r*=3),i=r*t.wheelDelta}else{if(0===t.detail||1===t.axis)return!1;i=-r*t.detail}var n=this.viewer.getCanvasCoordinateFromEvent(t),o=n[0],s=n[1];return(0,g.getMouseSettingsManager)().isScrollZoomDefault()||(i=-i),this.zoomOnCanvasPoint(o,s,i),!0},e.prototype.zoomOnDrag=function(e){if(!(Math.abs(e)<d.Tolerances.ZERO_LENGTH)){var t=this.dragZoomCanvasCoordinates[0],i=this.dragZoomCanvasCoordinates[1];e=-1*e/o.default.getManager().getNumber("DRAG_ZOOM_FACTOR"),this.zoomOnCanvasPoint(t,i,e)}},e.prototype.onDrag=function(e,t,i,r,n,o){this.forcedManipulationMode===g.ManipulationMode.NONE&&this.updateManipulationMode(e,t);var a=this.viewer.$el,c=this.camera.viewNormalPlaneAtPoint(this.rotateOrPanCenter);if(this.isPanning()){var l=function(){var e=(0,g.intersectRayPlane)(this.camera.getRay(n,o),c),t=(0,g.intersectRayPlane)(this.camera.getRay(n+i,o+r),c);return e&&t?(s.vec3.subtract(t,e),t):null}.call(this);l&&this.pan(l)}else if(this.isRotating()){var u=[+a.attr("width"),+a.attr("height")],h=2*Math.PI*I.getNumber("ROTATION_CYCLES_PER_SCREEN")/s.vec2.length(u);this.rotateAbout(-i*h,this.camera.getUp(),this.rotateOrPanCenter),this.rotateAbout(-r*h,this.camera.getRight(),this.rotateOrPanCenter),this.lastRotationTime=(0,g.getTimeInMilliseconds)(),this.rotationSpeedX=.5*(this.rotationSpeedX+i),this.rotationSpeedY=.5*(this.rotationSpeedY+r),this.tagCanvasWithView("unknown")}else if(this.isAxisRotating()){var d=a.attr("data-view-shown")===this.axisRotateCanvasTag;if(!this.animationController.isCameraAnimating())if(d){u=[+a.attr("width"),+a.attr("height")],h=2*Math.PI*I.getNumber("ROTATION_CYCLES_PER_SCREEN")/s.vec2.length(u);var p=(0,g.sign)(this.camera.getUp()[2])||1;this.rotateAbout(-i*p*h,this.axisRotateUpAxis,this.rotateOrPanCenter),this.rotateAbout(-r*h,this.camera.getRight(),this.rotateOrPanCenter)}else{var f=Math.asin(s.vec3.dot(this.camera.getRight(),this.axisRotateUpAxis)),m=s.vec3.cross(this.camera.getRight(),this.axisRotateUpAxis,s.vec3.create()),y=Math.abs(f);if(y<I.getNumber("AXIS_ROTATION_SNAP_TOLERANCE"))this.rotateAbout(-f,m,this.rotateOrPanCenter),this.tagCanvasWithView(this.axisRotateCanvasTag);else{var v=this.camera.clone();v.rotateAbout(-f,m,this.rotateOrPanCenter);var E=I.getNumber(y>Math.PI/4?"CAMERA_SHORT_ANIMATION_TIME_MS":"CAMERA_SNAP_ANIMATION_TIME_MS");this.animateToCustomView(v,E,this.axisRotateCanvasTag)}}}else this.isZooming()&&this.zoomOnDrag(r);this.updateCameraNearFar(),this.viewer.requestDraw()},e.prototype.onDragStop=function(e){this.isRotating()&&(this.rotateCenterGraphicsElement.hide(),this.performStopRotationAnimation()),this.isAxisRotating()&&this.rotateCenterGraphicsElement.hide(),this.resetInputState(),this.manipulationMode=g.ManipulationMode.NONE},e.prototype.getPointerPosition=function(){return this.viewer.getCanvasCoordinateFromEvent(this.viewer.getLastMouseMovedEvent())},e.prototype.performStopRotationAnimation=function(){var e=this;if(!this.viewer.isInteractiveFramerateBelowThreshold()){this.haltPostRotationAnimation=!1;var t=s.vec2.length([this.camera.getViewportWidth(),this.camera.getViewportHeight()]),i=2*Math.PI*I.getNumber("ROTATION_CYCLES_PER_SCREEN")/t,r=I.getNumber("ROTATION_INERTIA"),n=1,o=(0,g.getTimeInMilliseconds)();(0,g.getTimeInMilliseconds)()-this.lastRotationTime<50&&this.animationController.startCameraAnimation((function(t){var s=(0,g.getTimeInMilliseconds)();n*=Math.pow(r,(s-o)/16.666666666666668),o=s;var a=e.rotationSpeedX*n,c=e.rotationSpeedY*n;return!e.haltPostRotationAnimation&&(Math.abs(a)>1||Math.abs(c)>1)?(e.rotateAbout(-a*i,e.camera.getUp(),e.rotateOrPanCenter),e.rotateAbout(-c*i,e.camera.getRight(),e.rotateOrPanCenter),p.AnimationCallbackStatus.ONGOING):p.AnimationCallbackStatus.COMPLETE}))}},e.prototype.rotateAbout=function(e,t,i){this.camera.rotateAbout(e,t,i)},e.prototype.pan=function(e){this.camera.pan(e)},e.prototype.canZoom=function(e,t){if(t){for(var i=new g.BoundingBox,r=0;r<t.length;r++)i.addPoint(t[r]);if(i.diameter()>0){var n=this.camera.getPixelSizeAtWorldPoint(i.center()),s=o.default.getManager().getNumber("MIN_MODEL_PIXEL_SIZE");return!(e>=1&&i.diameter()/n<=e*s||e<=1&&1/n>=e*Math.pow(2,24))}}return!1},e.prototype.adjustCameraToValidZoom=function(e){if(!e)return!1;var t=this.viewer.getFitBounds();if(!this.canBoundsBeFit(t))return!1;var i=o.default.getManager().getNumber("MIN_MODEL_PIXEL_SIZE"),r=e.getPixelSizeAtWorldPoint(t.center()),n=1;return t.diameter()/r<=i?n=t.diameter()/r/i:1/r>=Math.pow(2,24)&&(n=1/(Math.pow(2,24)*r)),1!==n&&(l.log.debug("Given camera would result in invalid scene zoom. Applying zoom: "+n),e.zoom(n)),!0},e.prototype.zoom=function(e){},e.prototype.setStandardView=function(e){var i=t.StandardViews[e];i&&(this.camera.setFrame(i),this.tagCanvasWithView(e))},e.prototype.animateToCustomView=function(e,t,i){this.animateTo(e,t,i)},e.prototype.animateViewNormalToPlaneMatrix=function(e,t,i){if(e){var r,n=T(this.viewer,this.camera);if(this.camera.canBoundsFitInViewport(t,n)){var o=this.camera.viewportToCanvas([n[0]+n[2]/2-this.camera.getViewportLeft(),n[1]+n[3]/2-this.camera.getViewportBottom(),0]);r=this.camera.getCameraRotatedToViewAndTranslated(e,t.center(),o)}else{var s=i?i[0]:this.camera.getViewportWidth()/2,a=i?i[1]:this.camera.getViewportHeight()/2,c=this.getRotateCenterForCanvasLocation(s,a);r=this.camera.getCameraRotatedToView(e,c)}this.animateToCustomView(r,I.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))}},e.prototype.animateTo=function(e,t,i){var r=this;if(!this.animationController.isCameraAnimating()){if(this.tagCanvasWithView(),this.viewer.isInteractiveFramerateBelowThreshold())return this.camera.copyFrom(e),this.updateCameraNearFar(),this.viewer.requestDraw(),this.viewer.getAnimationController().incrementAnimationSequence(),this.tagCanvasWithView(i),void this.viewer.getBodyManager().onUserIsAdjustingCamera();var n=(0,g.getTimeInMilliseconds)(),o=new u.CameraInterpolator(this.camera,e);this.animationController.startCameraAnimation((function(e){var s,a=(0,g.getTimeInMilliseconds)(),c=a-n;s=(s=c>=t?1:c/t)*s*s*(s*(6*s-15)+10);var u=o.interpolate(s);return(0,g.areVectorsEqual)(r.camera.getViewport(),u.viewport)?(r.camera.copyFrom(u),r.updateCameraNearFar(),a-n<t?p.AnimationCallbackStatus.ONGOING:(r.tagCanvasWithView(i),r.viewer.getBodyManager().onUserIsAdjustingCamera(),p.AnimationCallbackStatus.COMPLETE)):(l.log.trace("Camera viewport changed mid-animation, terminating animation early"),p.AnimationCallbackStatus.COMPLETE)}))}},e.prototype.tagCanvasWithView=function(e){e?this.viewer.$el.attr("data-view-shown",e):this.viewer.$el.attr("data-view-shown","unknown")},e.prototype.getViewportCenter=function(){var e=T(this.viewer,this.camera);return s.vec2.createFrom(e[0]+e[2]/2,e[1]+e[3]/2)},e.prototype.canBoundsBeFit=function(e){var t=e.isInitialized()&&!e.isInfinite();return t||l.log.warn("An attempt was made to fit a camera with invalid bounds"),t},e.prototype.animateToFrameWithZoomFit=function(e,t,i,r,n,o){if(this.canBoundsBeFit(t)){var s=this.getZoomFitTargetCamera(e,t,n,o);this.adjustCameraToValidZoom(s)&&this.animateTo(s,i,r)}},e.prototype.getZoomFitTargetCamera=function(e,t,i,r){var n=t.getCorners(),o=null;i||(o=T(this.viewer,this.camera));var s=this.camera.clone();s.setFrame(e);var a=r;return a||(a=I.getNumber("CAMERA_ZOOM_TO_FIT_PADDING")),s.zoomToFit(n,a,o),s.updateNearFar(),s},e.prototype.animateToStandardView=function(e,i){if(this.canBoundsBeFit(i)){var r=t.StandardViews[e];r&&this.animateToFrameWithZoomFit(r,i,I.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),e)}},e.prototype.animateToStandardViewIgnoringUIPanels=function(e,i,r){if(this.canBoundsBeFit(i)){var n=t.StandardViews[e];n&&this.animateToFrameWithZoomFit(n,i,I.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),e,!0,r)}},e.prototype.animateZoomToFit=function(e){if(this.canBoundsBeFit(e)){var t=e.getCorners(),i=T(this.viewer,this.camera),r=this.camera.clone();r.zoomToFit(t,I.getNumber("CAMERA_ZOOM_TO_FIT_PADDING"),i),this.adjustCameraToValidZoom(r)&&this.animateTo(r,I.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))}},e.prototype.zoomFitCamera=function(e,t){if(this.canBoundsBeFit(e)){var i=e.getCorners(),r=this.camera.clone();r.zoomToFit(i,I.getNumber("CAMERA_ZOOM_TO_FIT_PADDING"),t),r.updateNearFar(i),this.adjustCameraToValidZoom(r)&&(this.camera=r,this.viewer.requestDraw())}},e.prototype.zoomFit=function(e){this.animationController.haltCameraAnimation(),this.zoomFitCamera(e,T(this.viewer,this.camera))},e.prototype.zoomFitWithoutPanels=function(e){this.zoomFitCamera(e)},e.prototype.animateRotation=function(e,t,i,r){var n=this,o=0,s=(0,g.getTimeInMilliseconds)();if(r||(r=this.camera.focalPoint()),this.tagCanvasWithView(),this.viewer.isInteractiveFramerateBelowThreshold())return this.rotateAbout(t,e,r),this.updateCameraNearFar(),void this.viewer.requestDraw();this.animationController.startAnimation((function(a){if(Math.abs(o)<Math.abs(t)){if(!n.viewer.isReadyForDrawing())return;var c=(0,g.getTimeInMilliseconds)(),l=Math.min(c-s,i)/i*t,u=l-o;return n.rotateAbout(u,e,r),n.updateCameraNearFar(),o=l,c-s<=i?p.AnimationCallbackStatus.ONGOING:p.AnimationCallbackStatus.COMPLETE}}))},e.prototype.rotateInDirection=function(e,t){var i=this.camera.up,r=this.camera.direction,n=s.vec3.cross(r,i,s.vec3.create());switch(e){case"left":this.animateRotation(i,t,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"right":this.animateRotation(i,-t,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"up":this.animateRotation(n,t,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"down":this.animateRotation(n,-t,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"clockwise":this.animateRotation(r,-t,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"counterclockwise":this.animateRotation(r,t,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"180":this.animateRotation(i,Math.PI,I.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))}},e.prototype.animatePan=function(e,t){var i=this.camera.clone(),r=i.getPixelSizeAtWorldPoint(i.getSceneBounds().center()),n=s.vec3.add(s.vec3.scale(i.getRight(),r*-e,s.vec3.create()),s.vec3.scale(i.getUp(),r*-t,s.vec3.create()));i.pan(n),this.animateTo(i,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"))},e.prototype.panRight=function(){this.animatePan(I.getNumber("DEFAULT_PAN_AMOUNT_PX"),0)},e.prototype.panLeft=function(){this.animatePan(-I.getNumber("DEFAULT_PAN_AMOUNT_PX"),0)},e.prototype.panUp=function(){this.animatePan(0,I.getNumber("DEFAULT_PAN_AMOUNT_PX"))},e.prototype.panDown=function(){this.animatePan(0,-I.getNumber("DEFAULT_PAN_AMOUNT_PX"))},e.prototype.animateZoom=function(e){var t=this.camera.clone();t.zoom(e),this.adjustCameraToValidZoom(t)&&this.animateTo(t,I.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"))},e.prototype.zoomIn=function(){this.animateZoom(1/I.getNumber("DEFAULT_ZOOM_FACTOR"))},e.prototype.zoomOut=function(){this.animateZoom(I.getNumber("DEFAULT_ZOOM_FACTOR"))},e.prototype.zoomPoint=function(e,t,i,r){},e.prototype.updateCameraNearFar=function(){var e=this.viewer.getSceneGraphs().getMainSceneGraph().getBounds();e.isFinite()&&this.camera.updateNearFar(e.getCorners())},e.prototype.getMatchingOrthographicController=function(){return null},e.prototype.getMatchingPerspectiveController=function(){return null},e}();t.ViewController=S;var P=function(e){function t(t,i){var r=e.call(this,t)||this;return r.camera=new g.PerspectiveCamera(i),r}return(0,n.__extends)(t,e),t.prototype.isPerspective=function(){return!0},t.prototype.clone=function(){var e=new t(this.viewer);return e.camera=this.camera.clone(),e.forcedManipulationMode=this.forcedManipulationMode,e},t.prototype.zoom=function(e){var t=this.camera,i=Math.max(t.distanceToCenter(),t.getMinDistance())*e/6;t.dolly(i),t.updateNearFar()},t.prototype.zoomPoint=function(e,t,i,r){var n=Math.pow(2,-i/6);if(this.canZoom(n,r)){var o=this.camera,s=Math.max(o.distanceToCenter(),o.getMinDistance())*i/6;o.dollyAlong(s,t.direction),o.updateNearFar(r)}},t.prototype.getMatchingOrthographicController=function(){var e=new _(this.viewer);return e.camera=this.camera.getOrthographicCamera(),e.forcedManipulationMode=this.forcedManipulationMode,e},t}(S);t.PerspectiveController=P;var _=function(e){function t(t,i){var r=e.call(this,t)||this;return r.camera=new g.OrthographicCamera(i),r}return(0,n.__extends)(t,e),t.prototype.isOrthographic=function(){return!0},t.prototype.zoom=function(e){var t=Math.pow(2,-e/6);this.camera.zoom(t)},t.prototype.zoomPoint=function(e,t,i,r){var n=Math.pow(2,-i/6);this.canZoom(n,r)&&this.camera.zoomPoint(e,t,n,r)},t.prototype.clone=function(){var e=new t(this.viewer);return e.camera=this.camera.clone(),e.forcedManipulationMode=this.forcedManipulationMode,e},t.prototype.getMatchingPerspectiveController=function(){var e=new P(this.viewer);return e.camera=this.camera.getPerspectiveCamera(),e.forcedManipulationMode=this.forcedManipulationMode,e},t}(S);t.OrthographicController=_},877248:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.createTestViewer=t.Viewer=t.ElementLoadState=void 0;var n=i(423902),o=i(514194),s=i(73055),a=i(129346),c=i(784167),l=i(342211),u=i(501242),h=i(524627),d=i(911748),p=i(194598),g=i(369490),f=i(311517),m=i(689397),y=i(691565),v=i(681320),E=i(165542),I=i(712197),T=i(227441),S=i(971491),P=i(736202),_=i(507025),M=i(320078),D=i(684549),C=i(601759),O=i(699716),A=i(997862),R=i(556329),N=i(673290),w=i(963551),b=i(817395),L=i(311611),F=i(623639),B=i(805468),x=i(42586),U=i(992945),G=i(407974),H=1600,V=1200;(0,d.setMatrixArrayType)(Array);var k=0;window.matchMedia&&window.matchMedia("print").addListener((function(e){e.matches?(0,L.beforePrint)():(0,L.afterPrint)()}));window.onbeforeprint=L.beforePrint,window.onafterprint=L.afterPrint;var W=s.default.getManager();var j,z=function(e){this.elementId=e,this.camera=null,this.userEnabledAggressiveRefinement=!1,this.activeSectionPlanes=[],this.zebraStripeCount=W.getNumber("ZEBRA_STRIPE_COUNT"),this.zebraStripeRotation=W.getNumber("ZEBRA_STRIPE_ROTATION"),this.zebraStripeEdgesOn=!0,this.renderingMode=T.GBTGraphicsRenderMode.SHADED_WITH_EDGES,this.smoothEdgeStyle=T.GBTSmoothEdgeStyle.VISIBLE};!function(e){e[e.VIEWER_DESTROYED=-1]="VIEWER_DESTROYED",e[e.WAITING_FOR_DISPLAY_DATA=0]="WAITING_FOR_DISPLAY_DATA",e[e.WAITING_FOR_COMPARE_DISPLAY_DATA=1]="WAITING_FOR_COMPARE_DISPLAY_DATA",e[e.LOADING_DISPLAY_DATA=2]="LOADING_DISPLAY_DATA",e[e.LOADED_DISPLAY_DATA=3]="LOADED_DISPLAY_DATA",e[e.LOADED_ALL_DATA=4]="LOADED_ALL_DATA"}(j=t.ElementLoadState||(t.ElementLoadState={}));var X={performFrameTiming:!0},q={performFrameTiming:!1},Y={antialias:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"},Z=localStorage.getItem("osWebGlContextOptions");if(Z)try{f.log.info("Using custom set of WebGL context options: "+Z),Y=JSON.parse(Z)}catch(e){f.log.warn("Failed to use custom WebGL context options: "+Z)}var K={},Q=function(e){function t(t){var i=e.call(this,t)||this;return i.hasMouseOver=!1,i.loggedPickIssue=!1,i.renderModeSubject=new U.Subject,i.isBrowserTabVisible="visible"===document.visibilityState,k=s.default.getManager().getNumber("PICK_WINDOW_PREVENT_CULL_MARGIN_PIXELS"),i}return(0,n.__extends)(t,e),t.prototype.initialize=function(e){var t=this;if(this.eventDispatcher=new L.EventDispatcher,this.gl=null,this.requestDraw=this.requestDrawUsingTimer,window.requestAnimationFrame&&(this.requestDraw=this.requestDrawUsingAnimationFrame),(0,I.updateSecondarySelectionListForDebugging)(),this.timeOfContextLoss=null,this.extensions={},this.occurrenceTexturesSupported=null,this.highlightVertexTexturesSupported=null,this.SSAOFilteringSupported=null,this.highPrecisionSupportedInFragmentShader=null,this.hidden=!1,this.readyState=!1,this.isForFlattenedDisplay=e&&e.isForFlattenedDisplay,this.renderContext=new L.RenderContext(this),this.handleContextLoss=function(e){!function(e,t){var i=e.getMemoryGauge().getUsageDetails(),r={};Object.entries(i).forEach((function(e){var t=(0,n.__read)(e,2),i=t[0],o=t[1];r[i]=(o/1048576).toFixed(1)+" MB"})),f.log.warn(L.WEBGL_ERROR_LOG_TAG+"The WebGL context was lost. Memory usage at time of loss: "+JSON.stringify(r)),e.gl=null,e.timeOfContextLoss=(0,L.getTimeInMilliseconds)(),e.getEventDispatcher().trigger(L.GL_CONTEXT_LOST),e.showWebGLContextLostMessage(),t.preventDefault()}(t,e)},this.handleContextRestored=function(e){!function(e,t){e.getGlContext()&&(f.log.info("A context restore was received without a context loss - simulating"),e.gl=null,e.getEventDispatcher().trigger(L.GL_CONTEXT_LOST)),e.setupGlContext(),f.log.warn(L.WEBGL_ERROR_LOG_TAG+"The WebGL context was restored after "+(0,L.getTimeElapsed)(e.timeOfContextLoss).toFixed(0)+" ms"),e.timeOfContextLoss=null,e.getEventDispatcher().trigger(L.GL_CONTEXT_RESTORED,e.getGlContext()),e.onResize(),e.requestDraw(),e.hideWebGLContextLostMessage(),t.preventDefault()}(t,e)},this.el){this.el.addEventListener("webglcontextlost",this.handleContextLoss),this.el.addEventListener("webglcontextrestored",this.handleContextRestored);var i=e&&e.hidden;if(e&&e.glContext)this.gl=e.glContext,this.onNewGlContext();else if(!i&&(this.setupGlContext(),!this.gl))return;i&&this.hide(),this.rendererInfo=(0,L.getRendererInfo)(this.gl),(0,g.setLoggingRendererInfo)(this.rendererInfo),this.glSyncEveryFrame=!1,this.occurrenceDataManager=new L.DataManager(this),this.modelViewManagers=new L.ModelViewManagers(this.occurrenceDataManager,this),this.sceneGraphs=new L.SceneGraphs,this.uiResourceManager=new L.ResourceManager(this,this.sceneGraphs),this.uiSelectionManager=new L.UISelectionManager,this.edgePointController=null,this.silhouetteTask=new L.SilhouetteTask(this),this.occurrenceIdManager=new L.OccurrenceIdManager(this),e&&e.dontSetActive||((0,b.setActiveViewer)(this),(0,L.getActiveViewerEventDispatcher)().trigger(L.ACTIVE_VIEWER_SET)),this.disableAutomaticDrawing=e&&e.disableAutomaticDrawing,this.disableViewManipulator=e&&e.disableViewManipulator,this.instantiatedShaders={},this.badShaders={},this.attribVertexEnabled={},this.boundTextures={},this.listenTo(this.getEventDispatcher(),L.SESSION_ENDED,this.onSessionEnded),this.listenTo(this.getEventDispatcher(),L.GL_CONTEXT_LOST,this.onGlContextLost),this.listenTo(this.getEventDispatcher(),L.GL_CONTEXT_RESTORED,this.onGlContextRestored),(0,L.prepareShaderCode)(this),(0,L.addDrawer)(this.getViewerId(),this),this.animationController=new L.AnimationController(this),this.viewController=null,this.viewInitialized=!1,this.frameTimer=new L.FrameTimer(this),this.detailManager=new L.DetailManager(this,this.frameTimer),this.loadTimer=null,this.bodyLoadTimer=null,this.elementLoadState=j.WAITING_FOR_DISPLAY_DATA,this.elementLoadDeferred=E.defer(),this.shouldWaitForCompareDisplayData=!0,this.receivedComputedData=!1,this.receivedFeatureData=!1,this.receivedAssemblyDefinition=!1,this.isReadyForDrawOnLinkOpen=!0,this.initializedForDrawing=!1,this.renderingMode=T.GBTGraphicsRenderMode.SHADED_WITH_EDGES,this.drawPasses=[],this.mainDrawPass=null,this.combinedPickPass=null,this.depthRetrievalPass=null,this.draftAngleRetrievalPass=null,this.depthSamplingPass=null,this.uiElements={},this.elementToPerElementState={},this.activeElementId="",this.printCanvas=null,this.suppressModelSelection=!1,this.queuedBaseData=null,this.selectionMapperForQueuedBase=null,this.queuedDisplayData=[],this.haveUnitsBeenReceived=!1,(0,m.getCurrentDocumentSettingsModel)().on("change:elementUnit",(function(){return t.requestDraw()})),this.memoryGauge=new L.MemoryGauge,this.boxSelectionDeferred=null,this.cursorStack=[],this.selectionCursor=L.Cursor.DEFAULT,this.lastMouseLocation=[-1,-1],this.frustumToPreventCulling=null,e&&e.disableSpaceball||(0,L.initializeSpaceballConnection)(),this.canEdit=!0,this.timestampOfLastDraw=0,this.averagePickDuration=-1,this.pickRadius=W.getNumber("MOUSE_PICK_RADIUS_PX"),this.bodyLoadTasks=new L.BodyLoadTasks(this),this.bodyLoadTask=this.bodyLoadTasks.getLoadTask(),this.bodyManager=new L.BodyManager(this,this.bodyLoadTasks.getUnloadTask()),this.modelViewManagers.getManager().setBodyLoadTasks(this.bodyLoadTasks),this.isolatedOccurrenceManager=new L.IsolatedOccurrencesManager(this),this.taskManager=new L.TaskManager,this.taskManager.addTask(this.bodyLoadTasks.getUnloadTask(),L.SMALL_INTERACTIVE_BUDGET),this.taskManager.addTask(this.bodyLoadTask,L.MEDIUM_INTERACTIVE_BUDGET),this.taskManager.addTask(this.silhouetteTask,L.SMALL_INTERACTIVE_BUDGET),this.lastDevicePixelRatio=0,this.recordCapabilitiesTimeout=null,this.hidden||(this.recordCapabilitiesTimeout=window.setTimeout((function(){(0,L.recordWebClientCapabilities)(t.gl),t.recordCapabilitiesTimeout=null}),5e3)),this.MAX_TEXTURE_UNITS=8,this.textureNameToUnitMap={},this.textureUnitToNameMap={},this.textureAtlasFactory=null,this.sharedFrameBuffers={},this.sharedRenderBuffers={},this.resources=new L.Resources(this),this.activeElementPreviewManager=null;this.inputHandler=null,e&&e.disableInput||(this.inputHandler=new L.InputHandler((function(e,i){for(var r,n=null,o=t.pick(e,i),s=0;s<o.length&&!n;++s)n=o[s].getModelSelection();t.getModelViewManagers().getManager().displayingPartStudio()&&n&&n.isModifiable()&&(r=(0,I.getFeatureAssociatedWithSelection)(n))&&r.getCanBeEdited()&&r.getIsComputed()&&(0,c.getCommandDispatcher)().trigger(a.commands.SHOW_DIMENSIONS_FOR_NODE_WITH_ID,r.getNodeId())}),this)),this.sketch=null,this.returnToPerspective=!1,this.viewManipulator=null,e&&e.disableViewManipulator||(this.viewManipulator=new L.ViewManipulator(this,e.contextMenuMgr)),this.pickPassCount=0,this.drawTimer=null,this.standardRequestCallbackQueued=!1,this.inRequestDrawCallback=!1,this.referenceHighlights=new L.ReferenceHighlights(this),this.highlightManager=new L.HighlightManager(this.referenceHighlights),this.compareHighlightManager=new L.HighlightManager(this.referenceHighlights),this.compareHighlightManager.usage=L.bt_graphics_Usage.PREVIEW,this.selectionsToKeepHiddenFromPick=[],this.performBodyCheck=!1,this.bodyCheckPass=new L.BodyCheckPass(this),this.hasElementPreviewLoaded=!1,this.storedCameraState=null,this.contextLossTimeout=null,this.zoomToSelectionBounds=null,this.listenTo(this.getEventDispatcher(),L.CANVAS_MOUSEENTER,this.onMouseEnter),this.listenTo(this.getEventDispatcher(),L.CANVAS_MOUSELEAVE,this.onMouseLeave),this.listenTo((0,L.getEditState)(),"change:latestDisplayDataUsage",this.onDisplayDataUsageChange),this.listenTo((0,L.getActiveViewerEventDispatcher)(),L.DEFAULT_UNITS_CHANGED,this.onDefaultUnitsChanged),this.filteredEntitiesHighlightController=null,this.interferenceCallId="",this.localDisplayDataCacheCleared=!1,this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle=!1,this.smoothEdgeStyle=T.GBTSmoothEdgeStyle.VISIBLE,this.browserTabVisibilityHandler=function(){return t.onBrowserTabVisibilityChanged()},document.addEventListener("visibilitychange",this.browserTabVisibilityHandler)}else this.viewerDestroyed=!0},t.prototype.onViewerReactivated=function(){this.isolatedOccurrenceManager.setUpListeners(),this.modelViewManagers.getManager().resetSelectionListHandlers(),this.clearElementPreview(),this.elementToPerElementState={},this.localDisplayDataCacheCleared=!1;var e=this.getModelViewManagers().getManager().getSimulationManager();e&&e.onDocumentChange(),this.resetViewState()},t.prototype.showWebGLContextLostMessage=function(){var e=this.getModelViewManagers().getManager();if(e.displayingPartStudio()||e.displayingAssembly()){var t=r('<div class="context-loss-message">'+i18n("One moment")+"</div>").appendTo(this.$el.parent());this.clearContextLossTimeout(),this.contextLossTimeout=window.setTimeout((function(){t.html(G())}),s.default.getManager().getNumber("WEBGL_CONTEXT_WARNING_TIMEOUT_MS")),this.viewManipulator&&this.viewManipulator.hide()}},t.prototype.clearContextLossTimeout=function(){(0,P.isNumber)(this.contextLossTimeout)&&(window.clearTimeout(this.contextLossTimeout),this.contextLossTimeout=null)},t.prototype.hideWebGLContextLostMessage=function(){var e=this.$el.parent().find(".context-loss-message");e.length>0&&(e.remove(),this.viewManipulator&&!this.hidden&&this.viewManipulator.show())},t.prototype.getEventDispatcher=function(){return this.eventDispatcher},t.prototype.setEventDispatcher=function(e){this.eventDispatcher=e},t.prototype.getOccurrenceIdManager=function(){return this.occurrenceIdManager},t.prototype.getActiveElementId=function(){return this.activeElementId},t.prototype.getBodyManager=function(){return this.bodyManager},t.prototype.getIdForOccurrence=function(e){return e?this.occurrenceIdManager.getIdForName(e.getPathAsString()):L.PART_STUDIO_ELEMENT_ID},t.prototype.getModelViewManagers=function(){return this.modelViewManagers},t.prototype.getReceivedComputedData=function(){return this.receivedComputedData},t.prototype.getReceivedFeatureData=function(){return this.receivedFeatureData},t.prototype.getSceneGraphs=function(){return this.sceneGraphs},t.prototype.getUiResourceManager=function(){return this.uiResourceManager},t.prototype.getOccurrenceDataManager=function(){return this.occurrenceDataManager},t.prototype.getIsolatedOccurrenceManager=function(){return this.isolatedOccurrenceManager},t.prototype.getUISelectionManager=function(){return this.uiSelectionManager},t.prototype.getSilhouetteTask=function(){return this.silhouetteTask},t.prototype.areEdgeSilhouettesEnabled=function(){return this.detailManager.areFullDetailEdgeSilhouettesEnabled()},t.prototype.isInteractiveFramerateBelowThreshold=function(){return this.detailManager.isInteractiveFramerateBelowThreshold()},t.prototype.areInteractiveDetailsSignficantlyReduced=function(){return this.detailManager.getInteractiveSettings().lowLevelBodyProportion>0},t.prototype.isInteractiveSsaoEnabled=function(){return this.detailManager.isInteractiveSsaoEnabled()},t.prototype.areInteractiveSilhouettesEnabled=function(){return this.detailManager.areInteractiveSilhouettesEnabled()},t.prototype.getEdgePointController=function(){return this.edgePointController},t.prototype.createEdgePointController=function(){this.edgePointController&&this.edgePointController.disable(),this.edgePointController=new L.EdgePointController(this)},t.prototype.getDefaultStandardView=function(){return this.getIsForFlattenedDisplay()?"XY":"Trimetric"},t.prototype.onMouseEnter=function(){(0,L.setFocusedViewer)(this),this.hasMouseOver=!0},t.prototype.onMouseLeave=function(){this.hasMouseOver=!1},t.prototype.getHasMouseOver=function(){return this.hasMouseOver},t.prototype.getIsForFlattenedDisplay=function(){return!!this.isForFlattenedDisplay},t.prototype.requestDrawUsingTimer=function(e,t,i){t=t||X;var r=this;if(!this.drawTimer||i){if(!e){if(this.disableAutomaticDrawing)return;e=function(){r.drawTimer=null;r.draw(undefined,t)}}this.drawTimer=window.setTimeout(e,10)}},t.prototype.requestDrawUsingAnimationFrame=function(e,t,i){var r=this;t=t||X;var n=this;if(i||e||!this.standardRequestCallbackQueued&&!this.inRequestDrawCallback){if(e){var o=e;e=function(e){r.inRequestDrawCallback=!0,o(e),r.inRequestDrawCallback=!1}}else{if(this.disableAutomaticDrawing)return;e=function(e){n.standardRequestCallbackQueued=!1,n.inRequestDrawCallback=!0,n.draw(e,t),n.inRequestDrawCallback=!1},n.standardRequestCallbackQueued=!0}window.requestAnimationFrame(e)}},t.prototype.forceRequestDraw=function(e){this.requestDraw(void 0,e,!0)},t.prototype.requestDrawForInteractiveProcessing=function(){this.requestDrawUsingTimer(undefined,q)},t.prototype.resetPickPassCount=function(){this.pickPassCount=0},t.prototype.notifyOfPickPassCount=function(e){e>this.pickPassCount&&(this.pickPassCount=e)},t.prototype.getPickPassCount=function(){return this.pickPassCount},t.prototype.onGlContextLost=function(){this.resetCachedState(),this.resetSharedBuffers(),this.memoryGauge.reset(),this.frameTimer.onContextLost()},t.prototype.onGlContextRestored=function(){this.frameTimer.onContextRestored()},t.prototype.onSessionEnded=function(){this.resetShaders(),this.resetSharedBuffers(),this.resources.reset()},t.prototype.bindTextureToUnit=function(e,t){this.boundTextures[t]!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.boundTextures[t]=e)},t.prototype.getSketch=function(){return this.sketch},t.prototype.setSketch=function(e){this.sketch&&(e&&this.sketch.id===e.id||this.getModelViewManagers().getManager().displaySketchAsInactive(this.sketch.id),this.sketch=null);var t=this.getPrimaryViewController();e?(e.viewer=this,this.sketch=e,this.getModelViewManagers().getManager().displaySketchAsActive(this.sketch.id),t&&t.isPerspective()&&(this.returnToPerspective=!0,this.setPrimaryViewController(t.getMatchingOrthographicController())),(0,L.getActiveViewerEventDispatcher)().trigger(L.SPACEMOUSE_ACTION_SET_CHANGED,L.ActionIds.SKETCH)):this.returnToPerspective&&(t&&t.isOrthographic()&&this.setPrimaryViewController(t.getMatchingPerspectiveController()),this.returnToPerspective=!1),this.getInputHandler()&&this.getInputHandler().setSketch(this.sketch),this.sketch||(0,L.getActiveViewerEventDispatcher)().trigger(L.SPACEMOUSE_ACTION_SET_CHANGED,L.ActionIds.PART_STUDIO)},t.prototype.disableCurrentLaminarHighlightController=function(){var e=this.getFilteredEntitiesHighlightController();e&&(e.disable(),this.setFilteredEntitiesHighlightController(null))},t.prototype.clearSketch=function(e){this.sketch===e?this.setSketch(null):f.log.info("sketch to be cleared does not match the current sketch")},t.prototype.setHoveredSelection=function(e){if(this.clearHoveredSelection(),e instanceof I.Selection)(0,I.updatePreselectionList)(e);else if(e instanceof L.UISelection){var t=this.getUISelectionManager();t&&t.setHoveredSelection(e,{})}},t.prototype.clearHoveredSelection=function(){var e=this.getUISelectionManager();e&&e.setHoveredSelection(null,{});(0,I.handleEmptyPick)(!0,!1)},t.prototype.getInputHandler=function(){return this.inputHandler},t.prototype.setSuppressMouseMovePick=function(e){this.inputHandler&&this.inputHandler.setSuppressMouseMovePick(e)},t.prototype.getLastMouseMovedEvent=function(){return this.inputHandler?this.inputHandler.getLastMouseMovedEvent():null},t.prototype.getLastMouseLocation=function(){return this.lastMouseLocation},t.prototype.getFrustumToPreventCulling=function(){return this.frustumToPreventCulling},t.prototype.getResources=function(){return this.resources},t.prototype.setViewInitialized=function(e){this.viewInitialized=e},t.prototype.resetCachedState=function(){this.attribVertexEnabled={},this.boundTextures={}},t.prototype.resetShaders=function(){this.instantiatedShaders={},this.resetCachedState()},t.prototype.resetSharedBuffers=function(){this.sharedFrameBuffers={},this.sharedRenderBuffers={}},t.prototype.getOrCreateFrameBuffer=function(e,t,i){if(!t)return new L.FrameBuffer(this,e,t,i);var r=this.sharedFrameBuffers[t];return r||(this.sharedFrameBuffers[t]=r=new L.FrameBuffer(this,e,t,i)),r},t.prototype.getOrCreateRenderBuffer=function(e,t,i){var r=i.id,n=null;if(!r)return n=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,n),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,i.storageType,e,t),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),n;var o=this.sharedRenderBuffers[r];return o&&o.width===e&&o.height===t?o.buffer:(n=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,n),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,i.storageType,e,t),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.sharedRenderBuffers[r]={buffer:n,width:e,height:t},n)},t.prototype.resetExtensions=function(){var e=Object.keys(this.extensions);this.extensions={};for(var t=0;t<e.length;++t)this.getExtension(e[t])},t.prototype.getExtension=function(e){if(!this.gl)return null;var t=this.extensions[e];return void 0!==t||(t=this.gl.getExtension(e),this.extensions[e]=t),t},t.prototype.isExtensionSupported=function(e){return!!this.getExtension(e)},t.prototype.areFloatTexturesSupported=function(){return this.isExtensionSupported("OES_texture_float")},t.prototype.isFloatBufferBlendingSupported=function(){return this.isExtensionSupported("EXT_float_blend")},t.prototype.are32BitIndicesSupported=function(){return this.isExtensionSupported("OES_element_index_uint")},t.prototype.isHighPrecisionFragmentShaderSupported=function(){return(0,L.isHighPrecisionFragmentShaderSupported)(this.gl)},t.prototype.getAnisotropicExtension=function(){return this.getExtension("EXT_texture_filter_anisotropic")||this.getExtension("WEBKIT_EXT_texture_filter_anisotropic")},t.prototype.getDrawbuffersExtension=function(){return this.getExtension("WEBGL_draw_buffers")||this.getExtension("EXT_draw_buffers")},t.prototype.getHalfFloatType=function(){var e=this.getExtension("OES_texture_half_float");return e?e.HALF_FLOAT_OES:0},t.prototype.getDefaultFloatTextureType=function(){return this.getHalfFloatType()||this.gl.FLOAT},t.prototype.getHighPrecisionFloatTextureType=function(){return this.gl.FLOAT},t.prototype.areOccurrenceTexturesSupported=function(){if(null===this.occurrenceTexturesSupported)if(this.gl){var e=this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.occurrenceTexturesSupported=this.areFloatTexturesSupported()&&e>0}else f.log.warn("An attempt was made to evaluate whether or not occurrence textures are supported before the gl context was initialized");return!!this.occurrenceTexturesSupported},t.prototype.getReferenceHighlights=function(){return this.referenceHighlights},t.prototype.getHighlightManager=function(e){return L.bt_graphics_Usage.PREVIEW===e?this.compareHighlightManager:this.highlightManager},t.prototype.resetHighlightManagers=function(){this.highlightManager=new L.HighlightManager(null),this.compareHighlightManager=new L.HighlightManager(null)},t.prototype.updateHighlightColors=function(e){var t=this;for(var i in F.highlightTypesThatChangeColor.forEach((function(i){t.getReferenceHighlights().updateHighlightColor(i,e)})),(0,L.updateMateConnectorSelectedColor)(e),this.uiElements)this.uiElements[i].onHighlightColorUpdated()},t.prototype.areHighlightVertexTexturesSupported=function(){if(null===this.highlightVertexTexturesSupported)if(this.gl){var e=this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.highlightVertexTexturesSupported=e>1}else f.log.warn("An attempt was made to evaluate whether or not highlight vertex textures are supported before the gl context was initialized");return!!this.highlightVertexTexturesSupported},t.prototype.getRendererInfo=function(){return this.rendererInfo},t.prototype.isSSAOFilteringSupported=function(){return null===this.SSAOFilteringSupported&&(this.SSAOFilteringSupported=!/intel/gi.test(this.rendererInfo.glRenderer)),this.SSAOFilteringSupported},t.prototype.isHighPrecisionSupportedInFragmentShader=function(){if(null!==this.highPrecisionSupportedInFragmentShader)return this.highPrecisionSupportedInFragmentShader;if(!this.gl)return!1;var e=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);return this.highPrecisionSupportedInFragmentShader=0!==e.precision,this.highPrecisionSupportedInFragmentShader},t.prototype.supportsOrderIndependentTranslucency=function(){return this.areFloatTexturesSupported()},t.prototype.supportsGraphicalSectionPlanes=function(){return this.areFloatTexturesSupported()&&this.isFloatBufferBlendingSupported()},t.prototype.getIsExcludingItemsForSection=function(){return(0,x.getActiveSectionViewState)().getIsExcludingItemsForSection()},t.prototype.supportsDraftAnalysis=function(){return this.areFloatTexturesSupported()},t.prototype.getTextureAtlasFactory=function(){return this.textureAtlasFactory||(this.textureAtlasFactory=new L.Factory),this.textureAtlasFactory},t.prototype.debugGetAllocatedTextureUnitsString=function(){for(var e=Object.keys(this.textureNameToUnitMap),t="Texture allocation: ",i=0;i<e.length;++i)t+=e[i]+": "+this.textureNameToUnitMap[e[i]]+", ";return t},t.prototype.getOrAllocateTextureUnit=function(e){if(this.textureNameToUnitMap.hasOwnProperty(e))return this.textureNameToUnitMap[e];for(var t=0;t<this.MAX_TEXTURE_UNITS&&this.textureUnitToNameMap[t];)t++;return t>=this.MAX_TEXTURE_UNITS?(f.log.error("Ran out of texture units (max "+this.MAX_TEXTURE_UNITS+") storing "+e+". Allocation: "+this.debugGetAllocatedTextureUnitsString()),-1):(this.textureNameToUnitMap[e]=t,this.textureUnitToNameMap[t]=e,t)},t.prototype.releaseTextureUnit=function(e){if(this.textureNameToUnitMap.hasOwnProperty(e)){var t=this.textureNameToUnitMap[e];delete this.textureNameToUnitMap[e],delete this.textureUnitToNameMap[t]}else f.log.error("Could not find texture unit for "+e)},t.prototype.getTextureUnit=function(e){return this.textureNameToUnitMap[e]},t.prototype.getGlContext=function(){return this.gl},t.prototype.getShader=function(e){var t=this.instantiatedShaders[e];return t||(t=new L.ShaderProgram(this,e),this.instantiatedShaders[e]=t),t},t.prototype.enableVertexAttributeArray=function(e,t){this.attribVertexEnabled[e]!==t&&(t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e),this.attribVertexEnabled[e]=t)},t.prototype.disableAllVertexAttributeArrays=function(){for(var e in this.attribVertexEnabled)this.enableVertexAttributeArray(+e,!1)},t.prototype.setupGlContext=function(){if(this.gl=null,this.el instanceof HTMLCanvasElement){for(var e=null,t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=0;i<t.length;++i){try{(e=this.el.getContext(t[i],Y))instanceof WebGLRenderingContext||e instanceof CaptureContext||(e=null)}catch(e){}if(e)break}e&&(this.gl=e,this.onNewGlContext())}},t.prototype.onNewGlContext=function(){this.gl&&(this.gl.frontFace(this.gl.CCW),this.gl.enable(this.gl.DEPTH_TEST)),this.resetExtensions(),this.rendererInfo=(0,L.getRendererInfo)(this.gl),(0,g.setLoggingRendererInfo)(this.rendererInfo),this.glSyncEveryFrame=(0,M.isPlatformMac)()&&(0,M.isBrowserSafari)()&&/intel/i.test(this.rendererInfo.glVendor),this.renderContext.onNewContext(this.gl),(0,L.initialize32BitIndexSupport)(this.are32BitIndicesSupported()),(0,L.setRendererInfo)(this.rendererInfo)},t.prototype.getWebGlSupport=function(){var e=w.CoreWebGlSupport.SUPPORTED;return this.el?window.WebGLRenderingContext?this.gl||(e=w.CoreWebGlSupport.OTHER_PROBLEM):e=w.CoreWebGlSupport.MISSING:e=w.CoreWebGlSupport.OTHER_PROBLEM,e},t.prototype.getViewerId=function(){return this.cid},t.prototype.getFrameTimer=function(){return this.frameTimer},t.prototype.onResize=function(e){e=void 0===e||e;var t=this.getGlContext();if(t&&this.el){var i=(0,O.getDevicePixelRatioWithoutOverride)(),r=Math.max(this.$el.width(),1)*i,n=Math.max(this.$el.height(),1)*i;if((0,M.isBrowserSafari)()){var o=screen.width*i,s=screen.height*i;if(r>o||n>s){var a=Math.min(o/r,s/n);f.log.info("Canvas dimensions exceeded screen size, scaling by a factor of: "+a.toFixed(4)),i*=a,(0,O.setDevicePixelRatioOverride)(i),r=Math.max(this.$el.width(),1)*i,n=Math.max(this.$el.height(),1)*i}else(0,O.clearDevicePixelRatioOverride)()}this.el.width=r,this.el.height=n,t.viewportWidth=this.el.width,t.viewportHeight=this.el.height,t.aspectRatio=this.el.width/this.el.height,this.mainDrawPass&&(this.setUserIsManipulatingWithTimeout(),this.getCamera().setViewportFromCanvasElement(this.$el),this.stopBoxSelection(),e&&this.requestDraw())}},t.prototype.pushCameraState=function(e){var t=e;t||(t=this.getCamera()),this.renderContext.setActiveCamera(t),this.renderContext.pushModelViewMatrix(t.getViewMatrix()),this.renderContext.pushProjectionMatrix(t.getProjectionMatrix()),this.renderContext.pushViewport(t.getViewport())},t.prototype.popCameraState=function(){this.renderContext.popModelViewMatrix(),this.renderContext.popProjectionMatrix(),this.renderContext.popViewport()},t.prototype.onComputedData=function(e){e===this.activeElementId&&(this.receivedComputedData=!0,this.updateElementLoadState())},t.prototype.onFeatureData=function(e){e===this.activeElementId&&(this.receivedFeatureData=!0,this.updateElementLoadState())},t.prototype.onAssemblyDefinition=function(e){e===this.activeElementId&&(this.receivedAssemblyDefinition=!0,this.receivedComputedData=!0,this.updateElementLoadState())},t.prototype.setWaitingForLinkOpen=function(){this.isReadyForDrawOnLinkOpen=!1},t.prototype.onReadyForDrawOnLinkOpen=function(){this.isReadyForDrawOnLinkOpen=!0,this.updateElementLoadState()},t.prototype.prepareElementDisplayData=function(){this.elementLoadState===j.LOADING_DISPLAY_DATA&&(this.modelViewManagers.getManager().getModelBounds(),this.elementLoadState=j.LOADED_DISPLAY_DATA,this.updateElementLoadState())},t.prototype.updateElementLoadState=function(){var e=this.modelViewManagers.getManager();this.elementLoadState!==j.LOADED_DISPLAY_DATA||!this.receivedComputedData||!this.isReadyForDrawOnLinkOpen||!this.receivedFeatureData&&e.displayingPartStudio()||!this.receivedAssemblyDefinition&&e.displayingAssembly()||(this.getEventDispatcher().trigger(L.ELEMENT_VIEW_INITIALIZED,this.activeElementId),this.elementLoadState=j.LOADED_ALL_DATA,this.clearElementPreview(),this.elementLoadDeferred.resolve(),this.bodyLoadTask.hasPendingWork()?(this.doesControlBodySpinner()&&(0,S.TaskBeeperManagerGetSingleton)().startBodyLoadBeeper(),this.bodyLoadTimer=new l.Timer("Loading bodies, isForFlattened: "+this.getIsForFlattenedDisplay())):this.doesControlBodySpinner()&&(0,S.TaskBeeperManagerGetSingleton)().stopBodyLoadBeeper(),this.loadTimer&&(this.loadTimer.report(),this.loadTimer=null),this.setReadyState(!0),this.requestDraw())},t.prototype.getElementLoadPromise=function(){return this.elementLoadDeferred.promise},t.prototype.hasPendingBodiesToLoad=function(){return this.bodyLoadTask.hasPendingWork()},t.prototype.doesControlBodySpinner=function(){return!this.getIsForFlattenedDisplay()},t.prototype.getRenderContext=function(){return this.renderContext},t.prototype.getMemoryGauge=function(){return this.memoryGauge},t.prototype.getRenderingMode=function(){return this.renderingMode},t.prototype.setRenderingMode=function(e){this.renderingMode=e,this.renderContext.setRenderingMode(e),this.mainDrawPass.setRenderingMode(e),this.combinedPickPass.setRenderingMode(e);var t=this.getModelViewManagers().getManager().getSimulationManager();t&&t.onRenderingModeChanged(),this.renderModeSubject.next(e),this.requestDraw()},t.prototype.toggleDebugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle=function(){this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle=!this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle},t.prototype.debugIsShowingSilhouetteEdgesOnNonVisibleTangentEdgeStyle=function(){return this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle},t.prototype.showTangencyInformationMissingMessage=function(){this.localDisplayDataCacheCleared||(f.log.trace("Unknown smoothness status edge found, clearing local display data cache"),(0,c.getCommandDispatcher)().trigger(a.commands.CLEAR_LOCAL_DISPLAY_DATA_CACHE),this.localDisplayDataCacheCleared=!0),p.btInjector.MessageBubbleService.showMessageWithAutoDismiss(i18n("Render mode could not be applied. Necessary information is missing in older Display data."))},t.prototype.getSmoothEdgesRenderStyle=function(){return this.smoothEdgeStyle},t.prototype.setSmoothEdgesRenderStyle=function(e){if(this.smoothEdgeStyle!==e){this.smoothEdgeStyle=e,this.getIsForFlattenedDisplay()||(0,L.applySmoothEdgesRenderingStyleChanges)(e);var t=this.getModelViewManagers();if(t.getManager().refreshSmoothEdgesForAllPartStudios()){if(t.previewManagerExists()&&t.getPreviewManager().refreshSmoothEdgesForAllPartStudios(),!this.getIsForFlattenedDisplay()){var i=h.LeaderFollowController.getController();i&&i.onSmoothEdgeStyleChanged(this);var r=u.DocumentController.getOpenDocumentController();if(r){var n=r.getSheetMetalViewer();n&&this!==n&&this.getActiveElementId()===n.getActiveElementId()&&(n.setSmoothEdgesRenderStyle(e),n.requestDraw())}}}else this.setSmoothEdgesRenderStyle(T.GBTSmoothEdgeStyle.VISIBLE)}},t.prototype.initializeForDrawing=function(){this.initializedForDrawing||(this.onResize(),this.mainDrawPass=new L.MainDrawPass(this),this.drawPasses.push(this.mainDrawPass),this.combinedPickPass=new L.CombinedPickPass(this,this.mainDrawPass),this.mainDrawPass.getDebugDrawPickPass().setPickPass(this.combinedPickPass),this.drawPasses.push(this.combinedPickPass),this.depthRetrievalPass=new L.DepthRetrievalPass(this),this.drawPasses.push(this.depthRetrievalPass),this.draftAngleRetrievalPass=new L.DraftAngleRetrievalPass(this),this.drawPasses.push(this.draftAngleRetrievalPass),this.depthSamplingPass=new L.DepthSamplingPass(this),this.drawPasses.push(this.depthSamplingPass),this.mainDrawPass.prepareShaders(),this.combinedPickPass.prepareShaders(),this.depthRetrievalPass.prepareShaders(),this.depthSamplingPass.prepareShaders(),this.viewController||(this.viewController=new L.OrthographicController(this),this.viewController.getCamera().setViewportFromCanvasElement(this.$el),this.viewController.setStandardView(this.getDefaultStandardView())),this.initializedForDrawing=!0)},t.prototype.initializeView=function(){if(!this.viewInitialized){var e=this.getCamera(),t=e.getViewportWidth()*e.getViewportHeight()>=W.getNumber("MIN_MODEL_PIXEL_SIZE"),i=this.getModelBounds();t&&i.isInitialized()&&i.isExtensive()&&(this.zoomFit(),this.viewInitialized=!0),this.findDepthsInRect(0,0,1,1)}},t.prototype.hasResourcesNeededForDrawing=function(){var e=!this.isForFlattenedDisplay||this.modelViewManagers.getManager().hasSelectedSheetmetalModelId();return(this.hasElementPreviewLoaded||this.elementLoadState===j.LOADED_ALL_DATA)&&!(0,L.areTexturesPendingLoad)()&&e},t.prototype.isReadyForDrawing=function(){return!!this.getGlContext()&&this.initializedForDrawing&&this.hasResourcesNeededForDrawing()},t.prototype.getFilteredEntitiesHighlightController=function(){return this.filteredEntitiesHighlightController},t.prototype.setFilteredEntitiesHighlightController=function(e){return this.filteredEntitiesHighlightController=e,this.filteredEntitiesHighlightController},t.prototype.draw=function(e,t){if(!this.viewerDestroyed){var i=this.getGlContext();if(i){t=t||K;var r=(0,O.getDevicePixelRatio)();if(r!==this.lastDevicePixelRatio){t.forPrint||this.el.width===this.$el.width()*r&&this.el.height===this.$el.height()*r||this.onResize(!1),this.lastDevicePixelRatio=r;var n=this.getCamera();for(var o in this.getEventDispatcher().trigger(L.DEVICE_PIXEL_RATIO_CHANGED,n),this.uiElements)this.uiElements[o].onDevicePixelRatioChanged(n);this.resetPickRadius()}if(e){if(e===this.timestampOfLastDraw)return;this.timestampOfLastDraw=e,(0,L.onViewerDraw)(this,e)}if(this.initializeForDrawing(),this.prepareElementDisplayData(),this.hasResourcesNeededForDrawing()){this.initializeView(),t.performFrameTiming&&this.frameTimer.onDrawStart(),this.renderContext.setDetailSettings(this.detailManager.getDetailSettings()),(0,L.getCounters)().resetCounters();var s=t.camera?t.camera:this.getCamera();this.triggerOnViewWillDraw(s),this.processPendingWork(),this.cleanUpOrphanedObjects(),s.setSceneBounds(this.getSceneBounds()),this.pushCameraState(s),t.skipUpdateBodyCulling||this.bodyManager.updateForFrame(this.renderContext,!0),this.renderContext.prepareForNextFrame(),this.mainDrawPass.drawInputs(this.renderContext),this.mainDrawPass.draw(this.renderContext),this.popCameraState(),this.getEventDispatcher().trigger(L.VIEW_DID_DRAW,this),this.memoryGauge.addToStatistics(),(0,L.getCounters)().updateModel(),this.performBodyCheckAsNeeded(),this.glSyncEveryFrame&&i.finish(),t.performFrameTiming&&this.frameTimer.onDrawEnd()}else this.hidden||this.processPendingWork()}}},t.prototype.triggerOnViewWillDraw=function(e){var t=(0,m.getCurrentDocumentSettingsModel)();for(var i in this.getEventDispatcher().trigger(L.VIEW_WILL_DRAW,e,t),this.uiElements)this.uiElements[i].onViewWillDraw(e,t)},t.prototype.processPendingWork=function(){this.taskManager.hasPendingWork()&&!this.frameTimer.userIsInteracting()&&(this.taskManager.processInteractively(),this.requestDrawForInteractiveProcessing()),this.bodyLoadTask.hasPendingWork()||(this.bodyLoadTimer&&(this.doesControlBodySpinner()&&(0,S.TaskBeeperManagerGetSingleton)().stopBodyLoadBeeper(),this.bodyManager.initiateAutomaticRetrieval(),this.bodyLoadTimer.report(),this.frameTimer.resetTimings(),this.bodyLoadTimer=null),this.hasResourcesNeededForDrawing()||this.modelViewManagers.getManager().getMeshManager().compileBuffers())},t.prototype.performBodyCheckAsNeeded=function(){this.performBodyCheck&&this.areFloatTexturesSupported()&&!this.bodyLoadTask.hasPendingWork()&&this.modelViewManagers.getManager().displayingPartStudio()&&(this.bodyCheckPass.draw(this.renderContext),this.performBodyCheck=!1)},t.prototype.cleanUpOrphanedObjects=function(){this.getUiResourceManager().clean(),(0,L.cleanUpParentlessNodes)(),this.disableAllVertexAttributeArrays()},t.prototype.getSceneBounds=function(){var e=new L.BoundingBox,t=this.sceneGraphs.getMainSceneGraph().getRootNode().getBoundingBox({includeHiddenBounds:this.renderContext.getIsPickingHiddenOccurrences()}),i=this.sceneGraphs.getPreviewSceneGraph().getRootNode().getBoundingBox();e.addBox(t),e.addBox(i);var r=this.modelViewManagers.getManager().getSimulationManager();return r&&e.addBox(r.getSimulationBounds()),(!e.isInitialized()||!e.isExtensive())&&this.hasElementPreviewLoaded&&this.activeElementPreviewManager&&e.addBox(this.activeElementPreviewManager.getModelBounds()),this.zoomToSelectionBounds&&this.zoomToSelectionBounds.isFinite()&&e.addBox(this.zoomToSelectionBounds),e.isInitialized()&&e.isExtensive()||e.set([-1,-1,-1],[1,1,1]),e},t.prototype.getModelBounds=function(e){var t=new L.BoundingBox,i=this.modelViewManagers.getManager().getModelBounds(e);i&&t.addBox(i,null);var r=this.modelViewManagers.getPreviewManager();return r&&t.addBox(r.getModelBounds(e),null),t.isInitialized()&&t.isExtensive()||!this.hasElementPreviewLoaded||!this.activeElementPreviewManager||t.addBox(this.activeElementPreviewManager.getModelBounds()),t},t.prototype.getUiElementsBounds=function(){var e=new L.BoundingBox;for(var t in this.uiElements){var i=this.uiElements[t];i.isVisibleToUser()&&e.addBox(i.getFitBounds(),i.getTransform())}return e},t.prototype.getFitBounds=function(e){var t=this.getUiElementsBounds();if(t.addBox(this.getModelBounds()),!t.isInitialized()||!t.isExtensive())return this.getSceneBounds();if((0,L.getSectionPlaneCount)()>0&&this.isReadyForDrawing()){e||(e=this.getCamera().getFrame());var i=this.getPrimaryViewController().getZoomFitTargetCamera(e,t,!0);this.pushCameraState(i),(0,L.makePlaneEquationMatrixDirty)(),this.bodyManager.updateForFrame(this.renderContext,!1),this.depthSamplingPass.retrieve(this.renderContext,{numSamples:W.getNumber("HIGH_QUALITY_DEPTH_SAMPLES_PER_VIEWPORT"),performIsolationTest:!1}),this.popCameraState();for(var r=new L.BoundingBox,n=0;n<this.depthSamplingPass.points.length;++n)r.addPoint(i.canvasToWorld(this.depthSamplingPass.points[n]));if(!r.isInitialized()||!r.isExtensive())return this.getSceneBounds();r.maxDimension()/t.maxDimension()<.9&&r.scale(W.getNumber("CAMERA_ZOOM_TO_FIT_SECTION_PLANE_EXTRA_SLOP")),t=r}return t},t.prototype.getAnimationController=function(){return this.animationController},t.prototype.getPrimaryViewController=function(){return this.viewController},t.prototype.getCamera=function(){return this.viewController?this.viewController.getCamera():null},t.prototype.setPrimaryViewController=function(e){this.viewController!==e&&(this.viewController&&this.viewController.destroy(),this.viewController=e,this.requestDraw())},t.prototype.setPickRadius=function(e){this.pickRadius=e},t.prototype.resetPickRadius=function(){this.setPickRadius(W.getNumber("MOUSE_PICK_RADIUS_PX"))},t.prototype.pick=function(e,t,i){return this.pickIteratively(e,t,this.getDefaultPickTerminationEvaluator(),i)},t.prototype.getDefaultPickTerminationEvaluator=function(){var e=this,t=0;return function(i,r){return++t>100||e.combinedPickPass.updatePickMask(i,e.renderingMode,r)}},t.prototype.pickIteratively=function(e,t,i,r){for(var n,o,s=[],a=2*this.pickRadius+1,c=2*this.pickRadius+1,l=e-this.pickRadius,u=t-this.pickRadius,h=!1,d=0,p={},g=this.modelViewManagers.getManagerForUsage((0,L.getPickUsage)()),m=this.getRenderingMode();;){var y=this.pickInRect(l,u,a,c,{pickHiddenOccurrences:!!r&&!!r.pickHiddenOccurrences});if(y.length<1)break;for(n=0;n<y.length;++n){var v=(o=y[n]).getModelSelection();if(v){var E=v.getIdForCollection();if(!E||p[E])continue;p[E]=E}o.fromPass=d,s.push(o)}if(i(y,r))break;for(n=0;n<y.length;++n)y[n].canPickThrough(m,this,r)&&(this.hidePick(y[n],g),h=!0);++d}return this.combinedPickPass.clearPickMask(),h&&this.resetIdsHiddenFromPick(),r&&r.altKey?(0,B.pickSortWithTranslucency)(s,(function(e){var t=e.getModelSelection();if(null===t)return f.log.warn("Cannot determine translucency of pick element for sorting, assuming default opacity."),!1;if(t.entityMetaData.isTranslucent())return!0;var i=t.getOccurrence(),r=e.getOccurrenceId(),n=g.getPartStudioDataFromOccurrence(i).getBodyComponent().getFaceColor(e.deterministicId,r);return n&&n[3]<1})):s.sort(B.basicPickSort)},t.prototype.pickMany=function(e,t,i,r){var n=2*i+1,o=2*i+1,s=e-i,a=t-i;return this.pickManyInRect(s,a,n,o,!0,!1,r)},t.prototype.pickInRect=function(e,t,i,r,n){if(!this.isReadyForDrawing())return[];var o,s;this.getEventDispatcher().trigger(L.VIEW_WILL_PICK,this.getCamera(),(0,m.getCurrentDocumentSettingsModel)()),this.renderContext.setIsPickingHiddenOccurrences(!!n&&!!n.pickHiddenOccurrences),this.getCamera().setSceneBounds(this.getSceneBounds()),this.pushCameraState(),this.combinedPickPass.setPickRect(e,t,i,r,n&&n.sampleLimit),n&&n.doNotAffectFrustumCulling||(this.frustumToPreventCulling=this.combinedPickPass.getPickFrustum(this.renderContext,k)),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),n&&n.nodeFilterOverride?this.combinedPickPass.setNodeFilterOverride(n.nodeFilterOverride):this.combinedPickPass.setNodeFilterOverride(null),this.combinedPickPass.setPickFromPreview((0,L.pickFromPreview)()||!!n&&!!n.forcePreviewPick),this.combinedPickPass.draw(this.renderContext),this.renderContext.setIsPickingHiddenOccurrences(!1),this.popCameraState();var a,c=this.combinedPickPass.gatherPicksFromPickPass(),l=[],u=this.modelViewManagers.getManagerForUsage(this.combinedPickPass.getUsage());for(s in c){s=+s;var h=this.getOccurrenceIdManager().getNameForId(+s);h||s===L.NO_ID||this.loggedPickIssue||(f.log.warn("Did not find valid occurrence name for occurrence id: "+s),this.loggedPickIssue=!0);var d=null,p=null,g=(0,L.isOccurrenceNameForUi)(h);if(g&&h){if(!(p=this.uiElements[h])&&!this.loggedPickIssue){f.log.warn("Could not find ui element with name: "+h),this.loggedPickIssue=!0;continue}}else h&&"PART_STUDIO_SKETCHES"!==h&&0!==h.indexOf("body.")&&(d=T.BTOccurrence.getOccurrenceFromPathString(h));for(o in c[s]){if(a=c[s][o],g){if(a.uiSelection=p.getSelection(a.occurrenceId,a.primitiveId),!a.uiSelection&&!this.loggedPickIssue){f.log.warn("Could not find owner of mouse pick"),this.loggedPickIssue=!0;continue}a.uiSelection.sourcePick=a}else{if(this.bodyManager.isBodyManagerOccurrence(d)){n&&n.bodyPicks?n.bodyPicks.push(a):this.bodyManager.pickedOccurrenceId(a.primitiveId);continue}if(a.deterministicId=u.getDeterministicIdForPickId(d,a.primitiveId),!a.deterministicId&&!this.loggedPickIssue){f.log.warn("Did not find picked entity's deterministic id"),this.loggedPickIssue=!0;continue}var y=u.retrieveEntityMetaData(d,a.deterministicId);if(y)a.entityMetaData=y;else if(a.bodyMetaData=u.retrieveBodyMetaData(d,a.deterministicId),!a.bodyMetaData&&!this.loggedPickIssue){f.log.warn("Did not find picked deterministic id's metadata"),this.loggedPickIssue=!0;continue}a.occurrence=d}l.push(a)}}return this.mainDrawPass.getDebugDrawPickPass().getEnabled()&&this.requestDraw(),l},t.prototype.retrieveVisiblePicks=function(e,t,i,r){if(!this.combinedPickPass)return f.log.warn("Pick pass is not initialized"),null;this.combinedPickPass.setEnablePickViewportScaling(!1);var n=this.pickInRect(e,t,i,r);return this.combinedPickPass.setEnablePickViewportScaling(!0),n},t.prototype.pickManyInRect=function(e,t,i,r,n,o,s){this.combinedPickPass.setPickAlternatesEnabled(!0),this.renderContext.setBackFacePicking(n),o&&this.subtractEntitiesIntersectingBox(e,t,i,r);var a=this.pickManyInRectInternal(e,t,i,r,s);return this.renderContext.setBackFacePicking(!1),this.combinedPickPass.setPickAlternatesEnabled(!1),this.resetIdsHiddenFromPick(),a},t.prototype.subtractEntitiesIntersectingBox=function(e,t,i,r){var n=Math.max(e-1,0),o=Math.max(t-1,0),s=Math.min(t+r,this.getCamera().getViewportHeight()-1),a=Math.min(e+i,this.getCamera().getViewportWidth()-1);this.pickAllInBox(n,o,a-n,1),this.pickAllInBox(n,s,a-n,1),s-o>2&&(this.pickAllInBox(n,o+1,1,s-o-2),this.pickAllInBox(a,o+1,1,s-o-2))},t.prototype.pickAllInBox=function(e,t,i,r){this.pickManyInRectInternal(e,t,i,r,void 0,void 0,!0)},t.prototype.performingBoxSelection=function(){return!!this.boxSelectionDeferred},t.prototype.performBoxSelection=function(e,t,i,r,n){if(this.performingBoxSelection())return null;if(0===i||0===r)return null;(0,S.TaskBeeperManagerGetSingleton)().startBoxSelectionBeeper(),(0,I.clearBoxSelectionPreviewSelectionList)(),this.combinedPickPass.setPickAlternatesEnabled(!0),this.combinedPickPass.setIsBoxSelecting(!0),this.renderContext.setBackFacePicking(!0),n&&this.subtractEntitiesIntersectingBox(e,t,i,r),this.boxSelectionDeferred=E.defer();var o=this.boxSelectionDeferred.promise,s=this,a=function(){if(s.performingBoxSelection()){s.setUserIsManipulatingWithTimeout();var n=s.pickManyInRectInternal(e,t,i,r,void 0,15,!0);n.length>0?((0,I.addPicksToBoxSelectionPreview)(n),s.draw(),setTimeout(a,45)):((0,I.completeBoxSelection)(),s.stopBoxSelection())}};return setTimeout(a,10),o},t.prototype.setSuppressNonIsolatedPicks=function(e){this.combinedPickPass.setSuppressNonIsolatedPicks(e)},t.prototype.stopBoxSelection=function(){this.performingBoxSelection()&&(this.renderContext.setBackFacePicking(!1),this.combinedPickPass.setIsBoxSelecting(!1),this.combinedPickPass.setPickAlternatesEnabled(!1),this.resetIdsHiddenFromPick(),this.boxSelectionDeferred.resolve(),this.boxSelectionDeferred=null,(0,S.TaskBeeperManagerGetSingleton)().stopBoxSelectionBeeper(),(0,I.clearBoxSelectionPreviewSelectionList)(),this.processQueuedDisplayData(),this.doPreHighlightPick(!0))},t.prototype.canProcessDisplayData=function(){return this.haveUnitsBeenReceived&&!this.performingBoxSelection()},t.prototype.processQueuedDisplayData=function(e){if(e&&this.stopBoxSelection(),this.canProcessDisplayData()){for(var t=0;t<this.queuedDisplayData.length;++t){var i=this.queuedDisplayData[t];i.displayData instanceof T.BTPartStudioDisplayData?this.onNewPartStudioDisplayData(i.displayData,i.selectionMapper):i.displayData instanceof T.BTRootAssemblyDisplayData&&this.onRootAssemblyDisplayData(i.displayData)}this.queuedDisplayData=[]}},t.prototype.setUnitsReceived=function(e){this.haveUnitsBeenReceived=e,e&&this.processQueuedDisplayData()},t.prototype.isPickFromHiddenOccurrence=function(e){var t=this.occurrenceDataManager.getOccurrenceData(e.occurrenceId);return t&&t.getVisibility()===L.Visibility.HIDDEN},t.prototype.resetIdsHiddenFromPick=function(){this.occurrenceDataManager.resetHiddenFromPick(),(0,L.resetSectionPlanesHiddenFromPick)();for(var e=this.getModelViewManagers().getManager(),t=0;t<this.selectionsToKeepHiddenFromPick.length;++t){var i=this.selectionsToKeepHiddenFromPick[t],r=e.getEntityIdsForSelection(i),n=e.getOccurrenceIdForSelection(i),o=i.getOccurrence();if((0,L.isIdValid)(n))for(var s=0;r&&s<r.length;++s)e.hideEntityFromPick(r[s],n,o)}},t.prototype.setSelectionsToKeepHiddenFromPick=function(e){this.selectionsToKeepHiddenFromPick=e,this.resetIdsHiddenFromPick()},t.prototype.resetSelectionsToKeepHiddenFromPick=function(){this.setSelectionsToKeepHiddenFromPick([])},t.prototype.getClosestPointAtPixel=function(e,t,i){for(var r=2*i+1,n=2*i+1,o=e-i,s=t-i,a=this.findDepthsInRect(o,s,r,n),c=null,l=1/0,u=0;u<a.length;++u)if(a[u][2]!==L.UNKNOWN_DEPTH){var h=a[u],d=h[2];d<l&&(c=h,l=d)}return c?(c[0]=e,c[1]=t,this.getCamera().canvasToWorld(c)):null},t.prototype.pickManyInRectInternal=function(e,t,i,r,n,o,s){var a=[],c=new A.StringSet,l=new A.StringSet,u=(0,L.getTimeInMilliseconds)(),h=!1,d=s?(0,I.getCurrentBoxSelectionFilter)():(0,I.getCurrentSelectionQueryFilter)();s&&(h=(0,I.getAllowedBoxSelections)().allowsBodies);var p=this.modelViewManagers.getManagerForUsage((0,L.getPickUsage)()),g=0;do{for(var m=this.pickInRect(e,t,i,r),y=new A.StringSet,v=0;v<m.length;++v){var E=m[v];E.fromPass=g;var T=!0,S=E.getId(),P=E.getBodyId();if(P&&h){var _=P+R.ID_SEPARATOR+E.occurrenceId;l.contains(_)?T=!1:!d||d.doesBodyLevelSelectionPass(E.getModelSelection())?(p.hideBodyFromPick(P,E.occurrenceId,E.occurrence),l.add(_),S=_):this.hidePick(E,p)}else this.hidePick(E,p);if(c.contains(S))return f.log.warn("The same pick was found twice, when it should have been hidden"),[];if(y.add(S),T&&a.push(E),n&&a.length>=n)break}if(0===m.length||n&&a.length>=n)break;c=y,++g}while(void 0===o||(0,L.getTimeInMilliseconds)()-u<o);return a},t.prototype.hidePick=function(e,t){e.isUIPick()?e.uiSelection.hideFromPick():t.hideEntityFromPick(e.getIncrementId(),e.occurrenceId,e.occurrence),(0,L.hideSectionPlaneFromPick)(e.occurrenceId)},t.prototype.findDepthsInRect=function(e,t,i,r,n){return this.isReadyForDrawing()?(this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),n=void 0===n||n,this.depthRetrievalPass.setPickRect(e,t,i,r),this.depthRetrievalPass.retrieve(this.renderContext,n),this.popCameraState(),this.depthRetrievalPass.points):[]},t.prototype.findDraftAngle=function(e,t,i,r,n){return r=r||1,n=n||1,this.isReadyForDrawing()?(this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),this.draftAngleRetrievalPass.setOccurrenceIds(this.mainDrawPass.draftAnalysisPass.getIdsToParts()),this.draftAngleRetrievalPass.setDirection(e),this.draftAngleRetrievalPass.setPickRect(t,i,r,n),this.draftAngleRetrievalPass.retrieve(this.renderContext),this.popCameraState(),this.draftAngleRetrievalPass.points):[]},t.prototype.findSimulationScalar=function(e,t,i,r,n){if(!this.isReadyForDrawing())return[];r=r||1,n=n||1,this.scalarRetrievalPass||(this.scalarRetrievalPass=new L.ScalarRetrievalPass(this),this.drawPasses.push(this.scalarRetrievalPass)),this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),this.scalarRetrievalPass.setPickRect(t,i,r,n);var o=this.scalarRetrievalPass.retrieve(this.renderContext,e);return this.popCameraState(),o},t.prototype.retrieveSelectionPosition=function(e){return this.retrieveCanvasLocationWorldPosition(e.getPickLocation())},t.prototype.retrieveCanvasLocationWorldPosition=function(e){if(!this.isReadyForDrawing())return null;var t=e;if(!t)return null;this.depthRetrievalPass.setRetrieveFromPreview(!1);var i=this.findDepthsInRect(t[0],t[1],1,1);return this.depthRetrievalPass.setRetrieveFromPreview(!0),i.length>0&&i[0][2]!==L.UNKNOWN_DEPTH?this.getCamera().canvasToWorld(i[0]):null},t.prototype.retrieveDepthSampling=function(e){return this.isReadyForDrawing()?(this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),this.depthSamplingPass.retrieve(this.renderContext,e),this.popCameraState(),this.depthSamplingPass.points):[]},t.prototype.retrieveHighlightsOnlyDepthSampling=function(){return this.isReadyForDrawing()?(this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),this.depthSamplingPass.retrieve(this.renderContext,{useHighlightsOnly:!0}),this.popCameraState(),this.depthSamplingPass.points):[]},t.prototype.addUIElement=function(e){this.uiElements[e.getCollectionId()]=e},t.prototype.removeUIElement=function(e){delete this.uiElements[e.getCollectionId()],this.uiSelectionManager.removeSelectionForUiElement(e)},t.prototype.destroy=function(){if(!this.viewerDestroyed){this.selectOtherView&&this.selectOtherView.destroy(),this.areSectionPlanesEnabled()&&(0,L.removeSectionPlanes)(!1),(0,L.clearPlaneEquationIds)(),this.stopBoxSelection();var e=this.uiElements;for(var t in this.uiElements={},e)e[t]&&e[t].remove();this.referenceHighlights.destroy(),this.resetHighlightManagers(),this.getEventDispatcher()&&this.getEventDispatcher().trigger(L.SESSION_ENDED),this.sceneGraphs.destroySceneGraphs(),this.cleanUpOrphanedObjects(),this.getOccurrenceIdManager().reset(),(0,L.stopActionController)(),this.el.removeEventListener("webglcontextlost",this.handleContextLoss,!1),this.el.removeEventListener("webglcontextrestored",this.handleContextRestored,!1),this.el.width=0,this.el.height=0,this.renderContext.destroy(),this.bodyManager.destroy(),(0,L.resetStaticSilhouetteState)(),(0,L.removeDrawer)(this.getViewerId()),this.resetPickPassCount(),(0,P.isNumber)(this.recordCapabilitiesTimeout)&&(clearTimeout(this.recordCapabilitiesTimeout),this.recordCapabilitiesTimeout=null),(0,P.isNumber)(this.drawTimer)&&(clearTimeout(this.drawTimer),this.drawTimer=null),this.remove(),this.$el.off(),(0,m.getCurrentDocumentSettingsModel)().off("change:elementUnit"),this.modelViewManagers.clearTheManagers(),this.sceneGraphs.destroySceneGraphs(),this.occurrenceDataManager.destroy(),this.isolatedOccurrenceManager.destroy(),this.edgePointController&&this.edgePointController.disable(),this.inputHandler&&this.inputHandler.remove(),this.printCanvas&&this.onAfterPrint(),this===(0,L.getActiveViewer)()&&(0,b.setActiveViewer)(null),this===(0,L.getFocusedViewer)()&&(0,L.setFocusedViewer)(null),document.removeEventListener("visibilitychange",this.browserTabVisibilityHandler),(0,C.clearObject)(this),this.viewerDestroyed=!0}},t.prototype.setBaseHighlightsEnabled=function(e){this.renderContext.setBaseHighlightsEnabled(e)},t.prototype.visualizeInferenceSceneGraph=function(e){this.mainDrawPass&&(this.mainDrawPass.visualizeInferenceSceneGraph(e),this.requestDraw())},t.prototype.getCanvasCoordinateFromEvent=function(e){if(!e)return[0,0];var t=this.el.getBoundingClientRect(),i=(0,O.getDevicePixelRatio)();return[(e.pageX-t.left)*i,(e.pageY-t.top)*i]},t.prototype.getPageCoordinateFromCanvasXY=function(e,t){var i=(0,O.getDevicePixelRatio)(),r=this.el.getBoundingClientRect();return[e/i+r.left,t/i+r.top]},t.prototype.zoomFit=function(){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().zoomFit(this.getFitBounds())},t.prototype.rotateInDirection=function(e){p.btInjector.CapabilitiesService.checkViewCubeRotateCurrentlyEnabled()?this.rotateInDirectionWithAngle(e,s.default.getManager().getNumber("ROTATE_ANGLE")*Math.PI/180):this.rotateInDirectionWithAngle(e,s.default.getManager().getNumber("PREVIOUS_ROTATE_ANGLE")*Math.PI/180)},t.prototype.rotateIncrementallyInDirection=function(e){this.rotateInDirectionWithAngle(e,s.default.getManager().getNumber("INCREMENTAL_ROTATE_ANGLE")*Math.PI/180)},t.prototype.rotateInDirectionWithAngle=function(e,t){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().rotateInDirection(e,t)},t.prototype.animateToStandardView=function(e){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().animateToStandardView(e,this.getFitBounds(L.StandardViews[e]))},t.prototype.animateToStandardViewIgnoringUIPanels=function(e,t){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().animateToStandardViewIgnoringUIPanels(e,this.getFitBounds(L.StandardViews[e]),t)},t.prototype.animateZoomFit=function(e){e?this.zoomToSelectionBounds=e:this.resetZoomToSelectionBounds(),this.getPrimaryViewController().animateZoomToFit(e||this.getFitBounds())},t.prototype.resetZoomToSelectionBounds=function(){this.zoomToSelectionBounds=null},t.prototype.animateZoomToRectangle=function(e,t,i,r){var n=[e,t,0],o=this.getCamera().canvasToWorld(n),s=[e+i,t+r,0],a=this.getCamera().canvasToWorld(s),c=new L.BoundingBox;c.addPoint(o),c.addPoint(a),this.animateZoomFit(c)},t.prototype.animateTo=function(e){this.resetZoomToSelectionBounds(),this.animateToWithBounds(e,this.getFitBounds(e))},t.prototype.animateToWithBounds=function(e,t){this.getPrimaryViewController().animateToFrameWithZoomFit(e,t,W.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))},t.prototype.animateRotation=function(e,t,i){this.getPrimaryViewController().animateRotation(e,t,W.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),i)},t.prototype.setWaitingForDisplayData=function(){this.elementLoadState=j.WAITING_FOR_DISPLAY_DATA,this.elementLoadDeferred=E.defer()},t.prototype.setWaitingForCompareDisplayData=function(){this.elementLoadState=j.WAITING_FOR_COMPARE_DISPLAY_DATA},t.prototype.stopWaitingForCompareDisplayData=function(){if(this.elementLoadState===j.WAITING_FOR_COMPARE_DISPLAY_DATA){this.setGraphicsLoading(!1,0)}this.elementLoadState===j.WAITING_FOR_DISPLAY_DATA&&(this.shouldWaitForCompareDisplayData=!1)},t.prototype.setGraphicsLoading=function(e,t){this.elementLoadState=j.LOADING_DISPLAY_DATA,this.getEventDispatcher().trigger(L.ELEMENT_GRAPHICS_LOADING,this.activeElementId,e,t),this.shouldWaitForCompareDisplayData=!0,this.requestDrawForInteractiveProcessing()},t.prototype.onNewPartStudioDisplayData=function(e,t){if(this.canProcessDisplayData()){var i=new l.Timer("Viewer.onNewPartStudioDisplayData",{setTraceId:!0}),r=this.activeElementId===e.elementId||this.activeElementId===e.forCachedElement,n=this.elementLoadState===j.WAITING_FOR_DISPLAY_DATA,o=this.elementLoadState===j.WAITING_FOR_COMPARE_DISPLAY_DATA,s=!1;if(r){if((0,L.isUsageCompare)()){var a=e.usage===T.GBTDisplayDataUsage.BASE,c=e.usage===T.GBTDisplayDataUsage.COMPARE_TARGET;if(n&&a)this.shouldWaitForCompareDisplayData?this.setWaitingForCompareDisplayData():s=!0;else if(o&&c)s=!0;else if(n&&c)return}else n&&(s=!0);s&&this.setGraphicsLoading(e.fromDisplayCache,e.fromDisplayCache?100:0);var h=this.isForFlattenedDisplay&&this.viewInitialized&&!this.isHidden(),d=!1;if(h){var p=this.getModelBounds({doNotBoundTemporarySketchEntities:!0});d=!p.isInitialized()||this.getCamera().doBoundsFitInViewport(p)}if(this.queuedBaseData&&this.queuedBaseData.elementId===e.elementId&&(this.queuedBaseData.incremental||this.modelViewManagers.resetPreviewManager(),t=this.selectionMapperForQueuedBase,this.modelViewManagers.getManager().processPartStudioDisplayData(this.queuedBaseData,t),this.queuedBaseData=null,this.selectionMapperForQueuedBase=null),e.usage===T.GBTDisplayDataUsage.PREVIEW_BEFORE)return this.queuedBaseData=e,void(this.selectionMapperForQueuedBase=t);var g=this.modelViewManagers.getManager();switch(e.usage){case T.GBTDisplayDataUsage.PREVIEW_AFTER:case T.GBTDisplayDataUsage.PREVIEW_FINAL:case T.GBTDisplayDataUsage.COMPARE_TARGET:g=this.modelViewManagers.getPreviewManager(e)}var m=u.DocumentController.activeFeatureControllerIsSketch(),y=e.usage===T.GBTDisplayDataUsage.PREVIEW_FINAL&&!m;this.setSuppressModelSelection(y),this.setBaseHighlightsEnabled(!y),this.mainDrawPass&&this.mainDrawPass.updateHideInteriorSelections(),(0,L.getEditState)().set("latestDisplayDataUsage",e.usage),g.processPartStudioDisplayData(e,t),e.usage!==T.GBTDisplayDataUsage.BASE?(this.bodyLoadTasks.completeTasks(),this.getIsForFlattenedDisplay()||this.bodyManager.initiateAutomaticRetrieval()):(this.bodyLoadTask.performInitialLoad(),this.bodyLoadTask.hasPendingWork()||this.getIsForFlattenedDisplay()||this.bodyManager.initiateAutomaticRetrieval()),this.setUserIsManipulatingWithTimeout(),e.usage===T.GBTDisplayDataUsage.BASE&&(this.performBodyCheck=!0),this.requestDrawForInteractiveProcessing(),this.detailManager.updateFromLoadedScene(),h&&d&&this.getModelBounds().isInitialized()&&this.animateZoomFit(),i.report()}else f.log.info("Received display data for inactive element: "+e.elementId)}else this.queuedDisplayData.push({displayData:e,selectionMapper:t})},t.prototype.onRootAssemblyDisplayData=function(e,t,i){if(this.canProcessDisplayData())if(this.activeElementId===e.elementId||t&&this.activeElementId===t.elementId){if(this.elementLoadState===j.WAITING_FOR_DISPLAY_DATA&&this.activeElementId===e.elementId&&!i){var r=e.fromDisplayCache?100:e.getPartstudioDisplayDataNoopPercent();this.setGraphicsLoading(e.fromDisplayCache,r)}var n=this.bodyLoadTask.hasPendingWork();this.modelViewManagers.getManager().processRootAssemblyDisplayData(e,t),!n&&this.bodyLoadTask.hasPendingWork()&&this.bodyLoadTask.performInitialLoad(),this.bodyLoadTask.hasPendingWork()||this.bodyManager.initiateAutomaticRetrieval(),e.isCollapsible&&this.setUserIsManipulatingWithTimeout(),this.detailManager.updateFromLoadedScene()}else f.log.info("Received display data for inactive element: "+e.elementId);else this.queuedDisplayData.push({displayData:e,selectionMapper:null})},t.prototype.destroyPreviewGraphics=function(){y.PartList.resetPartListToBase(this.activeElementId),this.modelViewManagers.resetPreviewManager(),(0,L.resetUsage)(),this.mainDrawPass&&this.mainDrawPass.setHideSelectionInterior(!1),this.requestDraw()},t.prototype.setForceHideInteriorSelections=function(e){this.mainDrawPass.setForceHideInteriorSelections(e)},t.prototype.updateLastMouseLocation=function(e){this.lastMouseLocation=this.getCanvasCoordinateFromEvent(e)},t.prototype.resetLastMouseLocation=function(){this.lastMouseLocation=[-1,-1]},t.prototype.raycast=function(e,t,i,r){var n=-1,o=null,s=d.vec3.create(),a=this.getCamera().getRay(e,t),c=d.mat4.identity();r&&(a.point=d.mat4.multiplyVec3(r,a.point,d.vec3.create()),a.direction=d.vec3.create(d.mat4.multiplyVec4(r,d.vec4.createFrom(a.direction[0],a.direction[1],a.direction[2],0),d.vec4.create())),c=d.mat4.inverse(r));for(var l=i.points,u=i.indices,h=function(e){return e*=3,d.vec3.createFrom(l[e],l[e+1],l[e+2])},p=N.Tolerances.ZERO_LENGTH,g=this.getCamera(),f=d.vec2.createFrom(e,t),m=d.vec3.create(),y=d.vec3.create(),v=d.vec3.create(),E=d.vec3.create(),T=d.vec3.create(),S=0;S<u.length-2;S++)if(u[S+2]!==u[S+1]&&u[S+1]!==u[S]&&u[S]!==u[S+2]){var P=[h(u[S]),h(u[S+1]),h(u[S+2])];d.vec3.subtract(P[1],P[0],y),d.vec3.subtract(P[2],P[0],v),d.vec3.cross(a.direction,v,E);var _=d.vec3.dot(E,y);if(!(Math.abs(_)<p)){var M=1/_;d.vec3.subtract(a.point,P[0],m);var D=d.vec3.dot(m,E)*M;if(!(D<0||D>1)){d.vec3.cross(m,y,T);var C=d.vec3.dot(a.direction,T)*M;if(!(C<0||D+C>1)){var O=d.vec3.dot(v,T)*M;if(!(O<p)&&(n<0||n>O)){n=O,o=null;for(var A=0;A<3;A++)if(d.vec2.dist(g.projectWorldPointToCanvas(d.mat4.multiplyVec3(c,P[A],d.vec3.create())),f)<12){o=P[A],d.vec3.cross(y,v,s);break}}}}}}return new I.MeshPointData(o,s)},t.prototype.doPick=function(e,t,i,r,n){var o=(0,L.pickFromPreview)()&&!this.modelViewManagers.getPreviewManager();if(this.performingBoxSelection()||o)return!1;(n=n||{}).mouseX=e,n.mouseY=t,n.camera=this.getCamera(),n.click&&(this.getEventDispatcher().trigger(L.CLOSE_MATE_DOF_CHOOSER),this.getEventDispatcher().trigger(L.CLOSE_SELECT_OTHER));for(var s=(0,L.getTimeInMilliseconds)(),a=this.pick(e,t,n),c=!1,l=0;l<a.length&&!c;++l){var u=a[l],h=u.getModelSelection();if(h&&!this.suppressModelSelection)(c=(0,I.processSelection)(h,i,r,n))&&this.uiSelectionManager.handleEmptyUiPick(i,n);else if(u.isUIPick()&&(c=this.uiSelectionManager.processUiPick(u,n))&&!this.suppressModelSelection){var d=u.getUISelection();d&&!d.getClearModelSelectionsOnPrehilite()||(0,I.handleEmptyPick)(i,!0,n)}}c||(this.suppressModelSelection||(0,I.handleEmptyPick)(i,!1,n),this.uiSelectionManager.handleEmptyUiPick(i,n)),c&&i&&this.setUserIsManipulatingWithTimeout();var p=(0,L.getTimeInMilliseconds)()-s;return this.averagePickDuration<0?this.averagePickDuration=p:this.averagePickDuration=.8*this.averagePickDuration+.2*p,c},t.prototype.doPreHighlightPick=function(e){this.doPick(this.lastMouseLocation[0],this.lastMouseLocation[1],!0,!0,{skipPreHighlight:e,shiftKey:this.inputHandler.getAltHeld()})},t.prototype.onDoubleClick=function(e,t,i){var r={};r.mouseX=e,r.mouseY=t,r.camera=this.getCamera(),r.doubleClick=!0,r.altKey=i.altKey;for(var n=this.pick(e,t,r),o=!1,s=0;s<n.length&&!o;++s){var a=n[s];a.isUIPick()&&(o=this.uiSelectionManager.processUiPick(a,r))}return o},t.prototype.getAveragePickDuration=function(){return Math.max(0,this.averagePickDuration)},t.prototype.setSuppressModelSelection=function(e){this.suppressModelSelection=e,this.suppressModelSelection&&this.stopBoxSelection()},t.prototype.getSuppressModelSelection=function(){return this.suppressModelSelection},t.prototype.getCameraPropertiesForElement=function(e){var t=null,i={graphicsElementId:e=e||"",isValid:!1,projectionType:"",viewMatrix:d.mat4.create(),projectionMatrix:d.mat4.create(),verticalFieldOfView:0,viewportHeight:0,viewportWidth:0};if(this.elementToPerElementState&&this.elementToPerElementState.hasOwnProperty(e)){var r=this.elementToPerElementState[e];r&&(t=r.camera)&&(i.isValid=!0,t.isOrthographic()?i.projectionType="orthographic":t.isPerspective()&&(i.projectionType="perspective"),i.viewMatrix=t.getViewMatrix(),i.projectionMatrix=t.getProjectionMatrix(),i.verticalFieldOfView=t.getFieldOfView(),i.viewportHeight=t.getViewportHeight(),i.viewportWidth=t.getViewportWidth())}return i},t.prototype.closeSelectOtherView=function(){this.selectOtherView.close()},t.prototype.setActiveElement=function(e,t,i,r,n){if(!this.selectOtherView){var o={viewer:this};this.selectOtherView=new v.SelectOtherView(o)}if(this.selectOtherView.setActiveElement(r,n),e!==this.activeElementId){if(this.loadTimer=new l.Timer("Time from element switch to graphics display"),(0,L.isUsageCompare)()||this.destroyPreviewGraphics(),(0,L.isUsageBase)()&&!i&&(0,L.generateThumbnails)(this,70,40),this.activeElementId&&this.elementToPerElementState&&this.viewInitialized){var s=this.getCamera();if(s){var a=this.elementToPerElementState[this.activeElementId];a||(a=this.elementToPerElementState[this.activeElementId]=new z(this.activeElementId)),a.camera=s.clone(),a.renderingMode=this.renderingMode,a.smoothEdgeStyle=this.smoothEdgeStyle,a.activeFilteredEntitiesHighlightController=this.filteredEntitiesHighlightController,a.userEnabledAggressiveRefinement=this.bodyManager.getUserEnabledAggressiveRefinement(),a.activeFilteredEntitiesHighlightController&&a.activeFilteredEntitiesHighlightController.disable(),this.isForFlattenedDisplay||(a.sectionViewState=(0,L.saveAndClearState)())}}this.modelViewManagers.getManager().onChangeActiveElement(e,t),this.draw(),this.activeElementId=e||"";var c=p.btInjector.CapabilitiesService.checkSmoothEdgesRenderOptionsForAssembliesCurrentlyEnabled(),u=this.elementToPerElementState[this.activeElementId];if(u){var h=u.camera;this.viewController.isPerspective()!==h.isPerspective()&&(this.viewController.isPerspective()?this.viewController=new L.OrthographicController(this):this.viewController=new L.PerspectiveController(this)),h.setViewportFromCanvasElement(this.$el),this.getCamera().copyFrom(h),this.setZebraStripeEdgesOn(u.zebraStripeEdgesOn),this.setRenderingMode(u.renderingMode),(t===T.GBTElementType.PARTSTUDIO||t===T.GBTElementType.ASSEMBLY&&c)&&this.setSmoothEdgesRenderStyle(u.smoothEdgeStyle),this.setFilteredEntitiesHighlightController(u.activeFilteredEntitiesHighlightController),u.activeFilteredEntitiesHighlightController&&u.activeFilteredEntitiesHighlightController.enable(),this.isForFlattenedDisplay||(0,L.loadState)(u.sectionViewState),this.bodyManager.setUserEnabledAggressiveRefinement(u.userEnabledAggressiveRefinement),"number"==typeof u.zebraStripeCount&&this.setZebraStripeCount(u.zebraStripeCount),"number"==typeof u.zebraStripeRotation&&this.setZebraStripeRotation(u.zebraStripeRotation),this.viewInitialized=!0}else this.viewController&&this.resetViewState();this.setWaitingForDisplayData(),this.receivedComputedData=!1,this.receivedFeatureData=!1,this.receivedAssemblyDefinition=!1,this.averagePickDuration=-1,this.frameTimer.resetTimings(),this.detailManager.onSettingStateChange(),this.uiSelectionManager.reset(),this.bodyManager.resetOccurrenceRetrieval(),(0,L.resetStaticSilhouetteState)(),this.resetLastMouseLocation(),this.setReadyState(!1);var d=L.ActionIds.UNSUPPORTED;t===T.GBTElementType.PARTSTUDIO?d=L.ActionIds.PART_STUDIO:t===T.GBTElementType.ASSEMBLY?(d=L.ActionIds.ASSEMBLY,c||this.setSmoothEdgesRenderStyle(T.GBTSmoothEdgeStyle.VISIBLE)):this.hideWebGLContextLostMessage(),(0,L.getActiveViewerEventDispatcher)().trigger(L.SPACEMOUSE_ACTION_SET_CHANGED,d)}},t.prototype.resetViewState=function(){var e,t;this.initializedForDrawing&&(this.viewInitialized=!1,this.viewController.isPerspective()&&(this.viewController=this.viewController.getMatchingOrthographicController()),this.viewController.setStandardView(this.getDefaultStandardView()),this.setRenderingMode(T.GBTGraphicsRenderMode.SHADED_WITH_EDGES),this.setFilteredEntitiesHighlightController(null),this.setSmoothEdgesRenderStyle(T.GBTSmoothEdgeStyle.VISIBLE),this.filteredEntitiesHighlightController&&this.filteredEntitiesHighlightController.disable(),this.bodyManager.setUserEnabledAggressiveRefinement(!1),this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle=!1,null===(e=this.mainDrawPass)||void 0===e||e.setZebraStripeCount(W.getNumber("ZEBRA_STRIPE_COUNT")),null===(t=this.mainDrawPass)||void 0===t||t.setZebraStripeRotation(W.getNumber("ZEBRA_STRIPE_ROTATION")))},t.prototype.updateCanvasVisibility=function(){this.readyState&&!this.hidden?(this.$el.show(),this.viewManipulator&&this.viewManipulator.show()):(this.$el.hide(),this.viewManipulator&&this.viewManipulator.hide())},t.prototype.setReadyState=function(e){this.readyState=e,e?this.storedCameraState&&(this.updateCamera(this.storedCameraState),this.storedCameraState=null):this===(0,L.getFocusedViewer)()&&(0,L.setFocusedViewer)(null),this.updateCanvasVisibility()},t.prototype.isHidden=function(){return this.hidden},t.prototype.hide=function(){this.hidden=!0,this.updateCanvasVisibility()},t.prototype.show=function(){this.hidden=!1,this.gl||this.setupGlContext(),this.updateCanvasVisibility(),this.modelViewManagers.getManager().onViewerShown()},t.prototype.setSelectionCountCursor=function(e){this.selectionCursor=e,0===this.cursorStack.length&&this.$el.css({cursor:e})},t.prototype.pushCursor=function(e){this.$el.css({cursor:e}),this.cursorStack.push(e)},t.prototype.peekCursor=function(){return this.cursorStack&&this.cursorStack.length>0?this.cursorStack[this.cursorStack.length-1]:null},t.prototype.popCursor=function(){0!==this.cursorStack.length?(this.cursorStack.pop(),this.cursorStack.length>0?this.$el.css({cursor:this.cursorStack[this.cursorStack.length-1]}):this.$el.css({cursor:this.selectionCursor})):f.log.warn("Tried to pop a cursor off an empty stack in the graphics viewer")},t.prototype.removeTopOccurrenceOfCursor=function(e,t){if(0!==this.cursorStack.length||t){var i=(0,_.findLastIndex)(this.cursorStack,(function(t){return t===e}));i<0?t||f.log.warn("Tried to remove a cursor not present on stack in graphics viewer"):i===this.cursorStack.length-1?this.popCursor():this.cursorStack.splice(i,1)}else f.log.warn("Tried to remove a cursor from an empty stack in the graphics viewer")},t.prototype.onBeforePrint=function(){var e=this.getCamera().getViewport();this.printCanvas||(this.printToCanvas(e[2],e[3],e[2],e[3]),r(this.printCanvas).css({width:"100%"}));var t=r("body");t.addClass("printing"),t.append(this.printCanvas)},t.prototype.onAfterPrint=function(){r(this.printCanvas).remove(),this.printCanvas=null,r("body").removeClass("printing")},t.prototype.printToCanvas=function(e,t,i,r,n){this.viewManipulator&&this.viewManipulator.hide();var o=this.getCamera(),s=o.clone(),a=null;n&&(a={previousOverride:(0,O.getDevicePixelRatioOverride)()},(0,O.setDevicePixelRatioOverride)(n));var c=o.getViewportWidth(),l=o.getViewportHeight(),u=e/i,h=i*u,d=r*u,p=c*u,g=l*u,f=(c-i)/2*u,m=(l-r)/2*u;s.setViewport([0,0,p,g]);var y=h,v=d,E=1024,I=1024,T=1042,S=1042,P=this.el.width,_=this.el.height;this.el.width=Math.max(T,P),this.el.height=Math.max(S,_),s.setCanvasDimensions(this.el.width,this.el.height);var M=Math.ceil(y/E),D=Math.ceil(v/I);this.printCanvas=document.createElement("canvas"),this.printCanvas.id="print-canvas",this.printCanvas.width=y,this.printCanvas.height=v;var C=this.printCanvas.getContext("2d"),A=new Uint8Array(4343056),R=C.createImageData(E,I),N=this.getGlContext(),w=[0,0,T,S];this.frameTimer.resetInteractionStatus();for(var b=0;b<D;++b)for(var L=0;L<M;++L){w[0]=f+L*E-9,w[1]=m+b*I-9,s.setTileViewport(w);this.draw(null,{forPrint:!0,camera:s}),N.readPixels(0,0,T,S,N.RGBA,N.UNSIGNED_BYTE,A);for(var F=0;F<I;++F)for(var B=0;B<E;++B){var x=4*((I-F-1)*E+B),U=4*((F+9)*T+B+9),G=1/(A[U+3]/255);R.data[x]=A[U]*G,R.data[x+1]=A[U+1]*G,R.data[x+2]=A[U+2]*G,R.data[x+3]=A[U+3]}C.putImageData(R,L*E,b*I)}this.el.width=P,this.el.height=_,this.viewManipulator&&this.viewManipulator.show(),a&&(a.previousOverride?(0,O.setDevicePixelRatioOverride)(a.previousOverride):(0,O.clearDevicePixelRatioOverride)()),this.draw()},t.prototype.createPrintView=function(e,t,i,n,o,s,a){var c=this,l=11800,u=null;a&&(u=a*l/W.getNumber("DEFAULT_LINE_WIDTH"));this.printToCanvas(e*l,t*l,n,o,u),r(this.printCanvas).css({width:100*e+"cm",height:100*t+"cm"}),s?this.printCanvas.toBlob((function(e){(0,D.saveBlob)(e,i+".png"),c.onAfterPrint()})):window.print()},t.prototype.getEntityCanvasLocation=function(e){var t=this.modelViewManagers.getManager().extractMeshIncrement(e);if(t&&t.points&&t.points.length>=3){var i=[t.points[0],t.points[1],t.points[2]];return this.getCamera().projectWorldPointToCanvas(i)}return null},t.prototype.triggerContextLoss=function(e){var t=this.getExtension("WEBGL_lose_context");t?(t.loseContext(),setTimeout((function(){t.restoreContext()}),e||500)):alert("This system does not support the context loss extension")},t.prototype.toggleDebugDrawPickPass=function(){var e=this.mainDrawPass.getDebugDrawPickPass();e.setEnabled(!e.getEnabled())},t.prototype.isMouseInsideViewManipulator=function(){return!!this.viewManipulator&&this.viewManipulator.isMouseInside()},t.prototype.setCanEdit=function(e){this.canEdit=e},t.prototype.getCanEdit=function(){return this.canEdit},t.prototype.completeTasks=function(){this.taskManager.complete(),this.draw()},t.prototype.getSelectionFitBounds=function(e){if(!e)return null;var t=this.getModelViewManagers().getManagerForUsage(e.getUsage());if(!t)return null;var i=t.getSelectionFitBounds(e);if(this.getIsForFlattenedDisplay()&&i){var r=t.getDisplayedElement();if(r instanceof L.PartStudio){var n=r.getBodyTransform(e.getBodyId(),this);if(n)return i.createTransformedCopy(n)}}return i},t.prototype.retrieveViewportAsImage=function(e){var t=this,i=e.width,r=e.height,n=this.getCamera().clone();this.getCamera().setViewport([0,0,i,r]),this.getCamera().setCanvasDimensions(i,r);var o=this.getFitBounds();e.zoomToSelection&&(o=new L.BoundingBox,(0,I.getSelectionList)().each((function(e){o.addBox(t.getSelectionFitBounds(e))})),o.isFinite()&&o.isExtensive()||f.log.warn("zoomToSelection was requested in retrieveZoomedFitViewport but a valid bounds was not found")),(0,L.setForcePredictableHatching)(!0),void 0===e.zoomToFit&&(e.zoomToFit=!0),e.zoomToFit&&this.getPrimaryViewController().zoomFitWithoutPanels(o),!e.showViewCube&&this.viewManipulator&&this.viewManipulator.hide(),e.useInteractiveSettings?this.frameTimer.setUserIsAdjustingCamera():this.frameTimer.resetInteractionStatus(),this.mainDrawPass.setClearColor(1,1,1,1),this.draw();var s=new Uint8Array(i*r*4),a=this.getGlContext();return a&&a.readPixels(0,0,i,r,a.RGBA,a.UNSIGNED_BYTE,s),(0,L.flipImageVertically)(s,i,r),this.getCamera().copyFrom(n),this.mainDrawPass.setClearColor(0,0,0,0),!e.showViewCube&&this.viewManipulator&&this.viewManipulator.show(),(0,L.setForcePredictableHatching)(!1),{width:i,height:r,data:s}},t.prototype.retrievePrintedCanvasPixels=function(e){var t=this.createPrintOfCanvas(e.width,e.height,H,V,!0),i=this.printCanvas.getContext("2d").getImageData(0,0,H,V);return this.removePrintOfCanvas(t),{width:H,height:V,data:i.data}},t.prototype.printToCanvasRenderingContext=function(e,t,i,r,n){var o=(0,O.getDevicePixelRatio)(),s=o*i,a=o*r;this.getEventDispatcher().trigger(L.BEFORE_MARKUP_IMAGE_GENERATION);var c=this.createPrintOfCanvas(s,a,s,a);this.getEventDispatcher().trigger(L.AFTER_MARKUP_IMAGE_GENERATION),n.drawImage(this.printCanvas,e,t,i,r),this.removePrintOfCanvas(c)},t.prototype.createPrintOfCanvas=function(e,t,i,r,n){var o=this.getCamera().clone();return this.getCamera().setViewport([0,0,e,t]),n&&this.getPrimaryViewController().zoomFitWithoutPanels(this.getFitBounds()),this.printToCanvas(i,r,e,t),o},t.prototype.removePrintOfCanvas=function(e){r(this.printCanvas).remove(),this.getCamera().copyFrom(e)},t.prototype.getViewData=function(e,t){var i=new T.BTViewData,r=this.getCamera(),n=r.getFrame();if(e){var o=this.modelViewManagers.getManager().getOccurrenceTransform(e);if(o){var s=d.mat4.inverse(o,d.mat4.create());n=d.mat4.multiply(s,n,d.mat4.create())}}i.viewMatrix=n,i.isPerspective=r.isPerspective();var a=r;a.top&&a.bottom&&a.right&&a.left?i.cameraViewport=[a.top,a.bottom,a.right,a.left]:i.cameraViewport=[0,0,0,0];var c=r;c.angle?i.angle=c.angle:i.angle=0;var l=function(e){var t=new T.BTVector3d;return t.x=e[0],t.y=e[1],t.z=e[2],t},u=[];return(0,L.getCurrentSectionPlaneParameters)().forEach((function(e){var t=new T.BTSectionPlaneParameters;t.center=l(e.center),t.tangent=l(e.tangent),t.normal=l(e.normal),u.push(t)})),i.sectionPlaneParameters=u,t||(i.sectionViewData=(0,x.getSerializableSectionViewData)()),i},t.prototype.getViewDataWithPersistentSectionedItemQueries=function(e){var t=this;return(0,x.getSerializableSectionViewDataWithPersistentQueries)().then((function(e){var i=t.getViewData(null,!0);return i.sectionViewData=e,i}))},t.prototype.animateToView=function(e,t){var i=this.getCameraForViewData(e,t);this.prepareViewControllerForNewCamera(e.isPerspective);var r=s.default.getManager();this.getPrimaryViewController().animateToCustomView(i,r.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),e.name)},t.prototype.prepareViewControllerForNewCamera=function(e){var t=this.getPrimaryViewController();e?t.isOrthographic()&&this.setPrimaryViewController(t.getMatchingPerspectiveController()):t.isPerspective()&&this.setPrimaryViewController(t.getMatchingOrthographicController())},t.prototype.getCameraForViewData=function(e,t){var i=this.getCamera();i.setSceneBounds(this.getSceneBounds());var r,n=e.viewMatrix,o=e.cameraViewport,s=e.angle;if(t){var a=T.BTOccurrence.getOccurrenceFromPathString(t),c=this.modelViewManagers.getManager().getOccurrenceTransform(a);c&&(n=d.mat4.multiply(c,n,d.mat4.create()))}return e.isPerspective?(r=i.getPerspectiveCamera()).angle=s:((r=i.getOrthographicCamera()).top=o[0],r.bottom=o[1],r.right=o[2],r.left=o[3],r.correctAspectRatio()),r.setFrame(n),r},t.prototype.animateIsolation=function(e,t){var i=s.default.getManager().getNumber("ISOLATE_CONTEXT_TRANSITION_TIME_MS"),r=(0,L.getTimeInMilliseconds)();this.animationController.startAnimation((function(n){var o=(0,L.getTimeElapsed)(r),s=Math.min((0,L.smoothstep)(0,1,o/i),1),a=F.AnimationCallbackStatus.ONGOING;return s>=1&&(a=F.AnimationCallbackStatus.COMPLETE,t&&t()),(0,L.setTransparencyTransition)(e?s:1-s),a}))},t.prototype.onIsolateRemoved=function(){for(var e in this.uiElements)this.uiElements[e].onIsolateRemoved()},t.prototype.setUserIsManipulatingWithTimeout=function(){this.frameTimer.setUserIsManipulatingWithTimeout()},t.prototype.setUserIsAdjustingCamera=function(){this.bodyManager.onUserIsAdjustingCamera(),this.frameTimer.setUserIsAdjustingCamera()},t.prototype.setSystemIsAnimating=function(){this.frameTimer.setSystemIsAnimating()},t.prototype.executePerformanceTests=function(){return this.elementLoadState=j.LOADED_ALL_DATA,(0,L.setRetinaDisplayMode)(L.RetinaDisplayMode.OFF),this.initializeForDrawing(),this.onResize(),this.viewInitialized=!0,(0,L.executePerformanceTests)(this)},t.prototype.getInteractiveFrameDetails=function(){return this.frameTimer.getTimingDetails(F.FrameType.INTERACTIVE)},t.prototype.getPingStats=function(){if(!this.isReadyForDrawing()||!this.isBrowserTabVisible||this.taskManager.hasPendingWork())return null;var e=this.getInteractiveFrameDetails(),t=this.getCamera();return e&&e.hasTimings()&&t?{framerate:e.getAverageFramerate(),triangleCount:this.modelViewManagers.getManager().getInstantiatedTriangleCount(),pixelCount:t.getViewportWidth()*t.getViewportHeight()}:null},t.prototype.areSectionPlanesEnabled=function(){return!this.isForFlattenedDisplay},t.prototype.onDisplayDataUsageChange=function(){this.detailManager.onSettingStateChange()},t.prototype.onDefaultUnitsChanged=function(e){for(var t in this.uiElements)this.uiElements[t].onDefaultUnitsChanged(e)},t.prototype.setDraftAnalysisPullDirection=function(e){this.mainDrawPass.setDraftAnalysisPullDirection(e),this.requestDraw()},t.prototype.setDraftAnalysisMinimumAngle=function(e){this.mainDrawPass.setDraftAnalysisMinimumAngle(e),this.requestDraw()},t.prototype.setDraftAnalysisParts=function(e){this.mainDrawPass.setDraftAnalysisParts(e),this.requestDraw()},t.prototype.setDraftAnalysisShowUndercut=function(e){this.mainDrawPass.setDraftAnalysisShowUndercut(e),this.requestDraw()},t.prototype.clearDraftAnalysis=function(){this.setDraftAnalysisPullDirection(null),this.setDraftAnalysisMinimumAngle(T.BTDraftAnalysis.DEFAULT_MINIMUM_ANGLE_RADIANS),this.setDraftAnalysisParts([])},t.prototype.getRenderingModeOfElement=function(e){var t=this.elementToPerElementState[e];return t?t.renderingMode:null},t.prototype.updateElementPreviewNodeVisibility=function(e){var t=this.getModelViewManagers().getManager().getElementRootNode().getParent();if(t)for(var i=0;i<t.getChildCount();++i)t.getChildByIndex(i).setVisible(!e);var r=this.getModelViewManagers().getManager().getElementPreviewRootNode();r&&r.setVisible(e)},t.prototype.onElementPreviewDisplayData=function(e){f.log.trace("Invoking onElementPreviewDisplayData for element "+e.elementId),this.activeElementId===e.elementId&&this.elementLoadState!==j.LOADED_ALL_DATA?(this.activeElementPreviewManager=new L.ElementPreviewManager(this),this.activeElementPreviewManager.processGLDisplayDataResponse(e),this.hasElementPreviewLoaded=!0,this.setReadyState(!0),this.updateElementPreviewNodeVisibility(!0),this.requestDraw(),this.getEventDispatcher().trigger(L.ELEMENT_PREVIEW_GRAPHICS_LOADED,this.activeElementId),f.log.trace("Drawing Preview for element "+e.elementId)):f.log.trace("Skipping processing previewDisplayData because display data has been loaded "+e.elementId)},t.prototype.clearElementPreview=function(){this.updateElementPreviewNodeVisibility(!1),this.activeElementPreviewManager&&(f.log.trace("Removing elementPreviewManager for elementId "+this.activeElementId),this.activeElementPreviewManager.destroy(),this.activeElementPreviewManager=null,this.requestDraw()),this.hasElementPreviewLoaded=!1},t.prototype.getCameraData=function(e){var t={camera:null,cameraExtents:null},i=d.mat4.inverse(e,d.mat4.create());return i||(i=d.mat4.identity()),t.camera=this.getCamera().clone(),t.camera.setFrame(d.mat4.multiply(i,t.camera.getFrame())),this.getCamera().isOrthographic()&&(t.cameraExtents=this.getCamera().getExtents()),t},t.prototype.updateCamera=function(e){var t=e.camera;t&&e.honorPerspective&&this.prepareViewControllerForNewCamera(t.isPerspective());var i=this.getCamera();i.isOrthographic()&&e.cameraExtents&&i.setExtents(e.cameraExtents),t&&(e.honorPerspective?i.copyFrom(t):i.copyFrom(t.getOrthographicCamera())),i.setViewportFromCanvasElement(this.$el),this.setViewInitialized(!0)},t.prototype.storeCameraState=function(e){this.storedCameraState=e},t.prototype.setInterferenceCallId=function(e){this.interferenceCallId=e},t.prototype.getInterferenceCallId=function(){return this.interferenceCallId},t.prototype.createDistanceDisplay=function(e,t){return new L.DistanceDisplay(e,t,this)},t.prototype.createAngleDisplay=function(e,t,i,r,n,o){return new L.AngleDisplay(e,t,i,r,n,o,this)},t.prototype.createAngularDimension=function(e,t){return new L.AngularDimension(this,e,t)},t.prototype.createCurveLengthDimension=function(e,t){return new L.CurveLengthDimension(this,e,t)},t.prototype.createLinearDimension=function(e,t){return new L.LinearDimension(this,e,t)},t.prototype.createEllipseDiameterDimension=function(e,t){return new L.EllipseDiameterDimension(this,e,t)},t.prototype.createRadialDimension=function(e,t){return new L.RadialDimension(this,e,t)},t.prototype.createArcLengthDimension=function(e,t){return new L.ArcLengthDimension(this,e,t)},t.prototype.createCenterlineDimension=function(e,t){return new L.CenterlineDimension(this,e,t)},t.prototype.createCountDimension=function(e,t){return new L.CountDimension(this,e,t)},t.prototype.createAngularWithArrowManipulator=function(){return new L.AngularWithArrow(this)},t.prototype.createLinearManipulator=function(e){return new L.Linear(this,e)},t.prototype.createPlanarManipulator=function(e){return new L.Planar(this,e)},t.prototype.createTriadManipulator=function(e,t){return new L.Triad(this,e,t)},t.prototype.createFeatureManipulator=function(e){return(0,L.createManipulator)(e,this)},t.prototype.createLinearToolPreview=function(e,t,i,r){return(0,L.createLinearToolPreview)(e,t,i,r,this)},t.prototype.createAngularToolPreview=function(e,t,i,r,n){return(0,L.createAngularToolPreview)(e,t,i,r,n,this)},t.prototype.createAxes=function(e){return new L.Axes(this,e)},t.prototype.createEmptyBoundingBox=function(){return new L.BoundingBox},t.prototype.createOrthographicCamera=function(){return new L.OrthographicCamera},t.prototype.createPerspectiveCamera=function(){return new L.PerspectiveCamera},t.prototype.createCommentIndicator=function(e,t){return new L.CommentIndicator(e,t,this)},t.prototype.createCenterOfMassIndicator=function(e){return new L.CenterOfMassIndicator(e,this)},t.prototype.createFeatureDisplay=function(e){return new L.Display(e,this)},t.prototype.createEdgeCurvatureDisplay=function(e,t,i,r,n,o){return new L.EdgeCurvatureDisplay(e,t,i,r,n,this,o)},t.prototype.createFixedMateIndicator=function(e,t){return new L.FixedMateIndicator(e,t,this)},t.prototype.createImageDisplay=function(e,t,i,r,n,o,s,a,c,l){return new L.ImageDisplay(e,t,i,r,n,o,s,this,a,c,l)},t.prototype.createInferenceDisplay=function(e,t){return new L.InferenceDisplay(e,this,t)},t.prototype.createInferencePicker=function(e,t,i){return new L.InferencePicker(this,e,t,i)},t.prototype.createInterferenceDisplay=function(e,t,i,r,n,o,s){return new L.InterferenceDisplay(e,this,t,i,r,n,o,s)},t.prototype.createFilteredEntitiesHighlightController=function(e){return new L.FilteredEntitiesHighlightController(this,e)},t.prototype.createMateConnectorManager=function(){return this.activeMateConnectorManager=new L.Manager,this.activeMateConnectorManager},t.prototype.destroyMateConnectorManager=function(){this.activeMateConnectorManager&&(this.activeMateConnectorManager.destroy(),this.activeMateConnectorManager=null)},t.prototype.getMateConnectorManager=function(){return this.activeMateConnectorManager},t.prototype.setMateConnectorInteractionEnabled=function(e){L.MateConnector.setInteractionEnabled(e)},t.prototype.createMeshIncrement=function(e,t,i,r,n){return new L.MeshIncrement(e,t,i,r,n)},t.prototype.createSnapIndicator=function(){return new L.SnapIndicator(this)},t.prototype.createPointElement=function(e,t,i,r,n){return new L.PointElement(e,t,i,r,this,n)},t.prototype.createSilhouette=function(e){return new L.Silhouette(e,this)},t.prototype.getUserEnabledAggressiveRefinement=function(){return this.bodyManager.getUserEnabledAggressiveRefinement()},t.prototype.setUserEnabledAggressiveRefinement=function(e){this.bodyManager.setUserEnabledAggressiveRefinement(e)},t.prototype.getOrCreateActiveElementViewerState=function(){var e=this.elementToPerElementState[this.activeElementId];return void 0===e&&(e=this.elementToPerElementState[this.activeElementId]=new z(this.activeElementId)),e},t.prototype.getActiveElementViewerState=function(){return this.elementToPerElementState[this.activeElementId]},t.prototype.setZebraStripeCount=function(e){var t;this.getOrCreateActiveElementViewerState().zebraStripeCount=e,null===(t=this.mainDrawPass)||void 0===t||t.setZebraStripeCount(e)},t.prototype.setZebraStripeRotation=function(e){var t;this.getOrCreateActiveElementViewerState().zebraStripeRotation=e,null===(t=this.mainDrawPass)||void 0===t||t.setZebraStripeRotation(e)},t.prototype.getZebraStripeCount=function(){var e,t;return null!==(t=null===(e=this.getActiveElementViewerState())||void 0===e?void 0:e.zebraStripeCount)&&void 0!==t?t:W.getNumber("ZEBRA_STRIPE_COUNT")},t.prototype.getZebraStripeRotation=function(){var e,t;return null!==(t=null===(e=this.getActiveElementViewerState())||void 0===e?void 0:e.zebraStripeRotation)&&void 0!==t?t:W.getNumber("ZEBRA_STRIPE_ROTATION")},t.prototype.getZebraStripeEdgesOn=function(){var e,t;return null===(t=null===(e=this.getActiveElementViewerState())||void 0===e?void 0:e.zebraStripeEdgesOn)||void 0===t||t},t.prototype.setZebraStripeEdgesOn=function(e){this.getOrCreateActiveElementViewerState().zebraStripeEdgesOn=e,this.renderingMode===T.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION&&this.setRenderingMode(this.renderingMode),this.requestDraw()},t.prototype.getRenderModeObservable=function(){return this.renderModeSubject.asObservable()},t.prototype.logHighlightIssue=function(){var e={};this.occurrenceDataManager.forEach((function(t,i){var r=i.getHighlightDebugInfo();r&&(e[t]=r)}));var t={selectionListLength:(0,I.getSelectionList)().length,preselectionListLength:(0,I.getPreselectionList)().length,secondaryPreSelectionList:(0,I.getSecondaryPreSelectionList)().toString(),secondaryPreSelectionListDebugInfo:(0,I.getSecondaryPreSelectionList)().debugInfo,hasHoveredUiSelection:!!this.uiSelectionManager.getHoveredSelection(),hasUiSelection:!!this.uiSelectionManager.getSelection(),highlightManagerDebugInfo:this.highlightManager.getHighlightDebugInfo(),occurrenceHighlightInfo:e};f.log.warn("Highlight issue logged.  Details:\n\n"+JSON.stringify(t,null,2))},t.prototype.onBrowserTabVisibilityChanged=function(){switch(document.visibilityState){case"hidden":this.isBrowserTabVisible=!1;break;case"visible":this.isBrowserTabVisible=!0,this.frameTimer.resetTimings()}},t}(o.View);t.Viewer=Q,t.createTestViewer=function(e){return new Q({el:e,disableAutomaticDrawing:!0,disableInput:!0,disableViewManipulator:!0})}},388131:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.retrieveViewportAsImage=t.getViewerForDebugOrTestPurposes=t.getActiveViewerCanvasCoordinateFromEvent=t.afterPrint=t.beforePrint=t.getActiveViewerSceneGraphs=t.getActiveViewerModelViewManagers=t.getActiveViewerOccurrenceDataManager=t.getActiveViewerSketch=t.getActiveViewer=t.setForceHideInteriorSelections=void 0;var r=i(817395),n=i(311611);function o(){return(0,r.getActiveViewer)()}t.setForceHideInteriorSelections=function(e){var t=o();t&&t.setForceHideInteriorSelections(e)},t.getActiveViewer=o,t.getActiveViewerSketch=function(){var e=o();return e?e.getSketch():null},t.getActiveViewerOccurrenceDataManager=function(){return o().getOccurrenceDataManager()},t.getActiveViewerModelViewManagers=function(){var e=o();return e?e.getModelViewManagers():null},t.getActiveViewerSceneGraphs=function(){return o().getSceneGraphs()};t.beforePrint=function(){o()&&o().onBeforePrint()};function s(e){var t=(0,n.getCurrentActiveViewerSet)();return t?e?t.sheetMetalViewer:o():null}t.afterPrint=function(){o()&&o().onAfterPrint()},t.getActiveViewerCanvasCoordinateFromEvent=function(e){var t=o();return t?t.getCanvasCoordinateFromEvent(e):[e.pageX,e.pageY]},t.getViewerForDebugOrTestPurposes=s,t.retrieveViewportAsImage=function(e){if(!(0,n.getCurrentActiveViewerSet)())return null;var t=s(e.useFlattenedView);return t?e.usePrint?t.retrievePrintedCanvasPixels(e):t.retrieveViewportAsImage(e):null}},332254:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sketchinformation=t.Resources=t.NodePropertiesTypes=void 0;var r,n=i(423902),o=i(736202),s=i(311611),a=i(663748);!function(e){e[e.OVERDEFINED=1]="OVERDEFINED",e[e.EXTERNAL_AND_OK=2]="EXTERNAL_AND_OK",e[e.OK=3]="OK",e[e.DRIVEN=4]="DRIVEN"}(r=t.NodePropertiesTypes||(t.NodePropertiesTypes={}));var c=function(e){for(var t=this.viewer.getReferenceHighlights(),i=new Uint8Array(4*t.sortedHighlights.length),r=0;r<t.sortedHighlights.length;r++)for(var n=(0,s.convertRGBAToRGBA255)(t.sortedHighlights[r].color1),o=0;o<4;o++)i[4*r+o]=n[o];var a=new s.TextureDefinition(e);return a.bytes=i,a.width=i.length/4,a.height=1,a},l=function(e){function t(t){var i=e.call(this)||this;return i.viewer=t,i.blitQuad=null,i.highlightColorTexture=null,i.blankTexture=null,i.primitiveRestartBuffer=null,i.constraintAtlas=null,i.typeToNodeProperties={},i.constraintAtlasCreationInitiated=!1,i.commentIndicatorAtlas=null,i.commentIndicatorAtlasCreationInitiated=!1,i.sketchFaceMaterial=null,i.centerOfMassIndicatorNodeProperties=null,i.simulationGradientTextures=new Map,i.simulationGradientMaterials=[],(0,s.viewerCheck)(t),i.constraintMaterial=(0,s.createTextureMaterial)(),(0,o.each)(r,function(e){this.typeToNodeProperties[e]=new s.NodeProperties({isPickable:!0,primitiveType:s.PrimitiveType.TRIANGLES,material:this.constraintMaterial,isVisible:!0,zOffset:e})}.bind(i)),i.inferenceNodeProperties=new s.NodeProperties({isPickable:!1,primitiveType:s.PrimitiveType.TRIANGLES,material:i.constraintMaterial,isVisible:!0,zOffset:0}),i.listenTo(i.viewer.getEventDispatcher(),s.GL_CONTEXT_RESTORED,i.onGlContextRestored),i.commentIndicatorMaterial=(0,s.createTextureMaterial)(),i.commentIndicatorNodeProperties=new s.NodeProperties({primitiveType:s.PrimitiveType.TRIANGLES,material:i.commentIndicatorMaterial}),i}return(0,n.__extends)(t,e),t.prototype.onGlContextRestored=function(){this.constraintAtlas&&(this.constraintMaterial.ambientTexture=this.constraintAtlas.texture)},t.prototype.reset=function(){this.blitQuad&&(this.blitQuad.remove(),this.blitQuad=null),this.blankTexture&&(this.blankTexture.destroy(),this.blankTexture=null),this.invalidateHighlightTexture(),this.constraintMaterial.destroy(),this.mateIndicatorGlyphResources&&this.mateIndicatorGlyphResources.destroy(),this.loadGlyphResources&&this.loadGlyphResources.destroy(),this.commentIndicatorMaterial.destroy(),this.stopListening(),this.primitiveRestartBuffer&&(this.primitiveRestartBuffer.destroy(),this.primitiveRestartBuffer=null)},t.prototype.getBlitNode=function(){if(!this.blitQuad){var e=new s.NodeProperties({primitiveType:s.PrimitiveType.TRIANGLES,isPickable:!0,isTwoSided:!0,material:null});this.blitQuad=new s.Quad([-1,-1,0],[1,-1,0],[-1,1,0],e,this.viewer,"blit"),this.blitQuad.getOccurrenceData().setShouldSetOccurrenceUniform(!1)}return this.blitQuad.getNode()},t.prototype.getHighlightTexture=function(){return this.highlightColorTexture||(this.highlightColorTexture=new s.Texture(this.viewer,c)),this.highlightColorTexture},t.prototype.invalidateHighlightTexture=function(){this.highlightColorTexture&&(this.highlightColorTexture.destroy(),this.highlightColorTexture=null)},t.prototype.getBlankTexture=function(){if(!this.blankTexture){var e=this.viewer.getGlContext(),t=new s.TextureDefinition(e);t.width=2,t.height=2,t.bytes=new Uint8Array(t.width*t.height*4),this.blankTexture=new s.Texture(this.viewer,t)}return this.blankTexture},t}(a.BackboneEventsBaseClass);t.Resources=l,t.sketchinformation={nodePropertiesTypes:r},t.sketchinformation.nodePropertiesTypes=r},237752:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.removeGraphicsViewers=t.preserveViewersForDocumentId=t.getOrCreateViewerSet=t.getCurrentActiveViewerSet=void 0;var n=i(769754),o=i(227441),s=i(311611),a=i(963551),c=null,l="#canvas";t.getCurrentActiveViewerSet=function(){return c},t.getOrCreateViewerSet=function(e){if(e=e||{},c)null,r(l).replaceWith(c.mainViewer.$el),c.mainViewer.onViewerReactivated(),c.sheetMetalViewer&&c.sheetMetalViewer.onViewerReactivated();else{var t={mainViewer:new s.Viewer({el:l,contextMenuMgr:e.contextMenuMgr})};if(t.mainViewer.getWebGlSupport()!==a.CoreWebGlSupport.SUPPORTED)return t;if(e.createSheetMetalViewer){t.partStudioToAlternateMapping=new n.PartStudioAlternateEntityMapping;var i=r("<canvas/>",{id:"sheetmetalcanvas","data-view-shown":"unknown"});t.sheetMetalViewer=new s.Viewer({el:i,dontSetActive:!0,isForFlattenedDisplay:!0,hidden:!0,contextMenuMgr:e.contextMenuMgr})}c=t}return c},t.preserveViewersForDocumentId=function(e){e},t.removeGraphicsViewers=function(){c&&(c.mainViewer.setActiveElement(null,o.GBTElementType.UNKNOWN,!0,null,null),c.mainViewer.setUnitsReceived(!1),c.mainViewer.$el.detach(),c.sheetMetalViewer&&(c.sheetMetalViewer.setActiveElement(null,o.GBTElementType.UNKNOWN,!0,null,null),c.sheetMetalViewer.setUnitsReceived(!1),c.sheetMetalViewer.$el.detach()))}},34824:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewFrustum=t.ClippingPlaneNames=void 0;var r,n=i(911748),o=i(874197);!function(e){e.RIGHT="Right",e.LEFT="Left",e.TOP="Top",e.BOTTOM="Bottom",e.NEAR="Near",e.FAR="Far"}(r=t.ClippingPlaneNames||(t.ClippingPlaneNames={}));var s=function(e,t,i,r){var n=Math.sqrt(e*e+t*t+i*i);this.normal=[e/n,t/n,i/n],this.d=r/n},a=function(){function e(e,t){this.clippingPlanes={},this.clippingMatrix=n.mat4.create(),e&&t&&this.updateClippingPlanes(e,t)}return e.prototype.updateClippingPlanes=function(e,t){e&&t&&(this.clippingMatrix[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],this.clippingMatrix[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],this.clippingMatrix[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],this.clippingMatrix[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],this.clippingMatrix[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],this.clippingMatrix[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],this.clippingMatrix[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],this.clippingMatrix[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],this.clippingMatrix[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],this.clippingMatrix[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],this.clippingMatrix[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],this.clippingMatrix[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],this.clippingMatrix[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],this.clippingMatrix[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],this.clippingMatrix[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],this.clippingMatrix[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],this.updateClippingPlane(r.BOTTOM,this.clippingMatrix[3]+this.clippingMatrix[1],this.clippingMatrix[7]+this.clippingMatrix[5],this.clippingMatrix[11]+this.clippingMatrix[9],this.clippingMatrix[15]+this.clippingMatrix[13]),this.updateClippingPlane(r.TOP,this.clippingMatrix[3]-this.clippingMatrix[1],this.clippingMatrix[7]-this.clippingMatrix[5],this.clippingMatrix[11]-this.clippingMatrix[9],this.clippingMatrix[15]-this.clippingMatrix[13]),this.updateClippingPlane(r.LEFT,this.clippingMatrix[3]+this.clippingMatrix[0],this.clippingMatrix[7]+this.clippingMatrix[4],this.clippingMatrix[11]+this.clippingMatrix[8],this.clippingMatrix[15]+this.clippingMatrix[12]),this.updateClippingPlane(r.RIGHT,this.clippingMatrix[3]-this.clippingMatrix[0],this.clippingMatrix[7]-this.clippingMatrix[4],this.clippingMatrix[11]-this.clippingMatrix[8],this.clippingMatrix[15]-this.clippingMatrix[12]))},e.prototype.updateClippingPlane=function(e,t,i,r,n){if(this.clippingPlanes[e]){var o=Math.sqrt(t*t+i*i+r*r),a=[t/o,i/o,r/o],c=n/o;this.clippingPlanes[e].normal=a,this.clippingPlanes[e].d=c}else this.clippingPlanes[e]=new s(t,i,r,n)},e.prototype.getSphereFrustumIntersection=function(e,t){var i=this.clippingPlanes[r.BOTTOM],n=i.normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d;return n<-t||(n=(i=this.clippingPlanes[r.TOP]).normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d)<-t||(n=(i=this.clippingPlanes[r.RIGHT]).normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d)<-t||(n=(i=this.clippingPlanes[r.LEFT]).normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d)<-t?o.IntersectionType.OUTSIDE:o.IntersectionType.INSIDE},e}();t.ViewFrustum=a},550470:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.ViewManipulator=t.DropdownButton=t.ViewManipulatorButtons=t.MANIPULATOR_BUTTONS_ID=t.MANIPULATOR_ID=t.isTrimetricCorner=t.SelectionIds=t.VIEW_MANIPULATOR_EVENT=void 0;var n,o=i(423902),s=i(514194),a=i(311611),c=i(73055),l=i(194598),u=i(264822),h=i(813364),d=i(174114),p=i(911748),g=i(699716),f=i(578004),m=c.default.getManager();function y(e){return 0===e.indexOf("Trimetric")}t.VIEW_MANIPULATOR_EVENT="viewManipulatorEvent",function(e){e.TOP="Top",e.BOTTOM="Bottom",e.FRONT="Front",e.BACK="Back",e.RIGHT="Right",e.LEFT="Left",e.TRIMETRIC_TOP_RIGHT_FRONT="Trimetric",e.TRIMETRIC_TOP_LEFT_FRONT="TrimetricTopLeftFront",e.TRIMETRIC_TOP_RIGHT_BACK="TrimetricTopRightBack",e.TRIMETRIC_TOP_LEFT_BACK="TrimetricTopLeftBack",e.TRIMETRIC_BOTTOM_RIGHT_FRONT="TrimetricBottomRightFront",e.TRIMETRIC_BOTTOM_LEFT_FRONT="TrimetricBottomLeftFront",e.TRIMETRIC_BOTTOM_RIGHT_BACK="TrimetricBottomRightBack",e.TRIMETRIC_BOTTOM_LEFT_BACK="TrimetricBottomLeftBack",e.LEFT_ARROW="LeftArrow",e.RIGHT_ARROW="RightArrow",e.UP_ARROW="UpArrow",e.DOWN_ARROW="DownArrow",e.CW_ARROW="CwArrow",e.CCW_ARROW="CcwArrow",e.VIEW_CONTROL_ICON="ViewCtrlIcon"}(n=t.SelectionIds||(t.SelectionIds={})),t.isTrimetricCorner=y;var v,E,I=new a.NodeProperties({primitiveType:a.PrimitiveType.TRIANGLES,material:a.UNLIT_COLOR_FROM_ATTRIBUTE,zOffset:2}),T=new a.NodeProperties({isPickable:!1,primitiveType:a.PrimitiveType.LINES,isVisible:!1}),S=new a.NodeProperties({isPickable:!1,primitiveType:a.PrimitiveType.LINES}),P=S,_=new a.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,isStencilTested:!0,primitiveType:a.PrimitiveType.LINES}),M=new a.NodeProperties({isPickable:!1,primitiveType:a.PrimitiveType.TRIANGLES,material:null}),D=new a.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,primitiveType:a.PrimitiveType.TRIANGLES,material:null}),C=.5,O=.5*m.getNumber("VIEW_CUBE_ARROW_WIDTH"),A=.5*m.getNumber("VIEW_CUBE_ARROW_HEIGHT"),R=C-A;function N(){return(C-2*O)/1.6-m.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX")/v/1.5}t.MANIPULATOR_ID="viewmanipulator",t.MANIPULATOR_BUTTONS_ID="viewmanipulatorbuttons";var w=function(e){function i(i){var r,s,c=e.call(this,i,a.HUD_SCENEGRAPH_ID)||this;c.staticIncrements=null,c.cubeCenter=[0,0,0],c.setId(t.MANIPULATOR_BUTTONS_ID),c.highlightedId=a.NO_SELECTION_ID;try{for(var l=(0,o.__values)(Object.values(n)),u=l.next();!u.done;u=l.next()){var h=u.value;c.listenTo(c,a.UiEvents.CLICK+h,c.onMouseClick),c.listenTo(c,a.UiEvents.MOUSE_ENTER+h,c.onMouseEnter),c.listenTo(c,a.UiEvents.MOUSE_LEAVE+h,c.onMouseLeave),h===n.VIEW_CONTROL_ICON&&c.listenTo(c.viewer.getEventDispatcher(),a.VIEW_CONTAINER_MENU_INVOKED,c.unselectViewControlIcon)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(s=l.return)&&s.call(l)}finally{if(r)throw r.error}}return c}return(0,o.__extends)(i,e),i.prototype.onDevicePixelRatioChanged=function(e){this.staticIncrements=null,this.updateGraphics()},i.prototype.setCubeCenter=function(e){this.cubeCenter=e},i.prototype.getStaticIncrements=function(){if(this.staticIncrements)return this.staticIncrements;var e=this;this.staticIncrements={};var t=function(t,i,r,n){p.vec3.scale(i,v),p.vec3.scale(r,v),p.vec3.scale(n,v);var o=t+"Face",s=(0,a.createTriangle)(i,r,n);e.staticIncrements[o]={selection:t,data:s,type:I,color:m.getColor("VIEW_CUBE_ARROW_COLOR")}};t(n.LEFT_ARROW,[-.5,0,-.5],[-R,-O,-.5],[-R,O,-.5]),t(n.RIGHT_ARROW,[C,0,-.5],[R,O,-.5],[R,-O,-.5]),t(n.UP_ARROW,[0,C,-.5],[-O,R,-.5],[O,R,-.5]),t(n.DOWN_ARROW,[0,-.5,-.5],[O,-R,-.5],[-O,-R,-.5]);var i=Math.sin(Math.PI/4),r=Math.cos(Math.PI/4),o=Math.sin(Math.PI/4-A/C),s=Math.cos(Math.PI/4-A/C);t(n.CW_ARROW,[r*C,i*C,-.5],[r*(C-2*O),i*(C-2*O),-.5],[s*(C-O),o*(C-O),-.5]),t(n.CCW_ARROW,[-r*(C-2*O),i*(C-2*O),-.5],[-r*C,i*C,-.5],[-s*(C-O),o*(C-O),-.5]);var c=function(t,i,r){for(var n=Math.ceil(36*Math.abs(r-i)/Math.PI),o=(C-O-m.getNumber("VIEW_CUBE_ARROW_ARC_WIDTH")/2)*v,s=(C-O+m.getNumber("VIEW_CUBE_ARROW_ARC_WIDTH")/2)*v,c=(0,a.getCirclePoints)([0,0,0],o,[0,0,1],n,[1,0,0],i,r),l=(0,a.getCirclePoints)([0,0,0],s,[0,0,1],n,[1,0,0],i,r),u=(l.length+c.length)/3,h=new Float32Array(3*u),d=0;d<u/2;++d)h[6*d+0]=c[3*d+0],h[6*d+1]=c[3*d+1],h[6*d+2]=c[3*d+2],h[6*d+3]=l[3*d+0],h[6*d+4]=l[3*d+1],h[6*d+5]=l[3*d+2];var p=t+"ArcFace",g=new Float32Array(3*u);for(d=0;d<u;++d)g[3*d+0]=0,g[3*d+1]=0,g[3*d+2]=1;var f=new Int32Array(6*(u/2-1));for(d=0;d<u/2-1;++d)f[6*d+0]=2*d+0,f[6*d+1]=2*d+1,f[6*d+2]=2*d+2,f[6*d+3]=2*d+1,f[6*d+4]=2*d+3,f[6*d+5]=2*d+2;var y=new a.MeshIncrement(a.PrimitiveType.TRIANGLES,h,f);y.normals=g,e.staticIncrements[p]={selection:t,data:y,type:I,color:m.getColor("VIEW_CUBE_ARROW_COLOR")}};return c(n.CW_ARROW,.25*Math.PI,.4*Math.PI),c(n.CCW_ARROW,.6*Math.PI,.75*Math.PI),e.staticIncrements},i.prototype.updateGraphics=function(){this.updateIncrementsOnEntity(n.LEFT_ARROW,"Face"),this.updateIncrementsOnEntity(n.RIGHT_ARROW,"Face"),this.updateIncrementsOnEntity(n.UP_ARROW,"Face"),this.updateIncrementsOnEntity(n.DOWN_ARROW,"Face"),this.updateIncrementsOnEntity(n.CW_ARROW,"Face"),this.updateIncrementsOnEntity(n.CCW_ARROW,"Face"),this.updateIncrementsOnEntity(n.CW_ARROW,"ArcFace"),this.updateIncrementsOnEntity(n.CCW_ARROW,"ArcFace")},i.prototype.updateIncrementsOnEntity=function(e,t){var i=this.getStaticIncrements();(i[e+t].type===I||i[e+t].type===S&&i[e+t].color)&&(0,a.addColorToIncrement)(this.highlightedId===i[e+t].selection?m.getColor("VIEW_CUBE_FACE_HIGHLIGHT"):i[e+t].color,i[e+t].data),this.updateMeshIncrement(e+t,i[e+t].selection,i[e+t].data.clone(),i[e+t].type)},i.prototype.updateTransform=function(){var e=p.mat4.identity();e[12]=this.cubeCenter[0],e[13]=this.cubeCenter[1],e[14]=this.cubeCenter[2],this.setTransform(e),this.hasMeshIncrements()||this.updateGraphics()},i.prototype.onMouseClick=function(e,i,r){var o;this.trigger(t.VIEW_MANIPULATOR_EVENT,e.selectionId),ga("send","event","VIEW_CUBE_COMMAND","click_"+e.selectionId,(0,u.getModelId)()),n.LEFT_ARROW===e.selectionId?o="left":n.RIGHT_ARROW===e.selectionId?o="right":n.UP_ARROW===e.selectionId?o="up":n.DOWN_ARROW===e.selectionId?o="down":n.CW_ARROW===e.selectionId?o="clockwise":n.CCW_ARROW===e.selectionId&&(o="counterclockwise"),o&&(i.shiftKey&&l.btInjector.CapabilitiesService.checkViewCubeRotateCurrentlyEnabled()?this.viewer.rotateIncrementallyInDirection(o):this.viewer.rotateInDirection(o),r.requestSelectedStatus=!1)},i.prototype.unselectViewControlIcon=function(){this.highlightedId===n.VIEW_CONTROL_ICON&&(this.highlightedId=a.NO_SELECTION_ID,this.updateGraphics()),this.viewer.requestDraw()},i.prototype.onMouseEnter=function(e,t){this.highlightedId=e.selectionId,this.updateGraphics(),this.viewer.requestDraw()},i.prototype.onMouseLeave=function(e,t){this.highlightedId===e.selectionId&&(this.highlightedId=a.NO_SELECTION_ID,this.updateGraphics()),this.viewer.requestDraw()},i.prototype.isViewManipulator=function(){return!0},i}(a.UIElement);t.ViewManipulatorButtons=w;var b="label",L="label.showthrough",F=(0,a.toRadians)(m.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_START_ANGLE")),B=(0,a.toRadians)(m.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_END_ANGLE")),x=function(e){function t(t,i,r,n){var o=e.call(this,n,a.HUD_SCENEGRAPH_ID)||this;return o.label=t,o.direction=i,o.color=r,o.labelTexture=null,o.center=[0,0,0,0],o.cubeCenter=[0,0,0],o.lastSetOpacity=-1,o.nodeProperties=new a.NodeProperties(M),o.nodeProperties.material=(0,a.createTextureMaterial)(),o.nodeProperties.updateId(),o.showThroughNodeProperties=new a.NodeProperties(D),o.showThroughNodeProperties.material=o.nodeProperties.material,o.showThroughNodeProperties.updateId(),o.ensureTexture(),o}return(0,o.__extends)(t,e),t.prototype.onDevicePixelRatioChanged=function(e){this.labelTexture=null,this.ensureTexture(),this.updateIncrements()},t.prototype.remove=function(){this.labelTexture&&this.labelTexture.destroy(),this.nodeProperties.material&&(this.nodeProperties.material.destroy(),this.nodeProperties.material=null),e.prototype.remove.call(this)},t.prototype.updateIncrements=function(){var e=m.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX"),t=this.labelTexture.filledWidthPx,i=(0,a.createQuad)([-t/2,-e/2,0],[t/2,-e/2,0],[-t/2,e/2,0],void 0,[this.labelTexture.leftCoordinate,this.labelTexture.bottomCoordinate],[this.labelTexture.rightCoordinate,this.labelTexture.topCoordinate]);(0,a.addColorToIncrement)([1,1,1,.5],i),this.updateMeshIncrement(b,a.NO_SELECTION_ID,i,this.nodeProperties);var r=i.clone();(0,a.addColorToIncrement)([1,1,1,m.getNumber("VIEW_CUBE_HIDDEN_AXIS_OPACITY")],r),this.updateMeshIncrement(L,a.NO_SELECTION_ID,r,this.showThroughNodeProperties);var n=v*E,o=m.getNumber("VIEW_CUBE_AXIS_GAP"),s=[-n-o,-n-o,-n-o],c=Math.sqrt(t*t+e*e)/2+3,l=p.vec3.add(p.vec3.scale(this.direction,2*n+c,p.vec3.create()),s);this.center=[l[0],l[1],l[2],0]},t.prototype.ensureTexture=function(){this.viewer.getGlContext()&&(this.labelTexture||(this.labelTexture=(0,a.createTextureFromText)(this.viewer,this.label,{color:this.color,font:m.getString("VIEW_CUBE_TEXT_FONT"),size:m.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX")}),this.nodeProperties.material.ambientTexture=this.labelTexture,this.showThroughNodeProperties.material.ambientTexture=this.labelTexture,this.updateIncrements()))},t.prototype.setCubeCenter=function(e){this.cubeCenter=e},t.prototype.setOpacity=function(e){if(e!==this.lastSetOpacity){var t=new Uint8Array([255,255,255,255*e]);this.updateIncrementAttribute(b,a.Attributes.COLOR,t),t[3]=255*Math.min(e,m.getNumber("VIEW_CUBE_HIDDEN_AXIS_OPACITY")),this.updateIncrementAttribute(L,a.Attributes.COLOR,t),this.lastSetOpacity=e}},t.prototype.updateTransform=function(e){var t=Math.acos(Math.abs(p.vec3.dot(e.getForward(),this.direction))),i=(0,a.smoothstep)(B,F,t);this.setOpacity(i);var r=p.mat4.multiplyVec4(e.getViewMatrix(),this.center,p.vec4.create()),n=p.vec3.add(r,this.cubeCenter);this.setTransform(p.mat4.translate(p.mat4.identity(),n))},t}(a.UIElement),U=function(e){function t(t,i){var r=e.call(this,i)||this;return r.contextMenuMgr=t,r}var i;return(0,o.__extends)(t,e),t.prototype.initialize=function(e){var t=this;this.viewer=e.viewer,this.parentManipulator=e.parentManipulator,this.mouseMoveFunction=function(e){return t.onMouseMove(e)},this.mouseUpFunction=function(e){return t.onMouseUp(e)},this.distanceDraggedPx=0,this.rightPostion=-1,this.topPosition=-1,this.$el.hide(),this.$el.html(f()),this.$el.attr("data-original-title",i18n("Camera and render options"));var i=m.getNumber("VIEW_CUBE_SCREEN_SIZE_PX")/(0,g.getDevicePixelRatio)();this.$el.find(".os-view-cube-bounds").css({width:i+"px",height:i+"px",right:0,bottom:"5px"})},t.prototype.appendToCanvasParent=function(){this.$el.appendTo(this.viewer.$el.parent()),this.delegateEvents()},t.prototype.position=function(e,t){this.rightPostion===e&&this.topPosition===t||(this.$el.css({right:e,top:t}),this.rightPostion=e,this.topPosition=t)},t.prototype.onClick=function(){this.distanceDraggedPx<=m.getNumber("LEFT_MOUSE_DRAG_DISTANCE_TOLERANCE")&&(this.$el.hasClass("os-dropdown-open")?this.contextMenuMgr.closeAllContextMenus():r("#content-div .viewControlPopup").osContextMenu()),this.distanceDraggedPx=0},t.prototype.getCanvasPositionFromEvent=function(e){var t=this.viewer.getCanvasCoordinateFromEvent(e);return{mouseX:t[0],mouseY:t[1]}},t.prototype.onMouseDown=function(e){this.viewer.isReadyForDrawing()&&(l.btInjector.FlyoutService.collapseAllFlyouts(),1===e.which&&(this.parentManipulator.setDragStart(this.getCanvasPositionFromEvent(e)),r(document).on("mousemove",this.mouseMoveFunction),r(document).on("mouseup",this.mouseUpFunction)))},t.prototype.onMouseMove=function(e){this.viewer.isReadyForDrawing()&&(this.distanceDraggedPx+=this.parentManipulator.updateDragPosition(this.getCanvasPositionFromEvent(e)))},t.prototype.onMouseUp=function(e){r(document).off("mousemove",this.mouseMoveFunction),r(document).off("mouseup",this.mouseUpFunction)},t=(0,o.__decorate)([(0,d.BackboneViewProperties)({className:"os-graphics-dropdown",events:{click:"onClick",mousedown:"onMouseDown"}}),(0,o.__metadata)("design:paramtypes",["function"==typeof(i=void 0!==h.IContextMenuMgr&&h.IContextMenuMgr)?i:Object,Object])],t)}(s.View);t.DropdownButton=U;var G=function(e){function i(i,r){var s,c,l=e.call(this,i,a.HUD_SCENEGRAPH_ID)||this;l.labelTextures={},l.labelProperties={},l.topRightCorner=[0,0,0],l.center=[0,0,0],l.staticIncrements=null,l.axisLabels={},l.dropdownButton=null,l.i18next=i18n,"function"!=typeof l.i18next&&(l.i18next=function(e){return e}),v=m.getNumber("VIEW_CUBE_SCREEN_SIZE_PX"),E=N(),l.setId(t.MANIPULATOR_ID),l.highlightedId=a.NO_SELECTION_ID,l.oldDevicePixelRatio=(0,g.getDevicePixelRatio)(),l.manipulatorButtons=new w(l.viewer),l.listenTo(l.viewer.getEventDispatcher(),a.GL_CONTEXT_RESTORED,l.ensureTextures);try{for(var u=(0,o.__values)(Object.values(n)),h=u.next();!h.done;h=u.next()){var d=h.value;l.listenTo(l,a.UiEvents.CLICK+d,l.onMouseClick),l.listenTo(l,a.UiEvents.MOUSE_ENTER+d,l.onMouseEnter),l.listenTo(l,a.UiEvents.MOUSE_LEAVE+d,l.onMouseLeave),l.listenTo(l,a.UiEvents.DRAG_START+d,l.onDragStart),l.listenTo(l,a.UiEvents.DRAG+d,l.onDrag),l.listenTo(l,a.UiEvents.DRAG_STOP+d,l.onDragStop),l.listenTo(l.manipulatorButtons,a.UiEvents.DRAG_START+d,l.onDragStart),l.listenTo(l.manipulatorButtons,a.UiEvents.DRAG+d,l.onDrag),l.listenTo(l.manipulatorButtons,a.UiEvents.DRAG_STOP+d,l.onDragStop)}}catch(e){s={error:e}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(s)throw s.error}}return l.axisLabels.X=new x("X",[1,0,0],m.getColor("X_AXIS_COLOR"),l.viewer),l.axisLabels.Y=new x("Y",[0,1,0],m.getColor("Y_AXIS_COLOR"),l.viewer),l.axisLabels.Z=new x("Z",[0,0,1],m.getColor("Z_AXIS_COLOR"),l.viewer),l.viewer.getIsForFlattenedDisplay()||(l.dropdownButton=new U(r,{viewer:l.viewer,parentManipulator:l})),l.ensureTextures(),l}return(0,o.__extends)(i,e),i.prototype.onDevicePixelRatioChanged=function(e){this.staticIncrements=null,this.labelTextures={};var t=(0,g.getDevicePixelRatio)();p.vec3.scale(this.topRightCorner,t/this.oldDevicePixelRatio),this.oldDevicePixelRatio=t,v=m.getNumber("VIEW_CUBE_SCREEN_SIZE_PX"),E=N(),this.ensureTextures(),this.updateGraphics(),this.updateDropdownPosition()},i.prototype.remove=function(){Object.values(this.labelTextures).forEach((function(e){e.destroy()})),Object.values(this.labelProperties).forEach((function(e){e.material&&(e.material.destroy(),e.material=null)})),this.dropdownButton&&this.dropdownButton.remove(),e.prototype.remove.call(this)},i.prototype.hide=function(){e.prototype.hide.call(this),this.manipulatorButtons.hide(),Object.values(this.axisLabels).forEach((function(e){e.hide()})),this.dropdownButton&&this.dropdownButton.$el.hide()},i.prototype.show=function(){e.prototype.show.call(this),this.manipulatorButtons.show(),Object.values(this.axisLabels).forEach((function(e){e.show()})),this.dropdownButton&&(this.dropdownButton.appendToCanvasParent(),this.dropdownButton.$el.show())},i.prototype.getPickPriority=function(e){return y(e.selectionId)?a.PickPriority.UI+5:a.PickPriority.UI},i.prototype.onViewWillDraw=function(e,t){for(var i in this.updateTransform(e),this.manipulatorButtons.updateTransform(),this.axisLabels)this.axisLabels[i].updateTransform(e)},i.prototype.ensureTextures=function(){if(this.viewer.getGlContext()){var e=this,t=function(t,i,r){e.labelTextures[t]||(e.labelTextures[t]=(0,a.createTextureFromText)(e.viewer,i,{color:m.getColor("VIEW_CUBE_TEXT_COLOR"),font:m.getString("VIEW_CUBE_TEXT_FONT"),size:r,paddingWithinBorder:m.getNumber("VIEW_CUBE_TEXT_BACKGROUND_PADDING")}));var n=e.labelProperties[t];n||((n=new a.NodeProperties(M)).material=(0,a.createTextureMaterial)(),e.labelProperties[t]=n),n.material.ambientTexture=e.labelTextures[t],n.updateId()};for(var i in t(n.TOP,this.i18next("Top"),m.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),t(n.BOTTOM,this.i18next("Bottom"),m.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),t(n.FRONT,this.i18next("Front"),m.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),t(n.BACK,this.i18next("Back"),m.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),t(n.RIGHT,this.i18next("Right"),m.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),t(n.LEFT,this.i18next("Left"),m.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),this.axisLabels)this.axisLabels[i].ensureTexture()}},i.prototype.updateCenter=function(e){var t=e.getViewport(),i=-(0,a.getHudLayerDepthRange)(t)[0]-.5*v;this.center=p.vec3.add([t[0]+t[2]-v/2,t[1]+t[3]-v/2,i],this.topRightCorner);var r=t[0]+m.getNumber("VIEW_CUBE_LEFT_MARGIN_PX")+v/2,n=t[1]+m.getNumber("VIEW_CUBE_BOTTOM_MARGIN_PX")+v/2,o=t[0]+t[2]-m.getNumber("VIEW_CUBE_RIGHT_MARGIN_PX")-v/2,s=t[1]+t[3]-m.getNumber("VIEW_CUBE_TOP_MARGIN_PX")-v/2;for(var c in this.center[0]=Math.min(Math.max(r,this.center[0]),o),this.center[1]=Math.min(Math.max(n,this.center[1]),s),this.topRightCorner=[this.center[0]+v/2-t[0]-t[2],this.center[1]+v/2-t[1]-t[3],0],this.updateDropdownPosition(),this.axisLabels)this.axisLabels[c].setCubeCenter(this.center);this.manipulatorButtons.setCubeCenter(this.center)},i.prototype.getStaticIncrements=function(){if(this.staticIncrements)return this.staticIncrements;var e=this;this.staticIncrements={};var t=function(t,i,r,n){p.vec3.scale(i,v),p.vec3.scale(r,v),p.vec3.scale(n,v);var o=p.vec3.subtract(r,i,p.vec3.create()),s=p.vec3.subtract(n,i,p.vec3.create()),c=p.vec3.add(i,p.vec3.scale(p.vec3.add(o,s,p.vec3.create()),.5),p.vec3.create()),l=p.vec3.length(o),u=p.vec3.length(s);p.vec3.scale(o,1/l),p.vec3.scale(s,1/u);var h=(l+u)/2*m.getNumber("VIEW_CUBE_CORNER_SIZE"),d=t+"Front",g=l*m.getNumber("VIEW_CUBE_FRONT_SIZE"),f=u*m.getNumber("VIEW_CUBE_FRONT_SIZE"),y=p.vec3.add(p.vec3.scale(o,-.5*g,p.vec3.create()),p.vec3.scale(s,-.5*f,p.vec3.create()),p.vec3.create());y=p.vec3.add(y,c);var E=p.vec3.add(p.vec3.scale(o,g,p.vec3.create()),y),S=p.vec3.add(p.vec3.scale(s,f,p.vec3.create()),y),P=(0,a.createRoundedRectangle)(y,E,S,h,9);e.staticIncrements[d]={selection:t,data:P,type:I,color:m.getColor("VIEW_CUBE_FRONT_COLOR")};for(var _=t+"Edge",M=P.points,D=M.length/3,C=new Int32Array(2*D),O=0;O<D;++O)C[2*O]=O,C[2*O+1]=(O+1)%D;var A=new a.MeshIncrement(a.PrimitiveType.LINES,M,C);e.staticIncrements[_]={selection:t,data:A,type:T,color:m.getColor("VIEW_CUBE_EDGE_HIGHLIGHT")};var R=t+"Back",N=l*m.getNumber("VIEW_CUBE_BACK_SIZE"),w=u*m.getNumber("VIEW_CUBE_BACK_SIZE"),b=p.vec3.add(p.vec3.scale(o,-.5*N,p.vec3.create()),p.vec3.scale(s,-.5*w,p.vec3.create()),p.vec3.create());b=p.vec3.add(b,c);var L=p.vec3.add(p.vec3.scale(o,N,p.vec3.create()),b),F=p.vec3.add(p.vec3.scale(s,w,p.vec3.create()),b),B=(0,a.createRoundedRectangle)(b,F,L,h,9);e.staticIncrements[R]={selection:t,data:B,type:I,color:m.getColor("VIEW_CUBE_BACK_COLOR")};var x=t+"BackEdge",U=B.points;D=M.length/3;var G=new Int32Array(2*D);for(O=0;O<D;++O)G[2*O]=O,G[2*O+1]=(O+1)%D;var H=new a.MeshIncrement(a.PrimitiveType.LINES,U,G);e.staticIncrements[x]={selection:t,data:H,type:T,color:m.getColor("VIEW_CUBE_EDGE_HIGHLIGHT")};var V=t+"Label",k=e.labelTextures[t],W=k.filledWidthPx,j=k.filledHeightPx,z=(l-W)/2,X=(u-j)/2,q=p.vec3.add(p.vec3.scale(o,z,p.vec3.create()),p.vec3.scale(s,X,p.vec3.create()),p.vec3.create());p.vec3.add(q,i);var Y=p.vec3.add(q,p.vec3.scale(o,W,p.vec3.create()),p.vec3.create()),Z=p.vec3.add(q,p.vec3.scale(s,j,p.vec3.create()),p.vec3.create()),K=(0,a.createQuad)(q,Y,Z,void 0,[k.leftCoordinate,k.bottomCoordinate],[k.rightCoordinate,k.topCoordinate]);e.staticIncrements[V]={selection:t,data:K,type:e.labelProperties[t],color:null}},i=E;t(n.TOP,[-i,-i,i],[i,-i,i],[-i,i,i]),t(n.BOTTOM,[-i,i,-i],[i,i,-i],[-i,-i,-i]),t(n.FRONT,[-i,-i,-i],[i,-i,-i],[-i,-i,i]),t(n.BACK,[i,i,-i],[-i,i,-i],[i,i,i]),t(n.RIGHT,[i,-i,-i],[i,i,-i],[i,-i,i]),t(n.LEFT,[-i,i,-i],[-i,-i,-i],[-i,i,i]);var r=function(t,i,r,n){p.vec3.scale(i,v),n*=v;var o=t+"Face",s=(0,a.createDisc)(i,n,r,36);e.staticIncrements[o]={selection:t,data:s,type:I,color:m.getColor("VIEW_CUBE_FRONT_COLOR")};for(var c=t+"Edge",l=s.points,u=l.length/3,h=new Int32Array(2*u),d=0;d<u;++d)h[2*d]=d,h[2*d+1]=(d+1)%u;var g=new a.MeshIncrement(a.PrimitiveType.LINES,l,h);e.staticIncrements[c]={selection:t,data:g,type:T,color:m.getColor("VIEW_CUBE_EDGE_HIGHLIGHT")}},o=.8*i,s=.24*i;return r(n.TRIMETRIC_TOP_RIGHT_FRONT,[o,-o,o],[1,-1,1],s),r(n.TRIMETRIC_TOP_LEFT_FRONT,[-o,-o,o],[-1,-1,1],s),r(n.TRIMETRIC_TOP_RIGHT_BACK,[o,o,o],[1,1,1],s),r(n.TRIMETRIC_TOP_LEFT_BACK,[-o,o,o],[-1,1,1],s),r(n.TRIMETRIC_BOTTOM_RIGHT_FRONT,[o,-o,-o],[1,-1,-1],s),r(n.TRIMETRIC_BOTTOM_LEFT_FRONT,[-o,-o,-o],[-1,-1,-1],s),r(n.TRIMETRIC_BOTTOM_RIGHT_BACK,[o,o,-o],[1,1,-1],s),r(n.TRIMETRIC_BOTTOM_LEFT_BACK,[-o,o,-o],[-1,1,-1],s),e.staticIncrements},i.prototype.updateGraphics=function(){var e,t=n,i=[t.TOP,t.BOTTOM,t.FRONT,t.BACK,t.LEFT,t.RIGHT];for(e=0;e<i.length;e++)this.updateIncrementsOnEntity(i[e],"Front"),this.updateIncrementsOnEntity(i[e],"Edge"),this.updateIncrementsOnEntity(i[e],"Back"),this.updateIncrementsOnEntity(i[e],"BackEdge"),this.updateIncrementsOnEntity(i[e],"Label");var r=[t.TRIMETRIC_TOP_RIGHT_FRONT,t.TRIMETRIC_TOP_LEFT_FRONT,t.TRIMETRIC_TOP_RIGHT_BACK,t.TRIMETRIC_TOP_LEFT_BACK,t.TRIMETRIC_BOTTOM_RIGHT_FRONT,t.TRIMETRIC_BOTTOM_LEFT_FRONT,t.TRIMETRIC_BOTTOM_RIGHT_BACK,t.TRIMETRIC_BOTTOM_LEFT_BACK];for(e=0;e<r.length;e++)this.updateIncrementsOnEntity(r[e],"Face"),this.updateIncrementsOnEntity(r[e],"Edge");this.addAxes()},i.prototype.addAxes=function(){var e=this,t=function(t,i,r){var n=v*E,o=m.getNumber("VIEW_CUBE_AXIS_GAP"),s=[-n-o,-n-o,-n-o],c=p.vec3.add(p.vec3.scale(i,2*n,p.vec3.create()),s),l=(0,a.createLine)(s,c);(0,a.addSizeToIncrement)(m.getNumber("VIEW_CUBE_AXIS_WIDTH"),l),(0,a.addColorToIncrement)(r,l),e.updateMeshIncrement(t,a.NO_SELECTION_ID,l,P);var u=l.clone();(0,a.addStyleToIncrement)(m.getStipple("VIEW_CUBE_HIDDEN_AXIS_STIPPLE"),u);var h=r.slice(0);h[3]=m.getNumber("VIEW_CUBE_HIDDEN_AXIS_OPACITY"),(0,a.addColorToIncrement)(h,u),e.updateMeshIncrement(t+".st",a.NO_SELECTION_ID,u,_)};t("X",[1,0,0],m.getColor("X_AXIS_COLOR")),t("Y",[0,1,0],m.getColor("Y_AXIS_COLOR")),t("Z",[0,0,1],m.getColor("Z_AXIS_COLOR"))},i.prototype.updateIncrementsOnEntity=function(e,t){var i=this.getStaticIncrements();i[e+t].type===I?(0,a.addColorToIncrement)(this.highlightedId===i[e+t].selection?m.getColor("VIEW_CUBE_FACE_HIGHLIGHT"):i[e+t].color,i[e+t].data):i[e+t].type===S&&(0,a.addColorToIncrement)(i[e+t].color,i[e+t].data),this.updateMeshIncrement(e+t,i[e+t].selection,i[e+t].data.clone(),i[e+t].type)},i.prototype.updateTransform=function(e){this.updateCenter(e);var t=p.mat4.identity();t[12]=this.center[0],t[13]=this.center[1],t[14]=this.center[2];var i=p.mat4.lookAt([0,0,0,1],e.direction,e.up,p.mat4.create()),r=p.mat4.multiply(t,i,p.mat4.create());this.setTransform(r),this.hasMeshIncrements()||this.updateGraphics()},i.prototype.isMouseInside=function(){return this.highlightedId!==a.NO_SELECTION_ID||this.manipulatorButtons.highlightedId!==a.NO_SELECTION_ID},i.prototype.onMouseClick=function(e,i,r){this.trigger(t.VIEW_MANIPULATOR_EVENT,e.selectionId),ga("send","event","VIEW_CUBE_COMMAND","click_"+e.selectionId,(0,u.getModelId)()),n.TOP===e.selectionId?this.viewer.animateToStandardView("XY"):n.BOTTOM===e.selectionId?this.viewer.animateToStandardView("XYback"):n.FRONT===e.selectionId?this.viewer.animateToStandardView("XZ"):n.BACK===e.selectionId?this.viewer.animateToStandardView("XZback"):n.RIGHT===e.selectionId?this.viewer.animateToStandardView("YZ"):n.LEFT===e.selectionId?this.viewer.animateToStandardView("YZback"):y(e.selectionId)&&this.viewer.animateToStandardView(e.selectionId),r.requestSelectedStatus=!1},i.prototype.onMouseEnter=function(e,t){this.highlightedId=e.selectionId,this.updateGraphics(),this.viewer.requestDraw()},i.prototype.onMouseLeave=function(e,t){this.highlightedId===e.selectionId&&(this.highlightedId=a.NO_SELECTION_ID,this.updateGraphics()),this.viewer.requestDraw()},i.prototype.onDragStart=function(e,t,i){i.requestDrag=!0,this.setDragStart(t)},i.prototype.onDrag=function(e,t){this.updateDragPosition(t)},i.prototype.setDragStart=function(e){this.dragStart=[e.mouseX,e.mouseY]},i.prototype.updateDragPosition=function(e){this.topRightCorner[0]+=e.mouseX-this.dragStart[0],this.topRightCorner[1]+=-(e.mouseY-this.dragStart[1]);var t=Math.abs(e.mouseX-this.dragStart[0])+Math.abs(e.mouseY-this.dragStart[1]);return this.setDragStart(e),this.manipulatorButtons.updateGraphics(),this.updateDropdownPosition(),this.viewer.requestDraw(),t},i.prototype.updateDropdownPosition=function(){if(this.dropdownButton){var e=(0,g.getDevicePixelRatio)(),t=m.getNumber("VIEW_CUBE_SCREEN_SIZE_PX");this.dropdownButton.position(-this.topRightCorner[0]/e,(-this.topRightCorner[1]+t)/e-this.dropdownButton.$el.height()+5)}},i.prototype.onDragStop=function(e,t){delete this.dragStart,this.viewer.requestDraw()},i.prototype.isViewManipulator=function(){return!0},i}(a.UIElement);t.ViewManipulator=G},355720:function(e,t,i){"use strict";var r=i(970732);Object.defineProperty(t,"__esModule",{value:!0}),t.StateCachingGLContext=t.UniformAttribRepeatingGLContext=t.StateRepeatingGLContext=t.SkipProgramsGLContext=t.AssignIdGLContext=t.CallCountingGLContext=t.GLContext=void 0;var n=i(423902),o=i(736202),s=i(311517),a=function(){function e(e){for(var t in this.gl=e,this.gl)"gl"!==t&&("function"==typeof e[t]?t in this||(this[t]=function(e,t,i){return function(){return i.apply(e,arguments)}}(this.gl,0,this.gl[t])):function(e,t){e[t]=e.gl[t]}(this,t))}return e.prototype.apply=function(){},e.prototype.printState=function(){s.log.debug("BLEND \t\t"+this.gl.isEnabled(this.gl.BLEND)),s.log.debug("CULL_FACE \t\t"+this.gl.isEnabled(this.gl.CULL_FACE)),s.log.debug("DEPTH_TEST \t\t"+this.gl.isEnabled(this.gl.DEPTH_TEST)),s.log.debug("DITHER \t\t"+this.gl.isEnabled(this.gl.DITHER)),s.log.debug("POLYGON_OFFSET_FILL \t\t"+this.gl.isEnabled(this.gl.POLYGON_OFFSET_FILL)),s.log.debug("SAMPLE_ALPHA_TO_COVERAGE \t\t"+this.gl.isEnabled(this.gl.SAMPLE_ALPHA_TO_COVERAGE)),s.log.debug("SAMPLE_COVERAGE \t\t"+this.gl.isEnabled(this.gl.SAMPLE_COVERAGE)),s.log.debug("SCISSOR_TEST \t\t"+this.gl.isEnabled(this.gl.SCISSOR_TEST)),s.log.debug("STENCIL_TEST \t\t"+this.gl.isEnabled(this.gl.STENCIL_TEST)),s.log.debug("\n")},e}();t.GLContext=a;var c=function(){function e(e,t){for(var i in this.callCounts={},t=void 0!==t&&t,this.gl=e,this.gl)"gl"!==i&&"callCounts"!==i&&"printCallStats"!==i&&("function"==typeof e[i]?i in this||(this[i]=function(e,i,r){return function(){return t&&(i in this.callCounts?this.callCounts[i]++:this.callCounts[i]=1),s.log.debug(r.toString()),r.apply(e,arguments)}}(this.gl,i,this.gl[i])):function(e,t){e[t]=e.gl[t]}(this,i))}return e.prototype.printCallStats=function(){var e=[];for(var t in this.callCounts)e.push([t,this.callCounts[t]]);for(var i in e=e.sort((function(e,t){return t[1]-e[1]})))s.log.debug(e[i][0]+" "+e[i][1])},e}();t.CallCountingGLContext=c;var l=function(e){function t(t){var i=e.call(this,t)||this;return i.nextId=1,i.uniqueIds=new Map,i}return(0,n.__extends)(t,e),t.prototype.assignNextId=function(e){e.tempId=this.nextId,this.uniqueIds.set(e,this.nextId),this.nextId++},t.prototype.createProgram=function(){var e=this.gl.createProgram();return this.assignNextId(e),e},t}(a);t.AssignIdGLContext=l;var u=function(e){function t(t){var i=e.call(this,new l(t))||this;return i.currentProgram=null,i.programFlags=[],i.programNames={},i.programSources=[],i}return(0,n.__extends)(t,e),t.prototype.getProgramFlags=function(){return this.programFlags},t.prototype.setProgramFlags=function(e){this.programFlags=e},t.prototype.onlyProgram=function(e){for(var t=0;t<this.programFlags.length;t++)this.programFlags[t]=e===t},t.prototype.allButProgram=function(e){for(var t=0;t<this.programFlags.length;t++)this.programFlags[t]=e!==t},t.prototype.allPrograms=function(){for(var e=0;e<this.programFlags.length;e++)this.programFlags[e]=!0},t.prototype.noPrograms=function(){for(var e=0;e<this.programFlags.length;e++)this.programFlags[e]=!1},t.prototype.createProgram=function(t){var i=e.prototype.createProgram.call(this);return this.programNames[i.tempId]=t,i},t.prototype.useProgram=function(e){this.currentProgram=e,this.gl.useProgram(e),e.tempId in this.programFlags||(this.programFlags[e.tempId]=!0)},t.prototype.drawArrays=function(e,t,i){this.programFlags[this.currentProgram.tempId]&&this.gl.drawArrays(e,t,i)},t.prototype.drawElements=function(e,t,i,r){this.programFlags[this.currentProgram.tempId]&&this.gl.drawElements(e,t,i,r)},t}(a);t.SkipProgramsGLContext=u;var h=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.numChanges=i,n.numRepeats=r,n}return(0,n.__extends)(t,e),t.prototype.enable=function(e){this.gl.enable(e);for(var t=0;t<this.numChanges;t++)this.gl.disable(e),this.gl.enable(e);for(t=0;t<this.numRepeats;t++)this.gl.enable(e)},t.prototype.disable=function(e){this.gl.disable(e);for(var t=0;t<this.numChanges;t++)this.gl.enable(e),this.gl.disable(e);for(t=0;t<this.numRepeats;t++)this.gl.disable(e)},t.prototype.enableVertexAttribArray=function(e){this.gl.enableVertexAttribArray(e);for(var t=0;t<this.numChanges;t++)this.gl.disableVertexAttribArray(e),this.gl.enableVertexAttribArray(e);for(t=0;t<this.numRepeats;t++)this.gl.enableVertexAttribArray(e)},t.prototype.disableVertexAttribArray=function(e){this.gl.disableVertexAttribArray(e);for(var t=0;t<this.numChanges;t++)this.gl.enableVertexAttribArray(e),this.gl.disableVertexAttribArray(e);for(t=0;t<this.numRepeats;t++)this.gl.disableVertexAttribArray(e)},t.prototype.useProgram=function(e){this.gl.useProgram(e);for(var t=0;t<this.numChanges;t++)this.gl.useProgram(null),this.gl.useProgram(e);for(t=0;t<this.numRepeats;t++)this.gl.useProgram(e)},t.prototype.activeTexture=function(e){this.gl.activeTexture(e);for(var t=0;t<this.numChanges;t++)this.gl.activeTexture(this.gl.TEXTURE25),this.gl.activeTexture(e);for(t=0;t<this.numRepeats;t++)this.gl.activeTexture(e)},t.prototype.bindTexture=function(e,t){this.gl.bindTexture(e,t);for(var i=0;i<this.numChanges;i++)this.gl.bindTexture(e,null),this.gl.bindTexture(e,t);for(i=0;i<this.numRepeats;i++)this.gl.bindTexture(e,t)},t}(a);t.StateRepeatingGLContext=h;var d=function(e){function t(t,i,n){var o=e.call(this,t)||this;o.numChanges=i,o.numRepeats=n;for(var s=function(e){return function(){e.apply(this.gl,arguments);for(var t=0;t<this.numRepeats;t++)e.apply(this.gl,arguments)}},a=o,c=function(e){r.each(["f","i","fv","iv"],(function(t,i){var r="uniform"+e+i;a[r]=s(a.gl[r]),e>1&&(a[r="uniformMatrix"+e+i]=s(a.gl[r]))}))},l=1;l<=4;l++)c(l);var u=function(e){r.each(["f","fv"],(function(t,i){var r="vertexAttrib"+e+i;a[r]=s(a.gl[r])}))};for(l=1;l<=4;l++)u(l);return o}return(0,n.__extends)(t,e),t}(a);t.UniformAttribRepeatingGLContext=d;var p=function(e){function t(t){var i=e.call(this,t)||this;return i.programUniforms=[],i.attributes=[],i.state=new Map,i.attribarraystate=new Map,i.currentProgram=t.getParameter(t.CURRENT_PROGRAM),i.currentProgramSent=t.getParameter(t.CURRENT_PROGRAM),i.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE),i.activeTextureUnitSent=t.getParameter(t.ACTIVE_TEXTURE),i.textureUnits=new Map,i}return(0,n.__extends)(t,e),t.prototype.getUniformLocation=function(e,t){var i=this.gl.getUniformLocation(e,t),r=this.programUniforms[e.tempId].length;return i&&(i.tempId=r,this.programUniforms[e.tempId][i.tempId]=null),i},t.prototype.apply=function(){this.applyProgram(),this.applyAttributes()},t.prototype.applyProgram=function(){this.currentProgramSent!==this.currentProgram&&(this.gl.useProgram(this.currentProgram),this.currentProgramSent=this.currentProgram);var e=this.programUniforms[this.currentProgram.tempId];if(e)for(var t=0;t<e.length;t++){var i=e[t];if(i){if(i[2])continue;var r=i[0],n=i[1];r.apply(this.gl,n),i[2]=!0}}},t.prototype.applyAttributes=function(){for(var e=0;e<this.attributes.length;e++){var t=this.attributes[e];if(t){if(t[2])continue;var i=t[0],r=t[1];i.apply(this.gl,r),t[2]=!0}}},t.prototype.createProgram=function(){var e=this.gl.createProgram();return this.programUniforms[e.tempId]=[],e},t.prototype.useProgram=function(e){this.currentProgram=e},t.prototype.deleteProgram=function(e){return this.gl.deleteProgram(e)},t.prototype.getCurrentProgramUniforms=function(){var e=this.programUniforms[this.currentProgram.tempId];return e||(e=[],this.programUniforms[this.currentProgram.tempId]=e),e},t.prototype.uniform1f=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform1f,n[2]=n[2]&&n[1][1]===t,n[1][1]=t):i[r]=[this.gl.uniform1f,[e,t],!1]},t.prototype.uniform1i=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform1i,n[2]=n[2]&&n[1][1]===t,n[1][1]=t):i[r]=[this.gl.uniform1i,[e,t],!1]},t.prototype.uniform2f=function(e,t,i){var r=this.getCurrentProgramUniforms(),n=e.tempId,o=r[n];o&&o[1].length===arguments.length?(o[0]=this.gl.uniform2f,o[2]=o[2]&&o[1][1]===t&&o[1][2]===i,o[1][1]=t,o[1][2]=i):r[n]=[this.gl.uniform2f,[e,t,i],!1]},t.prototype.uniform2i=function(e,t,i){var r=this.getCurrentProgramUniforms(),n=e.tempId,o=r[n];o&&o[1].length===arguments.length?(o[0]=this.gl.uniform2i,o[2]=o[2]&&o[1][1]===t&&o[1][2]===i,o[1][1]=t,o[1][2]=i):r[n]=[this.gl.uniform2i,[e,t,i],!1]},t.prototype.uniform3f=function(e,t,i,r){var n=this.getCurrentProgramUniforms(),o=e.tempId,s=n[o];s&&s[1].length===arguments.length?(s[0]=this.gl.uniform3f,s[2]=s[2]&&s[1][1]===t&&s[1][2]===i&&s[1][3]===r,s[1][1]=t,s[1][2]=i,s[1][3]=r):n[o]=[this.gl.uniform3f,[e,t,i,r],!1]},t.prototype.uniform3i=function(e,t,i,r){var n=this.getCurrentProgramUniforms(),o=e.tempId,s=n[o];s&&s[1].length===arguments.length?(s[0]=this.gl.uniform3i,s[2]=s[2]&&s[1][1]===t&&s[1][2]===i&&s[1][3]===r,s[1][1]=t,s[1][2]=i,s[1][3]=r):n[o]=[this.gl.uniform3i,[e,t,i,r],!1]},t.prototype.uniform4f=function(e,t,i,r,n){var o=this.getCurrentProgramUniforms(),s=e.tempId,a=o[s];a&&a[1].length===arguments.length?(a[0]=this.gl.uniform4f,a[2]=a[2]&&a[1][1]===t&&a[1][2]===i&&a[1][3]===r&&(a[1][4]=n),a[1][1]=t,a[1][2]=i,a[1][3]=r,a[1][4]=n):o[s]=[this.gl.uniform4f,[e,t,i,r,n],!1]},t.prototype.uniform4i=function(e,t,i,r,n){var o=this.getCurrentProgramUniforms(),s=e.tempId,a=o[s];a&&a[1].length===arguments.length?(a[0]=this.gl.uniform4i,a[2]=a[2]&&a[1][1]===t&&a[1][2]===i&&a[1][3]===r&&(a[1][4]=n),a[1][1]=t,a[1][2]=i,a[1][3]=r,a[1][4]=n):o[s]=[this.gl.uniform4i,[e,t,i,r,n],!1]},t.prototype.uniform1fv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform1fv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform1fv,[e,t],!1]},t.prototype.uniform1iv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform1iv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform1iv,[e,t],!1]},t.prototype.uniform2fv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform2fv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform2fv,[e,t],!1]},t.prototype.uniform2iv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform2iv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform2iv,[e,t],!1]},t.prototype.uniform3fv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform3fv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform3fv,[e,t],!1]},t.prototype.uniform3iv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform3iv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform3iv,[e,t],!1]},t.prototype.uniform4fv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform4fv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform4fv,[e,t],!1]},t.prototype.uniform4iv=function(e,t){var i=this.getCurrentProgramUniforms(),r=e.tempId,n=i[r];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform4iv,n[2]=n[2]&&(0,o.isEqual)(n[1][1],t),n[1][1]=t):i[r]=[this.gl.uniform4iv,[e,t],!1]},t.prototype.uniformMatrix2fv=function(e,t,i){var r=this.getCurrentProgramUniforms(),n=e.tempId,s=r[n];s&&s[1].length===arguments.length?(s[0]=this.gl.uniformMatrix2fv,s[2]=s[2]&&s[1][1]===t&&(0,o.isEqual)(s[1][2],i),s[1][1]=t,s[1][2]=i):r[n]=[this.gl.uniformMatrix2fv,[e,t,i],!1]},t.prototype.uniformMatrix3fv=function(e,t,i){var r=this.getCurrentProgramUniforms(),n=e.tempId,s=r[n];s&&s[1].length===arguments.length?(s[0]=this.gl.uniformMatrix3fv,s[2]=s[2]&&s[1][1]===t&&(0,o.isEqual)(s[1][2],i),s[1][1]=t,s[1][2]=i):r[n]=[this.gl.uniformMatrix3fv,[e,t,i],!1]},t.prototype.uniformMatrix4fv=function(e,t,i){var r=this.getCurrentProgramUniforms(),n=e.tempId,s=r[n];s&&s[1].length===arguments.length?(s[0]=this.gl.uniformMatrix4fv,s[2]=s[2]&&s[1][1]===t&&(0,o.isEqual)(s[1][2],i),s[1][1]=t,s[1][2]=i):r[n]=[this.gl.uniformMatrix4fv,[e,t,i],!1]},t.prototype.vertexAttrib1f=function(e,t){var i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib1f,i[2]=i[2]&&i[1][1]===t,i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib1f,[e,t],!1]},t.prototype.vertexAttrib2f=function(e,t,i){var r=this.attributes[e];r&&r[1].length===arguments.length?(r[0]=this.gl.vertexAttrib2f,r[2]=r[2]&&r[1][1]===t&&r[1][2]===i,r[1][1]=t,r[1][2]=i):this.attributes[e]=[this.gl.vertexAttrib2f,[e,t,i],!1]},t.prototype.vertexAttrib3f=function(e,t,i,r){var n=this.attributes[e];n&&n[1].length===arguments.length?(n[0]=this.gl.vertexAttrib3f,n[2]=n[2]&&n[1][1]===t&&n[1][2]===i&&n[1][3]===r,n[1][1]=t,n[1][2]=i,n[1][3]=r):this.attributes[e]=[this.gl.vertexAttrib3f,[e,t,i,r],!1]},t.prototype.vertexAttrib4f=function(e,t,i,r,n){var o=this.attributes[e];o&&o[1].length===arguments.length?(o[0]=this.gl.vertexAttrib4f,o[2]=o[2]&&o[1][1]===t&&o[1][2]===i&&o[1][3]===r&&o[1][4]===n,o[1][1]=t,o[1][2]=i,o[1][3]=r,o[1][4]=n):this.attributes[e]=[this.gl.vertexAttrib4f,[e,t,i,r,n],!1]},t.prototype.vertexAttrib1fv=function(e,t){var i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib1fv,i[2]=i[2]&&(0,o.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib1fv,[e,t],!1]},t.prototype.vertexAttrib2fv=function(e,t){var i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib2fv,i[2]=i[2]&&(0,o.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib2fv,[e,t],!1]},t.prototype.vertexAttrib3fv=function(e,t){var i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib3fv,i[2]=i[2]&&(0,o.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib3fv,[e,t],!1]},t.prototype.vertexAttrib4fv=function(e,t){var i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib4fv,i[2]=i[2]&&(0,o.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib4fv,[e,t],!1]},t.prototype.drawArrays=function(e,t,i){this.apply(),this.gl.drawArrays(e,t,i)},t.prototype.drawElements=function(e,t,i,r){this.apply(),this.gl.drawElements(e,t,i,r)},t}(a);t.StateCachingGLContext=p},988821:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inZoom=t.setZoomModeEnabled=t.getZoomModeEnabled=t.toggleZoomModifierEnabled=t.getZoomToWindowState=t.zoomToWindowState=void 0;var r=i(423902),n=i(514194),o=null,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.defaults=function(){return{zoomModeEnabled:!1,zoomModifierEnabled:!1}},t}(n.Model);function a(){return o||(o=new s),o}function c(){return a().get("zoomModeEnabled")}t.zoomToWindowState=s,t.getZoomToWindowState=a,t.toggleZoomModifierEnabled=function(){var e=a().get("zoomModeEnabled");a().set("zoomModeEnabled",!e)},t.getZoomModeEnabled=c,t.setZoomModeEnabled=function(e){a().set("zoomModeEnabled",e)},t.inZoom=function(){return c()}}}]);